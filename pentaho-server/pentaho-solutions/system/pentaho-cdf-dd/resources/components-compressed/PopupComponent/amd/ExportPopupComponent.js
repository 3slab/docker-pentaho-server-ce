define("cde/components/PopupComponent/PopupComponent",["cdf/components/BaseComponent","cdf/lib/jquery","css!./PopupComponent"],function(t,e){var o=1;return t.extend({ph:void 0,arrow:void 0,content:void 0,cancel:void 0,$overlay:void 0,popupClass:void 0,popupOverlayClass:void 0,horizontalScroll:void 0,verticalScroll:void 0,update:function(){var t=this;this.content=e("#"+this.htmlObject).detach(),this.ph=this.ph?this.ph.empty():e("<div>").appendTo(e("body")),this.content.appendTo(this.ph),this.ph.hide(),this.ph.addClass("popupComponent"),this.popupClass&&this.ph.addClass(this.popupClass),this.cancel=e("<a>&nbsp;</a>"),this.cancel.addClass("close").click(function(){t.hide()}),this.cancel.appendTo(this.ph),this.arrow=e("<div class='arrow'>").appendTo(this.ph),this.content.removeClass("hidePopup")},clone:function(t,a,n){var i=this.base(t,a,n);return i.ph=this.ph.clone(),i.ph.insertAfter(this.ph),i.ph.hide(),i.ph.find("[id]").each(function(t,a){var i=e(a),r=i.attr("id");r&&r in n?i.attr("id",n[r]):i.attr("id",r+"_"+o++)}),i},popup:function(t,o){var a,n=t.offset(),i={top:"auto",bottom:"auto",left:"auto",right:"auto"},r=this.ph.outerHeight(),p=this.ph.outerWidth();o=o||this.gravity;var h=void 0===this.draggable||this.draggable;this.horizontalScroll&&e("#"+this.htmlObject).css("overflow-x","scroll"),this.verticalScroll&&e("#"+this.htmlObject).css("overflow-y","scroll");var s=void 0!==this.closeOnClickOutside&&this.closeOnClickOutside;this.arrow.css({top:"",left:"",bottom:"",right:""}),this.arrow.show(),this.ph.removeClass("north south east west");var c,d,l,u=e(document).width()-20,m=e(document).height()-20;switch(o){case"N":l=parseInt(t.css("padding-top").replace(/(.*)px/,"$1"),10),i.left=this.center(t.outerWidth(),p,n.left,20,u),d="ownerSVGElement"in t[0]?t.attr("height")?t.attr("height")-0:0:t.height(),a=n.left-i.left-this.ph.css("border-top-width").replace(/(.*)px/,"$1"),i.top=this.offset(d,r,n.top+l,12,20,m,"near"),this.arrow.css("left",this.center(t.outerWidth(),45,a,0,p)),this.ph.addClass(i.top<n.top?"north":"south");break;case"S":l=parseInt(t.css("padding-top").replace(/(.*)px/,"$1"),10),d="ownerSVGElement"in t[0]?t.attr("height")?t.attr("height")-0:0:t.height(),i.left=this.center(t.outerWidth(),p,n.left,20,u),i.top=this.offset(d,r,n.top+l,12,20,m,"far"),a=n.left-i.left-this.ph.css("border-top-width").replace(/(.*)px/,"$1"),this.arrow.css("left",this.center(t.outerWidth(),45,a,0,p)),this.ph.addClass(i.top<n.top?"north":"south");break;case"W":l=parseInt(t.css("padding-left").replace(/(.*)px/,"$1"),10),i.top=this.center(t.outerHeight(),r,n.top,20,m),c="ownerSVGElement"in t[0]?t.attr("width")?t.attr("width")-0:0:t.width(),i.left=this.offset(t.width(),p,n.left+l,12,20,u,"near"),a=n.top-i.top-this.ph.css("border-left-width").replace(/(.*)px/,"$1"),this.arrow.css("top",this.center(t.outerHeight(),45,a,0,r)),this.ph.addClass(i.left<n.left?"west":"east");break;case"E":l=parseInt(t.css("padding-left").replace(/(.*)px/,"$1"),10),i.top=this.center(t.outerHeight(),r,n.top,20,m),c="ownerSVGElement"in t[0]?t.attr("width")?t.attr("width")-0:0:t.width(),i.left=this.offset(c,p,n.left+l,12,20,u,"far"),a=n.top-i.top-this.ph.css("border-left-width").replace(/(.*)px/,"$1"),this.arrow.css("top",this.center(t.outerHeight(),45,a,0,r)),this.ph.addClass(i.left<n.left?"west":"east")}this.ph.css(i),this.ph.show();var C,f=this;C=function(t){27==t.which&&(f.ph.hide(),e(document).unbind("keydown",C))},e(document).keydown(C);var v=function(){f.arrow.hide()};this.ph.bind("drag",v),h&&this.ph.draggable({cancel:"#"+this.htmlObject});var g,b;this.ph.bind("touchstart",function(t){g=f.ph.offset(),b={left:t.originalEvent.touches[0].pageX,top:t.originalEvent.touches[0].pageY}}),this.ph.bind("touchmove",function(t){var e={top:g.top+t.originalEvent.touches[0].pageY-b.top,left:g.left+t.originalEvent.touches[0].pageX-b.left};f.ph.offset(e),f.arrow.hide(),t.preventDefault()}),s&&(this.$overlay||(this.$overlay=e('<div id="popupComponentOverlay"></div>'),this.popupOverlayClass&&this.$overlay.addClass(this.popupOverlayClass)),this.$overlay.appendTo("body").click(function(t){t.stopPropagation(),f.hide()})),e("body").addClass("draggable-popup-fix")},hide:function(){this.ph.hide(),this.$overlay&&(this.$overlay.unbind("click"),this.$overlay.detach()),e("body").removeClass("draggable-popup-fix")},center:function(t,e,o,a,n){var i=o+t/2-e/2;return i+e>n?n-e:i<a?a:i},offset:function(t,e,o,a,n,i,r){var p=o-e-a,h=o+t+a,s=p>n,c=h+e<i;return"near"==r?s||!c?p:h:"far"==r&&(c||!s)?h:p}})}),define("cde/components/PopupComponent",["cde/components/PopupComponent/PopupComponent"],function(t){return t}),define("cdf/components/CggComponent.ext",["pentaho/environment"],function(t){return{getCggDrawUrl:function(){return t.server.root+"plugin/cgg/api/services/draw"}}}),define("cde/components/PopupComponent/ExportPopupComponent",["./PopupComponent","cdf/components/CggComponent.ext","cdf/dashboard/Utils","cdf/Logger","cdf/lib/jquery","amd!cdf/lib/jquery.fancybox","css!./ExportPopupComponent"],function(t,e,o,a,n){return t.extend({ph:void 0,arrow:void 0,content:void 0,cancel:void 0,dataComponent:void 0,chartComponent:void 0,baseSize:200,scalingFactor:1.5,clone:function(t,e,o){var a=this.dataComponent,n=this.chartComponent;delete this.dataComponent,delete this.chartComponent;var i=this.base(t,e,o);if(a&&(this.dataComponent=a,i.dataComponent=e[a.name]||a),n){this.chartComponent=n;var r=/render_(.*)/.test(n.name)?n.name.match(/render_(.*)/)[1]:null;e[n.name]?(i.chartComponent=this.dashboard.getComponentByName(e[n.name]),i.chartExportComponent=e[n.name]):r&&e[r]?(i.chartComponent=this.dashboard.getComponentByName("render_"+e[r]),i.chartExportComponent=e[r]):i.chartComponent=n,i.chartComponent=e[n.name]||n}return i},update:function(){var t=this;t.ph&&t.ph.remove(),t.chartComponent=t.dashboard.getComponentByName("render_"+t.chartExportComponent),t.dataComponent=t.dashboard.getComponentByName("render_"+t.dataExportComponent),t.ph=n("<div>"),n("#"+t.htmlObject).empty();var e=n('<div class="popupTitle">');if(e.text(t.title||"Export"),e.click(function(o){t.popup(e),o.stopPropagation()}),n("#"+t.htmlObject).append(e),t.chartComponent){var o="Export Chart";t.chartExportLabel&&t.chartExportLabel.length>0&&(o=t.chartExportLabel);var a=n('<div class="exportElement">');a.text(o),a.click(function(){t.exportChart()}),a.appendTo(t.ph)}if(t.dataComponent){var i="Export Data";t.dataExportLabel&&t.dataExportLabel.length>0&&(i=t.dataExportLabel);var r=n('<div class="exportElement">');r.text(i),r.click(function(){t.exportData()}),r.appendTo(t.ph)}n(t.contentLinks).each(function(e,o){var a=n('<div class="exportElement">');a.text(o[0]),a.click(o[1]),a.appendTo(t.ph)}),t.ph.hide().appendTo(n("body")),t.ph.addClass("popupComponent"),t.ph.addClass("exportOptions"),t.cancel=n("<a>&nbsp;</a>"),t.cancel.addClass("close").click(function(){t.hide()}),t.cancel.appendTo(t.ph),t.arrow=n("<div class='arrow'>").appendTo(t.ph)},popup:function(t,e){var o=this;o.base(t,e);var a=function(t){var e=t.pageX,i=t.pageY,r=n("#"+o.htmlObject).position();(e<r.left||e>r.left+n("#"+o.htmlObject).width()||i<r.top||i>r.top+n("#"+o.htmlObject).height())&&(o.hide(),n(document).unbind("click",a))};n(document).click(a)},exportData:function(t){var e=void 0==t?this.dataExportType:t;a.log("Exporting to "+e);for(var o=this.dataComponent.parameters.slice(),n=0;n<o.length;n++)if("metadata"===o[n][0]){o[n]=o[n].slice(),o[n][1]="false";break}var i=this.dataComponent.chartDefinition||this.dataComponent.queryDefinition;this.dashboard.getQuery(i).exportData(e,o,{filename:this.dataExportAttachmentName+"."+e})},getExportChartOptions:function(){for(var t=this.dashboard.context.fullPath?this.dashboard.context.fullPath.replace(/[^\/]+$/,""):this.dashboard.context.path.replace(/[^\/]+$/,""),e={outputType:this.chartExportType,script:t+this.chartExportComponent+".js"},n=this.chartComponent.parameters,i=0,r=n.length;i<r;i++){var p=n[i][0],h=n[i][1],s=o.ev(this.dashboard.getParameterValue(h));void 0!==s&&(e["param"+p]="metadata"!=p?s:"false")}var c=a.debug;return c>1&&(e.paramdebug=!0,e.paramdebugLevel=c),e},getExportChartUrl:function(t){return e.getCggDrawUrl()+"?"+n.param(t,!0)},exportChart:function(){var t=this.getExportChartOptions();a.log("Exporting to "+t.outputType);var e=this.getExportChartUrl(t),o=this,i=n('<div class="exportChartMasterDiv">'),r=Math.max(800,this.chartComponent.chartDefinition.width),p=n("<div class='exportChartPopupButtons'>");i.append(p);var h=n("<div class='exportChartTitle'>Export Options</div>");p.append(h);var s=n("<div class='exportChartPopupButton exportChartButtonNotLast'>Small</div>");s.click(function(){n(".exportChartPopupButtonClicked").each(function(t,e){n(e).removeClass("exportChartPopupButtonClicked")}),n(this).addClass("exportChartPopupButtonClicked"),n("#width").attr("disabled",!0),n("#height").attr("disabled",!0),n("#width").val(o.baseSize),n("#height").val(o.baseSize*(o.chartComponent.chartDefinition.height/o.chartComponent.chartDefinition.width))}),p.append(s);var c=n("<div class='exportChartPopupButton exportChartButtonNotLast exportChartButtonMiddle'>Medium</div>");c.click(function(){n(".exportChartPopupButtonClicked").each(function(t,e){n(e).removeClass("exportChartPopupButtonClicked")}),n(this).addClass("exportChartPopupButtonClicked"),n("#width").attr("disabled",!0),n("#height").attr("disabled",!0);var t=o.baseSize*o.scalingFactor;n("#width").val(t),n("#height").val(t*(o.chartComponent.chartDefinition.height/o.chartComponent.chartDefinition.width))}),c.getComponentData=function(){return[o.chartComponent.chartDefinition.width,o.chartComponent.chartDefinition.height]},p.append(c);var d=n("<div class='exportChartPopupButton exportChartButtonNotLast exportChartButtonMiddle'>Large</div>");d.click(function(){n(".exportChartPopupButtonClicked").each(function(t,e){n(e).removeClass("exportChartPopupButtonClicked")}),n(this).addClass("exportChartPopupButtonClicked"),n("#width").attr("disabled",!0),n("#height").attr("disabled",!0);var t=o.baseSize*o.scalingFactor*o.scalingFactor;n("#width").val(t),n("#height").val(t*(o.chartComponent.chartDefinition.height/o.chartComponent.chartDefinition.width))}),p.append(d);var l=n("<div class='exportChartPopupButton exportChartButtonMiddle'>Custom</div>");l.click(function(){n(".exportChartPopupButtonClicked").each(function(t,e){n(e).removeClass("exportChartPopupButtonClicked")}),n(this).addClass("exportChartPopupButtonClicked"),n("#width").removeAttr("disabled"),n("#height").removeAttr("disabled"),n("#width").val(o.chartComponent.chartDefinition.width),n("#height").val(o.chartComponent.chartDefinition.height)}),p.append(l);var u=n("<div class='exportChartInput'>&nbsp;&nbsp;&gt;&nbsp;&nbsp;&nbsp;Width:&nbsp;<input id='width' disabled='true' value='"+this.chartComponent.chartDefinition.width+'\' onChange=\'javascript:$("#height").val($("#width").val() * '+o.chartComponent.chartDefinition.height/o.chartComponent.chartDefinition.width+");' type='text'></div>");p.append(u);var m=n("<div class='exportChartInput'>Height:&nbsp;</span><input id='height' disabled='true' value='"+this.chartComponent.chartDefinition.height+"' type='text'></div>");p.append(m);var C=n("<div class='exportChartPopupButton exportChartOkButton'>Export</div>");C.click(function(){var t,a;switch(n(".exportChartPopupButtonClicked").text()){case"Small":t=[o.baseSize,o.BaseSize*(o.chartComponent.chartDefinition.height/o.chartComponent.chartDefinition.width)];break;case"Medium":a=o.baseSize*o.scalingFactor,t=[a,a*(o.chartComponent.chartDefinition.height/o.chartComponent.chartDefinition.width)];break;case"Large":a=o.baseSize*o.scalingFactor*o.scalingFactor,t=[a,a*(o.chartComponent.chartDefinition.height/o.chartComponent.chartDefinition.width)];break;case"Custom":default:t=[n("#width").val(),n("#height").val()]}var i=n('<iframe style="display:none">');i.detach(),i[0].src=e+"&attachmentName="+o.dataExportAttachmentName+"."+o.chartExportType+"&paramwidth="+t[0]+"&paramheight="+t[1],i.appendTo(n("body"))}),p.append(C);var f=n("<img src='"+e+"&paramwidth="+this.chartComponent.chartDefinition.width+"&paramheight="+this.chartComponent.chartDefinition.height+"'/>"),v=n("<div class='exportChartImageDiv'>");v.append(f),v.append("&nbsp;"),i.append(v);var g=n('<div class="exportChartMasterDivHolder">');g.append(i),n.fancybox.open({src:g,type:"html",baseClass:"cdf-fancybox cdf-fancybox-html",btnTpl:{smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="close"></button>'}}),n(".fancybox-content").css({"max-width":r,height:this.chartComponent.chartDefinition.height+60})}})});