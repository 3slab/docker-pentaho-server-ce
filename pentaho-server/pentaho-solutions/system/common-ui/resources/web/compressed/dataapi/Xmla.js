/*!
Copyright 2009,2010 Roland Bouman

This is xmla4js - a stand-alone, cross-browser javascript library for working with "XML for Analysis".
XML for Analysis (XML/A) is a vendor-neutral industry-standard protocol for OLAP services over HTTP.
xmla4js enables web-browser-based analytical business intelligence applications.

This file contains human-readable javascript source along with the YUI Doc compatible annotations.
Note: some portions of the API documentation were adopted from the original XML/A specification.
I believe that this constitutes fair use, but if you have reason to believe that the documentation
violates any copyright, or is otherwise incompatible with the LGPL license please contact me.

Include this in your web-pages for debug and development purposes only.
For production purposes, consider using the minified/obfuscated versions in the /js directory.

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

Also available (dual-licensed) under the Apache 2.0 license - http://www.apache.org/licenses/LICENSE-2.0.html
*/

define("common-data/Xmla",[],function(){var e;return function(){function t(t){var s,r=!1,n=function(){switch(r=!0,s.readyState){case 0:t.aborted(s);break;case 4:200===s.status?t.complete(s):t.error(e.Exception._newError("HTTP_ERROR","_ajax",t))}};return s=L?new ActiveXObject("MSXML2.XMLHTTP.3.0"):new XMLHttpRequest,t.username&&t.password?s.open("POST",t.url,t.async,t.username,t.password):s.open("POST",t.url,t.async),s.onreadystatechange=n,s.setRequestHeader("Accept","text/xml, application/xml"),s.setRequestHeader("Content-Type","text/xml"),s.send(t.data),t.async||r||n.call(s),s}function s(e){return void 0===e}function r(e){return"number"==typeof e}function n(e){return e.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(e){if(e.innerText)return e.innerText;if(e.textContent)return e.textContent;if(e.normalize)return e.normalize(),e.firstChild?e.firstChild.data:null;for(var t="",s=e.childNodes,r=s.length,n=0;n<r;n+=1)t+=s.item(n).data;return t}function E(e,t,s,r){r||(r="");var i,E,o,_,a,c="\n"+r+"<"+e+">";if(s){c+="\n"+r+" <"+t+">";for(_ in s)if(s.hasOwnProperty(_)){if(a=s[_],c+="\n"+r+"  <"+_+">","array"==typeof a)for(E=0,i=a.length;E<i;E+=1)o=a[E],c+="<Value>"+n(o)+"</Value>";else c+=n(a);c+="</"+_+">"}c+="\n"+r+" </"+t+">"}return c+="\n"+r+"</"+e+">"}function o(t){var s=t.method,r=null,i='<?xml version="1.0" encoding="UTF-8"?>\n<'+D+":Envelope "+p+" "+C+">\n <"+D+":Body>\n  <"+s+" "+f+" "+C+">";switch(s){case e.METHOD_DISCOVER:t.requestType?i+="\n   <"+H+">"+t.requestType+"</"+H+">"+E("Restrictions","RestrictionList",t.restrictions,"   ")+E("Properties","PropertyList",t.properties,"   "):r=e.Exception._newError("MISSING_REQUEST_TYPE","Xmla._getXmlaSoapMessage",t);break;case e.METHOD_EXECUTE:t.statement?i+="\n   <Command>\n    <Statement>"+n(t.statement)+"</Statement>\n   </Command>"+E("Properties","PropertyList",t.properties,"   "):r=e.Exception._newError("MISSING_REQUEST_TYPE","Xmla._getXmlaSoapMessage",t)}return null!==r&&r._throw(),i+="\n  </"+s+">\n </"+D+":Body>\n</"+D+":Envelope>"}function _(e,t,r){t&&!e&&(e={});for(var n in t)t.hasOwnProperty(n)&&(r||s(e[n]))&&(e[n]=t[n]);return e}function a(e,t){var s,r,n=w(e,d,m,"complexType"),i=n.length;for(r=0;r<i;r+=1)if(s=n.item(r),s.getAttribute("name")===t)return s;return null}function c(e){return"true"===e}function u(e){return parseInt(e,10)}function l(e){return parseFloat(e,10)}function S(e){return e}function R(e){return Date.parse(e)}function h(e){return e}function A(e,t){for(var s,r=[],n=e.length,E=0;E<n;E+=1)s=e.item(E),r.push(t(i(s)));return r}function T(e){var t={};switch(e){case"xsd:boolean":t.func=c,t.jsType="boolean";break;case"xsd:decimal":case"xsd:double":case"xsd:float":t.func=l,t.jsType="number";break;case"xsd:int":case"xsd:integer":case"xsd:nonPositiveInteger":case"xsd:negativeInteger":case"xsd:nonNegativeInteger":case"xsd:positiveInteger":case"xsd:short":case"xsd:byte":case"xsd:long":case"xsd:unsignedLong":case"xsd:unsignedInt":case"xsd:unsignedShort":case"xsd:unsignedByte":t.func=u,t.jsType="number";break;case"xsd:string":t.func=S,t.jsType="string";break;case"xsd:dateTime":t.func=R,t.jsType="object";break;case"Restrictions":t.func=h,t.jsType="object";break;default:t.func=S,t.jsType="object"}return t}function M(e){var t=i(e),s=e.getAttribute("type");return converter,s?(converter=T(s),converter?converter.func(t):t):t}var N="http://schemas.xmlsoap.org/soap/",D="SOAP-ENV",p="xmlns:"+D+'="http://schemas.xmlsoap.org/soap/envelope/"',C=D+':encodingStyle="'+N+'encoding/"',O="urn:schemas-microsoft-com:",I=O+"xml-analysis",f='xmlns="'+I+'"',d="http://www.w3.org/2001/XMLSchema",m="xsd",x=I+":rowset",P=I+":mddataset",L=!!window.ActiveXObject,w=document.getElementsByTagNameNS?function(e,t,s,r){return e.getElementsByTagNameNS(t,r)}:function(e,t,s,r){return s?e.getElementsByTagName(s+":"+r):e.getElementsByTagName(r)},v=document.documentElement.getAttributeNS?function(e,t,s,r){return e.getAttributeNS(t,r)}:function(e,t,s,r){return s?e.getAttribute(s+":"+r):e.getAttribute(r)},H="RequestType";e=function(t){return this.listeners={},this.listeners[e.EVENT_REQUEST]=[],this.listeners[e.EVENT_SUCCESS]=[],this.listeners[e.EVENT_ERROR]=[],this.listeners[e.EVENT_DISCOVER]=[],this.listeners[e.EVENT_DISCOVER_SUCCESS]=[],this.listeners[e.EVENT_DISCOVER_ERROR]=[],this.listeners[e.EVENT_EXECUTE]=[],this.listeners[e.EVENT_EXECUTE_SUCCESS]=[],this.listeners[e.EVENT_EXECUTE_ERROR]=[],this.options=_(_({},e.defaultOptions,!0),t,!0),this},e.defaultOptions={requestTimeout:3e4,async:!1},e.METHOD_DISCOVER="Discover",e.METHOD_EXECUTE="Execute";e.DISCOVER_DATASOURCES="DISCOVER_DATASOURCES",e.DISCOVER_PROPERTIES="DISCOVER_PROPERTIES",e.DISCOVER_SCHEMA_ROWSETS="DISCOVER_SCHEMA_ROWSETS",e.DISCOVER_ENUMERATORS="DISCOVER_ENUMERATORS",e.DISCOVER_KEYWORDS="DISCOVER_KEYWORDS",e.DISCOVER_LITERALS="DISCOVER_LITERALS",e.DBSCHEMA_CATALOGS="DBSCHEMA_CATALOGS",e.DBSCHEMA_COLUMNS="DBSCHEMA_COLUMNS",e.DBSCHEMA_PROVIDER_TYPES="DBSCHEMA_PROVIDER_TYPES",e.DBSCHEMA_SCHEMATA="DBSCHEMA_SCHEMATA",e.DBSCHEMA_TABLES="DBSCHEMA_TABLES",e.DBSCHEMA_TABLES_INFO="DBSCHEMA_TABLES_INFO",e.MDSCHEMA_ACTIONS="MDSCHEMA_ACTIONS",e.MDSCHEMA_CUBES="MDSCHEMA_CUBES",e.MDSCHEMA_DIMENSIONS="MDSCHEMA_DIMENSIONS",e.MDSCHEMA_FUNCTIONS="MDSCHEMA_FUNCTIONS",e.MDSCHEMA_HIERARCHIES="MDSCHEMA_HIERARCHIES",e.MDSCHEMA_LEVELS="MDSCHEMA_LEVELS",e.MDSCHEMA_MEASURES="MDSCHEMA_MEASURES",e.MDSCHEMA_MEMBERS="MDSCHEMA_MEMBERS",e.MDSCHEMA_PROPERTIES="MDSCHEMA_PROPERTIES",e.MDSCHEMA_SETS="MDSCHEMA_SETS",e.EVENT_REQUEST="request",e.EVENT_SUCCESS="success",e.EVENT_ERROR="error",e.EVENT_EXECUTE="execute",e.EVENT_EXECUTE_SUCCESS="executesuccess",e.EVENT_EXECUTE_ERROR="executeerror",e.EVENT_DISCOVER="discover",e.EVENT_DISCOVER_SUCCESS="discoversuccess",e.EVENT_DISCOVER_ERROR="discovererror",e.EVENT_GENERAL=[e.EVENT_REQUEST,e.EVENT_SUCCESS,e.EVENT_ERROR],e.EVENT_DISCOVER_ALL=[e.EVENT_DISCOVER,e.EVENT_DISCOVER_SUCCESS,e.EVENT_DISCOVER_ERROR],e.EVENT_EXECUTE_ALL=[e.EVENT_EXECUTE,e.EVENT_EXECUTE_SUCCESS,e.EVENT_EXECUTE_ERROR],e.EVENT_ALL=[].concat(e.EVENT_GENERAL,e.EVENT_DISCOVER_ALL,e.EVENT_EXECUTE_ALL),e.PROP_DATASOURCEINFO="DataSourceInfo",e.PROP_CATALOG="Catalog",e.PROP_CUBE="Cube",e.PROP_FORMAT="Format",e.PROP_FORMAT_TABULAR="Tabular",e.PROP_FORMAT_MULTIDIMENSIONAL="Multidimensional",e.PROP_AXISFORMAT="AxisFormat",e.PROP_AXISFORMAT_TUPLE="TupleFormat",e.PROP_AXISFORMAT_CLUSTER="ClusterFormat",e.PROP_AXISFORMAT_CUSTOM="CustomFormat",e.PROP_CONTENT="Content",e.PROP_CONTENT_DATA="Data",e.PROP_CONTENT_NONE="None",e.PROP_CONTENT_SCHEMA="Schema",e.PROP_CONTENT_SCHEMADATA="SchemaData",e.prototype={listeners:null,soapMessage:null,response:null,responseText:null,responseXML:null,setOptions:function(e){_(this.options,e,!0)},addListener:function(t){var s=t.events;s||e.Exception._newError("NO_EVENTS_SPECIFIED","Xmla.addListener",t)._throw(),"string"==typeof s&&(s="all"===s?e.EVENT_ALL:s.split(",")),s instanceof Array||e.Exception._newError("WRONG_EVENTS_FORMAT","Xmla.addListener",t)._throw();for(var r,n,i=s.length,E=0;E<i;E+=1)r=s[E].replace(/\s+/g,""),n=this.listeners[r],n||e.Exception._newError("UNKNOWN_EVENT","Xmla.addListener",t)._throw(),"function"==typeof t.handler?(t.scope||(t.scope=window),n.push(t)):e.Exception._newError("INVALID_EVENT_HANDLER","Xmla.addListener",t)._throw()},_fireEvent:function(t,s,r){var n=this.listeners[t];n||e.Exception._newError("UNKNOWN_EVENT","Xmla._fireEvent",t)._throw();var i=n.length,E=!0;if(i){for(var o,_,a=0;a<i;a+=1)if(o=n[a],_=o.handler.call(o.scope,t,s,this),r&&!1===_){E=!1;break}}else"error"===t&&s.exception._throw();return E},request:function(r){var n,i=this;this.response=null,this.responseText=null,this.responseXML=null,r.url||(this.options.url?r.url=this.options.url:(n=e.Exception._newError("MISSING_URL","Xmla.request",r),n._throw())),r.properties=_(r.properties,this.options.properties,!1),r.restrictions=_(r.restrictions,this.options.restrictions,!1),s(r.async)&&!s(this.options.async)&&(r.async=this.options.async),s(r.requestTimeout)&&!s(this.options.requestTimeout)&&(r.requestTimeout=this.options.requestTimeout),!r.username&&this.options.username&&(r.username=this.options.username),!r.password&&this.options.password&&(r.password=this.options.password);var E=o(r);this.soapMessage=E;var a={async:r.async,timeout:r.requestTimeout,data:E,error:function(e){r.exception=e,i._requestError(r)},complete:function(e){r.xhr=e,i._requestSuccess(r)},url:r.url};return r.username&&(a.username=r.username),r.password&&(a.password=r.password),this._fireEvent(e.EVENT_REQUEST,r,!0)&&(r.method==e.METHOD_DISCOVER&&this._fireEvent(e.EVENT_DISCOVER,r)||r.method==e.METHOD_EXECUTE&&this._fireEvent(e.EVENT_EXECUTE,r))&&t(a),this.response},_requestError:function(e){this._fireEvent("error",e)},_requestSuccess:function(t){var s=t.xhr;this.responseXML=s.responseXML,this.responseText=s.responseText;var r=t.method,n=w(this.responseXML,"http://schemas.xmlsoap.org/soap/envelope/",D,"Fault");if(n.length){switch(n=n.item(0),t.exception=new e.Exception(e.Exception.TYPE_ERROR,n.getElementsByTagName("faultcode").item(0).childNodes.item(0).data,n.getElementsByTagName("faultstring").item(0).childNodes.item(0).data,null,"_requestSuccess",t),r){case e.METHOD_DISCOVER:this._fireEvent(e.EVENT_DISCOVER_ERROR,t);break;case e.METHOD_EXECUTE:this._fireEvent(e.EVENT_EXECUTE_ERROR,t)}this._fireEvent(e.EVENT_ERROR,t)}else{switch(r){case e.METHOD_DISCOVER:var i=new e.Rowset(this.responseXML,t.requestType);t.rowset=i,this.response=i,this._fireEvent(e.EVENT_DISCOVER_SUCCESS,t);break;case e.METHOD_EXECUTE:var E,o=null,_=null;switch(t.properties[e.PROP_FORMAT]){case e.PROP_FORMAT_TABULAR:E=o=new e.Rowset(this.responseXML);break;case e.PROP_FORMAT_MULTIDIMENSIONAL:E=_=new e.Dataset(this.responseXML)}t.resultset=o,t.dataset=_,this.response=E,this._fireEvent(e.EVENT_EXECUTE_SUCCESS,t)}this._fireEvent(e.EVENT_SUCCESS,t)}},execute:function(t){var s=t.properties;s||(s={},t.properties=s),_(s,this.options.properties,!1),s[e.PROP_CONTENT]||(s[e.PROP_CONTENT]=e.PROP_CONTENT_SCHEMADATA),s[e.PROP_FORMAT]||(t.properties[e.PROP_FORMAT]=e.PROP_FORMAT_MULTIDIMENSIONAL);var r=_(t,{method:e.METHOD_EXECUTE},!0);return this.request(r)},executeTabular:function(t){return t.properties||(t.properties={}),t.properties[e.PROP_FORMAT]=e.PROP_FORMAT_TABULAR,this.execute(t)},executeMultiDimensional:function(t){return t.properties||(t.properties={}),t.properties[e.PROP_FORMAT]=e.PROP_FORMAT_MULTIDIMENSIONAL,this.execute(t)},discover:function(t){var s=_(t,{method:e.METHOD_DISCOVER},!0);return s.requestType||(s.requestType=this.options.requestType),this.request(s)},discoverDataSources:function(t){var s=_(t,{requestType:e.DISCOVER_DATASOURCES},!0);return this.discover(s)},discoverProperties:function(t){var s=_(t,{requestType:e.DISCOVER_PROPERTIES},!0);return this.discover(s)},discoverSchemaRowsets:function(t){var s=_(t,{requestType:e.DISCOVER_SCHEMA_ROWSETS},!0);return this.discover(s)},discoverEnumerators:function(t){var s=_(t,{requestType:e.DISCOVER_ENUMERATORS},!0);return this.discover(s)},discoverKeywords:function(t){var s=_(t,{requestType:e.DISCOVER_KEYWORDS},!0);return this.discover(s)},discoverLiterals:function(t){var s=_(t,{requestType:e.DISCOVER_LITERALS},!0);return this.discover(s)},discoverDBCatalogs:function(t){var s=_(t,{requestType:e.DBSCHEMA_CATALOGS},!0);return this.discover(s)},discoverDBColumns:function(t){var s=_(t,{requestType:e.DBSCHEMA_COLUMNS},!0);return this.discover(s)},discoverDBProviderTypes:function(t){var s=_(t,{requestType:e.DBSCHEMA_PROVIDER_TYPES},!0);return this.discover(s)},discoverDBSchemata:function(t){var s=_(t,{requestType:e.DBSCHEMA_SCHEMATA},!0);return this.discover(s)},discoverDBTables:function(t){var s=_(t,{requestType:e.DBSCHEMA_TABLES},!0);return this.discover(s)},discoverDBTablesInfo:function(t){var s=_(t,{requestType:e.DBSCHEMA_TABLES_INFO},!0);return this.discover(s)},discoverMDActions:function(t){var s=_(t,{requestType:e.MDSCHEMA_ACTIONS},!0);return this.discover(s)},discoverMDCubes:function(t){var s=_(t,{requestType:e.MDSCHEMA_CUBES},!0);return this.discover(s)},discoverMDDimensions:function(t){var s=_(t,{requestType:e.MDSCHEMA_DIMENSIONS},!0);return this.discover(s)},discoverMDFunctions:function(t){var s=_(t,{requestType:e.MDSCHEMA_FUNCTIONS},!0);return this.discover(s)},discoverMDHierarchies:function(t){var s=_(t,{requestType:e.MDSCHEMA_HIERARCHIES},!0);return this.discover(s)},discoverMDLevels:function(t){var s=_(t,{requestType:e.MDSCHEMA_LEVELS},!0);return this.discover(s)},discoverMDMeasures:function(t){var s=_(t,{requestType:e.MDSCHEMA_MEASURES},!0);return this.discover(s)},discoverMDMembers:function(t){var s=_(t,{requestType:e.MDSCHEMA_MEMBERS},!0);return this.discover(s)},discoverMDProperties:function(t){var s=_(t,{requestType:e.MDSCHEMA_PROPERTIES},!0);return this.discover(s)},discoverMDSets:function(t){var s=_(t,{requestType:e.MDSCHEMA_SETS},!0);return this.discover(s)}},e.Rowset=function(e,t){return this._node=e,this._type=t,this._initData(),this},e.Rowset.MD_DIMTYPE_UNKNOWN=0,e.Rowset.MD_DIMTYPE_TIME=1,e.Rowset.MD_DIMTYPE_MEASURE=2,e.Rowset.MD_DIMTYPE_OTHER=3,e.Rowset.MD_DIMTYPE_QUANTITATIVE=5,e.Rowset.MD_DIMTYPE_ACCOUNTS=6,e.Rowset.MD_DIMTYPE_CUSTOMERS=7,e.Rowset.MD_DIMTYPE_PRODUCTS=8,e.Rowset.MD_DIMTYPE_SCENARIO=9,e.Rowset.MD_DIMTYPE_UTILIY=10,e.Rowset.MD_DIMTYPE_CURRENCY=11,e.Rowset.MD_DIMTYPE_RATES=12,e.Rowset.MD_DIMTYPE_CHANNEL=13,e.Rowset.MD_DIMTYPE_PROMOTION=14,e.Rowset.MD_DIMTYPE_ORGANIZATION=15,e.Rowset.MD_DIMTYPE_BILL_OF_MATERIALS=16,e.Rowset.MD_DIMTYPE_GEOGRAPHY=17,e.Rowset.MD_STRUCTURE_FULLYBALANCED=0,e.Rowset.MD_STRUCTURE_RAGGEDBALANCED=1,e.Rowset.MD_STRUCTURE_UNBALANCED=2,e.Rowset.MD_STRUCTURE_NETWORK=3,e.Rowset.MD_USER_DEFINED=1,e.Rowset.MD_SYSTEM_ENABLED=2,e.Rowset.MD_SYSTEM_INTERNAL=4,e.Rowset.MDMEMBER_TYPE_REGULAR=1,e.Rowset.MDMEMBER_TYPE_ALL=2,e.Rowset.MDMEMBER_TYPE_FORMULA=3,e.Rowset.MDMEMBER_TYPE_MEASURE=4,e.Rowset.MDMEMBER_TYPE_UNKNOWN=0,e.Rowset.KEYS={},e.Rowset.KEYS[e.DBSCHEMA_CATALOGS]=["CATALOG_NAME"],e.Rowset.KEYS[e.DBSCHEMA_COLUMNS]=["TABLE_CATALOG","TABLE_NAME","COLUMN_NAME"],e.Rowset.KEYS[e.DBSCHEMA_PROVIDER_TYPES]=["TYPE_NAME"],e.Rowset.KEYS[e.DBSCHEMA_SCHEMATA]=["CATALOG_NAME","SCHEMA_NAME"],e.Rowset.KEYS[e.DBSCHEMA_TABLES]=["TABLE_CATALOG","TABLE_NAME"],e.Rowset.KEYS[e.DBSCHEMA_TABLES_INFO]=["TABLE_CATALOG","TABLE_NAME"],e.Rowset.KEYS[e.DISCOVER_DATASOURCES]=["DataSourceName"],e.Rowset.KEYS[e.DISCOVER_ENUMERATORS]=["EnumName","ElementName"],e.Rowset.KEYS[e.DISCOVER_KEYWORDS]=["Keyword"],e.Rowset.KEYS[e.DISCOVER_LITERALS]=["LiteralName"],e.Rowset.KEYS[e.DISCOVER_PROPERTIES]=["PropertyName"],e.Rowset.KEYS[e.DISCOVER_SCHEMA_ROWSETS]=["SchemaName"],e.Rowset.KEYS[e.MDSCHEMA_ACTIONS]=["CATALOG_NAME","CUBE_NAME","ACTION_NAME"],e.Rowset.KEYS[e.MDSCHEMA_CUBES]=["CATALOG_NAME","CUBE_NAME"],e.Rowset.KEYS[e.MDSCHEMA_DIMENSIONS]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME"],e.Rowset.KEYS[e.MDSCHEMA_FUNCTIONS]=["FUNCTION_NAME","PARAMETER_LIST"],e.Rowset.KEYS[e.MDSCHEMA_HIERARCHIES]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME","HIERARCHY_UNIQUE_NAME"],e.Rowset.KEYS[e.MDSCHEMA_LEVELS]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME","HIERARCHY_UNIQUE_NAME","LEVEL_UNIQUE_NAME"],e.Rowset.KEYS[e.MDSCHEMA_MEASURES]=["CATALOG_NAME","CUBE_NAME","MEASURE_NAME"],e.Rowset.KEYS[e.MDSCHEMA_MEMBERS]=["CATALOG_NAME","CUBE_NAME","DIMENSION_UNIQUE_NAME","HIERARCHY_UNIQUE_NAME","LEVEL_UNIQUE_NAME","MEMBER_UNIQUE_NAME"],e.Rowset.KEYS[e.MDSCHEMA_PROPERTIES]=[],e.Rowset.KEYS[e.MDSCHEMA_SETS]=[],e.Rowset.prototype={_node:null,_type:null,_row:null,_rows:null,numRows:null,fieldOrder:null,fields:null,_fieldCount:null,_initData:function(){this._rows=w(this._node,x,null,"row"),this.numRows=this._rows?this._rows.length:0,this.reset(),this.fieldOrder=[],this.fields={},this._fieldCount=0;var t=a(this._node,"row");if(t){for(var s,r,n,i,E,o,_,c=w(t,d,m,"sequence").item(0),u=c.childNodes,l=u.length,S=0;S<l;S+=1)if(s=u.item(S),1===s.nodeType){if(r=v(s,"urn:schemas-microsoft-com:xml-sql","sql","field"),n=s.getAttribute("name"),null===(o=s.getAttribute("type"))&&this._row){var R=this._row.getElementsByTagName(n);R.length&&(o=v(R.item(0),"http://www.w3.org/2001/XMLSchema-instance","xsi","type"))}o||this._type!=e.DISCOVER_SCHEMA_ROWSETS||"Restrictions"!==n||(o="Restrictions"),i=s.getAttribute("minOccurs"),i=i?parseInt(i,10):1,E=s.getAttribute("maxOccurs"),E?"unbounded"===E?E=1/0:i=parseInt(E,10):E=1,_=T(o),this.fields[r]={name:n,label:r,index:this._fieldCount++,type:o,jsType:_.jsType,minOccurs:i,maxOccurs:E,getter:this._createFieldGetter(n,_.func,i,E)},this.fieldOrder.push(r)}}else e.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Rowset",this._node)._throw()},_createFieldGetter:function(e,t,s,r){var n;return 1===r?1===s?n=function(){var s=w(this._row,x,null,e);return t(i(s.item(0)))}:0===s&&(n=function(){var s=w(this._row,x,null,e);return s.length?t(i(s.item(0))):null}):1===s?n=function(){return A(w(this._row,x,null,e),t)}:0===s&&(n=function(){var s=w(this._row,x,null,e);return s.length?A(s,t):null}),n},getType:function(){return this._type},getFields:function(){for(var e=[],t=this._fieldCount,s=this.fieldOrder,r=0;r<t;r+=1)e[r]=this.fieldDef(s[r]);return e},getFieldNames:function(){for(var e=[],t=0,s=this._fieldCount;t<s;t+=1)e[t]=this.fieldOrder[t];return e},hasMoreRows:function(){return this.numRows>this.rowIndex},next:function(){return this.rowIndex+=1,this._row=this._rows.item(this.rowIndex),this.rowIndex},curr:function(){return this.rowIndex},rowCount:function(){return this.numRows},reset:function(){this.rowIndex=0,this._row=this.hasMoreRows()?this._rows.item(this.rowIndex):null},fieldDef:function(t){var s=this.fields[t];return s||e.Exception._newError("INVALID_FIELD","Xmla.Rowset.fieldDef",t)._throw(),s},fieldIndex:function(e){return this.fieldDef(e).index},fieldName:function(t){var s=this.fieldOrder[t];return s||e.Exception._newError("INVALID_FIELD","Xmla.Rowset.fieldDef",t)._throw(),s},fieldVal:function(e){return r(e)&&(e=this.fieldName(e)),this.fieldDef(e).getter.call(this)},fieldCount:function(){return this._fieldCount},close:function(){this._node=null,this._row=null,this._rows=null},readAsArray:function(e){var t,s,r=this.fields;e||(e=[]);for(t in r)r.hasOwnProperty(t)&&(s=r[t],e[s.index]=s.getter.call(this));return e},fetchAsArray:function(e){return this.hasMoreRows()?(e=this.readAsArray(e),this.next()):e=!1,e},readAsObject:function(e){var t,s,r=this.fields;e||(e={});for(t in r)r.hasOwnProperty(t)&&(s=r[t],e[t]=s.getter.call(this));return e},fetchAsObject:function(e){return this.hasMoreRows()?(e=this.readAsObject(e),this.next()):e=!1,e},fetchCustom:function(e){var t;return this.hasMoreRows()?(t=e.call(this),this.next()):t=!1,t},fetchAllAsArray:function(e){var t;for(e||(e=[]);t=this.fetchAsArray();)e.push(t);return e},fetchAllAsObject:function(e){var t;for(e||(e=[]);t=this.fetchAsObject();)e.push(t);return e},fetchAllCustom:function(e,t){var s;for(e||(e=[]);s=this.fetchCustom(t);)e.push(s);return e},mapAsObject:function(e,t,s){var r,n,i,E,o=t.length,_=o-1,a=e;for(E=0;E<o;E+=1)r=t[E],n=s[r],i=a[n],i?E===_?i instanceof Array?i.push(s):a[n]=[i,s]:a=i:E===_?a[n]=s:a=a[n]={}},mapAllAsObject:function(e,t){t||(t={}),e||(e=this.getKey());for(var s;s=this.fetchAsObject();)this.mapAsObject(t,e,s);return t},getKey:function(){return this._type?e.Rowset.KEYS[this._type]:this.getFieldNames()}},e.Dataset=function(e){return this._initDataset(e),this},e.Dataset.AXIS_COLUMNS=0,e.Dataset.AXIS_ROWS=1,e.Dataset.AXIS_PAGES=2,e.Dataset.AXIS_SECTIONS=3,e.Dataset.AXIS_CHAPTERS=4,e.Dataset.AXIS_SLICER="SlicerAxis",e.Dataset.prototype={_root:null,_axes:null,_axesOrder:null,_numAxes:null,_slicer:null,_cellset:null,_initDataset:function(e){this._initRoot(e),this.cubeName=i(w(this._root,P,"","CubeName").item(0)),this._initAxes(),this._initCells()},_initRoot:function(t){var s=w(t,P,"","root");s.length?this._root=s.item(0):e.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Dataset._initData",t)._throw()},_initAxes:function(){var t,s,r,n,i,E,o={};for(this._axes={},this._axesOrder=[],i=w(this._root,P,"","AxisInfo"),E=i.length,t=0;t<E;t++)r=i.item(t),n=r.getAttribute("name"),o[n]=r;for(i=w(this._root,P,"","Axis"),E=i.length,t=0;t<E;t++)r=i.item(t),n=r.getAttribute("name"),s=new e.Dataset.Axis(o[n],r),n==e.Dataset.AXIS_SLICER?this._slicer=s:(this._axes[n]=s,this._axesOrder.push(s));this._numAxes=this._axesOrder.length},_initCells:function(){this._cellset=new e.Dataset.Cellset(this)},getAxisCount:function(){return this._numAxes},getAxis:function(t){var r;return isNum(t)?(r=this._axesOrder[t],s(t)&&e.Exception._newError("INVALID_AXIS","Xmla.Dataset.getAxis",r)._throw()):r=t,r==e.Dataset.AXIS_SLICER?this._slicer:this._axes[r]},getColumns:function(){return this.getAxis(e.Dataset.AXIS_COLUMNS)},getRows:function(){return this.getAxis(e.Dataset.AXIS_ROWS)},getSlicer:function(){return this._slicer},close:function(){this._slicer&&this._slicer.close();for(var e=0;e<this._namAxes;e++)this.getAxis(e).close();this._cellset.close(),this._root=null,this._axes=null,this._axesOrder=null,this._numAxes=null,this._slicer=null}},e.Dataset.Axis=function(e,t){return this._initAxis(e,t),this},e.Dataset.Axis.MEMBER_UNIQUE_NAME="UName",e.Dataset.Axis.MEMBER_CAPTION="Caption",e.Dataset.Axis.MEMBER_LEVEL_NAME="LName",e.Dataset.Axis.MEMBER_LEVEL_NUMBER="LNum",e.Dataset.Axis.MEMBER_DISPLAY_INFO="DisplayInfo",e.Dataset.Axis.prototype={_tuples:null,_members:null,numTuples:null,numHierarchies:null,_tupleIndex:null,_hierarchyOrder:null,_hierarchyDefs:null,_initHierarchies:function(e){var t,s,r,n,i,E,o,_,a,c=w(e,P,"","HierarchyInfo"),u=c.length;for(this._hierarchyDefs={},this._hierarchyOrder=[],this.numHierarchies=u,t=0;t<u;t++){for(r=c.item(t),n=r.getAttribute("name"),this._hierarchyOrder[t]=n,E={},_=w(e,P,"","*"),o=_.length,s=0;s<o;s++)a=_.item(s),E[a.tagName]=null;i={index:t,name:n,properties:E},this._hierarchyDefs[n]=i}},_initAxis:function(e,t){this.name=t.getAttribute("name"),this._initHierarchies(e),this._tuples=w(t,P,"","Tuple"),this.numTuples=this._tuples.length,this.reset()},_getMembers:function(){return this.tupleIndex<this.numTuples?w(this._tuples.item(this.tupleIndex),P,"","Member"):null},reset:function(){this.tupleIndex=0,this._members=this.hasMoreTuples()?this._getMembers():null},hasMoreTuples:function(){return this.numTuples>this.tupleIndex},next:function(){return this.tupleIndex+=1,this._members=this._getMembers(),this.tupleIndex},tupleCount:function(){return this.numTuples},getHierarchyNames:function(){for(var e=[],t=0,s=this.numHierarchies;t<s;t+=1)e[t]=this._hierarchyOrder[t];return e},hierarchyCount:function(){return this.numHierarchies},hierarchyIndex:function(e){return this._hierarchiesNames[e]},hierarchyName:function(e){return this._hierarchyOrder[e]},hierarchyDef:function(t){var s=this._hierarchyDefs[t];return s||e.Exception._newError("INVALID_HIERARCHY","Xmla.Dataset.Axis.hierarchyDef",t)._throw(),s},member:function(t){var s,r,n,E,o,_,a={};switch(typeof t){case"string":s=this.hierarchyIndex(t),r=t;break;case"number":r=this.hierarchyName(t),s=t}n=this.hierarchyDef(r),E=n.properties,_=this._members.item(s),a.hierarchy=r,a.index=s;for(o in E)switch(el=w(_,P,"",o),el.length){case 0:a[o]=E[o];break;case 1:a[o]=i(el.item(0));break;default:e.Exception._newError("UNEXPECTED_ERROR_READING_MEMBER","Xmla.Dataset.Axis.member",o)._throw()}return a},readAsArray:function(e){e||(e=[]);for(var t=0;t<this.numHierarchies;t++)e[t]=this.member(t);return e},readAsObject:function(e){e||(e={});for(var t=0;t<this.numHierarchies;t++)e[this._hierarchyOrder[t]]=this.member(t);return e},fetchAsArray:function(){var e;return this.hasMoreTuples()?(e=this.readAsArray(),this.next()):e=!1,e},fetchAsObject:function(){var e;return this.hasMoreTuples()?(e=this.readAsObject(),this.next()):e=!1,e},fetchAllAsArray:function(e){var t;for(e||(e=[]);t=this.fetchAsArray();)e.push(t);return e},fetchAllAsObject:function(e){var t;for(e||(e=[]);t=this.fetchAsObject();)e.push(t);return e}},e.Dataset.Cellset=function(e){return this._dataset=e,this._initCellset(),this},e.Dataset.Cellset.prototype={_dataset:null,_cellNodes:null,_cellCount:null,_cellNode:null,_cellDefs:null,_idx:null,_ord:null,_cellOrd:null,_initCellset:function(){var t,s,r,n,i,E,o,_,c,u,l,S,R,h,A,M=this._dataset._root;for(t=a(M,"CellData"),t||e.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Rowset",M)._throw(),s=w(t,d,m,"element"),r=s.length,i=w(M,P,"","CellInfo"),i&&0!=i.length||e.Exception._newError("ERROR_PARSING_RESPONSE","Xmla.Rowset",M)._throw(),E=i.item(0),u=w(E,P,"","*"),this._cellDefs={},R=u.length,h=0;h<R;h+=1){l=u.item(h),S=l.tagName;for(var A=0;A<r;A++)if(n=s.item(A),n.getAttribute("name")===S){c={name:S},this._cellDefs[S]=c,o=n.getAttribute("type"),o&&(c.type=o,(_=T(o))&&(c.jsType=_.jsType,c.converter=_.func));break}}this._cellNodes=w(M,P,"","Cell"),this._cellCount=this._cellNodes.length},_getCellNode:function(){this._cellNode=this._cellNodes.item(this._idx),this._cellOrd=parseInt(this._cellNode.getAttribute("CellOrdinal"),10)},reset:function(){this._idx=0,this._getCellNode(),this._ord=0},hasMoreCells:function(){return this._idx<this._cellCount},next:function(){this._idx+=1,this._cellOrd===this._ord&&this.hasMoreCells()&&this._getCellNode()},curr:function(){return this._idx},cellValue:function(){return M(w(this._cellNode,P,"","Value").item(0))},readAsObject:function(){var e,t,s,r;if(this._cellOrd===this._ord){e={ordinal:this._ord};for(var n in this._cellDefs)s=this._cellDefs[n],t=w(this._cellNode,P,"",n).item(0),s.type?(r=s.converter,e[n]=r(i(t))):"Value"===n&&(e[n]=M(t)),e[n]=i(t)}else this._cellOrd>this._ord&&(e=null);return e},close:function(){this._dataset=null,this._cellNodes=null,this._cellNode=null}},e.Exception=function(e,t,s,r,n,i,E){return this.type=e,this.code=t,this.message=s,this.source=n,this.helpfile=r,this.data=i,this.args=E,this},e.Exception.TYPE_WARNING="warning",e.Exception.TYPE_ERROR="error";var U="http://code.google.com/p/xmla4js/wiki/ExceptionCodes";e.Exception.MISSING_REQUEST_TYPE_CDE=-1,e.Exception.MISSING_REQUEST_TYPE_MSG="Missing_Request_Type",e.Exception.MISSING_REQUEST_TYPE_HLP=U+"#"+e.Exception.MISSING_REQUEST_TYPE_CDE+"_"+e.Exception.MISSING_REQUEST_TYPE_MSG,e.Exception.MISSING_STATEMENT_CDE=-2,e.Exception.MISSING_STATEMENT_MSG="Missing_Statement",e.Exception.MISSING_STATEMENT_HLP=U+"#"+e.Exception.MISSING_STATEMENT_CDE+"_"+e.Exception.MISSING_STATEMENT_MSG,e.Exception.MISSING_URL_CDE=-3,e.Exception.MISSING_URL_MSG="Missing_URL",e.Exception.MISSING_URL_HLP=U+"#"+e.Exception.MISSING_URL_CDE+"_"+e.Exception.MISSING_URL_MSG,e.Exception.NO_EVENTS_SPECIFIED_CDE=-4,e.Exception.NO_EVENTS_SPECIFIED_MSG="No_Events_Specified",e.Exception.NO_EVENTS_SPECIFIED_HLP=U+"#"+e.Exception.NO_EVENTS_SPECIFIED_CDE+"_"+e.Exception.NO_EVENTS_SPECIFIED_MSG,e.Exception.WRONG_EVENTS_FORMAT_CDE=-5,e.Exception.WRONG_EVENTS_FORMAT_MSG="Wrong_Events_Format",e.Exception.WRONG_EVENTS_FORMAT_HLP=U+"#"+e.Exception.NO_EVENTS_SPECIFIED_CDE+"_"+e.Exception.NO_EVENTS_SPECIFIED_MSG,e.Exception.UNKNOWN_EVENT_CDE=-6,e.Exception.UNKNOWN_EVENT_MSG="Unknown_Event",e.Exception.UNKNOWN_EVENT_HLP=U+"#"+e.Exception.UNKNOWN_EVENT_CDE+"_"+e.Exception.UNKNOWN_EVENT_MSG,e.Exception.INVALID_EVENT_HANDLER_CDE=-7,e.Exception.INVALID_EVENT_HANDLER_MSG="Invalid_Events_Handler",e.Exception.INVALID_EVENT_HANDLER_HLP=U+"#"+e.Exception.INVALID_EVENT_HANDLER_CDE+"_"+e.Exception.INVALID_EVENT_HANDLER_MSG,e.Exception.ERROR_PARSING_RESPONSE_CDE=-8,e.Exception.ERROR_PARSING_RESPONSE_MSG="Error_Parsing_Response",e.Exception.ERROR_PARSING_RESPONSE_HLP=U+"#"+e.Exception.ERROR_PARSING_RESPONSE_CDE+"_"+e.Exception.ERROR_PARSING_RESPONSE_MSG,e.Exception.INVALID_FIELD_CDE=-9,e.Exception.INVALID_FIELD_MSG="Invalid_Field",e.Exception.INVALID_FIELD_HLP=U+"#"+e.Exception.INVALID_FIELD_CDE+"_"+e.Exception.INVALID_FIELD_MSG,e.Exception.HTTP_ERROR_CDE=-10,e.Exception.HTTP_ERROR_MSG="HTTP Error",e.Exception.HTTP_ERROR_HLP=U+"#"+e.Exception.HTTP_ERROR_CDE+"_"+e.Exception.HTTP_ERROR_MSG,e.Exception.INVALID_HIERARCHY_CDE=-11,e.Exception.INVALID_HIERARCHY_MSG="Invalid_Hierarchy",e.Exception.INVALID_HIERARCHY_HLP=U+"#"+e.Exception.INVALID_HIERARCHY_CDE+"_"+e.Exception.INVALID_HIERARCHY_MSG,e.Exception.UNEXPECTED_ERROR_READING_MEMBER_CDE=-12,e.Exception.UNEXPECTED_ERROR_READING_MEMBER_MSG="Error_Reading_Member",e.Exception.UNEXPECTED_ERROR_READING_MEMBER_HLP=U+"#"+e.Exception.UNEXPECTED_ERROR_READING_MEMBER_CDE+"_"+e.Exception.UNEXPECTED_ERROR_READING_MEMBER_MSG,e.Exception._newError=function(t,s,r){return new e.Exception(e.Exception.TYPE_ERROR,e.Exception[t+"_CDE"],e.Exception[t+"_MSG"],e.Exception[t+"_HLP"],s,r)},e.Exception.prototype={type:null,code:null,message:null,source:null,helpfile:null,data:null,_throw:function(){throw this},args:null,getStackTrace:function(){if(this.args)for(var e=this.args.callee;e;)String(e),e=e.caller;return""}}}(),e});