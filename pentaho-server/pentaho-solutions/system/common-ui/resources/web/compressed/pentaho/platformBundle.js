/*!
 * Copyright 2010 - 2017 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
 * Copyright 2018 - 2019 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
 * Copyright 2010 - 2019 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
 * Copyright 2018 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
 * Copyright 2010 - 2018 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
 * Copyright 2017 - 2018 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
 * Copyright 2017 - 2019 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
 * Copyright 2019 Hitachi Vantara. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*!
* Copyright 2010 - 2018 Hitachi Vantara. All rights reserved.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

/*!
* Copyright 2010 - 2017 Hitachi Vantara. All rights reserved.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
*/

/*!
* Copyright 2010 - 2017 Hitachi Vantara. All rights reserved.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

define("pentaho/type/SpecificationContext",["module","pentaho/lang/Base","pentaho/util/object","pentaho/util/error"],function(e,t,n,i){"use strict";var r=null,o="_:",a=/^_:/,s=t.extend(e.id,{constructor:function(){this.__typeInfosByUid={},this.__typeInfosByTid={},this.__nextId=1},getIdOf:function(e){var t=e.id;if(!t){var i=n.getOwn(this.__typeInfosByUid,e.uid);i&&(t=i.id)}return t},get:function(e){var t=n.getOwn(this.__typeInfosByTid,e);return t?t.type:null},add:function(e,t){var r=e.id;if(r)return r;var a=e.uid,s=n.getOwn(this.__typeInfosByUid,a);if(s)return s.id;if(t){if(n.hasOwn(this.__typeInfosByTid,t))throw i.argInvalid("tid","The temporary id is already being used by another type.")}else do{t=o+this.__nextId++}while(n.hasOwn(this.__typeInfosByTid,t));return this.__typeInfosByUid[a]=this.__typeInfosByTid[t]={type:e,id:t},t},dispose:function(){r===this&&(r=null)}},{get current(){return r},set current(e){if(e&&!(e instanceof s))throw i.argInvalidType("current","pentaho.type.SpecificationContext",typeof e);r=e||null},isIdTemporary:function(e){return!!e&&a.test(e)},get idTemporaryPrefix(){return o}});return s}),define("pentaho/type/SpecificationScope",["module","./SpecificationContext","pentaho/lang/Base"],function(e,t,n){"use strict";return n.extend(e.id,{constructor:function(e){var n=t.current,i=!1;e?t.current=e:(e=n)||(i=!0,t.current=e=new t),this.__isOwn=i,this.__context=e,this.__previous=n},get specContext(){return this.__context},dispose:function(){var e=this.__context;if(e){this.__context=null,this.__isOwn&&e.dispose();var n=this.__previous;n&&(n!==e&&(t.current=n),this.__previous=null)}}})}),define("pentaho/type/impl/SpecificationProcessor",["module","pentaho/lang/Base","pentaho/module/metaService","../SpecificationContext","pentaho/util/requireJS","pentaho/util/object"],function(e,t,n,i,r,o){"use strict";return t.extend(e.id,{loadTypeDependenciesAsync:function(e){return this.__loadDependenciesAsync(e,!0)},loadInstanceDependenciesAsync:function(e){return this.__loadDependenciesAsync(e,!1)},__loadDependenciesAsync:function(e,t){function i(e){var t=n.getId(e)||e;o.hasOwn(s,t)||(s[t]=1,a.push(r.promise(t)))}if(null==e)return Promise.resolve(e);var a=[],s=Object.create(null);return t?this.eachTypeDependency(e,i):this.eachInstanceDependency(e,i),Promise.all(a).then(function(){return null})},eachTypeDependency:function(e,t){if(null!=e)switch(typeof e){case"string":return void(i.isIdTemporary(e)||t(e));case"object":return Array.isArray(e)?void(e.length>0&&this.eachTypeDependency(e[0],t)):void(e.constructor===Object&&this.__eachTypeDependencyGeneric(e,t))}},eachInstanceDependency:function(e,t){e&&"object"==typeof e&&(Array.isArray(e)?e.forEach(function(e){this.eachInstanceDependency(e,t)},this):e.constructor===Object&&Object.keys(e).forEach(function(n){"_"===n?this.eachTypeDependency(e[n],t):this.eachInstanceDependency(e[n],t)},this))},__eachTypeDependencyGeneric:function(e,t){this.eachTypeDependency(e.base,t),this.eachTypeDependency(e.of,t);var n=e.props;n&&(Array.isArray(n)?n.forEach(function(e){e&&(this.eachInstanceDependency(e.defaultValue,t),this.eachTypeDependency(e.valueType,t),this.eachTypeDependency(e.base,t))},this):Object.keys(n).forEach(function(e){var i=n[e];i&&(this.eachInstanceDependency(i.defaultValue,t),this.eachTypeDependency(i.valueType,t),this.eachTypeDependency(i.base,t))},this));var i=e.mixins;i&&(Array.isArray(i)||(i=[i]),i.forEach(function(e){"string"==typeof e&&this.eachTypeDependency(e,t)},this))}})}),define("pentaho/type/impl/Loader",["require","module","pentaho/lang/Base","../SpecificationScope","../SpecificationContext","./SpecificationProcessor","pentaho/module/metaService","pentaho/module/util","pentaho/util/object","pentaho/util/promise","pentaho/util/requireJS","pentaho/util/error","pentaho/util/fun"],function(e,t,n,i,r,o,a,s,u,l,c,h,d){"use strict";function p(t){return u.hasOwn(T,t)?T[t]:T[t]=e(t)}function f(e,t,n){if(null==e||""===e)return l.error(h.argRequired("typeRef"),n);switch(typeof e){case"string":return _(e,n);case"function":return g(e,n);case"object":return Array.isArray(e)?v(e,n):b(e,t,n)}return l.error(h.argInvalid("typeRef"),n)}function _(t,n){if(r.isIdTemporary(t)){var i=r.current;if(!i)return l.error(h.argInvalid("typeRef","Temporary id '"+t+"' occurs outside of a generic type specification."),n);var o=i.get(t);return o?l.return(o.instance.constructor,n):l.error(h.argInvalid("typeRef","Temporary id '"+t+"' is not defined."),n)}return t=a.getId(t)||t,n?m(t,n,e(t)):c.promise(t,e).then(m.bind(null,t,n))}function m(e,t,n){return d.is(n)&&y(n)?l.return(n,t):l.error(h.operInvalid("typeRef","The value of module '"+e+"' is not a '"+j+"' constructor."),t)}function g(e,t){return y(e)?l.return(e,t):l.error(h.argInvalid("typeRef","Function is not a '"+j+"' constructor."),t)}function y(e){var t=p(j);return e===t||e.prototype instanceof t}function v(e,t){var n;return 1===e.length&&(n=e[0])?O({base:w,of:n},null,t):l.error(h.argInvalid("typeRef","List type specification must have a single child element type spec."),t)}function b(e,t,n){return e.constructor===Object?O(e,t,n):C(e,n)}function C(e,t){var n=p(j);return e instanceof n.Type?l.return(e.instance.constructor,t):e instanceof n?l.error(h.argInvalid("typeRef","Instances are not supported as type references."),t):l.error(h.argInvalid("typeRef","Object is not a 'pentaho.type.Type' instance or a plain object."),t)}function O(e,t,n){var i=e.id||null;if(null!==i){if(!r.isIdTemporary(i))return l.error(h.argInvalid("typeRef","Generic type specifications cannot have a permanent id."),n);var o=r.current;if(null!==o&&null!==o.get(i))return l.error(h.argInvalid("typeRef","Temporary id '"+i+"' is already defined."),n)}return n?x(i,e,t):I.loadTypeDependenciesAsync(e).then(function(){return x(i,e,t)})}function x(e,t,n){return u.using(new i,function(i){var r=t.base||n||A,o=S.__resolveTypeSync(r),a=o.extend({$type:t});return null!==e&&i.specContext.add(a.type,e),a})}var A="pentaho/type/Complex",j="pentaho/type/Instance",w="pentaho/type/List",T=Object.create(null),I=new o,S=n.extend(t.id,{resolveType:function(e,t){return S.__resolveTypeSync(e,u.getOwn(t,"defaultBase"))},resolveTypeAsync:function(e,t){return S.__resolveTypeAsync(e,u.getOwn(t,"defaultBase"))},resolveInstance:function(e,t,n){return S.__resolveInstanceSync(e,t,n)},resolveInstanceAsync:function(e,t,n){return I.loadInstanceDependenciesAsync(e).then(function(){return S.__resolveInstanceSync(e,t,n)})}},{__resolveTypeSync:function(e,t){return f(e,t,!0)},__resolveTypeAsync:function(e,t){try{return f(e,t,!1)}catch(e){return Promise.reject(e)}},__resolveInstanceSync:function(e,t,n){var i,r=null;if(null!=e&&"object"==typeof e&&e.constructor===Object&&(i=e._)){r=S.__resolveTypeSync(i);var o=r.type;null!=n&&n.__assertSubtype(o),o.isAbstract&&o.__throwAbstractType()}else if(null==n||n.isAbstract){switch(typeof e){case"string":r=p("pentaho/type/String");break;case"number":r=p("pentaho/type/Number");break;case"boolean":r=p("pentaho/type/Boolean")}if(null===r||null==n||r.type.isSubtypeOf(n)||(r=null),null===r){if(null==n)throw h.operInvalid("Cannot create instance of unspecified type.");n.__throwAbstractType()}}else r=n.instance.constructor;return new r(e,t)}});return S}),define("pentaho/type/_baseLoader",["./impl/Loader"],function(e){"use strict";return new e}),define("pentaho/type/InstanceType",["require","./_baseLoader","./SpecificationScope","./SpecificationContext","pentaho/i18n!types","pentaho/module/metaService","pentaho/lang/Base","pentaho/util/error","pentaho/util/arg","pentaho/util/object","pentaho/util/fun","pentaho/util/promise","pentaho/util/text","pentaho/util/spec","pentaho/module/util"],function(e,t,n,i,r,o,a,s,u,l,c,h,d,p,f){"use strict";function _(e,t,n){return null==e?e=n:t&&null==(e=t.call(this,e,n))&&(e=n),e}function m(e,t,n){return function(i,r){var o=e.apply(this,arguments);return _.call(i,o,t,n)}}var g=1,y=["description","category","helpUrl","isBrowsable","isAdvanced","ordinal"],v=Object.prototype.isPrototypeOf,b=null,C=a.extend("pentaho.type.Type",{extend_order:["mixins"],constructor:function(e,t){e||(e={}),l.setConst(this,"uid",g++);var n=u.required(t,"instance","keyArgs");l.setConst(n,"__type",this),l.setConst(this,"__instance",n),u.optional(t,"isRoot")&&l.setConst(this,"root",this);var r=d.nonEmptyString(e.id);null!==r&&i.isIdTemporary(r)&&(r=null);var a=d.nonEmptyString(e.sourceId);null===a?a=r:null===r&&(r=a);var c=d.nonEmptyString(e.alias);if(null===c){if(null!==r){var h=o.get(r);null!==h&&(c=h.alias)}}else if(null===r)throw s.argInvalid("alias","Anonymous types cannot have an alias");l.setConst(this,"__id",r),l.setConst(this,"__sourceId",a),l.setConst(this,"__alias",c),l.setConst(this,"__isAbstract",!!e.isAbstract),e.mixins&&(this.mixins=e.mixins,e=Object.create(e),e.mixins=void 0),e=this._init(e,t)||e;var p=this.constructor;p.prototype===this?p.mix(e,null,t):this.extend(e,t),this._postInit(e,t)},_init:function(e,t){Object.defineProperty(this,"__hasDescendants",{value:!1,writable:!0}),this.__application=p.merge({},this.__application)},_postInit:function(e,t){},uid:-1,get isRoot(){return this===this.root},get ancestor(){return this.isRoot?null:Object.getPrototypeOf(this)},get hasDescendants(){return this.__hasDescendants},get instance(){return this.__instance},set instance(e){e&&this.instance.extend(e)},get isValue(){return!1},get isProperty(){return!1},get isContainer(){return!1},get isList(){return!1},get isElement(){return!1},get isComplex(){return!1},get isSimple(){return!1},get isContinuous(){return!1},get elementType(){return this},__id:null,get id(){return this.__id},__sourceId:null,get sourceId(){return this.__sourceId},get shortId(){return this.__alias||this.__id},__alias:null,get alias(){return this.__alias},__isAbstract:!0,get isAbstract(){return this.__isAbstract},get mixins(){var e=this.instance.constructor;if(e){var t=e.mixins;if(t)return t.map(function(e){return e.type}).filter(function(e){return e instanceof C})}return[]},set mixins(e){function n(e){var n=t.resolveType(e);i.mix(n)}if(e){var i=this.instance.constructor;Array.isArray(e)?e.forEach(n,this):n.call(this,e)}},__label:"instance",__labelIsSet:!1,get label(){return this.__label},set label(e){e=d.nonEmptyString(e),null===e?(this.__labelIsSet=!1,this!==b&&(e=d.nonEmptyString(this._getLabelDefault()),null==e?delete this.__label:this.__label=e)):(this.__labelIsSet=!0,this.__label=e)},_getLabelDefault:function(){},get _isLabelSet(){return!0===l.getOwn(this,"__labelIsSet")},__application:{},get application(){return this.__application},set application(e){p.merge(this.__application,e)},__description:null,get description(){return this.__description},set description(e){void 0===e?this!==b&&delete this.__description:this.__description=d.nonEmptyString(e)},__category:null,get category(){return this.__category},set category(e){void 0===e?this!==b&&delete this.__category:this.__category=d.nonEmptyString(e)},__helpUrl:null,get helpUrl(){return this.__helpUrl},set helpUrl(e){void 0===e?this!==b&&delete this.__helpUrl:this.__helpUrl=d.nonEmptyString(e)},__isBrowsable:!0,get isBrowsable(){return this.__isBrowsable},set isBrowsable(e){null==e?this!==b&&delete this.__isBrowsable:this.__isBrowsable=!!e},__isAdvanced:!1,get isAdvanced(){return this.__isAdvanced},set isAdvanced(e){null==e?this!==b&&delete this.__isAdvanced:this.__isAdvanced=!!e},__ordinal:0,get ordinal(){return this.__ordinal},set ordinal(e){null==e?this!==b&&delete this.__ordinal:this.__ordinal=Math.floor(+e||0)},create:function(e,n){return t.resolveInstance(e,n,this)},createAsync:function(e,n){return t.resolveInstanceAsync(e,n,this)},__assertSubtype:function(e){if(!e.isSubtypeOf(this))throw s.operInvalid(r.format(r.structured.errors.instance.notOfExpectedBaseType,[this]));return e},__throwAbstractType:function(){throw s.operInvalid(r.format(r.structured.errors.instance.cannotCreateInstanceOfAbstractType,[this]))},_assertNoSubtypesAttribute:function(e){if(this.hasDescendants)throw s.operInvalid(r.get("errors.attributeLockedWhenTypeHasSubtypes",[e]))},is:function(e){return v.call(this.instance,e)},isSubtypeOf:function(e){return!!e&&(e===this||v.call(e,this))},to:function(e,t){return null==e?null:this.is(e)?e:this.create(e,t)},toSpec:function(e){var t=this.id;return null!==t?e&&e.noAlias?t:this.shortId:l.using(new n,this.toSpecInContext.bind(this,e||{}))},toSpecInContext:function(e){var t=this.id;return null!==t?e&&e.noAlias?t:this.shortId:(t=i.current.getIdOf(this),null!==t?t:this._toSpecInContextCore(e||{}))},_toSpecInContextCore:function(e){var t=i.current.add(this),n={id:t};return this._fillSpecInContext(n,e),n},toJSON:function(){return this.toSpec({isJson:!0})},_fillSpecInContext:function(e,t){var n=!1;t.isJson;this.isAbstract&&(n=!0,e.isAbstract=!0),this._isLabelSet&&(n=!0,e.label=this.__label);var i=this.mixins;return i.length&&(n=!0,e.mixins=i.map(function(e){return e.shortId})),y.forEach(function(t){var i="__"+t;l.hasOwn(this,i)&&(n=!0,e[t]=this[i])},this),this.__fillSpecInContextDynamicAttributes(e,t)&&(n=!0),n},toString:function(){return this.id||this.label||""},__dynamicAttrInfos:null,set dynamicAttributes(e){Object.keys(e).forEach(function(t){this.__defineDynamicAttribute(t,e[t])},this)},__defineDynamicAttribute:function(e,t){var n=t.cast,i=t.combine,r="__"+e,o=r+"On",a=this,s=l.getOwn(a,"__dynamicAttrInfos");s||(s=a.__dynamicAttrInfos=[]),s.push({name:e,spec:t});var u;!function(){u=t.value;var e;c.is(u)?(e=u,u=null,n&&(e=m.call(a,e,n,u))):(u=_.call(a,u,n,null),e=c.constant(u)),a[r]=u,a[o]=e}(),Object.defineProperty(a,e,{get:function(){return l.getOwn(this,r)},set:function(t){if(this!==a&&(this._assertNoSubtypesAttribute(e),null!=t)){var s;if(c.is(t))s=t,n&&(s=m.call(this,s,n,u));else{if(null==(t=_.call(this,t,n,null)))return;s=c.constant(t)}this[r]=t,this[o]=i(this[o],s)}}}),a[e+"On"]=function(e,t){return this[o].call(e,this,t)}},__fillSpecInContextDynamicAttributes:function(e,t){function n(o){if(o){o!==b&&n(Object.getPrototypeOf(o));var a=l.getOwn(o,"__dynamicAttrInfos");a&&a.forEach(function(n){r.__fillSpecInContextDynamicAttribute(e,n.name,n.spec.group,n.spec.localName,n.spec.toSpec,t)&&(i=!0)})}}var i=!1,r=this;return n(r),i},__fillSpecInContextDynamicAttribute:function(e,t,n,i,r,o){var a="__"+t,s=!1,u=l.getOwn(this,a);if(null!=u){var h;if(c.is(u)?o.isJson||(s=!0,h=u.valueOf()):(s=!0,h=r?r.call(this,u,o):u),s){var d;d=n?e[n]||(e[n]={}):e,d[i||t]=h}}return s}},{_subclassed:function(e,t,n,i){l.setConst(this.prototype,"__hasDescendants",!0);var r=i.instance.constructor;e._initInstCtor(r,t,i),n&&e.implementStatic(n)},_initInstCtor:function(e,t,n){l.setConst(e,"Type",this),this.call(this.prototype,t,n||{instance:e.prototype})}});return b=C.prototype,C}),define("pentaho/type/Instance",["pentaho/module!_","./InstanceType","./SpecificationScope","pentaho/module/metaService","pentaho/i18n!types","pentaho/lang/Base","pentaho/util/error","pentaho/util/object"],function(e,t,n,i,r,o,a,s){"use strict";var u=o.extend("pentaho.type.Instance",{constructor:function(){},extend_exclude:{_:1},__type:null,get $type(){return this.__type},set $type(e){e&&this.__type.extend(e)},toSpec:function(e){return s.using(new n,this.toSpecInContext.bind(this,e||{}))},toSpecInContext:function(e){throw a.notImplemented()},toJSON:function(){return this.toSpec({isJson:!0})}},{get type(){return this.prototype.$type},_extend:function(e,t,n,i){var r;return null==e&&(r=t&&t.$type)&&(e=r.sourceId||r.id||null)&&(e=e.toString()),this.base(e,t,n,i)},_subclassed:function(e,t,n,i){var r=e.name||e.displayName,o=r&&r+".Type",a=i?Object.create(i):{};a.instance=e.prototype,this.Type.extend(o,t&&t.$type,n&&n.$type,a),a=i?Object.create(i):{},(a.exclude||(a.exclude={})).$type=1,this.base(e,t,n,a)},localize:function(e){return this.implement(e)},configure:function(e){if(void 0===e){var t=this.type.id;if(null!==t){var n=i.get(t);null!==n&&null!==(e=n.config)&&(e={$type:e})}}return this.implement(e)}});return t._initInstCtor(u,{id:e.id}),u.localize({$type:r.structured.Instance}),u}),define("pentaho/action/States",[],function(){"use strict";var e={unstarted:1,init:2,will:4,do:8,did:16,canceled:32,failed:64,finished:128};return Object.freeze(e)}),define("pentaho/action/Execution",["module","pentaho/lang/Base","./States","pentaho/lang/ArgumentRequiredError","pentaho/lang/ArgumentInvalidTypeError","pentaho/lang/OperationInvalidError","pentaho/lang/UserError","pentaho/lang/RuntimeError","pentaho/debug","pentaho/debug/Levels","pentaho/util/logger"],function(e,t,n,i,r,o,a,s,u,l,c){"use strict";var h="This method can not be called after the 'will' phase.",d=n.unstarted|n.init|n.will|n.do,p=n.canceled|n.failed,f=n.did|p;return t.extend(e.id,{constructor:function(){this.__state=n.unstarted,this.__isInside=!1,this.__result=void 0,this.__error=null,this.__promiseControl=null},get isSync(){return this.action.constructor.isSync},get state(){return this.__state},__assertStates:function(e,t){if(0==(this.__state&e))throw new o(t)},get result(){return this.__result},get error(){return this.__error},get isUnstarted(){return this.__state===n.unstarted},get isSettled(){return 0!=(this.__state&f)},get isRejected(){return 0!=(this.__state&p)},get isCanceled(){return 0!=(this.__state&n.canceled)},get isFailed(){return 0!=(this.__state&n.failed)},get isExecuting(){return!(this.isUnstarted||this.isFinished)},get isDone(){return 0!=(this.__state&n.did)},get isFinished(){return 0!=(this.__state&n.finished)},get promise(){return this.__getPromiseControl().promise},__getPromiseControl:function(){return this.__promiseControl||(this.__promiseControl=this.__createPromiseControl())},__createPromiseControl:function(){var e={promise:null,resolve:null,reject:null};return this.isFinished?e.promise=this.isDone?Promise.resolve(this.result):Promise.reject(this.error):e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},execute:function(){if(this.__state>n.will)throw new o(h);return this.__callInside(function(){this.isSync?this.__executeSyncAction():this.__executeAsyncAction()}),this},executeWill:function(){if(this.__state>n.will)throw new o(h);return this.__callInside(function(){try{this.__executePhaseInit(),this.__executePhaseWill()}catch(e){this.__rejectOrLog(e)}}),this},__callInside:function(e){if(this.__isInside)throw new o("This method can not be called during execution.");this.__isInside=!0;var t=e.call(this);return this.__isInside=!1,t},_doDefault:function(){return null},done:function(e){return this.__assertStates(n.do,"The `done` method can only be called while in the 'do' state."),this.__result=e,this.__state=n.did,this},reject:function(e){this.__assertStates(d,"The `reject` method can only be called while in the 'init', 'will' or 'do' states.");var t=this.isExecuting;return this.__reject(e),t||this.__executePhaseFinally(),this},__executeSyncAction:function(){try{this.__executePhaseInit(),this.__executePhaseWill(),this.__executePhaseDo()}catch(e){this.__rejectOrLog(e)}this.__executePhaseFinally()},__executeAsyncAction:function(){var e;try{this.__executePhaseInit(),this.__executePhaseWill(),e=Promise.resolve(this.__executePhaseDo()).catch(this.__rejectOrLog.bind(this))}catch(e){this.__rejectOrLog(e)}var t=this.__callInside.bind(this,this.__executePhaseFinally);(e||Promise.resolve()).then(t,t)},__rejectOrLog:function(t){this.isSettled?t&&this.error===t||u.testLevel(l.warn,e)&&c.warn("Ignoring error occurred after being marked done: "+t):this.__reject(t)},__reject:function(e){var t=!1;e||(e="Canceled"),"string"==typeof e?e=new a(e):e instanceof Error?e instanceof a&&!(e instanceof s)||(t=!0):(e=new r("reason",["string","Error"],typeof e),t=!0),this.__state=t?n.failed:n.canceled,this.__error=e,this.__result=void 0},__executePhaseInit:function(){this.__state<n.init&&(this.__state=n.init,this._onPhaseInit())},__executePhaseWill:function(){if(this.__state<n.will){this.__state=n.will;var e=this._validate();null==e||0===e.length?(this._lockAction(),this._onPhaseWill()):this.__reject(e[0])}},_lockAction:function(){Object.freeze(this.action)},_validate:function(){return this.action.validate()},__executePhaseDo:function(){if(this.__state<n.do){this.__state=n.do;var e=this._onPhaseDo();return this.isSync?(this.isSettled||this._doDefault(),null):!e||this.isSettled?this.__executePhaseDoDefaultAsync():e.then(this.__executePhaseDoDefaultAsync.bind(this))}return null},__executePhaseDoDefaultAsync:function(){if(!this.isSettled){var e=this._doDefault();if(!this.isSettled)return e}return null},__executePhaseFinally:function(){if(this.__state<n.finished){this.isSettled||this.done();try{this._onPhaseFinally()}catch(t){u.testLevel(l.warn,e)&&c.warn("Ignoring error occurred during action finally phase: "+t+"\n Stack trace:\n"+t.stack)}this.__state|=n.finished;var t=this.__promiseControl;t&&(this.isDone?t.resolve(this.result):t.reject(this.error))}},_onPhaseInit:function(){},_onPhaseWill:function(){},_onPhaseDo:function(){return null},_onPhaseFinally:function(){}})}),define("pentaho/type/action/_transactionControl",[],function(){"use strict";function e(e){var n=t;n!==e&&(n&&n.__exitingAmbient(),t=e,e&&e.__enteringAmbient())}var t=null,n=[];return{get current(){return t},get currentScope(){var e=n;return e.length?e[e.length-1]:null},exitCurrent:function(){var e=t;t=null;for(var i=n,r=i.length;r--;){var o=i[r];if(o.transaction===e&&(i.splice(r,1),o.__exitLocal(),o.isRoot))break}},enterScope:function(t){n.push(t),e(t.transaction)},exitScope:function(){n.pop();var t=this.currentScope;e(t&&t.transaction)}}}),define("pentaho/type/ReferenceList",["module","pentaho/lang/Base"],function(e,t){"use strict";return t.Array.extend(e.id,{constructor:function(){},add:function(e,t){var n=this.length;return this.push({container:e,property:t||null}),this.length>n},remove:function(e,t){t||(t=null);for(var n=this.length;n--;){var i=this[n];if(i.container===e&&i.property===t)return this.splice(n,1),!0}return!1}})}),define("pentaho/type/action/ChangeRef",["module","../ReferenceList","pentaho/lang/Base"],function(e,t,n){"use strict";return n.extend(e.id,{constructor:function(e){this.target=e,this.__refsAdd=null,this.__refsRem=null,this.__refsCache=void 0},addReference:function(e,n){(null!==this.__refsRem&&this.__refsRem.remove(e,n)||(this.__refsAdd||(this.__refsAdd=t.to([]))).add(e,n))&&(this.__refsCache=void 0)},removeReference:function(e,n){(null!==this.__refsAdd&&this.__refsAdd.remove(e,n)||(this.__refsRem||(this.__refsRem=t.to([]))).add(e,n))&&(this.__refsCache=void 0)},get projectedReferences(){var e=this.__refsCache;return void 0===e&&(this.__refsCache=e=this.__updateReferences(this.target.__refs,!1)),e},apply:function(){var e=this.__refsCache;this.target.__refs=void 0===e?this.__updateReferences(this.target.__refs,!0):e},__updateReferences:function(e,n){var i=this.__refsRem,r=this.__refsAdd;if(i||r){e?n||(e=t.to(e.slice())):e=t.to([]);var o,a,s;if(i)for(o=-1,a=i.length;++o<a;)s=i[o],e.remove(s.container,s.property);if(r)for(o=-1,a=r.length;++o<a;)s=r[o],e.add(s.container,s.property)}return e}})}),define("pentaho/type/action/AbstractTransactionScope",["module","./_transactionControl","pentaho/lang/Base","pentaho/util/object","pentaho/util/error","pentaho/util/logger"],function(e,t,n,i,r,o){"use strict";return n.extend(e.id,{constructor:function(e){i.setConst(this,"transaction",e||null),i.setConst(this,"isRoot",!!e&&!e.__scopeCount),this.__isInside=!0,e&&e.__scopeEnter(),t.enterScope(this)},_assertInsideAndCurrent:function(){if(!this.__isInside)throw this.__getErrorNotInside();if(!this.isCurrent)throw this.__getErrorNotCurrent()},__getErrorNotInside:function(){return r.operInvalid("Scope has been exited from.")},__getErrorNotCurrent:function(){return r.operInvalid("Scope is not the current scope.")},get isInside(){return this.__isInside},get isCurrent(){return this.__isInside&&this===t.currentScope},using:function(e,t){try{return e.call(t,this)}finally{this.exit()}},exit:function(e){if(!i.getOwn(e,"sloppy",!1)){var t=this.__isInside?this.isCurrent?null:this.__getErrorNotCurrent():this.__getErrorNotInside();null!==t&&o.warn(t.message)}return this.__isInside&&this.__exit(),this},__exit:function(){this.__exitLocal(),this.transaction&&this.transaction.__scopeExit(),t.exitScope()},__exitLocal:function(){this.__isInside=!1},dispose:function(){this.exit({sloppy:!0})}})}),define("pentaho/type/action/TransactionScope",["module","./AbstractTransactionScope"],function(e,t){"use strict";return t.extend(e.id,{get canCommit(){return this.isRoot&&this.isCurrent&&!this.transaction.isSettled},acceptWill:function(){return this._assertInsideAndCurrent(),this.transaction.executeWill()},accept:function(){if(this._assertInsideAndCurrent(),this.canCommit){this.transaction.execute();var e=this.transaction.error;if(e)throw e}else this.exit();return this},reject:function(e){throw this._assertInsideAndCurrent(),this.transaction.reject(e||"Transaction canceled."),this.transaction.error},using:function(e,t){var n;try{n=e.call(t,this)}catch(e){if(!this.isCurrent)throw e;this.reject(e)}finally{this.dispose()}var i=this.transaction.error;if(i)throw i;return n}})}),define("pentaho/type/action/CommittedScope",["module","./AbstractTransactionScope"],function(e,t){"use strict";return t.extend(e.id,{constructor:function(){this.base(null)}})}),define("pentaho/type/action/TransactionRejectedError",["module","pentaho/lang/UserError","pentaho/util/object"],function(e,t,n){"use strict";return t.extend(e.id,{constructor:function(e){this.base("Transaction was rejected"),n.setConst(this,"reason",e)},get name(){return"TransactionRejectedError"}})}),define("pentaho/type/action/Transaction",["module","pentaho/action/Execution","pentaho/action/States","../action/_transactionControl","./ChangeRef","./TransactionScope","./CommittedScope","./TransactionRejectedError","pentaho/lang/SortedList","pentaho/util/object","pentaho/util/error"],function(e,t,n,i,r,o,a,s,u,l,c){"use strict";function h(e,t){return t._netOrder-e._netOrder}function d(){return++_}function p(e){return e.isCanceled}var f=[],_=1,m=t.extend(e.id,{constructor:function(){this.base(),this.__csetByUid={},this.__csets=[],this.__crefByUid={},this.__crefs=[],this.__isCurrent=!1,this.__scopeCount=0,this.__version=0,this.__commitInitQueue=null,this.__commitInitQueueSet=null,this.__commitInitChangeset=null,this.__commitInitRanSet=null,this.__action=null},__takeNextVersion:function(){return++this.__version},get version(){return this.__version},get isReadOnly(){return this.state>n.init},get action(){var e=this.__action;if(null===e)throw c.operInvalid("Action is not set.");return e},get isSync(){return!0},get target(){return this.action.target},getChangeset:function(e){return l.getOwn(this.__csetByUid,e,null)},__ensureChangeRef:function(e){var t=e.$uid,n=l.getOwn(this.__crefByUid,t);return n||(this.__crefByUid[t]=n=new r(e),this.__crefs.push(n)),n},__getChangeRef:function(e){return l.getOwn(this.__crefByUid,e,null)},getAmbientReferences:function(e){var t=l.getOwn(this.__crefByUid,e.$uid,null);return t&&t.projectedReferences||e.__refs},ensureChangeset:function(e){return l.getOwn(this.__csetByUid,e.$uid)||this.__createChangeset(e)},__createChangeset:function(e){if(this.isReadOnly)throw c.operInvalid("Transaction cannot change because it has already been previewed, committed or rejected.");var t=e._createChangeset(this);this.__csetByUid[e.$uid]=t,this.__csets.push(t),this.__isCurrent&&(e.__cset=t);var n=this.getAmbientReferences(e);return null!==n&&n.forEach(function(e){this.ensureChangeset(e.container).__onChildChangesetCreated(t,e.property)},this),t},__eachChangeset:function(e){for(var t=this.__csets,n=t.length,i=-1;++i<n;)e.call(this,t[i])},get isCurrent(){return this.__isCurrent},enter:function(){return new o(this)},__scopeEnter:function(){if(this.isSettled)throw c.operInvalid("The transaction is resolved.");if(!this.__scopeCount)for(var e,t=this.__csets,n=t.length,i=-1;++i<n;)if(e=t[i],e.targetVersion!==e.target.$version)throw this.reject(new s("Concurrency error.")),this.error;this.__scopeCount++},__scopeExit:function(){this.__scopeCount--},__enteringAmbient:function(){this.__eachChangeset(function(e){e.target.__cset=e}),this.__isCurrent=!0},__exitingAmbient:function(){this.__isCurrent=!1,this.__eachChangeset(function(e){e.target.__cset=null})},_onPhaseInit:function(){if(0!==this.version){if(this.__setupCommitInitQueue())for(var e,t,n,i=this.__commitInitQueue,r=this.__commitInitQueueSet,o=Object.create(null),a=this,s={isCanceled:p,interceptor:function(i,r,s,u){if(null===n&&(n=o[t.$uid]||(o[t.$uid]=[])),(n[u]||0)<e.transactionVersion)try{i.apply(r,s)}finally{a.isRejected||(n[u]=e.transactionVersion)}}};void 0!==(e=i.shift());){if(this.__action=e,t=e.target,delete r[t.$uid],this.__commitInitRanSet[t.$uid]=!0,this.__commitInitChangeset=e,n=null,t._onChangeInit(this,s),this.isRejected)return void this.__finalizeCommitInitQueue();this.__addParentsToCommitInitQueue(t)}this.__finalizeCommitInitQueue()}},__setupCommitInitQueue:function(){var e=this;this.__commitInitQueue=new u({comparer:h}),this.__commitInitQueueSet=Object.create(null),this.__commitInitRanSet=Object.create(null),this.__commitInitChangeset=null;var t=!1;return this.__csets.forEach(function(n){var i=!1;!t&&n.target._hasListeners("change","init")&&(t=!0),n.eachChildChangeset(function(){return i=!0,!1}),i||e.__addToCommitInitQueue(n)}),t},__finalizeCommitInitQueue:function(){this.__commitInitQueue=this.__commitInitQueueSet=this.__commitInitChangeset=this.__commitInitRanSet=null,this.__action=null},__addParentsToCommitInitQueue:function(e){var t=this.getAmbientReferences(e);if(null!==t)for(var n=t.length,i=-1;++i<n;){var r=t[i].container.__cset;null!==r&&this.__addToCommitInitQueue(r,!0)}},__addToCommitInitQueue:function(e,t){var n=e.target.$uid;this.__commitInitQueueSet[n]||!t&&this.__commitInitRanSet[n]||(this.__commitInitQueue.push(e),this.__commitInitQueueSet[n]=!0)},__onChangesetLocalVersionChangeDid:function(e){this.__commitInitChangeset!==e&&null!==this.__commitInitQueue&&this.__addToCommitInitQueue(e)},__onChangesetNetOrderChangeWill:function(e){var t=this.__commitInitQueue;if(null!==t&&this.__commitInitQueueSet[e.target.$uid]){var n=t.search(e);if(n>=0)return t.splice(n,1),this.__onChangesetNetOrderChangeDid.bind(this,e)}return null},__onChangesetNetOrderChangeDid:function(e){this.__commitInitQueue.push(e)},_validate:function(){for(var e=this.__csets,t=e.length,n=-1;++n<t;){this.__action=e[n];var i=this.base();if(null!=i)return this.__action=null,i}this.__action=null},_lockAction:function(){for(var e=this.__csets,t=e.length,n=-1;++n<t;)e[n].__setReadOnlyInternal()},_onPhaseWill:function(){for(var e=this.__csets,t=e.length,n=-1;++n<t&&(this.__action=e[n],this.target._onChangeWill(this),!this.isRejected););this.__action=null},_onPhaseDo:function(){var e=d();this.__crefs.forEach(function(e){e.apply()}),this.__eachChangeset(function(t){t._applyInternal(e)})},_onPhaseFinally:function(){this.__scopeCount&&(this.__scopeCount=0,this.__exitingAmbient(),i.exitCurrent()),f.push(this);var e=this;if(m.enterCommitted().using(function(){e.__eachChangeset(function(t){e.__action=t,e.target._onChangeFinally(e)})}),this.__action=null,f.pop()!==this)throw c.operInvalid("Unbalanced transaction exit commit finally.")}},{get current(){return i.current},enter:function(){return(i.current||new m).enter()},enterCommitted:function(){return new a},getChangesetsPending:function(e){var t=null,n=f.length;if(n>0)for(var i=-1,r=e.$uid;++i<n;){var o=f[i],a=o.getChangeset(r);null!==a&&(t||(t=[])).push(a)}return t}});return m}),define("pentaho/type/util",["pentaho/util/object"],function(e){"use strict";function t(e){return Array.isArray(e)?e:[e]}return{normalizeErrors:function(e){return e?t(e):null},combineErrors:function(e,n){return n&&(e?Array.isArray(n)?e.push.apply(e,n):e.push(n):e=t(n)),e||null},__fillSpecMethodInContext:function(t,n,i){var r,o=!1;return e.hasOwn(n,i)&&(r=n[i])&&(o=!0,t[i]=r.valueOf()),o}}}),
define("pentaho/type/ValidationError",["module","pentaho/lang/UserError"],function(e,t){"use strict";return t.extend(e.id,{get name(){return"ValidationError"}})}),define("pentaho/type/Value",["pentaho/module!_","./Instance","./action/Transaction","./util","./ValidationError","./SpecificationContext","pentaho/util/object","pentaho/util/arg","pentaho/util/error","pentaho/i18n!types"],function(e,t,n,i,r,o,a,s,u,l){"use strict";return t.extend({get $key(){return this.toString()},equals:function(e){return this===e||null!=e&&this.constructor===e.constructor&&this._equals(e)},_equals:function(e){return this.$key===e.$key},equalsContent:function(e){return!1},get $isValid(){return null==this.validate()},validate:function(){return null},assertValid:function(){var e=this.validate();if(null!=e)throw e[0]},configure:function(e){null!=e&&e!==this&&n.enter().using(function(t){this._configure(e),t.accept()},this)},_configure:function(e){if(this.$type.isReadOnly)throw new TypeError("Type '"+this.$type.id+"' is read-only.")},$type:{id:e.id,isAbstract:!0,get isValue(){return!0},get isEntity(){return!1},get isReadOnly(){return!1},areEqual:function(e,t){return null==e||null==t?null==e&&null==t:e.equals(t)},areEqualContent:function(e,t){return this.areEqual(e,t)&&e.equalsContent(t)},areEqualContentElements:function(e,t){var n=!0;return e.each(function(e,i){var r=t.at(i);if(!this.areEqualContent(e,r))return n=!1,!1},this),n},normalizeInstanceSpec:function(e){return null!=e?this._normalizeInstanceSpec(e):null},_normalizeInstanceSpec:function(e){return e},hasNormalizedInstanceSpecKeyData:function(e){return!1},_toSpecInContextCore:function(e){var t=o.current.add(this),n={id:t},i=Object.getPrototypeOf(this);return"pentaho/type/Complex"!==i.id&&(n.base=i.toSpecInContext(e)),this._fillSpecInContext(n,e),n}}},{},{isRoot:!0}).localize({$type:l.structured.Value}).configure()}),define("pentaho/type/Element",["pentaho/module!_","./Value","./action/Transaction","./_baseLoader","pentaho/i18n!types","pentaho/util/object","pentaho/util/error","pentaho/util/fun"],function(e,t,n,i,r,o,a,s){"use strict";function u(e,t){return e._?i.resolveInstance(e):t.create(e)}function l(e){return i.resolveInstance(e)}var c=null,h=t.extend({compare:function(e){return null==e?1:e===this||this.constructor!==e.constructor||this._equals(e)?0:this._compare(e)},_compare:function(e){return s.compare(this.$key,e.$key)},configureOrCreate:function(e){if(null==e||e===this)return this;var t;return n.enter().using(function(n){t=this._configureOrCreate(e),n.accept()},this),t},_configureOrCreate:function(e){var n=this.$type;if(e instanceof t){if(!(n.isEntity?this.equals(e):this.constructor===e.constructor))return e;if(n.isReadOnly)return this.equalsContent(e)?this:e}else{if(e=n._normalizeInstanceSpec(e),e._&&i.resolveType(e._).type!==n)return l(e);var r;if(n.isEntity&&n.hasNormalizedInstanceSpecKeyData(e)&&(r=u(e,n),!this.equals(r)))return r;if(n.isReadOnly)return r=n.createLike(this,e),this.equalsContent(r)?this:r}return this._configure(e),this},$type:{id:e.id,isAbstract:!0,get isElement(){return!0},__format:void 0,get format(){return this.__format},set format(e){null==e?this!==c&&delete this.__format:this.__format=e||{}},compareElements:function(e,t){return null==e?null==t?0:-1:e.compare(t)},__intersect:function(e,t){var n={};o.eachOwn(e,function(e){n[e.$key]=e});for(var i=this.isSimple,r=[],a={},s=-1,u=t.length;++s<u;){var l=t[s],c=l.$key,h=o.getOwn(n,c);if(h&&!o.hasOwn(a,c)){var d=!i||l.formatted?l:h;a[c]=d,r.push(d)}}return r},createLike:function(e,t){var n=e.toSpec();return o.eachOwn(t,function(e,t){void 0!==e&&(n[t]=e)}),e.$type.create(n)}}}).localize({$type:r.structured.Element}).configure();return c=h.type,h}),define("pentaho/type/mixins/Container",["module","pentaho/lang/Base","pentaho/lang/EventSource","../ReferenceList","../action/Transaction","pentaho/util/object"],function(e,t,n,i,r,o){"use strict";var a={errorHandler:function(e,t){t[0].reject(e)},isCanceled:function(e){return e.isCanceled}},s=1;return t.extend(e.id,{_initContainer:function(){o.setConst(this,"$uid",String(s++)),this.__version=0,this.__cset=null,this.__refs=null},clone:function(){var e=Object.create(Object.getPrototypeOf(this));return this._initClone(e),e},_initClone:function(e){e._initContainer()},get $references(){var e=r.current;return null!==e?e.getAmbientReferences(this):this.__refs},__addReference:function(e,t){(this.__refs||(this.__refs=i.to([]))).add(e,t)},get $version(){return this.__version},__setVersionInternal:function(e){this.__version=e},get $changeset(){return this.__cset},get $hasChanges(){return!!this.__cset&&this.__cset.hasChanges},__usingChangeset:function(e){var t=this.__cset;if(t)return e.call(this,t);var n=r.enter();return n.using(function(){t=n.transaction.ensureChangeset(this);var i=e.call(this,t);return n.accept(),i},this)},_onChangeInit:function(e,t){try{var n=e.action,i=n.eventName;this._emitGeneric(this,[e,n],i,"init",t)}catch(t){e.reject(t)}},_onChangeWill:function(e){var t=e.action,n=t.eventName;this._emitGeneric(this,[e,t],n,"will",a)},_onChangeFinally:function(e){var t=e.action,n=t.eventName;this._emitGeneric(this,[e,t],n,"finally")}}).implement(n)}),define("pentaho/action/Base",["pentaho/module!_","pentaho/lang/Base"],function(e,t){"use strict";return t.extend(e.id,{get eventName(){return this.constructor.id},validate:function(){return null},clone:function(){return new this.constructor}},{get isSync(){return!0}})}),define("pentaho/type/action/Change",["module","pentaho/action/Base"],function(e,t){"use strict";return t.extend(e.id,{get eventName(){return"change"}})}),define("pentaho/type/action/Changeset",["module","./Change","pentaho/util/error","pentaho/util/object"],function(e,t,n,i){"use strict";return t.extend(e.id,{constructor:function(e,t){if(!e)throw n.argRequired("transaction");if(!t)throw n.argRequired("target");i.setConst(this,"transaction",e),i.setConst(this,"target",t),this.__isReadOnly=!1,this.__targetVersion=t.$version,this._netOrder=0,this.__txnVersion=this.__txnVersionLocal=e.version,this.__txnVersionDirty=!1},__updateNetOrder:function(e){if(this._netOrder<e){this.__setNetOrder(e);var t=e+1;this.eachChildChangeset(function(e){e.__updateNetOrder(t)})}},_resetNetOrder:function(){this.__setNetOrder(this.__calculateNetOrder()),this.eachChildChangeset(function(e){e.__resetNetOrder()})},__setNetOrder:function(e){if(this._netOrder!==e){var t=this.transaction.__onChangesetNetOrderChangeWill(this);this._netOrder=e,null!==t&&t()}},__calculateNetOrder:function(){var e=0,t=this.transaction,n=t.getAmbientReferences(this.target);if(null!==n)for(var i=n.length;i--;){var r=n[i].container.__cset;null!==r&&r._netOrder>=e&&(e=r._netOrder)}return e+1},_assertWritable:function(){if(this.isReadOnly)throw n.operInvalid("Changeset is read-only.")},get isReadOnly(){return this.__isReadOnly},__setReadOnlyInternal:function(){this.__isReadOnly=!0},get targetVersion(){return this.__targetVersion},get transactionVersionLocal(){return this.__txnVersionLocal},get transactionVersion(){return this.__txnVersionDirty&&(this.__txnVersion=this.__calcCleanTransactionVersion(),this.__txnVersionDirty=!1),this.__txnVersion},__calcCleanTransactionVersion:function(){var e=this.__txnVersionLocal;return this.eachChildChangeset(function(t){var n=t.transactionVersion;n>e&&(e=n)}),e},_setTransactionVersion:function(e,t){e>this.__txnVersion&&(this.__txnVersion=e,this.__txnVersionDirty=!1,this.__notifyParentsTxnVersionDirty(t))},_setTransactionVersionLocal:function(e,t){e>this.__txnVersionLocal&&(this.__txnVersionLocal=e,this._setTransactionVersion(e,t),this.transaction.__onChangesetLocalVersionChangeDid(this))},__notifyParentsTxnVersionDirty:function(e){var t=this.transaction.getAmbientReferences(this.target);if(null!==t)for(var n=t.length,i=-1;++i<n;){var r=t[i].container.__cset;r!==e&&r.__onChildTxnVersionDirty()}},__onChildTxnVersionDirty:function(){this.__txnVersionDirty||(this.__txnVersionDirty=!0,this.__notifyParentsTxnVersionDirty(null))},clearChanges:function(){this._assertWritable(),this._clearChangesRecursive(null)},_clearChangesRecursive:function(e){var t=null!=e?e.transactionVersion:this.transaction.__takeNextVersion();this._setTransactionVersionLocal(t,e),this._clearChanges()},_applyInternal:function(e){var t=this.target;this._apply(t),t.__setVersionInternal(e)}})}),define("pentaho/type/action/PrimitiveChange",["module","./Change"],function(e,t){"use strict";return t.extend(e.id,{get transactionVersion(){return this.__txnVersion},_setTransactionVersion:function(e){this.__txnVersion=e},_prepare:function(e){},_cancel:function(e){}})}),define("pentaho/type/action/Add",["module","./PrimitiveChange"],function(e,t){"use strict";return t.extend(e.id,{constructor:function(e,t){this.element=e,this.index=t},get type(){return"add"},_prepare:function(e){var t=this.element;t.__addReference&&!e.target.$isBoundary&&e.__addComplexElement(t)},_cancel:function(e){var t=this.element;t.__addReference&&!e.target.$isBoundary&&e.__removeComplexElement(t)},_apply:function(e){var t=this.element;e.__elems.splice(this.index,0,t),e.__keys[t.$key]=t}},{get id(){return e.id}})}),define("pentaho/type/action/Remove",["module","./PrimitiveChange"],function(e,t){"use strict";return t.extend(e.id,{constructor:function(e,t){this.elements=e,this.index=t},get type(){return"remove"},_prepare:function(e){var t=e.target;if(!t.$isBoundary&&!t.$type.elementType.isSimple)for(var n=-1,i=this.elements,r=i.length;++n<r;)i[n].__addReference&&e.__removeComplexElement(i[n])},_cancel:function(e){var t=e.target;if(!t.$isBoundary&&!t.$type.elementType.isSimple)for(var n=-1,i=this.elements,r=i.length;++n<r;)i[n].__addReference&&e.__addComplexElement(i[n])},_apply:function(e){var t=this.elements;e.__elems.splice(this.index,t.length),t.forEach(function(t){delete e.__keys[t.$key]})}},{get id(){return e.id}})}),define("pentaho/type/action/Move",["module","./PrimitiveChange"],function(e,t){"use strict";return t.extend(e.id,{constructor:function(e,t,n){this.element=e,this.indexOld=t,this.indexNew=n},get type(){return"move"},_apply:function(e){e.__elems.splice(this.indexNew,0,e.__elems.splice(this.indexOld,1)[0])}},{get id(){return e.id}})}),define("pentaho/type/action/Sort",["module","./PrimitiveChange"],function(e,t){"use strict";return t.extend(e.id,{constructor:function(e){this.comparer=e},get type(){return"sort"},_apply:function(e){e.__elems.sort(this.comparer)}},{get id(){return e.id}})}),define("pentaho/type/action/Clear",["module","./PrimitiveChange"],function(e,t){"use strict";return t.extend(e.id,{get type(){return"clear"},_prepare:function(e){var t=e.target;if(!t.$isBoundary&&!t.$type.elementType.isSimple)for(var n=-1,i=t.__elems,r=i.length;++n<r;)i[n].__addReference&&e.__removeComplexElement(i[n])},_cancel:function(e){var t=e.target;if(!t.$isBoundary&&!t.$type.elementType.isSimple)for(var n=-1,i=t.__elems,r=i.length;++n<r;)i[n].__addReference&&e.__addComplexElement(i[n])},_apply:function(e){e.__elems=[],e.__keys={}}},{get id(){return e.id}})}),define("pentaho/type/action/ListChangeset",["module","./Changeset","./Add","./Remove","./Move","./Sort","./Clear","pentaho/util/arg","pentaho/util/object","pentaho/util/error"],function(e,t,n,i,r,o,a,s,u,l){"use strict";var c=t.extend(e.id,{constructor:function(e,t){this.base(e,t),this.__changesetByKey=Object.create(null),this.__primitiveChanges=[],this.__projMock=null,this.__lastClearIndex=-1},get type(){return"list"},get changes(){return this.__primitiveChanges},get hasChanges(){if(this.__primitiveChanges.length>0)return!0;var e=this.__changesetByKey;for(var t in e)if(u.hasOwn(e,t)&&e[t].hasChanges)return!0;return!1},getChange:function(e){return u.getOwn(this.__changesetByKey,e)||null},compose:function(e){if(!(e instanceof c))throw l.argInvalidType("changeset","pentaho.type.action.ListChangeset",typeof e);if(e===this)throw l.argInvalid("changeset","Changeset is equal to itself.");var t=e.target;if(t!==this.target)throw l.argInvalid("changeset.target","Cannot compose with a changeset which has a different target.");var n=e.targetVersion;if(n<this.targetVersion)throw l.argInvalid("changeset.targetVersion","Cannot compose with a changeset which has a previous target version.");var i=e.transaction,r=new c(i,t);r.__targetVersion=n,r.__setReadOnlyInternal();var o,a=u.assignOwn({},this.__changesetByKey);for(o in a)u.hasOwn(a,o)&&(r.__changesetByKey[o]=a[o]);r.__primitiveChanges=this.__primitiveChanges.slice();var s=u.assignOwn({},e.__changesetByKey);for(o in s)if(u.hasOwn(s,o)){var h=s[o],d=r.__changesetByKey[o];r.__changesetByKey[o]=null!=d?d.compose(h):h}for(var p=e.__primitiveChanges.slice(),f=-1,_=p.length;++f<_;){var m=p[f];r.__primitiveChanges.push(m),m._prepare(r)}return r},_clearChanges:function(){this.__primitiveChanges.forEach(function(e){e._cancel(this)},this);var e=this.__changesetByKey;for(var t in e)u.hasOwn(e,t)&&e[t]._clearChangesRecursive(this);this.__primitiveChanges=[],this.__projMock=null,this.__lastClearIndex=-1},__addComplexElement:function(e){var t=this.isReadOnly;t||this.transaction.__ensureChangeRef(e).addReference(this.target);var n=e.__cset;null!==n&&(this.__changesetByKey[e.$key]=n,t||n.__updateNetOrder(this._netOrder+1))},__removeComplexElement:function(e){var t=this.isReadOnly;t||this.transaction.__ensureChangeRef(e).removeReference(this.target);var n=e.__cset;null!==n&&(delete this.__changesetByKey[e.$key],t||n._resetNetOrder())},eachChildChangeset:function(e,t){var n=this.__changesetByKey;for(var i in n)if(u.hasOwn(n,i)&&!1===e.call(t,n[i]))return},__onChildChangesetCreated:function(e,t){this.__changesetByKey[e.target.$key]=e,this._setTransactionVersion(e.transactionVersion),e.__updateNetOrder(this._netOrder+1)},get __projectedMock(){var e=this.__primitiveChanges.length;if(0===e)return this.target;var t=this.__projMock||(this.__projMock=this.target._cloneElementData({changeCount:0},!0));return t.changeCount<e&&(this.__applyFrom(t,t.changeCount),t.changeCount=e),t},_apply:function(e){if(e===this.target&&this.__projMock){var t=this.__projectedMock;this.__projMock=null,e.__elems=t.__elems,e.__keys=t.__keys}else this.__applyFrom(e,0)},__applyFrom:function(e,t){for(var n=this.__primitiveChanges,i=n.length,r=Math.max(this.__lastClearIndex,t);r<i;)n[r++]._apply(e)},__set:function(e,t,o,a,s,l){this._assertWritable();var c,h,d,p=this.__projectedMock,f=p.__elems,_=p.__keys,m=this.target.$type.elementType,g=this.target.$isReadOnly,y=this.target.__needReadOnlyElementValidation;l=null==l?f.length:l<0?Math.max(0,f.length+l):Math.min(l,f.length);for(var v=Array.isArray(e)?e.map(m.to,m):[m.to(e)],b={},C=[],O=[],x=-1,A=v.length;++x<A;)if(null!=(h=v[x]))if(d=h.$key,c=u.getOwn(_,d))if(o&&c!==h){b[d]=2;var j=c.configureOrCreate(h);j!==c&&t&&a&&(b[d]=4,O.push({value:j,to:O.length}))}else b[d]=1;else t&&!u.hasOwn(b,d)?(b[d]=3,O.push({value:h,to:O.length})):(v.splice(x,1),--A,--x);var w,T=0;for(x=-1,A=f.length;++x<A;)h=f[x],d=h.$key,u.hasOwn(b,d)&&4!==b[d]?(null==w&&(w=x-T),C.push(d)):a?(x<l&&--l,g&&this.target.__assertEditable(),this.__addChange(new i([h],x-T)),++T):C.push(d);if(null==w&&O.length>0&&(w=l),t)for(x=-1,A=O.length;++x<A;){var I=O[x],S=l+I.to;if(g&&this.target.__assertEditable(),y&&!I.value.$type.isReadOnly)throw new TypeError("List requires elements of a read-only type.");this.__addChange(new n(I.value,S)),C.splice(S,0,I.value.$key)}var R=0;if(s)for(x=-1,A=v.length;++x<A;)if(null!=(h=v[x])){var F=C.indexOf(h.$key);if(F<w&&--w,F<w+x||F<R){var M=Math.max(w+x,R);g&&this.target.__assertEditable(),this.__addChange(new r([h],F,M)),C.splice(M,0,C.splice(F,1)[0]),F=M}R=F}},__remove:function(e){this._assertWritable();for(var t,n,r=this.__projectedMock,o=this.target.$type.elementType,a=r.__elems,s=r.__keys,l=Array.isArray(e)?e.map(o.to,o):[o.to(e)],c={},h=[],d=-1,p=l.length;++d<p;)(t=l[d])&&(n=t.$key,!u.hasOwn(c,n)&&u.hasOwn(s,n)&&(c[n]=1,h.push({value:t,from:a.indexOf(t)})));if(p=h.length){this.target.__assertEditable(),h.sort(function(e,t){return t.from-e.from});var f,_;d=0;do{var m=h[d];f&&m.from===_-1||(f&&this.__addChange(new i(f,_)),f=[]),f.unshift(m.value),_=m.from}while(++d<p);f&&this.__addChange(new i(f,_))}},__removeAt:function(e,t){if(this._assertWritable(),!(t<0)){var n=this.__projectedMock;null==t&&(t=1);var r=n.__elems.length;if(!(e>=r)){e<0&&(e=Math.max(0,r+e)),this.target.__assertEditable();var o=n.__elems.slice(e,e+t);this.__addChange(new i(o,e))}}},__move:function(e,t){this._assertWritable();var n=this.target,i=n.__cast(e),o=n.get(i.$key);if(o){var a=n.indexOf(o),s=this.__projectedMock.__elems.length;t=t<0?Math.max(0,s+t):Math.min(t,s),a!==t&&(this.target.__assertEditable(),this.__addChange(new r(i,a,t)))}},__sort:function(e){this._assertWritable(),this.target.__assertEditable(),this.__addChange(new o(e))},__clear:function(){this._assertWritable(),0!==this.target.count&&(this.target.__assertEditable(),this.__lastClearIndex=this.__primitiveChanges.length,this.__addChange(new a))},__addChange:function(e){this.__primitiveChanges.push(e),e._prepare(this);var t=this.transaction.__takeNextVersion();e._setTransactionVersion(t),this._setTransactionVersionLocal(t)}},{get id(){return e.id}});return c}),define("pentaho/type/List",["pentaho/module!_","./Value","./Element","./mixins/Container","./action/ListChangeset","./util","./SpecificationContext","./_baseLoader","pentaho/i18n!types","pentaho/util/arg","pentaho/util/error","pentaho/util/object"],function(e,t,n,i,r,o,a,s,u,l,c,h){"use strict";var d,p=t.extend({constructor:function(e,t){if(this._initContainer(),this.__elems=[],this.__keys={},t&&(t.isBoundary&&(this.__isBoundary=!0),t.isReadOnly&&(this.__isReadOnly=!0),t.needReadOnlyElementValidation&&(this.__needReadOnlyElementValidation=!0)),null!=e){var n=d.__getElementSpecsFromInstanceSpec(e);null!=n&&this.__load(n)}},__load:function(e){for(var t,n,i=this.__isBoundary,r=-1,o=e.length,a=this.$type.elementType,s=this.__elems,u=this.__keys,l=this.__needReadOnlyElementValidation;++r<o;)if(null!=(t=a.to(e[r]))&&!h.hasOwn(u,n=t.$key)){if(l&&!t.$type.isReadOnly)throw new TypeError("List requires elements of a read-only type.");s.push(t),u[n]=t,!i&&t.__addReference&&t.__addReference(this)}},__needReadOnlyElementValidation:!1,__isReadOnly:!1,get $isReadOnly(){return this.__isReadOnly},__assertEditable:function(){if(this.__isReadOnly)throw new TypeError("The list is read-only.")},__isBoundary:!1,get $isBoundary(){return this.__isBoundary},_cloneElementData:function(e,t){var n=t?this:this.__projectedMock;return e.__elems=n.__elems.slice(),e.__keys=h.assignOwnDefined({},n.__keys),e},get __projectedMock(){var e;return(e=this.__cset)?e.__projectedMock:this},get $key(){return this.$uid},get count(){return this.__projectedMock.__elems.length},at:function(e){if(null==e)throw c.argRequired("index");return this.__projectedMock.__elems[e]||null},has:function(e){return null!=e&&null!=(e=this.__castKey(e))&&h.hasOwn(this.__projectedMock.__keys,e)},includes:function(e){return null!=e&&this.get(e.$key)===e},indexOf:function(e){return null!=e&&this.has(e.$key)?this.__projectedMock.__elems.indexOf(e):-1},get:function(e){return null!=e&&null!=(e=this.__castKey(e))?h.getOwn(this.__projectedMock.__keys,e,null):null},set:function(e,t){this.__set(e,!l.optional(t,"noAdd"),!l.optional(t,"noUpdate",!0),!l.optional(t,"noRemove"),!l.optional(t,"noMove"),l.optional(t,"index"))},add:function(e){this.__set(e,!0,!1,!1,!1)},insert:function(e,t){this.__set(e,!0,!1,!1,!1,t)},remove:function(e){this.__usingChangeset(function(t){t.__remove(e)})},move:function(e,t){this.__usingChangeset(function(n){n.__move(e,t)})},removeAt:function(e,t){this.__usingChangeset(function(n){n.__removeAt(e,t)})},sort:function(e){this.__usingChangeset(function(t){t.__sort(e)})},clear:function(){this.__usingChangeset(function(e){e.__clear()})},toArray:function(e,t){var n=this.__projectedMock.__elems;return e?n.map(e,t):n.slice()},each:function(e,t){for(var n=this.__projectedMock.__elems,i=n.length,r=-1;++r<i&&!1!==e.call(t,n[r],r,this););},__castKey:function(e){return e.toString()},__cast:function(e){return this.$type.__elemType.to(e)},_createChangeset:function(e){return new r(e,this)},__set:function(e,t,n,i,r,o){this.__usingChangeset(function(a){a.__set(e,t,n,i,r,o)})},_configure:function(e){e=this.$type._normalizeInstanceSpec(e);var t=e.d;if(null!=t)if(t.constructor===Object)h.eachOwn(t,function(e,t){if(null!=e){var n=this.get(t);if(null===n)throw c.argInvalid("config","There is no element with key '"+t+"'.");var i=n._configureOrCreate(e);if(i!==n){var r=this.indexOf(n);this.removeAt(r,1),this.insert(i,r)}}},this);else{if(!Array.isArray(t))throw c.argInvalidType("config",["Array","Object","pentaho.type.List"],typeof e);this.set(t,{noUpdate:!1})}},toSpecInContext:function(e){e=e?Object.create(e):{};var t,n,i=this.$type,r=!!e.forceType||!!(t=e.declaredType)&&i!==t;if(this.count){e.forceType=!1;var o=i.elementType;n=this.toArray(function(t){return e.declaredType=o,t.toSpecInContext(e)})}else n=[];return r?{_:i.toSpecInContext(e),d:n}:n},validate:function(){return this.__projectedMock.__elems.reduce(function(e,t){return o.combineErrors(e,t.validate())},null)},$type:{_postInit:function(){this.base.apply(this,arguments),h.hasOwn(this,"__elemType")||(this.__elemType=this.__elemType)},id:e.id,get isList(){return!0},get isContainer(){return!0},__elemType:n.type,get elementType(){return this.__elemType},get of(){return this.__elemType},set of(e){if(void 0!==e){if(!e)throw c.argRequired("of");var t=s.resolveType(e).type,n=this.__elemType;if(h.hasOwn(this,"__elemType")){if(t!==n)throw c.operInvalid("Property 'of' cannot change.")}else{if(t!==n&&!t.isSubtypeOf(n))throw c.argInvalid("of",u.structured.errors.list.elemTypeNotSubtypeOfBaseElemType);this.__elemType=t}}},_normalizeInstanceSpec:function(e){if(e.constructor===Object)return e;if(Array.isArray(e))return{d:e};if(e instanceof p)return{d:e.__elems};throw c.argInvalidType("instSpec",["Array","Object","pentaho.type.List"],typeof e)},__getElementSpecsFromInstanceSpec:function(e){if(Array.isArray(e))return e;if(e.constructor===Object)return Array.isArray(e.d)?e.d:null;if(e instanceof p)return e.__elems;throw c.argInvalidType("instSpec",["Array","Object","pentaho.type.List"],typeof e)},_toSpecInContextCore:function(e){var t=this.ancestor,n={id:null,base:t.toSpecInContext(e)};if(this.__elemType!==t.__elemType&&(n.of=this.__elemType.toSpecInContext(e)),!this._fillSpecInContext(n,e)&&"list"===n.base){return[n.of||this.__elemType.toSpecInContext(e)]}return n.id=a.current.add(this),n}}}).implement(i).implement({_initClone:function(e){this.base(e),this._cloneElementData(e)}}).localize({$type:u.structured.List}).configure();return d=p.type,p}),define("pentaho/type/mixins/DiscreteDomain",["pentaho/module!_","../Instance","../ValidationError","pentaho/util/object","pentaho/i18n!../i18n/types"],function(e,t,n,i,r){"use strict";return t.extend({$type:{id:e.id,dynamicAttributes:{domain:{value:function(e){var t=e.valueType.elementType.domain;return t?t.toArray():null},cast:function(e){return Array.isArray(e)||(e=[e]),e.map(function(e){return this.to(e)},this.valueType.elementType)},combine:function(e,t){return function(n,i){var r=e.call(this,n,i);if(r&&!r.length)return r;var o=t.call(this,n,i);return o?r&&o.length?n.valueType.elementType.__intersect(r,o):o:r}},toSpec:function(e,t){return t.declaredType=this.valueType,e.map(function(e){return e.toSpecInContext(t)})}}},_collectElementValidators:function(e,t){this.base.apply(this,arguments);var o=this.domainOn(t);if(o){var a={};o.forEach(function(e){a[e.$key]=e});var s=this;e(function(e,t){if(!i.hasOwn(a,t.$key))return new n(r.get("errors.discreteDomain.notInDomain",[t.toString(),s.label]))})}}}}).configure()}),define("pentaho/type/Property",["pentaho/module!_","./Instance","./Value","./mixins/DiscreteDomain","./util","./ValidationError","./_baseLoader","pentaho/i18n!types","pentaho/util/arg","pentaho/util/error","pentaho/util/object","pentaho/util/text","pentaho/util/fun"],function(e,t,n,i,r,o,a,s,u,l,c,h,d){"use strict";function p(e){if(e=+e,!(isNaN(e)||e<0))return Math.floor(e)}var f,_=t.extend({$type:{id:e.id,isAbstract:!0,styleClass:null,__label:null,__description:null,extend_order:["name","label","valueType"],__isConstructing:!1,_init:function(e,t){e=this.base(e,t)||e,this.__isConstructing=!0;var n=e.valueType,i=t&&t.declaringType;return i?(c.setConst(this,"__declaringType",i),this.isRoot?(c.setConst(this,"__index",t.index||0),this.__setName(e.name),this.__setIsReadOnly(i.isReadOnly||e.isReadOnly),n||this.__valueType!==f.__valueType||(n="pentaho/type/String")):e.name&&this.__setName(e.name)):null===this.declaringType&&this.__setIsReadOnly(e.isReadOnly),null!=n&&this.__setValueType(n),e},_postInit:function(){this.base.apply(this,arguments),this.isRoot&&(c.hasOwn(this,"__valueType")||this.__assertValueTypeReadOnlyConsistent(this.valueType),this._isLabelSet||(this.label=null),this.__createValueAccessor()),this.__isConstructing=!1},elemName:"property",keyName:"name",get key(){return this.__name},get isProperty(){return!0},__declaringType:null,get declaringType(){return this.__declaringType},get index(){return this.__index},__name:void 0,get name(){return this.__name},__setName:function(e){if(!(e=h.nonEmptyString(e)))throw l.argRequired("name");if(this.isRoot)c.setConst(this,"__name",e);else if(e&&e!==this.__name)throw new TypeError("Sub-properties cannot change the 'name' attribute.")},__nameAlias:void 0,get nameAlias(){return this.__nameAlias},set nameAlias(e){if(!this.isRoot)throw new TypeError("The 'nameAlias' attribute can only be assigned to a root property.");if(!(e=h.nonEmptyString(e)))throw l.argRequired("nameAlias");c.setConst(this,"__nameAlias",e)},get isList(){return this.__valueType.isList},__isReadOnly:!1,get isReadOnly(){return this.__isReadOnly},__setIsReadOnly:function(e){!this.__isReadOnly&&e&&c.setConst(this,"__isReadOnly",!0)},__valueType:void 0,get valueType(){return this.__valueType},__setValueType:function(e){if(null!=e){var t=this.__valueType,n=this.isRoot?c.getOwn(this,"__valueType"):t,i=a.resolveType(e,{defaultBase:n}).type;if(i!==t){if(t&&!i.isSubtypeOf(t))throw l.argInvalid("valueType",s.structured.errors.property.valueTypeNotSubtypeOfBaseType);this.__assertValueTypeReadOnlyConsistent(i),this.__valueType=i,d.is(this.__defaultValue)||(this.__defaultValue=null,this.__defaultValueFun=null)}}},__assertValueTypeReadOnlyConsistent:function(e){this.__needReadOnlyElementValidation=!1;var t=this.declaringType;if(null!==t&&t.isReadOnly){var n=e.elementType;if(!e.elementType.isReadOnly){if(!n.isAbstract)throw l.argInvalid("valueType",s.structured.errors.property.valueTypeNotReadOnly);this.__needReadOnlyElementValidation=!0}}},__defaultValue:null,__defaultValueFun:null,get defaultValue(){return this.__defaultValue},set defaultValue(e){if(this._assertNoSubtypesAttribute("defaultValue"),void 0===e)this!==f&&(c.hasOwn(this,"__valueType")?(this.__defaultValue=null,this.__defaultValueFun=null):(delete this.__defaultValue,delete this.__defaultValueFun));else{var t;null===e?t=null:d.is(e)?t=function(t){return t.toValueOn(null,e.apply(this,arguments))}:(e=this.toValueOn(null,e),t=d.constant(e)),this.__defaultValue=e,this.__defaultValueFun=t}},toValueOn:function(e,t){if(this.isList)return null==t&&e&&(t=this.defaultValueOn(e)),this.__valueType.create(t,this.__listCreateKeyArgs||this.__buildListCreateKeyArgs());var n;if(null!==(n=null==t?e?this.defaultValueOn(e):null:this.__valueType.to(t))&&this.__needReadOnlyElementValidation&&!n.$type.isReadOnly)throw new TypeError("Property '"+this.label+"' requires a value of a read-only type.");return n},defaultValueOn:function(e){var t=this.__defaultValueFun;return t?t.call(e,this):this.isList?this.__valueType.create(null):t},__listCreateKeyArgs:null,__buildListCreateKeyArgs:function(){return this.__listCreateKeyArgs={isBoundary:this.__isBoundary,isReadOnly:this.__isReadOnly,needReadOnlyElementValidation:this.__needReadOnlyElementValidation}},_getLabelDefault:function(){if(this.isRoot)return h.titleFromName(this.name)},__isBoundary:!1,get isBoundary(){return this.__isBoundary},set isBoundary(e){if(this!==f){if(!this.isRoot)throw l.operInvalid("Cannot only change the isBoundary attribute on a root property type.");this._assertNoSubtypesAttribute("isBoundary"),null!=e&&(this.__isBoundary=!!e)}},__createValueAccessor:function(){var e=this.__declaringType.instance,t=this.__name;t in e||Object.defineProperty(e,t,{configurable:!0,get:function(){return this.getv(t)},set:function(e){this.set(t,e)}})},validateOn:function(e){var t=null;if(this.isApplicableOn(e)){var n=function(e){t=r.combineErrors(t,e)},i=e.__getAmbientByType(this);i&&(this.isBoundary||n(i.validate()),n(this._validateValueOn(e,i)));var a=this.countRangeOn(e),u=this.isList?i.count:i?1:0;u<a.min?n(this.isList?new o(s.get("errors.property.countOutOfRange",[this.label,u,a.min,a.max])):new o(s.get("errors.property.isRequired",[this.label]))):u>a.max&&n(new o(s.get("errors.property.countOutOfRange",[this.label,u,a.min,a.max])))}return t},_validateValueOn:function(e,t){var n=null;if(!this.isList||t.count>0){var i=null,o=function(e){(i||(i=[])).push(e)};if(this._collectElementValidators(o,e,t),i){var a=function(t,o){i.forEach(function(i){n=r.combineErrors(n,i.call(this,e,t,o))})};this.isList?t.each(a,this):a.call(this,t,0)}}return n},_collectElementValidators:function(e,t,n){},_toSpecInContextCore:function(e){e||(e={});var t,i={},r=this.__valueType.toSpecInContext(e);if(this.__declaringType){var o=0;if(this.isRoot&&(t=Object.getPrototypeOf(this))!==f&&(i.base=t.toSpecInContext(e),o++),i.name=this.__name,o++,"pentaho/type/String"!==this.__valueType.id&&(i.valueType=r,o++),!this._fillSpecInContext(i,e)&&1===o)return this.__name}else t=Object.getPrototypeOf(this),i.base=t.toSpecInContext(e),this.__valueType!==n.type&&(i.valueType=r),this._fillSpecInContext(i,e);return i},_fillSpecInContext:function(e,t){var n=this.base(e,t),i=c.getOwn(this,"__defaultValue");void 0!==i&&(i?d.is(i)?t.isJson||(n=!0,e.defaultValue=i.valueOf()):(n=!0,t.declaredType=this.__valueType,e.defaultValue=i.toSpecInContext(t)):c.hasOwn(this,"__valueType")||(n=!0,e.defaultValue=null));var r=c.getOwn(this,"__isReadOnly");return void 0!==r&&(n=!0,e.isReadOnly=r),n}}},{$type:{_extend:function(e,t,n,i){return"string"==typeof t&&(t={name:t}),this.base(e,t,n,i)}}}).implement({$type:{dynamicAttributes:{isRequired:{value:!1,cast:Boolean,combine:function(e,t){return function(n,i){return e.call(this,n,i)||t.call(this,n,i)}}},countMin:{value:0,cast:p,combine:function(e,t){return function(n,i){return Math.max(e.call(this,n,i),t.call(this,n,i))}}},countMax:{value:1/0,cast:p,combine:function(e,t){return function(n,i){return Math.min(e.call(this,n,i),t.call(this,n,i))}}},isApplicable:{value:!0,cast:Boolean,combine:function(e,t){return function(n,i){return e.call(this,n,i)&&t.call(this,n,i)}}},isEnabled:{value:!0,cast:Boolean,combine:function(e,t){return function(n,i){return e.call(this,n,i)&&t.call(this,n,i)}}}},countRangeOn:function(e){var t=this.isRequiredOn(e),n=this.countMinOn(e),i=this.countMaxOn(e);return this.isList||(n>1&&(n=1),i>1&&(i=1)),t&&n<1&&(n=1),i<n&&(i=n),{min:n,max:i}}}}).implement({$type:{mixins:[i]}}).configure();return f=_.type,f.__setValueType(n),_}),define("pentaho/type/PropertyTypeCollection",["module","./Property","./_baseLoader","pentaho/lang/Collection","pentaho/util/arg","pentaho/util/error","pentaho/util/object"],function(e,t,n,i,r,o,a){"use strict";function s(e){return"string"==typeof e?e:e.name}var u=t.type;return i.extend(e.id,{constructor:function(e){if(!e)throw o.argRequired("declaringType");this.__cachedKeyArgs={declaringType:e,index:-1,isRoot:!1},this.__propTypesByAlias=Object.create(null);var t=e.ancestor,n=t.isComplex?t.__getProps():null;if(n){var i;this.length&&(i=this.slice(),this.length=0),this.base(),n.copyTo(this),i&&this.addMany(i)}else this.base()},copyTo:function(e){this.base(e),a.assignOwn(e.__propTypesByAlias,this.__propTypesByAlias)},
getByAlias:function(e){return a.getOwn(this.__propTypesByAlias,e,null)},get __declaringType(){return this.__cachedKeyArgs.declaringType},_adding:function(e,t,n){if(!e)throw o.argRequired("props[i]");var i,r=s(e);return r&&(i=this.get(r))?void(e!==r&&(i.declaringType===this.__declaringType?i.extend(e):this.replace(e,this.indexOf(i),n))):this.base.apply(this,arguments)},_replacing:function(e,t,n,i){if(!e)throw o.argRequired("props[i]");var r=s(e);if(r!==n.name)throw o.argInvalid("props[i]","Incorrect property name.");if(n.declaringType===this.__declaringType)return void(e!==r&&n.extend(e));var a;return i?(a=Object.create(i),a.declaringType=this.__declaringType):a=this.__cachedKeyArgs,n.instance.constructor.extend({$type:e},null,a).type},_added:function(e){this.base.apply(this,arguments);var t=e.nameAlias;null!==t&&(this.__propTypesByAlias[t]=e)},_replaced:function(e){this.base.apply(this,arguments);var t=e.nameAlias;null!==t&&(this.__propTypesByAlias[t]=e)},_cast:function(e,t,i){"string"==typeof e&&(e={name:e});var r,a=e.base;if(a){if(r=n.resolveType(a).type,!r.isSubtypeOf(u))throw o.argInvalid("props[i]","Property base type does not extend Property.")}else r=u;var s;i?(s=Object.create(i),s.declaringType=this.__declaringType):s=this.__cachedKeyArgs,s.index=t,s.isRoot=!0;var l=r.instance.constructor,c=l.extend({$type:e},null,s);return i||(s.index=-1,s.isRoot=!1),c.type},configure:function(e,t){if(!e)throw o.argRequired("config");Array.isArray(e)?this.addMany(e,t):a.eachOwn(e,function(e,n){if(e&&"object"==typeof e){var i=e.name;if(i){if(i!==n)throw o.argInvalid("config","Property name does not match object key.")}else e.name=n;this.add(e,t)}},this)}})}),define("pentaho/type/action/Replace",["module","./PrimitiveChange","pentaho/util/object"],function(e,t,n){"use strict";return t.extend(e.id,{constructor:function(e,t,i){n.setConst(this,"property",e),this.__value=t,this.__state=i},__updateValue:function(e,t,n){this._setTransactionVersion(e.transaction.__takeNextVersion()),this.__value!==t&&this.__replace(e,this.__value,t),this.__value=t,this.__state=n},_prepare:function(e){var t=this.property;t.isBoundary||t.valueType.isSimple||this.__replace(e,e.target.__getByName(t.name),this.__value)},_cancel:function(e){var t=this.property;t.isBoundary||t.valueType.isSimple||this.__replace(e,this.__value,e.target.__getByName(t.name))},__replace:function(e,t,n){t&&t.__addReference&&e.__removeComplexElement(t,this.property),n&&n.__addReference&&e.__addComplexElement(n,this.property)},get type(){return"replace"},get value(){return this.__value},get state(){return this.__state},_apply:function(e){var t=this.property.name;e.__values[t]=this.__value,e.__valuesState[t]=this.__state}},{get id(){return e.id}})}),define("pentaho/type/action/ComplexChangeset",["module","./Changeset","./Replace","pentaho/type/action/Transaction","pentaho/util/object","pentaho/util/error"],function(e,t,n,i,r,o){"use strict";function a(e){return!(e instanceof t)||e.hasChanges}var s=t.extend(e.id,{constructor:function(e,t){this.base(e,t),this._changes=Object.create(null)},get type(){return"complex"},get hasChanges(){var e=this._changes;for(var t in e)if(r.hasOwn(e,t)&&a(e[t]))return!0;return!1},getChange:function(e){return this.__getChange(this.__resolvePropertyName(e))},__getChange:function(e){return r.getOwn(this._changes,e,null)},hasChange:function(e){return this.__hasChange(this.__resolvePropertyName(e))},__hasChange:function(e){return r.hasOwn(this._changes,e)&&a(this._changes[e])},get propertyNames(){var e=this._changes;return Object.keys(e).filter(function(t){return a(e[t])})},__getByName:function(e){var n=this.__getChange(e);return null!==n?n instanceof t?n.target:n.value:this.target.__getByName(e)},__getStateByName:function(e){var n=this.__getChange(e);return null!==n?n instanceof t?1:n.state:this.target.__getStateByName(e)},getOld:function(e){var t=this.target.$type.get(e).name;return this.target.__getByName(t)},eachChildChangeset:function(e,n){var i=this._changes,o=this.transaction.isCurrent;for(var a in i)if(r.hasOwn(i,a)){var s=i[a];if(s instanceof t){if(!1===e.call(n,s))return}else{var u=s.value;if(null!==u&&u.__addReference&&null!==(s=o?u.__cset:this.transaction.getChangeset(u.$uid))&&!1===e.call(n,s))return}}},compose:function(e){if(!(e instanceof s))throw o.argInvalidType("changeset","pentaho.type.action.ComplexChangeset",typeof e);if(e===this)throw o.argInvalid("changeset","Changeset is equal to itself.");var n=e.target;if(n!==this.target)throw o.argInvalid("changeset.target","Cannot compose with a changeset which has a different target.");var i=e.targetVersion;if(i<this.targetVersion)throw o.argInvalid("changeset.targetVersion","Cannot compose with a changeset which has a previous target version.");var a=e.transaction,u=new s(a,n);u.__targetVersion=i,u.__setReadOnlyInternal();var l,c=r.assignOwn({},this._changes);for(l in c)r.hasOwn(c,l)&&(u._changes[l]=c[l]);var h=r.assignOwn({},e._changes);for(l in h)if(r.hasOwn(h,l)){var d=h[l],p=u._changes[l],f=null!=p&&p instanceof t;u._changes[l]=f&&d instanceof t?p.compose(d):d}return u},__onChildChangesetCreated:function(e,t){null===this.__getChange(t.name)&&(this._changes[t.name]=e,this._setTransactionVersion(e.transactionVersion)),e.__updateNetOrder(this._netOrder+1)},__setPrimitiveChange:function(e,t){this._changes[e]=t,t._prepare(this);var n=this.transaction.__takeNextVersion();t._setTransactionVersion(n),this._setTransactionVersionLocal(n)},__removePrimitiveChange:function(e){this._changes[e]._cancel(this),delete this._changes[e],this._setTransactionVersionLocal(this.transaction.__takeNextVersion())},__updateReplaceChange:function(e,t,n){var i=this._changes[e];i.__updateValue(this,t,n),this._setTransactionVersionLocal(i.transactionVersion)},__addComplexElement:function(e,t){if(!this.isReadOnly){this.transaction.__ensureChangeRef(e).addReference(this.target,t);var n=e.__cset;null!==n&&n.__updateNetOrder(this._netOrder+1)}},__removeComplexElement:function(e,t){if(!this.isReadOnly){this.transaction.__ensureChangeRef(e).removeReference(this.target,t);var n=e.__cset;null!==n&&n._resetNetOrder()}},__resolvePropertyName:function(e){return this.target.$type.get(e).name},_clearChanges:function(){var e=this._changes;for(var n in e)if(r.hasOwn(e,n)){var i=e[n];i instanceof t?i._clearChangesRecursive(this):(delete e[n],i._cancel(this))}},_apply:function(e){var n=this._changes;for(var i in n)if(r.hasOwn(n,i)){var o=n[i];o instanceof t?o.hasChanges&&(e.__valuesState[i]=1):o._apply(e)}}},{get id(){return e.id},__setElement:function(e,r,o,a){var s=e.$type,u=r.name,l=e.__getByName(u),c=e.__getStateByName(u),h=null==o?0:1,d=r.toValueOn(e,o),p=e.$changeset,f=null;null!==p&&null!==(f=p.__getChange(u))&&f instanceof t&&(f=null);var _=null!==f?f.value:l,m=null!==f?f.state:c,g=!a&&s.areEqual(d,_);if(h!==m||!g){if(r.isReadOnly)throw new TypeError("'"+u+"' is read-only.");if(null!==f)return void(h===c&&s.areEqual(d,l)?p.__removePrimitiveChange(u):p.__updateReplaceChange(u,g?_:d,h));var y=i.enter();null===p&&(p=y.transaction.ensureChangeset(e)),p.__setPrimitiveChange(u,new n(r,g?_:d,h,l)),y.accept()}}});return s}),define("pentaho/type/Simple",["require","pentaho/module!_","./Element","./util","pentaho/util/object","pentaho/util/error","pentaho/util/fun","pentaho/util/text","pentaho/i18n!types"],function(e,t,n,i,r,o,a,s,u){"use strict";var l=null,c=null,h=null,d=n.extend({constructor:function(e){var t,n;e instanceof Object?e.constructor===Object?(void 0===(t=e.value)&&(t=e.v),void 0===(n=e.formatted)&&(n=e.f)):e instanceof d?(t=e.value,n=e.formatted):t=e:t=e,r.setConst(this,"value",this.$type.toValue(t)),r.setConst(this,"formatted",s.nonEmptyString(n))},clone:function(){return new(0,this.constructor)(this)},valueOf:function(){return this.value},toString:function(){var e=this.formatted;return null!=e?e:String(this.value)},get $key(){return this.value.toString()},get $contentKey(){return this.$key+(null!==this.formatted?" ["+this.formatted+"]":"")},_equals:function(e){return this.value===e.value},equalsContent:function(e){return this.formatted===e.formatted},_compare:function(e){return this.$type.comparePrimitiveValues(this.value,e.value)},toSpecInContext:function(t){t||(t={});var n=!t.omitFormatted&&null!==this.formatted,i=this.$type,r=t.declaredType,o=!!t.forceType;!o&&r&&i!==r&&(null===c&&(c=e("pentaho/type/String").type,l=e("pentaho/type/Number").type,h=e("pentaho/type/Boolean").type),(!r.isAbstract||i!==c&&i!==l&&i!==h)&&(o=!0));var a;if(t.isJson){if(null==(a=this._toJSONValue(t)))return null}else a=this.value;if(a.constructor!==Object&&!n&&!o)return a;var s=o||r&&i!==r?{_:i.toSpecInContext(t),v:a}:{v:a};return n&&(s.f=this.formatted),s},_toJSONValue:function(e){return this.value},$type:{id:t.id,isAbstract:!0,get isSimple(){return!0},get isEntity(){return!0},get isReadOnly(){return!0},toValue:function(e){if(null==e)throw o.argRequired("value");if(null==(e=this.cast(e)))throw o.argInvalid("value",u.format(u.structured.errors.value.cannotConvertToType,[this.label]));return e},cast:function(e){return e},comparePrimitiveValues:function(e,t){return a.compare(e,t)},hasNormalizedInstanceSpecKeyData:function(e){return void 0!==e.value||void 0!==e.v},createLike:function(e,t){var n=t.formatted;return void 0===n&&void 0===(n=t.f)&&(n=e.formatted),new(0,e.constructor)({value:e.value,formatted:n})},_normalizeInstanceSpec:function(e){if(e instanceof Object){if(e.constructor===Object)return e;if(e instanceof d)return{value:e.value,formatted:e.formatted}}return{value:e}},_fillSpecInContext:function(e,t){var n=this.base(e,t);return t.isJson||(n=i.__fillSpecMethodInContext(e,this,"cast")||n),n}}}).localize({$type:u.structured.Simple}).configure();return d}),define("pentaho/type/String",["pentaho/module!_","./Simple","pentaho/i18n!types"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id,cast:String}}).localize({$type:n.structured.String}).configure()}),define("pentaho/type/Number",["pentaho/module!_","./Simple","pentaho/i18n!types"],function(e,t,n){"use strict";function i(e){return e=+e,isNaN(e)?null:e}return t.extend({$type:{id:e.id,cast:i,get isContinuous(){return!0}}}).localize({$type:n.structured.Number}).configure()}),define("pentaho/type/Boolean",["pentaho/module!_","./Simple","pentaho/i18n!types"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id,cast:Boolean}}).localize({$type:n.structured.Boolean}).configure()}),define("pentaho/type/Date",["pentaho/module!_","./Simple","pentaho/util/date","pentaho/i18n!types"],function(e,t,n,i){"use strict";return t.extend({get $key(){return this.value.toISOString()},_toJSONValue:function(e){return this.value.toJSON()},$type:{id:e.id,cast:function(e){return n.parseDateEcma262v7(e)},get isContinuous(){return!0}}}).localize({$type:i.structured.Date}).configure()}),define("pentaho/type/Object",["pentaho/module!_","./Simple","pentaho/util/object","pentaho/i18n!types"],function(e,t,n,i){"use strict";var r=1,o="__pentaho_type_ouid_"+Math.random().toString(32)+"__",a={value:"",configurable:!0,writable:!0,enumerable:!1};return t.extend({constructor:function(e){this.base(e);var t=n.getOwn(this.value,o);null==t&&(a.value=t=String(r++),Object.defineProperty(this.value,o,a)),this.__uid=t},get $key(){return this.__uid},$type:{id:e.id,cast:Object}}).localize({$type:i.structured.Object}).configure()}),define("pentaho/type/Function",["pentaho/module!_","./Simple","pentaho/util/object","pentaho/util/fun","pentaho/util/logger","pentaho/i18n!types"],function(e,t,n,i,r,o){"use strict";var a=1,s="__pentaho_type_ouid_"+Math.random().toString(32)+"__",u={value:"",configurable:!0,writable:!0,enumerable:!1};return t.extend({constructor:function(e){this.base(e);var t=n.getOwn(this.value,s);null==t&&(u.value=t=String(a++),Object.defineProperty(this.value,s,u)),this.__uid=t},get $key(){return this.__uid},_toJSONValue:function(e){var t=String(this.value);return t.indexOf("[native code]")>0&&(r.warn(o.structured.errors.json.cannotSerializeNativeFunction),t=null),t},$type:{id:e.id,cast:i.as}}).localize({$type:o.structured.Function}).configure()}),define("pentaho/type/TypeDescriptor",["pentaho/module!_","./Simple","./_baseLoader","pentaho/i18n!types"],function(e,t,n,i){"use strict";return t.extend({get $key(){return String(this.value.uid)},_toJSONValue:function(e){return this.value.toSpecInContext(e)},$type:{id:e.id,cast:function(e){return n.resolveType(e).type}}}).localize({$type:i.structured.TypeDescriptor}).configure()}),define("pentaho/type/standardSimple",["./Simple","./String","./Number","./Boolean","./Date","./Object","./Function","./TypeDescriptor"],function(){"use strict"}),define("pentaho/type/Complex",["pentaho/module!_","./Value","./Element","./Property","./PropertyTypeCollection","./util","./mixins/Container","./action/ComplexChangeset","pentaho/lang/UserError","pentaho/util/object","pentaho/util/error","pentaho/i18n!types","./List","./standardSimple"],function(e,t,n,i,r,o,a,s,u,l,c,h){"use strict";function d(e){this.$type.eachCommonWith(e.$type,function(t){var n=e.get(t.name);this._configureProperty(t,n)},this)}function p(e){var t=this.$type;e=t._normalizeInstanceSpec(e);var n;for(var i in e)if(l.hasOwn(e,i)&&"_"!==i&&void 0!==(n=e[i])){var r=t.get(i,!0);null===r&&null!==(r=t.__getByAlias(i))&&l.hasOwn(e,r.name)&&(r=null),null!==r&&this._configureProperty(r,n)}}function f(e,t,n){if(null===t||null===n)return void s.__setElement(this,e,n);(n=t._configureOrCreate(n))!==t&&s.__setElement(this,e,n,!0)}function _(e,t){return e[t.index]}function m(e,t){var n;return g.call(e,n=t.name)?e[n]:null!==(n=t.nameAlias)&&g.call(e,n)?e[n]:void 0}var g=Object.prototype.hasOwnProperty,y=1,v=t.type;return n.extend({constructor:function(e,t){this._initContainer(),this._initProperties(e)},_initProperties:function(e){var t=this.$type.__getProps(),n=t.length,i=e?Array.isArray(e)?_:m:void 0,r={},o={};this.__values=r,this.__valuesState=o;for(var a,s,u,l=-1;++l<n;)a=t[l],u=a.name,s=i&&i(e,a),o[u]=null==s?0:y,r[u]=s=a.toValueOn(this,s),null!=s&&s.__addReference&&this.__initPropertyValueRelation(a,s)},__initPropertyValueRelation:function(e,t){!e.isList&&e.isBoundary||t.__addReference(this,e)},get $key(){return this.$uid},equalsContent:function(e){var t=!0;return this.$type.each(function(n){var i=this.get(n),r=e.get(n);if(!(t=n.isList?v.areEqualContentElements(i,r):v.areEqualContent(i,r)))return!1},this),t},get:function(e,t){var n=this.$type.get(e,t);if(n)return this.__getAmbientByType(n)},isDefaultedOf:function(e){var t=this.$type.get(e);return 0===this.__getAmbientStateByType(t)},__getAmbientByType:function(e){return(e.isList?this:this.__cset||this).__getByName(e.name)},__getAmbientStateByType:function(e){return(this.__cset||this).__getStateByName(e.name)},__getByName:function(e){return this.__values[e]},__getStateByName:function(e){return this.__valuesState[e]},getv:function(e,t){var n=this.get(e,t);return n&&n.valueOf()},getf:function(e,t){var n=this.get(e,t);return n?n.toString():""},set:function(e,t){var n=this.$type.get(e);if(n.isList){var i=this.__getAmbientByType(n);if(i===t)return;if(null!=t&&null!=(t=i.$type.__getElementSpecsFromInstanceSpec(t)))return void i.set(t);i.clear()}else s.__setElement(this,n,t)},_configure:function(e){e instanceof t?d.call(this,e):p.call(this,e)},_configureProperty:function(e,t){var n=this.__getAmbientByType(e);n!==t&&(e.isList?null===t?n.clear():n._configure(t):f.call(this,e,n,t))},countOf:function(e,t){var n=this.$type.get(e,t);if(!n)return 0;var i=this.__getAmbientByType(n);return n.isList?i.count:i?1:0},isApplicableOf:function(e){return this.$type.get(e).isApplicableOn(this)},isEnabledOf:function(e){return this.$type.get(e).isEnabledOn(this)},countRangeOf:function(e){return this.$type.get(e).countRangeOn(this)},isRequiredOf:function(e){return this.$type.get(e).countRangeOn(this).min>0},domainOf:function(e){return this.$type.get(e).domainOn(this)},toSpecInContext:function(e){function t(t){var i=o?t.name:t.nameAlias;if(i||(i=t.name),!r||!0!==r[i]){var a=this.__getAmbientByType(t);if(u||this.__getAmbientStateByType(t)===y){var l;if(a){if(e.declaredType=t.valueType,null==(l=a.toSpecInContext(e))){if(!s)return;l=null}}else l=null;s?n.push(l):n[i]=l}else s&&n.push(null)}}e=e?Object.create(e):{};var n,i,r,o=!!e.noAlias,a=!!e.forceType||!!(i=e.declaredType)&&this.$type!==i,s=!a&&e.preferPropertyArray;s?n=[]:(n={},a&&(n._=this.$type.toSpecInContext(e)),r=e.omitProps,e.omitProps=null);var u=!!e.includeDefaults,l=this.$type;return e.forceType=!1,l.each(t,this),n},validate:function(){var e=null;return this.$type.each(function(t){e=o.combineErrors(e,t.validateOn(this))},this),e},$type:{_init:function(e,t){if(e=this.base(e,t)||e,!this.__isReadOnly&&e.isReadOnly){if(this.ancestor.count>0)throw c.argInvalid("isReadOnly");this.__isReadOnly=!0}return e},id:e.id,isAbstract:!0,get isComplex(){return!0},get isContainer(){return!0},__isEntity:!1,get isEntity(){return this.__isEntity},set isEntity(e){this._assertNoSubtypesAttribute("isEntity"),null!=e&&!this.__isEntity&&e&&(this.__isEntity=!0)},__isReadOnly:!1,get isReadOnly(){return this.__isReadOnly},__props:null,set props(e){this._configureProperties(e)},__getProps:function(){var e=this.constructor.prototype;return l.getOwn(e,"__props")||(e.__props=r.to([],this))},_configureProperties:function(e){this.__getProps().configure(e)},_normalizePropertiesSpec:function(e){if(Array.isArray(e))return e.map(function(e){return"string"==typeof e?{name:e}:e});var t=[];return l.eachOwn(e,function(e,n){e=Object.create(e),e.name=n,t.push(e)}),t},get:function(e,t){if(!e)throw c.argRequired("name");var n=this.__get(e);if(!n&&!t)throw c.argInvalid("name","A property with the name '"+(e.name||e)+"' is not defined.");return n},__get:function(e){var t;return e&&(t=this.__props)?"string"==typeof e?t.get(e):t.get(e.name)===e?e:null:null},__getByAlias:function(e){return null!==this.__props?this.__props.getByAlias(e):null},has:function(e){var t;return!(!e||!(t=this.__props))&&("string"==typeof e?t.has(e):t.get(e.name)===e)},at:function(e,t){if(null==e)throw c.argRequired("index");var n=this.__at(e);if(!n&&!t)throw c.argRange("index");return n},__at:function(e){var t=this.__props;return t&&t[e]||null},get count(){var e=this.__props;return e?e.length:0},each:function(e,t){var n,i=this.__props;if(i&&(n=i.length))for(var r=-1;++r<n&&!1!==e.call(t,i[r],r,this););return this},eachCommonWith:function(e,t,n){var i;return e.isComplex&&(i=l.lca(this,e))&&i.isComplex&&i.each(function(e,i){var r=e.name,o=this.get(r);if(!1===t.call(n,o,i,this))return!1},this),this},add:function(e){return Array.isArray(e)||(e=[e]),this._configureProperties(e),this},_fillSpecInContext:function(e,t){var n=this.base(e,t);if(l.hasOwn(this,"__isReadOnly")&&(n=!0,e.isReadOnly=this.isReadOnly),l.hasOwn(this,"__isEntity")&&(n=!0,e.isEntity=this.isEntity),this.count){var i;this.each(function(r){r.declaringType===this&&(i||(n=!0,i=e.props=[]),i.push(r.toSpecInContext(t)))},this)}return n}}}).implement(a).implement({_initClone:function(e){this.base(e);for(var t,n,i,r=this.$type.__getProps(),o=this.__cset||this,a=r.length,s={},u={};a--;)t=r[a],n=t.name,s[n]=i=t.isList?this.__getByName(n).clone():o.__getByName(n),u[n]=this.__valuesState[n],null!=i&&i.__addReference&&e.__initPropertyValueRelation(t,i);e.__values=s,e.__valuesState=u},_createChangeset:function(e){return new s(e,this)}}).localize({$type:h.structured.Complex}).configure()}),define("pentaho/type/mixins/Enum",["pentaho/module!_","../Simple","../List","../util","../ValidationError","../../i18n!../i18n/types","../../util/error"],function(e,t,n,i,r,o,a){"use strict";return t.extend({validate:function(){return i.combineErrors(this.base(),this.$type.__validateDomain(this))},$type:{id:e.id,_init:function(e,t){if(e=this.base(e,t)||e,!e.domain)throw a.argRequired("spec.domain");return e},__validateDomain:function(e){var t=this.__domain;return!t||t.has(e.$key)?null:new r(o.structured.errors.enum.notInDomain)},_fillSpecInContext:function(e,t){return this.base(e,t),t||(t={}),t.declaredType=this.$type,e.domain=this.__domain.toSpecInContext(t),!0},__domain:null,__domainPrimitive:null,get domain(){return this.__domain},set domain(e){if(null==e)throw a.argRequired("domain");if(this.__domain){if(e.constructor!==Object)throw a.argInvalidType("domain",["Object"],typeof e);this.__domain.configure({d:e})}else{var t=n.extend({$type:{of:this}});if(this.__domain=new t(e),this.__domainPrimitive=this.__domain.toArray(function(e){return e.value}),!this.__domain.count)throw a.argRequired("spec.domain")}},comparePrimitiveValues:function(e,t){var n=this.__domainPrimitive.indexOf(e),i=this.__domainPrimitive.indexOf(t);return n===i?0:n<0?-1:i<0?1:n-i}}},{_extend:function(){throw a.operInvalid("Enum types are final and cannot be subtyped.")}}).configure()}),define("pentaho/type/standard",["./Instance","./Value","./Element","./List","./Complex","./standardSimple","./Property","./mixins/Enum","./mixins/DiscreteDomain"],function(){"use strict"}),define("pentaho/type/loader",["./_baseLoader","./standard"],function(e){"use strict";return e}),define("pentaho/data/_ElementMock",["../lang/Base"],function(e){"use strict";return e.extend({constructor:function(e,t){this.table=e,this.rowIdx=t,this.$type={has:function(t){return null!=e.model.attributes.get(t)}}},getv:function(e){return this.table.getValue(this.rowIdx,this.table.getColumnIndexByAttribute(e))},getf:function(e){return this.table.getFormattedValue(this.rowIdx,this.table.getColumnIndexByAttribute(e))}})}),define("pentaho/data/AtomicTypeName",[],function(){return{STRING:"string",NUMBER:"number",BOOLEAN:"boolean",DATE:"date"}}),define("pentaho/data/_AbstractTable",["../lang/Base","./_ElementMock","./AtomicTypeName"],function(e,t,n){function i(e){var t=e.length;if(t)return function(n){for(var i=0;i<t;i++){var r=e[i],o=r.value;if(void 0!==o&&!this.isValueEqual(this.getValue(n,r.column),o))return!1}return!0}}function r(e){if(!o.hasOwnProperty(e))throw new Error("Unsupported data type");return o[e]}var o={};o[n.NUMBER]="numeric",o[n.STRING]="string",o[n.DATE]="date",o[n.BOOLEAN]="boolean";var a=e.extend("pentaho.data.AbstractTable",{isValueEqual:function(e,t){return e===t||null==e&&null==t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)},getColumnIndexByAttribute:function(e){if(e&&("string"==typeof e&&(e=this.model.attributes.get(e)),this.model.attributes.includes(e)))for(var t=-1,n=this.getNumberOfColumns();++t<n;)if(this.getColumnAttribute(t)===e)return t;return-1},getColumnIndexById:function(e){return this.getColumnIndexByAttribute(e)},getColumnProperty:function(e,t){var n=this.getColumnAttribute(e);if(n)return n.property(t)},getCellProperty:function(e,t,n){var i=this.getCell(e,t);if(i){var r=i.referent;if(r)return r.property(n)}},getColumnRange:function(e,t){for(var n,i,r=!1,o=t&&t.key,a=0,s=this.getNumberOfRows();a<s;){var u=this.getValue(a++,e);if(null!=u&&("number"!=typeof u||!isNaN(u))){if(o&&(null==(u=o(u))||isNaN(u)))continue;r?(u<n&&(n=u),u>i&&(i=u)):(n=i=u,r=!0)}}return{min:n,max:i}},getDistinctValues:function(e){return this._getDistinctValuesCore(e,!1)},getDistinctFormattedValues:function(e){return this._getDistinctValuesCore(e,!0)},_getDistinctValuesCore:function(e,t){for(var n,i,r=[],o={},a=0,s=this.getNumberOfRows(),u=t?this.getFormattedValue:this.getValue;a<s;)n=u.call(this,a++,e),i=typeof n+":"+n,1!==o[i]&&(o[i]=1,r.push(n));return r},getFilteredRows:function(e){var t=[],n=this.getNumberOfRows();if(n)for(var r=i.call(this,e),o=-1;++o<n;)r&&!r.call(this,o)||t.push(o);return t},filter:function(e){var n=[],i=this.getNumberOfRows();if(i>0)for(var r=e.compile(),o=new t(this,null),s=-1;++s<i;)o.rowIdx=s,r(o)&&n.push(s);var u=new a.core.TableView(this);return u.setSourceRows(n),u},filterMatchesRow:function(e,n){var i=new t(this,n);return e.contains(i)},toJsonCda:function(){for(var e,t,n,i,o=this.getNumberOfColumns(),a=this.getNumberOfRows(),s=new Array(o),u=new Array(a),l=o,c=a;l--;)s[l]={colIndex:l,colName:this.getColumnId(l),colLabel:this.getColumnLabel(l),colType:r(this.getColumnType(l)),colIsKey:this.isColumnKey(l)};for(;c--;)for(u[c]=t=new Array(o),l=o;l--;)e=this.getCell(c,l),n=e.value,i=e.label,t[l]=null==i?n:{v:n,f:i};return{metadata:s,resultset:u}}});return a}),define("pentaho/data/_OfAttribute",["../lang/Base","../util/arg"],function(e,t){return e.extend("pentaho.data._OfAttribute",{constructor:function(e){this._attr=t.required(e,"attribute")},get attribute(){return this._attr}})}),define("pentaho/lang/_Annotatable",["../lang/Base","../util/arg","../util/object"],function(e,t,n){return e.extend("pentaho.lang._Annotatable",{constructor:function(e){this._annots=t.optional(e,"p")},property:function(e,t){var i=this._annots;return arguments.length<2?i?n.getOwn(i,e):void 0:(i||(this._annots=i={}),i[e]=t,this)}},{configure:function(e,t){var n=t.p;if(n){var i=e._annots;Object.keys(n).forEach(function(t){i||(e._annots=i={}),i[t]=n[t]})}},toSpec:function(e,t){return t||(t={}),e._annots&&(t.p=n.cloneShallow(e._annots)),t}})}),define("pentaho/data/Member",["./_OfAttribute","../lang/Base","../lang/_Annotatable","../util/arg","../util/error","../util/object"],function(e,t,n,i,r,o){var a=t.extend("pentaho.data.Member",{constructor:function(e,t){this._ord=i.required(t,"ordinal","keyArgs"),this.value=e.v,this.label=e.f,n.call(this,e)},elemName:"member",keyName:"value",get key(){return this._key},get attribute(){throw new Error("abstract")},get ordinal(){return this._ord},get value(){return this.v},set value(e){if(null==e)throw r.argInvalid("value","Cannot be nully.");this.v=e,this._key=o.getSameTypeKey(e)},get label(){return this.f},set label(e){this.f=null==e?void 0:String(e)},toString:function(){var e;return null!=(e=this.f)?e:this.v.toString()},toSpec:function(){var e={v:this.v};return null!=this.f&&(e.f=this.f),n.toSpec(this,e),e}}).implement(n);return a.Adhoc=a.extend("pentaho.data.Member.Adhoc",{constructor:function(t,n){e.call(this,n),this.base(t,n)}}).implement(e),a}),define("pentaho/data/Cell",["./_OfAttribute","./Member","../lang/Base","../lang/_Annotatable","../util/error","../util/object"],function(e,t,n,i,r,o){var a=n.extend("pentaho.data.Cell",{constructor:function(e){null==e?this.value=null:"object"!=typeof e||e.constructor!==Object?this.value=e:(this.value=e.v,this.label=e.f,i.call(this,e))},elemName:"cell",keyName:"value",get key(){return this._key},get attribute(){throw new Error("abstract")},get value(){return this.v},set value(e){var t=this.attribute;e=t.cast(e);var n;if(null==e)this.v=null,n="";else{if(t.isContinuous)n=o.getSameTypeKey(e);else{n=t.members.getOrAdd("object"==typeof e?{v:e}:e).key}this.v=e}this._key=n},get isEmpty(){return null==this.v},get referent(){var e=this.v;return null==e?null:this.attribute.isContinuous?void 0:this.attribute.members.get(e)},set referent(e){if(this.attribute.isContinuous)throw new Error("Invalid operation");if(null==e)this.v=null;else{if(!this.attribute.members.includes(e))throw r.argInvalid("member","Not a member of the the cell's attribute.");this.v=e.value}},get label(){var e,t;return null==(e=this.f)&&(t=this.referent)?t.label:e},set label(e){this.f=null==e?void 0:String(e)},get formatted(){var e=this.label;return void 0!==e?e:null},set formatted(e){this.label=e},valueOf:function(){return this.v},toString:function(){var e;return null!=(e=this.label)?e:null!=(e=this.v)?e.toString():""},toSpec:function(){var e=null,t=this.v,n=this.f;return this._annots?(e={},null!=t&&(e.v=t),null!=n&&(e.f=n),e=i.toSpec(this,e)):null!=n?(e={},null!=t&&(e.v=t),e.f=n):null!=t&&(e=t),e}}).implement(i);return a.Adhoc=a.extend("pentaho.data.Cell.Adhoc",{constructor:function(t,n){e.call(this,n),this.base(t,n)}}).implement(e),a}),define("pentaho/data/StructurePosition",["./_OfAttribute","../lang/Base","../util/arg"],function(e,t,n){var i=t.extend("pentaho.data.StructurePosition",{constructor:function(e){this._ord=n.required(e,"ordinal","keyArgs")},elemName:"structure position",keyName:"name",get key(){return this._attr.key},get ordinal(){return this._ord},get attribute(){throw new Error("abstract")},toSpec:function(e){return this._attr&&(e||(e={}),e.attr=this._attr.name),e}});return i.Adhoc=i.extend("pentaho.data.StructurePosition.Adhoc",{constructor:function(t){e.call(this,t),this.base(t)}}).implement(e),i}),define("pentaho/data/MemberCollection",["./Member","../lang/Collection","../util/arg"],function(e,t,n){return t.extend("pentaho.data.MemberCollection",{constructor:function(e){this._attr=n.required(e,"attribute","keyArgs"),this.base()},elemClass:e,get attribute(){return this._attr},_cachedKeyArgs:null,_cast:function(e,t){var n=this._cachedKeyArgs||(this._cachedKeyArgs={ordinal:0});return n.ordinal=t,this._attr.toMemberOf(e,n)},getOrAdd:function(e){return this.get(e)||this.add(e)}})}),define("pentaho/data/Attribute",["./Cell","./Member","./StructurePosition","./MemberCollection","../lang/_Annotatable","../lang/Base","../util/arg","../util/error","../util/date"],function(e,t,n,i,r,o,a,s,u){function l(e,t){return"string"==typeof e?t.attributes.getExisting(e):e instanceof d?e:null}function c(e){if(null==e)return null;var t=Number(e);return isNaN(t)?null:t}function h(e){return e}var d=o.extend("pentaho.data.Attribute",{constructor:function(o,l){if("string"==typeof o&&(o={name:o}),this._ord=a.required(l,"ordinal","keyArgs"),this.name=o.name,!this.name)throw s.argRequired("spec.name");this.label=null!=o.label?o.label:void 0,this.format=o.format||null;var d=o.type;d?"datetime"===(d=d.toLowerCase())&&(d="date"):d="string",this.type=d,this.isContinuous="number"===d||"date"===d,this.isKey=!!o.isKey,this._cast="number"===d?c:"date"===d?u.parseDateEcma262v7:h;var p={attribute:this,ordinal:0};this.memberBase=new t.Adhoc({v:""},p),this.cellBase=new e.Adhoc({},p),this.structurePositionBase=new n.Adhoc(p),this.isContinuous?"number"===d&&(this.isPercent=null!=o.isPercent&&!!o.isPercent):(this.members=i.to(o.members||[],p),this.hierarchyName=o.hierarchyName||null,null===this.hierarchyName?this.hierarchyOrdinal=null:this.hierarchyOrdinal=+o.hierarchyOrdinal||0),r.call(this,o)},elemName:"attribute",keyName:"name",get key(){return this.name},get ordinal(){return this._ord},members:null,hierarchyName:null,hierarchyOrdinal:null,cast:function(e){return this._cast(e)},toMemberOf:function(e,n){if(null==e)throw s.argRequired("memberSpec");"object"!=typeof e&&(e={v:e});var i=Object.create(this.memberBase);return t.call(i,e,n),i},toCellOf:function(t){var n=Object.create(this.cellBase);return e.call(n,t),n},toStructurePositionOf:function(e){var t=Object.create(this.structurePositionBase);return n.call(t,e),t},toSpec:function(){var e={name:this.name,label:this.label,type:this.type,format:this.format,isKey:this.isKey};return this.isContinuous?e.isPercent=this.isPercent:(e.members=this.members.toSpec(),e.hierarchyName=this.hierarchyName,e.hierarchyOrdinal=this.hierarchyOrdinal),r.toSpec(this,e),e},toString:function(){return this.label||this.name}},{fromOfAttributeSpec:function(e,t){if(!e)return null;var n=l(e,t);return!n&&e.attr&&(n=l(e.attr,t)),n}}).implement(r);return d}),define("pentaho/data/AttributeCollection",["./Attribute","../lang/Collection"],function(e,t){return t.extend("pentaho.data.AttributeCollection",{elemClass:e,_cachedKeyArgs:null,_cast:function(t,n){var i=this._cachedKeyArgs||(this._cachedKeyArgs={ordinal:0});return i.ordinal=n,e.to(t,i)}})}),define("pentaho/data/Model",["./AttributeCollection","../lang/Base","../lang/_Annotatable"],function(e,t,n){return t.extend("pentaho.data.Model",{constructor:function(t){var i;t instanceof Array?(i=t,t=null):t&&t.constructor===Object&&(i=t.attrs),this.attributes=e.to(i),this.format=t&&t.format||null,n.call(this,t)},get keyAttributes(){return this.attributes.filter(function(e){return e.isKey})},get hasAnyKeyAttributes(){return this.attributes.some(function(e){return e.isKey})},toSpec:function(){var e={attrs:this.attributes.toSpec(),format:this.format};return n.toSpec(this,e)}}).implement(n)}),
define("pentaho/data/Structure",["./Attribute","./StructurePosition","../lang/Collection","../util/arg","../util/error","../util/object"],function(e,t,n,i,r,o){function a(e){return e.attribute}function s(e){return e.attribute.name}function u(e,t){if(!e)return null;var n=l(e,t);return!n&&e.attr&&(n=l(e.attr,t)),n}function l(t,n){return"string"==typeof t?n.attributes.getExisting(t):t instanceof e?t:null}var c=n.extend("pentaho.data.Structure",{constructor:function(e){this._model=i.required(e,"model","keyArgs"),this.base(e)},_cachedKeyArgs:null,elemClass:t,_cast:function(e,n,i){return t.to(e,this._buildKeyArgs(i,n))},_buildKeyArgs:function(e,t){if(e)return o.setPrototypeOf({model:this._model,ordinal:t},e);var n=this._cachedKeyArgs||(this._cachedKeyArgs={model:this._model,ordinal:0});return n.ordinal=t,n},getByOrdinalOrName:function(e,t){return"string"==typeof e?this.get(e,t):this[e]},ordinalOf:function(e){var t=this.get(e);return t?t.ordinal:-1},toSpec:function(e){return this.map(i.optional(e,"shareModel",!1)?a:s)}});return t.to=function(e,t){if(!e)throw r.argRequired("spec");var n=i.required(t,"model","keyArgs"),o=u(e,n);if(!o)throw r.argRequired("spec.attr");return o.toStructurePositionOf(t)},c}),define("pentaho/data/_plain/Row",["../../lang/Base","../../util/arg"],function(e,t){var n=e.extend("pentaho.data._plain.Row",{constructor:function(e,n){this.c=t.required(n,"rows").toCellTuple(e.c||[],n)},get cells(){return this.c},toSpec:function(){return{c:this.c.toSpec()}},_onStructurePositionAdded:function(){this.c._onStructurePositionAdded()}},{to:function(e,t){return e instanceof n?e:(e instanceof Array&&(e={c:e}),new this(e,t))}});return n}),define("pentaho/data/_WithStructure",["../lang/Base","../util/arg"],function(e,t){return e.extend("pentaho.data._WithStructure",{constructor:function(e){this._structure=t.required(e,"structure","keyArgs")},get structure(){return this._structure}})}),define("pentaho/data/CellTuple",["./Cell","./_WithStructure","../lang/List"],function(e,t,n){var i=n.extend("pentaho.data.CellTuple",{constructor:function(){this.base();for(var e=this.length,t=this.structure.length;e++<t;)this.add(null)},elemName:"CellTuple",keyName:"key",_key:null,get key(){var e=this._key;return null==e&&(e=this._key=this.map(function(e){return e.key}).join("~")),e},_label:null,get label(){var e=this._label;return null==e&&(e=this._label=this.map(function(e){return e.label}).join("~")),e},elemClass:e,_cast:function(e,t){var n=this.structure[t];if(!n)throw new Error("Cell tuple has out-of-bounds cells.");return n.attribute.toCellOf(e)},get structure(){throw new Error("abstract")},has:function(e){return null!=this.get(e,!1)},get:function(e,t){var n=this.structure.ordinalOf(e);if(n>=0)return this[n];if(t)throw new Error("A cell is not defined for attribute '"+e+"'.");return null},getByOrdinalOrName:function(e,t){return"string"==typeof e?this.get(e,t):this[e]},getExisting:function(e){return this.get(e,!0)},_onStructurePositionAdded:function(){this.add(null)}});return i.Adhoc=i.extend("pentaho.data.AdhocCellTuple",{constructor:function(e){t.call(this,e),this.base()}}).implement(t),i}),define("pentaho/data/_WithCellTupleBase",["./CellTuple","../lang/Base","../util/error","../util/object"],function(e,t,n,i){return t.extend("pentaho.data._WithCellTupleBase",{constructor:function(t){this.cellTupleBase=e.Adhoc.to([],t),this.cellTupleBase.constructor=e.Adhoc},toCellTuple:function(t,r){if(t instanceof e)return t;if(!(t instanceof Array))throw n.argInvalidType("cellSpecs","Array");var o=i.setPrototypeOf(t,this.cellTupleBase);return e.call(o,r),o}})}),define("pentaho/data/_plain/RowList",["./Row","../_WithStructure","../_WithCellTupleBase","../../lang/List","../../util/object"],function(e,t,n,i,r){return i.extend("pentaho.data._plain.RowList",{constructor:function(e){t.call(this,e),n.call(this,e),this.base(e)},elemName:"row",_cachedKeyArgs:null,elemClass:e,_cast:function(t,n,i){return e.to(t,this._buildKeyArgs(i))},_buildKeyArgs:function(e){return e?r.setPrototypeOf({rows:this},e):this._cachedKeyArgs||(this._cachedKeyArgs={rows:this})},_onStructurePositionAdded:function(){this.cellTupleBase._onStructurePositionAdded(),this.forEach(function(e){e._onStructurePositionAdded()})}}).implement(t,n)}),define("pentaho/data/_plain/Table",["../Structure","./RowList","../../lang/Base","../../util/arg","../../util/error"],function(e,t,n,i,r){return n.extend("pentaho.data._plain.Table",{constructor:function(n,o){if(!n)throw r.argRequired("spec");this.model=i.required(o,"model","keyArgs"),this.cols=e.to(n.cols||this.model.attributes.slice(),{model:this.model}),this.rows=t.to(n.rows||[],{structure:this.cols})},getCell:function(e,t){return this.rows[e].cells[t]},getNumberOfColumns:function(){return this.cols.length},getNumberOfRows:function(){return this.rows.length},getColumnAttribute:function(e){return this.cols[e].attribute},getColumnType:function(e){return this.getColumnAttribute(e).type},getColumnId:function(e){return this.getColumnAttribute(e).name},getColumnLabel:function(e){return this.getColumnAttribute(e).label},isColumnKey:function(e){return this.getColumnAttribute(e).isKey},getColumnHierarchyName:function(e){return this.getColumnAttribute(e).hierarchyName},getColumnHierarchyOrdinal:function(e){return this.getColumnAttribute(e).hierarchyOrdinal},getValue:function(e,t){return this.getCell(e,t).value},getValueKey:function(e,t){return this.getCell(e,t).key},getFormattedValue:function(e,t){return this.getCell(e,t).toString()},getLabel:function(e,t){return this.getCell(e,t).label},addColumn:function(e,t){var n=this.cols.add(e,t).ordinal;return this.rows._onStructurePositionAdded(),n},addRow:function(e,t){var n=this.rows.length;return this.rows.add(e,t),n},toSpec:function(e){return{cols:this.cols.toSpec(e),rows:this.rows.toSpec()}}})}),define("pentaho/data/_cross/AxisPosition",["../../lang/Base","../../util/arg"],function(e,t){return e.extend("pentaho.data._cross.AxisPosition",{constructor:function(e,n){this._cells=t.required(e,"cells","spec"),this._ord=t.required(n,"ordinal","keyArgs")},elemName:"axis position",keyName:"key",get key(){return this._cells.key},get ordinal(){return this._ord},get cells(){return this._cells},toSpec:function(){return this._cells.toSpec()}})}),define("pentaho/data/_cross/Axis",["./AxisPosition","../Structure","../_WithStructure","../_WithCellTupleBase","../../lang/Collection"],function(e,t,n,i,r){return r.extend("pentaho.data._cross.Axis",{constructor:function(e){n.call(this,e),i.call(this,e),this.base()},_cachedKeyArgs:null,_cachedPosSpec:null,elemClass:e,_cast:function(t,n){var i=this._cachedKeyArgs||(this._cachedKeyArgs={ordinal:0}),r=this._cachedPosSpec||(this._cachedPosSpec={cells:null});i.ordinal=n,r.cells=this.toCellTuple(t);var o=new e(r,i);return r.cells=null,o},_castKey:function(e){return"string"==typeof e?e:this.toCellTuple(e)},intern:function(e){var t=this.toCellTuple(e);return this.get(t.key)||this.add(t)},toSpec:function(){return this.map(function(e){return e.toSpec()})}}).implement(n,i)}),define("pentaho/data/_cross/MeasureCellSet",["../Structure","../../lang/Base","../../util/arg"],function(e,t,n){var i=t.extend("pentaho.data._cross.MeasureCellSet",{constructor:function(e,t){switch(this._structure=n.required(t,"structure","keyArgs"),this._structure.length){case 0:this._cube=null;break;case 1:this._cube=new a(t);break;default:this._cube=new o(t)}e&&this._load(e)},get structure(){return this._structure},get:function(e,t,n,i){var r=this._structure[null==n?0:n].attribute;return this._cube.get(e,t,r,i)},getByName:function(e,t,n,i){var r=this._structure.getExisting(n).attribute;return this._cube.get(e,t,r,i)},getByAttribute:function(e,t,n,i){return this._cube.get(e,t,n,i)},setByAttribute:function(e,t,n,i){return this._cube.setByAttribute(e,t,n,i)},_load:function(e){for(var t=-1,n=e.length,i=this._structure.toSpec({shareModel:!0});++t<n;)for(var r=e[t],o=-1,a=r.length;++o<a;){var s=r[o];if(s instanceof Array)for(var u=-1,l=s.length;++u<l;)this.set(t,o,i[u],s[u]);else this.set(t,o,i[0],s)}},_onColAdded:function(){this._cube&&this._cube._onColAdded()}}),r=t.extend("pentaho.data._cross.MeasureCube",{constructor:function(e){this._C=n.optional(e,"C",0),this._cube=[]},_getRow:function(e,t){var n=this._cube;return n[e]||(t?null:n[e]=new Array(this._C))},_onColAdded:function(){this._C++;for(var e=this._cube,t=-1,n=e.length;++t<n;)e[t].push(null)}}),o=r.extend("pentaho.data._cross.MultiMeasureCube",{constructor:function(e){var t=n.required(e,"structure","keyArgs");this.base(e);var i=this._measHolderBase={};t.forEach(function(e){i[e.attribute.name]=null})},get:function(e,t,n,i){var r=this._getRowCol(e,t,i);return r?r[n.name]||(i?null:r[n.name]=n.toCellOf(null)):null},setByAttribute:function(e,t,n,i){return this._getRowCol(e,t)[n.name]=n.toCellOf(i)},_getRowCol:function(e,t,n){var i=this._getRow(e,n);if(!i)return null;var r=i[t];if(!r){if(n)return null;i[t]=r=Object.create(this._measHolderBase)}return r}}),a=r.extend("pentaho.data._cross.SingleMeasureCube",{get:function(e,t,n,i){var r=this._getRow(e,i);return r?r[t]||(i?null:r[t]=n.toCellOf(null)):null},setByAttribute:function(e,t,n,i){return this._getRow(e)[t]=n.toCellOf(i)}});return i}),define("pentaho/data/_cross/Table",["../Structure","./Axis","./MeasureCellSet","../../lang/Base","../../util/arg","../../util/error","../../util/object"],function(e,t,n,i,r,o,a){return i.extend("pentaho.data._cross.Table",{constructor:function(n,i){var o=r.required(i,"model","keyArgs"),a=r.optional(n,"layout"),s={model:o},u={rows:e.to(a&&a.rows||[],s),cols:e.to(a&&a.cols||[],s),meas:e.to(a&&a.meas||[],s)};this.model=o,this.layout=u,this._xR=u.rows.length,this._xC=u.cols.length,this._xM=u.meas.length,this.rows=t.to([],{structure:u.rows}),this.cols=t.to([],{structure:u.cols}),this._micColsIndex={},this.meas=null,n.meas?this._loadDataCube(n):this._loadDataMic(n)},_micCols:null,_micColsIndex:null,_getMicColKey:function(e){if(this._xC){return this.cols[e.ordinal].key+(e.attribute?"~"+e.attribute.name:"")}return e.attribute.name},_getMicColLabel:function(e){if(this._xC){return this.cols[e.ordinal].cells.label+(e.attribute?"~"+e.attribute.label:"")}return e.attribute.label},_setMicCol:function(e,t,n){n?this._setMicColCore(e,t,n.ordinal,n.attribute):this._setMicColCore(e,t,-1,null)},_setMicColCore:function(e,t,n,i){return this._micColsIndex[t+"~"+n]=e,this._micCols[e]={ordinal:t,attrOrdinal:n,attribute:i}},_hasMicCol:function(e,t){if(null==e)return!1;var n=e+"~"+(t?t.ordinal:-1);return a.hasOwn(this._micColsIndex,n)},_buildFullMicView:function(){var e=this.cols.length,t=this._xM;if(t){var n=e*t,i=this.layout.meas;for(this._micCols=new Array(n);e--;)for(var r=t;r--;)this._setMicCol(--n,e,i[r])}else for(;e--;)this._setMicCol(e,e,null)},_loadDataCube:function(e){e.rows&&this.rows.addMany(e.rows),e.cols&&this.cols.addMany(e.cols);var t=this.layout.meas;this.meas=new n(e.meas,{structure:t,C:this.cols.length});var i=e.micCols;if(i){this._micCols=new Array(i.length);var r=t.length;i.forEach(function(e,n){this._setMicCol(n,e.o,r?t[e.a]:null)},this)}else this._buildFullMicView()},_loadDataMic:function(e){var t=e&&e.cols||[],i=e&&e.rows||[],r=t.length,a=i.length,s=r-this._xR;if(s<0&&(this._xC||this._xM))throw o.argInvalid("spec.cols","As many columns as row attributes are required when there are measure and/or column attributes.");if(r&&this._xR&&this._processCrossRowColumns(t),s>0){this._micCols=new Array(s);for(var u=this._xR-1;++u<r;)this._addCrossCol(t[u],u)}else this._micCols=[];this.meas=new n(null,{structure:this.layout.meas,C:this.cols.length}),a>0&&(this._xR||this._xM)&&this._processCrossRows(i)},_processCrossRowColumns:function(e){for(var t=this.rows.structure,n=Math.min(e.length,this._xR);n--;){var i=e[n],r=t[n].attribute,o=i&&"object"==typeof i?i.attr:i;if(null!=o&&o!==r.name)throw new Error("Invalid cross-table - attribute mismatch: '"+o+"'. Expected: '"+r.name+"'.")}},_addCrossCol:function(e,t){if(null==e)throw o.argRequired("cols["+t+"]");var n,i=t-this._xR,r=this._xC,a=this._xM;if(r){if("object"!=typeof e)throw o.argInvalidType("cols["+t+"]","object");n=e.attr}else{if(!a)throw o.argInvalid("cols["+t+"]","Cannot have cross-columns when there are no measure and no column attributes.");n=e&&"object"==typeof e?e.attr:e}var s;if(a)if(null==n){if(a>1)throw o.argInvalid("cols["+t+"].attr","Required when there is more than one measure.");s=this.layout.meas[0]}else s=this.layout.meas.getExisting(n);else{if(null!=n)throw o.argInvalid("cols["+t+"].attr","Cannot be specified when there are no measures.");s=null}var u,l;if(r){l=this.cols.toCellTuple(e.c);var c=this.cols.get(l.key);c&&(u=c.ordinal)}else u=0;if(this._hasMicCol(u,s))throw o.argInvalid("cols["+t+"]","Duplicate column cell tuple and measure attribute.");return r?null==u&&(u=this.cols.add(l).ordinal):i||this.cols.intern([]),this._setMicCol(i,u,s)},get _isDegenerateCrossRow(){return!this._xR&&!!this._xM},_processCrossRows:function(e){this._isDegenerateCrossRow&&this.rows.intern([]);for(var t=-1,n=e.length;++t<n;)this._addRow(e[t],t)},_addRow:function(e,t){if(!e)throw o.argRequired("rows["+t+"]");var n;if(e instanceof Array)n=e;else if(!((n=e.c)instanceof Array))throw o.argInvalid("rows["+t+"].c","Not an array.");var i;if(this._isDegenerateCrossRow)i=0;else{var r=n.splice(0,this._xR);i=this.rows.intern(r).ordinal}if(t!==i)throw o.argInvalid("rows["+t+"].c","Duplicate row tuple.");if(this._xM){var a=this._micCols;if(a.length)for(var s,u=-1,l=Math.min(a.length,n.length),c=this.meas;++u<l;)null!=(s=n[u])&&c.setByAttribute(i,a[u].ordinal,a[u].attribute,s)}},getCell:function(e,t){var n=t-this._xR;if(n<0)return this.rows[e].cells[t];var i=this._micCols[n];return this.meas.getByAttribute(e,i.ordinal,i.attribute)},getNumberOfColumns:function(){return this._xR+this._micCols.length},getNumberOfRows:function(){return this.rows.length},getColumnAttribute:function(e){var t=e-this._xR;return t<0?this.layout.rows[e].attribute:this._micCols[t].attribute},getColumnType:function(e){var t=this.getColumnAttribute(e);if(t)return t.type},isColumnKey:function(e){var t=this.getColumnAttribute(e);if(t)return t.isKey},getColumnHierarchyName:function(e){var t=this.getColumnAttribute(e);if(t)return t.hierarchyName},getColumnHierarchyOrdinal:function(e){var t=this.getColumnAttribute(e);if(t)return t.hierarchyOrdinal},getColumnId:function(e){var t=e-this._xR;return t<0?this.layout.rows[e].attribute.name:this._getMicColKey(this._micCols[t])},getColumnLabel:function(e){var t=e-this._xR;return t<0?this.layout.rows[e].attribute.label:this._getMicColLabel(this._micCols[t])},getValue:function(e,t){return this.getCell(e,t).value},getValueKey:function(e,t){return this.getCell(e,t).key},getFormattedValue:function(e,t){return this.getCell(e,t).toString()},getLabel:function(e,t){return this.getCell(e,t).label},addColumn:function(e){var t=this.cols,n=t.length,i=this.getNumberOfColumns();return this._addCrossCol(e,i),t.length>n&&this.meas._onColAdded(),i},addRow:function(e){var t=this.rows.length;return this._addRow(e,t),t},toSpec:function(e){var t=this.layout;return{layout:{rows:t.rows.toSpec(e),cols:t.cols.toSpec(e),meas:t.meas.toSpec(e)},rows:this.rows.toSpec(),cols:this.cols.toSpec(),meas:this.meas.toSpec(),micCols:this._micCols.map(function(e){return{o:e.ordinal,a:e.attrOrdinal}})}},toSpecPlain:function(e){for(var t=this.rows,n=this.cols,i=this.meas,r=t.length,o=n.length,s=Math.max(1,r),u=Math.max(1,o),l=this._xR,c=this._xC,h=this._xM,d=l+c,p=d+h,f=[],_=[].concat(t.structure.toSpec(e),n.structure.toSpec(e),i.structure.toSpec(e)),m=h>0&&!!a.getOwn(e,"skipRowsWithAllNullMeasures"),g=-1;++g<s;)for(var y=r?t[g].cells:null,v=-1;++v<u;){var b,C,O=new Array(p);if(r)for(C=l;C--;)O[C]=y[C].toSpec();if(o)for(C=c,b=n[v].cells;C--;)O[l+C]=b[C].toSpec();C=h;for(var x=m;C--;){var A=i.get(g,v,C,!0),j=A&&A.toSpec();x&&null!==j&&(x=!1),O[d+C]=j}x||f.push({c:O})}return{cols:_,rows:f}}})}),define("pentaho/data/_Table",["./_AbstractTable","./Model","./_plain/Table","./_cross/Table","./AtomicTypeName","../util/arg","../util/object"],function(AbstractTable,Model,PlainTable,CrossTable,AtomicTypeName,arg,O){var COLTYPE_CDA_DT={numeric:AtomicTypeName.NUMBER,integer:AtomicTypeName.NUMBER,blob:AtomicTypeName.STRING,string:AtomicTypeName.STRING,boolean:AtomicTypeName.BOOLEAN,date:AtomicTypeName.DATE},Table=AbstractTable.extend("pentaho.data.Table",{constructor:function(e){var t=this._readTableArgument(e),n=t.model,i=t.layout?CrossTable:PlainTable;this.model=Model.to(n),this.implem=new i(t,{model:this.model}),this.isPlainTable||(this._cachedPlainTable=null)},getCell:function(e,t){return this.implem.getCell(e,t)},getNumberOfColumns:function(){return this.implem.getNumberOfColumns()},getNumberOfRows:function(){return this.implem.getNumberOfRows()},getColumnAttribute:function(e){return this.implem.getColumnAttribute(e)},getColumnType:function(e){return this.implem.getColumnType(e)},getColumnId:function(e){return this.implem.getColumnId(e)},isColumnKey:function(e){return this.implem.isColumnKey(e)},getColumnLabel:function(e){return this.implem.getColumnLabel(e)},getColumnHierarchyName:function(e){return this.implem.getColumnHierarchyName(e)},getColumnHierarchyOrdinal:function(e){return this.implem.getColumnHierarchyOrdinal(e)},getValue:function(e,t){return this.implem.getValue(e,t)},getValueKey:function(e,t){return this.implem.getValueKey(e,t)},getFormattedValue:function(e,t){return this.implem.getFormattedValue(e,t)},getLabel:function(e,t){return this.implem.getLabel(e,t)},addColumn:function(e,t){return this.isPlainTable||(this._cachedPlainTable=null),this.implem.addColumn(e,t)},addRow:function(e,t){return this.isPlainTable||(this._cachedPlainTable=null),this.implem.addRow(e,t)},_readTableArgument:function(table){return table?table instanceof AbstractTable?table.toSpec():("string"==typeof table&&(table=eval("("+table+")")),table.metadata?Table.convertJsonCdaToTableSpec(table):table):{cols:[]}},get isCrossTable(){return this.implem instanceof CrossTable},get isPlainTable(){return this.implem instanceof PlainTable},toPlainTable:function(e){if(this.isPlainTable)return this;var t=!!O.getOwn(e,"skipRowsWithAllNullMeasures"),n=t?"_cachedPlainTableNoNulls":"_cachedPlainTable",i=this[n];return i||(i=this[n]=new Table(this.toSpecPlain({shareModel:!0,skipRowsWithAllNullMeasures:t})),i.originalCrossTable=this),i},toSpecPlain:function(e){return this._toSpec(e,!0)},toSpec:function(e){return this._toSpec(e,!1)},_toSpec:function(e,t){var n=!t||this.isPlainTable?this.implem.toSpec(e):this.implem.toSpecPlain(e);return n.model=arg.optional(e,"shareModel")?this.model:this.model.toSpec(),n}},{convertJsonCdaToTableSpec:function(e){var t,n=e.metadata,i=e.resultset,r=n.length,o=i.length,a=new Array(r),s=new Array(o);for(t=-1;++t<r;){var u=n[t],l=String(u.colType||"string").toLowerCase();COLTYPE_CDA_DT.hasOwnProperty(l)&&(l=COLTYPE_CDA_DT[l]);var c=a[t]={name:u.colName,type:l,label:u.colLabel||u.colName};null!=u.colIsKey&&(c.isKey=u.colIsKey)}for(var h=-1;++h<o;){var d=i[h],p=new Array(r);for(t=r;t--;){var f=d[t];p[t]=null==f?null:"object"==typeof f&&"v"in f?f:{v:f,f:null}}s[h]={c:p}}return{model:a,rows:s}}});return Table}),define("pentaho/data/_TableView",["./_AbstractTable","./_Table","../lang/_Annotatable","../util/error"],function(e,t,n,i){"use strict";var r=e.extend("pentaho.data.TableView",{constructor:function(e){if(!e)throw i.argRequired("table");this._source=e,this.model=e.model,this._rows=null,this._columns=this._getSourceColumns()},getSourceTable:function(){return this._source},getRootSourceTable:function(){for(var e=this._source;e instanceof r;)e=e._source;return e},setSourceColumns:function(e){return this._columns=e?e.slice():this._getSourceColumns(),this},getSourceColumns:function(){return this._columns},setSourceRows:function(e){return this._rows=e||null,this},getSourceRows:function(){return this._rows},getSourceColumnIndex:function(e){return this._columns[e]},getSourceRowIndex:function(e){return this._rows?this._rows[e]:e},getCell:function(e,t){return this._source.getCell(this.getSourceRowIndex(e),this.getSourceColumnIndex(t))},getNumberOfColumns:function(){return this._columns.length},getNumberOfRows:function(){return this._rows?this._rows.length:this._source.getNumberOfRows()},getColumnAttribute:function(e){return this._source.getColumnAttribute(this.getSourceColumnIndex(e))},getColumnType:function(e){return this._source.getColumnType(this.getSourceColumnIndex(e))},getColumnId:function(e){return this._source.getColumnId(this.getSourceColumnIndex(e))},getColumnLabel:function(e){return this._source.getColumnLabel(this.getSourceColumnIndex(e))},isColumnKey:function(e){return this._source.isColumnKey(this.getSourceColumnIndex(e))},getColumnHierarchyName:function(e){return this._source.getColumnHierarchyName(this.getSourceColumnIndex(e))},getColumnHierarchyOrdinal:function(e){return this._source.getColumnHierarchyOrdinal(this.getSourceColumnIndex(e))},getValue:function(e,t){return this._source.getValue(this.getSourceRowIndex(e),this.getSourceColumnIndex(t))},getValueKey:function(e,t){return this._source.getValueKey(this.getSourceRowIndex(e),this.getSourceColumnIndex(t))},getFormattedValue:function(e,t){return this._source.getFormattedValue(this.getSourceRowIndex(e),this.getSourceColumnIndex(t))},getLabel:function(e,t){return this._source.getLabel(this.getSourceRowIndex(e),this.getSourceColumnIndex(t))},addColumn:function(e,t){var n=this._source.addColumn(e,t);return this._columns.push(n)-1},addRow:function(e,t){throw new Error("Not implemented")},_getSourceColumns:function(){for(var e=this._source.getNumberOfColumns(),t=new Array(e);e--;)t[e]=e;return t},hideColumns:function(e){var t=this._columns;if(t.length){var n,i={};for(n=e.length;n--;)i[e[n]]=1;for(n=t.length;n--;)1===i[t[n]]&&t.splice(n,1)}return this},toDataTable:function(){return new t(this.toSpec())},toSpec:function(){for(var e=this.getNumberOfColumns(),t=new Array(e),i=-1;++i<e;){var r,o=this.getColumnId(i),a=this.getColumnAttribute(i);a?(r=a.toSpec(),o!==a.name&&(r.name=o,r.label=this.getColumnLabel(i))):r={name:o,label:this.getColumnLabel(i),type:"string"},t[i]=r}return{model:n.toSpec(this.model,{attrs:t}),rows:this._getJsonRows()}},_getJsonRows:function(){for(var e=this.getNumberOfColumns(),t=this.getNumberOfRows(),n=new Array(t),i=-1;++i<t;){for(var r=e,o=new Array(e);r--;)o[r]=this.getCell(i,r).toSpec();n[i]={c:o}}return n}});return r}),define("pentaho/data/AbstractTable",["./_AbstractTable","./_Table","./_TableView"],function(e,t,n){"use strict";return e.core={Abstract:e,Table:t,TableView:n},e}),define("pentaho/data/Table",["./AbstractTable"],function(e){"use strict";return e.core.Table}),define("pentaho/data/TableView",["./AbstractTable"],function(e){"use strict";return e.core.TableView}),define("pentaho/data/filter/_core/Tree",["pentaho/module!../Tree","pentaho/util/error"],function(e,t){"use strict";return function(n){n.Tree=n.Abstract.extend("pentaho.data.filter.Tree",{get isTerminal(){return!1},_buildContentKey:function(){return this.operands.toArray(function(e){return e.$contentKey}).sort().join(" ")},negate:function(){var e=this.operands.toArray(function(e){return e.negate()});return new(0,this._inverseClass)({operands:e})},_operation:function(){var e=arguments.length;if(!e)return this;for(var t,n=this.constructor,i=this.operands.toArray(),r=i.length,o=-1;++o<e;)if(t=arguments[o])if(t instanceof n)for(var a=t.operands,s=a.count,u=-1;++u<s;)i.push(a.at(u));else i.push(t);switch(i.length){case r:return this;case 1:return i[0]}return new n({operands:i})},_visitDefault:function(e){var t=this.visitOperands(e);return t?new this.constructor({operands:t}):this},visitOperands:function(e,n){if(!e)throw t.argRequired("transformer");for(var i=n&&n.where,r=null,o=this.operands,a=o.count,s=-1;++s<a;){var u=o.at(s),l=!i||i(u)?u.visit(e):null;if(r||!l||l!==u){if(!r){r=[];for(var c=-1;++c<s;)r.push(o.at(c))}l&&r.push(l)}}return r},get __equalityLiteralsByPropertyName(){return this.__equalityLiteralsByName||(this.__equalityLiteralsByName=Object.freeze(this.__buildEqualityLiteralsByName()))},__equalityLiteralsByName:null,__buildEqualityLiteralsByName:function(){for(var e,t,n={},i=this.operands,r=i.count;r--;)e=i.at(r),t=e.isNot?e.operand:e,"isEqual"===t.kind&&(n[t.property]={operand:e,index:r});return n},$type:{id:e.id,isAbstract:!0,props:[{name:"operands",nameAlias:"o",valueType:[n.Abstract],isBoundary:!0}]}})}}),define("pentaho/data/filter/KnownFilterKind",[],function(){"use strict";return{And:"and",Or:"or",Not:"not",IsEqual:"isEqual",IsIn:"isIn",IsGreater:"isGreater",IsLess:"isLess",IsGreaterOrEqual:"isGreaterOrEqual",IsLessOrEqual:"isLessOrEqual",IsLike:"isLike",True:"true",False:"false"}}),define("pentaho/data/filter/_core/And",["pentaho/module!../And","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.And=n.Tree.extend("pentaho.data.filter.And",{get kind(){return t.And},_compile:function(){var e=this.operands.toArray(function(e){return e.compile()}),t=e.length;return function(n){for(var i=-1;++i<t;)if(!e[i](n))return!1;return!0}},and:function(){return this._operation.apply(this,arguments)},get _inverseClass(){return n.Or},$type:{id:e.id}})}}),define("pentaho/data/filter/_core/Or",["pentaho/module!../Or","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.Or=n.Tree.extend("pentaho.data.filter.Or",{get kind(){return t.Or},_compile:function(){var e=this.operands.toArray(function(e){return e.compile()}),t=e.length;return function(n){for(var i=-1;++i<t;)if(e[i](n))return!0;return!1}},or:function(){return this._operation.apply(this,arguments)},get _inverseClass(){return n.And},$type:{id:e.id}})}}),define("pentaho/data/filter/_core/Not",["pentaho/module!../Not","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.Not=n.Abstract.extend("pentaho.data.filter.Not",{get kind(){return t.Not},get isTerminal(){return!1},get isNot(){return!0},_buildContentKey:function(){var e=this.operand;return e?e.$contentKey:""},_compile:function(){var e=this.operand.compile();return function(t){return!e(t)}},_visitDefault:function(e){var t=this.operand;if(t){var n=t.visit(e);return n!==t?n.negate():this}return this},negate:function(){return this.operand||new n.Not({operand:this})},$type:{id:e.id,props:[{name:"operand",nameAlias:"o",valueType:n.Abstract,isRequired:!0,isBoundary:!0}]}})}}),define("pentaho/data/filter/_core/True",["pentaho/module!../True","../KnownFilterKind"],function(e,t){"use strict";return function(n){var i;n.True=n.Abstract.extend("pentaho.data.filter.True",{constructor:function(){if(i)return i;i=this,this.base()},get kind(){return t.True},get isTerminal(){return!0},_buildContentKey:function(){return""},_compile:function(){return function(){return!0}},negate:function(){return n.False.instance},$type:{id:e.id}},{get instance(){return i||(i=new this)}})}}),define("pentaho/data/filter/_core/False",["pentaho/module!../False","../KnownFilterKind"],function(e,t){"use strict";return function(n){var i=null;n.False=n.Abstract.extend("pentaho.data.filter.False",{constructor:function(){if(i)return i;i=this,this.base()},get kind(){return t.False},get isTerminal(){return!0},_buildContentKey:function(){return""},_compile:function(){return function(){return!1}},negate:function(){return n.True.instance},$type:{id:e.id}},{get instance(){return i||(i=new this)}})}}),define("pentaho/data/filter/_core/Property",["pentaho/module!../Property"],function(e){"use strict";return function(t){t.Property=t.Abstract.extend({get isProperty(){return!0},$type:{id:e.id,isAbstract:!0,props:[{name:"property",nameAlias:"p",valueType:"string",isRequired:!0}]}})}}),define("pentaho/data/filter/_core/IsEqual",["pentaho/module!../IsEqual","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.IsEqual=n.Property.extend({get kind(){return t.IsEqual},_compile:function(){var e=this.property,t=this.value;return function(n){var i=n.getv(e,!0);return i===t||null!=i&&null!=t&&i.valueOf()===t.valueOf()}},_buildContentKey:function(){var e=this.get("value");return(this.property||"")+" "+(e?e.$key:"")},$type:{id:e.id,props:[{name:"value",nameAlias:"v",valueType:"element",isBoundary:!0}]}})}}),define("pentaho/data/filter/_core/IsIn",["pentaho/module!../IsIn","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.IsIn=n.Property.extend({get kind(){return t.IsIn},_compile:function(){var e=this.property,t=this.values.toArray(function(e){return e.valueOf()}),n=t.length;return function(i){var r=i.getv(e,!0);if(null!==r)for(var o=-1;++o<n;)if(t[o]===r)return!0;return!1}},_buildContentKey:function(){return(this.property||"")+" "+this.values.toArray(function(e){return e.$key}).join(" ")},$type:{id:e.id,props:[{name:"values",nameAlias:"v",valueType:["element"],isBoundary:!0}]}})}}),define("pentaho/data/filter/_core/IsGreater",["pentaho/module!../IsGreater","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.IsGreater=n.Property.extend({get kind(){return t.IsGreater},negate:function(){return new n.IsLessOrEqual({property:this.property,value:this.value})},_compile:function(){var e=this.property,t=this.value;return function(n){var i=n.getv(e,!0);return null!==i&&t>i}},_buildContentKey:function(){var e=this.get("value");return(this.property||"")+" "+(e?e.$key:"")},$type:{id:e.id,props:[{name:"value",nameAlias:"v",valueType:"element",isRequired:!0,isBoundary:!0}]}})}}),define("pentaho/data/filter/_core/IsLess",["pentaho/module!../IsLess","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.IsLess=n.Property.extend({get kind(){return t.IsLess},negate:function(){return new n.IsGreaterOrEqual({property:this.property,value:this.value})},_compile:function(){var e=this.property,t=this.value;return function(n){var i=n.getv(e,!0);return null!==i&&t<i}},_buildContentKey:function(){var e=this.get("value");return(this.property||"")+" "+(e?e.$key:"")},$type:{id:e.id,props:[{name:"value",nameAlias:"v",valueType:"element",isRequired:!0,isBoundary:!0}]}})}}),define("pentaho/data/filter/_core/IsGreaterOrEqual",["pentaho/module!../IsGreaterOrEqual","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.IsGreaterOrEqual=n.Property.extend({get kind(){return t.IsGreaterOrEqual},negate:function(){return new n.IsLess({property:this.property,value:this.value})},_compile:function(){var e=this.property,t=this.value;return function(n){var i=n.getv(e,!0);return null!==i&&t>=i}},_buildContentKey:function(){var e=this.get("value");return(this.property||"")+" "+(e?e.$key:"")},$type:{id:e.id,props:[{name:"value",nameAlias:"v",valueType:"element",isRequired:!0,isBoundary:!0}]}})}}),define("pentaho/data/filter/_core/IsLessOrEqual",["pentaho/module!../IsLessOrEqual","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.IsLessOrEqual=n.Property.extend({get kind(){return t.IsLessOrEqual},negate:function(){return new n.IsGreater({property:this.property,value:this.value})},_compile:function(){var e=this.property,t=this.value;return function(n){var i=n.getv(e,!0);return null!==i&&t<=i}},_buildContentKey:function(){var e=this.get("value");return(this.property||"")+" "+(e?e.$key:"")},$type:{id:e.id,props:[{name:"value",nameAlias:"v",valueType:"element",isRequired:!0,isBoundary:!0}]}})}}),define("pentaho/data/filter/_core/IsLike",["pentaho/module!../IsLike","../KnownFilterKind"],function(e,t){"use strict";return function(n){n.IsLike=n.Property.extend({get kind(){return t.IsLike},_compile:function(){var e=this.property,t=this.anchorStart,n=this.anchorEnd,i=this.isCaseInsensitive,r=this.getf("value")||this.value.toString();return i&&(r=r.toLowerCase()),function(o){var a;if(null==(a=o.getf(e,!0))&&null==(a=o.getv(e,!0)))return!1;var s;return(s=i?a.toLowerCase().indexOf(r):a.indexOf(r))>-1&&(!t||0===s)&&(!n||s+r.length===a.length)}},_buildContentKey:function(){var e=this.get("value"),t=this.get("anchorStart"),n=this.get("anchorEnd"),i=this.get("isCaseInsensitive")
;return(this.property||"")+" "+(e?e.$type.isSimple?e.$contentKey:e.$key:"")+" "+(t?t.$key:"")+" "+(n?n.$key:"")+" "+(i?i.$key:"")},$type:{id:e.id,props:[{name:"value",nameAlias:"v",valueType:"element",isRequired:!0,isBoundary:!0},{name:"anchorStart",nameAlias:"s",valueType:"boolean",defaultValue:!1},{name:"anchorEnd",nameAlias:"e",valueType:"boolean",defaultValue:!1},{name:"isCaseInsensitive",nameAlias:"ci",valueType:"boolean",defaultValue:!1}]}})}}),define("pentaho/data/filter/Abstract",["module","pentaho/type/Complex","./_core/Tree","./_core/And","./_core/Or","./_core/Not","./_core/True","./_core/False","./_core/Property","./_core/IsEqual","./_core/IsIn","./_core/IsGreater","./_core/IsLess","./_core/IsGreaterOrEqual","./_core/IsLessOrEqual","./_core/IsLike","pentaho/util/arg","pentaho/util/error","pentaho/util/object","pentaho/util/logger","pentaho/debug","pentaho/debug/Levels"],function(e,t,n,i,r,o,a,s,u,l,c,h,d,p,f,_,m,g,y,v,b,C){"use strict";function O(e){var t;if("not"===e.kind&&(t=e.operand))switch(t.kind){case"and":return new E.Or({operands:t.operands.toArray(function(e){return e.negate().visit(O)})});case"or":return new E.And({operands:t.operands.toArray(function(e){return e.negate().visit(O)})});case"not":return t.operand&&t.operand.visit(O);case"true":return E.False.instance;case"false":return new E.True;default:return t.negate()}}function x(e){if("and"===e.kind){for(var t,n=-1,i=e.operands,r=i.count,o=[],a=[];++n<r;)t=i.at(n).visit(x),"or"===t.kind?a.push(t):o.push(t);var s=a.length;if(s){var u=[];return A(u,new Array(s).concat(o),a,0),new E.Or({operands:u})}return new E.And({operands:o})}}function A(e,t,n,i){if(i<n.length)for(var r=i+1,o=n[i].operands,a=o.count,s=-1;++s<a;)t[i]=o.at(s),A(e,t,n,r);else e.push(new E.And({operands:t.slice()}))}function j(e){var t;switch(t=e.kind){case"and":case"or":for(var n=-1,i=e.operands,r=i.count,o=[];++n<r;){var a=i.at(n).visit(j);a.kind===t?o.push.apply(o,a.operands.toArray()):o.push(a)}return new e.constructor({operands:o})}}function w(e){switch(e.kind){case"true":case"false":break;case"or":for(var t=-1,n=e.operands,i=n.count,r=[];++t<i;){var o=n.at(t);switch(o.kind){case"true":return E.True.instance;case"false":continue;case"and":r.push(o);break;default:r.push(new E.And({operands:[o]}))}}return new e.constructor({operands:r});case"and":e=new E.Or({operands:[e]});break;default:e=new E.Or({operands:[new E.And({operands:[e]})]})}return e}function T(e){return"or"===e.kind?I(e):e}function I(e){for(var t={},n=[],i=-1,r=e.operands,o=r.count;++i<o;){var a=r.at(i).visit(S);switch(a.kind){case"true":return E.True.instance;case"false":continue}var s=a.$contentKey;y.hasOwn(t,s)||(t[s]=a,n.push(a))}return n.length?new E.Or({operands:n}):E.False.instance}function S(e){for(var t={},n={},i=[],r=-1,o=e.operands,a=o.count;++r<a;){var s,u=o.at(r),l=!1;switch(u.kind){case"false":return E.False.instance;case"true":continue;case"not":l=!0}var c=u.$contentKey;if(!y.hasOwn(t,c)){if(l){var h=u.operand;if(h){if(y.hasOwn(t,h.$contentKey))return E.False.instance;if("isEqual"===h.kind&&(s=h.property)){if(y.hasOwn(n,"+"+s))continue;(n["-"+s]||(n["-"+s]=[])).push(u)}}}else{if(y.hasOwn(t,"(not "+c+")"))return E.False.instance;if("isEqual"===u.kind&&(s=u.property)){if(y.hasOwn(n,"+"+s))return E.False.instance;(n["+"+s]||(n["+"+s]=[])).push(u);var d=y.getOwn(n,"-"+s);d&&(d.forEach(function(e){i.splice(i.indexOf(e),1),delete t[e.$contentKey]}),delete n["-"+s])}}t[c]=u,i.push(u)}}return i.length?new E.And({operands:i}):E.True.instance}function R(e,t){for(var n,i,r,o=[],a=e.__equalityLiteralsByPropertyName,s=t.operands,u=s.count;u--;){var l=s.at(u),c=(i=l.isNot)?l.operand:l,h=y.getOwn(a,c.property);if(h&&"isEqual"===c.kind){var d=h.operand,p=(r=d.isNot)?d.operand:d;if(r){if(!i){if(F(p.value,c.value))return[e];throw g.notImplemented("This case is not supported.")}F(p.value,c.value)||(n=e.operands.toArray(),n[h.index]=c,o.push(new E.And({operands:n})))}else if(i){if(F(p.value,c.value))return[e]}else if(!F(p.value,c.value))return[e]}else n=e.operands.toArray(),n.push(i?c:c.negate()),o.push(new E.And({operands:n}))}return o.length?o:null}function F(e,t){return e===t||null!=e&&null!=t&&e.valueOf()===t.valueOf()}var M=b.testLevel(C.debug,e),E={};return E.Abstract=t.extend("pentaho.data.filter.Abstract",{get isTerminal(){return!0},get isNot(){return!1},get isProperty(){return!1},get $key(){return this.$contentKey},get $contentKey(){return this.__contentKey||(this.__contentKey=this.__buildContentKeyOuter())},equalsContent:function(e){return!0},__buildContentKeyOuter:function(){var e=this._buildContentKey();return"("+this.$type.shortId+(e?" "+e:"")+")"},contains:function(e){return this.compile()(e)},__compiled:null,compile:function(){var e=this.__compiled;return null===e&&(this.assertValid(),this.__compiled=e=this._compile()),e},visit:function(e){if(!e)throw g.argRequired("transformer");return e(this)||this._visitDefault(e)},_visitDefault:function(e){return this},negate:function(){return new E.Not({operand:this})},or:function(){if(!arguments.length)return this;var e=m.slice(arguments);return e.unshift(this),new E.Or({operands:e})},and:function(){if(!arguments.length)return this;var e=m.slice(arguments);return e.unshift(this),new E.And({operands:e})},andNot:function(e){if(!e)return this;var t=this.toDnf();switch(t.kind){case"false":return t;case"true":return e.negate()}var n=e.toDnf();switch(n.kind){case"false":return this;case"true":return E.False.instance}var i=[];M&&v.log("-----------------------------------------");var r={};return n.operands.each(function(e){r[e.$contentKey]=e}),t.operands.each(function(e){y.hasOwn(r,e.$contentKey)||i.push(e)}),M&&v.log("remainders 1 #="+i.length+" ( "+i.length+" * "+n.operands.count+" = "+i.length*n.operands.count+")"),i.length&&(n.operands.each(function(e){for(var t=i.length;t--;){var n=R(i[t],e);if(n)n.unshift(t,1),i.splice.apply(i,n);else if(i.splice(t,1),!i.length)return!1}}),M&&v.log("remainders 2 #="+i.length)),i.length?new E.Or({operands:i}):E.False.instance},toDnf:function(){var e=this.__toDnfCache;return e||(this.__toDnfCache=e=this.visit(O).visit(x).visit(j).visit(w).visit(T),e.__toDnfCache=e),e},toExtensional:function(e,t){M&&v.log("toExtensional BEGIN");try{var n=e.filter(this),i=n.getNumberOfRows();if(0===i)return E.False.instance;if(0===t.length)throw g.argInvalid("keyColumnNames","At least one key column must be specified.");for(var r=function(e,t){var n={};return t.forEach(function(t){var i=e.getColumnIndexById(t);if(-1===i)throw g.argInvalid("keyColumnNames","The column name "+t+" is not in the dataPlain.");n[t]=i}),n}(n,t),o=[],a=0;a<i;a++){var s=t.map(function(e){var t=n.getValue(a,r[e]),i=n.getColumnType(r[e]);return new E.IsEqual({property:e,value:{_:i,v:t}})});o.push(new E.And({operands:s}))}return new E.Or({operands:o})}finally{M&&v.log("toExtensional END")}},$type:{id:e.id,isAbstract:!0,isEntity:!0,isReadOnly:!0}}),E.Abstract._core=E,o(E),n(E),i(E),r(E),a(E),s(E),u(E),l(E),c(E),h(E),d(E),p(E),f(E),_(E),E.Abstract}),define("pentaho/data/filter/Tree",["./Abstract"],function(e){"use strict";return e._core.Tree}),define("pentaho/data/filter/Property",["./Abstract"],function(e){"use strict";return e._core.Property}),define("pentaho/data/filter/And",["./Abstract"],function(e){"use strict";return e._core.And}),define("pentaho/data/filter/Or",["./Abstract"],function(e){"use strict";return e._core.Or}),define("pentaho/data/filter/Not",["./Abstract"],function(e){"use strict";return e._core.Not}),define("pentaho/data/filter/IsEqual",["./Abstract"],function(e){"use strict";return e._core.IsEqual}),define("pentaho/data/filter/IsIn",["./Abstract"],function(e){"use strict";return e._core.IsIn}),define("pentaho/data/filter/IsGreater",["./Abstract"],function(e){"use strict";return e._core.IsGreater}),define("pentaho/data/filter/IsLess",["./Abstract"],function(e){"use strict";return e._core.IsLess}),define("pentaho/data/filter/IsGreaterOrEqual",["./Abstract"],function(e){"use strict";return e._core.IsGreaterOrEqual}),define("pentaho/data/filter/IsLessOrEqual",["./Abstract"],function(e){"use strict";return e._core.IsLessOrEqual}),define("pentaho/data/filter/IsLike",["./Abstract"],function(e){"use strict";return e._core.IsLike}),define("pentaho/data/filter/True",["./Abstract"],function(e){"use strict";return e._core.True}),define("pentaho/data/filter/False",["./Abstract"],function(e){"use strict";return e._core.False}),define("pentaho/data/filter/standard",["./Abstract","./Tree","./Property","./And","./Or","./Not","./IsEqual","./IsIn","./IsGreater","./IsLess","./IsGreaterOrEqual","./IsLessOrEqual","./IsLike","./True","./False"],function(){"use strict"}),define("pentaho/visual/role/MappingField",["pentaho/module!_","pentaho/type/Complex","pentaho/i18n!messages"],function(e,t,n){"use strict";return t.extend({constructor:function(e,t){this.base(this.$type.normalizeInstanceSpec(e),t)},get $key(){return this.name},toSpecInContext:function(e){var t=this.base(e);if(t.constructor===Object){var n=0,i=null;for(var r in t){if(++n>1||"name"!==r)break;i=t.name}i&&1===n&&(t=i)}return t},$type:{id:e.id,_normalizeInstanceSpec:function(e){return"string"==typeof e?{name:e}:e},hasNormalizedInstanceSpecKeyData:function(e){return void 0!==e.name},props:[{name:"name",valueType:"string",isRequired:!0,isReadOnly:!0}]}}).localize({$type:n.structured.MappingField}).configure()}),define("pentaho/data/util",["./TableView","./filter/IsEqual","./filter/And"],function(e,t,n){"use strict";function i(e,n,i){var o=e.getColumnIndexById(n);if(o>=0){var a,s=r.getCellValue(i);return a=null==s?null:{_:e.getColumnType(o),value:s,formatted:i.toString()},new t({property:n,value:a})}return null}var r={hasAnyKeyColumns:function(e){for(var t=-1,n=e.getNumberOfColumns();++t<n;)if(e.isColumnKey(t))return!0;return!1},isColumnKeyEffective:function(e,t,n){return null==n&&(n=r.hasAnyKeyColumns(e)),n?e.isColumnKey(t):!r.isColumnTypeContinuous(e.getColumnType(t))},isColumnTypeContinuous:function(e){return"number"===e||"date"===e},getCellValue:function(e){return null==e||e instanceof Date?e:e.valueOf()},createFilterFromCellsMap:function(e,t){var r=[];switch(Object.keys(e).forEach(function(n){var o=i(t,n,e[n]);null!==o&&r.push(o)}),r.length){case 0:return null;case 1:return r[0];default:return new n({operands:r})}},createFilterIsEqualFromCell:function(e,t,n){return i(e,t,n)},getColumnIndexesByIds:function(e,t){for(var n=t.length,i=new Array(n),r=-1;++r<n;){var o=e.getColumnIndexById(t[r]);if(o<0)return null;i[r]=o}return i},filterByPredicate:function(t,n){var i=r.getFilteredRowsByPredicate(t,n);return null===i?t:new e(t).setSourceRows(i)},getFilteredRowsByPredicate:function(e,t){for(var n=!0,i=[],r=-1,o=e.getNumberOfRows();++r<o;)t(e,r)?i.push(r):n&&(n=!1);return n?null:i},buildRowPredicateNotAllNullColumns:function(e){var t=e.length;return function(n,i){for(var r=t;r--;)if(null!==n.getValue(i,e[r]))return!0;return!1}}};return r}),define("pentaho/visual/role/AbstractMapping",["pentaho/module!_","pentaho/type/Complex","./MappingField","pentaho/data/util","pentaho/i18n!messages"],function(e,t,n,i,r){"use strict";return t.extend({get hasFields(){return this.fields.count>0},_onDataOrMappingChanged:function(){},get _modelReference(){var e=this.$references;return e&&e.length?e[0]:null},get fieldIndexes(){var e=this._modelReference;if(null!==e){var t=e.container.data;if(null!==t){var n=this.fields.toArray(function(e){return e.name});return i.getColumnIndexesByIds(t,n)}}return null},$type:{id:e.id,props:[{name:"fields",valueType:[n]}]}}).localize({$type:r.structured.AbstractMapping}).configure()}),define("pentaho/visual/KeyTypes",[],function(){"use strict";var e={dataOrdinal:"dataOrdinal",dataKey:"dataKey"};return Object.freeze(e)}),define("pentaho/visual/role/AbstractProperty",["pentaho/module!_","pentaho/type/Property","./AbstractMapping","../KeyTypes","pentaho/i18n!messages","pentaho/type/loader","pentaho/type/ValidationError","pentaho/data/TableView","pentaho/type/util"],function(e,t,n,i,r,o,a,s,u){"use strict";return t.extend({$type:{id:e.id,valueType:n,defaultValue:function(){return{}},isRequired:!0,get hasAnyListModes(){var e=!1;return this.modes.each(function(t){if(t.dataType.isList)return e=!0,!1}),e},get hasAnyCategoricalModes(){var e=!1;return this.modes.each(function(t){if(!t.isContinuous)return e=!0,!1}),e},get hasAnyContinuousModes(){var e=!1;return this.modes.each(function(t){if(t.isContinuous)return e=!0,!1}),e},hasAnyModes:function(e){var t=e.isContinuous,n=e.isList,i=e.elementDataType?o.resolveType(e.elementDataType).type:null,r=!1;return this.modes.each(function(e){if((null==t||e.isContinuous===t)&&(null==n||e.dataType.isList===n)&&(null==i||i.isSubtypeOf(e.dataType.elementType)))return r=!0,!1}),r},get isVisualKeyEffective(){var e=this.declaringType;return null!==e&&e.visualKeyType===i.dataKey?this.isVisualKey:void 0},validateOn:function(e){var t=this.base(e);if(!t){var n=function(e){t=u.combineErrors(t,e)},i=e.get(this);!t&&i.hasFields&&this.__validateFieldsOn(e,i,n)}return t},__validateFieldsOn:function(e,t,n){for(var i=e.data,o=-1,s=t.fields,u=s.count;++o<u;){var l=s.at(o),c=l.name;(i?i.getColumnIndexById(c):-1)<0&&n(new a(r.format(r.structured.errors.property.fieldIsNotDefinedInAbstractModelData,{name:c,role:this})))}}}}).localize({$type:r.structured.AbstractProperty}).configure()}),define("pentaho/visual/color/Level",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!messages"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["nominal","quantitative","divergent"]}}).localize({$type:i.structured.Level}).configure()}),define("pentaho/visual/color/Palette",["pentaho/module!_","pentaho/type/Complex","./Level"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id,props:[{name:"level",valueType:n,isRequired:!0,defaultValue:"nominal",isReadOnly:!0},{name:"colors",valueType:["string"],countMin:1,isReadOnly:!0}]}}).configure()}),define("pentaho/visual/color/PaletteProperty",["pentaho/module!_","pentaho/type/Property","./Level","./Palette","pentaho/type/loader","pentaho/i18n!messages","pentaho/type/ValidationError","pentaho/type/util","pentaho/util/object","pentaho/util/error","pentaho/module/instancesOf!pentaho/visual/color/Palette"],function(e,t,n,i,r,o,a,s,u,l,c){"use strict";var h=n.type,d=r.resolveType([n]),p=t.extend({$type:{valueType:i,defaultValue:function(e){for(var t=e.__collectOtherUsedPalettesIdsOn(this),n=e.levels,i=e.valueType,r=-1,o=c.length;++r<o;){var a=c[r];if(i.is(a)&&n.has(a.level)&&!u.hasOwn(t,a.$uid))return a}return null},__collectOtherUsedPalettesIdsOn:function(e){var t=Object.create(null);return e.$type.each(function(n){if(n!==this&&n instanceof p.Type){var i=e.get(n);i&&(t[i.$uid]=!0)}},this),t},__levels:h.domain,get levels(){return this.__levels},set levels(e){if(null!=e){this._assertNoSubtypesAttribute("levels"),Array.isArray(e)||(e=[e]);var t=e.map(function(e){return this.to(e)},h),n=h.__intersect(this.__levels.toArray(),t);if(!n.length)throw l.argInvalid("levels",o.structured.errors.property.noLevels);n.sort(h.compareElements.bind(h)),this.__levels=new d(n)}},validateOn:function(e){var t=this.base(e);if(!t){var n=e.get(this);if(n){var i=n.get("level");i&&!this.levels.has(i.$key)&&function(e){t=s.combineErrors(t,e)}(new a(o.format(o.structured.errors.property.levelIsNotOneOfPalettePropertyLevels,{property:this,level:i,propertyLevels:"'"+this.levels.toArray().join("', '")+"'"})))}}return t},_fillSpecInContext:function(e,t){var n=this.base(e,t),i=u.getOwn(this,"__levels");return i&&(n=!0,e.levels=i.toSpecInContext(t)),n}}}).localize({$type:o.structured.Property}).configure();return p}),define("pentaho/visual/Application",["pentaho/module!_","pentaho/type/Complex","pentaho/i18n!model"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id}}).localize({$type:n.structured.Application}).configure()}),define("pentaho/visual/AbstractModel",["pentaho/module!_","pentaho/type/Complex","./role/AbstractProperty","./color/PaletteProperty","./Application","./KeyTypes","pentaho/data/filter/Abstract","pentaho/type/Object","pentaho/util/object","pentaho/type/action/ComplexChangeset","pentaho/i18n!model","pentaho/module/subtypesOf!pentaho/data/filter/Abstract"],function(e,t,n,i,r,o,a,s,u,l,c){"use strict";var h=l.extend({_apply:function(e){this.base(e),this.__areDataOrMappingsChanged(e.$type)&&e._onDataOrMappingsChanged()},__areDataOrMappingsChanged:function(e){for(var t=this.propertyNames,n=-1,i=t.length;++n<i;){var r=t[n];if("data"===r)return!0;if(e.isVisualRole(e.get(r)))return!0}return!1}}),d=n.type,p=i.type;return t.extend({_createChangeset:function(e){return new h(e,this)},_onDataOrMappingsChanged:function(){this.$type.eachVisualRole(function(e){this.get(e)._onDataOrMappingChanged()},this)},get keyFieldNames(){var e=[],t=e.set=Object.create(null),n=this.$type;return n.visualKeyType===o.dataKey&&n.eachVisualRole(function(n){n.isVisualKey&&this.get(n).fields.each(function(n){var i=n.name;u.hasOwn(t,i)||(t[i]=!0,e.push(i))})},this),e},get measureFieldNames(){var e=this.keyFieldNames.set,t=[],n=t.set=Object.create(null),i=this.$type;return i.visualKeyType===o.dataKey&&i.eachVisualRole(function(i){i.isVisualKey||this.get(i).fields.each(function(i){var r=i.name;u.hasOwn(e,r)||u.hasOwn(n,r)||(n[r]=!0,t.push(r))})},this),t},toSpecInContext:function(e){if(e&&e.isJson){e=Object.create(e);var t=e.omitProps;e.omitProps=t=t?Object.create(t):{},null==t.data&&(t.data=!0),null==t.selectionFilter&&(t.selectionFilter=!0),null==t.application&&(t.application=!0)}return this.base(e)},$type:{id:e.id,isAbstract:!0,props:[{name:"application",valueType:r},{name:"data",valueType:"object",isRequired:!0,toValueOn:function(e,t){var n=this.base(e,t);if(null!==n){var i=n.value.toPlainTable();return new s(i)}return n}},{name:"selectionFilter",valueType:a,defaultValue:{_:"or"},isRequired:!0}],eachVisualRole:function(e,t){var n=0;return this.each(function(i){if(this.isVisualRole(i)&&!1===e.call(t,i,n++,this))return!1},this),this},isVisualRole:function(e){return e.isSubtypeOf(d)},isColorPalette:function(e){return e.isSubtypeOf(p)}}}).localize({$type:c.structured.AbstractModel}).configure()}),define("pentaho/action/impl/Target",["module","pentaho/lang/EventSource","../Execution","pentaho/lang/ArgumentRequiredError","pentaho/util/error"],function(e,t,n,i,r){"use strict";var o=n.extend({constructor:function(e,t){if(this.base(),!e)throw new i("action");if(!t)throw new i("target");this.__action=e.clone(),this.__target=t},get action(){return this.__action},get target(){return this.__target},_onPhaseInit:function(){this.target._emitActionPhaseInitEvent(this)},_onPhaseWill:function(){this.target._emitActionPhaseWillEvent(this)},_onPhaseDo:function(){return this.target._emitActionPhaseDoEvent(this)},_onPhaseFinally:function(){this.target._emitActionPhaseFinallyEvent(this)}}),a={errorHandler:function(e,t){t[0].reject(e)},isCanceled:function(e){return e.isCanceled},getCancellationReason:function(e){return e.error}};return t.extend(e.id,{act:function(e){if(!e)throw r.argRequired("action");return this._createActionExecution(e).execute()},_createActionExecution:function(e){return new o(e,this)},_emitActionPhaseInitEvent:function(e){var t=e.action,n=t.eventName;this._emitGeneric(this,[e,t],n,"init",a)},_emitActionPhaseWillEvent:function(e){var t=e.action,n=t.eventName;this._emitGeneric(this,[e,t],n,"will",a)},_emitActionPhaseDoEvent:function(e){var t=e.action,n=t.constructor.isSync,i=t.eventName;return n?(this._emitGeneric(this,[e,t],i,"do",a),null):this._emitGenericAllAsync(this,[e,t],i,"do",a)},_emitActionPhaseFinallyEvent:function(e){var t=e.action,n=t.eventName;this._emitGeneric(this,[e,t],n,"finally")}},{ActionExecution:o})}),define("pentaho/action/Generic",["pentaho/module!_","./Base"],function(e,t){"use strict";return t.extend(e.id,{constructor:function(e){this._init(e)},_init:function(e){},clone:function(){return new this.constructor(this.toSpec())},toSpec:function(){var e={};return this._fillSpec(e),e},_fillSpec:function(e){}})}),define("pentaho/visual/action/Base",["module","pentaho/action/Generic"],function(e,t){"use strict";return t.extend(e.id)}),define("pentaho/visual/action/Update",["pentaho/module!_","./Base","pentaho/util/object"],function(e,t,n){"use strict";return t.extend(e.id,{constructor:function(e){n.setConst(this,"changeset",e&&e.changeset||null)},_fillSpec:function(e){this.base(e),this.changeset&&(e.changeset=this.changeset)}},{get id(){return e.id},get isSync(){return!1}})}),define("pentaho/visual/action/ModelChangedError",["module","pentaho/lang/UserError"],function(e,t){return t.extend(e.id,{constructor:function(){this.base("Model changed.")},get name(){return"model-changed"}})}),define("pentaho/visual/action/UpdateExecution",["module","pentaho/action/impl/Target","./ModelChangedError","pentaho/type/ValidationError"],function(e,t,n,i){return t.ActionExecution.extend(e.id,{assertModelUnchanged:function(){if(this.target.isDirtyNew)throw new n},_validate:function(){var e=this.base();return null===e&&null!==(e=this.target.validate())&&(e=[new i("Model is invalid:\n - "+e.join("\n - "))]),e}})}),define("pentaho/visual/action/Interaction",["module","./Base"],function(e,t){"use strict";return t.extend(e.id)}),define("pentaho/visual/action/InteractionExecution",["module","pentaho/action/impl/Target","./ModelChangedError"],function(e,t,n){return t.ActionExecution.extend(e.id,{_onPhaseInit:function(){this.target.isDirty?this.reject(new n):this.base()},_validate:function(){var e=this.base();return null===e&&this.target.isDirty&&(e=[new n]),e}})}),define("pentaho/visual/action/mixins/Data",["pentaho/module!_","pentaho/visual/action/Interaction","pentaho/data/filter/Abstract","pentaho/module/subtypesOf!pentaho/data/filter/Abstract","pentaho/data/filter/standard"],function(e,t,n){"use strict";var i=n.type;return t.extend(e.id,{_init:function(e){this.base(e),this.dataFilter=e&&e.dataFilter},get dataFilter(){return this.__dataFilter},set dataFilter(e){this.__dataFilter=i.to(e)},_fillSpec:function(e){this.base(e),this.__dataFilter&&(e.dataFilter=this.__dataFilter)}})}),define("pentaho/visual/action/mixins/Positioned",["pentaho/module!_","pentaho/visual/action/Interaction"],function(e,t){"use strict";return t.extend(e.id,{_init:function(e){this.base(e),this.position=e&&e.position},get position(){return this.__position},set position(e){this.__position=e||null},_fillSpec:function(e){this.base(e),this.__position&&(e.position={x:this.__position.x,y:this.__position.y})}})}),define("pentaho/visual/action/SelectionModes",["module","pentaho/util/logger","pentaho/debug","pentaho/debug/Levels","pentaho/data/util"],function(e,t,n,i,r){"use strict";var o=n.testLevel(i.debug,e),a={replace:function(e,t){return t},toggle:function(e,n){if(o&&t.log("TOGGLE BEGIN"),!n)return e;var i=this.data;if(!i)return e;var s=null;switch(e.kind){case"true":s=!0;break;case"false":s=!1;break;case"or":0===e.operands.count&&(s=!1)}if(null===s){var u=this.measureFieldNames;if(u.length>0){var l=r.getColumnIndexesByIds(i,u),c=r.buildRowPredicateNotAllNullColumns(l);i=r.filterByPredicate(i,c)}var h=i.filter(n),d=h.filter(e);s=h.getNumberOfRows()===d.getNumberOfRows()}var p=s?a.remove:a.add,f=p.call(this,e,n);return o&&t.log("TOGGLE END"),f},add:function(e,t){return e.or(t)},remove:function(e,t){return e.andNot(t)}};return a}),define("pentaho/visual/action/Select",["pentaho/module!_","./Interaction","./mixins/Data","./mixins/Positioned","./SelectionModes","pentaho/type/Function","pentaho/util/object","pentaho/util/fun","pentaho/lang/ArgumentInvalidError","pentaho/lang/ArgumentInvalidTypeError"],function(e,t,n,i,r,o,a,s,u,l){"use strict";function c(e,t){if(null!=e){if("string"==typeof e){if(!a.hasOwn(r,e))throw new u(t,"Not one of the standard selection mode names.");e=r[e]}else if(!s.is(e))throw new l(t,["string","function"],typeof e);return e}return h()}function h(){return c((e.config||{}).defaultSelectionMode||r.replace,"defaultSelectionMode")}return t.extend(e.id,{constructor:function(e){this.base(e),this.selectionMode=e&&e.selectionMode},get selectionMode(){var e=this.__selectionMode;return e?e.valueOf():h()},set selectionMode(e){this.__selectionMode=c(e,"selectionMode")},_fillSpec:function(e){this.base(e),this.__selectionMode&&(e.selectionMode=this.__selectionMode)}},{get id(){return e.id}}).mix(n).mix(i)}),define("pentaho/visual/action/SelectExecution",["module","./InteractionExecution"],function(e,t){return t.extend(e.id,{_doDefault:function(){var e=this.target,t=this.action.selectionMode.call(e,e.selectionFilter,this.action.dataFilter);return e.selectionFilter=t&&t.toDnf(),null}})}),define("pentaho/visual/action/Execute",["pentaho/module!_","./Interaction","./mixins/Data","./mixins/Positioned"],function(e,t,n,i){"use strict";return t.extend(e.id,{},{get id(){return e.id}}).mix(n).mix(i)}),define("pentaho/visual/role/Mode",["pentaho/module!_","pentaho/type/Complex","pentaho/i18n!messages"],function(e,t,n){"use strict";return t.extend({constructor:function(e,t){this.base(this.$type.normalizeInstanceSpec(e),t)},get $key(){return this.get("dataType").$key+"|"+this.isContinuous},canApplyToFieldTypes:function(e){var t=this.dataType,n=t.elementType;if(t.isElement){if(e.length>1)return!1}else if(!t.isList)return!0;return e.every(function(e){return e.isSubtypeOf(n)})},toSpecInContext:function(e){var t=this.base(e);if(t.constructor===Object){var n=0,i=null;for(var r in t){if(++n>1||"dataType"!==r)break;i=t.dataType}null!==i&&1===n&&(t=i)}return t},$type:{id:e.id,isEntity:!0,_normalizeInstanceSpec:function(e){return e.constructor!==Object?{dataType:e}:e},hasNormalizedInstanceSpecKeyData:function(e){return void 0!==e.dataType||void 0!==e.isContinuous},props:[{name:"dataType",valueType:"type",isRequired:!0,defaultValue:"instance",isReadOnly:!0},{name:"isContinuous",valueType:"boolean",isRequired:!0,isReadOnly:!0,defaultValue:function(){return this.dataType.elementType.isContinuous}}]}}).localize({$type:n.structured.Mode}).configure()}),define("pentaho/visual/role/Mapping",["pentaho/module!_","./AbstractMapping","./MappingField","./Mode","pentaho/type/action/Transaction","pentaho/i18n!messages"],function(e,t,n,i,r,o){"use strict";return t.extend({_onDataOrMappingChanged:function(){this.__mode=void 0},__mode:void 0,get mode(){var e;return null!==r.current?e=this.__getMode():void 0===(e=this.__mode)&&(this.__mode=e=this.__getMode()),e||null},__getMode:function(){var e=this._modelReference;if(null!==e)return e.property.getModeEffectiveOn(e.container)},$type:{id:e.id,props:[{name:"modeFixed",valueType:i}]}}).localize({$type:o.structured.Mapping}).configure()}),define("pentaho/visual/role/Property",["pentaho/module!_","./AbstractProperty","./Mapping","./Mode","pentaho/i18n!messages","pentaho/i18n!/pentaho/type/i18n/types","pentaho/type/loader","pentaho/type/util","pentaho/type/ValidationError","pentaho/util/object","pentaho/util/error","pentaho/util/arg"],function(e,t,n,i,r,o,a,s,u,l,c,h){"use strict";function d(e){if(e=+e,!(isNaN(e)||e<0))return Math.floor(e)}var p=i.type,f=a.resolveType([i]);return t.extend({$type:{id:e.id,valueType:n,_init:function(e,t){if(e=this.base(e,t)||e,!this.declaringType||this.isRoot){var n=e.modes;null!=n?this.__setModes(n):this.isRoot&&null===this.__modes&&this.__setModes([{dataType:"string"}],!0);var i=e.isVisualKey;null!=i?this.isVisualKey=i:this.isRoot&&null===this.__isVisualKey&&(this.isVisualKey=this.hasAnyCategoricalModes),e=Object.create(e),e.modes=void 0,e.isVisualKey=void 0}return e},__modes:null,__isModesDefault:!0,get modes(){return this.__modes},set modes(e){this._assertNoSubtypesAttribute("modes"),null!=e&&this.__setModes(e,!1)},__setModes:function(e,t){Array.isArray(e)||(e=[e]);var n,i=e.map(function(e){return p.to(e)});if(n=null===this.__modes?i:p.__intersect(this.__modes.toArray(),i),!n.length)throw c.argInvalid("modes",r.structured.errors.property.noModes);this.__modes=new f(n,{isReadOnly:!0}),this.__isModesDefault=!!t},getModeEffectiveOn:function(e){var t=e.get(this),n=t.modeFixed;if(null!==n)return n;var i=e.data;if(null===i)return null;var r=t.fieldIndexes;if(null===r)return null;if(0===r.length)return null;for(var o=r.map(function(e){var t=i.getColumnType(e);return a.resolveType(t).type}),s=this.modes,u=s.count,l=-1;++l<u;)if(n=s.at(l),n.canApplyToFieldTypes(o))return n;return null},__isVisualKey:null,get isVisualKey(){return!!this.__isVisualKey},set isVisualKey(e){this._assertNoSubtypesAttribute("isVisualKey"),null!=e&&(null===this.__isVisualKey?this.__isVisualKey=!!e:e&&!this.__isVisualKey&&(this.__isVisualKey=!0))},get fields(){var e=l.getOwn(this,"__fields");if(!e){var t=this;this.__fields=e=Object.freeze({get isRequired(){return t.__fieldsIsRequired},set isRequired(e){t.__fieldsIsRequired=e},get countMin(){return t.__fieldsCountMin},set countMin(e){t.__fieldsCountMin=e},get countMax(){return t.__fieldsCountMax},set countMax(e){t.__fieldsCountMax=e},countRangeOn:function(e,n){return t.__fieldsCountRangeOn(e,n)}})}return e},set fields(e){if(null!=e){var t=this.fields;"isRequired"in e&&(t.isRequired=e.isRequired),"countMin"in e&&(t.countMin=e.countMin),"countMax"in e&&(t.countMax=e.countMax)}},dynamicAttributes:{__fieldsIsRequired:{value:!1,cast:Boolean,group:"fields",localName:"isRequired",combine:function(e,t){return function(n,i){return e.call(this,n,i)||t.call(this,n,i)}}},__fieldsCountMin:{value:0,cast:d,group:"fields",localName:"countMin",combine:function(e,t){return function(n,i){return Math.max(e.call(this,n,i),t.call(this,n,i))}}},__fieldsCountMax:{value:function(e,t){var n=null;if(!h.optional(t,"ignoreCurrentMode",!1)){var i=this.get(e);n=i&&i.mode}return(null!==n?n.dataType.isList:e.hasAnyListModes)?1/0:1},cast:d,group:"fields",localName:"countMax",combine:function(e,t){return function(n,i){return Math.min(e.call(this,n,i),t.call(this,n,i))}}}},__fieldsCountRangeOn:function(e,t){var n=this.__fieldsIsRequiredOn(e,t),i=this.__fieldsCountMinOn(e,t),r=this.__fieldsCountMaxOn(e,t);return n&&i<1&&(i=1),r<i&&(r=i),{min:i,max:r}},validateOn:function(e){var t=this.base(e);if(!t){var n=function(e){t=s.combineErrors(t,e)},i=e.get(this),a=this.__fieldsCountRangeOn(e),l=i.fields.count;if(l<a.min?n(new u(o.get("errors.property.countOutOfRange",[this.label+" "+i.$type.get("fields").label,l,a.min,a.max]))):l>a.max&&n(new u(o.get("errors.property.countOutOfRange",[this.label+" "+i.$type.get("fields").label,l,a.min,a.max]))),!t){var c=i.modeFixed;null!==c&&(this.modes.has(c.$key)||n(new u(r.format(r.structured.errors.property.modeFixedInvalid,{role:this})))),!t&&l>0&&null==i.mode&&n(new u(r.format(r.structured.errors.property.noApplicableMode,{role:this})))}}return t},_fillSpecInContext:function(e,t){var n=this.base(e,t),i=l.getOwn(this,"__modes");i&&!this.__isModesDefault&&(n=!0,e.modes=i.toSpecInContext(t));var r=l.getOwn(this,"__isVisualKey",null);return null!==r&&(this.isRoot&&r===this.hasAnyCategoricalModes||(n=!0,e.isVisualKey=r)),n}}}).configure()}),define("pentaho/visual/Model",["pentaho/module!_","./AbstractModel","./KeyTypes","pentaho/action/impl/Target","pentaho/type/action/Transaction","./action/Update","./action/UpdateExecution","./action/Interaction","./action/InteractionExecution","./action/Select","./action/SelectExecution","./action/Execute","pentaho/util/text","pentaho/util/error","pentaho/debug","pentaho/debug/Levels","pentaho/util/logger","pentaho/i18n!model","./role/Property"],function(e,t,n,i,r,o,a,s,u,l,c,h,d,p,f,_,m,g){"use strict";function y(){var e=null,t=null;return{promise:new Promise(function(n,i){e=n,t=i}),resolve:e,reject:t,execution:null}}function v(e,t){var n;if(null!=e&&null!=t){if(e===C)return C;if(t===C)return C;n=e.compose(t)}else n=e||t;return null!=n&&n.hasChanges?n:null}var b=f.testLevel(_.debug,e),C={};return t.extend({constructor:function(e){this.base(e),this._init(e)},_init:function(e){var t=e&&e.isAutoUpdate;this.__isAutoUpdate=null==t||Boolean(t),this.__changeset=C,
this.__dirtyLastVersion=this.$version,this.__updateControl=null},get isAutoUpdate(){return this.__isAutoUpdate},get isDirty(){return this.isUpdating||this.isDirtyNew},get isDirtyNew(){var e=this.__changeset;if(e===C)this.__dirtyLastVersion=this.$version;else{var t=r.getChangesetsPending(this);if(null!==t)for(var n=t.length,i=-1;++i<n;){var o=t[i];o.targetVersion>=this.__dirtyLastVersion&&(this.__changeset=e=v(e,o),this.__dirtyLastVersion=o.targetVersion+1)}}return null!==e},_onChangeFinally:function(e){e.isDone&&(this.isAutoUpdate&&e.action.hasChanges?this._onAutoUpdate():this.isDirtyNew),this.base(e)},_onAutoUpdate:function(){this.update().catch(function(e){b&&m.debug("Auto-update was rejected: "+e)})},get isUpdating(){return null!==this.__updateControl},update:function(){var e=this.__updateControl;return this.isDirtyNew?null===e?(this.__updateControl=e={current:y(),next:null},this.__updateBegin(),e.current.promise):(null===e.next&&(e.next=y()),e.next.promise):null!==e?e.current.promise:Promise.resolve()},__updateBegin:function(){var e=this.__changeset;this.__changeset=null,e===C&&(e=null);var t=this.act(new o({changeset:e}));this.__updateControl.current.execution=t,t.promise.then(this.__updateResolved.bind(this),this.__updateRejected.bind(this))},__updateResolved:function(){this.__updateControl.current.resolve(),this.__updateNext()},__updateRejected:function(e){var t=this.__updateControl,n=t.current.execution;if(n.isFailed)this.__changeset=C;else{var i=n.action.changeset||C;this.__changeset=v(i,this.__changeset)}t.current.reject(e),this.__updateNext()},__updateNext:function(){var e=this.__updateControl,t=e.next;null!==t?Promise.resolve().then(function(){e.next=null,e.current=t,this.__updateBegin()}.bind(this)):this.__updateControl=null},select:function(e){var t=e instanceof l?e:new l(e);return this.act(t)},execute:function(e){var t=e instanceof h?e:new h(e);return this.act(t)},$type:{id:e.id,isAbstract:!0,props:[{name:"width",valueType:"number",isRequired:!0,defaultValue:300,isBrowsable:!1},{name:"height",valueType:"number",isRequired:!0,defaultValue:300,isBrowsable:!1}],_init:function(e,t){return e=this.base(e,t)||e,this.__setVisualKeyType(e.visualKeyType),e},__visualKeyType:void 0,get visualKeyType(){return this.__visualKeyType},__setVisualKeyType:function(e){e=d.nonEmptyString(e);var t=this.__visualKeyType;if(void 0===t){if(null===e){if(this.isAbstract)return;e=n.dataKey}else if(!n.hasOwnProperty(e))throw p.argRange("visualKeyType");return void(this.__visualKeyType=e)}if(null!==e&&t!==e)throw p.operInvalid("Once defined, 'visualKeyType' cannot be changed.")}}}).mix(i).implement({_createActionExecution:function(e){return e instanceof o?new a(e,this):e instanceof l?new c(e,this):e instanceof s?new u(e,this):this.base(e)}}).localize({$type:g.structured.Model}).configure()}),define("pentaho/util/BitSet",["module","pentaho/lang/Base"],function(e,t){"use strict";return t.extend(e.id,{constructor:function(e){this.set(e||0)},get isEmpty(){return 0===this.__bits},get:function(){return this.__bits},is:function(e){return this.__bits===e},set:function(e){this.__bits=null==e?-1:this.__bits|e},clear:function(e){this.__bits=null==e?0:this.__bits&~e},isSubsetOf:function(e){var t=this.__bits;return 0!==t&&(t|e)===e}})}),define("pentaho/visual/impl/View",["module","pentaho/lang/Base","../Model","pentaho/type/action/ComplexChangeset","pentaho/lang/UserError","pentaho/lang/RuntimeError","../action/Update","../action/ModelChangedError","pentaho/util/object","pentaho/util/fun","pentaho/util/BitSet","pentaho/util/error","pentaho/util/arg","pentaho/util/logger"],function(e,t,n,i,r,o,a,s,u,l,c,h,d,p){"use strict";function f(e,t){var n=0;return t.split("And").forEach(function(t){var i=e.PropertyGroups[t];null==i||isNaN(+i)?p.warn("There is no registered property group with name '"+t+"'."):n|=i}),n}var _=a.id,m=n.type.id,g=/^_update(.+)$/;return t.extend(e.id,{constructor:function(e){if(this.__model=d.required(e,"model","viewSpec"),!(this.__model instanceof n))throw h.argInvalidType("viewSpec.model",m,typeof this.__model);this.__domContainer=d.required(e,"domContainer","viewSpec"),this.__updateEventHandle=this.__model.on(_,{do:this._update.bind(this)}),this.__hasUpdatedAll=!1},get domContainer(){return this.__domContainer},get model(){return this.__model},get hasUpdatedAll(){return this.__hasUpdatedAll},_update:function(e,t){var n=this.__hasUpdatedAll?t.changeset:null,i=new c;if(this.__onChangeClassify(i,n),!i.isEmpty){var r=this.__selectUpdateMethod(i);return Promise.resolve(this[r.name](e)).then(this.__onUpdateResolved.bind(this,e))}},__onUpdateResolved:function(e){e.isRejected||(this.__hasUpdatedAll=!0)},__onChangeClassify:function(e,t){function n(t,o){o instanceof i?o.propertyNames.forEach(function(i){var a,s=t[i];if(s)switch(typeof s){case"string":a=s;break;case"object":return n(s,o.getChange(i));default:throw new Error("Invalid property groups tree.")}else a="General";e.set(r.PropertyGroups[a])}):e.set(t._||r.PropertyGroups.General)}var r=this.constructor;if(null===t)return void e.set(r.PropertyGroups.All);n(r.__PropertyGroupOfProperty,t)},__selectUpdateMethod:function(e){var t=this.constructor,n=t.__UpdateMethods[e.get()];return n||t.__UpdateMethodsList.some(function(t){return!!e.isSubsetOf(t.mask)&&(n=t,!0)}),n},dispose:function(){null!==this.__domContainer&&(this.__domContainer=null,this.__updateEventHandle.dispose(),this.__updateEventHandle=null)},extend:function(e,t){if(this.base(e,t),e){var n=this.constructor,i=Object.prototype;for(var r in e)if(!(e in i)){var o,a=e[r];if(l.is(a)&&(o=g.exec(r))){var s=f(n,o[1]);if(s&&!n.__UpdateMethods[s]){var u={name:r,mask:s};n.__UpdateMethods[s]=u,n.__UpdateMethodsList.push(u),n.__UpdateMethodsList.sort(function(e,t){return new c(e.mask).isSubsetOf(t.mask)?-1:1})}}}}return this}},{_subclassed:function(e,t,n,i){e.PropertyGroups=Object.create(this.PropertyGroups),e.__PropertyGroupOfProperty=Object.create(this.__PropertyGroupOfProperty),e.__UpdateMethods=Object.create(this.__UpdateMethods),e.__UpdateMethodsList=this.__UpdateMethodsList.slice(),this.base(e,t,n,i)},PropertyGroups:u.assignOwn(Object.create(null),{All:-1,Ignored:0,General:1,Data:2,Size:4,Selection:8}),__PropertyGroupOfProperty:u.assignOwn(Object.create(null),{data:"Data",selectionFilter:"Selection",width:"Size",height:"Size"}),__UpdateMethods:Object.create(null),__UpdateMethodsList:[]}).implement({_updateAll:function(e){}})}),define("pentaho/visual/role/ExternalMapping",["pentaho/module!_","./AbstractMapping","pentaho/i18n!messages"],function(e,t,n){"use strict";return t.extend({get strategy(){var e=this._modelReference;return null!==e?e.container.__getAmbientRoleStrategy(e.property.name):null},get mode(){var e=this._modelReference;return null!==e?e.container.__getAmbientRoleMode(e.property.name):null},$type:{id:e.id,props:[{name:"isCategoricalFixed",valueType:"boolean",isRequired:!0,defaultValue:!1}]}}).localize({$type:n.structured.ExternalMapping}).configure()}),define("pentaho/visual/role/ExternalProperty",["pentaho/module!_","./AbstractProperty","./ExternalMapping","./Mode","../KeyTypes","pentaho/module/subtypesOf!pentaho/visual/role/adaptation/Strategy","pentaho/i18n!messages","pentaho/type/loader","pentaho/type/ValidationError","pentaho/data/TableView","pentaho/type/util","pentaho/util/object","pentaho/util/arg"],function(e,t,n,i,r,o,a,s,u,l,c,h,d){"use strict";var p=o.filter(function(e){return e.type.isBrowsable}).map(function(e){return e.type}),f=s.resolveType([i]);return t.extend({$type:{id:e.id,valueType:n,_init:function(e,t){e=this.base(e,t)||e;var n=this.declaringType;if(null!==n){var i=n.get("model").valueType,r=i.get(this.name);h.setConst(this,"_internalProperty",r),this.label=r.label,this.description=r.description,this.ordinal=r.ordinal,this.category=r.category,this.helpUrl=r.helpUrl,this.isBrowsable=r.isBrowsable}if(this.isRoot){null==e.strategies&&this.__setStrategyTypes(p,!0)}return e},_internalProperty:null,get isVisualKey(){return this._internalProperty.isVisualKey},isApplicableOn:function(e){return this.base(e)&&this._internalProperty.isApplicableOn(e.model)},get fields(){var e=h.getOwn(this,"__fields");if(!e){var t=this;this.__fields=e=Object.freeze({countRangeOn:function(e,n){return t.__fieldsCountRangeOn(e,n)}})}return e},__fieldsCountRangeOn:function(e,t){var n=this._internalProperty.fields.countRangeOn(e.model,t);if(this.__areAllStrategyApplicationsIdentity)return n;var i=null;if(!d.optional(t,"ignoreCurrentMode",!1)){var r=e.get(this);i=r&&r.mode}var o=(null!==i?i.dataType.isList:this.hasAnyListModes)?1/0:1;return{min:n.min>0?1:0,max:o}},get __areAllStrategyApplicationsIdentity(){var e=this.__strategyTypeApplicationList;return null===e||e.every(function(e){return e.strategyType.isIdentity})},__modes:null,__strategyTypeList:null,__isStrategyTypesDefault:!0,__strategyTypeApplicationList:null,get modes(){return this.__modes},get strategies(){return this.__strategyTypeList},set strategies(e){this._assertNoSubtypesAttribute("strategies"),null!=e&&this.__setStrategyTypes(e,!1)},__setStrategyTypes:function(e,t){var n=[],r=Object.create(null);e.forEach(function(e){var t=s.resolveType(e).type;h.hasOwn(r,t.uid)||(r[t.uid]=!0,n.push(t))});var o=[],a=new f,u=this.isVisualKeyEffective;this._internalProperty.modes.each(function(e){var t=e.isContinuous;n.forEach(function(n){var r=n.getInputTypeFor(e.dataType,u);if(null!=r){var s=new i({dataType:r,isContinuous:t});a.add(s),s=a.get(s.$key),o.push(Object.freeze({externalMode:s,strategyType:n,internalMode:e}))}})}),this.__modes=a,this.__strategyTypeList=n,this.__isStrategyTypesDefault=!!t,this.__strategyTypeApplicationList=o},selectAdaptationStrategyOn:function(e){var t=e.get(this);if(!t.hasFields)return null;var n=t.fieldIndexes;if(null===n)return null;for(var i=e.data,r=this.__strategyTypeApplicationList,o=r.length,a=-1,s=t.isCategoricalFixed;++a<o;){var u=r[a];if(!s||!u.externalMode.isContinuous){var l=this.__validateStrategyApplication(u,i,n);if(null!==l)return l}}return null},__validateStrategyApplication:function(e,t,n){var i=e.externalMode.dataType,r=n.length;if(!i.isList&&r>1)return null;for(var o=i.elementType,a=-1;++a<r;){var u=n[a];if(!s.resolveType(t.getColumnType(u)).type.isSubtypeOf(o))return null}var l=e.strategyType.validateApplication(t,n);if(!l.isValid)return null;var c=Object.create(e);return c.externalFieldIndexes=n,c.addsFields=l.addsFields,Object.freeze(c)},validateOn:function(e){var t=this.base(e);if(!t){var n=function(e){t=c.combineErrors(t,e)},i=e.get(this);i.hasFields&&null===i.strategy&&n(new u(a.format(a.structured.errors.property.noStrategy,{role:this}))),n(this._internalProperty.validateOn(e.model))}return t},_fillSpecInContext:function(e,t){var n=this.base(e,t),i=h.getOwn(this,"__strategyTypeList");return i&&!this.__isStrategyTypesDefault&&(n=!0,e.strategies=i.map(function(e){return e.toSpecInContext(t)})),n}}}).configure()}),define("pentaho/visual/ModelAdapter",["pentaho/module!_","./AbstractModel","./Model","./role/ExternalProperty","pentaho/data/filter/True","pentaho/data/filter/False","pentaho/data/filter/Or","pentaho/data/filter/And","pentaho/type/loader","pentaho/type/action/Transaction","pentaho/type/action/ComplexChangeset","pentaho/data/Table","pentaho/data/util","pentaho/util/object","pentaho/util/error","pentaho/util/logger","pentaho/debug","pentaho/debug/Levels","pentaho/i18n!model"],function(e,t,n,i,r,o,a,s,u,l,c,h,d,p,f,_,m,g,y){"use strict";function v(e){var t;switch(e.kind){case"true":case"false":case"or":return null;case"and":t=null;for(var n=[],i=e.operands,a=i.count,u=0;u<a;u++){var l=i.at(u);if("isEqual"===l.kind){if(null===t&&(t=Object.create(null)),void 0!==t[l.property]&&t[l.property]!==l.value)return o.instance;t[l.property]=l.value}else n.push(l.visit(v.bind(this)))}return null!==t&&(t=this.modelAdapter.__convertValuesMap(t,this.toExternal),n.push.apply(n,Object.keys(t).map(function(e){return d.createFilterIsEqualFromCell(this.internalData,e,t[e])},this))),new s({operands:n});case"isEqual":return t={},t[e.property]=e.value,t=this.modelAdapter.__convertValuesMap(t,this.toExternal),e=d.createFilterFromCellsMap(t,this.internalData),null!==e?e:r.instance;default:throw f.argInvalid("filter","Converting "+e.kind+" filter is not supported.")}}function b(e){var t;switch(t=e.kind){case"and":case"or":for(var n=-1,i=e.operands,r=i.count,o=[];++n<r;){var a=i.at(n).visit(b);a.kind===t?o.push.apply(o,a.operands.toArray()):o.push(a)}return new e.constructor({operands:o})}}function C(e,t){var n=null,i=0,r=e.fields.count;return e.fields.each(function(e){var o=e.name,a=t[o];void 0!==a&&(a=d.getCellValue(a),null==n&&(n=new Array(r)),n[i]=a),++i}),n}function O(e,t){return 1===e.length&&e[0]===t}function x(e,t,n){if(null!==n&&t.transactionVersion===n.transactionVersion)return t;var i=e.data,r=null===t||t.externalData!==i,o=r?null:t.roleInfoMap,a=Object.create(null),s=[],u=!1;e.$type.eachVisualRole(function(t){var r=t.name,l=null===o?{transactionVersion:0,strategyApplication:null,strategy:null}:p.cloneShallow(o[r]),c=null!==n?n.getChange(t):null;if(null===c||c.hasChanges||(c=null),null!==i&&(null===c||l.transactionVersion<c.transactionVersion)){var h=t.selectAdaptationStrategyOn(e),d=l.strategyApplication;A(h,d)||(l.strategyApplication=h,l.strategy=null,u||(null!==d&&d.addsFields||null!==h&&h.addsFields)&&(u=!0))}null!==c&&(l.transactionVersion=c.transactionVersion),a[r]=l,s.push(l)});var l=null;return null!==i&&(r||u||(l=t.internalData),null===l&&(l=u?new h(i.toSpec()):i)),null!==l&&s.forEach(function(e){var t=e.strategyApplication;null===t||!u&&null!==e.strategy||(e.strategy=t.strategyType.apply(l,t.externalFieldIndexes))}),{transactionVersion:null!==n?n.transactionVersion:0,externalData:i,internalData:l,roleInfoMap:a}}function A(e,t){return e===t||null!=e&&null!=t&&e.internalMode.equals(t.internalMode)&&e.externalMode.equals(t.externalMode)&&e.strategyType===t.strategyType&&e.externalFieldIndexes.length===t.externalFieldIndexes.length&&e.externalFieldIndexes.every(function(e,n){return t.externalFieldIndexes[n]===e})}var j=c.extend({constructor:function(e,t){this.base(e,t),this.__adaptationModel=t.__adaptationModel,this.__getAdaptationModel()},__getAdaptationModel:function(){return this.__adaptationModel=x(this.target,this.__adaptationModel,this)},_apply:function(t){this.base(t);try{var n=this.__getAdaptationModel();n.transactionVersion=0;var i=n.roleInfoMap;Object.keys(i).forEach(function(e){i[e].transactionVersion=0}),t.__adaptationModel=n}catch(t){m.testLevel(g.error,e)&&_.error("ModelAdapterChangeset apply failed: "+(t&&t.message))}}}),w=i.type;return t.extend({constructor:function(){if(this.base.apply(this,arguments),null===this.model)throw f.argRequired("spec.model");this.__adaptationModel=x(this,null,null),this.__updateInternalModel(),this.on("change",{init:this.__onChangeInitHandler.bind(this)},{priority:-1/0,isCritical:!0}),this.model.on("change",{init:this.__onModelChangeInitHandler.bind(this)},{priority:-1/0,isCritical:!0})},_createChangeset:function(e){return new j(e,this)},__adaptationModel:null,__getAmbientAdaptationModel:function(){return(this.$changeset||this).__getAdaptationModel()},__getAdaptationModel:function(){return this.__adaptationModel},__getAmbientRoleMode:function(e){var t=this.__getAmbientAdaptationModel().roleInfoMap[e].strategyApplication;return t&&t.externalMode},__getAmbientRoleStrategy:function(e){return this.__getAmbientAdaptationModel().roleInfoMap[e].strategy},__onChangeInitHandler:function(e){O(e.action.propertyNames,"selectionFilter")?this.__updateInternalSelection():this.__updateInternalModel()},__onModelChangeInitHandler:function(e){e.action.hasChange("selectionFilter")&&this.__updateExternalSelection()},__updateInternalModel:function(){var e=this.__getAmbientAdaptationModel(),t=e.roleInfoMap,n=this.model,i=this.__calcInternalSelectionFilter();l.enter().using(function(r){n.data=e.internalData,n.selectionFilter=i,Object.keys(t).forEach(function(e){var i=t[e],r=i.strategyApplication,o=n.get(e);o.modeFixed=r&&r.internalMode,o.fields=null!==r?i.strategy.outputFieldNames:[]}),r.accept()})},__updateInternalSelection:function(){this.model.selectionFilter=this.__calcInternalSelectionFilter()},__updateExternalSelection:function(){this.selectionFilter=this.__calcExternalSelectionFilter()},__calcInternalSelectionFilter:function(){var t=this.selectionFilter;if(null!==t)try{return this._convertFilterToInternal(t)}catch(t){return m.testLevel(g.info,e)&&_.info("It was not possible to convert external selection filter: "+(t&&t.message)),null}return null},__calcExternalSelectionFilter:function(){var t=this.model.selectionFilter;if(null!==t)try{return this._convertFilterToExternal(t)}catch(t){return m.testLevel(g.info,e)&&_.info("It was not possible to convert internal selection filter: "+(t&&t.message)),null}return null},_convertFilterToInternal:function(e){var t=this.__getAmbientAdaptationModel(),n=t.internalData;if(null===n)return null;var i={modelAdapter:this,internalData:n,toExternal:!1};return e.visit(b).visit(v.bind(i))},_convertFilterToExternal:function(e){var t=this.__getAmbientAdaptationModel(),n=t.internalData;if(null===n)return null;var i={modelAdapter:this,internalData:n,toExternal:!0};return e.visit(b).visit(v.bind(i))},__convertValuesMap:function(e,t){var n=this.__getAmbientAdaptationModel().roleInfoMap,i=Object.create(null),r=t?this.model:this;return r.$type.eachVisualRole(function(o){var a,s=r.get(o);if(s.hasFields&&null!==(a=n[o.name].strategy)){var u=C(s,e);if(null!==u){var l=t?a.invert(u):a.map(u);if(null==l)throw f.argInvalid("originalValuesMap","Unable to convert values.");var c=t?a.inputFieldNames:a.outputFieldNames;l.forEach(function(e,t){void 0!==e&&(i[c[t]]=e)})}}}),i},$type:{id:e.id,isAbstract:!0,get visualKeyType(){return this.get("model").valueType.visualKeyType},props:[{name:"model",valueType:n,isBoundary:!0,isRequired:!0,isReadOnly:!0,defaultValue:function(){return{}}}]}}).implement({$type:{_configureProperties:function(e){var t=this._normalizePropertiesSpec(e),n=Object.create(null);t.forEach(function(e,t){p.hasOwn(n,e.name)||(n[e.name]={spec:e,index:t})});var i=n.model;if(null!=i){var r=i.spec.valueType;if(null!=r){var o=this.get("model").valueType,a=u.resolveType(r).type;if(o!==a&&a.isSubtypeOf(o)){this.label=a.label,this.description=a.description,this.ordinal=a.ordinal,this.category=a.category,this.helpUrl=a.helpUrl;var s=[];a.eachVisualRole(function(t){var i=t.name;if(t!==o.get(i,!0)){var r,a=p.getOwn(n,i,null);null!==a?(r=Object.create(a.spec),this.has(i)||(r.base=w),e[a.index]=null):r={name:i,base:this.has(i)?void 0:w},s.push(r)}},this),s.length>0&&(s.unshift(i.index+1,0),t.splice.apply(t,s),e=t.filter(function(e){return null!==e}))}}}this.base(e)}}}).localize({$type:y.structured.ModelAdapter}).configure()}),define("pentaho/visual/action/WellKnownErrorNames",[],function(){"use strict";var e={emptyData:"empty-data",invalidData:"invalid-data",bigData:"big-data",modelChanged:"model-changed"};return Object.freeze(e)}),define("pentaho/visual/color/util",["require","pentaho/util/error"],function(e,t){function n(e,t){var n,i={},r=e.length,o=t.length;for(n=0;n<r&&n<o;n++)i[e[n]]=t[n];for(n=o;n<r;n++)i[e[n]]="#000000";return i}function i(e,t,n,i,a){return e<t?e=t:e>n&&(e=n),arguments.length>4?o(e,t,n,u(i),u(a)):r(e,t,n,i)}function r(e,t,n,i){var r,a,s,l,c=i.length-1,h=n-t;if(h<=0||!c)a=r=c;else{var d=(e-t)/h*c;r=Math.floor(d),a=Math.ceil(d)}return s=u(i[r]),l=a!==r?u(i[a]):s,o(e,r/c*h+t,a/c*h+t,s,l)}function o(e,t,n,i,r){var o;if(n-t<=0)o=r;else{var a=(e-t)/(n-t);o=[Math.floor(a*(r[0]-i[0])+i[0]),Math.floor(a*(r[1]-i[1])+i[1]),Math.floor(a*(r[2]-i[2])+i[2])]}return c(o)}function a(e,t){return e=u(e),t=Math.pow(.7,null!=t?t:1),c(Math.max(0,Math.floor(t*e[0])),Math.max(0,Math.floor(t*e[1])),Math.max(0,Math.floor(t*e[2])))}function s(e,t,n,i){var r=i.length-1,o=n-t;return c(u(i[Math.round((e-t)/o*r)]))}function u(e){if("string"!=typeof e)return e;if(0===e.indexOf("#"))e=e.substring(1);else{var t=h.exec(e);if(t)return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3],10)];e=p[e.toLowerCase()]}return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}function l(n,i,r){var o=null;if(n){var a;switch(n.toLowerCase()){case"ryg":a="divergentRyg";break;case"ryb":a="divergentRyb";break;case"blue":a="quantitativeBlue";break;case"gray":a="quantitativeGray";break;default:throw t.argInvalid("colorSet")}if("gradient"===(i=i.toLowerCase()))a+="5";else{var s=d.exec(i);a+=s?s[1]:""}o=e("pentaho/visual/color/palettes/"+a).colors.toArray(function(e){return e.value}),r&&(o=o.reverse())}return o}function c(e,t,n){return e instanceof Array&&(n=e[2],t=e[1],e=e[0]),"RGB("+e+","+t+","+n+")"}var h=/^rgb\((\d+),(\d+),(\d+)\)$/i,d=/^(\d+)[_-]COLOR$/i,p={aliceblue:"F0F8FF",antiquewhite:"FAEBD7",aqua:"00FFFF",aquamarine:"7FFFD4",azure:"F0FFFF",beige:"F5F5DC",bisque:"FFE4C4",black:"000000",blanchedalmond:"FFEBCD",blue:"0000FF",blueviolet:"8A2BE2",brown:"A52A2A",burlywood:"DEB887",cadetblue:"5F9EA0",chartreuse:"7FFF00",chocolate:"D2691E",coral:"FF7F50",cornflowerblue:"6495ED",cornsilk:"FFF8DC",crimson:"DC143C",cyan:"00FFFF",darkblue:"00008B",darkcyan:"008B8B",darkgoldenRod:"B8860B",darkgray:"A9A9A9",darkgrey:"A9A9A9",darkgreen:"006400",darkkhaki:"BDB76B",darkmagenta:"8B008B",darkoliveGreen:"556B2F",darkorange:"FF8C00",darkorchid:"9932CC",darkred:"8B0000",darksalmon:"E9967A",darkseagreen:"8FBC8F",darkslateblue:"483D8B",darkslategray:"2F4F4F",darkslategrey:"2F4F4F",darkturquoise:"00CED1",darkviolet:"9400D3",deeppink:"FF1493",deepskyblue:"00BFFF",dimgray:"696969",dimgrey:"696969",dodgerblue:"1E90FF",firebrick:"B22222",floralwhite:"FFFAF0",forestgreen:"228B22",fuchsia:"FF00FF",gainsboro:"DCDCDC",ghostwhite:"F8F8FF",gold:"FFD700",goldenrod:"DAA520",gray:"808080",grey:"808080",green:"008000",greenyellow:"ADFF2F",honeydew:"F0FFF0",hotpink:"FF69B4",indianred:"CD5C5C",indigo:"4B0082",ivory:"FFFFF0",khaki:"F0E68C",lavender:"E6E6FA",lavenderblush:"FFF0F5",lawngreen:"7CFC00",lemonchiffon:"FFFACD",lightblue:"ADD8E6",lightcoral:"F08080",lightcyan:"E0FFFF",lightgoldenrodyellow:"FAFAD2",lightgray:"D3D3D3",lightgrey:"D3D3D3",lightgreen:"90EE90",lightpink:"FFB6C1",lightsalmon:"FFA07A",lightseagreen:"20B2AA",lightskyblue:"87CEFA",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"B0C4DE",lightyellow:"FFFFE0",lime:"00FF00",limegreen:"32CD32",linen:"FAF0E6",magenta:"FF00FF",maroon:"800000",mediumaquamarine:"66CDAA",mediumblue:"0000CD",mediumorchid:"BA55D3",mediumpurple:"9370D8",mediumseagreen:"3CB371",mediumslateblue:"7B68EE",mediumspringgreen:"00FA9A",mediumturquoise:"48D1CC",mediumvioletred:"C71585",midnightblue:"191970",mintcream:"F5FFFA",mistyrose:"FFE4E1",moccasin:"FFE4B5",navajowhite:"FFDEAD",navy:"000080",oldlace:"FDF5E6",olive:"808000",olivedrab:"6B8E23",orange:"FFA500",orangered:"FF4500",orchid:"DA70D6",palegoldenrod:"EEE8AA",palegreen:"98FB98",paleturquoise:"AFEEEE",palevioletRed:"D87093",papayawhip:"FFEFD5",peachpuff:"FFDAB9",peru:"CD853F",pink:"FFC0CB",plum:"DDA0DD",powderblue:"B0E0E6",purple:"800080",red:"FF0000",rosybrown:"BC8F8F",royalblue:"4169E1",saddlebrown:"8B4513",salmon:"FA8072",sandybrown:"F4A460",seagreen:"2E8B57",seashell:"FFF5EE",sienna:"A0522D",silver:"C0C0C0",skyblue:"87CEEB",slateblue:"6A5ACD",slategray:"708090",slategrey:"708090",snow:"FFFAFA",springgreen:"00FF7F",steelblue:"4682B4",tan:"D2B48C",teal:"008080",thistle:"D8BFD8",tomato:"FF6347",turquoise:"40E0D0",violet:"EE82EE",wheat:"F5DEB3",white:"FFFFFF",whitesmoke:"F5F5F5",yellow:"FFFF00",yellowgreen:"9ACD32"};return{getRgbColor:c,parseColor:u,getRgbGradient:i,getRgbStep:s,buildPalette:l,createPaletteMap:n,getRgbDarker:a}}),define("pentaho/visual/color/palettes/divergentRyb3",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"divergent",colors:["#FF0000","#FFFF00","#4BB6E4"]},e.config))}),define("pentaho/visual/color/palettes/divergentRyb5",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"divergent",colors:["#FF0000","#FFBF3F","#FFFF00","#DCDDDE","#4BB6E4"]},e.config))}),define("pentaho/visual/color/palettes/divergentRyg3",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"divergent",colors:["#FF0000","#FFFF00","#008000"]},e.config))}),define("pentaho/visual/color/palettes/divergentRyg5",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"divergent",colors:["#FF0000","#FFBF3F","#FFFF00","#BFDF3F","#008000"]},e.config))}),define("pentaho/visual/color/palettes/nominalDark",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"nominal",colors:["#002644","#014462","#663000","#604E1D","#261B4E","#3B2C58","#003524","#094E34","#668032","#74A611","#490B0B","#632422"]},e.config))}),define("pentaho/visual/color/palettes/nominalLight",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"nominal",colors:["#80AFD5","#81D4FA","#FFBC80","#F8E1A4","#AFA1E2","#C9B7EE","#80C2AD","#8BE2C1","#BFD09D","#CBEC8A","#DB8E8E","#FBADAB"]},e.config))}),define("pentaho/visual/color/palettes/nominalNeutral",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"nominal",colors:["#005DA6","#03A9F4","#FF7900","#F2C249","#5F43C4","#946FDD","#00845B","#18C482","#A4C65F","#AFE73E","#B71C1C","#F75B57"]},e.config))}),define("pentaho/visual/color/palettes/nominalPrimary",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/visual/color/palettes/nominalNeutral","pentaho/visual/color/palettes/nominalLight","pentaho/visual/color/palettes/nominalDark","pentaho/util/spec"],function(e,t,n,i,r,o){"use strict";var a=n.colors.toArray().concat(i.colors.toArray().concat(r.colors.toArray()));return new t(o.merge({level:"nominal",colors:a},e.config))}),define("pentaho/visual/color/palettes/quantitativeBlue3",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"quantitative",colors:["#CCDFED","#6D85A4","#0F2B5B"]},e.config))}),define("pentaho/visual/color/palettes/quantitativeBlue5",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"quantitative",colors:["#CCDFED","#9CB2C8","#6D85A4","#3E587F","#0F2B5B"]},e.config))}),define("pentaho/visual/color/palettes/quantitativeGray3",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"quantitative",colors:["#E6E6E6","#999999","#333333"]},e.config))}),define("pentaho/visual/color/palettes/quantitativeGray5",["pentaho/module!_","pentaho/visual/color/Palette","pentaho/util/spec"],function(e,t,n){"use strict";return new t(n.merge({level:"quantitative",colors:["#E6E6E6","#CCCCCC","#999999","#666666","#333333"]},e.config))}),define("pentaho/visual/color/palettes/all",["./divergentRyb3","./divergentRyb5","./divergentRyg3","./divergentRyg5","./nominalDark","./nominalLight","./nominalNeutral","./nominalPrimary","./quantitativeBlue3","./quantitativeBlue5","./quantitativeGray3","./quantitativeGray5"],function(){"use strict"}),define("pentaho/visual/models/types/Color",["pentaho/module!_","pentaho/type/String"],function(e,t){"use strict";return t.extend({$type:{id:e.id}}).configure()}),define("pentaho/visual/models/types/BackgroundFill",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["none","solid","gradient"]}}).localize({$type:i.structured.BackgroundFill}).configure()}),define("pentaho/visual/models/types/FontStyle",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["plain","bold","italic"]}}).localize({$type:i.structured.FontStyle}).configure()}),define("pentaho/visual/models/types/Sides",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["top","right","bottom","left"]}}).localize({$type:i.structured.Sides}).configure()}),define("pentaho/visual/models/types/LabelsOption",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["none","center","insideEnd","insideBase","outsideEnd","left","right","top","bottom","outside","inside"]}}).localize({$type:i.structured.LabelsOption}).configure()}),define("pentaho/visual/models/Abstract",["pentaho/module!_","../Model","./types/Color","./types/BackgroundFill","./types/FontStyle","./types/Sides","./types/LabelsOption","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o,a,s){"use strict";function u(){return this.showLegend}return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"rows",base:"pentaho/visual/role/Property",isVisualKey:!0,modes:[{dataType:"number"},{dataType:"date"},{dataType:"list"}],ordinal:5},{name:"backgroundFill",valueType:i,isRequired:!0,defaultValue:"none"},{name:"backgroundColor",valueType:n,isApplicable:function(){return"none"!==this.backgroundFill},isRequired:!0},{name:"backgroundColorEnd",valueType:n,isApplicable:function(){return"gradient"===this.backgroundFill},isRequired:!0},{name:"labelColor",valueType:n},{name:"labelSize",valueType:"number"},{name:"labelStyle",valueType:r,isRequired:!0,defaultValue:"plain"},{name:"labelFontFamily",valueType:"string"},{name:"showLegend",valueType:"boolean",defaultValue:!0},{name:"legendPosition",valueType:o,isApplicable:u,isRequired:!0,defaultValue:"right"},{name:"legendBackgroundColor",valueType:n,isApplicable:u},{name:"legendColor",valueType:n,isApplicable:u},{name:"legendSize",valueType:"number",isApplicable:u},{name:"legendStyle",valueType:r,isApplicable:u,isRequired:!0,defaultValue:"plain"},{name:"legendFontFamily",valueType:"string",isApplicable:u},{name:"labelsOption",valueType:a}]}}).localize({$type:s.structured.Abstract}).configure()}),define("pentaho/visual/models/types/DisplayUnits",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["units_0","units_2","units_3","units_4","units_5","units_6"],scaleFactorOf:function(e){if(e){var t=e.match(/^UNITS_(\d+)$/i);if(t){var n=+t[1];if(n>0)return Math.pow(10,n)}}return 1}}}).localize({$type:i.structured.DisplayUnits}).configure()}),define("pentaho/visual/models/CartesianAbstract",["pentaho/module!_","./Abstract","./types/DisplayUnits","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"autoRange",valueType:"boolean",defaultValue:!0},{name:"valueAxisLowerLimit",valueType:"number"},{name:"valueAxisUpperLimit",valueType:"number"},{name:"displayUnits",valueType:n,isRequired:!0,defaultValue:"units_0"},{name:"autoRangeSecondary",valueType:"boolean",defaultValue:!0},{name:"valueAxisLowerLimitSecondary",valueType:"number"},{name:"valueAxisUpperLimitSecondary",valueType:"number"},{name:"displayUnitsSecondary",valueType:n,isRequired:!0,defaultValue:"units_0"}]}}).localize({$type:i.structured.CartesianAbstract}).configure()}),define("pentaho/visual/models/mixins/ScaleColorDiscrete",["pentaho/module!_","../../Model","pentaho/i18n!../i18n/model"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"palette",
base:"pentaho/visual/color/PaletteProperty",levels:["nominal"],isRequired:!0}]}}).localize({$type:n.structured.ScaleColorDiscrete}).configure()}),define("pentaho/visual/models/CategoricalContinuousAbstract",["pentaho/module!_","./CartesianAbstract","./mixins/ScaleColorDiscrete","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,mixins:[n],props:[{name:"columns",base:"pentaho/visual/role/Property",modes:[{dataType:"list"}],ordinal:6},{name:"multi",base:"pentaho/visual/role/Property",modes:[{dataType:"list"}],ordinal:10},{name:"measures",base:"pentaho/visual/role/Property",modes:[{dataType:["number"]}],ordinal:7}]}}).localize({$type:i.structured.CategoricalContinuousAbstract}).configure()}),define("pentaho/visual/models/types/MaxChartsPerRow",["pentaho/module!_","pentaho/type/Number","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:[1,2,3,4,5]}}).localize({$type:i.structured.MaxChartsPerRow}).configure()}),define("pentaho/visual/models/types/MultiChartRangeScope",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["global","cell"]}}).localize({$type:i.structured.MultiChartRangeScope}).configure()}),define("pentaho/visual/models/types/MultiChartOverflow",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["grow","fit","clip","page"]}}).localize({$type:i.structured.MultiChartOverflow}).configure()}),define("pentaho/visual/models/mixins/MultiCharted",["pentaho/module!_","../../Model","../types/MaxChartsPerRow","../types/MultiChartRangeScope","../types/MultiChartOverflow","pentaho/i18n!../i18n/model"],function(e,t,n,i,r,o){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"maxChartsPerRow",valueType:n,isRequired:!0,defaultValue:3},{name:"multiChartRangeScope",valueType:i,isRequired:!0,defaultValue:"global"},{name:"multiChartOverflow",valueType:r,isRequired:!0,defaultValue:"grow"}]}}).localize({$type:o.structured.MultiCharted}).configure()}),define("pentaho/visual/models/types/EmptyCellMode",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["gap","linear","zero"]}}).localize({$type:i.structured.EmptyCellMode}).configure()}),define("pentaho/visual/models/mixins/Interpolated",["pentaho/module!_","../../Model","../types/EmptyCellMode","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"emptyCellMode",valueType:n,isRequired:!0,defaultValue:"gap"}]}}).localize({$type:i.structured.Interpolation}).configure()}),define("pentaho/visual/models/PointAbstract",["pentaho/module!_","./CategoricalContinuousAbstract","./types/LabelsOption","./mixins/MultiCharted","./mixins/Interpolated","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,mixins:[i,r],props:[{name:"measures",fields:{isRequired:!0},ordinal:7},{name:"labelsOption",valueType:n,domain:["none","center","left","right","top","bottom"],isRequired:!0,defaultValue:"none"}]}}).localize({$type:o.structured.PointAbstract}).configure()}),define("pentaho/visual/models/AreaStacked",["pentaho/module!_","./PointAbstract","pentaho/i18n!./i18n/model"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id,v2Id:"ccc_area",category:"areachart"}}).localize({$type:n.structured.AreaStacked}).configure()}),define("pentaho/visual/models/BarAbstract",["pentaho/module!_","./CategoricalContinuousAbstract","./mixins/MultiCharted","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],isAbstract:!0,props:[{name:"rows",modes:[{dataType:"list"}]}]}}).localize({$type:i.structured.BarAbstract}).configure()}),define("pentaho/visual/models/types/TrendType",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["none","linear"]}}).localize({$type:i.structured.TrendType}).configure()}),define("pentaho/visual/models/types/LineWidth",["pentaho/module!_","pentaho/type/Number","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:[1,2,3,4,5,6,7,8]}}).localize({$type:i.structured.LineWidth}).configure()}),define("pentaho/visual/models/mixins/Trended",["pentaho/module!_","../../Model","../types/TrendType","../types/LineWidth","pentaho/i18n!../i18n/model"],function(e,t,n,i,r){"use strict";function o(){return"none"!==this.trendType}return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"trendType",valueType:n,isRequired:!0,defaultValue:"none"},{name:"trendName",valueType:"string",isApplicable:o},{name:"trendLineWidth",valueType:i,isApplicable:o,isRequired:!0,defaultValue:1}]}}).localize({$type:r.structured.Trended}).configure()}),define("pentaho/visual/models/Bar",["pentaho/module!_","./BarAbstract","./types/LabelsOption","./mixins/Trended","pentaho/i18n!./i18n/model"],function(e,t,n,i,r){"use strict";return t.extend({$type:{id:e.id,mixins:[i],v2Id:"ccc_bar",category:"barchart",props:[{name:"measures",fields:{isRequired:!0},ordinal:7},{name:"labelsOption",valueType:n,domain:["none","center","insideEnd","insideBase","outsideEnd"],isRequired:!0,defaultValue:"none"}]}}).localize({$type:r.structured.Bar}).configure()}),define("pentaho/visual/models/BarHorizontal",["pentaho/module!_","./BarAbstract","./types/LabelsOption","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,v2Id:"ccc_horzbar",category:"horzbarchart",props:[{name:"measures",fields:{isRequired:!0}},{name:"labelsOption",valueType:n,domain:["none","center","insideEnd","insideBase","outsideEnd"],isRequired:!0,defaultValue:"none"}]}}).localize({$type:i.structured.BarHorizontal}).configure()}),define("pentaho/visual/models/types/Shape",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["none","circle","cross","diamond","square","triangle"]}}).localize({$type:i.structured.Shape}).configure()}),define("pentaho/visual/models/BarLine",["pentaho/module!_","./BarAbstract","./types/LabelsOption","./types/Shape","./types/LineWidth","./mixins/Interpolated","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o,a){"use strict";function s(){return!this.measures.hasFields&&!this.measuresLine.hasFields}function u(){return this.measuresLine.hasFields}function l(){return this.measures.hasFields}return t.extend({$type:{id:e.id,mixins:[o],v2Id:"ccc_barline",category:"barchart",props:[{name:"measures",fields:{isRequired:s}},{name:"measuresLine",base:"pentaho/visual/role/Property",modes:[{dataType:["number"]}],fields:{isRequired:s},ordinal:7},{name:"lineWidth",valueType:r,isApplicable:u,isRequired:!0,defaultValue:1},{name:"labelsOption",valueType:n,domain:["none","center","insideEnd","insideBase","outsideEnd"],isApplicable:l,isRequired:!0,defaultValue:"none"},{name:"lineLabelsOption",valueType:n,domain:["none","center","left","right","top","bottom"],isApplicable:u,isRequired:!0,defaultValue:"none"},{name:"shape",valueType:i,isRequired:!0,defaultValue:"circle",isApplicable:u}]}}).localize({$type:a.structured.BarLine}).configure()}),define("pentaho/visual/models/BarNormalizedAbstract",["pentaho/module!_","./BarAbstract","./types/LabelsOption","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"measures",fields:{isRequired:!0}},{name:"labelsOption",valueType:n,domain:["none","center","insideEnd","insideBase"],isRequired:!0,defaultValue:"none"}]}}).localize({$type:i.structured.BarNormalizedAbstract}).configure()}),define("pentaho/visual/models/BarNormalized",["pentaho/module!_","./BarNormalizedAbstract","pentaho/i18n!./i18n/model"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id,v2Id:"ccc_barnormalized",category:"barchart"}}).localize({$type:n.structured.BarNormalized}).configure()}),define("pentaho/visual/models/BarNormalizedHorizontal",["pentaho/module!_","./BarNormalizedAbstract","pentaho/i18n!./i18n/model"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id,v2Id:"ccc_horzbarnormalized",category:"horzbarchart"}}).localize({$type:n.structured.BarNormalizedHorizontal}).configure()}),define("pentaho/visual/models/BarStacked",["pentaho/module!_","./BarAbstract","./types/LabelsOption","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,v2Id:"ccc_barstacked",category:"barchart",props:[{name:"measures",fields:{isRequired:!0}},{name:"labelsOption",valueType:n,domain:["none","center","insideEnd","insideBase"],isRequired:!0,defaultValue:"none"}]}}).localize({$type:i.structured.BarStacked}).configure()}),define("pentaho/visual/models/BarStackedHorizontal",["pentaho/module!_","./BarAbstract","./types/LabelsOption","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,v2Id:"ccc_horzbarstacked",category:"horzbarchart",props:[{name:"measures",fields:{isRequired:!0}},{name:"labelsOption",valueType:n,domain:["none","center","insideEnd","insideBase"],isRequired:!0,defaultValue:"none"}]}}).localize({$type:i.structured.BarStackedHorizontal}).configure()}),define("pentaho/visual/models/types/ColorSet",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["ryg","ryb","blue","gray"]}}).localize({$type:i.structured.ColorSet}).configure()}),define("pentaho/visual/models/types/Pattern",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["gradient","3_color","5_color"]}}).localize({$type:i.structured.Pattern}).configure()}),define("pentaho/visual/models/mixins/ScaleColorContinuous",["pentaho/module!_","../../Model","../types/ColorSet","../types/Pattern","pentaho/i18n!../i18n/model"],function(e,t,n,i,r){"use strict";function o(){var e=this.color.mode;return null!==e&&e.isContinuous}return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"paletteQuantitative",base:"pentaho/visual/color/PaletteProperty",levels:["quantitative","divergent"],isApplicable:o,defaultValue:null},{name:"pattern",valueType:i,isRequired:!0,isApplicable:o,defaultValue:"gradient"},{name:"colorSet",valueType:n,isRequired:!0,isApplicable:o,defaultValue:"ryg"},{name:"reverseColors",valueType:"boolean",isRequired:!0,isApplicable:o,defaultValue:!1}]}}).localize({$type:r.structured.ScaleColorContinuous}).configure()}),define("pentaho/visual/models/MetricPointAbstract",["pentaho/module!_","./CartesianAbstract","./types/LabelsOption","./mixins/ScaleColorContinuous","./mixins/ScaleColorDiscrete","./mixins/MultiCharted","./mixins/Trended","../KeyTypes","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o,a,s,u){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,visualKeyType:s.dataOrdinal,mixins:[a,r,i,o],category:"scatter",props:[{name:"rows",modes:[{dataType:"list"}]},{name:"x",base:"pentaho/visual/role/Property",modes:[{dataType:"number"},{dataType:"date"}],fields:{isRequired:!0},ordinal:1},{name:"y",base:"pentaho/visual/role/Property",modes:[{dataType:"number"},{dataType:"date"}],fields:{isRequired:!0},ordinal:2},{name:"color",base:"pentaho/visual/role/Property",modes:[{dataType:"number"},{dataType:"list"}],ordinal:6},{name:"multi",base:"pentaho/visual/role/Property",modes:[{dataType:"list"}],ordinal:10},{name:"labelsOption",valueType:n,domain:["none","center","left","right","top","bottom"],isRequired:!0,defaultValue:"none"}]}}).localize({$type:u.structured.MetricPointAbstract}).configure()}),define("pentaho/visual/models/types/SizeByNegativesMode",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["negLowest","useAbs"]}}).localize({$type:i.structured.SizeByNegativesMode}).configure()}),define("pentaho/visual/models/mixins/ScaleSizeContinuous",["pentaho/module!_","../../Model","../types/SizeByNegativesMode","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,isAbstract:!0,props:[{name:"sizeByNegativesMode",valueType:n,isApplicable:function(){return this.countOf("size")>0},isRequired:!0,defaultValue:"negLowest"}]}}).localize({$type:i.structured.ScaleSizeContinuous}).configure()}),define("pentaho/visual/models/Bubble",["pentaho/module!_","./MetricPointAbstract","./mixins/ScaleSizeContinuous","pentaho/i18n!./i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],v2Id:"ccc_scatter",props:[{name:"size",base:"pentaho/visual/role/Property",modes:[{dataType:"number"}],ordinal:7}]}}).localize({$type:i.structured.Bubble}).configure()}),define("pentaho/visual/models/Pie",["pentaho/module!_","./Abstract","./types/LabelsOption","./mixins/MultiCharted","./mixins/ScaleColorDiscrete","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o){"use strict";return t.extend({$type:{id:e.id,mixins:[i,r],v2Id:"ccc_pie",category:"piechart",props:[{name:"rows",modes:[{dataType:"list"}]},{name:"columns",base:"pentaho/visual/role/Property",modes:[{dataType:"list"}],ordinal:6},{name:"measures",base:"pentaho/visual/role/Property",modes:[{dataType:["number"]}],fields:{isRequired:!0},ordinal:7},{name:"labelsOption",valueType:n,domain:["none","outside","inside"],isRequired:!0,defaultValue:"outside"}]}}).localize({$type:o.structured.Pie}).configure()}),define("pentaho/visual/models/Donut",["pentaho/module!_","./Pie","pentaho/i18n!./i18n/model"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id}}).localize({$type:n.structured.Donut}).configure()}),define("pentaho/visual/models/HeatGrid",["pentaho/module!_","./CartesianAbstract","./types/Shape","./types/LabelsOption","./mixins/ScaleSizeContinuous","./mixins/ScaleColorContinuous","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o,a){"use strict";function s(){return!this.size.hasFields&&!this.color.hasFields}return t.extend({$type:{id:e.id,mixins:[r,o],v2Id:"ccc_heatgrid",category:"heatgrid",props:[{name:"rows",modes:[{dataType:"list"}],fields:{isRequired:!0},ordinal:5},{name:"columns",base:"pentaho/visual/role/Property",modes:[{dataType:"list"}],ordinal:6},{name:"color",base:"pentaho/visual/role/Property",modes:[{dataType:"number"}],fields:{isRequired:s},ordinal:7},{name:"size",base:"pentaho/visual/role/Property",modes:[{dataType:"number"}],fields:{isRequired:s},ordinal:8},{name:"labelsOption",valueType:i,domain:["none","center"],isRequired:!0,defaultValue:"none"},{name:"shape",valueType:n,domain:["none","circle","square"],isRequired:!0,defaultValue:"square"}]}}).localize({$type:a.structured.HeatGrid}).configure()}),define("pentaho/visual/models/Line",["pentaho/module!_","./PointAbstract","./types/Shape","./types/LineWidth","./mixins/Trended","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o){"use strict";return t.extend({$type:{id:e.id,mixins:[r],v2Id:"ccc_line",category:"linechart",props:[{name:"lineWidth",valueType:i,isRequired:!0,defaultValue:1},{name:"shape",valueType:n,isRequired:!0,defaultValue:"circle"}]}}).localize({$type:o.structured.Line}).configure()});define("pentaho/visual/models/Scatter",["pentaho/module!_","./MetricPointAbstract","pentaho/i18n!./i18n/model"],function(e,t,n){"use strict";return t.extend({$type:{id:e.id}}).localize({$type:n.structured.Scatter}).configure()}),define("pentaho/visual/models/types/SliceOrder",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum","pentaho/i18n!../i18n/model"],function(e,t,n,i){"use strict";return t.extend({$type:{id:e.id,mixins:[n],domain:["bySizeDescending","bySizeAscending","none"]}}).localize({$type:i.structured.SliceOrder}).configure()}),define("pentaho/visual/models/Sunburst",["pentaho/module!_","./Abstract","./types/DisplayUnits","./types/LabelsOption","./types/SliceOrder","./mixins/MultiCharted","./mixins/ScaleColorDiscrete","pentaho/i18n!./i18n/model"],function(e,t,n,i,r,o,a,s){"use strict";function u(){return this.size.hasFields}return t.extend({$type:{id:e.id,mixins:[o,a],v2Id:"ccc_sunburst",category:"treemapchart",props:[{name:"rows",modes:[{dataType:"list"}],fields:{isRequired:!0}},{name:"size",base:"pentaho/visual/role/Property",modes:[{dataType:"number"}],ordinal:7},{name:"multi",base:"pentaho/visual/role/Property",modes:[{dataType:"list"}],ordinal:10},{name:"displayUnits",valueType:n,isRequired:!0,defaultValue:"units_0"},{name:"labelsOption",valueType:i,domain:["none","center"],isApplicable:u,isRequired:!0,defaultValue:"none"},{name:"emptySlicesHidden",valueType:"boolean",isRequired:!0,defaultValue:!0},{name:"sliceOrder",valueType:r,isApplicable:u,isRequired:!0,defaultValue:"bySizeDescending"}]}}).localize({$type:s.structured.Sunburst}).configure()}),define("pentaho/visual/models/all",["./Abstract","./AreaStacked","./Bar","./BarAbstract","./BarHorizontal","./BarLine","./BarNormalized","./BarNormalizedAbstract","./BarNormalizedHorizontal","./BarStacked","./BarStackedHorizontal","./Bubble","./CartesianAbstract","./CategoricalContinuousAbstract","./Donut","./HeatGrid","./Line","./MetricPointAbstract","./Pie","./PointAbstract","./Scatter","./Sunburst","./mixins/Interpolated","./mixins/MultiCharted","./mixins/ScaleColorContinuous","./mixins/ScaleColorDiscrete","./mixins/ScaleSizeContinuous","./mixins/Trended","./types/BackgroundFill","./types/Color","./types/ColorSet","./types/DisplayUnits","./types/EmptyCellMode","./types/FontStyle","./types/LabelsOption","./types/LineWidth","./types/MaxChartsPerRow","./types/MultiChartOverflow","./types/MultiChartRangeScope","./types/Pattern","./types/Shape","./types/Sides","./types/SizeByNegativesMode","./types/SliceOrder","./types/TrendType"],function(){"use strict"}),define("pentaho/visual/role/adaptation/Strategy",["pentaho/module!_","pentaho/type/Complex","pentaho/util/object","pentaho/util/arg","pentaho/util/error","pentaho/lang/OperationInvalidError","pentaho/i18n!../i18n/messages"],function(e,t,n,i,r,o,a){"use strict";return t.extend({constructor:function(e){this.base(e),n.setConst(this,"data",i.required(e,"data","instSpec")),n.setConst(this,"inputFieldIndexes",i.required(e,"inputFieldIndexes","instSpec"))},_setOutputFieldIndexes:function(e){if(null==e)throw r.argRequired("instSpec.outputFieldIndexes");n.setConst(this,"outputFieldIndexes",e)},get isInvertible(){return!1},get outputFieldNames(){var e=this.data;return this.outputFieldIndexes.map(function(t){return e.getColumnId(t)})},get inputFieldNames(){var e=this.data;return this.inputFieldIndexes.map(function(t){return e.getColumnId(t)})},invert:function(e){throw new o("Not supported.")},_getDataRowCells:function(e,t,n){if(e<0)return null;null==n&&(n=t.length);for(var i=n,r=new Array(i),o=this.data;i--;)r[i]=o.getCell(e,t[i]);return r},_createFieldsKeyFuns:function(e){for(var t=this.data,i=e.length,r=new Array(i),o=i;o--;)r[o]=n.getSameTypeKeyFun(t.getColumnType(e[o]));return r},$type:{id:e.id,isAbstract:!0,get isIdentity(){return!1}}}).localize({$type:a.structured.adaptation.Strategy}).configure()}),define("pentaho/visual/role/adaptation/IdentityStrategy",["pentaho/module!_","./Strategy","pentaho/util/object","pentaho/data/util"],function(e,t,n,i){var r=t.extend({constructor:function(e){this.base(e),this._setOutputFieldIndexes(this.inputFieldIndexes),this.__index=null,this.__keyFun=null},get isInvertible(){return!0},map:function(e){var t=this.__getCellByValue(e[0]);return t&&[t]},invert:function(e){var t=this.__getCellByValue(e[0]);return t&&[t]},__getCellByValue:function(e){var t=this.__getRowIndexByValueKeyMap(),n=this.__keyFun(i.getCellValue(e)),r=t[n];return void 0===r?null:this.data.getCell(r,this.inputFieldIndexes[0])},__getRowIndexByValueKeyMap:function(){var e=this.__index;return null===e&&(this.__installIndex(),e=this.__index),e},__installIndex:function(){for(var e=this.__index=Object.create(null),t=this.outputFieldIndexes[0],i=this.data,r=this.__keyFun=n.getSameTypeKeyFun(i.getColumnType(t)),o=i.getNumberOfRows(),a=-1;++a<o;){var s=i.getValue(a,t),u=r(s);void 0===e[u]&&(e[u]=a)}},$type:{id:e.id,get isIdentity(){return!0},getInputTypeFor:function(e,t){return e.isList?null:e},validateApplication:function(e,t){return{isValid:!0,addsFields:!1}},apply:function(e,t){return new r({data:e,inputFieldIndexes:t})}}}).configure();return r}),define("pentaho/visual/role/adaptation/TupleStrategy",["pentaho/module!_","./Strategy","pentaho/util/object","pentaho/data/util"],function(e,t,n,i){"use strict";function r(e,t){this.key=e,this.index=t,this.children=null}function o(e){for(var t=e.length,n=0;t--&&void 0===e[t];)n++;return n>0?e.slice(0,-n):e}r.prototype.getIndexOf=function(e,t){for(var n=-1,r=e.length,o=this;++n<r;){var a=o.children;if(null===a)return-1;var s=i.getCellValue(e[n]);if(void 0===s)return-1;var u=t[n](s),l=a[u];if(null==l)return-1;o=l}return o.index},r.prototype.add=function(e,t,n,i){for(var o=-1,a=n.length,s=new Array(a),u=this;++o<a;){var l=u.children;null===l&&(u.children=l=Object.create(null));var c;s[o]=c=e.getValue(t,n[o]);var h=i[o](c),d=l[h];null==d&&(l[h]=d=new r(h,t)),u=d}return s};var a=t.extend({constructor:function(e){this.base(e),this._setOutputFieldIndexes(this.inputFieldIndexes),this.__keyFuns=this._createFieldsKeyFuns(this.inputFieldIndexes),this.__index=null},get isInvertible(){return!0},map:function(e){e=o(e);var t=this._getDataRowCells(this.__getIndex().getIndexOf(e,this.__keyFuns),this.outputFieldIndexes,e.length);if(null===t&&this.__isWildcardValues(e)){var n=!1;t=this.inputFieldIndexes.map(function(t,i){var r=this.__findFirstCell(e[i],t);return n||void 0===r||(n=!0),r},this),n||(t=null)}return t},invert:function(e){e=o(e);var t=this._getDataRowCells(this.__getIndex().getIndexOf(e,this.__keyFuns),this.inputFieldIndexes,e.length);if(null===t&&this.__isWildcardValues(e)){var n=!1;t=this.inputFieldIndexes.map(function(t,i){var r=this.__findFirstCell(e[i],t);return n||void 0===r||(n=!0),r},this),n||(t=null)}return t},__isWildcardValues:function(e){var t=e.length;if(t!==this.inputFieldIndexes.length)return!0;for(;t--;)if(void 0===i.getCellValue(e[t]))return!0;return!1},__getIndex:function(){var e=this.__index;return null===e&&(this.__installIndex(),e=this.__index),e},__installIndex:function(){for(var e=this.__index=new r("",-1),t=this.inputFieldIndexes,n=this.__keyFuns,i=this.data,o=i.getNumberOfRows(),a=-1;++a<o;)e.add(i,a,t,n)},__findFirstCell:function(e,t){var n=i.getCellValue(e);if(void 0!==n)for(var r=this.data,o=r.getNumberOfRows(),a=-1;++a<o;){var s=r.getValue(a,t);if(s===n)return r.getCell(a,t)}},$type:{id:e.id,get isIdentity(){return!0},getInputTypeFor:function(e,t){return e.isList?e:null},validateApplication:function(e,t){return{isValid:!0,addsFields:!1}},apply:function(e,t){return new a({data:e,inputFieldIndexes:t})}}}).configure();return a}),define("pentaho/visual/role/adaptation/CombineStrategy",["pentaho/module!_","./Strategy","pentaho/type/String","pentaho/type/List","pentaho/util/object","pentaho/data/util"],function(e,t,n,i,r,o){"use strict";var a=t.extend({constructor:function(e){this.base(e);var t,n;this.__inputKeyFuns=t=this._createFieldsKeyFuns(this.inputFieldIndexes),this.__outputKeyFun=r.getSameTypeKeyFun("string"),this.__outputIndex=n=Object.create(null);for(var i,o=this.inputFieldIndexes,a=this.data,s=i="combined_"+o.join("_");a.getColumnIndexById(i)>=0;)i=s+"_"+new Date;var u=this.formattedSeparator,l=o.map(function(e){return a.getColumnLabel(e)}).join(u);a.model.attributes.add({name:i,type:"string",label:l,isKey:!0});for(var c=a.addColumn(i),h=a.getNumberOfRows(),d=-1,p=o.length,f=this.valueSeparator;++d<h;){for(var _,m,g=-1;++g<p;){var y=a.getCell(d,o[g]),v=t[g](y.value);0===g?(_=v,m=y.formatted):(_+=f+v,m+=u+(y.formatted||""))}var b=a.getCell(d,c);b.value=_,b.label=m,r.hasOwn(n,_)||(n[_]=d)}this._setOutputFieldIndexes([c])},get isInvertible(){return!0},map:function(e){var t=this.__combine(e),n=r.getOwn(this.__outputIndex,t);return void 0===n?null:[this.data.getCell(n,this.outputFieldIndexes[0])]},invert:function(e){var t=this.__outputKeyFun(o.getCellValue(e[0])),n=r.getOwn(this.__outputIndex,t);return void 0===n?null:this._getDataRowCells(n,this.inputFieldIndexes)},__combine:function(e){for(var t,n=this.valueSeparator,i=this.__inputKeyFuns,r=i.length,a=-1;++a<r;){var s=o.getCellValue(e[a]),u=i[a](s);0===a?t=u:t+=n+u}return t},$type:{id:e.id,props:[{name:"valueSeparator",valueType:"string",isRequired:!0,defaultValue:"~"},{name:"formattedSeparator",valueType:"string",isRequired:!0,defaultValue:" ~ "}],getInputTypeFor:function(e,t){return!1!==t&&e.isSubtypeOf(n.type)?i.type:null},validateApplication:function(e,t){return{isValid:!0,addsFields:!0}},apply:function(e,t){return new a({data:e,inputFieldIndexes:t})}}}).configure();return a}),define("pentaho/visual/role/adaptation/TimeIntervalDuration",["pentaho/module!_","pentaho/type/String","pentaho/type/mixins/Enum"],function(e,t,n){return t.extend({$type:{id:e.id,mixins:[n],domain:["year","halfYear","quarter","month","week","day","hour","minute","second","millisecond","instant"]}}).configure()}),define("pentaho/visual/role/adaptation/EntityWithTimeIntervalKeyStrategy",["pentaho/module!_","./Strategy","./TimeIntervalDuration","pentaho/type/loader","pentaho/type/Date","pentaho/util/object","pentaho/util/date","pentaho/data/util"],function(e,t,n,i,r,o,a,s){"use strict";var u=i.resolveType(["string"]).type,l=t.extend({constructor:function(e){this.base(e),this.__keyFun=o.getSameTypeKeyFun("date"),this.__forwardIndex=Object.create(null),this.__backIndex=Object.create(null);var t=this.inputFieldIndexes,n=this.data;this.mainInputPosition=this.$type.__getMainInputFieldPosition(t,n);for(var i,r=n.getColumnAttribute(t[this.mainInputPosition]),s=i=this.$type.__getOutputFieldName(t);n.getColumnIndexById(i)>=0;)i=s+"_"+new Date;n.model.attributes.add({name:i,type:"date",label:this.$type.__getOutputFieldLabel(t,n),isKey:!0,p:{timeIntervalDuration:r.property("EntityWithTimeIntervalKey").duration}});for(var u=n.addColumn(i),l=n.getNumberOfRows();l--;){for(var c=t.length,h=new Array(c),d=[],p=-1;++p<c;){h[p]=n.getCell(l,t[p]);var f=h[p].label;f&&d.push(f)}var _=h[this.mainInputPosition],m=_.value,g=null!==m?a.parseDateEcma262v7(_.referent.property("startDateTime")):null,y=n.getCell(l,u);y.value=g,y.label=d.join(", "),this.__backIndex[this.__keyFun.call(null,g)]=l,this.__forwardIndex[null===m?"":m]=l}this._setOutputFieldIndexes([u])},get isInvertible(){return!0},map:function(e){var t=s.getCellValue(e[this.mainInputPosition]),n=this.__forwardIndex[null===t?"":t];return null!=n?this._getDataRowCells(n,this.outputFieldIndexes):null},invert:function(e){var t=s.getCellValue(e[0]);t=this.__keyFun.call(null,t);var n=this.__backIndex[t];return null!=n?this._getDataRowCells(n,this.inputFieldIndexes):null},$type:{id:e.id,getInputTypeFor:function(e,t){return!1!==t&&e.isSubtypeOf(r.type)?u:null},validateApplication:function(e,t){return{isValid:this.__getMainInputFieldPosition(t,e)>-1,addsFields:!0}},__getMainInputFieldPosition:function(e,t){for(var i=null,r=null,o=null,a=e.length;a--;){var s=e[a],u=t.getColumnProperty(s,"EntityWithTimeIntervalKey");if(null==u){i=null;break}var l=t.getColumnHierarchyName(s);if(null==i)i=u,r=a,o=l;else{if(l!==o){i=null;break}n.type.comparePrimitiveValues(i.duration,u.duration)<1&&(i=u,r=a)}}if(null!=i){var c=i.isStartDateTimeProvided;if(null==c||c)return r}return-1},__getOutputFieldName:function(e){return e.join("_")},__getOutputFieldLabel:function(e,t){for(var n=e.length,i=new Array(n);n--;){var r=t.getColumnAttribute(e[n]);i[n]=r.label}return i.join(", ")},apply:function(e,t){return new l({data:e,inputFieldIndexes:t})}}}).configure();return l}),define("pentaho/visual/role/adaptation/EntityWithNumberKeyStrategy",["pentaho/module!_","./Strategy","pentaho/type/String","pentaho/type/Number","pentaho/util/object","pentaho/data/util"],function(e,t,n,i,r,o){"use strict";var a=t.extend({constructor:function(e){this.base(e);var t,n,i,o;this.__inputKeyFun=t=r.getSameTypeKeyFun("string"),this.__outputKeyFun=n=r.getSameTypeKeyFun("number"),this.__inputIndex=i=Object.create(null),this.__outputIndex=o=Object.create(null);for(var a,s=this.inputFieldIndexes[0],u=this.data,l=a="numberKey_"+s;u.getColumnIndexById(a)>=0;)a=l+"_"+new Date;u.model.attributes.add({name:a,type:"number",label:u.getColumnLabel(s),isKey:!0});for(var c=u.addColumn(a),h=u.getNumberOfRows(),d=-1;++d<h;){var p=u.getCell(d,s),f=p.value,_=null!==f?p.referent.property("numberKey"):null,m=u.getCell(d,c);m.value=_,m.label=p.label;var g=t(f);r.hasOwn(i,g)||(i[g]=d,o[n(_)]=d)}this._setOutputFieldIndexes([c])},get isInvertible(){return!0},map:function(e){var t=o.getCellValue(e[0]),n=r.getOwn(this.__inputIndex,this.__inputKeyFun(t));return void 0===n?null:[this.data.getCell(n,this.outputFieldIndexes[0])]},invert:function(e){var t=o.getCellValue(e[0]),n=r.getOwn(this.__outputIndex,this.__outputKeyFun(t));return void 0===n?null:[this.data.getCell(n,this.inputFieldIndexes[0])]},$type:{id:e.id,get isIdentity(){return!0},getInputTypeFor:function(e,t){return!1!==t&&e.isSubtypeOf(i.type)?n.type:null},validateApplication:function(e,t){var n=t[0];return null==e.getColumnProperty(n,"EntityWithNumberKey")?{isValid:!1}:{isValid:!0,addsFields:!0}},apply:function(e,t){return new a({data:e,inputFieldIndexes:t})}}}).configure();return a}),define("pentaho/visual/role/adaptation/allStrategies",["./IdentityStrategy","./TupleStrategy","./CombineStrategy","./EntityWithTimeIntervalKeyStrategy","./EntityWithNumberKeyStrategy"],function(){"use strict"}),define("pentaho/visual/role/util",["pentaho/type/action/Transaction","pentaho/data/util","pentaho/util/arg","pentaho/util/fun"],function(e,t,n,i){"use strict";function r(e,t){var n=t.length;return e.sort(function(e,r){for(var o=-1;++o<n;){var a=t[o],s=i.compare(a(e),a(r));if(0!==s)return s}return 0})}var o={testAddField:function(t,i,r,o){var a=n.optional(o,"alternateData",null);if(null===a&&null===t.data)return null;var s=t.$type.get(i),u=t.get(i),l=u.fields,c=l.count,h=c>0?l.get(r):null,d=n.optional(o,"fieldPosition",null),p=!1;if(c>0&&null!=d&&d<c){d=Math.max(0,d);if(l.at(d)===h)return null;p=n.optional(o,"replaceTarget",!1),"auto"===p&&(p=null===h&&l.count>=s.fields.countRangeOn(t,{ignoreCurrentMode:!0}).max)}else if(d=c,null!==h&&l.at(d-1)===h)return null;return e.enter().using(function(e){return null!==a&&(t.data=a),t.selectionFilter=null,p&&l.removeAt(d,1),null===h?l.insert(r,d):l.move(h,d),e.acceptWill().isRejected||s.validateOn(t)?null:{name:i,propType:s,fieldName:r,fieldPosition:d,replaceTarget:p,mode:u.mode}})},testAddFieldAtAutoPosition:function(e,t,n,i){for(var r=null==i?{}:Object.create(i),a=e.get(t).fields.count+1;a--;){r.fieldPosition=a;var s=o.testAddField(e,t,n,r);if(null!==s)return s}return null},getValidRolesForAddingField:function(e,t,n){var i=[];return e.$type.eachVisualRole(function(r){if(r.isBrowsable){var a=o.testAddFieldAtAutoPosition(e,r.name,t,n);null!==a&&i.push(a)}}),i},getBestRoleForAddingField:function(e,i,a){var s=n.optional(a,"alternateData")||e.data;if(null===s)return null;var u=o.getValidRolesForAddingField(e,i,a);if(0===u.length)return null;var l=s.getColumnIndexById(i),c=t.isColumnTypeContinuous(s.getColumnType(l)),h=s.getColumnHierarchyName(l);return r(u,[function(t){var n=e.get(t.name),i=t.propType.fields.countRangeOn(e);return n.fields.count<i.min?0:1},function(e){
return e.mode.isContinuous?0:c?1:0},function(t){if(null===h)return 0;var n=!1,i=e.get(t.name);return i.hasFields&&(n=!0,i.fieldIndexes.some(function(e){return s.getColumnHierarchyName(e)!==h&&(n=!1,!0)})),n?0:1},function(t){return e.get(t.name).fields.count},function(e){return e.propType.ordinal},function(e){return e.propType.index}])[0]},getRoleFirstHierarchy:function(e,t){var n=e.data;if(null!==n){var i=e.get(t).fieldIndexes;if(null!==i)for(var r=-1,o=i.length;++r<o;){var a=n.getColumnHierarchyName(i[r]);if(null!==a)return a}}return null},getHierarchyNextOrdinal:function(e,t){var n=e.data;if(null===n)return null;var i=-1,r=!0;return e.$type.eachVisualRole(function(o){if(e.get(o).hasFields){var a=e.get(o).fieldIndexes;if(null==a)return r=!1,!1;a.forEach(function(e){if(n.getColumnHierarchyName(e)===t){var r=n.getColumnHierarchyOrdinal(e);null!==r&&r>i&&(i=r)}})}}),r?i+1:null}};return o}),define("pentaho/visual/scene/util",["pentaho/util/error","pentaho/data/util"],function(e,t){"use strict";var n={createFilterFromVars:function(e,i){var r=n.invertVars(e,i);return t.createFilterFromCellsMap(r,i.data)},invertVars:function(e,n,i){function r(e,n){u&&!t.isColumnKeyEffective(s,o[n],l)||(h[a[n]]=e)}var o,a,s=n.data,u=!(i&&i.includeMeasureFields),l=u?t.hasAnyKeyColumns(s):null,c=n.$type,h={};for(var d in e){var p=c.get(d,!0);if(null!==p&&c.isVisualRole(p)){var f=n.get(d);if(f.hasFields){o=u?[]:null,a=[],f.fields.each(function(e){var t=e.name;a.push(t),u&&o.push(s.getColumnIndexById(t))});var _=e[d];Array.isArray(_)?_.forEach(r):r(_,0)}}}return h}};return n}),define("pentaho/visual/scene/impl/Variable",["module","pentaho/lang/Base"],function(e,t){return t.extend(e.id,{constructor:function(e,t){this.value=e,this.formatted=void 0!==t?t:null},valueOf:function(){return this.value},toString:function(){return this.formatted}})}),define("pentaho/visual/scene/Base",["module","pentaho/lang/Base","./util","./impl/Variable","pentaho/util/object","pentaho/util/error"],function(e,t,n,i,r,o){function a(e,t){var n=e.fieldIndexes;return e.mode.dataType.isList?u(t,n):s(t,n[0])}function s(e,t){return function(n){return e.getCell(n,t)}}function u(e,t){var n=t.length;return function(t){for(var i=new Array(n),r=n;r--;)i[r]=e.getCell(t,r);return i}}var l=t.extend(e.id,{constructor:function(e,t){if(null!=e)this.parent=e,this.index=e.__appendChildCore(this),this.vars=Object.create(e.vars);else{if(this.parent=null,this.index=-1,this.vars=Object.create(null),r.setConst(this.vars,"$root",this),null==t)throw o.argRequired("model");this.__model=t}},parent:null,index:-1,children:Object.freeze([]),get root(){return this.vars.$root},get model(){return this.root.__model},__appendChildCore:function(e){var t=r.getOwn(this,"children")||(this.children=[]),n=t.length;return t.push(e),n},createFilter:function(){return n.createFilterFromVars(this.vars,this.model)},invert:function(e){return n.invertVars(this.vars,this.model,e)}},{buildScenesFlat:function(e){var t=new l(null,e),n=e.data,i=[];e.$type.eachVisualRole(function(t){var r=e.get(t);r.hasFields&&i.push({name:t.name,mapper:a(r,n)})});for(var r=-1,o=n.getNumberOfRows(),s=i.length;++r<o;)for(var u=new l(t),c=-1;++c<s;){var h=i[c];u.vars[h.name]=h.mapper(r)}return t}});return l}),define("pentaho/visual/DefaultViewAnnotation",["module","pentaho/module/Annotation","pentaho/module/metaService"],function(e,t,n){var i=t.extend(e.id,{constructor:function(e,t){this.base(e),this._module=t},get module(){return this._module}},{get id(){return e.id},createAsync:function(e,t){var r=t&&t.module;r=e.resolveId(r||"./View");var o=n.get(r,{createIfUndefined:!0});return Promise.resolve(new i(e,o))}});return i}),define("pentaho/visual/util",["require","pentaho/module/metaService","./DefaultViewAnnotation","pentaho/theme/service","pentaho/type/loader","pentaho/util/object","pentaho/util/promise","pentaho/util/error"],function(e,t,n,i,r,o,a,s){function u(e){if(null!==e){var t=e.module;return t.loadAsync().then(function(e){return{Class:e,id:t.id}})}return null}return{getDefaultViewModule:function(e,i){if(!e)throw s.argRequired("vizTypeId");var r=t.get(e,{createIfUndefined:!0});i=o.assignOwn({assertResult:!0},i);var a=r.getAnnotation(n,i);return a&&a.module},getModelAndDefaultViewClassesAsync:function(e,i){return e?new Promise(function(r,a){var s=t.get(e,{createIfUndefined:!0}),l=s.loadAsync();i=o.assignOwn({assertResult:!0},i);var c=s.getAnnotationAsync(n,i).then(u);Promise.all([l,c]).then(function(e){var t=e[0],n=e[1];r({Model:t,View:n&&n.Class,viewTypeId:n&&n.id})},a)}):Promise.reject(s.argRequired("vizTypeId"))},classifyDom:function(e,t,n){t&&i.classifyDomAsModule(e,t),n&&i.classifyDomAsModule(e,n)},getCssClasses:function(e,t){var n=[];return e&&n.push(i.getModuleCssClasses(e)),t&&n.push(i.getModuleCssClasses(t)),n.join(" ")}}}),define("pentaho/visual/samples/calc/Model",["pentaho/module!_","pentaho/visual/Model","pentaho/i18n!model"],function(e,t,n){"use strict";var i=n.structured.operation.domain;return t.extend({$type:{id:e.id,v2Id:"sample_calc",props:[{name:"levels",base:"pentaho/visual/role/Property",modes:[{dataType:"list"}],fields:{isRequired:!0}},{name:"measure",base:"pentaho/visual/role/Property",modes:[{dataType:"number"}],fields:{isRequired:!0}},{name:"operation",valueType:"string",domain:[{v:"min",f:i.min.f},{v:"max",f:i.max.f},{v:"avg",f:i.avg.f},{v:"sum",f:i.sum.f}],defaultValue:"min"}]}}).localize({$type:n.structured.type}).configure()}),define("pentaho/ccc/visual/_util",["cdf/lib/CCC/def","cdf/lib/CCC/protovis"],function(e,t){"use strict";var n=/\[#null\]$/;return{isNullMember:function(e){return null==e||n.test(e)},copyColorMap:function(n,i){if(i){n||(n={});for(var r in i)e.hasOwn(i,r)&&(n[r]=t.color(i[r]))}return n},defaultFont:function(e,t){return e?e.replace(/\bdefault\s*$/i,"OpenSansRegular, sans-serif"):(t||10)+"px OpenSansRegular, sans-serif"},readFontModel:function(e,t){var n=e.getv(t+"Size");if(n){var i=e.getv(t+"Style");return null==i||"plain"===i?i="":i+=" ",i+n+"px "+e.getv(t+"FontFamily")}},getFilterClauseCount:function(e){if(e&&(e=e.toDnf(),"or"===e.kind))return e.operands.count},getCccValueTypeOfFieldType:function(e){switch(e){case"string":return String;case"number":return Number;case"date":return Date}return null},getCccContextActiveVisualRolesOfMeasureDimension:function(e,t){var n=e.scene,i=n.panel().visualRolesOf(t);if(null!==i){var r=n.group&&1===n.groups.length?n.group:n.data();i=i.filter(function(e){return!e.isMeasureEffective||e.isBoundDimensionName(r,t)}),0===i.length&&(i=null)}return i},getCccContextInterpolationLabelOfDimension:function(e,t){var n=e.scene.datums().where(function(e){return e.isInterpolated&&e.interpDimName===t}).first();return n?n.interpolation:null},getCccContextAtomLabel:function(e,t){var n;if(e&&(n=e.scene.group)){if(n&&n.count()>1){var i=n.dimensions(t.dimension.name);return i.format(i.value({visible:!0}))}}return t.label},findCccContextPercentRoleLabel:function(t,n){var i=t.scene,r=e.query(n).select(function(e){if(e.isPercent){var t=i.vars[e.name];if(t&&null!=t.percent)return t.percent}}).first();return null!=r?r.label:null}}}),define("pentaho/ccc/visual/Abstract",["pentaho/module!_","pentaho/visual/impl/View","pentaho/visual/models/Abstract","pentaho/lang/UserError","cdf/lib/CCC/def","cdf/lib/CCC/pvc","cdf/lib/CCC/protovis","./_util","pentaho/data/util","pentaho/data/filter/Or","pentaho/data/filter/And","pentaho/data/filter/IsEqual","pentaho/util/object","pentaho/visual/color/util","pentaho/data/TableView","pentaho/util/logger","pentaho/util/spec","pentaho/debug","pentaho/debug/Levels","pentaho/i18n!view","css!./theme/tipsy.css"],function(e,t,n,i,r,o,a,s,u,l,c,h,d,p,f,_,m,g,y,v){"use strict";var b=g.testLevel(y.debug,e),C={compatVersion:1,compatFlags:1,isMultiValued:1,measuresIndexes:1,multiChartIndexes:1,measuresInColumns:1,dataMeasuresInColumns:1,ignoreMetadataLabels:1,dataIgnoreMetadataLabels:1,typeCheckingMode:1,dataTypeCheckingMode:1,seriesInRows:1,crosstabMode:1,width:1,height:1,canvas:1,readers:1,visualRoles:1,extensionPoints:1,categoriesCount:1,dataCategoriesCount:1},O=t.extend(e.id,{_options:{compatVersion:2,compatFlags:{discreteTimeSeriesTickFormat:!1},format:{percent:"#,0.00%"},clearSelectionMode:"manual",tooltipEnabled:!0,tooltip:{className:"pentaho-visual-ccc",delayIn:200,delayOut:80,offset:2,html:!0,gravity:"nw",fade:!1,followMouse:!0,useCorners:!0,arrowVisible:!1,opacity:1},trendDot_ibits:0,trendDot_imask:"ShowsActivity",trendLine_ibits:0,trendLine_imask:"ShowsActivity",crosstabMode:!1,isMultiValued:!0,seriesInRows:!1,dataTypeCheckingMode:"none",ignoreNulls:!1,baseAxisOriginIsZero:!1},_hideNullMembers:!1,_roleToCccRole:{multi:"multiChart",columns:"series",rows:"category",measures:"value"},_genericMeasureCccVisualRole:null,_genericMeasureDiscrimCccVisualRole:null,get _genericMeasureDiscrimCccDimName(){var e=this._genericMeasureCccVisualRole;return null!==e?e+"Role.dim":null},_noRoleInTooltipMeasureRoles:{measures:!0},_tooltipHidePercentageOnPercentFields:!1,_multiRole:"multi",_discreteColorRole:"columns",_updateAll:function(){return this._isMultiChartMode=!!this._multiRole&&this.model.get(this._multiRole).hasFields,this._initOptions(),this._processExtensions(),this._initData(),this._configureOptions(),this._prepareLayout(),this._applyExtensions(),this._renderCore()},_updateSize:function(){null!=this._lastResizeTimeout&&clearTimeout(this._lastResizeTimeout),this._lastResizeTimeout=setTimeout(function(){this._lastResizeTimeout=null,this._doResize()}.bind(this),50)},dispose:function(){this.__disposeChart(),this.base()},__disposeChart:function(){this._chart&&this._chart.dispose&&(this._chart.dispose(),this._chart=null)},_updateSelection:function(){b&&_.log("_updateSelection BEGIN");try{var e=this.model.selectionFilter,t=this.model.data;t.originalCrossTable&&(t=t.originalCrossTable.toPlainTable({skipRowsWithAllNullMeasures:!0}));for(var n=this._getSourceKeyMappingFieldInfos().array(),i=t.filter(e),r=[],o={},a=0,s=i.getNumberOfRows();a<s;a++){var u=n.reduce(function(e,t){return e[t.name]=i.getValue(a,t.sourceIndex),e},{}),l=function(e){return Object.keys(e).sort().map(function(t){return t+":"+e[t]}).join(",")}(u);d.hasOwn(o,l)||(o[l]=!0,r.push(u))}if(!r.length)return this._chart.clearSelections();this._chart.data.replaceSelected(this._chart.data.datums(r)),this._chart.updateSelections()}finally{b&&_.log("_updateSelection END")}},_doResize:function(){if(this._chart){var e=this._chart.options,t=this.model;e.width=t.width,e.height=t.height,this._prepareLayout(),this._chart.renderResize(e.width,e.height)}},_initOptions:function(){var e=this.options=r.create(this._options),t=this.model;r.set(e,"canvas",this.domContainer,"height",t.height||400,"width",t.width||400,"dimensions",{},"visualRoles",{},"readers",[])},_getMappingFieldInfosOfRole:function(e,t){var n=r.getOwn(this._visualMap,e,null);return null!==n&&t&&(n=n.filter(function(e){return!e.isMeasureDiscrim})),n},_isRoleCategorical:function(e){var t=this.model.get(e).mode;return null!==t&&!t.isContinuous},_getRolesMappedToCccRole:function(e){return r.getOwn(this._rolesByCccVisualRole,e,null)},_getSourceKeyMappingFieldInfos:function(){return r.query(this._axes.key).where(function(e){return!e.isMeasureDiscrim})},_setNullInterpolationMode:function(e){},_initData:function(){var e=this.model.data,t=this._hasDataKeyColumns=u.hasAnyKeyColumns(e),n=0,i=this._genericMeasureCccVisualRole,o=[],a={},s={key:[],measure:[]},l={},c={},h=function(e){e.isGenericMeasure=e.cccRoleName===i,e.isGenericMeasure&&n++,o.push(e),a[e.name]=e,s[e.isKey?"key":"measure"].push(e),r.array.lazy(l,e.roleName).push(e)};this.model.$type.eachVisualRole(function(n){var i=n.name,o=this.model.get(i),a=this._roleToCccRole[i];if(!a)throw r.error.operationInvalid("No CCC Role for '{0}'",[i]);r.array.lazy(c,a).push(i),o.hasFields&&o.fields.each(function(n,r){var o=n.name,s=e.getColumnIndexById(o),u=e.getColumnAttribute(s),l="_"+i+"_"+(r+1),c=t?u.isKey:!u.isContinuous;h({name:l,label:u.label||o,roleName:i,isKey:c,sourceName:u.name,sourceType:u.type,sourceIndex:e.getColumnIndexById(u.name),sourceIsContinuous:u.isContinuous,sourceFormat:u.format,sourceMembers:u.members,sourceIsPercent:!!u.isPercent,sourceColor:u.property("color"),sourceTimeIntervalDuration:u.property("timeIntervalDuration"),cccRoleName:a,isMeasureDiscrim:!1})})},this),Object.keys(c).forEach(function(e){c[e].sort()}),this._mappingFieldInfos=o,this._mappingFieldInfosByName=a,this._axes=s,this._visualMap=l,this._rolesByCccVisualRole=c,this._genericMeasuresCount=n,(this._isGenericMeasureMode=n>1)&&h(this._createGenericMeasureDiscriminator()),this._transformData(),this._configureCccDimensions(),this._configureCccVisualRoles()},_createGenericMeasureDiscriminator:function(){var e=this._genericMeasureDiscrimCccVisualRole,t=this._getRolesMappedToCccRole(e)[0];return{name:this._genericMeasureDiscrimCccDimName,label:"Generic Measure Discriminator",roleName:t,cccRoleName:e,isKey:!0,sourceName:null,sourceType:null,sourceIndex:null,sourceIsContinuous:null,sourceFormat:null,sourceMembers:null,sourceIsPercent:!1,sourceColor:null,isMeasureDiscrim:!0}},_transformData:function(){var e=[],t=[],n=[],i=[],r=this.model.data;this._mappingFieldInfos.forEach(function(r){if(!r.isMeasureDiscrim){var o,a;"number"===r.sourceType?(o=t,a=i):(o=e,a=n),o.push(r.sourceIndex),a.push(r.name)}});for(var o=e.length,a=t.length,s=[];a--;)s.push(o++);this.options.measuresIndexes=s,this._dataView=new f(r),this._dataView.setSourceColumns(e.concat(t)),this.options.readers=n.concat(i)},_configureCccDimensions:function(){var e=this.options.dimensions;this._mappingFieldInfos.forEach(function(t){if(t.sourceName){var n=r.lazy(e,t.name);n.valueType=s.getCccValueTypeOfFieldType(t.sourceType),n.isDiscrete=this._isRoleCategorical(t.roleName),n.comparer=null,n.valueType===Date&&(n.formatter=function(e){return null==e?"":e.toString()})}},this)},_configureCccVisualRoles:function(){var e=this.options.visualRoles;this._mappingFieldInfos.forEach(function(t){var n=r.lazy(e,t.cccRoleName);r.array.lazy(n,"dimensions").push(t.name)})},_configureOptions:function(){var e=this.options,t=this.model;this._labelFont=s.defaultFont(t.labelSize?s.readFontModel(t,"label"):null);var n=t.backgroundFill;if(n&&"none"!==n){var i;if("gradient"===n)if(this._isMultiChartMode){var o=a.color(t.backgroundColor).rgb();o=a.rgb(Math.floor((255+o.r)/2),Math.floor((255+o.g)/2),Math.floor((255+o.b)/2),o.a),i=o}else i="linear-gradient(to top, "+t.backgroundColor+", "+t.backgroundColorEnd+")";else i=t.backgroundColor;e.base_fillStyle=i}if(null!=(n=t.getv("lineWidth",!0))){e.line_lineWidth=n;var u=5/6*(n-2)+4;e.dot_shapeSize=u*u,e.plot2Line_lineWidth=e.line_lineWidth,e.plot2Dot_shapeSize=e.dot_shapeSize}n=t.getv("emptyCellMode",!0),n&&this._setNullInterpolationMode(n),n=t.getv("sizeByNegativesMode",!0),e.sizeAxisUseAbs="useAbs"===n,this._configureColor();var l=r.get(this._validExtensionOptions,"legendAreaVisible");null==l&&(l=this._shouldShowLegend()),e.legendAreaVisible=l,l&&this._configureLegend(),this._configureTrends(),this._configureFormats(),this._configureLabels(),this._isMultiChartMode&&this._configureMultiChart(),e.interactive=!!r.get(this._validExtensionOptions,"interactive",!0),e.interactive&&(e.tooltipEnabled&&this._configureTooltip(),r.get(this._validExtensionOptions,"selectable",e.selectable)&&this._configureSelection(),r.get(this._validExtensionOptions,"clickable",e.clickable)&&this._configureDoubleClick())},_isColorCategorical:function(){var e=this._discreteColorRole;if(e&&this.model[e].hasFields)return this._isRoleCategorical(e)},_getColorScaleKind:function(){return"discrete"},_configureColor:function(){switch(this._getColorScaleKind()){case"discrete":this._configureDiscreteColors();break;case"continuous":this._configureContinuousColors()}},_configureDiscreteColors:function(){var e,t=a.colors(this._getDefaultDiscreteColors());if(this._discreteColorRole){var n=this._getDiscreteColorMap();if(n)if(r.fun.is(n))e=n;else{var i=function(e){return r.getOwn(n,e)};i.domain=function(){return Object.keys(n)},e=this._createDiscreteColorMapScaleFactory(i,t)}}this.options.colors=e||t},_configureContinuousColors:function(){var e=this.model;this.options.colorScaleType="gradient"===e.pattern?"linear":"discrete";var t=e.paletteQuantitative;this.options.colors=t?t.colors.toArray(function(e){return e.value}):p.buildPalette(e.colorSet,e.pattern,e.reverseColors)},_getDefaultDiscreteColors:function(){return this.model.palette.colors.toArray(function(e){return e.value})},_getDiscreteColorMap:function(){var e=this._getMemberPalette();if(e){var t,n=this._getMappingFieldInfosOfRole(this._discreteColorRole,!0),i=n?n.length:0,r=this._genericMeasuresCount;if(i>0||r>0)if(0===i||r>1){if(t=e["[Measures].[MeasuresLevel]"],1===r){var o=t&&t[this._axes.measure[0].name];return o?a.colors([o]):null}t=s.copyColorMap(null,t)}else t=s.copyColorMap(null,e[n[i-1].name]);return t}},_getMemberPalette:function(){function e(e,n,i){t||(t={}),r.lazy(t,e)[n]=i}var t=null;return this._mappingFieldInfos.forEach(function(t){t.isMeasureDiscrim||(t.sourceMembers?t.sourceMembers.forEach(function(n){var i=n.property("color");i&&e(t.name,n.value,i)}):t.isGenericMeasure&&t.sourceColor&&e("[Measures].[MeasuresLevel]",t.name,t.sourceColor))}),t},_createDiscreteColorMapScaleFactory:function(e,t){return function(n){function i(n){if(n){var i=o(n);return e(i)||t(i)}}function o(e){var t=e.split("~");return t[t.length-1]}return t.domain(n),r.copy(i,t),i.domain=function(){var n=e.domain(),i=t.domain();return r.query(n).union(i).distinct(r.identity).array()},i}},_configureTrends:function(){var e=this.options,t=this.model,n=(this._supportsTrends?t.trendType:null)||"none";switch(n){case"none":case"linear":break;default:n="none"}if(e.trendType=n,"none"!==n){var i=t.trendName;i||(i=v.get("trend.name."+n.toLowerCase(),n)),e.trendLabel=i;var r=t.trendLineWidth;if(null!=r){r=+r,e.trendLine_lineWidth=r;var o=5/6*(r-2)+4;e.trendDot_shapeSize=o*o}var s=a.colors(this._getDefaultDiscreteColors());this.options.color2AxisColors=s}else this._supportsTrends&&delete this.options.color2AxisColors},_configureFormats:function(){var e=this.model.data.model.format;if(e){var t=this.options.format=r.create(this.options.format,e),n=e.number&&e.number.style;!n||e.percent&&e.percent.style||(t.percent?r.string.is(t.percent)&&(t.percent={mask:t.percent}):t.percent={},t.percent.style=n)}var i=this.options.dimensions;r.query(this._mappingFieldInfos).where(function(e){return!e.isMeasureDiscrim&&e.sourceIsContinuous}).each(function(e){var t=e.sourceFormat,n=t&&t.number&&t.number.mask;n&&(r.lazy(i,e.name).format=n)})},_configureLabels:function(){var e=this.options,t=this.model,n=t.labelsOption,i=!!r.get(this._validExtensionOptions,"valuesVisible",n&&"none"!==n);if(e.valuesVisible=i,i){this._configureLabelsAnchor(),e.valuesFont=this._labelFont;var o=t.labelColor;o&&(e.label_textStyle=o)}},_configureLabelsAnchor:function(){var e=this.model.labelsOption,t=/(^\w+)([A-Z])(\w+)/,n=t.exec(e);null!=n&&(e=n[1]+"_"+n[2].toLowerCase()+n[3]),this.options.valuesAnchor=e},_configureMultiChart:function(){var e,t=this.model,n=this.options,i=t.labelSize;if(i){var r=t.labelFontFamily;e=s.defaultFont(i+2+"px "+r)}else e=s.defaultFont(null,12);n.titleFont=e,/black|(\bbold\b)/i.test(e)||(e="bold "+e),n.smallTitleFont=e;var o=t.multiChartOverflow;o&&(n.multiChartOverflow=o.toLowerCase()),o=t.maxChartsPerRow,null!=o&&(n.multiChartColumnsMax=o),(o=t.multiChartRangeScope)&&(n.numericAxisDomainScope=o)},_configureTooltip:function(){var e=this;this.options.tooltipFormat=function(){return e._getTooltipHtml(this)}},_getTooltipHtml:function(e){if(!this.model.isDirty){var t,n=[];this._axes.key.forEach(function(t){this._buildTooltipHtmlOfField(n,t,e)},this),this._axes.measure.forEach(function(t){this._buildTooltipHtmlOfField(n,t,e)},this);if(!e.scene.datum.isVirtual){var i=this.model.application;if(i&&i.getDoubleClickTooltip){var r=this._createExecuteFilter(e);null!==r&&(t=i.getDoubleClickTooltip(r))&&n.push(t)}}var o=s.getFilterClauseCount(this.model.selectionFilter);if(o>0){var a=1===o?"tooltip.footer.selectedOne":"tooltip.footer.selectedMany";t=v.get(a,[o]),n.push(t)}return n.join("<br />")}},_buildTooltipHtmlOfField:function(e,t,n){if(!t.isMeasureDiscrim){n.chart.data.type.dimensions(t.name).isHidden||(t.isKey||"number"!==t.sourceType?this._buildTooltipHtmlOfFieldNonNumeric(e,t,n):this._buildTooltipHtmlOfFieldNumeric(e,t,n))}},_buildTooltipHtmlOfFieldNonNumeric:function(e,t,n){if(null===this._multiRole||t.roleName!==this._multiRole){var i=n.scene,o=i.group||i.datum,a=o.getSpecifiedAtom(t.name);if(null!==a){var u=a.value;this._hideNullMembers&&s.isNullMember(u)||null==u&&null!==i.datum&&i.datum.isTrend||e.push(r.html.escape(t.label)+": "+r.html.escape(a.label))}}},_buildTooltipHtmlOfFieldNumeric:function(e,t,n){var i=t.name,o=s.getCccContextActiveVisualRolesOfMeasureDimension(n,i);if(null!==o){var a=n.scene.datums().first(function(e){return null!==e.atoms[i].value});if(null!=a){var u=r.html.escape(t.label);if(!0!==this._noRoleInTooltipMeasureRoles[t.roleName]&&(u+=" ("+r.html.escape(t.roleName)+")"),u+=": "+r.html.escape(s.getCccContextAtomLabel(n,a.atoms[i])),!t.sourceIsPercent||!this._tooltipHidePercentageOnPercentFields){var l=s.findCccContextPercentRoleLabel(n,o);null!==l&&(u+=" ("+r.html.escape(l)+")")}var c=s.getCccContextInterpolationLabelOfDimension(n,i);null!==c&&(u+=" "+v.get("tooltip.dim.interpolation."+c)),a.isTrend&&(u+=" ("+this.options.trendLabel+")"),e.push(u)}}},_shouldShowLegend:function(){return!!this.model.showLegend&&!(!1===this._isColorCategorical()||!this._getMappingFieldInfosOfRole(this._discreteColorRole))},_configureLegend:function(){var e=this.model,t=this.options,n=e.legendColor;n&&(t.legendLabel_textStyle=n),n=e.legendBackgroundColor,n&&"#ffffff"!==n.toLowerCase()&&(t.legendArea_fillStyle=n),n=e.legendPosition,n&&(t.legendPosition=n),e.legendSize&&(t.legendFont=s.readFontModel(e,"legend")),t.legendFont=s.defaultFont(t.legendFont,10);var i=t.legendPosition;if("top"===i||"bottom"===i)t.legendAlign="left";else if(t.legendAlign="top",this._isMultiChartMode){var r=t.legendMargins;if(r)"object"!=typeof r&&(r=t.legendMargins={all:r});else{r=t.legendMargins={};var a=o.BasePanel.oppositeAnchor[i];r[a]=5}r.top=20}t.legendMarkerSize=10,t.legend$Dot_lineWidth=2,t.legend$Dot_shapeSize=Math.pow(3,2)},_prepareLayout:function(){},_processExtensions:function(){var e=null,t=this.extensionEffective;t&&r.each(t,function(t,n){r.hasOwn(C,n)||(e||(e={}),e[n]=t)}),this._validExtensionOptions=e},_applyExtensions:function(){var e=this._validExtensionOptions;e&&(this.options=r.mixin.copy({},this.options,e))},_createChart:function(e){return new e(this.options)},_getVisualElementsCountMax:function(){return-1},_validateVisualElementsCount:function(e,t){if(e>t){var n={count:e,countMax:t},i=new o.InvalidDataException(v.get("error.visualElemsCountMax",n),"visual-elems-count-max");throw i.messageParams=n,i}},_renderCore:function(){this.__disposeChart(),this._chart=this._createChart(o[this._cccClass]),this._chart.setData(this._dataView.toJsonCda());var e="page"===this.options.multiChartOverflow;e?this._chart.renderPages():this._chart.render();var t=this._chart.getLastRenderError();return t?Promise.reject(this._convertCccError(t)):(e||this._updateSelection(),null)},_convertCccError:function(e){var t;return e instanceof o.InvalidDataException||e instanceof o.NoDataException?(t=new i(e.message),Object.defineProperty(t,"name",{value:e.name})):t=new Error(e.toString()),t},_configureSelection:function(){var e=this;this.options.userSelectionAction=function(t,n){return e._onUserSelection(this,t,n)},this.options.base_event=[["click",function(){e._onUserSelection(this,[])}]]},_onUserSelection:function(e,t,n){if(this.model.isDirty)return[];var i=this._createSelectFilter(t,n),r=e.event;return this.model.select({dataFilter:i,position:r?{x:r.clientX,y:r.clientY}:null}),[]},_createSelectFilter:function(e,t){var n=[];if(t){var i=this._convertCccComplexToFilter(t);i&&n.push(i)}else e.forEach(function(e){if(!e.isVirtual&&!e.isNull){var t=this._convertCccComplexToFilter(e);t&&n.push(t)}},this);return new l({operands:n})},_configureDoubleClick:function(){var e=this;this.options.doubleClickAction=function(){e._executeOn(this)},this.options.axisDoubleClickAction=function(){e._executeOn(this)}},_executeOn:function(e){if(!this.model.isDirty){var t=this._createExecuteFilter(e);if(null!==t){t=new l({operands:[t]});var n=e.event;this.model.execute({dataFilter:t,position:n?{x:n.clientX,y:n.clientY}:null})}}},_createExecuteFilter:function(e){var t=e.scene;if(null!==t.groups&&t.groups.length>1)return null;var n=t.group||t.datum;return this._convertCccComplexToFilter(n)},_convertCccComplexToFilter:function(e){var t=null;return this._getSourceKeyMappingFieldInfos().each(function(n){var i=e.getSpecifiedAtom(n.name);if(i){var r=null===i.value?i.rawValue:i.value,o=n.sourceType,a=new h({property:n.sourceName,value:null===r?null:{_:o,v:r,f:i.label}});t=null!==t?t.and(a):new c({operands:[a]})}}),t},__extension:null,__extensionEf:void 0,get extension(){return this.__extension},set extension(e){this.__extension=e?Object(e):null,this.__extensionEf=void 0},get extensionEffective(){var e=this.__extensionEf;if(void 0===e){if(e=null,null!=O&&this!==O.prototype){var t=Object.getPrototypeOf(this),n=t.extensionEffective;n&&(e={},m.merge(e,n))}this.__extension&&(e||(e={}),m.merge(e,this.__extension)),this.__extensionEf=e}return e}},{_extend:function(e,t,n,i){return t||(t={}),t._options=r.mixin.share({},this.prototype._options,t._options||{}),this.base(e,t,n,i)},_subclassed:function(e,t,n,i){e.prototype.__extension=null,e.prototype.__extensionEf=void 0,this.base(e,t,n,i)}}).implement(e.config);return O}),define("pentaho/ccc/visual/CartesianAbstract",["pentaho/module!_","./Abstract","./_util","cdf/lib/CCC/def","pentaho/i18n!./i18n/view"],function(e,t,n,i,r){"use strict";return t.extend(e.id,{_options:{orientation:"vertical"},_configureOptions:function(){this.base();var e=this.options,t=this.model,i=t.labelColor;null!=i&&(e.axisLabel_textStyle=e.axisTitleLabel_textStyle=i),i=t.labelSize,e.axisTitleFont=e.axisFont=i?this._labelFont:n.defaultFont(null,12),this._configureDisplayUnits(),this._isAxisTitleVisible("base")&&this._configureAxisTitle("base",this._getBaseAxisTitle()),this._isAxisTitleVisible("ortho")&&this._configureAxisTitle("ortho",this._getOrthoAxisTitle())},_isAxisTitleVisible:i.fun.constant(!0),_getOrthoAxisTitle:i.noop,_getBaseAxisTitle:i.noop,_configureAxisTitle:function(e,t){var n=this._cartesianAxesDisplayUnitsText[e];(t=i.string.join(" - ",t,n))&&(this.options[e+"AxisTitle"]=t)},_getMeasureRoleTitle:function(e){var t=this._getMappingFieldInfosOfRole(e);return t&&1===t.length?t[0].label:""},_getDiscreteRolesTitle:function(e){var t=i.query(e);this._multiRole&&(t=t.where(function(e){return e!==this._multiRole},this));var n=t.selectMany(function(e){return this._getMappingFieldInfosOfRole(e)},this).distinct(function(e){return e.name}).select(function(e){return e.label}).where(i.truthy).array(),o=n.pop(),a=n.join(", ");return a&&o?r.get("axis.title.multipleDimText",[a,o]):a||o},_configureAxisRange:function(e,t){var n=e?"":"Secondary";if(!this.model.getv("autoRange"+n)){var i=this.model.getv("valueAxisLowerLimit"+n);null!=i&&(this.options[t+"AxisFixedMin"]=i,this.options[t+"AxisOriginIsZero"]=!1),i=this.model.getv("valueAxisUpperLimit"+n),null!=i&&(this.options[t+"AxisFixedMax"]=i)}},_cartesianAxesDisplayUnitsText:null,_configureDisplayUnits:function(){this._cartesianAxesDisplayUnitsText={}},_configureAxisTickUnits:function(e,t){var n=this._getMappingFieldInfosOfRole(t);if(null!=n&&1===n.length&&null!=n[0].sourceTimeIntervalDuration){var i=n[0].sourceTimeIntervalDuration;"halfYear"===i?i="6m":"quarter"===i&&(i="3m"),this.options[e+"AxisTickUnitMin"]=i}},_configureAxisDisplayUnits:function(e,t){var n="displayUnits"+(e?"":"Secondary"),i=this.model.getv(n),r=this.model.$type.get(n).valueType,o=r.scaleFactorOf(i);this._cartesianAxesDisplayUnitsText[t]=o>1?r.domain.get(i).toString():""}}).implement(e.config)}),define("pentaho/ccc/visual/CategoricalContinuousAbstract",["pentaho/module!_","./CartesianAbstract"],function(e,t){"use strict";return t.extend(e.id,{_genericMeasureCccVisualRole:"value",_genericMeasureDiscrimCccVisualRole:"series",_isAxisTitleVisible:function(e){return!this._isMultiChartMode||"ortho"===e},_getOrthoAxisTitle:function(){var e=this._getRolesMappedToCccRole(this._genericMeasureCccVisualRole);return e&&e.length>0?this._getMeasureRoleTitle(e[0]):""},_getBaseAxisTitle:function(){var e=this._getRolesMappedToCccRole("category");return e&&e.length>0?this._getDiscreteRolesTitle(e):""},_isBaseAxisCategorical:function(){var e=this._getRolesMappedToCccRole("category");return!!e&&e.length>0&&this._isRoleCategorical(e[0])},_configureOptions:function(){this.base(),this._configureAxisRange(!0,"ortho");var e=this.options;"vertical"===e.orientation?this._isBaseAxisCategorical()&&(e.xAxisLabel_textAngle=-Math.PI/4,e.xAxisLabel_textAlign="right",e.xAxisLabel_textBaseline="top"):e.xAxisPosition="top"},_configureDisplayUnits:function(){this.base(),this._configureAxisDisplayUnits(!0,"ortho"),this._configureAxisTickUnits("base","rows")},_createChart:function(e){var t=this.base(e),n=this._getVisualElementsCountMax();if(n>0){var i=this;t.override("_onWillCreatePlotPanelScene",function(e,t,r,o){var a=r.length,s=o.length,u=a*s;i._validateVisualElementsCount(u,n)})}return t}}).implement(e.config)}),define("pentaho/ccc/visual/PointAbstract",["pentaho/module!_","./CategoricalContinuousAbstract"],function(e,t){"use strict";return t.extend(e.id,{_setNullInterpolationMode:function(e){this.options.nullInterpolationMode=e}}).implement(e.config)}),define("pentaho/ccc/visual/AreaAbstract",["pentaho/module!_","./PointAbstract"],function(e,t){"use strict";return t.extend(e.id,{_cccClass:"AreaChart"}).implement(e.config)}),define("pentaho/ccc/visual/Area",["pentaho/module!_","./AreaAbstract"],function(e,t){"use strict";return t.extend(e.id).implement(e.config)}),define("pentaho/ccc/visual/AreaStacked",["pentaho/module!_","./AreaAbstract"],function(e,t){"use strict";return t.extend(e.id,{_cccClass:"StackedAreaChart"}).implement(e.config)}),define("pentaho/ccc/visual/BarAbstract",["pentaho/module!_","./CategoricalContinuousAbstract","cdf/lib/CCC/def"],function(e,t,n){"use strict";return t.extend(e.id,{_cccClass:"BarChart",_configureOptions:function(){this.base();var e=this.options;"vertical"!==e.orientation&&(n.lazy(e.visualRoles,"category").isReversed=!0)},_configureLabelsAnchor:function(){var e=this.options;switch(e.label_textMargin=7,this.model.labelsOption){case"center":e.valuesAnchor="center";break;case"insideEnd":e.valuesAnchor="horizontal"===e.orientation?"right":"top";break;case"insideBase":e.valuesAnchor="horizontal"===e.orientation?"left":"bottom";break;case"outsideEnd":"horizontal"===e.orientation?(e.valuesAnchor="right",e.label_textAlign="left"):(e.valuesAnchor="top",e.label_textBaseline="bottom")}}}).implement(e.config)}),define("pentaho/data/_trends",["./AbstractTable","./Table","./TableView","../util/arg","../util/error"],function(e,t,n,i,r){function o(e,t){if(!e)throw r.argRequired("type");if(e=""+e,!t)throw r.argRequired("spec");var n=i.required(t,"model","spec");if("function"!=typeof n)throw r.argInvalidType("spec.model","function");var o=t.label;o||(o=e.charAt(0).toUpperCase()+e.substr(1)+" Trend"),u[e]={type:e,label:o,model:n}}function a(e,t){if(!e)throw r.argRequired("type");var n=u.hasOwnProperty(e)?u[e]:null;if(!n&&t)throw r.argInvalid("type","There is no trend type named '"+e+"'.");return n}function s(){return Object.keys(u)}n.implement({createTrend:function(e){var t=this._source.createTrend(e);return this._columns.push(t)-1}}),t.implement({createTrend:function(e){if(!(e instanceof Object))throw r.argRequired("trendArgs");var t=e.type;if(!t)throw r.argRequired("trendArgs.type");t=""+t
;var n=a(t,!0),o=this.getNumberOfColumns(),s=i.required(e,"x","trendArgs");if(s=+s,isNaN(s))throw r.argInvalidType("trendArgs.x","number");if(s<0||s>=o)throw r.argRange("trendArgs.x");var u=i.required(e,"y","trendArgs");if(u=+u,isNaN(u))throw r.argInvalidType("trendArgs.y","number");if(u<0||u>=o)throw r.argRange("trendArgs.y");if("number"!==this.getColumnType(u))throw r.argInvalid("trendArgs.y","Must be a numeric column.");var l=e.name||t+"Trend",c=e.label||(e.name?l:n.label),h=e.options||{};this.model.attributes.add({name:l,type:"number",label:c});var d=this.addColumn(l),p=this,f="number"!==this.getColumnType(s),_=this.getRowIndexEnumerator(),m=f?null:function(e){return p.getValue(e,s)},g=function(e){return p.getValue(e,u)},y=Object.create(h);y.rows=_,y.x=m,y.y=g;var v=n.model(y);if(!v)return!1;for(var b=-1,C=this.getNumberOfRows();++b<C;){var O=m?m(b):b,x=null!=O?v.sample(O,g(b),b):null;this.getCell(b,d).value=x}return!0}}),e.implement({getRowIndexEnumerator:function(){var e=-1,t=this.getNumberOfRows(),n={item:void 0,next:function(){return e<t-1?(n.item=++e,!0):(n.item&&(n.item=void 0),!1)}};return n}});var u={};return{types:s,define:o,get:a}}),define("pentaho/data/_trend-linear",["./_trends"],function(e){function t(e){return null!=e?+e:NaN}e.define("linear",{label:"Linear trend",model:function(e){for(var n=e.rows,i=e.x,r=e.y,o=0,a=0,s=0,u=0,l=0,c=0;n.next();){var h=n.item,d=i?t(i(h)):o;if(!isNaN(d)){var p=t(r(h));isNaN(p)||(a++,s+=d,u+=p,l+=d*p,c+=d*d)}o++}if(a>=2){var f=s/a,_=u/a,m=l/a,g=c/a,y=g-f*f,v=y&&(m-f*_)/y,b=_-v*f;return{alpha:b,beta:v,reset:function(){},sample:function(e){return b+v*+e}}}}})}),define("pentaho/data/trends",["./_trends","./_trend-linear"],function(e){return e}),define("pentaho/ccc/visual/_trends",["cdf/lib/CCC/pvc","pentaho/data/trends"],function(e,t){t.types().forEach(function(n){if(!e.trends.has(n)){var i=t.get(n);e.trends.define(n,i)}})}),define("pentaho/ccc/visual/Bar",["pentaho/module!_","./BarAbstract","./_trends"],function(e,t){"use strict";return t.extend(e.id,{_supportsTrends:!0}).implement(e.config)}),define("pentaho/ccc/visual/BarHorizontal",["pentaho/module!_","./BarAbstract"],function(e,t){"use strict";return t.extend(e.id,{_options:{orientation:"horizontal"}}).implement(e.config)}),define("pentaho/ccc/visual/BarLine",["pentaho/module!_","./BarAbstract","cdf/lib/CCC/def"],function(e,t,n){"use strict";return t.extend(e.id,{_roleToCccRole:{columns:"series",rows:"category",multi:"multiChart",measures:"value",measuresLine:"value"},_noRoleInTooltipMeasureRoles:{measures:!0,measuresLine:!0},_options:{plot2OrthoAxis:2,ortho2AxisPosition:"right",plot2ColorAxis:1},_setNullInterpolationMode:function(e){this.options.plot2NullInterpolationMode=e},_configureCccVisualRoles:function(){var e=this.options.visualRoles,t=null;this.plot2=this.model.measuresLine.hasFields,this.plot2?(this.options.plots=[{name:"plot2",visualRoles:{}}],t=this.options.plots[0].visualRoles):this.options.plots=null,this._mappingFieldInfos.forEach(function(i){var r;r="measuresLine"===i.roleName?t:e;var o=n.lazy(r,i.cccRoleName);n.array.lazy(o,"dimensions").push(i.name)})},_configureOptions:function(){this.base();var e=this.options,t=this.model.shape;t&&"none"===t?e.pointDotsVisible=!1:(e.pointDotsVisible=!0,e.pointDot_shape=t),this._configureAxisRange(!1,"ortho2"),this._configureAxisTitle("ortho2","")},_configureLabels:function(){this.base();var e=this.model,t=e.lineLabelsOption;if(t&&"none"!==t){var n=this.options;n.plot2ValuesVisible=!0,n.plot2ValuesAnchor=t,n.plot2ValuesFont=this._labelFont;var i=e.labelColor;null!=i&&(n.plot2Label_textStyle=i)}},_configureDisplayUnits:function(){this.base(),this._configureAxisDisplayUnits(!1,"ortho2")}}).implement(e.config)}),define("pentaho/ccc/visual/BarNormalizedAbstract",["pentaho/module!_","./BarAbstract"],function(e,t){"use strict";function n(e){return e+"%"}return t.extend(e.id,{_options:{valuesNormalized:!0,stacked:!0},_configureOptions:function(){this.base(),this.options.orthoAxisTickFormatter=n}}).implement(e.config)}),define("pentaho/ccc/visual/BarNormalized",["pentaho/module!_","./BarNormalizedAbstract"],function(e,t){"use strict";return t.extend(e.id).implement(e.config)}),define("pentaho/ccc/visual/BarNormalizedHorizontal",["pentaho/module!_","./BarNormalizedAbstract"],function(e,t){"use strict";return t.extend(e.id,{_options:{orientation:"horizontal"}}).implement(e.config)}),define("pentaho/ccc/visual/BarStacked",["pentaho/module!_","./BarAbstract"],function(e,t){"use strict";return t.extend(e.id,{_options:{stacked:!0}}).implement(e.config)}),define("pentaho/ccc/visual/BarStackedHorizontal",["pentaho/module!_","./BarAbstract"],function(e,t){"use strict";return t.extend(e.id,{_options:{orientation:"horizontal",stacked:!0}}).implement(e.config)}),define("pentaho/ccc/visual/Boxplot",["pentaho/module!_","./CategoricalContinuousAbstract"],function(e,t){"use strict";return t.extend(e.id,{_cccClass:"BoxplotChart"}).implement(e.config)}),define("pentaho/ccc/visual/MetricPointAbstract",["pentaho/module!_","./CartesianAbstract","./_trends"],function(e,t){"use strict";return t.extend(e.id,{_cccClass:"MetricDotChart",_supportsTrends:!0,_roleToCccRole:{multi:"multiChart",rows:"category",x:"x",y:"y",color:"color"},_discreteColorRole:"color",_noRoleInTooltipMeasureRoles:{x:!0,y:!0,measures:!1},_getColorScaleKind:function(){var e=this._isColorCategorical();return null==e?void 0:e?"discrete":"continuous"},_configureOptions:function(){this.base(),this._configureAxisRange(!0,"base"),this._configureAxisRange(!1,"ortho")},_shouldShowLegend:function(){if(!this.base())return!1;var e=this.model.data;return e.originalCrossTable&&(e=e.originalCrossTable),!e.isCrossTable||e.implem.cols.length>1},_getOrthoAxisTitle:function(){return this._getMeasureRoleTitle("y")},_getBaseAxisTitle:function(){return this._getMeasureRoleTitle("x")},_configureDisplayUnits:function(){this.base(),this._configureAxisDisplayUnits(!0,"base"),this._configureAxisDisplayUnits(!1,"ortho"),this._configureAxisTickUnits("base","x"),this._configureAxisTickUnits("ortho","y")}}).implement(e.config)}),define("pentaho/ccc/visual/Bubble",["pentaho/module!_","./MetricPointAbstract"],function(e,t){"use strict";return t.extend(e.id,{_options:{sizeAxisUseAbs:!1},_roleToCccRole:{multi:"multiChart",rows:"category",x:"x",y:"y",size:"size",color:"color"},_configureOptions:function(){this.base(),this.options.axisOffset=this.model.size.hasFields?1.1*this.options.sizeAxisRatio/2:0}}).implement(e.config)}),define("pentaho/ccc/visual/Pie",["pentaho/module!_","./Abstract","./_util"],function(e,t,n){"use strict";return t.extend(e.id,{_cccClass:"PieChart",_roleToCccRole:{columns:"multiChart",rows:"category",measures:"value"},_genericMeasureCccVisualRole:"value",_genericMeasureDiscrimCccVisualRole:"multiChart",_multiRole:"columns",_discreteColorRole:"rows",_tooltipHidePercentageOnPercentFields:!0,_configureOptions:function(){this.base(),this.options.valuesVisible&&this._configureValuesMask()},_configureLabels:function(){this.base(),this.options.valuesVisible&&(this.options.valuesLabelStyle="outside"===this.model.labelsOption?"linked":this.model.labelsOption)},_configureLabelsAnchor:function(){},_configureMultiChart:function(){this.base(),this.options.legendSizeMax="50%"},_configureValuesMask:function(){if(this._isGenericMeasureMode){var e=this._mappingFieldInfosByName,t=this._genericMeasureDiscrimCccDimName;this.options.pie={scenes:{category:{sliceLabelMask:function(){var n=this.atoms[t].value;return e[n].sourceIsPercent?"{value}":"{value} ({value.percent})"}}}}}else{var n=this._getMappingFieldInfosOfRole("measures")[0];this.options.valuesMask=n.sourceIsPercent?"{value}":"{value} ({value.percent})"}},_getDiscreteColorMap:function(){var e,t=this._getMemberPalette();if(t){var i=this._getMappingFieldInfosOfRole(this._discreteColorRole,!0)||[],r=i.length;if(r>0){var o=i[r-1];e=n.copyColorMap(null,t[o.name])}}return e}}).implement(e.config)}),define("pentaho/ccc/visual/Donut",["pentaho/module!_","./Pie"],function(e,t){"use strict";return t.extend(e.id).implement(e.config)}),define("pentaho/ccc/visual/HeatGrid",["pentaho/module!_","./CartesianAbstract","cdf/lib/CCC/def"],function(e,t,n){"use strict";return t.extend(e.id,{_cccClass:"HeatGridChart",_roleToCccRole:{columns:"series",rows:"category",color:"color",size:"size"},_multiRole:null,_configureOptions:function(){this.base(),this.options.shape=this.model.shape},_getColorScaleKind:function(){return"continuous"},_prepareLayout:function(){this.base();var e,t,i=this.options;if(i.axisTitleSize=n.get(this._validExtensionOptions,"axisTitleSize",0),i.axisComposite=n.get(this._validExtensionOptions,"axisComposite",i.axisComposite),i.axisComposite){var r=this.model,o=r.size.fields.count+r.color.fields.count,a=r.rows.fields.count,s=r.columns.fields.count,u=this.model.data;u.originalCrossTable&&(u=u.originalCrossTable);var l=Math.max(1,u.getNumberOfRows()-1),c=u.getNumberOfColumns()-a;o>0&&(c/=o);var h=Math.max(0,i.width-i.axisTitleSize),d=Math.max(0,i.height-i.axisTitleSize),p=h/d,f=l/c,_=Math.min(300,70*a),m=Math.min(300,70*s),g=Math.min(300,200*a,.35*d),y=Math.min(300,200*s,.35*h);if(f>p){var v=d-h/f;t=m,e=Math.min(v,g),e=Math.max(e,_)}else if(f<p){var b=h-d*f;e=_,t=Math.min(b,y),t=Math.max(t,m)}}else e=t=null;i.xAxisSize=e,i.yAxisSize=t},_createChart:function(e){var t=this.base(e),n=this._getVisualElementsCountMax();if(n>0){var i=this;t.override("_onWillCreatePlotPanelScene",function(e,t,r,o){var a=r.length,s=o.length,u=a*s;i._validateVisualElementsCount(u,n)})}return t},_getBaseAxisTitle:function(){var e=this._getRolesMappedToCccRole("category");return e&&e.length>0?this._getDiscreteRolesTitle(e):""},_getOrthoAxisTitle:function(){var e=this._getRolesMappedToCccRole("series");return e&&e.length>0?this._getDiscreteRolesTitle(e):""}}).implement(e.config)}),define("pentaho/ccc/visual/Line",["pentaho/module!_","./PointAbstract","./_trends"],function(e,t){"use strict";return t.extend(e.id,{_cccClass:"LineChart",_supportsTrends:!0,_configureOptions:function(){this.base();var e=this.options,t=this.model.shape;t&&"none"===t?e.dotsVisible=!1:(e.dotsVisible=!0,e.dot_shape=t)}}).implement(e.config)}),define("pentaho/ccc/visual/Scatter",["pentaho/module!_","./MetricPointAbstract"],function(e,t){"use strict";return t.extend(e.id).implement(e.config)}),define("pentaho/ccc/visual/Sunburst",["pentaho/module!_","./Abstract","cdf/lib/CCC/protovis","cdf/lib/CCC/def","./_util","pentaho/i18n!./i18n/view"],function(e,t,n,i,r,o){"use strict";return t.extend(e.id,{_cccClass:"SunburstChart",_roleToCccRole:{multi:"multiChart",rows:"category",size:"size"},_discreteColorRole:"rows",_formatSize:function(e,t){return e.label},_configureOptions:function(){this.base();var e=this.model,t=e.sliceOrder;t&&(this.options.sliceOrder=t);var n=e.emptySlicesHidden;this._hideNullMembers=n,n&&(this.options.slice_visible=function(e){return!r.isNullMember(e.vars.category.value)}),this.options.rootCategoryLabel=o.get("sunburst.rootCategoryLabel"),this._configureDisplayUnits()},_configureLabels:function(){var e=this.model,t=this.options,r=!!i.get(this._validExtensionOptions,"valuesVisible",t.valuesVisible);if(t.valuesVisible=r,r){t.valuesFont=this._labelFont;var o=e.labelColor;if(null!=o&&(t.label_textStyle=o),"none"!==e.labelsOption&&this.model.size.hasFields){t.label_textBaseline="bottom",t.label_textMargin=2,t.label_visible=function(e){var t,i=this.pvMark,r=e.innerRadius,o=e.outerRadius,a=i.textMargin(),s=e.angle,u=n.Text.measure(e.vars.size.label,i.font());if(s<Math.PI){var l=.85*u.height,c=2*(l+3*a/2);r=Math.max(r,c/(2*Math.tan(s/2)))}return!((t=o-a-r)<=0||u.width>t-a)&&null};var a=this;t.label_add=function(){return(new n.Label).visible(function(e){return this.proto.visible()}).text(function(e){if(!this.proto.text())return"";var t=a._getMappingFieldInfosOfRole("size")[0].name;return a._formatSize(e.vars.size,e.firstAtoms[t].dimension)}).textBaseline("top")}}}},_configureDisplayUnits:function(){var e=this.model.$type.get("displayUnits").valueType,t=this.model.displayUnits,n=e.scaleFactorOf(t);if(n>1){var i=this.options.dimensions;(i.size||(i.size={})).converter=function(e){return null==e||isNaN(e)?e:e*n},this._formatSize=function(e,t){var i=e.value;return null==i?"":t.format(i/n)}}else delete this._formatSize},_getDiscreteColorMap:function(){var e={},t=this._getMemberPalette();if(t){var n=this._getMappingFieldInfosOfRole(this._discreteColorRole,!0);n&&n.forEach(function(n){var i=t[n.name];i&&r.copyColorMap(e,i)},this)}return e},_createDiscreteColorMapScaleFactory:function(e,t){function n(){function n(n){if(n){var i=n.split("~"),r=i.length-1,o=i[r];return e(o)||(r?void 0:t(o))}}return n.available=function(t){if(t){var n=t.split("~"),i=n.length-1,r=n[i];return!i||!!e(r)}return!1},n}return function(){return i.copy(n(),t)}}}).implement(e.config)}),define("pentaho/ccc/visual/Treemap",["pentaho/module!_","./Abstract"],function(e,t){"use strict";return t.extend(e.id,{_cccClass:"TreemapChart"}).implement(e.config)}),define("pentaho/ccc/visual/Waterfall",["pentaho/module!_","./BarAbstract"],function(e,t){return t.extend(e.id,{_cccClass:"WaterfallChart"}).implement(e.config)}),define("pentaho/ccc/visual/all",["./Abstract","./Area","./AreaAbstract","./AreaStacked","./Bar","./BarAbstract","./BarHorizontal","./BarLine","./BarNormalized","./BarNormalizedAbstract","./BarNormalizedHorizontal","./BarStacked","./BarStackedHorizontal","./Boxplot","./Bubble","./CartesianAbstract","./CategoricalContinuousAbstract","./Donut","./HeatGrid","./Line","./MetricPointAbstract","./Pie","./PointAbstract","./Scatter","./Sunburst","./Treemap","./Waterfall"],function(){"use strict"}),define("pentaho/platformBundle",["./platformCore","pentaho/type/loader","pentaho/data/Table","pentaho/data/TableView","pentaho/data/filter/standard","pentaho/visual/Model","pentaho/visual/impl/View","pentaho/visual/ModelAdapter","pentaho/visual/action/WellKnownErrorNames","pentaho/visual/color/util","pentaho/visual/color/palettes/all","pentaho/visual/models/all","pentaho/visual/role/adaptation/allStrategies","pentaho/visual/role/util","pentaho/visual/scene/Base","pentaho/visual/util","pentaho/visual/samples/calc/Model","pentaho/ccc/visual/all"],function(){"use strict"});