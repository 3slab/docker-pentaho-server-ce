define(["dojo/_base/lang","./common"],function(r,i){function o(r,i){r=r.toLowerCase();for(var o=i.length-1;o>=0;--o)if(r===i[o])return!0;return!1}var e=r.getObject("dojox.charting.scaler.linear",!0),n=i.getNumericLabel,a=function(i,n,a,t,m,c,u){a=r.delegate(a),t||("major"==a.fixUpper&&(a.fixUpper="minor"),"major"==a.fixLower&&(a.fixLower="minor")),m||("minor"==a.fixUpper&&(a.fixUpper="micro"),"minor"==a.fixLower&&(a.fixLower="micro")),c||("micro"==a.fixUpper&&(a.fixUpper="none"),"micro"==a.fixLower&&(a.fixLower="none"));var f=o(a.fixLower,["major"])?Math.floor(a.min/t)*t:o(a.fixLower,["minor"])?Math.floor(a.min/m)*m:o(a.fixLower,["micro"])?Math.floor(a.min/c)*c:a.min,l=o(a.fixUpper,["major"])?Math.ceil(a.max/t)*t:o(a.fixUpper,["minor"])?Math.ceil(a.max/m)*m:o(a.fixUpper,["micro"])?Math.ceil(a.max/c)*c:a.max;a.useMin&&(i=f),a.useMax&&(n=l);var s=!t||a.useMin&&o(a.fixLower,["major"])?i:Math.ceil(i/t)*t,p=!m||a.useMin&&o(a.fixLower,["major","minor"])?i:Math.ceil(i/m)*m,x=!c||a.useMin&&o(a.fixLower,["major","minor","micro"])?i:Math.ceil(i/c)*c,M=t?(a.useMax&&o(a.fixUpper,["major"])?Math.round((n-s)/t):Math.floor((n-s)/t))+1:0,k=m?(a.useMax&&o(a.fixUpper,["major","minor"])?Math.round((n-p)/m):Math.floor((n-p)/m))+1:0,h=c?(a.useMax&&o(a.fixUpper,["major","minor","micro"])?Math.round((n-x)/c):Math.floor((n-x)/c))+1:0,b=m?Math.round(t/m):0,d=c?Math.round(m/c):0,j=t?Math.floor(Math.log(t)/Math.LN10):0,L=m?Math.floor(Math.log(m)/Math.LN10):0,w=u/(n-i);return isFinite(w)||(w=1),{bounds:{lower:f,upper:l,from:i,to:n,scale:w,span:u},major:{tick:t,start:s,count:M,prec:j},minor:{tick:m,start:p,count:k,prec:L},micro:{tick:c,start:x,count:h,prec:0},minorPerMajor:b,microPerMinor:d,scaler:e}};return r.mixin(e,{buildScaler:function(r,i,o,e,n,t){var m={fixUpper:"none",fixLower:"none",natural:!1};if(e&&("fixUpper"in e&&(m.fixUpper=String(e.fixUpper)),"fixLower"in e&&(m.fixLower=String(e.fixLower)),"natural"in e&&(m.natural=Boolean(e.natural))),t=!t||t<3?3:t,"min"in e&&(r=e.min),"max"in e&&(i=e.max),e.includeZero&&(r>0&&(r=0),i<0&&(i=0)),m.min=r,m.useMin=!0,m.max=i,m.useMax=!0,"from"in e&&(r=e.from,m.useMin=!1),"to"in e&&(i=e.to,m.useMax=!1),i<=r)return a(r,i,m,0,0,0,o);n||(n=i-r);var c,u=Math.floor(Math.log(n)/Math.LN10),f=e&&"majorTickStep"in e?e.majorTickStep:Math.pow(10,u),l=0,s=0;if(e&&"minorTickStep"in e)l=e.minorTickStep;else do{if(l=f/10,(!m.natural||l>.9)&&(c=a(r,i,m,f,l,0,o),c.bounds.scale*c.minor.tick>t))break;if(l=f/5,(!m.natural||l>.9)&&(c=a(r,i,m,f,l,0,o),c.bounds.scale*c.minor.tick>t))break;if(l=f/2,(!m.natural||l>.9)&&(c=a(r,i,m,f,l,0,o),c.bounds.scale*c.minor.tick>t))break;return a(r,i,m,f,0,0,o)}while(!1);if(e&&"microTickStep"in e)s=e.microTickStep,c=a(r,i,m,f,l,s,o);else do{if(s=l/10,(!m.natural||s>.9)&&(c=a(r,i,m,f,l,s,o),c.bounds.scale*c.micro.tick>3))break;if(s=l/5,(!m.natural||s>.9)&&(c=a(r,i,m,f,l,s,o),c.bounds.scale*c.micro.tick>3))break;if(s=l/2,(!m.natural||s>.9)&&(c=a(r,i,m,f,l,s,o),c.bounds.scale*c.micro.tick>3))break;s=0}while(!1);return s?c:a(r,i,m,f,l,0,o)},buildTicks:function(r,i){var o,e,a,t=r.major.start,m=r.minor.start,c=r.micro.start;if(i.microTicks&&r.micro.tick)o=r.micro.tick,e=c;else if(i.minorTicks&&r.minor.tick)o=r.minor.tick,e=m;else{if(!r.major.tick)return null;o=r.major.tick,e=t}var u=1/r.bounds.scale;if(r.bounds.to<=r.bounds.from||isNaN(u)||!isFinite(u)||o<=0||isNaN(o)||!isFinite(o))return null;for(var f=[],l=[],s=[];e<=r.bounds.to+u;)Math.abs(t-e)<o/2?(a={value:t},i.majorLabels&&(a.label=n(t,r.major.prec,i)),f.push(a),t+=r.major.tick,m+=r.minor.tick,c+=r.micro.tick):Math.abs(m-e)<o/2?(i.minorTicks&&(a={value:m},i.minorLabels&&r.minMinorStep<=r.minor.tick*r.bounds.scale&&(a.label=n(m,r.minor.prec,i)),l.push(a)),m+=r.minor.tick,c+=r.micro.tick):(i.microTicks&&s.push({value:c}),c+=r.micro.tick),e+=o;return{major:f,minor:l,micro:s}},getTransformerFromModel:function(r){var i=r.bounds.from,o=r.bounds.scale;return function(r){return(r-i)*o}},getTransformerFromPlot:function(r){var i=r.bounds.from,o=r.bounds.scale;return function(r){return r/o+i}}})});