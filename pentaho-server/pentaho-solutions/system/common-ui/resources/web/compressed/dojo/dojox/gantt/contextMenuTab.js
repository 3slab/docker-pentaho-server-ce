define(["./GanttTaskControl","dijit/Menu","dijit/Dialog","dijit/form/NumberSpinner","dijit/form/Button","dijit/form/CheckBox","dijit/form/DateTextBox","dijit/form/TimeTextBox","dijit/form/TextBox","dijit/form/Form","dijit/registry","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/html","dojo/date/locale","dojo/request","dojo/dom","dojo/dom-class","dojo/domReady!"],function(t,e,a,i,r,o,s,n,h,l,c,u,d,b,m,x,j,g,I){return u("dojox.gantt.contextMenuTab",[],{constructor:function(t,e,a,i,r,o){this.id=t,this.arrItems=[],this.TabItemContainer=null,this.Description=e,this.tabMenu=r,this.type=a,this.object=null,this.showObjectInfo=i,this.withDefaultValue=o},preValueValidation:function(t){for(var e=0;e<t.length;e++){var a=t[e];if(a.required&&!a.control.textbox.value)return!1}return!0},encodeDate:function(t){return t.getFullYear()+"."+(t.getMonth()+1)+"."+t.getDate()},decodeDate:function(t){var e=t.split(".");return e.length<3?"":new Date(e[0],parseInt(e[1])-1,e[2])},renameTaskAction:function(){var t=this.arrItems[0].control.textbox.value;b.trim(t).length<=0||this.preValueValidation(this.arrItems)&&(this.object.setName(t),this.hide())},deleteAction:function(){this.preValueValidation(this.arrItems)&&(this.object.project.deleteTask(this.object.taskItem.id),this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct())},durationUpdateAction:function(){var t=this.arrItems[0].control.textbox.value;if(this.preValueValidation(this.arrItems)){if(!this.object.setDuration(t))return void alert("Duration out of Range");this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.refresh()}},cpUpdateAction:function(){var t=this.arrItems[0].control.textbox.value;this.preValueValidation(this.arrItems)&&(this.object.setPercentCompleted(t)?this.hide():alert("Complete Percentage out of Range"))},ownerUpdateAction:function(){var t=this.arrItems[0].control.textbox.value;if(this.preValueValidation(this.arrItems)){if(!this.object.setTaskOwner(t))return void alert("Task owner not Valid");this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()}},ptUpdateAction:function(){var t=this.arrItems[0].control.textbox.value;this.preValueValidation(this.arrItems)&&(this.object.setPreviousTask(t)?this.hide():alert("Please verify the Previous Task ("+t+")  and adjust its Time Range"))},renameProjectAction:function(){var t=this.arrItems[0].control.textbox.value;b.trim(t).length<=0||this.preValueValidation(this.arrItems)&&(this.object.setName(t),this.hide())},deleteProjectAction:function(){this.preValueValidation(this.arrItems)&&(this.object.ganttChart.deleteProject(this.object.project.id),this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct())},cpProjectAction:function(){var t=this.arrItems[0].control.textbox.value;this.preValueValidation(this.arrItems)&&(this.object.setPercentCompleted(t)?this.hide():alert("Percentage not Acceptable"))},addTaskAction:function(){if(this.preValueValidation(this.arrItems)){var t=this.arrItems[0].control.textbox.value,e=this.arrItems[1].control.textbox.value,a=this.decodeDate(this.arrItems[2].control.textbox.value),i=this.arrItems[3].control.textbox.value,r=this.arrItems[4].control.textbox.value,o=this.arrItems[5].control.textbox.value,s=this.arrItems[6].control.textbox.value,n=this.arrItems[7].control.textbox.value;if(!(b.trim(t).length<=0)){if(!this.object.insertTask(t,e,a,i,r,n,o,s))return void alert("Please adjust your Customization");this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()}}},addSuccessorTaskAction:function(){if(this.preValueValidation(this.arrItems)){var t=this.object.project,e=this.arrItems[0].control.textbox.value,a=this.arrItems[1].control.textbox.value,i=this.decodeDate(this.arrItems[2].control.textbox.value),r=this.arrItems[3].control.textbox.value,o=this.arrItems[4].control.textbox.value,s=this.arrItems[5].control.textbox.value;if(!(b.trim(e).length<=0)){var n=this.object.parentTask?this.object.parentTask.taskItem.id:"",h=this.object.taskItem.id;if(!t.insertTask(e,a,i,r,o,h,s,n))return void alert("Please adjust your Customization");this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()}}},addChildTaskAction:function(){if(this.preValueValidation(this.arrItems)){var t=this.object.project,e=this.arrItems[0].control.textbox.value,a=this.arrItems[1].control.textbox.value,i=this.decodeDate(this.arrItems[2].control.textbox.value),r=this.arrItems[3].control.textbox.value,o=this.arrItems[4].control.textbox.value,s=this.arrItems[5].control.textbox.value,n=this.object.taskItem.id;if(!(b.trim(e).length<=0)){if(!t.insertTask(e,a,i,r,o,"",s,n))return void alert("Please adjust your Customization");this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()}}},addProjectAction:function(){if(this.preValueValidation(this.arrItems)){var t=this.arrItems[0].control.textbox.value,e=this.arrItems[1].control.textbox.value,a=this.decodeDate(this.arrItems[2].control.textbox.value);if(!(b.trim(t).length<=0||b.trim(e).length<=0)){if(!this.tabMenu.ganttChart.insertProject(t,e,a))return void alert("Please adjust your Customization");this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()}}},addAction:function(t){this.actionFunc=this[t]},addItem:function(t,e,a,r){var o;o="startTime"==a||"startDate"==a?new s({type:"text",constraints:{datePattern:"yyyy.M.d",strict:!0}}):"percentage"==a?new i({constraints:{max:100,min:0}}):"duration"==a?new i({constraints:{min:0}}):new h,this.arrItems.push({id:t,name:e,control:o,tab:this,key:a,required:r})},show:function(){this.tabMenu.tabPanelDlg=this.tabMenu.tabPanelDlg||c.byId(this.tabMenu.tabPanelDlgId)||new a({title:"Settings"});try{this.tabMenu.tabPanelDlg.show()}catch(t){return void console.log("dialog show exception: "+t.message)}this.tabMenu.tabPanelDlg.titleNode.innerHTML=this.Description;var e,i,r=this.tabMenu.paneContentArea.firstChild.rows[1].cells[0].firstChild,o=null;this.showObjectInfo&&this.object&&(this.object.constructor==t?(this.insertData(r,"Id",this.object.taskItem.id),this.insertData(r,"Name",this.object.taskItem.name),this.insertData(r,"Start Time",this.encodeDate(this.object.taskItem.startTime)),this.insertData(r,"Duration (hours)",this.object.taskItem.duration+" hours"),this.insertData(r,"Percent Complete (%)",this.object.taskItem.percentage+"%"),this.insertData(r,"Task Assignee",this.object.taskItem.taskOwner),this.insertData(r,"Previous Task Id",this.object.taskItem.previousTaskId)):(this.insertData(r,"Id",this.object.project.id),this.insertData(r,"Name",this.object.project.name),this.insertData(r,"Start date",this.encodeDate(this.object.project.startDate)))),o=r.insertRow(r.rows.length),e=o.insertCell(o.cells.length),e.colSpan=2,e.innerHTML="<hr/>",o=r.insertRow(r.rows.length),e=o.insertCell(o.cells.length),e.colSpan=2,I.add(e,"ganttMenuDialogInputCellHeader"),e.innerHTML="Customization: "+this.Description,d.forEach(this.arrItems,function(a){o=r.insertRow(r.rows.length),e=o.insertCell(o.cells.length),I.add(e,"ganttMenuDialogInputCell"),i=o.insertCell(o.cells.length),I.add(i,"ganttMenuDialogInputCellValue"),e.innerHTML=a.name,i.appendChild(a.control.domNode),this.withDefaultValue&&this.object?this.object.constructor==t?"startTime"==a.key?a.control.textbox.value=this.encodeDate(this.object.taskItem.startTime):a.control.textbox.value=a.key?this.object.taskItem[a.key]:"":"startDate"==a.key?a.control.textbox.value=this.encodeDate(this.object.project.startDate):a.control.textbox.value=a.key?this.object.project[a.key]||this.object[a.key]||"":"":a.control.textbox.placeholder=a.required?"---required---":"---optional---"},this),this.tabMenu.ok.onClick=b.hitch(this,this.actionFunc),this.tabMenu.cancel.onClick=b.hitch(this,this.hide)},hide:function(){try{this.tabMenu.tabPanelDlg.hide()}catch(t){console.log("dialog show exception: "+t.message),this.tabMenu.tabPanelDlg.destroy()}var t=this.tabMenu.paneContentArea.firstChild.rows[1].cells[0];t.firstChild.parentNode.removeChild(t.firstChild),t.innerHTML="<table></table>",I.add(t.firstChild,"ganttDialogContentCell")},insertData:function(t,e,a){var i,r=t.insertRow(t.rows.length),o=r.insertCell(r.cells.length);I.add(o,"ganttMenuDialogDescCell"),o.innerHTML=e,i=r.insertCell(r.cells.length),I.add(i,"ganttMenuDialogDescCellValue"),i.innerHTML=a}})});