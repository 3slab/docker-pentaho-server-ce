dojo.provide("dojox.lang.aspect"),function(){var e,n=dojo,r=dojox.lang.aspect,t=Array.prototype,i=[],a=function(){this.next_before=this.prev_before=this.next_around=this.prev_around=this.next_afterReturning=this.prev_afterReturning=this.next_afterThrowing=this.prev_afterThrowing=this,this.counter=0};n.extend(a,{add:function(e){var r=n.isFunction(e),t={advice:e,dynamic:r};return this._add(t,"before","",r,e),this._add(t,"around","",r,e),this._add(t,"after","Returning",r,e),this._add(t,"after","Throwing",r,e),++this.counter,t},_add:function(e,n,r,t,i){var a=n+r;if(t||i[n]||r&&i[a]){var o="next_"+a,d="prev_"+a;(e[d]=this[d])[o]=e,(e[o]=this)[d]=e}},remove:function(e){this._remove(e,"before"),this._remove(e,"around"),this._remove(e,"afterReturning"),this._remove(e,"afterThrowing"),--this.counter},_remove:function(e,n){var r="next_"+n,t="prev_"+n;e[r]&&(e[r][t]=e[t],e[t][r]=e[r])},isEmpty:function(){return!this.counter}});var o=function(){return function(){var n,a,o,d,s=arguments.callee,v=s.advices;e&&i.push(e),e={instance:this,joinPoint:s,depth:i.length,around:v.prev_around,dynAdvices:[],dynIndex:0};try{for(a=v.prev_before;a!=v;a=a.prev_before)a.dynamic?(e.dynAdvices.push(o=new a.advice(e)),(d=o.before)&&d.apply(o,arguments)):(d=a.advice,d.before.apply(d,arguments));try{n=(v.prev_around==v?s.target:r.proceed).apply(this,arguments)}catch(n){for(e.dynIndex=e.dynAdvices.length,a=v.next_afterThrowing;a!=v;a=a.next_afterThrowing)o=a.dynamic?e.dynAdvices[--e.dynIndex]:a.advice,(d=o.afterThrowing)&&d.call(o,n),(d=o.after)&&d.call(o);throw n}for(e.dynIndex=e.dynAdvices.length,a=v.next_afterReturning;a!=v;a=a.next_afterReturning)o=a.dynamic?e.dynAdvices[--e.dynIndex]:a.advice,(d=o.afterReturning)&&d.call(o,n),(d=o.after)&&d.call(o);var c=s._listeners;for(a in c)a in t||c[a].apply(this,arguments)}finally{for(a=0;a<e.dynAdvices.length;++a)o=e.dynAdvices[a],o.destroy&&o.destroy();e=i.length?i.pop():null}return n}};r.advise=function(e,t,i){"object"!=typeof e&&(e=e.prototype);var a=[];t instanceof Array||(t=[t]);for(var o=0;o<t.length;++o){var d=t[o];if(d instanceof RegExp)for(var s in e)n.isFunction(e[s])&&d.test(s)&&a.push(s);else n.isFunction(e[d])&&a.push(d)}return n.isArray(i)||(i=[i]),r.adviseRaw(e,a,i)},r.adviseRaw=function(e,n,r){if(!n.length||!r.length)return null;for(var t={},i=r.length,d=n.length-1;d>=0;--d){var s=n[d],v=e[s],c=new Array(i),f=v.advices;if(!f){var u=e[s]=o();u.target=v.target||v,u.targetName=s,u._listeners=v._listeners||[],u.advices=new a,f=u.advices}for(var h=0;h<i;++h)c[h]=f.add(r[h]);t[s]=c}return[e,t]},r.unadvise=function(e){if(e){var r=e[0],i=e[1];for(var a in i){for(var o=r[a],d=o.advices,s=i[a],v=s.length-1;v>=0;--v)d.remove(s[v]);if(d.isEmpty()){var c=!0,f=o._listeners;if(f.length)for(v in f)if(!(v in t)){c=!1;break}if(c)r[a]=o.target;else{var u=r[a]=n._listener.getDispatcher();u.target=o.target,u._listeners=f}}}}},r.getContext=function(){return e},r.getContextStack=function(){return i},r.proceed=function(){for(var n=e.joinPoint,r=n.advices,t=e.around;t!=r;t=e.around){if(e.around=t.prev_around,!t.dynamic)return t.advice.around.apply(t.advice,arguments);var i=e.dynAdvices[e.dynIndex++],a=i.around;if(a)return a.apply(i,arguments)}return n.target.apply(e.instance,arguments)}}();