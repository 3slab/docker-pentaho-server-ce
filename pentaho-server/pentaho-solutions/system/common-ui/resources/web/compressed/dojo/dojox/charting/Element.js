define(["dojo/_base/array","dojo/dom-construct","dojo/_base/declare","dojox/gfx","dojox/gfx/shape"],function(t,e,r,i,a){return r("dojox.charting.Element",null,{chart:null,group:null,htmlElements:null,dirty:!0,constructor:function(t){this.chart=t,this.group=null,this.htmlElements=[],this.dirty=!0,this.trailingSymbol="...",this._events=[]},purgeGroup:function(){if(this.destroyHtmlElements(),this.group){this.getGroup().removeShape();var r=this.getGroup().children;if(a.dispose)for(var i=0;i<r.length;++i)a.dispose(r[i],!0);this.getGroup().rawNode&&e.empty(this.getGroup().rawNode),this.getGroup().clear(),a.dispose&&a.dispose(this.getGroup(),!0),this.getGroup()!=this.group&&(this.group.rawNode&&e.empty(this.group.rawNode),this.group.clear(),a.dispose&&a.dispose(this.group,!0)),this.group=null}return this.dirty=!0,this._events.length&&(t.forEach(this._events,function(t){t.shape.disconnect(t.handle)}),this._events=[]),this},cleanGroup:function(t){if(this.destroyHtmlElements(),t||(t=this.chart.surface),this.group){var r,i=this.getGroup().children;if(a.dispose)for(var s=0;s<i.length;++s)a.dispose(i[s],!0);this.getGroup().rawNode&&(r=this.getGroup().bgNode,e.empty(this.getGroup().rawNode)),this.getGroup().clear(),r&&this.getGroup().rawNode.appendChild(r)}else this.group=t.createGroup();return this.dirty=!0,this},getGroup:function(){return this.group},destroyHtmlElements:function(){this.htmlElements.length&&(t.forEach(this.htmlElements,e.destroy),this.htmlElements=[])},destroy:function(){this.purgeGroup()},getTextWidth:function(t,e){return i._base._getTextBox(t,{font:e}).w||0},getTextWithLimitLength:function(t,e,r,i){if(!t||t.length<=0)return{text:"",truncated:i||!1};if(!r||r<=0)return{text:t,truncated:i||!1};var a=t.substring(0,1)+this.trailingSymbol;if(r<=this.getTextWidth(a,e))return{text:a,truncated:!0};if(this.getTextWidth(t,e)<=r)return{text:t,truncated:i||!1};for(var s=0,h=t.length;s<h;){if(h-s<=2){for(;this.getTextWidth(t.substring(0,s)+this.trailingSymbol,e)>r;)s-=1;return{text:t.substring(0,s)+this.trailingSymbol,truncated:!0}}var n=s+Math.round(.618*(h-s));this.getTextWidth(t.substring(0,n),e)<r?(s=n,h=h):(s=s,h=n)}},getTextWithLimitCharCount:function(t,e,r,i){return!t||t.length<=0?{text:"",truncated:i||!1}:!r||r<=0||t.length<=r?{text:t,truncated:i||!1}:{text:t.substring(0,r)+this.trailingSymbol,truncated:!0}},_plotFill:function(t,e,r){if(!t||!t.type||!t.space)return t;var a,s=t.space;switch(t.type){case"linear":"plot"!==s&&"shapeX"!==s&&"shapeY"!==s||(t=i.makeParameters(i.defaultLinearGradient,t),t.space=s,"plot"!==s&&"shapeX"!==s||(a=e.height-r.t-r.b,t.y1=r.t+a*t.y1/100,t.y2=r.t+a*t.y2/100),"plot"!==s&&"shapeY"!==s||(a=e.width-r.l-r.r,t.x1=r.l+a*t.x1/100,t.x2=r.l+a*t.x2/100));break;case"radial":if("plot"===s){t=i.makeParameters(i.defaultRadialGradient,t),t.space=s;var h=e.width-r.l-r.r,n=e.height-r.t-r.b;t.cx=r.l+h*t.cx/100,t.cy=r.t+n*t.cy/100,t.r=t.r*Math.sqrt(h*h+n*n)/200}break;case"pattern":"plot"!==s&&"shapeX"!==s&&"shapeY"!==s||(t=i.makeParameters(i.defaultPattern,t),t.space=s,"plot"!==s&&"shapeX"!==s||(a=e.height-r.t-r.b,t.y=r.t+a*t.y/100,t.height=a*t.height/100),"plot"!==s&&"shapeY"!==s||(a=e.width-r.l-r.r,t.x=r.l+a*t.x/100,t.width=a*t.width/100))}return t},_shapeFill:function(t,e){if(!t||!t.space)return t;var r,a=t.space;switch(t.type){case"linear":"shape"!==a&&"shapeX"!==a&&"shapeY"!==a||(t=i.makeParameters(i.defaultLinearGradient,t),t.space=a,"shape"!==a&&"shapeX"!==a||(r=e.width,t.x1=e.x+r*t.x1/100,t.x2=e.x+r*t.x2/100),"shape"!==a&&"shapeY"!==a||(r=e.height,t.y1=e.y+r*t.y1/100,t.y2=e.y+r*t.y2/100));break;case"radial":"shape"===a&&(t=i.makeParameters(i.defaultRadialGradient,t),t.space=a,t.cx=e.x+e.width/2,t.cy=e.y+e.height/2,t.r=t.r*e.width/200);break;case"pattern":"shape"!==a&&"shapeX"!==a&&"shapeY"!==a||(t=i.makeParameters(i.defaultPattern,t),t.space=a,"shape"!==a&&"shapeX"!==a||(r=e.width,t.x=e.x+r*t.x/100,t.width=r*t.width/100),"shape"!==a&&"shapeY"!==a||(r=e.height,t.y=e.y+r*t.y/100,t.height=r*t.height/100))}return t},_pseudoRadialFill:function(t,e,r,a,s){if(!t||"radial"!==t.type||"shape"!==t.space)return t;var h=t.space;if(t=i.makeParameters(i.defaultRadialGradient,t),t.space=h,arguments.length<4)return t.cx=e.x,t.cy=e.y,t.r=t.r*r/100,t;var n=arguments.length<5?a:(s+a)/2;return{type:"linear",x1:e.x,y1:e.y,x2:e.x+t.r*r*Math.cos(n)/100,y2:e.y+t.r*r*Math.sin(n)/100,colors:t.colors}}})});