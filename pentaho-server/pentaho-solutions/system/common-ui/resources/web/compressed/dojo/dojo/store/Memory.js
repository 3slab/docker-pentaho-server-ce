define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(t,i,e){return t("dojo.store.Memory",null,{constructor:function(t){for(var i in t)this[i]=t[i];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:e,get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,i){var e=this.data,n=this.index,r=this.idProperty,s=t[r]=i&&"id"in i?i.id:r in t?t[r]:Math.random();if(s in n){if(i&&!1===i.overwrite)throw new Error("Object already exists");e[n[s]]=t}else n[s]=e.push(t)-1;return s},add:function(t,i){return(i=i||{}).overwrite=!1,this.put(t,i)},remove:function(t){var i=this.index,e=this.data;if(t in i)return e.splice(i[t],1),this.setData(e),!0},query:function(t,e){return i(this.queryEngine(t,e)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier,t=this.data=t.items):this.data=t,this.index={};for(var i=0,e=t.length;i<e;i++)this.index[t[i][this.idProperty]]=i}})});