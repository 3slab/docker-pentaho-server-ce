define(["./_base/kernel","require","./_base/config","./aspect","./_base/lang","./topic","./domReady","./sniff"],function(o,t,n,e,i,a,r,s){function h(o,t){var n=o.indexOf(t);return n>=0?o.substring(n+1):""}function l(){return h(location.href,"#")}function c(){a.publish("/dojo/hashchange",l())}function u(){l()!==m&&(m=l(),c())}function d(o){if(g){if(g.isTransitioning())return void setTimeout(i.hitch(null,d,o),p);var t=g.iframe.location.href,n=t.indexOf("?");return void g.iframe.location.replace(t.substring(0,n)+"?"+o)}location.replace("#"+o),!b&&u()}function f(){function e(){m=l(),s=g?m:h(b.href,"?"),u=!1,d=null}var a=document.createElement("iframe"),r=n.dojoBlankHtmlUrl||t.toUrl("./resources/blank.html");n.useXDomain&&!n.dojoBlankHtmlUrl&&console.warn("dojo/hash: When using cross-domain Dojo builds, please save dojo/resources/blank.html to your domain and set djConfig.dojoBlankHtmlUrl to the path on your domain to blank.html"),a.id="dojo-hash-iframe",a.src=r+"?"+l(),a.style.display="none",document.body.appendChild(a),this.iframe=o.global["dojo-hash-iframe"];var s,u,d,f,g,b=this.iframe.location;this.isTransitioning=function(){return u},this.pollLocation=function(){if(!g)try{var o=h(b.href,"?");document.title!=f&&(f=this.iframe.document.title=document.title)}catch(o){g=!0,console.error("dojo/hash: Error adding history entry. Server unreachable.")}var t=l();if(u&&m===t){if(!g&&o!==d)return void setTimeout(i.hitch(this,this.pollLocation),0);e(),c()}else if(m!==t||!g&&s!==o){if(m!==t)return m=t,u=!0,d=t,a.src=r+"?"+d,g=!1,void setTimeout(i.hitch(this,this.pollLocation),0);g||(location.href="#"+b.search.substring(1),e(),c())}else;setTimeout(i.hitch(this,this.pollLocation),p)},e(),setTimeout(i.hitch(this,this.pollLocation),p)}o.hash=function(o,t){return arguments.length?("#"==o.charAt(0)&&(o=o.substring(1)),t?d(o):location.href="#"+o,o):l()};var m,g,b,p=n.hashPollFrequency||100;return r(function(){"onhashchange"in o.global&&(!s("ie")||s("ie")>=8&&"BackCompat"!=document.compatMode)?b=e.after(o.global,"onhashchange",c,!0):document.addEventListener?(m=l(),setInterval(u,p)):document.attachEvent&&(g=new f)}),o.hash});