define(["../..","dojo/_base/lang","dojo/_base/array","dojo/date","dojo/i18n","dojo/regexp","dojo/string","./Date","dojo/i18n!dojo/cldr/nls/islamic"],function(e,a,r,t,o,s,c,n,i){function d(e,a,r,o,s){return s.replace(/([a-z])\1*/gi,function(r){var o,n,i=r.charAt(0),d=r.length,l=["abbr","wide","narrow"];switch(i){case"G":o=a.eraAbbr[0];break;case"y":o=String(e.getFullYear());break;case"M":var m=e.getMonth();if(d<3)o=m+1,n=!0;else{var u=["months","format",l[d-3]].join("-");o=a[u][m]}break;case"d":o=e.getDate(!0),n=!0;break;case"E":var f=e.getDay();if(d<3)o=f+1,n=!0;else{var b=["days","format",l[d-3]].join("-");o=a[b][f]}break;case"a":var g=e.getHours()<12?"am":"pm";o=a["dayPeriods-format-wide-"+g];break;case"h":case"H":case"K":case"k":var h=e.getHours();switch(i){case"h":o=h%12||12;break;case"H":o=h;break;case"K":o=h%12;break;case"k":o=h||24}n=!0;break;case"m":o=e.getMinutes(),n=!0;break;case"s":o=e.getSeconds(),n=!0;break;case"S":o=Math.round(e.getMilliseconds()*Math.pow(10,d-3)),n=!0;break;case"z":if(o=t.getTimezoneName(e.toGregorian()))break;d=4;case"Z":var k=e.toGregorian().getTimezoneOffset(),p=[k<=0?"+":"-",c.pad(Math.floor(Math.abs(k)/60),2),c.pad(Math.abs(k)%60,2)];4==d&&(p.splice(0,0,"GMT"),p.splice(3,0,":")),o=p.join("");break;default:throw new Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+s)}return n&&(o=c.pad(o,d)),o})}function l(e,a,t,o){var s=function(e){return e};a=a||s,t=t||s,o=o||s;var c=e.match(/(''|[^'])+/g),n="'"==e.charAt(0);return r.forEach(c,function(e,r){e?(c[r]=(n?t:a)(e),n=!n):c[r]=""}),o(c.join(""))}function m(e,a,r,t){t=s.escapeString(t);o.normalizeLocale(r.locale);return t.replace(/([a-z])\1*/gi,function(t){var o,s=t.charAt(0),c=t.length,n="";switch(r.strict?(c>1&&(n="0{"+(c-1)+"}"),c>2&&"0{"+(c-2)+"}"):(n="0?","0{0,2}"),s){case"y":o="\\d+";break;case"M":o=c>2?"\\S+ ?\\S+":n+"[1-9]|1[0-2]";break;case"d":o="[12]\\d|"+n+"[1-9]|3[01]";break;case"E":o="\\S+";break;case"h":o=n+"[1-9]|1[0-2]";break;case"k":o=n+"\\d|1[01]";break;case"H":o=n+"\\d|1\\d|2[0-3]";break;case"K":o=n+"[1-9]|1\\d|2[0-4]";break;case"m":case"s":o=n+"\\d|[0-5]\\d";break;case"S":o="\\d{"+c+"}";break;case"a":var i=r.am||a["dayPeriods-format-wide-am"],d=r.pm||a["dayPeriods-format-wide-pm"];r.strict?o=i+"|"+d:(o=i+"|"+d,i!=i.toLowerCase()&&(o+="|"+i.toLowerCase()),d!=d.toLowerCase()&&(o+="|"+d.toLowerCase()));break;default:o=".*"}return e&&e.push(t),"("+o+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var u=a.getObject("date.islamic.locale",!0,e);u.format=function(e,r){r=r||{};var t=o.normalizeLocale(r.locale),s=r.formatLength||"short",c=u._getIslamicBundle(t),n=[],i=a.hitch(this,d,e,c,t,r.fullYear);if("year"==r.selector){return e.getFullYear()}if("time"!=r.selector){var m=r.datePattern||c["dateFormat-"+s];m&&n.push(l(m,i))}if("date"!=r.selector){var f=r.timePattern||c["timeFormat-"+s];f&&n.push(l(f,i))}return n.join(" ")},u.regexp=function(e){return u._parseInfo(e).regexp},u._parseInfo=function(e){e=e||{};var r,t=o.normalizeLocale(e.locale),s=u._getIslamicBundle(t),c=e.formatLength||"short",n=e.datePattern||s["dateFormat-"+c],i=e.timePattern||s["timeFormat-"+c];r="date"==e.selector?n:"time"==e.selector?i:void 0===i?n:n+" "+i;var d=[];return{regexp:l(r,a.hitch(this,m,d,s,e)),tokens:d,bundle:s}},u.parse=function(e,a){e=e.replace(/[\u200E\u200F\u202A\u202E]/g,""),a||(a={});var t=u._parseInfo(a),s=t.tokens,c=t.bundle,i=t.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,""),d=new RegExp("^"+i+"$"),l=d.exec(e);o.normalizeLocale(a.locale);if(!l)return null;var m=[1389,0,1,0,0,0,0],f="",b=0,g=["abbr","wide","narrow"],h=(r.every(l,function(e,t){if(!t)return!0;var o=s[t-1],n=o.length;switch(o.charAt(0)){case"y":m[0]=Number(e);break;case"M":if(n>2){var i=c["months-format-"+g[n-3]].concat();if(a.strict||(e=e.replace(".","").toLowerCase(),i=r.map(i,function(e){return e?e.replace(".","").toLowerCase():e})),-1==(e=r.indexOf(i,e)))return!1;b=n}else e--;m[1]=Number(e);break;case"D":m[1]=0;case"d":m[2]=Number(e);break;case"a":var d=a.am||c["dayPeriods-format-wide-am"],l=a.pm||c["dayPeriods-format-wide-pm"];if(!a.strict){var u=/\./g;e=e.replace(u,"").toLowerCase(),d=d.replace(u,"").toLowerCase(),l=l.replace(u,"").toLowerCase()}if(a.strict&&e!=d&&e!=l)return!1;f=e==l?"p":e==d?"a":"";break;case"K":24==e&&(e=0);case"h":case"H":case"k":m[3]=Number(e);break;case"m":m[4]=Number(e);break;case"s":m[5]=Number(e);break;case"S":m[6]=Number(e)}return!0}),+m[3]);return"p"===f&&h<12?m[3]=h+12:"a"===f&&12==h&&(m[3]=0),new n(m[0],m[1],m[2],m[3],m[4],m[5],m[6])};var f=[];return u.addCustomFormats=function(e,a){f.push({pkg:e,name:a})},u._getIslamicBundle=function(e){var t={};return r.forEach(f,function(r){var s=o.getLocalization(r.pkg,r.name,e);t=a.mixin(t,s)},this),t},u.addCustomFormats("dojo.cldr","islamic"),u.getNames=function(e,a,r,t,o){var s,c=u._getIslamicBundle(t),n=[e,r,a];if("standAlone"==r){s=c[n.join("-")],1==s[0]&&(s=void 0)}return n[1]="format",(s||c[n.join("-")]).concat()},u.weekDays=u.getNames("days","wide","format"),u.months=u.getNames("months","wide","format"),u});