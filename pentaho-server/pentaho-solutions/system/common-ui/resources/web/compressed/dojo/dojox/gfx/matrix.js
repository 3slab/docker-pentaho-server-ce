define(["./_base","dojo/_base/lang"],function(t,n){var x=t.matrix={},y={};return x._degToRad=function(t){return y[t]||(y[t]=Math.PI*t/180)},x._radToDeg=function(t){return t/Math.PI*180},x.Matrix2D=function(t){if(t)if("number"==typeof t)this.xx=this.yy=t;else if(t instanceof Array){if(t.length>0){for(var y=x.normalize(t[0]),e=1;e<t.length;++e){var i=y,r=x.normalize(t[e]);y=new x.Matrix2D,y.xx=i.xx*r.xx+i.xy*r.yx,y.xy=i.xx*r.xy+i.xy*r.yy,y.yx=i.yx*r.xx+i.yy*r.yx,y.yy=i.yx*r.xy+i.yy*r.yy,y.dx=i.xx*r.dx+i.xy*r.dy+i.dx,y.dy=i.yx*r.dx+i.yy*r.dy+i.dy}n.mixin(this,y)}}else n.mixin(this,t)},n.extend(x.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0}),n.mixin(x,{identity:new x.Matrix2D,flipX:new x.Matrix2D({xx:-1}),flipY:new x.Matrix2D({yy:-1}),flipXY:new x.Matrix2D({xx:-1,yy:-1}),translate:function(t,n){return arguments.length>1?new x.Matrix2D({dx:t,dy:n}):new x.Matrix2D({dx:t.x,dy:t.y})},scale:function(t,n){return arguments.length>1?new x.Matrix2D({xx:t,yy:n}):"number"==typeof t?new x.Matrix2D({xx:t,yy:t}):new x.Matrix2D({xx:t.x,yy:t.y})},rotate:function(t){var n=Math.cos(t),y=Math.sin(t);return new x.Matrix2D({xx:n,xy:-y,yx:y,yy:n})},rotateg:function(t){return x.rotate(x._degToRad(t))},skewX:function(t){return new x.Matrix2D({xy:Math.tan(t)})},skewXg:function(t){return x.skewX(x._degToRad(t))},skewY:function(t){return new x.Matrix2D({yx:Math.tan(t)})},skewYg:function(t){return x.skewY(x._degToRad(t))},reflect:function(t,n){1==arguments.length&&(n=t.y,t=t.x);var y=t*t,e=n*n,i=y+e,r=2*t*n/i;return new x.Matrix2D({xx:2*y/i-1,xy:r,yx:r,yy:2*e/i-1})},project:function(t,n){1==arguments.length&&(n=t.y,t=t.x);var y=t*t,e=n*n,i=y+e,r=t*n/i;return new x.Matrix2D({xx:y/i,xy:r,yx:r,yy:e/i})},normalize:function(t){return t instanceof x.Matrix2D?t:new x.Matrix2D(t)},isIdentity:function(t){return 1==t.xx&&0==t.xy&&0==t.yx&&1==t.yy&&0==t.dx&&0==t.dy},clone:function(t){var n=new x.Matrix2D;for(var y in t)"number"==typeof t[y]&&"number"==typeof n[y]&&n[y]!=t[y]&&(n[y]=t[y]);return n},invert:function(t){var n=x.normalize(t),y=n.xx*n.yy-n.xy*n.yx;return n=new x.Matrix2D({xx:n.yy/y,xy:-n.xy/y,yx:-n.yx/y,yy:n.xx/y,dx:(n.xy*n.dy-n.yy*n.dx)/y,dy:(n.yx*n.dx-n.xx*n.dy)/y})},_multiplyPoint:function(t,n,x){return{x:t.xx*n+t.xy*x+t.dx,y:t.yx*n+t.yy*x+t.dy}},multiplyPoint:function(t,n,y){var e=x.normalize(t);return"number"==typeof n&&"number"==typeof y?x._multiplyPoint(e,n,y):x._multiplyPoint(e,n.x,n.y)},multiplyRectangle:function(t,n){var y=x.normalize(t);if(n=n||{x:0,y:0,width:0,height:0},x.isIdentity(y))return{x:n.x,y:n.y,width:n.width,height:n.height};var e=x.multiplyPoint(y,n.x,n.y),i=x.multiplyPoint(y,n.x,n.y+n.height),r=x.multiplyPoint(y,n.x+n.width,n.y),a=x.multiplyPoint(y,n.x+n.width,n.y+n.height),u=Math.min(e.x,i.x,r.x,a.x),o=Math.min(e.y,i.y,r.y,a.y);return{x:u,y:o,width:Math.max(e.x,i.x,r.x,a.x)-u,height:Math.max(e.y,i.y,r.y,a.y)-o}},multiply:function(t){for(var n=x.normalize(t),y=1;y<arguments.length;++y){var e=n,i=x.normalize(arguments[y]);n=new x.Matrix2D,n.xx=e.xx*i.xx+e.xy*i.yx,n.xy=e.xx*i.xy+e.xy*i.yy,n.yx=e.yx*i.xx+e.yy*i.yx,n.yy=e.yx*i.xy+e.yy*i.yy,n.dx=e.xx*i.dx+e.xy*i.dy+e.dx,n.dy=e.yx*i.dx+e.yy*i.dy+e.dy}return n},_sandwich:function(t,n,y){return x.multiply(x.translate(n,y),t,x.translate(-n,-y))},scaleAt:function(t,n,y,e){switch(arguments.length){case 4:return x._sandwich(x.scale(t,n),y,e);case 3:return"number"==typeof y?x._sandwich(x.scale(t),n,y):x._sandwich(x.scale(t,n),y.x,y.y)}return x._sandwich(x.scale(t),n.x,n.y)},rotateAt:function(t,n,y){return arguments.length>2?x._sandwich(x.rotate(t),n,y):x._sandwich(x.rotate(t),n.x,n.y)},rotategAt:function(t,n,y){return arguments.length>2?x._sandwich(x.rotateg(t),n,y):x._sandwich(x.rotateg(t),n.x,n.y)},skewXAt:function(t,n,y){return arguments.length>2?x._sandwich(x.skewX(t),n,y):x._sandwich(x.skewX(t),n.x,n.y)},skewXgAt:function(t,n,y){return arguments.length>2?x._sandwich(x.skewXg(t),n,y):x._sandwich(x.skewXg(t),n.x,n.y)},skewYAt:function(t,n,y){return arguments.length>2?x._sandwich(x.skewY(t),n,y):x._sandwich(x.skewY(t),n.x,n.y)},skewYgAt:function(t,n,y){return arguments.length>2?x._sandwich(x.skewYg(t),n,y):x._sandwich(x.skewYg(t),n.x,n.y)}}),t.Matrix2D=x.Matrix2D,x});