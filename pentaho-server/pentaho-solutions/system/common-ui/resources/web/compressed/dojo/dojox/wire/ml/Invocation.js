dojo.provide("dojox.wire.ml.Invocation"),dojo.require("dojox.wire.ml.Action"),dojo.declare("dojox.wire.ml.Invocation",dojox.wire.ml.Action,{object:"",method:"",topic:"",parameters:"",result:"",error:"",_run:function(){if(this.topic){var o=this._getParameters(arguments);try{dojo.publish(this.topic,o),this.onComplete()}catch(o){this.onError(o)}}else if(this.method){var e=this.object?dojox.wire.ml._getValue(this.object):dojo.global;if(!e)return;var o=this._getParameters(arguments),r=e[this.method];if(!r){if(!(r=e.callMethod))return;o=[this.method,o]}try{var t=!1;if(e.getFeatures){var i=e.getFeatures();if("fetch"==this.method&&i["dojo.data.api.Read"]||"save"==this.method&&i["dojo.data.api.Write"]){var s=o[0];s.onComplete||(s.onComplete=function(){}),this.connect(s,"onComplete","onComplete"),s.onError||(s.onError=function(){}),this.connect(s,"onError","onError"),t=!0}}var a=r.apply(e,o);if(!t)if(a&&a instanceof dojo.Deferred){var n=this;a.addCallbacks(function(o){n.onComplete(o)},function(o){n.onError(o)})}else this.onComplete(a)}catch(o){this.onError(o)}}},onComplete:function(o){this.result&&dojox.wire.ml._setValue(this.result,o),this.error&&dojox.wire.ml._setValue(this.error,"")},onError:function(o){this.error&&(o&&o.message&&(o=o.message),dojox.wire.ml._setValue(this.error,o))},_getParameters:function(o){if(!this.parameters)return o;var e=[],r=this.parameters.split(",");if(1==r.length){var t=dojox.wire.ml._getValue(dojo.trim(r[0]),o);dojo.isArray(t)?e=t:e.push(t)}else for(var i in r)e.push(dojox.wire.ml._getValue(dojo.trim(r[i]),o));return e}});