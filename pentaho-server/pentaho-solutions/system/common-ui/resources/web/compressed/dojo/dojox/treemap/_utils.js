define(["dojo/_base/array"],function(e){var t={group:function(r,n,i){var h={children:[]},o=function(e,t){return e.__treeValue||(e.__treeValue=0),e.__treeValue+=i(t),e};return e.forEach(r,function(r){var i=h;e.forEach(n,function(e,h){var u=e(r),a=t.find(i.children,function(e){return e.__treeName==u});a||i.children.push(a={__treeName:u,__treeID:u+Math.random(),children:[]}),a=o(a,r),h!=n.length-1?i=a:a.children.push(r)}),i=o(i,r)}),h},find:function(e,t){for(var r=e.length,n=0;n<r;++n)if(t.call(null,e[n]))return e[n];return null},solve:function(r,n,i,h,o){var u=t.initElements(r,h),a=u.total,f=u.elements,l=a;if(0==a){if(0==f.length)return{items:r,rects:[],total:0};e.forEach(f,function(e){e.size=e.sizeTmp=100}),a=100*f.length}f.sort(function(e,t){return t.size-e.size}),t._compute(n,i,f,a),f.sort(function(e,t){return e.index-t.index});var c={};return c.elements=f,c.size=l,rects=e.map(f,function(e){return{x:o?n-e.x-e.width:e.x,y:e.y,w:e.width,h:e.height}}),c.rectangles=rects,c},initElements:function(t,r){var n=0;return{elements:e.map(t,function(e,t){var i=null!=r?r(e):0;if(i<0)throw new Error("item size dimension must be positive");return n+=i,{index:t,size:i,sizeTmp:i}}),total:n}},_compute:function(r,n,i,h){var o=r*n/h/100;e.forEach(i,function(e){e.sizeTmp*=o});for(var u,a=0,f=0,l=-1>>>1,c=0,m=0,s=r,d=n,p=s>d;f!=i.length;)if((u=t._trySolution(i,a,f,p,s,d))>l||u<1){for(var v=0,g=0,_=a;_<f;_++)i[_].x=c+v,i[_].y=m+g,p?g+=i[_].height:v+=i[_].width;p?c+=i[a].width:m+=i[a].height,s=r-c,d=n-m,p=s>d,a=f,f=a,l=-1>>>1}else{for(var _=a;_<=f;_++)i[_].width=i[_].widthTmp,i[_].height=i[_].heightTmp;l=u,f++}for(var T=0,w=0,_=a;_<f;_++)i[_].x=c+T,i[_].y=m+w,p?w+=i[_].height:T+=i[_].width},_trySolution:function(e,t,r,n,i,h){for(var o=0,u=0,a=0,f=0,l=t;l<=r;l++)o+=e[l].sizeTmp;n?0==h?a=f=0:(a=o/h*100,f=h):0==i?a=f=0:(f=o/i*100,a=i);for(var l=t;l<=r;l++)n?(e[l].widthTmp=a,e[l].heightTmp=0==o?0:f*e[l].sizeTmp/o):(e[l].widthTmp=0==o?0:a*e[l].sizeTmp/o,e[l].heightTmp=f);return u=Math.max(e[r].heightTmp/e[r].widthTmp,e[r].widthTmp/e[r].heightTmp),void 0==u?1:u}};return t});