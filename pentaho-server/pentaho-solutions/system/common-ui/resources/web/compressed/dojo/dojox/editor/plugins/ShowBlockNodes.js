define(["dojo","dijit","dojox","dijit/_editor/_Plugin","dijit/form/Button","dijit/form/ToggleButton","dojo/_base/connect","dojo/_base/declare","dojo/i18n","dojo/i18n!dojox/editor/plugins/nls/ShowBlockNodes"],function(t,e,o,i){var n=t.declare("dojox.editor.plugins.ShowBlockNodes",i,{useDefaultCommand:!1,iconClassPrefix:"dijitAdditionalEditorIcon",_styled:!1,_initButton:function(){var o=t.i18n.getLocalization("dojox.editor.plugins","ShowBlockNodes");this.button=new e.form.ToggleButton({label:o.showBlockNodes,showLabel:!1,iconClass:this.iconClassPrefix+" "+this.iconClassPrefix+"ShowBlockNodes",tabIndex:"-1",onChange:t.hitch(this,"_showBlocks")}),this.editor.addKeyHandler(t.keys.F9,!0,!0,t.hitch(this,this.toggle))},updateState:function(){this.button.set("disabled",this.get("disabled"))},setEditor:function(t){this.editor=t,this._initButton()},toggle:function(){this.button.set("checked",!this.button.get("checked"))},_showBlocks:function(e){var i=this.editor.document;if(!this._styled)try{this._styled=!0;var n="",s=["div","p","ul","ol","table","h1","h2","h3","h4","h5","h6","pre","dir","center","blockquote","form","fieldset","address","object","pre","hr","ins","noscript","li","map","button","dd","dt"];t.forEach(s,function(t){n+="@media screen {\n\t.editorShowBlocks {TAG} {\n\t\tbackground-image: url({MODURL}/images/blockelems/{TAG}.gif);\n\t\tbackground-repeat: no-repeat;\n\t\tbackground-position: top left;\n\t\tborder-width: 1px;\n\t\tborder-style: dashed;\n\t\tborder-color: #D0D0D0;\n\t\tpadding-top: 15px;\n\t\tpadding-left: 15px;\n\t}\n}\n".replace(/\{TAG\}/gi,t)});var d=t.moduleUrl(o._scopeName,"editor/plugins/resources").toString();if(!d.match(/^https?:\/\//i)&&!d.match(/^file:\/\//i)){var l;if("/"===d.charAt(0)){l=t.doc.location.protocol+"//"+t.doc.location.host}else l=this._calcBaseUrl(t.global.location.href);"/"!==l[l.length-1]&&"/"!==d.charAt(0)&&(l+="/"),d=l+d}if(n=n.replace(/\{MODURL\}/gi,d),t.isIE){i.createStyleSheet("").cssText=n}else{var r=i.createElement("style");r.appendChild(i.createTextNode(n)),i.getElementsByTagName("head")[0].appendChild(r)}}catch(t){console.warn(t)}e?t.addClass(this.editor.editNode,"editorShowBlocks"):t.removeClass(this.editor.editNode,"editorShowBlocks")},_calcBaseUrl:function(t){var e=null;if(null!==t){var o=t.indexOf("?");-1!=o&&(t=t.substring(0,o)),o=t.lastIndexOf("/"),e=o>0&&o<t.length?t.substring(0,o):t}return e}});return t.subscribe(e._scopeName+".Editor.getPlugin",null,function(t){if(!t.plugin){"showblocknodes"===t.args.name.toLowerCase()&&(t.plugin=new n)}}),n});