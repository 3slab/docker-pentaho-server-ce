define(["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/has","./CartesianBase","./_PlotEvents","./common","dojox/lang/functional","dojox/lang/functional/reversed","dojox/lang/utils","dojox/gfx/fx"],function(t,e,r,a,i,s,o,n,h,l,d){var u=h.lambda("item.purgeGroup()");return e("dojox.charting.plot2d.Default",[i,s],{defaultParams:{lines:!0,areas:!1,markers:!1,tension:"",animate:!1,enableCache:!1,interpolate:!1},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",marker:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:""},constructor:function(e,r){this.opt=t.clone(t.mixin(this.opt,this.defaultParams)),l.updateWithObject(this.opt,r),l.updateWithPattern(this.opt,r,this.optionalParams),this.animate=this.opt.animate},createPath:function(t,e,r){var a;return this.opt.enableCache&&t._pathFreePool.length>0?(a=t._pathFreePool.pop(),a.setShape(r),e.add(a)):a=e.createPath(r),this.opt.enableCache&&t._pathUsePool.push(a),a},buildSegments:function(t,e){for(var r=this.series[t],a=e?Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0,i=e?Math.min(r.data.length,Math.ceil(this._hScaler.bounds.to)):r.data.length,s=null,o=[],n=a;n<i;n++)null==r.data[n]||!e&&null==r.data[n].y?this.opt.interpolate&&!e||(s=null):(s||(s=[],o.push({index:n,rseg:s})),s.push(e&&r.data[n].hasOwnProperty("y")?r.data[n].y:r.data[n]));return o},render:function(e,i){if(this.zoom&&!this.isDataDirty())return this.performZoom(e,i);this.resetEvents(),this.dirty=this.isDirty();var s;this.dirty&&(r.forEach(this.series,u),this._eventSeries={},this.cleanGroup(),this.getGroup().setTransform(null),s=this.getGroup(),n.forEachRev(this.series,function(t){t.cleanGroup(s)}));for(var h,l,p=this.chart.theme,c=this.events(),m=this.series.length-1;m>=0;--m){var f=this.series[m];if(this.dirty||f.dirty)if(f.cleanGroup(),this.opt.enableCache&&(f._pathFreePool=(f._pathFreePool?f._pathFreePool:[]).concat(f._pathUsePool?f._pathUsePool:[]),f._pathUsePool=[]),f.data.length){var y,k=p.next(this.opt.areas?"area":"line",[this.opt,f],!0),g=this._hScaler.scaler.getTransformerFromModel(this._hScaler),x=this._vScaler.scaler.getTransformerFromModel(this._vScaler),v=this._eventSeries[f.name]=new Array(f.data.length);s=f.group;for(var b=r.some(f.data,function(t){return"number"==typeof t||t&&!t.hasOwnProperty("x")}),S=this.buildSegments(m,b),P=0;P<S.length;P++){var F=S[P];if(y=b?r.map(F.rseg,function(t,r){return{x:g(r+F.index+1)+i.l,y:e.height-i.b-x(t),data:t}},this):r.map(F.rseg,function(t){return{x:g(t.x)+i.l,y:e.height-i.b-x(t.y),data:t}},this),b&&this.opt.interpolate)for(;P<S.length;)P++,(F=S[P])&&(y=y.concat(r.map(F.rseg,function(t,r){return{x:g(r+F.index+1)+i.l,y:e.height-i.b-x(t),data:t}},this)));var _=this.opt.tension?o.curve(y,this.opt.tension):"";if(this.opt.areas&&y.length>1){var w=this._plotFill(k.series.fill,e,i),j=t.clone(y);if(this.opt.tension){var M="L"+j[j.length-1].x+","+(e.height-i.b)+" L"+j[0].x+","+(e.height-i.b)+" L"+j[0].x+","+j[0].y;f.dyn.fill=s.createPath(_+" "+M).setFill(w).getFill()}else j.push({x:y[y.length-1].x,y:e.height-i.b}),j.push({x:y[0].x,y:e.height-i.b}),j.push(y[0]),f.dyn.fill=s.createPolyline(j).setFill(w).getFill()}(this.opt.lines||this.opt.markers)&&(h=k.series.stroke,k.series.outline&&(l=f.dyn.outline=o.makeStroke(k.series.outline),l.width=2*l.width+h.width)),this.opt.markers&&(f.dyn.marker=k.symbol);var E=null,C=null,G=null;if(h&&k.series.shadow&&y.length>1){var O=k.series.shadow,D=r.map(y,function(t){return{x:t.x+O.dx,y:t.y+O.dy}});this.opt.lines&&(this.opt.tension?f.dyn.shadow=s.createPath(o.curve(D,this.opt.tension)).setStroke(O).getStroke():f.dyn.shadow=s.createPolyline(D).setStroke(O).getStroke()),this.opt.markers&&k.marker.shadow&&(O=k.marker.shadow,G=r.map(D,function(t){return this.createPath(f,s,"M"+t.x+" "+t.y+" "+k.symbol).setStroke(O).setFill(O.color)},this))}if(this.opt.lines&&y.length>1){var L;l&&(this.opt.tension?f.dyn.outline=s.createPath(_).setStroke(l).getStroke():f.dyn.outline=s.createPolyline(y).setStroke(l).getStroke()),this.opt.tension?f.dyn.stroke=(L=s.createPath(_)).setStroke(h).getStroke():f.dyn.stroke=(L=s.createPolyline(y)).setStroke(h).getStroke(),L.setFilter&&k.series.filter&&L.setFilter(k.series.filter)}var T=null;if(this.opt.markers){var U=k;E=new Array(y.length),C=new Array(y.length),l=null,U.marker.outline&&(l=o.makeStroke(U.marker.outline),l.width=2*l.width+(U.marker.stroke?U.marker.stroke.width:0)),r.forEach(y,function(t,e){if(this.opt.styleFunc||"number"!=typeof t.data){var r="number"!=typeof t.data?[t.data]:[];this.opt.styleFunc&&r.push(this.opt.styleFunc(t.data)),U=p.addMixin(k,"marker",r,!0)}else U=p.post(k,"marker");var a="M"+t.x+" "+t.y+" "+U.symbol;l&&(C[e]=this.createPath(f,s,a).setStroke(l)),E[e]=this.createPath(f,s,a).setStroke(U.marker.stroke).setFill(U.marker.fill)},this),f.dyn.markerFill=U.marker.fill,f.dyn.markerStroke=U.marker.stroke,!T&&this.opt.labels&&(T=E[0].getBoundingBox()),c?r.forEach(E,function(t,e){var r={element:"marker",index:e+F.index,run:f,shape:t,outline:C[e]||null,shadow:G&&G[e]||null,cx:y[e].x,cy:y[e].y};b?(r.x=e+F.index+1,r.y=f.data[e+F.index]):(r.x=F.rseg[e].x,r.y=f.data[e+F.index].y),this._connectEvents(r),v[e+F.index]=r},this):delete this._eventSeries[f.name]}if(this.opt.labels){var A=T?T.width:2,B=T?T.height:2;r.forEach(y,function(t,e){if(this.opt.styleFunc||"number"!=typeof t.data){var r="number"!=typeof t.data?[t.data]:[];this.opt.styleFunc&&r.push(this.opt.styleFunc(t.data)),U=p.addMixin(k,"marker",r,!0)}else U=p.post(k,"marker");this.createLabel(s,F.rseg[e],{x:t.x-A/2,y:t.y-B/2,width:A,height:B},U)},this)}}f.dirty=!1}else f.dirty=!1,p.skip();else p.skip(),this._reconnectEvents(f.name)}if(a("dojo-bidi")&&this._checkOrientation(this.group,e,i),this.animate){var W=this.getGroup();d.animateTransform(t.delegate({shape:W,duration:1200,transform:[{name:"translate",start:[0,e.height-i.b],end:[0,0]},{name:"scale",start:[1,0],end:[1,1]},{name:"original"}]},this.animate)).play()}return this.dirty=!1,this}})});