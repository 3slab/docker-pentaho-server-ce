define(["dojo/_base/declare","dojo/_base/kernel","dojo/_base/xhr","./model"],function(e,t,s,r){return e("dojox.atom.io.Connection",null,{constructor:function(e,t){this.sync=e,this.preventCache=t},preventCache:!1,alertsEnabled:!1,getFeed:function(e,t,s,n){this._getXmlDoc(e,"feed",new r.Feed,r._Constants.ATOM_NS,t,s,n)},getService:function(e,t,s,n){this._getXmlDoc(e,"service",new r.Service(e),r._Constants.APP_NS,t,s,n)},getEntry:function(e,t,s,n){this._getXmlDoc(e,"entry",new r.Entry,r._Constants.ATOM_NS,t,s,n)},_getXmlDoc:function(e,r,n,a,l,o,i){i||(i=t.global);var h=this.alertsEnabled,c={url:e,handleAs:"xml",sync:this.sync,preventCache:this.preventCache,load:function(e,t){var s,o=null,c=e;if(c){if(void 0!==c.getElementsByTagNameNS)s=c.getElementsByTagNameNS(a,r),s&&s.length>0?o=s.item(0):c.lastChild&&(o=c.lastChild);else if(void 0!==c.getElementsByTagName)if((s=c.getElementsByTagName(r))&&s.length>0){for(var d=0;d<s.length;d++)if(s[d].namespaceURI==a){o=s[d];break}}else c.lastChild&&(o=c.lastChild);else{if(!c.lastChild)return void l.call(i,null,null,t);o=c.lastChild}if(n.buildFromDom(o),l)l.call(i,n,c,t);else if(h)throw new Error("The callback value does not exist.")}else l.call(i,null,null,t)}};this.user&&null!==this.user&&(c.user=this.user),this.password&&null!==this.password&&(c.password=this.password),c.error=o?function(e,t){o.call(i,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},s.get(c)},updateEntry:function(e,r,n,a,l,o){o||(o=t.global),e.updated=new Date;var i=e.getEditHref();if(!i)throw new Error("A URL has not been specified for editing this entry.");var h=this,c=this.alertsEnabled,d={url:i,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,load:function(t,s){var n=null;if(a){n=s.xhr.getResponseHeader("Location"),n||(n=i);var l=function(e,t,s){if(r)r.call(o,e,n,s);else if(c)throw new Error("The callback value does not exist.")};h.getEntry(n,l)}else if(r)r.call(o,e,s.xhr.getResponseHeader("Location"),s);else if(c)throw new Error("The callback value does not exist.");return t}};if(this.user&&null!==this.user&&(d.user=this.user),this.password&&null!==this.password&&(d.password=this.password),d.error=n?function(e,t){n.call(o,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},l)d.postData=e.toString(!0),d.headers={"X-Method-Override":"PUT"},s.post(d);else{d.putData=e.toString(!0);s.put(d)}},addEntry:function(e,r,n,a,l,o){o||(o=t.global),e.published=new Date,e.updated=new Date;var i=e.feedUrl,h=this.alertsEnabled;if(!r&&i&&(r=i),r){var c=this,d={url:r,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,postData:e.toString(!0),load:function(t,s){var a=s.xhr.getResponseHeader("Location");if(a||(a=r),s.retrieveEntry){var l=function(e,t,s){if(n)n.call(o,e,a,s);else if(h)throw new Error("The callback value does not exist.")};c.getEntry(a,l)}else if(n)n.call(o,e,a,s);else if(h)throw new Error("The callback value does not exist.");return t}};this.user&&null!==this.user&&(d.user=this.user),this.password&&null!==this.password&&(d.password=this.password),d.error=a?function(e,t){a.call(o,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},s.post(d)}else if(h)throw new Error("The request cannot be processed because the URL parameter is missing.")},deleteEntry:function(e,r,n,a,l){l||(l=t.global);var o=null;if(!(o="string"==typeof e?e:e.getEditHref()))throw r.call(l,!1,null),new Error("The request cannot be processed because the URL parameter is missing.");var i={url:o,handleAs:"text",sync:this.sync,preventCache:this.preventCache,load:function(e,t){return r.call(l,t),e}};this.user&&null!==this.user&&(i.user=this.user),this.password&&null!==this.password&&(i.password=this.password),i.error=n?function(e,t){n.call(l,e,t)}:function(){throw new Error("The URL requested cannot be accessed")},a?(i.headers={"X-Method-Override":"DELETE"},dhxr.post(i)):s.del(i)}})});