define(["build/argv","build/fs","build/buildControl","build/messages","build/process","dojox/json/ref"],function(e,l,o,n,r,s){var a=function(e,l,n,r){for(var s in n)if(0!=s.indexOf("_")){var i=n[s];if(i.controller&&"none"!=i.controller){var t=i.controller.replace(/(\.js)$/,"");!o.layers[t]&&o.multipleAppConfigLayers&&(o.layers[t]={include:[],exclude:["dojo/dojo",l]},e=o.layers[t].include),e.push(t)}i.template&&(r.text||(r.text=!0,o.layers[l].include.push("dojo/text")),e.push(i.template)),i.nls&&(r.nls||(r.nls=!0,o.layers[l].include.push("dojo/i18n")),e.push(i.nls)),i.dependencies&&Array.prototype.splice.apply(e,[e.length,0].concat(i.dependencies)),i.views&&a(e,l,i.views,r)}};return function(){var i;try{i=s.fromJson(l.readFileSync(o.getSrcModuleInfo(e.args.appConfigFile,null,!1).url))}catch(e){console.log(e)}if(i){var t=[],p={};i.loaderConfig&&require(i.loaderConfig);var c;if(e.args.appConfigLayer)c=e.args.appConfigLayer,o.layers[c]||(o.layers[c]={include:[],exclude:["dojo/dojo"]});else for(var d in o.layers){c=d;break}i.dependencies&&(t=t.concat(i.dependencies)),i.controllers&&(t=t.concat(i.controllers)),i.modules&&(t=t.concat(i.modules)),i.transit?t.push(i.transit):t.push("dojox/css3/transit"),i.template&&(p.text=!0,o.layers[c].include.push("dojo/text"),t.push(i.template)),i.controller&&"none"!=i.controller&&t.push(i.controller.replace(/(\.js)$/,"")),i.nls&&(p.nls=!0,o.layers[c].include.push("dojo/i18n"),t.push(i.nls)),i.view?t.push(i.view):t.push("dojox/app/View"),i.views&&a(t,c,i.views,p),Array.prototype.splice.apply(o.layers[c].include,[o.layers[c].length,0].concat(t))}else n.log("pacify",e.args.appConfigFile+" is not a valid dojox/app JSON config file"),r.exit(-1)}});