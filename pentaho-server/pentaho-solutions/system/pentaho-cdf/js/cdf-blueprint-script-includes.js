
if(!Object.create){Object.create=(function(){var Klass=function(){},proto=Klass.prototype;function create(baseProto){Klass.prototype=baseProto||{};var instance=new Klass();Klass.prototype=proto;return instance;}
return create;}());}
Function.prototype.method=Function.prototype.method||function(name,func){this.prototype[name]=func;return this;};if(!String.prototype.endsWith){String.prototype.endsWith=function(str){return(this.match(str+"$")==str);};}
if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+/,'').replace(/\s+$/,'');};}
if(!Object.keys){Object.keys=(function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length
return function(obj){if(typeof obj!=='object'&&typeof obj!=='function'||obj===null)throw new TypeError('Object.keys called on non-object')
var result=[]
for(var prop in obj){if(hasOwnProperty.call(obj,prop))result.push(prop)}
if(hasDontEnumBug){for(var i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i]))result.push(dontEnums[i])}}
return result}})()};if(!Array.prototype.map){Array.prototype.map=function(callback,thisArg){var T,A,k;if(this==null){throw new TypeError(" this is null or not defined");}
var O=Object(this);var len=O.length>>>0;if({}.toString.call(callback)!="[object Function]"){throw new TypeError(callback+" is not a function");}
if(thisArg){T=thisArg;}
A=new Array(len);k=0;while(k<len){var kValue,mappedValue;if(k in O){kValue=O[k];mappedValue=callback.call(T,kValue,k,O);A[k]=mappedValue;}
k++;}
return A;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
if(!Array.prototype.lastIndexOf)
{Array.prototype.lastIndexOf=function(searchElement)
{"use strict";if(this==null)
throw new TypeError();var t=Object(this);var len=t.length>>>0;if(len===0)
return-1;var n=len;if(arguments.length>1)
{n=Number(arguments[1]);if(n!=n)
n=0;else if(n!=0&&n!=(1/0)&&n!=-(1/0))
n=(n>0||-1)*Math.floor(Math.abs(n));}
var k=n>=0?Math.min(n,len-1):len-Math.abs(n);for(;k>=0;k--)
{if(k in t&&t[k]===searchElement)
return k;}
return-1;};}
if(!Array.prototype.reduce){Array.prototype.reduce=function reduce(accumulator){var i,l=this.length,curr;if(typeof accumulator!=="function")
throw new TypeError("First argument is not callable");if((l==0||l===null)&&(arguments.length<=1))
throw new TypeError("Array length is 0 and no second argument");if(arguments.length<=1){curr=this[0];i=1;}
else{curr=arguments[1];}
for(i=i||0;i<l;++i){if(i in this)
curr=accumulator.call(undefined,curr,this[i],i,this);}
return curr;};}
if(!Date.prototype.toISOString){(function(){function pad(number){if(number<10){return'0'+number;}
return number;}
Date.prototype.toISOString=function(){return this.getUTCFullYear()+'-'+pad(this.getUTCMonth()+1)+'-'+pad(this.getUTCDate())+'T'+pad(this.getUTCHours())+':'+pad(this.getUTCMinutes())+':'+pad(this.getUTCSeconds())+'.'+(this.getUTCMilliseconds()/1000).toFixed(3).slice(2,5)+'Z';};}());}
if(!Array.prototype.forEach){Array.prototype.forEach=function(f,o){for(var n=this.length>>>0,i=0;n>i;i++)i in this&&f.call(o,this[i],i,this);}}
if(!Date.now){Date.now=function(){return new Date().valueOf();}}
var pen={_loadedModulesById:{},define:function(){var id,deps,definition,i=0,L=arguments.length;while(i<L){var a=arguments[i++];switch(typeof a){case'string':id=a;break;case'function':definition=a;break;case'object':if(a instanceof Array){deps=a;}
break;}}
if(definition){if(deps){var newDeps=[];for(i=0;i<deps.length;i++){if(deps[i]=='cdf/jquery'||deps[i]=='cdf-legacy/jquery'){newDeps.push($);}else{var resolvedName=deps[i];var idParts,depParts;if(deps[i].slice(0,2)=='./'){idParts=id.split('/');resolvedName=idParts.slice(0,idParts.length-1).join('/')+deps[i].slice(1);}else if(deps[i].slice(0,3)=='../'){idParts=id.split('/');depParts=deps[i].split('/');var resolvedParts=idParts.slice(0,idParts.length-1);var k;for(k=0;k<depParts.length;k++){if(depParts[k]=='..'){if(resolvedParts.length===0){resolvedName=null;break;}
resolvedParts.pop();}else{resolvedParts.push(depParts[k]);}}
resolvedName=resolvedParts.join('/');}
newDeps.push(this._loadedModulesById[resolvedName]);}}
deps=newDeps;}else{deps=[];}
var module=definition.apply(null,deps);if(id&&!this._loadedModulesById[id]){this._loadedModulesById[id]=module;}}},require:function(){var args=Array.prototype.slice.apply(arguments);args.unshift("");return this.define.apply(this,args);}};if(typeof define==="undefined"){define=function(){return pen.define.apply(pen,arguments);};}
if(typeof require==="undefined"){require=function(){return pen.require.apply(pen,arguments);};}
if(typeof Encoder==="undefined"){Encoder={};Encoder.encode=function(str,args,queryObj){"use strict";if(typeof args==="undefined"){return str;}
if(args instanceof Array===false){args=[args];}
var matchArray=str.match(/{[0-9]+}/g),encodedUrl="",startIndex,urlPrefix,tmp,i;if(matchArray&&matchArray.length>0){startIndex=0;for(i=0;i<matchArray.length&&i<args.length;i++){urlPrefix=str.substring(startIndex,str.indexOf(matchArray[i])-1);tmp=encodeURIComponent(args[matchArray[i].substring(1,matchArray[i].length-1)]);tmp=tmp.replace("%5C","%255C").replace("%2F","%252F");encodedUrl+=urlPrefix+"/"+tmp;startIndex=str.indexOf(matchArray[i])+matchArray[i].length;}
encodedUrl+=str.substring(str.indexOf(matchArray[matchArray.length-1])+matchArray[matchArray.length-1].length,str.length);}else{encodedUrl=str;}
if(queryObj){encodedUrl+="?"+$.param(queryObj);}
return encodedUrl;};Encoder.encodeRepositoryPath=function(str){"use strict";var encodedStr=String(str).replace(new RegExp(":","g"),"::").replace(new RegExp("[\\\\/]","g"),":");return encodedStr;};Encoder.decodeRepositoryPath=function(str){return String(str).replace(new RegExp(":","g"),"\/").replace(new RegExp("\/\/","g"),":");};}
window.Modernizr=(function(window,document,undefined){var version='2.8.3',Modernizr={},enableClasses=true,docElement=document.documentElement,mod='modernizr',modElem=document.createElement(mod),mStyle=modElem.style,inputElem=document.createElement('input'),smile=':)',toString={}.toString,prefixes=' -webkit- -moz- -o- -ms- '.split(' '),omPrefixes='Webkit Moz O ms',cssomPrefixes=omPrefixes.split(' '),domPrefixes=omPrefixes.toLowerCase().split(' '),ns={'svg':'http://www.w3.org/2000/svg'},tests={},inputs={},attrs={},classes=[],slice=classes.slice,featureName,injectElementWithStyles=function(rule,callback,nodes,testnames){var style,ret,node,docOverflow,div=document.createElement('div'),body=document.body,fakeBody=body||document.createElement('body');if(parseInt(nodes,10)){while(nodes--){node=document.createElement('div');node.id=testnames?testnames[nodes]:mod+(nodes+1);div.appendChild(node);}}
style=['&#173;','<style id="s',mod,'">',rule,'</style>'].join('');div.id=mod;(body?div:fakeBody).innerHTML+=style;fakeBody.appendChild(div);if(!body){fakeBody.style.background='';fakeBody.style.overflow='hidden';docOverflow=docElement.style.overflow;docElement.style.overflow='hidden';docElement.appendChild(fakeBody);}
ret=callback(div,rule);if(!body){fakeBody.parentNode.removeChild(fakeBody);docElement.style.overflow=docOverflow;}else{div.parentNode.removeChild(div);}
return!!ret;},testMediaQuery=function(mq){var matchMedia=window.matchMedia||window.msMatchMedia;if(matchMedia){return matchMedia(mq)&&matchMedia(mq).matches||false;}
var bool;injectElementWithStyles('@media '+mq+' { #'+mod+' { position: absolute; } }',function(node){bool=(window.getComputedStyle?getComputedStyle(node,null):node.currentStyle)['position']=='absolute';});return bool;},isEventSupported=(function(){var TAGNAMES={'select':'input','change':'input','submit':'form','reset':'form','error':'img','load':'img','abort':'img'};function isEventSupported(eventName,element){element=element||document.createElement(TAGNAMES[eventName]||'div');eventName='on'+eventName;var isSupported=eventName in element;if(!isSupported){if(!element.setAttribute){element=document.createElement('div');}
if(element.setAttribute&&element.removeAttribute){element.setAttribute(eventName,'');isSupported=is(element[eventName],'function');if(!is(element[eventName],'undefined')){element[eventName]=undefined;}
element.removeAttribute(eventName);}}
element=null;return isSupported;}
return isEventSupported;})(),_hasOwnProperty=({}).hasOwnProperty,hasOwnProp;if(!is(_hasOwnProperty,'undefined')&&!is(_hasOwnProperty.call,'undefined')){hasOwnProp=function(object,property){return _hasOwnProperty.call(object,property);};}
else{hasOwnProp=function(object,property){return((property in object)&&is(object.constructor.prototype[property],'undefined'));};}
if(!Function.prototype.bind){Function.prototype.bind=function bind(that){var target=this;if(typeof target!="function"){throw new TypeError();}
var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F();var result=target.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result){return result;}
return self;}else{return target.apply(that,args.concat(slice.call(arguments)));}};return bound;};}
function setCss(str){mStyle.cssText=str;}
function setCssAll(str1,str2){return setCss(prefixes.join(str1+';')+(str2||''));}
function is(obj,type){return typeof obj===type;}
function contains(str,substr){return!!~(''+str).indexOf(substr);}
function testProps(props,prefixed){for(var i in props){var prop=props[i];if(!contains(prop,"-")&&mStyle[prop]!==undefined){return prefixed=='pfx'?prop:true;}}
return false;}
function testDOMProps(props,obj,elem){for(var i in props){var item=obj[props[i]];if(item!==undefined){if(elem===false)return props[i];if(is(item,'function')){return item.bind(elem||obj);}
return item;}}
return false;}
function testPropsAll(prop,prefixed,elem){var ucProp=prop.charAt(0).toUpperCase()+prop.slice(1),props=(prop+' '+cssomPrefixes.join(ucProp+' ')+ucProp).split(' ');if(is(prefixed,"string")||is(prefixed,"undefined")){return testProps(props,prefixed);}else{props=(prop+' '+(domPrefixes).join(ucProp+' ')+ucProp).split(' ');return testDOMProps(props,prefixed,elem);}}
tests['flexbox']=function(){return testPropsAll('flexWrap');};tests['flexboxlegacy']=function(){return testPropsAll('boxDirection');};tests['canvas']=function(){var elem=document.createElement('canvas');return!!(elem.getContext&&elem.getContext('2d'));};tests['canvastext']=function(){return!!(Modernizr['canvas']&&is(document.createElement('canvas').getContext('2d').fillText,'function'));};tests['webgl']=function(){return!!window.WebGLRenderingContext;};tests['touch']=function(){var bool;if(('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch){bool=true;}else{injectElementWithStyles(['@media (',prefixes.join('touch-enabled),('),mod,')','{#modernizr{top:9px;position:absolute}}'].join(''),function(node){bool=node.offsetTop===9;});}
return bool;};tests['geolocation']=function(){return'geolocation'in navigator;};tests['postmessage']=function(){return!!window.postMessage;};tests['websqldatabase']=function(){return!!window.openDatabase;};tests['indexedDB']=function(){return!!testPropsAll("indexedDB",window);};tests['hashchange']=function(){return isEventSupported('hashchange',window)&&(document.documentMode===undefined||document.documentMode>7);};tests['history']=function(){return!!(window.history&&history.pushState);};tests['draganddrop']=function(){var div=document.createElement('div');return('draggable'in div)||('ondragstart'in div&&'ondrop'in div);};tests['websockets']=function(){return'WebSocket'in window||'MozWebSocket'in window;};tests['rgba']=function(){setCss('background-color:rgba(150,255,150,.5)');return contains(mStyle.backgroundColor,'rgba');};tests['hsla']=function(){setCss('background-color:hsla(120,40%,100%,.5)');return contains(mStyle.backgroundColor,'rgba')||contains(mStyle.backgroundColor,'hsla');};tests['multiplebgs']=function(){setCss('background:url(https://),url(https://),red url(https://)');return(/(url\s*\(.*?){3}/).test(mStyle.background);};tests['backgroundsize']=function(){return testPropsAll('backgroundSize');};tests['borderimage']=function(){return testPropsAll('borderImage');};tests['borderradius']=function(){return testPropsAll('borderRadius');};tests['boxshadow']=function(){return testPropsAll('boxShadow');};tests['textshadow']=function(){return document.createElement('div').style.textShadow==='';};tests['opacity']=function(){setCssAll('opacity:.55');return(/^0.55$/).test(mStyle.opacity);};tests['cssanimations']=function(){return testPropsAll('animationName');};tests['csscolumns']=function(){return testPropsAll('columnCount');};tests['cssgradients']=function(){var str1='background-image:',str2='gradient(linear,left top,right bottom,from(#9f9),to(white));',str3='linear-gradient(left top,#9f9, white);';setCss((str1+'-webkit- '.split(' ').join(str2+str1)+
prefixes.join(str3+str1)).slice(0,-str1.length));return contains(mStyle.backgroundImage,'gradient');};tests['cssreflections']=function(){return testPropsAll('boxReflect');};tests['csstransforms']=function(){return!!testPropsAll('transform');};tests['csstransforms3d']=function(){var ret=!!testPropsAll('perspective');if(ret&&'webkitPerspective'in docElement.style){injectElementWithStyles('@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}',function(node,rule){ret=node.offsetLeft===9&&node.offsetHeight===3;});}
return ret;};tests['csstransitions']=function(){return testPropsAll('transition');};tests['fontface']=function(){var bool;injectElementWithStyles('@font-face {font-family:"font";src:url("https://")}',function(node,rule){var style=document.getElementById('smodernizr'),sheet=style.sheet||style.styleSheet,cssText=sheet?(sheet.cssRules&&sheet.cssRules[0]?sheet.cssRules[0].cssText:sheet.cssText||''):'';bool=/src/i.test(cssText)&&cssText.indexOf(rule.split(' ')[0])===0;});return bool;};tests['generatedcontent']=function(){var bool;injectElementWithStyles(['#',mod,'{font:0/0 a}#',mod,':after{content:"',smile,'";visibility:hidden;font:3px/1 a}'].join(''),function(node){bool=node.offsetHeight>=3;});return bool;};tests['video']=function(){var elem=document.createElement('video'),bool=false;try{if(bool=!!elem.canPlayType){bool=new Boolean(bool);bool.ogg=elem.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,'');bool.h264=elem.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,'');bool.webm=elem.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,'');}}catch(e){}
return bool;};tests['audio']=function(){var elem=document.createElement('audio'),bool=false;try{if(bool=!!elem.canPlayType){bool=new Boolean(bool);bool.ogg=elem.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,'');bool.mp3=elem.canPlayType('audio/mpeg;').replace(/^no$/,'');bool.wav=elem.canPlayType('audio/wav; codecs="1"').replace(/^no$/,'');bool.m4a=(elem.canPlayType('audio/x-m4a;')||elem.canPlayType('audio/aac;')).replace(/^no$/,'');}}catch(e){}
return bool;};tests['localstorage']=function(){try{localStorage.setItem(mod,mod);localStorage.removeItem(mod);return true;}catch(e){return false;}};tests['sessionstorage']=function(){try{sessionStorage.setItem(mod,mod);sessionStorage.removeItem(mod);return true;}catch(e){return false;}};tests['webworkers']=function(){return!!window.Worker;};tests['applicationcache']=function(){return!!window.applicationCache;};tests['svg']=function(){return!!document.createElementNS&&!!document.createElementNS(ns.svg,'svg').createSVGRect;};tests['inlinesvg']=function(){var div=document.createElement('div');div.innerHTML='<svg/>';return(div.firstChild&&div.firstChild.namespaceURI)==ns.svg;};tests['smil']=function(){return!!document.createElementNS&&/SVGAnimate/.test(toString.call(document.createElementNS(ns.svg,'animate')));};tests['svgclippaths']=function(){return!!document.createElementNS&&/SVGClipPath/.test(toString.call(document.createElementNS(ns.svg,'clipPath')));};function webforms(){Modernizr['input']=(function(props){for(var i=0,len=props.length;i<len;i++){attrs[props[i]]=!!(props[i]in inputElem);}
if(attrs.list){attrs.list=!!(document.createElement('datalist')&&window.HTMLDataListElement);}
return attrs;})('autocomplete autofocus list placeholder max min multiple pattern required step'.split(' '));Modernizr['inputtypes']=(function(props){for(var i=0,bool,inputElemType,defaultView,len=props.length;i<len;i++){inputElem.setAttribute('type',inputElemType=props[i]);bool=inputElem.type!=='text';if(bool){inputElem.value=smile;inputElem.style.cssText='position:absolute;visibility:hidden;';if(/^range$/.test(inputElemType)&&inputElem.style.WebkitAppearance!==undefined){docElement.appendChild(inputElem);defaultView=document.defaultView;bool=defaultView.getComputedStyle&&defaultView.getComputedStyle(inputElem,null).WebkitAppearance!=='textfield'&&(inputElem.offsetHeight!==0);docElement.removeChild(inputElem);}else if(/^(search|tel)$/.test(inputElemType)){}else if(/^(url|email)$/.test(inputElemType)){bool=inputElem.checkValidity&&inputElem.checkValidity()===false;}else{bool=inputElem.value!=smile;}}
inputs[props[i]]=!!bool;}
return inputs;})('search tel url email datetime date month week time datetime-local number range color'.split(' '));}
for(var feature in tests){if(hasOwnProp(tests,feature)){featureName=feature.toLowerCase();Modernizr[featureName]=tests[feature]();classes.push((Modernizr[featureName]?'':'no-')+featureName);}}
Modernizr.input||webforms();Modernizr.addTest=function(feature,test){if(typeof feature=='object'){for(var key in feature){if(hasOwnProp(feature,key)){Modernizr.addTest(key,feature[key]);}}}else{feature=feature.toLowerCase();if(Modernizr[feature]!==undefined){return Modernizr;}
test=typeof test=='function'?test():test;if(typeof enableClasses!=="undefined"&&enableClasses){docElement.className+=' '+(test?'':'no-')+feature;}
Modernizr[feature]=test;}
return Modernizr;};setCss('');modElem=inputElem=null;;(function(window,document){var version='3.7.0';var options=window.html5||{};var reSkip=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i;var saveClones=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i;var supportsHtml5Styles;var expando='_html5shiv';var expanID=0;var expandoData={};var supportsUnknownElements;(function(){try{var a=document.createElement('a');a.innerHTML='<xyz></xyz>';supportsHtml5Styles=('hidden'in a);supportsUnknownElements=a.childNodes.length==1||(function(){(document.createElement)('a');var frag=document.createDocumentFragment();return(typeof frag.cloneNode=='undefined'||typeof frag.createDocumentFragment=='undefined'||typeof frag.createElement=='undefined');}());}catch(e){supportsHtml5Styles=true;supportsUnknownElements=true;}}());function addStyleSheet(ownerDocument,cssText){var p=ownerDocument.createElement('p'),parent=ownerDocument.getElementsByTagName('head')[0]||ownerDocument.documentElement;p.innerHTML='x<style>'+cssText+'</style>';return parent.insertBefore(p.lastChild,parent.firstChild);}
function getElements(){var elements=html5.elements;return typeof elements=='string'?elements.split(' '):elements;}
function getExpandoData(ownerDocument){var data=expandoData[ownerDocument[expando]];if(!data){data={};expanID++;ownerDocument[expando]=expanID;expandoData[expanID]=data;}
return data;}
function createElement(nodeName,ownerDocument,data){if(!ownerDocument){ownerDocument=document;}
if(supportsUnknownElements){return ownerDocument.createElement(nodeName);}
if(!data){data=getExpandoData(ownerDocument);}
var node;if(data.cache[nodeName]){node=data.cache[nodeName].cloneNode();}else if(saveClones.test(nodeName)){node=(data.cache[nodeName]=data.createElem(nodeName)).cloneNode();}else{node=data.createElem(nodeName);}
return node.canHaveChildren&&!reSkip.test(nodeName)&&!node.tagUrn?data.frag.appendChild(node):node;}
function createDocumentFragment(ownerDocument,data){if(!ownerDocument){ownerDocument=document;}
if(supportsUnknownElements){return ownerDocument.createDocumentFragment();}
data=data||getExpandoData(ownerDocument);var clone=data.frag.cloneNode(),i=0,elems=getElements(),l=elems.length;for(;i<l;i++){clone.createElement(elems[i]);}
return clone;}
function shivMethods(ownerDocument,data){if(!data.cache){data.cache={};data.createElem=ownerDocument.createElement;data.createFrag=ownerDocument.createDocumentFragment;data.frag=data.createFrag();}
ownerDocument.createElement=function(nodeName){if(!html5.shivMethods){return data.createElem(nodeName);}
return createElement(nodeName,ownerDocument,data);};ownerDocument.createDocumentFragment=Function('h,f','return function(){'+'var n=f.cloneNode(),c=n.createElement;'+'h.shivMethods&&('+
getElements().join().replace(/[\w\-]+/g,function(nodeName){data.createElem(nodeName);data.frag.createElement(nodeName);return'c("'+nodeName+'")';})+');return n}')(html5,data.frag);}
function shivDocument(ownerDocument){if(!ownerDocument){ownerDocument=document;}
var data=getExpandoData(ownerDocument);if(html5.shivCSS&&!supportsHtml5Styles&&!data.hasCSS){data.hasCSS=!!addStyleSheet(ownerDocument,'article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}'+'mark{background:#FF0;color:#000}'+'template{display:none}');}
if(!supportsUnknownElements){shivMethods(ownerDocument,data);}
return ownerDocument;}
var html5={'elements':options.elements||'abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video','version':version,'shivCSS':(options.shivCSS!==false),'supportsUnknownElements':supportsUnknownElements,'shivMethods':(options.shivMethods!==false),'type':'default','shivDocument':shivDocument,createElement:createElement,createDocumentFragment:createDocumentFragment};window.html5=html5;shivDocument(document);}(this,document));Modernizr._version=version;Modernizr._prefixes=prefixes;Modernizr._domPrefixes=domPrefixes;Modernizr._cssomPrefixes=cssomPrefixes;Modernizr.mq=testMediaQuery;Modernizr.hasEvent=isEventSupported;Modernizr.testProp=function(prop){return testProps([prop]);};Modernizr.testAllProps=testPropsAll;Modernizr.testStyles=injectElementWithStyles;Modernizr.prefixed=function(prop,obj,elem){if(!obj){return testPropsAll(prop,'pfx');}else{return testPropsAll(prop,obj,elem);}};docElement.className=docElement.className.replace(/(^|\s)no-js(\s|$)/,'$1$2')+
(enableClasses?' js '+classes.join(' '):'');return Modernizr;})(this,this.document);
(function(global,factory){"use strict";if(typeof module==="object"&&typeof module.exports==="object"){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error("jQuery requires a window with a document");}
return factory(w);};}else{factory(global);}})(typeof window!=="undefined"?window:this,function(window,noGlobal){"use strict";var arr=[];var document=window.document;var getProto=Object.getPrototypeOf;var slice=arr.slice;var concat=arr.concat;var push=arr.push;var indexOf=arr.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var fnToString=hasOwn.toString;var ObjectFunctionString=fnToString.call(Object);var support={};var isFunction=function isFunction(obj){return typeof obj==="function"&&typeof obj.nodeType!=="number";};var isWindow=function isWindow(obj){return obj!=null&&obj===obj.window;};var preservedScriptAttributes={type:true,src:true,nonce:true,noModule:true};function DOMEval(code,node,doc){doc=doc||document;var i,val,script=doc.createElement("script");script.text=code;if(node){for(i in preservedScriptAttributes){val=node[i]||node.getAttribute&&node.getAttribute(i);if(val){script.setAttribute(i,val);}}}
doc.head.appendChild(script).parentNode.removeChild(script);}
function toType(obj){if(obj==null){return obj+"";}
return typeof obj==="object"||typeof obj==="function"?class2type[toString.call(obj)]||"object":typeof obj;}
var
version="3.4.0",jQuery=function(selector,context){return new jQuery.fn.init(selector,context);},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,length:0,toArray:function(){return slice.call(this);},get:function(num){if(num==null){return slice.call(this);}
return num<0?this[num+this.length]:this[num];},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;return ret;},each:function(callback){return jQuery.each(this,callback);},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem);}));},slice:function(){return this.pushStack(slice.apply(this,arguments));},first:function(){return this.eq(0);},last:function(){return this.eq(-1);},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[]);},end:function(){return this.prevObject||this.constructor();},push:push,sort:arr.sort,splice:arr.splice};jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[i]||{};i++;}
if(typeof target!=="object"&&!isFunction(target)){target={};}
if(i===length){target=this;i--;}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){copy=options[name];if(name==="__proto__"||target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){src=target[name];if(copyIsArray&&!Array.isArray(src)){clone=[];}else if(!copyIsArray&&!jQuery.isPlainObject(src)){clone={};}else{clone=src;}
copyIsArray=false;target[name]=jQuery.extend(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:true,error:function(msg){throw new Error(msg);},noop:function(){},isPlainObject:function(obj){var proto,Ctor;if(!obj||toString.call(obj)!=="[object Object]"){return false;}
proto=getProto(obj);if(!proto){return true;}
Ctor=hasOwn.call(proto,"constructor")&&proto.constructor;return typeof Ctor==="function"&&fnToString.call(Ctor)===ObjectFunctionString;},isEmptyObject:function(obj){var name;for(name in obj){return false;}
return true;},globalEval:function(code,options){DOMEval(code,{nonce:options&&options.nonce});},each:function(obj,callback){var length,i=0;if(isArrayLike(obj)){length=obj.length;for(;i<length;i++){if(callback.call(obj[i],i,obj[i])===false){break;}}}else{for(i in obj){if(callback.call(obj[i],i,obj[i])===false){break;}}}
return obj;},trim:function(text){return text==null?"":(text+"").replace(rtrim,"");},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArrayLike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr);}else{push.call(ret,arr);}}
return ret;},inArray:function(elem,arr,i){return arr==null?-1:indexOf.call(arr,elem,i);},merge:function(first,second){var len=+second.length,j=0,i=first.length;for(;j<len;j++){first[i++]=second[j];}
first.length=i;return first;},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i]);}}
return matches;},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems)){length=elems.length;for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value);}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value);}}}
return concat.apply([],ret);},guid:1,support:support});if(typeof Symbol==="function"){jQuery.fn[Symbol.iterator]=arr[Symbol.iterator];}
jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase();});function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=toType(obj);if(isFunction(obj)||isWindow(obj)){return false;}
return type==="array"||length===0||typeof length==="number"&&length>0&&(length-1)in obj;}
var Sizzle=(function(window){var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date(),preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),nonnativeSelectorCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true;}
return 0;},hasOwn=({}).hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){var i=0,len=list.length;for(;i<len;i++){if(list[i]===elem){return i;}}
return-1;},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\(("+"('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|"+"((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|"+".*"+")\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rdescend=new RegExp(whitespace+"|>"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={"ID":new RegExp("^#("+identifier+")"),"CLASS":new RegExp("^\\.("+identifier+")"),"TAG":new RegExp("^("+identifier+"|[*])"),"ATTR":new RegExp("^"+attributes),"PSEUDO":new RegExp("^"+pseudos),"CHILD":new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),"bool":new RegExp("^(?:"+booleans+")$","i"),"needsContext":new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+
whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rhtml=/HTML$/i,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-0x10000;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+0x10000):String.fromCharCode(high>>10|0xD800,high&0x3FF|0xDC00);},rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(ch,asCodePoint){if(asCodePoint){if(ch==="\0"){return"\uFFFD";}
return ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" ";}
return"\\"+ch;},unloadHandler=function(){setDocument();},inDisabledFieldset=addCombinator(function(elem){return elem.disabled===true&&elem.nodeName.toLowerCase()==="fieldset";},{dir:"parentNode",next:"legend"});try{push.apply((arr=slice.call(preferredDoc.childNodes)),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType;}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els));}:function(target,els){var j=target.length,i=0;while((target[j++]=els[i++])){}
target.length=j-1;}};}
function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;results=results||[];if(typeof selector!=="string"||!selector||nodeType!==1&&nodeType!==9&&nodeType!==11){return results;}
if(!seed){if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context);}
context=context||document;if(documentIsHTML){if(nodeType!==11&&(match=rquickExpr.exec(selector))){if((m=match[1])){if(nodeType===9){if((elem=context.getElementById(m))){if(elem.id===m){results.push(elem);return results;}}else{return results;}}else{if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results;}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results;}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results;}}
if(support.qsa&&!nonnativeSelectorCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))&&(nodeType!==1||context.nodeName.toLowerCase()!=="object")){newSelector=selector;newContext=context;if(nodeType===1&&rdescend.test(selector)){if((nid=context.getAttribute("id"))){nid=nid.replace(rcssescape,fcssescape);}else{context.setAttribute("id",(nid=expando));}
groups=tokenize(selector);i=groups.length;while(i--){groups[i]="#"+nid+" "+toSelector(groups[i]);}
newSelector=groups.join(",");newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;}
try{push.apply(results,newContext.querySelectorAll(newSelector));return results;}catch(qsaError){nonnativeSelectorCache(selector,true);}finally{if(nid===expando){context.removeAttribute("id");}}}}}
return select(selector.replace(rtrim,"$1"),context,results,seed);}
function createCache(){var keys=[];function cache(key,value){if(keys.push(key+" ")>Expr.cacheLength){delete cache[keys.shift()];}
return(cache[key+" "]=value);}
return cache;}
function markFunction(fn){fn[expando]=true;return fn;}
function assert(fn){var el=document.createElement("fieldset");try{return!!fn(el);}catch(e){return false;}finally{if(el.parentNode){el.parentNode.removeChild(el);}
el=null;}}
function addHandle(attrs,handler){var arr=attrs.split("|"),i=arr.length;while(i--){Expr.attrHandle[arr[i]]=handler;}}
function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&a.sourceIndex-b.sourceIndex;if(diff){return diff;}
if(cur){while((cur=cur.nextSibling)){if(cur===b){return-1;}}}
return a?1:-1;}
function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type;};}
function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type;};}
function createDisabledPseudo(disabled){return function(elem){if("form"in elem){if(elem.parentNode&&elem.disabled===false){if("label"in elem){if("label"in elem.parentNode){return elem.parentNode.disabled===disabled;}else{return elem.disabled===disabled;}}
return elem.isDisabled===disabled||elem.isDisabled!==!disabled&&inDisabledFieldset(elem)===disabled;}
return elem.disabled===disabled;}else if("label"in elem){return elem.disabled===disabled;}
return false;};}
function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[(j=matchIndexes[i])]){seed[j]=!(matches[j]=seed[j]);}}});});}
function testContext(context){return context&&typeof context.getElementsByTagName!=="undefined"&&context;}
support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var namespace=elem.namespaceURI,docElem=(elem.ownerDocument||elem).documentElement;return!rhtml.test(namespace||docElem&&docElem.nodeName||"HTML");};setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document;}
document=doc;docElem=document.documentElement;documentIsHTML=!isXML(document);if(preferredDoc!==document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow){if(subWindow.addEventListener){subWindow.addEventListener("unload",unloadHandler,false);}else if(subWindow.attachEvent){subWindow.attachEvent("onunload",unloadHandler);}}
support.attributes=assert(function(el){el.className="i";return!el.getAttribute("className");});support.getElementsByTagName=assert(function(el){el.appendChild(document.createComment(""));return!el.getElementsByTagName("*").length;});support.getElementsByClassName=rnative.test(document.getElementsByClassName);support.getById=assert(function(el){docElem.appendChild(el).id=expando;return!document.getElementsByName||!document.getElementsByName(expando).length;});if(support.getById){Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId;};};Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[];}};}else{Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return node&&node.value===attrId;};};Expr.find["ID"]=function(id,context){if(typeof context.getElementById!=="undefined"&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){node=elem.getAttributeNode("id");if(node&&node.value===id){return[elem];}
elems=context.getElementsByName(id);i=0;while((elem=elems[i++])){node=elem.getAttributeNode("id");if(node&&node.value===id){return[elem];}}}
return[];}};}
Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!=="undefined"){return context.getElementsByTagName(tag);}else if(support.qsa){return context.querySelectorAll(tag);}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while((elem=results[i++])){if(elem.nodeType===1){tmp.push(elem);}}
return tmp;}
return results;};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!=="undefined"&&documentIsHTML){return context.getElementsByClassName(className);}};rbuggyMatches=[];rbuggyQSA=[];if((support.qsa=rnative.test(document.querySelectorAll))){assert(function(el){docElem.appendChild(el).innerHTML="<a id='"+expando+"'></a>"+"<select id='"+expando+"-\r\\' msallowcapture=''>"+"<option selected=''></option></select>";if(el.querySelectorAll("[msallowcapture^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")");}
if(!el.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")");}
if(!el.querySelectorAll("[id~="+expando+"-]").length){rbuggyQSA.push("~=");}
if(!el.querySelectorAll(":checked").length){rbuggyQSA.push(":checked");}
if(!el.querySelectorAll("a#"+expando+"+*").length){rbuggyQSA.push(".#.+[+~]");}});assert(function(el){el.innerHTML="<a href='' disabled='disabled'></a>"+"<select disabled='disabled'><option/></select>";var input=document.createElement("input");input.setAttribute("type","hidden");el.appendChild(input).setAttribute("name","D");if(el.querySelectorAll("[name=d]").length){rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?=");}
if(el.querySelectorAll(":enabled").length!==2){rbuggyQSA.push(":enabled",":disabled");}
docElem.appendChild(el).disabled=true;if(el.querySelectorAll(":disabled").length!==2){rbuggyQSA.push(":enabled",":disabled");}
el.querySelectorAll("*,:x");rbuggyQSA.push(",.*:");});}
if((support.matchesSelector=rnative.test((matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)))){assert(function(el){support.disconnectedMatch=matches.call(el,"*");matches.call(el,"[s!='']:x");rbuggyMatches.push("!=",pseudos);});}
rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16));}:function(a,b){if(b){while((b=b.parentNode)){if(b===a){return true;}}}
return false;};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0;}
var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare;}
compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||(!support.sortDetached&&b.compareDocumentPosition(a)===compare)){if(a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1;}
if(b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1;}
return sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;}
return compare&4?-1:1;}:function(a,b){if(a===b){hasDuplicate=true;return 0;}
var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?(indexOf(sortInput,a)-indexOf(sortInput,b)):0;}else if(aup===bup){return siblingCheck(a,b);}
cur=a;while((cur=cur.parentNode)){ap.unshift(cur);}
cur=b;while((cur=cur.parentNode)){bp.unshift(cur);}
while(ap[i]===bp[i]){i++;}
return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0;};return document;};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements);};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem);}
if(support.matchesSelector&&documentIsHTML&&!nonnativeSelectorCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret;}}catch(e){nonnativeSelectorCache(expr,true);}}
return Sizzle(expr,document,null,[elem]).length>0;};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context);}
return contains(context,elem);};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem);}
var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null;};Sizzle.escape=function(sel){return(sel+"").replace(rcssescape,fcssescape);};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg);};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while((elem=results[i++])){if(elem===results[i]){j=duplicates.push(i);}}
while(j--){results.splice(duplicates[j],1);}}
sortInput=null;return results;};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){while((node=elem[i++])){ret+=getText(node);}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent;}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem);}}}else if(nodeType===3||nodeType===4){return elem.nodeValue;}
return ret;};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{"ATTR":function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" ";}
return match.slice(0,4);},"CHILD":function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0]);}
match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+((match[7]+match[8])||match[3]==="odd");}else if(match[3]){Sizzle.error(match[0]);}
return match;},"PSEUDO":function(match){var excess,unquoted=!match[6]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null;}
if(match[3]){match[2]=match[4]||match[5]||"";}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess);}
return match.slice(0,3);}},filter:{"TAG":function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true;}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName;};},"CLASS":function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!=="undefined"&&elem.getAttribute("class")||"");});},"ATTR":function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!=";}
if(!operator){return true;}
result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false;};},"CHILD":function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode;}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=false;if(parent){if(simple){while(dir){node=elem;while((node=node[dir])){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false;}}
start=dir=type==="only"&&!start&&"nextSibling";}
return true;}
start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){node=parent;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if(node.nodeType===1&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break;}}}else{if(useCache){node=elem;outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});cache=uniqueCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=nodeIndex;}
if(diff===false){while((node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){outerCache=node[expando]||(node[expando]={});uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={});uniqueCache[type]=[dirruns,diff];}
if(node===elem){break;}}}}}
diff-=last;return diff===first||(diff%first===0&&diff/first>=0);}};},"PSEUDO":function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument);}
if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i]);}}):function(elem){return fn(elem,0,args);};}
return fn;}},pseudos:{"not":markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if((elem=unmatched[i])){seed[i]=!(matches[i]=elem);}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);input[0]=null;return!results.pop();};}),"has":markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0;};}),"contains":markFunction(function(text){text=text.replace(runescape,funescape);return function(elem){return(elem.textContent||getText(elem)).indexOf(text)>-1;};}),"lang":markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang);}
lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if((elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0;}}while((elem=elem.parentNode)&&elem.nodeType===1);return false;};}),"target":function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id;},"root":function(elem){return elem===docElem;},"focus":function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex);},"enabled":createDisabledPseudo(false),"disabled":createDisabledPseudo(true),"checked":function(elem){var nodeName=elem.nodeName.toLowerCase();return(nodeName==="input"&&!!elem.checked)||(nodeName==="option"&&!!elem.selected);},"selected":function(elem){if(elem.parentNode){elem.parentNode.selectedIndex;}
return elem.selected===true;},"empty":function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false;}}
return true;},"parent":function(elem){return!Expr.pseudos["empty"](elem);},"header":function(elem){return rheader.test(elem.nodeName);},"input":function(elem){return rinputs.test(elem.nodeName);},"button":function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button";},"text":function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()==="text");},"first":createPositionalPseudo(function(){return[0];}),"last":createPositionalPseudo(function(matchIndexes,length){return[length-1];}),"eq":createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument];}),"even":createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"odd":createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i);}
return matchIndexes;}),"lt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument>length?length:argument;for(;--i>=0;){matchIndexes.push(i);}
return matchIndexes;}),"gt":createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i);}
return matchIndexes;})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i);}
for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i);}
function setFilters(){}
setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters();tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0);}
soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar;}
groups.push((tokens=[]));}
matched=false;if((match=rcombinators.exec(soFar))){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length);}
for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length);}}
if(!matched){break;}}
return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0);};function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value;}
return selector;}
function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&key==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml);}}
return false;}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true;}}}}else{while((elem=elem[dir])){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={});if(skip&&skip===elem.nodeName.toLowerCase()){elem=elem[dir]||elem;}else if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return(newCache[2]=oldCache[2]);}else{uniqueCache[key]=newCache;if((newCache[2]=matcher(elem,context,xml))){return true;}}}}}
return false;};}
function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false;}}
return true;}:matchers[0];}
function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results);}
return results;}
function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if((elem=unmatched[i])){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i);}}}}
return newUnmatched;}
function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter);}
if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector);}
return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml);}
if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if((elem=temp[i])){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem);}}}
if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if((elem=matcherOut[i])){temp.push((matcherIn[i]=elem));}}
postFinder(null,(matcherOut=[]),temp,xml);}
i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem);}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml);}else{push.apply(results,matcherOut);}}});}
function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext;},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1;},implicitRelative,true),matchers=[function(elem,context,xml){var ret=(!leadingRelative&&(xml||context!==outermostContext))||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));checkContext=null;return ret;}];for(;i<len;i++){if((matcher=Expr.relative[tokens[i].type])){matchers=[addCombinator(elementMatcher(matchers),matcher)];}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break;}}
return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens((tokens=tokens.slice(j))),j<len&&toSelector(tokens));}
matchers.push(matcher);}}
return elementMatcher(matchers);}
function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",outermost),dirrunsUnique=(dirruns+=contextBackup==null?1:Math.random()||0.1),len=elems.length;if(outermost){outermostContext=context===document||context||outermost;}
for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;if(!context&&elem.ownerDocument!==document){setDocument(elem);xml=!documentIsHTML;}
while((matcher=elementMatchers[j++])){if(matcher(elem,context||document,xml)){results.push(elem);break;}}
if(outermost){dirruns=dirrunsUnique;}}
if(bySet){if((elem=!matcher&&elem)){matchedCount--;}
if(seed){unmatched.push(elem);}}}
matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while((matcher=setMatchers[j++])){matcher(unmatched,setMatched,context,xml);}
if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results);}}}
setMatched=condense(setMatched);}
push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&(matchedCount+setMatchers.length)>1){Sizzle.uniqueSort(results);}}
if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup;}
return unmatched;};return bySet?markFunction(superMatcher):superMatcher;}
compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!match){match=tokenize(selector);}
i=match.length;while(i--){cached=matcherFromTokens(match[i]);if(cached[expando]){setMatchers.push(cached);}else{elementMatchers.push(cached);}}
cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers));cached.selector=selector;}
return cached;};select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled=typeof selector==="function"&&selector,match=!seed&&tokenize((selector=compiled.selector||selector));results=results||[];if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results;}else if(compiled){context=context.parentNode;}
selector=selector.slice(tokens.shift().value.length);}
i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[(type=token.type)]){break;}
if((find=Expr.find[type])){if((seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results;}
break;}}}}
(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context);return results;};support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(el){return el.compareDocumentPosition(document.createElement("fieldset"))&1;});if(!assert(function(el){el.innerHTML="<a href='#'></a>";return el.firstChild.getAttribute("href")==="#";})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2);}});}
if(!support.attributes||!assert(function(el){el.innerHTML="<input/>";el.firstChild.setAttribute("value","");return el.firstChild.getAttribute("value")==="";})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue;}});}
if(!assert(function(el){return el.getAttribute("disabled")==null;})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null;}});}
return Sizzle;})(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;jQuery.escapeSelector=Sizzle.escape;var dir=function(elem,dir,until){var matched=[],truncate=until!==undefined;while((elem=elem[dir])&&elem.nodeType!==9){if(elem.nodeType===1){if(truncate&&jQuery(elem).is(until)){break;}
matched.push(elem);}}
return matched;};var siblings=function(n,elem){var matched=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){matched.push(n);}}
return matched;};var rneedsContext=jQuery.expr.match.needsContext;function nodeName(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase();};var rsingleTag=(/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i);function winnow(elements,qualifier,not){if(isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not;});}
if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return(elem===qualifier)!==not;});}
if(typeof qualifier!=="string"){return jQuery.grep(elements,function(elem){return(indexOf.call(qualifier,elem)>-1)!==not;});}
return jQuery.filter(qualifier,elements,not);}
jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")";}
if(elems.length===1&&elem.nodeType===1){return jQuery.find.matchesSelector(elem,expr)?[elem]:[];}
return jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1;}));};jQuery.fn.extend({find:function(selector){var i,ret,len=this.length,self=this;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true;}}}));}
ret=this.pushStack([]);for(i=0;i<len;i++){jQuery.find(selector,self[i],ret);}
return len>1?jQuery.uniqueSort(ret):ret;},filter:function(selector){return this.pushStack(winnow(this,selector||[],false));},not:function(selector){return this.pushStack(winnow(this,selector||[],true));},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length;}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector){return this;}
root=root||rootjQuery;if(typeof selector==="string"){if(selector[0]==="<"&&selector[selector.length-1]===">"&&selector.length>=3){match=[null,selector,null];}else{match=rquickExpr.exec(selector);}
if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(isFunction(this[match])){this[match](context[match]);}else{this.attr(match,context[match]);}}}
return this;}else{elem=document.getElementById(match[2]);if(elem){this[0]=elem;this.length=1;}
return this;}}else if(!context||context.jquery){return(context||root).find(selector);}else{return this.constructor(context).find(selector);}}else if(selector.nodeType){this[0]=selector;this.length=1;return this;}else if(isFunction(selector)){return root.ready!==undefined?root.ready(selector):selector(jQuery);}
return jQuery.makeArray(selector,this);};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){var i=0;for(;i<l;i++){if(jQuery.contains(this,targets[i])){return true;}}});},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],targets=typeof selectors!=="string"&&jQuery(selectors);if(!rneedsContext.test(selectors)){for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(targets?targets.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break;}}}}
return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched);},index:function(elem){if(!elem){return(this[0]&&this[0].parentNode)?this.first().prevAll().length:-1;}
if(typeof elem==="string"){return indexOf.call(jQuery(elem),this[0]);}
return indexOf.call(this,elem.jquery?elem[0]:elem);},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))));},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));}});function sibling(cur,dir){while((cur=cur[dir])&&cur.nodeType!==1){}
return cur;}
jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null;},parents:function(elem){return dir(elem,"parentNode");},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until);},next:function(elem){return sibling(elem,"nextSibling");},prev:function(elem){return sibling(elem,"previousSibling");},nextAll:function(elem){return dir(elem,"nextSibling");},prevAll:function(elem){return dir(elem,"previousSibling");},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until);},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until);},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem);},children:function(elem){return siblings(elem.firstChild);},contents:function(elem){if(typeof elem.contentDocument!=="undefined"){return elem.contentDocument;}
if(nodeName(elem,"template")){elem=elem.content||elem;}
return jQuery.merge([],elem.childNodes);}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until;}
if(selector&&typeof selector==="string"){matched=jQuery.filter(selector,matched);}
if(this.length>1){if(!guaranteedUnique[name]){jQuery.uniqueSort(matched);}
if(rparentsprev.test(name)){matched.reverse();}}
return this.pushStack(matched);};});var rnothtmlwhite=(/[^\x20\t\r\n\f]+/g);function createOptions(options){var object={};jQuery.each(options.match(rnothtmlwhite)||[],function(_,flag){object[flag]=true;});return object;}
jQuery.Callbacks=function(options){options=typeof options==="string"?createOptions(options):jQuery.extend({},options);var
firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,fire=function(){locked=locked||options.once;fired=firing=true;for(;queue.length;firingIndex=-1){memory=queue.shift();while(++firingIndex<list.length){if(list[firingIndex].apply(memory[0],memory[1])===false&&options.stopOnFalse){firingIndex=list.length;memory=false;}}}
if(!options.memory){memory=false;}
firing=false;if(locked){if(memory){list=[];}else{list="";}}},self={add:function(){if(list){if(memory&&!firing){firingIndex=list.length-1;queue.push(memory);}
(function add(args){jQuery.each(args,function(_,arg){if(isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg);}}else if(arg&&arg.length&&toType(arg)!=="string"){add(arg);}});})(arguments);if(memory&&!firing){fire();}}
return this;},remove:function(){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(index<=firingIndex){firingIndex--;}}});return this;},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0;},empty:function(){if(list){list=[];}
return this;},disable:function(){locked=queue=[];list=memory="";return this;},disabled:function(){return!list;},lock:function(){locked=queue=[];if(!memory&&!firing){list=memory="";}
return this;},locked:function(){return!!locked;},fireWith:function(context,args){if(!locked){args=args||[];args=[context,args.slice?args.slice():args];queue.push(args);if(!firing){fire();}}
return this;},fire:function(){self.fireWith(this,arguments);return this;},fired:function(){return!!fired;}};return self;};function Identity(v){return v;}
function Thrower(ex){throw ex;}
function adoptValue(value,resolve,reject,noValue){var method;try{if(value&&isFunction((method=value.promise))){method.call(value).done(resolve).fail(reject);}else if(value&&isFunction((method=value.then))){method.call(value,resolve,reject);}else{resolve.apply(undefined,[value].slice(noValue));}}catch(value){reject.apply(undefined,[value]);}}
jQuery.extend({Deferred:function(func){var tuples=[["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory"),2],["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),0,"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),1,"rejected"]],state="pending",promise={state:function(){return state;},always:function(){deferred.done(arguments).fail(arguments);return this;},"catch":function(fn){return promise.then(null,fn);},pipe:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=isFunction(fns[tuple[4]])&&fns[tuple[4]];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&isFunction(returned.promise)){returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject);}else{newDefer[tuple[0]+"With"](this,fn?[returned]:arguments);}});});fns=null;}).promise();},then:function(onFulfilled,onRejected,onProgress){var maxDepth=0;function resolve(depth,deferred,handler,special){return function(){var that=this,args=arguments,mightThrow=function(){var returned,then;if(depth<maxDepth){return;}
returned=handler.apply(that,args);if(returned===deferred.promise()){throw new TypeError("Thenable self-resolution");}
then=returned&&(typeof returned==="object"||typeof returned==="function")&&returned.then;if(isFunction(then)){if(special){then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special));}else{maxDepth++;then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special),resolve(maxDepth,deferred,Identity,deferred.notifyWith));}}else{if(handler!==Identity){that=undefined;args=[returned];}
(special||deferred.resolveWith)(that,args);}},process=special?mightThrow:function(){try{mightThrow();}catch(e){if(jQuery.Deferred.exceptionHook){jQuery.Deferred.exceptionHook(e,process.stackTrace);}
if(depth+1>=maxDepth){if(handler!==Thrower){that=undefined;args=[e];}
deferred.rejectWith(that,args);}}};if(depth){process();}else{if(jQuery.Deferred.getStackHook){process.stackTrace=jQuery.Deferred.getStackHook();}
window.setTimeout(process);}};}
return jQuery.Deferred(function(newDefer){tuples[0][3].add(resolve(0,newDefer,isFunction(onProgress)?onProgress:Identity,newDefer.notifyWith));tuples[1][3].add(resolve(0,newDefer,isFunction(onFulfilled)?onFulfilled:Identity));tuples[2][3].add(resolve(0,newDefer,isFunction(onRejected)?onRejected:Thrower));}).promise();},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise;}},deferred={};jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[5];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString;},tuples[3-i][2].disable,tuples[3-i][3].disable,tuples[0][2].lock,tuples[0][3].lock);}
list.add(tuple[3].fire);deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?undefined:this,arguments);return this;};deferred[tuple[0]+"With"]=list.fireWith;});promise.promise(deferred);if(func){func.call(deferred,deferred);}
return deferred;},when:function(singleValue){var
remaining=arguments.length,i=remaining,resolveContexts=Array(i),resolveValues=slice.call(arguments),master=jQuery.Deferred(),updateFunc=function(i){return function(value){resolveContexts[i]=this;resolveValues[i]=arguments.length>1?slice.call(arguments):value;if(!(--remaining)){master.resolveWith(resolveContexts,resolveValues);}};};if(remaining<=1){adoptValue(singleValue,master.done(updateFunc(i)).resolve,master.reject,!remaining);if(master.state()==="pending"||isFunction(resolveValues[i]&&resolveValues[i].then)){return master.then();}}
while(i--){adoptValue(resolveValues[i],updateFunc(i),master.reject);}
return master.promise();}});var rerrorNames=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(error,stack){if(window.console&&window.console.warn&&error&&rerrorNames.test(error.name)){window.console.warn("jQuery.Deferred exception: "+error.message,error.stack,stack);}};jQuery.readyException=function(error){window.setTimeout(function(){throw error;});};var readyList=jQuery.Deferred();jQuery.fn.ready=function(fn){readyList.then(fn).catch(function(error){jQuery.readyException(error);});return this;};jQuery.extend({isReady:false,readyWait:1,ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return;}
jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return;}
readyList.resolveWith(document,[jQuery]);}});jQuery.ready.then=readyList.then;function completed(){document.removeEventListener("DOMContentLoaded",completed);window.removeEventListener("load",completed);jQuery.ready();}
if(document.readyState==="complete"||(document.readyState!=="loading"&&!document.documentElement.doScroll)){window.setTimeout(jQuery.ready);}else{document.addEventListener("DOMContentLoaded",completed);window.addEventListener("load",completed);}
var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=key==null;if(toType(key)==="object"){chainable=true;for(i in key){access(elems,fn,i,key[i],true,emptyGet,raw);}}else if(value!==undefined){chainable=true;if(!isFunction(value)){raw=true;}
if(bulk){if(raw){fn.call(elems,value);fn=null;}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value);};}}
if(fn){for(;i<len;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));}}}
if(chainable){return elems;}
if(bulk){return fn.call(elems);}
return len?fn(elems[0],key):emptyGet;};var rmsPrefix=/^-ms-/,rdashAlpha=/-([a-z])/g;function fcamelCase(all,letter){return letter.toUpperCase();}
function camelCase(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase);}
var acceptData=function(owner){return owner.nodeType===1||owner.nodeType===9||!(+owner.nodeType);};function Data(){this.expando=jQuery.expando+Data.uid++;}
Data.uid=1;Data.prototype={cache:function(owner){var value=owner[this.expando];if(!value){value={};if(acceptData(owner)){if(owner.nodeType){owner[this.expando]=value;}else{Object.defineProperty(owner,this.expando,{value:value,configurable:true});}}}
return value;},set:function(owner,data,value){var prop,cache=this.cache(owner);if(typeof data==="string"){cache[camelCase(data)]=value;}else{for(prop in data){cache[camelCase(prop)]=data[prop];}}
return cache;},get:function(owner,key){return key===undefined?this.cache(owner):owner[this.expando]&&owner[this.expando][camelCase(key)];},access:function(owner,key,value){if(key===undefined||((key&&typeof key==="string")&&value===undefined)){return this.get(owner,key);}
this.set(owner,key,value);return value!==undefined?value:key;},remove:function(owner,key){var i,cache=owner[this.expando];if(cache===undefined){return;}
if(key!==undefined){if(Array.isArray(key)){key=key.map(camelCase);}else{key=camelCase(key);key=key in cache?[key]:(key.match(rnothtmlwhite)||[]);}
i=key.length;while(i--){delete cache[key[i]];}}
if(key===undefined||jQuery.isEmptyObject(cache)){if(owner.nodeType){owner[this.expando]=undefined;}else{delete owner[this.expando];}}},hasData:function(owner){var cache=owner[this.expando];return cache!==undefined&&!jQuery.isEmptyObject(cache);}};var dataPriv=new Data();var dataUser=new Data();var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function getData(data){if(data==="true"){return true;}
if(data==="false"){return false;}
if(data==="null"){return null;}
if(data===+data+""){return+data;}
if(rbrace.test(data)){return JSON.parse(data);}
return data;}
function dataAttr(elem,key,data){var name;if(data===undefined&&elem.nodeType===1){name="data-"+key.replace(rmultiDash,"-$&").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=getData(data);}catch(e){}
dataUser.set(elem,key,data);}else{data=undefined;}}
return data;}
jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem);},data:function(elem,name,data){return dataUser.access(elem,name,data);},removeData:function(elem,name){dataUser.remove(elem,name);},_data:function(elem,name,data){return dataPriv.access(elem,name,data);},_removeData:function(elem,name){dataPriv.remove(elem,name);}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=dataUser.get(elem);if(elem.nodeType===1&&!dataPriv.get(elem,"hasDataAttrs")){i=attrs.length;while(i--){if(attrs[i]){name=attrs[i].name;if(name.indexOf("data-")===0){name=camelCase(name.slice(5));dataAttr(elem,name,data[name]);}}}
dataPriv.set(elem,"hasDataAttrs",true);}}
return data;}
if(typeof key==="object"){return this.each(function(){dataUser.set(this,key);});}
return access(this,function(value){var data;if(elem&&value===undefined){data=dataUser.get(elem,key);if(data!==undefined){return data;}
data=dataAttr(elem,key);if(data!==undefined){return data;}
return;}
this.each(function(){dataUser.set(this,key,value);});},null,value,arguments.length>1,null,true);},removeData:function(key){return this.each(function(){dataUser.remove(this,key);});}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=dataPriv.get(elem,type);if(data){if(!queue||Array.isArray(data)){queue=dataPriv.access(elem,type,jQuery.makeArray(data));}else{queue.push(data);}}
return queue||[];}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type);};if(fn==="inprogress"){fn=queue.shift();startLength--;}
if(fn){if(type==="fx"){queue.unshift("inprogress");}
delete hooks.stop;fn.call(elem,next,hooks);}
if(!startLength&&hooks){hooks.empty.fire();}},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key]);})});}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--;}
if(arguments.length<setter){return jQuery.queue(this[0],type);}
return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type);}});},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type);});},clearQueue:function(type){return this.queue(type||"fx",[]);},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!(--count)){defer.resolveWith(elements,[elements]);}};if(typeof type!=="string"){obj=type;type=undefined;}
type=type||"fx";while(i--){tmp=dataPriv.get(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve);}}
resolve();return defer.promise(obj);}});var pnum=(/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/).source;var rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i");var cssExpand=["Top","Right","Bottom","Left"];var documentElement=document.documentElement;var isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem);},composed={composed:true};if(documentElement.attachShadow){isAttached=function(elem){return jQuery.contains(elem.ownerDocument,elem)||elem.getRootNode(composed)===elem.ownerDocument;};}
var isHiddenWithinTree=function(elem,el){elem=el||elem;return elem.style.display==="none"||elem.style.display===""&&isAttached(elem)&&jQuery.css(elem,"display")==="none";};var swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name];}
ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name];}
return ret;};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale,maxIterations=20,currentValue=tween?function(){return tween.cur();}:function(){return jQuery.css(elem,prop,"");},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=elem.nodeType&&(jQuery.cssNumber[prop]||unit!=="px"&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){initial=initial/2;unit=unit||initialInUnit[3];initialInUnit=+initial||1;while(maxIterations--){jQuery.style(elem,prop,initialInUnit+unit);if((1-scale)*(1-(scale=currentValue()/initial||0.5))<=0){maxIterations=0;}
initialInUnit=initialInUnit/scale;}
initialInUnit=initialInUnit*2;jQuery.style(elem,prop,initialInUnit+unit);valueParts=valueParts||[];}
if(valueParts){initialInUnit=+initialInUnit||+initial||0;adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2];if(tween){tween.unit=unit;tween.start=initialInUnit;tween.end=adjusted;}}
return adjusted;}
var defaultDisplayMap={};function getDefaultDisplay(elem){var temp,doc=elem.ownerDocument,nodeName=elem.nodeName,display=defaultDisplayMap[nodeName];if(display){return display;}
temp=doc.body.appendChild(doc.createElement(nodeName));display=jQuery.css(temp,"display");temp.parentNode.removeChild(temp);if(display==="none"){display="block";}
defaultDisplayMap[nodeName]=display;return display;}
function showHide(elements,show){var display,elem,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue;}
display=elem.style.display;if(show){if(display==="none"){values[index]=dataPriv.get(elem,"display")||null;if(!values[index]){elem.style.display="";}}
if(elem.style.display===""&&isHiddenWithinTree(elem)){values[index]=getDefaultDisplay(elem);}}else{if(display!=="none"){values[index]="none";dataPriv.set(elem,"display",display);}}}
for(index=0;index<length;index++){if(values[index]!=null){elements[index].style.display=values[index];}}
return elements;}
jQuery.fn.extend({show:function(){return showHide(this,true);},hide:function(){return showHide(this);},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide();}
return this.each(function(){if(isHiddenWithinTree(this)){jQuery(this).show();}else{jQuery(this).hide();}});}});var rcheckableType=(/^(?:checkbox|radio)$/i);var rtagName=(/<([a-z][^\/\0>\x20\t\r\n\f]*)/i);var rscriptType=(/^$|^module$|\/(?:java|ecma)script/i);var wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var ret;if(typeof context.getElementsByTagName!=="undefined"){ret=context.getElementsByTagName(tag||"*");}else if(typeof context.querySelectorAll!=="undefined"){ret=context.querySelectorAll(tag||"*");}else{ret=[];}
if(tag===undefined||tag&&nodeName(context,tag)){return jQuery.merge([context],ret);}
return ret;}
function setGlobalEval(elems,refElements){var i=0,l=elems.length;for(;i<l;i++){dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"));}}
var rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){var elem,tmp,tag,wrap,attached,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(toType(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem);}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem));}else{tmp=tmp||fragment.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild;}
jQuery.merge(nodes,tmp.childNodes);tmp=fragment.firstChild;tmp.textContent="";}}}
fragment.textContent="";i=0;while((elem=nodes[i++])){if(selection&&jQuery.inArray(elem,selection)>-1){if(ignored){ignored.push(elem);}
continue;}
attached=isAttached(elem);tmp=getAll(fragment.appendChild(elem),"script");if(attached){setGlobalEval(tmp);}
if(scripts){j=0;while((elem=tmp[j++])){if(rscriptType.test(elem.type||"")){scripts.push(elem);}}}}
return fragment;}
(function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio");input.setAttribute("checked","checked");input.setAttribute("name","t");div.appendChild(input);support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;div.innerHTML="<textarea>x</textarea>";support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue;})();var
rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return true;}
function returnFalse(){return false;}
function expectSync(elem,type){return(elem===safeActiveElement())===(type==="focus");}
function safeActiveElement(){try{return document.activeElement;}catch(err){}}
function on(elem,types,selector,data,fn,one){var origFn,type;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined;}
for(type in types){on(elem,type,selector,data,types[type],one);}
return elem;}
if(data==null&&fn==null){fn=selector;data=selector=undefined;}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined;}else{fn=data;data=selector;selector=undefined;}}
if(fn===false){fn=returnFalse;}else if(!fn){return elem;}
if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments);};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++);}
return elem.each(function(){jQuery.event.add(this,types,fn,data,selector);});}
jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(!elemData){return;}
if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector;}
if(selector){jQuery.find.matchesSelector(documentElement,selector);}
if(!handler.guid){handler.guid=jQuery.guid++;}
if(!(events=elemData.events)){events=elemData.events={};}
if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!=="undefined"&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):undefined;};}
types=(types||"").match(rnothtmlwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle);}}}
if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid;}}
if(selector){handlers.splice(handlers.delegateCount++,0,handleObj);}else{handlers.push(handleObj);}
jQuery.event.global[type]=true;}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(!elemData||!(events=elemData.events)){return;}
types=(types||"").match(rnothtmlwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true);}
continue;}
special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--;}
if(special.remove){special.remove.call(elem,handleObj);}}}
if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle);}
delete events[type];}}
if(jQuery.isEmptyObject(events)){dataPriv.remove(elem,"handle events");}},dispatch:function(nativeEvent){var event=jQuery.event.fix(nativeEvent);var i,j,ret,matched,handleObj,handlerQueue,args=new Array(arguments.length),handlers=(dataPriv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;for(i=1;i<arguments.length;i++){args[i]=arguments[i];}
event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return;}
handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.rnamespace||handleObj.namespace===false||event.rnamespace.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation();}}}}}
if(special.postDispatch){special.postDispatch.call(this,event);}
return event.result;},handlers:function(event,handlers){var i,handleObj,sel,matchedHandlers,matchedSelectors,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&!(event.type==="click"&&event.button>=1)){for(;cur!==this;cur=cur.parentNode||this){if(cur.nodeType===1&&!(event.type==="click"&&cur.disabled===true)){matchedHandlers=[];matchedSelectors={};for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matchedSelectors[sel]===undefined){matchedSelectors[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length;}
if(matchedSelectors[sel]){matchedHandlers.push(handleObj);}}
if(matchedHandlers.length){handlerQueue.push({elem:cur,handlers:matchedHandlers});}}}}
cur=this;if(delegateCount<handlers.length){handlerQueue.push({elem:cur,handlers:handlers.slice(delegateCount)});}
return handlerQueue;},addProp:function(name,hook){Object.defineProperty(jQuery.Event.prototype,name,{enumerable:true,configurable:true,get:isFunction(hook)?function(){if(this.originalEvent){return hook(this.originalEvent);}}:function(){if(this.originalEvent){return this.originalEvent[name];}},set:function(value){Object.defineProperty(this,name,{enumerable:true,configurable:true,writable:true,value:value});}});},fix:function(originalEvent){return originalEvent[jQuery.expando]?originalEvent:new jQuery.Event(originalEvent);},special:{load:{noBubble:true},click:{setup:function(data){var el=this||data;if(rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&dataPriv.get(el,"click")===undefined){leverageNative(el,"click",returnTrue);}
return false;},trigger:function(data){var el=this||data;if(rcheckableType.test(el.type)&&el.click&&nodeName(el,"input")&&dataPriv.get(el,"click")===undefined){leverageNative(el,"click");}
return true;},_default:function(event){var target=event.target;return rcheckableType.test(target.type)&&target.click&&nodeName(target,"input")&&dataPriv.get(target,"click")||nodeName(target,"a");}},beforeunload:{postDispatch:function(event){if(event.result!==undefined&&event.originalEvent){event.originalEvent.returnValue=event.result;}}}}};function leverageNative(el,type,expectSync){if(!expectSync){jQuery.event.add(el,type,returnTrue);return;}
dataPriv.set(el,type,false);jQuery.event.add(el,type,{namespace:false,handler:function(event){var notAsync,result,saved=dataPriv.get(this,type);if((event.isTrigger&1)&&this[type]){if(!saved){saved=slice.call(arguments);dataPriv.set(this,type,saved);notAsync=expectSync(this,type);this[type]();result=dataPriv.get(this,type);if(saved!==result||notAsync){dataPriv.set(this,type,false);}else{result=undefined;}
if(saved!==result){event.stopImmediatePropagation();event.preventDefault();return result;}}else if((jQuery.event.special[type]||{}).delegateType){event.stopPropagation();}}else if(saved){dataPriv.set(this,type,jQuery.event.trigger(jQuery.extend(saved.shift(),jQuery.Event.prototype),saved,this));event.stopImmediatePropagation();}}});}
jQuery.removeEvent=function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle);}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props);}
if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&src.returnValue===false?returnTrue:returnFalse;this.target=(src.target&&src.target.nodeType===3)?src.target.parentNode:src.target;this.currentTarget=src.currentTarget;this.relatedTarget=src.relatedTarget;}else{this.type=src;}
if(props){jQuery.extend(this,props);}
this.timeStamp=src&&src.timeStamp||Date.now();this[jQuery.expando]=true;};jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:false,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(e&&!this.isSimulated){e.preventDefault();}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopPropagation();}},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue;if(e&&!this.isSimulated){e.stopImmediatePropagation();}
this.stopPropagation();}};jQuery.each({altKey:true,bubbles:true,cancelable:true,changedTouches:true,ctrlKey:true,detail:true,eventPhase:true,metaKey:true,pageX:true,pageY:true,shiftKey:true,view:true,"char":true,code:true,charCode:true,key:true,keyCode:true,button:true,buttons:true,clientX:true,clientY:true,offsetX:true,offsetY:true,pointerId:true,pointerType:true,screenX:true,screenY:true,targetTouches:true,toElement:true,touches:true,which:function(event){var button=event.button;if(event.which==null&&rkeyEvent.test(event.type)){return event.charCode!=null?event.charCode:event.keyCode;}
if(!event.which&&button!==undefined&&rmouseEvent.test(event.type)){if(button&1){return 1;}
if(button&2){return 3;}
if(button&4){return 2;}
return 0;}
return event.which;}},jQuery.event.addProp);jQuery.each({focus:"focusin",blur:"focusout"},function(type,delegateType){jQuery.event.special[type]={setup:function(){leverageNative(this,type,expectSync);return false;},trigger:function(){leverageNative(this,type);return true;},delegateType:delegateType};});jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||(related!==target&&!jQuery.contains(target,related))){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix;}
return ret;}};});jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn);},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1);},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this;}
if(typeof types==="object"){for(type in types){this.off(type,selector,types[type]);}
return this;}
if(selector===false||typeof selector==="function"){fn=selector;selector=undefined;}
if(fn===false){fn=returnFalse;}
return this.each(function(){jQuery.event.remove(this,types,fn,selector);});}});var
rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){if(nodeName(elem,"table")&&nodeName(content.nodeType!==11?content:content.firstChild,"tr")){return jQuery(elem).children("tbody")[0]||elem;}
return elem;}
function disableScript(elem){elem.type=(elem.getAttribute("type")!==null)+"/"+elem.type;return elem;}
function restoreScript(elem){if((elem.type||"").slice(0,5)==="true/"){elem.type=elem.type.slice(5);}else{elem.removeAttribute("type");}
return elem;}
function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(dest.nodeType!==1){return;}
if(dataPriv.hasData(src)){pdataOld=dataPriv.access(src);pdataCur=dataPriv.set(dest,pdataOld);events=pdataOld.events;if(events){delete pdataCur.handle;pdataCur.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i]);}}}}
if(dataUser.hasData(src)){udataOld=dataUser.access(src);udataCur=jQuery.extend({},udataOld);dataUser.set(dest,udataCur);}}
function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();if(nodeName==="input"&&rcheckableType.test(src.type)){dest.checked=src.checked;}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue;}}
function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],valueIsFunction=isFunction(value);if(valueIsFunction||(l>1&&typeof value==="string"&&!support.checkClone&&rchecked.test(value))){return collection.each(function(index){var self=collection.eq(index);if(valueIsFunction){args[0]=value.call(this,index,self.html());}
domManip(self,args,callback,ignored);});}
if(l){fragment=buildFragment(args,collection[0].ownerDocument,false,collection,ignored);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first;}
if(first||ignored){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"));}}
callback.call(collection[i],node,i);}
if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src&&(node.type||"").toLowerCase()!=="module"){if(jQuery._evalUrl&&!node.noModule){jQuery._evalUrl(node.src,{nonce:node.nonce||node.getAttribute("nonce")});}}else{DOMEval(node.textContent.replace(rcleanScript,""),node,doc);}}}}}}
return collection;}
function remove(elem,selector,keepData){var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;for(;(node=nodes[i])!=null;i++){if(!keepData&&node.nodeType===1){jQuery.cleanData(getAll(node));}
if(node.parentNode){if(keepData&&isAttached(node)){setGlobalEval(getAll(node,"script"));}
node.parentNode.removeChild(node);}}
return elem;}
jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>");},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(true),inPage=isAttached(elem);if(!support.noCloneChecked&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0,l=srcElements.length;i<l;i++){fixInput(srcElements[i],destElements[i]);}}
if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0,l=srcElements.length;i<l;i++){cloneCopyEvent(srcElements[i],destElements[i]);}}else{cloneCopyEvent(elem,clone);}}
destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"));}
return clone;},cleanData:function(elems){var data,elem,type,special=jQuery.event.special,i=0;for(;(elem=elems[i])!==undefined;i++){if(acceptData(elem)){if((data=elem[dataPriv.expando])){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type);}else{jQuery.removeEvent(elem,type,data.handle);}}}
elem[dataPriv.expando]=undefined;}
if(elem[dataUser.expando]){elem[dataUser.expando]=undefined;}}}}});jQuery.fn.extend({detach:function(selector){return remove(this,selector,true);},remove:function(selector){return remove(this,selector);},text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().each(function(){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){this.textContent=value;}});},null,value,arguments.length);},append:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem);}});},prepend:function(){return domManip(this,arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild);}});},before:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this);}});},after:function(){return domManip(this,arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling);}});},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.textContent="";}}
return this;},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents);});},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&elem.nodeType===1){return elem.innerHTML;}
if(typeof value==="string"&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value;}}
elem=0;}catch(e){}}
if(elem){this.empty().append(value);}},null,value,arguments.length);},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;if(jQuery.inArray(this,ignored)<0){jQuery.cleanData(getAll(this));if(parent){parent.replaceChild(elem,this);}}},ignored);}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get());}
return this.pushStack(ret);};});var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i");var getStyles=function(elem){var view=elem.ownerDocument.defaultView;if(!view||!view.opener){view=window;}
return view.getComputedStyle(elem);};var rboxStyle=new RegExp(cssExpand.join("|"),"i");(function(){function computeStyleTests(){if(!div){return;}
container.style.cssText="position:absolute;left:-11111px;width:60px;"+"margin-top:1px;padding:0;border:0";div.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;"+"margin:auto;border:1px;padding:1px;"+"width:60%;top:1%";documentElement.appendChild(container).appendChild(div);var divStyle=window.getComputedStyle(div);pixelPositionVal=divStyle.top!=="1%";reliableMarginLeftVal=roundPixelMeasures(divStyle.marginLeft)===12;div.style.right="60%";pixelBoxStylesVal=roundPixelMeasures(divStyle.right)===36;boxSizingReliableVal=roundPixelMeasures(divStyle.width)===36;div.style.position="absolute";scrollboxSizeVal=roundPixelMeasures(div.offsetWidth/3)===12;documentElement.removeChild(container);div=null;}
function roundPixelMeasures(measure){return Math.round(parseFloat(measure));}
var pixelPositionVal,boxSizingReliableVal,scrollboxSizeVal,pixelBoxStylesVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");if(!div.style){return;}
div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";jQuery.extend(support,{boxSizingReliable:function(){computeStyleTests();return boxSizingReliableVal;},pixelBoxStyles:function(){computeStyleTests();return pixelBoxStylesVal;},pixelPosition:function(){computeStyleTests();return pixelPositionVal;},reliableMarginLeft:function(){computeStyleTests();return reliableMarginLeftVal;},scrollboxSize:function(){computeStyleTests();return scrollboxSizeVal;}});})();function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);if(computed){ret=computed.getPropertyValue(name)||computed[name];if(ret===""&&!isAttached(elem)){ret=jQuery.style(elem,name);}
if(!support.pixelBoxStyles()&&rnumnonpx.test(ret)&&rboxStyle.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth;}}
return ret!==undefined?ret+"":ret;}
function addGetHookIf(conditionFn,hookFn){return{get:function(){if(conditionFn()){delete this.get;return;}
return(this.get=hookFn).apply(this,arguments);}};}
var cssPrefixes=["Webkit","Moz","ms"],emptyStyle=document.createElement("div").style,vendorProps={};function vendorPropName(name){var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in emptyStyle){return name;}}}
function finalPropName(name){var final=jQuery.cssProps[name]||vendorProps[name];if(final){return final;}
if(name in emptyStyle){return name;}
return vendorProps[name]=vendorPropName(name)||name;}
var
rdisplayswap=/^(none|table(?!-c[ea]).+)/,rcustomProp=/^--/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"};function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value;}
function boxModelAdjustment(elem,dimension,box,isBorderBox,styles,computedVal){var i=dimension==="width"?1:0,extra=0,delta=0;if(box===(isBorderBox?"border":"content")){return 0;}
for(;i<4;i+=2){if(box==="margin"){delta+=jQuery.css(elem,box+cssExpand[i],true,styles);}
if(!isBorderBox){delta+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(box!=="padding"){delta+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}else{extra+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}else{if(box==="content"){delta-=jQuery.css(elem,"padding"+cssExpand[i],true,styles);}
if(box!=="margin"){delta-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles);}}}
if(!isBorderBox&&computedVal>=0){delta+=Math.max(0,Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-
computedVal-
delta-
extra-
0.5))||0;}
return delta;}
function getWidthOrHeight(elem,dimension,extra){var styles=getStyles(elem),boxSizingNeeded=!support.boxSizingReliable()||extra,isBorderBox=boxSizingNeeded&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",valueIsBorderBox=isBorderBox,val=curCSS(elem,dimension,styles),offsetProp="offset"+dimension[0].toUpperCase()+dimension.slice(1);if(rnumnonpx.test(val)){if(!extra){return val;}
val="auto";}
if((!support.boxSizingReliable()&&isBorderBox||val==="auto"||!parseFloat(val)&&jQuery.css(elem,"display",false,styles)==="inline")&&elem.getClientRects().length){isBorderBox=jQuery.css(elem,"boxSizing",false,styles)==="border-box";valueIsBorderBox=offsetProp in elem;if(valueIsBorderBox){val=elem[offsetProp];}}
val=parseFloat(val)||0;return(val+
boxModelAdjustment(elem,dimension,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles,val))+"px";}
jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret;}}}},cssNumber:{"animationIterationCount":true,"columnCount":true,"fillOpacity":true,"flexGrow":true,"flexShrink":true,"fontWeight":true,"gridArea":true,"gridColumn":true,"gridColumnEnd":true,"gridColumnStart":true,"gridRow":true,"gridRowEnd":true,"gridRowStart":true,"lineHeight":true,"opacity":true,"order":true,"orphans":true,"widows":true,"zIndex":true,"zoom":true},cssProps:{},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return;}
var ret,type,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name),style=elem.style;if(!isCustomProp){name=finalPropName(origName);}
hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rcssNum.exec(value))&&ret[1]){value=adjustCSS(elem,name,ret);type="number";}
if(value==null||value!==value){return;}
if(type==="number"&&!isCustomProp){value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px");}
if(!support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit";}
if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){if(isCustomProp){style.setProperty(name,value);}else{style[name]=value;}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret;}
return style[name];}},css:function(elem,name,extra,styles){var val,num,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name);if(!isCustomProp){name=finalPropName(origName);}
hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra);}
if(val===undefined){val=curCSS(elem,name,styles);}
if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name];}
if(extra===""||extra){num=parseFloat(val);return extra===true||isFinite(num)?num||0:val;}
return val;}});jQuery.each(["height","width"],function(i,dimension){jQuery.cssHooks[dimension]={get:function(elem,computed,extra){if(computed){return rdisplayswap.test(jQuery.css(elem,"display"))&&(!elem.getClientRects().length||!elem.getBoundingClientRect().width)?swap(elem,cssShow,function(){return getWidthOrHeight(elem,dimension,extra);}):getWidthOrHeight(elem,dimension,extra);}},set:function(elem,value,extra){var matches,styles=getStyles(elem),scrollboxSizeBuggy=!support.scrollboxSize()&&styles.position==="absolute",boxSizingNeeded=scrollboxSizeBuggy||extra,isBorderBox=boxSizingNeeded&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",subtract=extra?boxModelAdjustment(elem,dimension,extra,isBorderBox,styles):0;if(isBorderBox&&scrollboxSizeBuggy){subtract-=Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-
parseFloat(styles[dimension])-
boxModelAdjustment(elem,dimension,"border",false,styles)-
0.5);}
if(subtract&&(matches=rcssNum.exec(value))&&(matches[3]||"px")!=="px"){elem.style[dimension]=value;value=jQuery.css(elem,dimension);}
return setPositiveNumber(elem,value,subtract);}};});jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed){return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-
swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left;}))+"px";}});jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];}
return expanded;}};if(prefix!=="margin"){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber;}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(Array.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles);}
return map;}
return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name);},name,value,arguments.length>1);}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing);}
jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||jQuery.easing._default;this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px");},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this);},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration);}else{this.pos=eased=percent;}
this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this);}
if(hooks&&hooks.set){hooks.set(this);}else{Tween.propHooks._default.set(this);}
return this;}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem.nodeType!==1||tween.elem[tween.prop]!=null&&tween.elem.style[tween.prop]==null){return tween.elem[tween.prop];}
result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result;},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween);}else if(tween.elem.nodeType===1&&(jQuery.cssHooks[tween.prop]||tween.elem.style[finalPropName(tween.prop)]!=null)){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit);}else{tween.elem[tween.prop]=tween.now;}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now;}}};jQuery.easing={linear:function(p){return p;},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2;},_default:"swing"};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var
fxNow,inProgress,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function schedule(){if(inProgress){if(document.hidden===false&&window.requestAnimationFrame){window.requestAnimationFrame(schedule);}else{window.setTimeout(schedule,jQuery.fx.interval);}
jQuery.fx.tick();}}
function createFxNow(){window.setTimeout(function(){fxNow=undefined;});return(fxNow=Date.now());}
function genFx(type,includeWidth){var which,i=0,attrs={height:type};includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type;}
if(includeWidth){attrs.opacity=attrs.width=type;}
return attrs;}
function createTween(value,prop,animation){var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if((tween=collection[index].call(animation,prop,value))){return tween;}}}
function defaultPrefilter(elem,props,opts){var prop,value,toggle,hooks,oldfire,propTween,restoreDisplay,display,isBox="width"in props||"height"in props,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHiddenWithinTree(elem),dataShow=dataPriv.get(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire();}};}
hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire();}});});}
for(prop in props){value=props[prop];if(rfxtypes.test(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){if(value==="show"&&dataShow&&dataShow[prop]!==undefined){hidden=true;}else{continue;}}
orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop);}}
propTween=!jQuery.isEmptyObject(props);if(!propTween&&jQuery.isEmptyObject(orig)){return;}
if(isBox&&elem.nodeType===1){opts.overflow=[style.overflow,style.overflowX,style.overflowY];restoreDisplay=dataShow&&dataShow.display;if(restoreDisplay==null){restoreDisplay=dataPriv.get(elem,"display");}
display=jQuery.css(elem,"display");if(display==="none"){if(restoreDisplay){display=restoreDisplay;}else{showHide([elem],true);restoreDisplay=elem.style.display||restoreDisplay;display=jQuery.css(elem,"display");showHide([elem]);}}
if(display==="inline"||display==="inline-block"&&restoreDisplay!=null){if(jQuery.css(elem,"float")==="none"){if(!propTween){anim.done(function(){style.display=restoreDisplay;});if(restoreDisplay==null){display=style.display;restoreDisplay=display==="none"?"":display;}}
style.display="inline-block";}}}
if(opts.overflow){style.overflow="hidden";anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2];});}
propTween=false;for(prop in orig){if(!propTween){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden;}}else{dataShow=dataPriv.access(elem,"fxshow",{display:restoreDisplay});}
if(toggle){dataShow.hidden=!hidden;}
if(hidden){showHide([elem],true);}
anim.done(function(){if(!hidden){showHide([elem]);}
dataPriv.remove(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop]);}});}
propTween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=propTween.start;if(hidden){propTween.end=propTween.start;propTween.start=0;}}}}
function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=camelCase(index);easing=specialEasing[name];value=props[index];if(Array.isArray(value)){easing=value[1];value=props[index]=value[0];}
if(index!==name){props[name]=value;delete props[index];}
hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing;}}}else{specialEasing[name]=easing;}}}
function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem;}),tick=function(){if(stopped){return false;}
var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent);}
deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining;}
if(!length){deferred.notifyWith(elem,[animation,1,0]);}
deferred.resolveWith(elem,[animation]);return false;},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween;},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this;}
stopped=true;for(;index<length;index++){animation.tweens[index].run(1);}
if(gotoEnd){deferred.notifyWith(elem,[animation,1,0]);deferred.resolveWith(elem,[animation,gotoEnd]);}else{deferred.rejectWith(elem,[animation,gotoEnd]);}
return this;}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=Animation.prefilters[index].call(animation,elem,props,animation.opts);if(result){if(isFunction(result.stop)){jQuery._queueHooks(animation.elem,animation.opts.queue).stop=result.stop.bind(result);}
return result;}}
jQuery.map(props,createTween,animation);if(isFunction(animation.opts.start)){animation.opts.start.call(elem,animation);}
animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always);jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation;}
jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);adjustCSS(tween.elem,prop,rcssNum.exec(value),tween);return tween;}]},tweener:function(props,callback){if(isFunction(props)){callback=props;props=["*"];}else{props=props.match(rnothtmlwhite);}
var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];Animation.tweeners[prop]=Animation.tweeners[prop]||[];Animation.tweeners[prop].unshift(callback);}},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){if(prepend){Animation.prefilters.unshift(callback);}else{Animation.prefilters.push(callback);}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!isFunction(easing)&&easing};if(jQuery.fx.off){opt.duration=0;}else{if(typeof opt.duration!=="number"){if(opt.duration in jQuery.fx.speeds){opt.duration=jQuery.fx.speeds[opt.duration];}else{opt.duration=jQuery.fx.speeds._default;}}}
if(opt.queue==null||opt.queue===true){opt.queue="fx";}
opt.old=opt.complete;opt.complete=function(){if(isFunction(opt.old)){opt.old.call(this);}
if(opt.queue){jQuery.dequeue(this,opt.queue);}};return opt;};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHiddenWithinTree).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback);},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||dataPriv.get(this,"finish")){anim.stop(true);}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation);},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd);};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined;}
if(clearQueue&&type!==false){this.queue(type||"fx",[]);}
return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index]);}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index]);}}}
for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1);}}
if(dequeue||!gotoEnd){jQuery.dequeue(this,type);}});},finish:function(type){if(type!==false){type=type||"fx";}
return this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true);}
for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1);}}
for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this);}}
delete data.finish;});}});jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback);};});jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback);};});jQuery.timers=[];jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;fxNow=Date.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1);}}
if(!timers.length){jQuery.fx.stop();}
fxNow=undefined;};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);jQuery.fx.start();};jQuery.fx.interval=13;jQuery.fx.start=function(){if(inProgress){return;}
inProgress=true;schedule();};jQuery.fx.stop=function(){inProgress=null;};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout);};});};(function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox";support.checkOn=input.value!=="";support.optSelected=opt.selected;input=document.createElement("input");input.value="t";input.type="radio";support.radioValue=input.value==="t";})();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1);},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name);});}});jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return;}
if(typeof elem.getAttribute==="undefined"){return jQuery.prop(elem,name,value);}
if(nType!==1||!jQuery.isXMLDoc(elem)){hooks=jQuery.attrHooks[name.toLowerCase()]||(jQuery.expr.match.bool.test(name)?boolHook:undefined);}
if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name);return;}
if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}
elem.setAttribute(name,value+"");return value;}
if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}
ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret;},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==="radio"&&nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val;}
return value;}}}},removeAttr:function(elem,value){var name,i=0,attrNames=value&&value.match(rnothtmlwhite);if(attrNames&&elem.nodeType===1){while((name=attrNames[i++])){elem.removeAttribute(name);}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name);}else{elem.setAttribute(name,name);}
return name;}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle,lowercaseName=name.toLowerCase();if(!isXML){handle=attrHandle[lowercaseName];attrHandle[lowercaseName]=ret;ret=getter(elem,name,isXML)!=null?lowercaseName:null;attrHandle[lowercaseName]=handle;}
return ret;};});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1);},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name];});}});jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(nType===3||nType===8||nType===2){return;}
if(nType!==1||!jQuery.isXMLDoc(elem)){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name];}
if(value!==undefined){if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret;}
return(elem[name]=value);}
if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret;}
return elem[name];},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");if(tabindex){return parseInt(tabindex,10);}
if(rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href){return 0;}
return-1;}}},propFix:{"for":"htmlFor","class":"className"}});if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent&&parent.parentNode){parent.parentNode.selectedIndex;}
return null;},set:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex;}}}};}
jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this;});function stripAndCollapse(value){var tokens=value.match(rnothtmlwhite)||[];return tokens.join(" ");}
function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||"";}
function classesToArray(value){if(Array.isArray(value)){return value;}
if(typeof value==="string"){return value.match(rnothtmlwhite)||[];}
return[];}
jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)));});}
classes=classesToArray(value);if(classes.length){while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+stripAndCollapse(curValue)+" ");if(cur){j=0;while((clazz=classes[j++])){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" ";}}
finalValue=stripAndCollapse(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue);}}}}
return this;},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)));});}
if(!arguments.length){return this.attr("class","");}
classes=classesToArray(value);if(classes.length){while((elem=this[i++])){curValue=getClass(elem);cur=elem.nodeType===1&&(" "+stripAndCollapse(curValue)+" ");if(cur){j=0;while((clazz=classes[j++])){while(cur.indexOf(" "+clazz+" ")>-1){cur=cur.replace(" "+clazz+" "," ");}}
finalValue=stripAndCollapse(cur);if(curValue!==finalValue){elem.setAttribute("class",finalValue);}}}}
return this;},toggleClass:function(value,stateVal){var type=typeof value,isValidValue=type==="string"||Array.isArray(value);if(typeof stateVal==="boolean"&&isValidValue){return stateVal?this.addClass(value):this.removeClass(value);}
if(isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal);});}
return this.each(function(){var className,i,self,classNames;if(isValidValue){i=0;self=jQuery(this);classNames=classesToArray(value);while((className=classNames[i++])){if(self.hasClass(className)){self.removeClass(className);}else{self.addClass(className);}}}else if(value===undefined||type==="boolean"){className=getClass(this);if(className){dataPriv.set(this,"__className__",className);}
if(this.setAttribute){this.setAttribute("class",className||value===false?"":dataPriv.get(this,"__className__")||"");}}});},hasClass:function(selector){var className,elem,i=0;className=" "+selector+" ";while((elem=this[i++])){if(elem.nodeType===1&&(" "+stripAndCollapse(getClass(elem))+" ").indexOf(className)>-1){return true;}}
return false;}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,valueIsFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret;}
ret=elem.value;if(typeof ret==="string"){return ret.replace(rreturn,"");}
return ret==null?"":ret;}
return;}
valueIsFunction=isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return;}
if(valueIsFunction){val=value.call(this,i,jQuery(this).val());}else{val=value;}
if(val==null){val="";}else if(typeof val==="number"){val+="";}else if(Array.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+"";});}
hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val;}});}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:stripAndCollapse(jQuery.text(elem));}},select:{get:function(elem){var value,option,i,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one",values=one?null:[],max=one?index+1:options.length;if(index<0){i=max;}else{i=one?index:0;}
for(;i<max;i++){option=options[i];if((option.selected||i===index)&&!option.disabled&&(!option.parentNode.disabled||!nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value;}
values.push(value);}}
return values;},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1){optionSet=true;}}
if(!optionSet){elem.selectedIndex=-1;}
return values;}}}});jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(Array.isArray(value)){return(elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1);}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value;};}});support.focusin="onfocusin"in window;var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,stopPropagationCallback=function(e){e.stopPropagation();};jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,lastElement,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=lastElement=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return;}
if(rfocusMorph.test(type+jQuery.event.triggered)){return;}
if(type.indexOf(".")>-1){namespaces=type.split(".");type=namespaces.shift();namespaces.sort();}
ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem;}
data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return;}
if(!onlyHandlers&&!special.noBubble&&!isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode;}
for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur;}
if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window);}}
i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){lastElement=cur;event.type=i>1?bubbleType:special.bindType||type;handle=(dataPriv.get(cur,"events")||{})[event.type]&&dataPriv.get(cur,"handle");if(handle){handle.apply(cur,data);}
handle=ontype&&cur[ontype];if(handle&&handle.apply&&acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault();}}}
event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&acceptData(elem)){if(ontype&&isFunction(elem[type])&&!isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null;}
jQuery.event.triggered=type;if(event.isPropagationStopped()){lastElement.addEventListener(type,stopPropagationCallback);}
elem[type]();if(event.isPropagationStopped()){lastElement.removeEventListener(type,stopPropagationCallback);}
jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp;}}}}
return event.result;},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event(),event,{type:type,isSimulated:true});jQuery.event.trigger(e,null,elem);}});jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this);});},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true);}}});if(!support.focusin){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event));};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true);}
dataPriv.access(doc,fix,(attaches||0)+1);},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);dataPriv.remove(doc,fix);}else{dataPriv.access(doc,fix,attaches);}}};});}
var location=window.location;var nonce=Date.now();var rquery=(/\?/);jQuery.parseXML=function(data){var xml;if(!data||typeof data!=="string"){return null;}
try{xml=(new window.DOMParser()).parseFromString(data,"text/xml");}catch(e){xml=undefined;}
if(!xml||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data);}
return xml;};var
rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(Array.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v);}else{buildParams(prefix+"["+(typeof v==="object"&&v!=null?i:"")+"]",v,traditional,add);}});}else if(!traditional&&toType(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add);}}else{add(prefix,obj);}}
jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,valueOrFunction){var value=isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+"="+
encodeURIComponent(value==null?"":value);};if(a==null){return"";}
if(Array.isArray(a)||(a.jquery&&!jQuery.isPlainObject(a))){jQuery.each(a,function(){add(this.name,this.value);});}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add);}}
return s.join("&");};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray());},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this;}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type));}).map(function(i,elem){var val=jQuery(this).val();if(val==null){return null;}
if(Array.isArray(val)){return jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")};});}
return{name:elem.name,value:val.replace(rCRLF,"\r\n")};}).get();}});var
r20=/%20/g,rhash=/#.*$/,rantiCache=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");originAnchor.href=location.href;function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*";}
var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(isFunction(func)){while((dataType=dataTypes[i++])){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func);}else{(structure[dataType]=structure[dataType]||[]).push(func);}}}};}
function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=(structure===transports);function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false;}else if(seekingTransport){return!(selected=dataTypeOrTransport);}});return selected;}
return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*");}
function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:(deep||(deep={})))[key]=src[key];}}
if(deep){jQuery.extend(true,target,deep);}
return target;}
function ajaxHandleResponses(s,jqXHR,responses){var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type");}}
if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break;}}}
if(dataTypes[0]in responses){finalDataType=dataTypes[0];}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break;}
if(!firstDataType){firstDataType=type;}}
finalDataType=finalDataType||firstDataType;}
if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType);}
return responses[finalDataType];}}
function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv];}}
current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response;}
if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType);}
prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev;}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2];}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1]);}
break;}}}}
if(conv!==true){if(conv&&s.throws){response=conv(response);}else{try{response=conv(response);}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current};}}}}}}
return{state:"success",data:response};}
jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:rlocalProtocol.test(location.protocol),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":JSON.parse,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target);},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined;}
options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,fireGlobals,i,uncached,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(completed){if(!responseHeaders){responseHeaders={};while((match=rheaders.exec(responseHeadersString))){responseHeaders[match[1].toLowerCase()+" "]=(responseHeaders[match[1].toLowerCase()+" "]||[]).concat(match[2]);}}
match=responseHeaders[key.toLowerCase()+" "];}
return match==null?null:match.join(", ");},getAllResponseHeaders:function(){return completed?responseHeadersString:null;},setRequestHeader:function(name,value){if(completed==null){name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name;requestHeaders[name]=value;}
return this;},overrideMimeType:function(type){if(completed==null){s.mimeType=type;}
return this;},statusCode:function(map){var code;if(map){if(completed){jqXHR.always(map[jqXHR.status]);}else{for(code in map){statusCode[code]=[statusCode[code],map[code]];}}}
return this;},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText);}
done(0,finalText);return this;}};deferred.promise(jqXHR);s.url=((url||s.url||location.href)+"").replace(rprotocol,location.protocol+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=(s.dataType||"*").toLowerCase().match(rnothtmlwhite)||[""];if(s.crossDomain==null){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url;urlAnchor.href=urlAnchor.href;s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!==urlAnchor.protocol+"//"+urlAnchor.host;}catch(e){s.crossDomain=true;}}
if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional);}
inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(completed){return jqXHR;}
fireGlobals=jQuery.event&&s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart");}
s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url.replace(rhash,"");if(!s.hasContent){uncached=s.url.slice(cacheURL.length);if(s.data&&(s.processData||typeof s.data==="string")){cacheURL+=(rquery.test(cacheURL)?"&":"?")+s.data;delete s.data;}
if(s.cache===false){cacheURL=cacheURL.replace(rantiCache,"$1");uncached=(rquery.test(cacheURL)?"&":"?")+"_="+(nonce++)+uncached;}
s.url=cacheURL+uncached;}else if(s.data&&s.processData&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0){s.data=s.data.replace(r20,"+");}
if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]);}
if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL]);}}
if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType);}
jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+
(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i]);}
if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||completed)){return jqXHR.abort();}
strAbort="abort";completeDeferred.add(s.complete);jqXHR.done(s.success);jqXHR.fail(s.error);transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport");}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s]);}
if(completed){return jqXHR;}
if(s.async&&s.timeout>0){timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout");},s.timeout);}
try{completed=false;transport.send(requestHeaders,done);}catch(e){if(completed){throw e;}
done(-1,e);}}
function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(completed){return;}
completed=true;if(timeoutTimer){window.clearTimeout(timeoutTimer);}
transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses);}
response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified;}
modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified;}}
if(status===204||s.type==="HEAD"){statusText="nocontent";}else if(status===304){statusText="notmodified";}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error;}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0;}}}
jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR]);}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error]);}
jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]);}
completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!(--jQuery.active)){jQuery.event.trigger("ajaxStop");}}}
return jqXHR;},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json");},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script");}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(isFunction(data)){type=type||callback;callback=data;data=undefined;}
return jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url));};});jQuery._evalUrl=function(url,options){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:true,async:false,global:false,converters:{"text script":function(){}},dataFilter:function(response){jQuery.globalEval(response,options);}});};jQuery.fn.extend({wrapAll:function(html){var wrap;if(this[0]){if(isFunction(html)){html=html.call(this[0]);}
wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0]);}
wrap.map(function(){var elem=this;while(elem.firstElementChild){elem=elem.firstElementChild;}
return elem;}).append(this);}
return this;},wrapInner:function(html){if(isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i));});}
return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html);}else{self.append(html);}});},wrap:function(html){var htmlIsFunction=isFunction(html);return this.each(function(i){jQuery(this).wrapAll(htmlIsFunction?html.call(this,i):html);});},unwrap:function(selector){this.parent(selector).not("body").each(function(){jQuery(this).replaceWith(this.childNodes);});return this;}});jQuery.expr.pseudos.hidden=function(elem){return!jQuery.expr.pseudos.visible(elem);};jQuery.expr.pseudos.visible=function(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length);};jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest();}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&("withCredentials"in xhrSupported);support.ajax=xhrSupported=!!xhrSupported;jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain){return{send:function(headers,complete){var i,xhr=options.xhr();xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i];}}
if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType);}
if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest";}
for(i in headers){xhr.setRequestHeader(i,headers[i]);}
callback=function(type){return function(){if(callback){callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.ontimeout=xhr.onreadystatechange=null;if(type==="abort"){xhr.abort();}else if(type==="error"){if(typeof xhr.status!=="number"){complete(0,"error");}else{complete(xhr.status,xhr.statusText);}}else{complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,(xhr.responseType||"text")!=="text"||typeof xhr.responseText!=="string"?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders());}}};};xhr.onload=callback();errorCallback=xhr.onerror=xhr.ontimeout=callback("error");if(xhr.onabort!==undefined){xhr.onabort=errorCallback;}else{xhr.onreadystatechange=function(){if(xhr.readyState===4){window.setTimeout(function(){if(callback){errorCallback();}});}};}
callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null);}catch(e){if(callback){throw e;}}},abort:function(){if(callback){callback();}}};}});jQuery.ajaxPrefilter(function(s){if(s.crossDomain){s.contents.script=false;}});jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, "+"application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){jQuery.globalEval(text);return text;}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false;}
if(s.crossDomain){s.type="GET";}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain||s.scriptAttrs){var script,callback;return{send:function(_,complete){script=jQuery("<script>").attr(s.scriptAttrs||{}).prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove();callback=null;if(evt){complete(evt.type==="error"?404:200,evt.type);}});document.head.appendChild(script[0]);},abort:function(){if(callback){callback();}}};}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||(jQuery.expando+"_"+(nonce++));this[callback]=true;return callback;}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&(s.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName);}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName;}
s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called");}
return responseContainer[0];};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments;};jqXHR.always(function(){if(overwritten===undefined){jQuery(window).removeProp(callbackName);}else{window[callbackName]=overwritten;}
if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName);}
if(responseContainer&&isFunction(overwritten)){overwritten(responseContainer[0]);}
responseContainer=overwritten=undefined;});return"script";}});support.createHTMLDocument=(function(){var body=document.implementation.createHTMLDocument("").body;body.innerHTML="<form></form><form></form>";return body.childNodes.length===2;})();jQuery.parseHTML=function(data,context,keepScripts){if(typeof data!=="string"){return[];}
if(typeof context==="boolean"){keepScripts=context;context=false;}
var base,parsed,scripts;if(!context){if(support.createHTMLDocument){context=document.implementation.createHTMLDocument("");base=context.createElement("base");base.href=document.location.href;context.head.appendChild(base);}else{context=document;}}
parsed=rsingleTag.exec(data);scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])];}
parsed=buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove();}
return jQuery.merge([],parsed.childNodes);};jQuery.fn.load=function(url,params,callback){var selector,type,response,self=this,off=url.indexOf(" ");if(off>-1){selector=stripAndCollapse(url.slice(off));url=url.slice(0,off);}
if(isFunction(params)){callback=params;params=undefined;}else if(params&&typeof params==="object"){type="POST";}
if(self.length>0){jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText);}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR]);});});}
return this;};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn);};});jQuery.expr.pseudos.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem;}).length;};jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};if(position==="static"){elem.style.position="relative";}
curOffset=curElem.offset();curCSSTop=jQuery.css(elem,"top");curCSSLeft=jQuery.css(elem,"left");calculatePosition=(position==="absolute"||position==="fixed")&&(curCSSTop+curCSSLeft).indexOf("auto")>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left;}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0;}
if(isFunction(options)){options=options.call(elem,i,jQuery.extend({},curOffset));}
if(options.top!=null){props.top=(options.top-curOffset.top)+curTop;}
if(options.left!=null){props.left=(options.left-curOffset.left)+curLeft;}
if("using"in options){options.using.call(elem,props);}else{curElem.css(props);}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i);});}
var rect,win,elem=this[0];if(!elem){return;}
if(!elem.getClientRects().length){return{top:0,left:0};}
rect=elem.getBoundingClientRect();win=elem.ownerDocument.defaultView;return{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset};},position:function(){if(!this[0]){return;}
var offsetParent,offset,doc,elem=this[0],parentOffset={top:0,left:0};if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect();}else{offset=this.offset();doc=elem.ownerDocument;offsetParent=elem.offsetParent||doc.documentElement;while(offsetParent&&(offsetParent===doc.body||offsetParent===doc.documentElement)&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.parentNode;}
if(offsetParent&&offsetParent!==elem&&offsetParent.nodeType===1){parentOffset=jQuery(offsetParent).offset();parentOffset.top+=jQuery.css(offsetParent,"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent,"borderLeftWidth",true);}}
return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)};},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent;while(offsetParent&&jQuery.css(offsetParent,"position")==="static"){offsetParent=offsetParent.offsetParent;}
return offsetParent||documentElement;});}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win;if(isWindow(elem)){win=elem;}else if(elem.nodeType===9){win=elem.defaultView;}
if(val===undefined){return win?win[prop]:elem[method];}
if(win){win.scrollTo(!top?val:win.pageXOffset,top?val:win.pageYOffset);}else{elem[method]=val;}},method,val,arguments.length);};});jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed;}});});jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return access(this,function(elem,type,value){var doc;if(isWindow(elem)){return funcName.indexOf("outer")===0?elem["inner"+name]:elem.document.documentElement["client"+name];}
if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name]);}
return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra);},type,chainable?margin:undefined,chainable);};});});jQuery.each(("blur focus focusin focusout resize scroll click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name);};});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver);}});jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn);},unbind:function(types,fn){return this.off(types,null,fn);},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn);},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn);}});jQuery.proxy=function(fn,context){var tmp,args,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}
if(!isFunction(fn)){return undefined;}
args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy;};jQuery.holdReady=function(hold){if(hold){jQuery.readyWait++;}else{jQuery.ready(true);}};jQuery.isArray=Array.isArray;jQuery.parseJSON=JSON.parse;jQuery.nodeName=nodeName;jQuery.isFunction=isFunction;jQuery.isWindow=isWindow;jQuery.camelCase=camelCase;jQuery.type=toType;jQuery.now=Date.now;jQuery.isNumeric=function(obj){var type=jQuery.type(obj);return(type==="number"||type==="string")&&!isNaN(obj-parseFloat(obj));};if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery;});}
var
_jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$;}
if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery;}
return jQuery;};if(!noGlobal){window.jQuery=window.$=jQuery;}
return jQuery;});
(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var
push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj;};if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=_;}
exports._=_;}else{root._=_;}
_.VERSION='1.5.2';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,length=obj.length;i<length;i++){if(iterator.call(context,obj[i],i,obj)===breaker)return;}}else{var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;}}};_.map=_.collect=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list));});return results;};var reduceError='Reduce of empty array with no initial value';_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length;}
each(obj,function(value,index,list){index=keys?keys[--length]:--length;if(!initial){memo=obj[index];initial=true;}else{memo=iterator.call(context,memo,obj[index],index,list);}});if(!initial)throw new TypeError(reduceError);return memo;};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results.push(value);});return results;};_.reject=function(obj,iterator,context){return _.filter(obj,function(value,index,list){return!iterator.call(context,value,index,list);},context);};_.every=_.all=function(obj,iterator,context){iterator||(iterator=_.identity);var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return!!result;};var any=_.some=_.any=function(obj,iterator,context){iterator||(iterator=_.identity);var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result||(result=iterator.call(context,value,index,list)))return breaker;});return!!result;};_.contains=_.include=function(obj,target){if(obj==null)return false;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;return any(obj,function(value){return value===target;});};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.where=function(obj,attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return _[first?'find':'filter'](obj,function(value){for(var key in attrs){if(attrs[key]!==value[key])return false;}
return true;});};_.findWhere=function(obj,attrs){return _.where(obj,attrs,true);};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.max.apply(Math,obj);}
if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity,value:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535){return Math.min.apply(Math,obj);}
if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity,value:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var rand;var index=0;var shuffled=[];each(obj,function(value){rand=_.random(index++);shuffled[index-1]=shuffled[rand];shuffled[rand]=value;});return shuffled;};_.sample=function(obj,n,guard){if(arguments.length<2||guard){return obj[_.random(obj.length-1)];}
return _.shuffle(obj).slice(0,Math.max(0,n));};var lookupIterator=function(value){return _.isFunction(value)?value:function(obj){return obj[value];};};_.sortBy=function(obj,value,context){var iterator=lookupIterator(value);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1;}
return left.index-right.index;}),'value');};var group=function(behavior){return function(obj,value,context){var result={};var iterator=value==null?_.identity:lookupIterator(value);each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value);});return result;};};_.groupBy=group(function(result,key,value){(_.has(result,key)?result[key]:(result[key]=[])).push(value);});_.indexBy=group(function(result,key,value){result[key]=value;});_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1;});_.sortedIndex=function(array,obj,iterator,context){iterator=iterator==null?_.identity:lookupIterator(iterator);var value=iterator.call(context,obj);var low=0,high=array.length;while(low<high){var mid=(low+high)>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid;}
return low;};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj);};_.size=function(obj){if(obj==null)return 0;return(obj.length===+obj.length)?obj.length:_.keys(obj).length;};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;return(n==null)||guard?array[0]:slice.call(array,0,n);};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){if(array==null)return void 0;if((n==null)||guard){return array[array.length-1];}else{return slice.call(array,Math.max(array.length-n,0));}};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,(n==null)||guard?1:n);};_.compact=function(array){return _.filter(array,_.identity);};var flatten=function(input,shallow,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input);}
each(input,function(value){if(_.isArray(value)||_.isArguments(value)){shallow?push.apply(output,value):flatten(value,shallow,output);}else{output.push(value);}});return output;};_.flatten=function(array,shallow){return flatten(array,shallow,[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator,context){if(_.isFunction(isSorted)){context=iterator;iterator=isSorted;isSorted=false;}
var initial=iterator?_.map(array,iterator,context):array;var results=[];var seen=[];each(initial,function(value,index){if(isSorted?(!index||seen[seen.length-1]!==value):!_.contains(seen,value)){seen.push(value);results.push(array[index]);}});return results;};_.union=function(){return _.uniq(_.flatten(arguments,true));};_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value);});};_.zip=function(){var length=_.max(_.pluck(arguments,"length").concat(0));var results=new Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,''+i);}
return results;};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i];}else{result[list[i][0]]=list[i][1];}}
return result;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=='number'){i=(isSorted<0?Math.max(0,length+isSorted):isSorted);}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1;}}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;i<length;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var hasIndex=from!=null;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf){return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);}
var i=(hasIndex?from:array.length);while(i--)if(array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var length=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(length);while(idx<length){range[idx++]=start;start+=step;}
return range;};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;args=slice.call(arguments,2);return bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result)return result;return self;};};_.partial=function(func){var args=slice.call(arguments,1);return function(){return func.apply(this,args.concat(slice.call(arguments)));};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length===0)throw new Error("bindAll must be passed function names");each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;options||(options={});var later=function(){previous=options.leading===false?0:new Date;timeout=null;result=func.apply(context,args);};return function(){var now=new Date;if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining);}
return result;};};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;return function(){context=this;args=arguments;timestamp=new Date();var later=function(){var last=(new Date())-timestamp;if(last<wait){timeout=setTimeout(later,wait-last);}else{timeout=null;if(!immediate)result=func.apply(context,args);}};var callNow=immediate&&!timeout;if(!timeout){timeout=setTimeout(later,wait);}
if(callNow)result=func.apply(context,args);return result;};};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;memo=func.apply(this,arguments);func=null;return memo;};};_.wrap=function(func,wrapper){return function(){var args=[func];push.apply(args,arguments);return wrapper.apply(this,args);};};_.compose=function(){var funcs=arguments;return function(){var args=arguments;for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys;};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=new Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]];}
return values;};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=new Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]];}
return pairs;};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i];}
return result;};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop];}}});return obj;};_.pick=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));each(keys,function(key){if(key in obj)copy[key]=obj[key];});return copy;};_.omit=function(obj){var copy={};var keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj){if(!_.contains(keys,key))copy[key]=obj[key];}
return copy;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){if(source){for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop];}}});return obj;};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!=toString.call(b))return false;switch(className){case'[object String]':return a==String(b);case'[object Number]':return a!=+a?b!=+b:(a==0?1/a==1/b:a==+b);case'[object Date]':case'[object Boolean]':return+a==+b;case'[object RegExp]':return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeof a!='object'||typeof b!='object')return false;var length=aStack.length;while(length--){if(aStack[length]==a)return bStack[length]==b;}
var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&(aCtor instanceof aCtor)&&_.isFunction(bCtor)&&(bCtor instanceof bCtor))){return false;}
aStack.push(a);bStack.push(b);var size=0,result=true;if(className=='[object Array]'){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break;}}}else{for(var key in a){if(_.has(a,key)){size++;if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break;}}
if(result){for(key in b){if(_.has(b,key)&&!(size--))break;}
result=!size;}}
aStack.pop();bStack.pop();return result;};_.isEqual=function(a,b){return eq(a,b,[],[]);};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType===1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)=='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};each(['Arguments','Function','String','Number','Date','RegExp'],function(name){_['is'+name]=function(obj){return toString.call(obj)=='[object '+name+']';};});if(!_.isArguments(arguments)){_.isArguments=function(obj){return!!(obj&&_.has(obj,'callee'));};}
if(typeof(/./)!=='function'){_.isFunction=function(obj){return typeof obj==='function';};}
_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj));};_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.has=function(obj,key){return hasOwnProperty.call(obj,key);};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){var accum=Array(Math.max(0,n));for(var i=0;i<n;i++)accum[i]=iterator.call(context,i);return accum;};_.random=function(min,max){if(max==null){max=min;min=0;}
return min+Math.floor(Math.random()*(max-min+1));};var entityMap={escape:{'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;'}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp('['+_.keys(entityMap.escape).join('')+']','g'),unescape:new RegExp('('+_.keys(entityMap.unescape).join('|')+')','g')};_.each(['escape','unescape'],function(method){_[method]=function(string){if(string==null)return'';return(''+string).replace(entityRegexes[method],function(match){return entityMap[method][match];});};});_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value;};_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args));};});};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+'';return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\t':'t','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,function(match){return'\\'+escapes[match];});if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}
if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}
if(evaluate){source+="';\n"+evaluate+"\n__p+='";}
index=offset+match.length;return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+
source+"return __p;\n";try{render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}
if(data)return render(data,_);var template=function(data){return render.call(this,data,_);};template.source='function('+(settings.variable||'obj')+'){\n'+source+'}';return template;};_.chain=function(obj){return _(obj).chain();};var result=function(obj){return this._chain?_(obj).chain():obj;};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name=='shift'||name=='splice')&&obj.length===0)delete obj[0];return result.call(this,obj);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments));};});_.extend(_.prototype,{chain:function(){this._chain=true;return this;},value:function(){return this._wrapped;}});}).call(this);
(function(){var root=this;var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;var Backbone;if(typeof exports!=='undefined'){Backbone=exports;}else{Backbone=root.Backbone={};}
Backbone.VERSION='1.1.0';var _=root._;if(!_&&(typeof require!=='undefined'))_=require('underscore');Backbone.$=root.jQuery||root.Zepto||root.ender||root.$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this;};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,'on',name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this;},once:function(name,callback,context){if(!eventsApi(this,'once',name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments);});once._callback=callback;return this.on(name,once,context);},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,'off',name,[callback,context]))return this;if(!name&&!callback&&!context){this._events={};return this;}
names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if((callback&&callback!==ev.callback&&callback!==ev.callback._callback)||(context&&context!==ev.context)){retain.push(ev);}}}
if(!retain.length)delete this._events[name];}}
return this;},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,'trigger',name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this;},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==='object')callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id];}
return this;}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==='object'){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest));}
return false;}
if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest));}
return false;}
return true;};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);}};var listenMethods={listenTo:'on',listenToOnce:'once'};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId('l'));listeningTo[id]=obj;if(!callback&&typeof name==='object')callback=this;obj[implementation](name,callback,this);return this;};});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId('c');this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,'defaults'));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments);};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:'id',initialize:function(){},toJSON:function(options){return _.clone(this.attributes);},sync:function(){return Backbone.sync.apply(this,arguments);},get:function(attr){return this.attributes[attr];},escape:function(attr){return _.escape(this.get(attr));},has:function(attr){return this.get(attr)!=null;},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={};}
current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val;}else{delete this.changed[attr];}
unset?delete current[attr]:current[attr]=val;}
if(!silent){if(changes.length)this._pending=true;for(var i=0,l=changes.length;i<l;i++){this.trigger('change:'+changes[i],this,current[changes[i]],options);}}
if(changing)return this;if(!silent){while(this._pending){this._pending=false;this.trigger('change',this,options);}}
this._pending=false;this._changing=false;return this;},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}));},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}));},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr);},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],(val=diff[attr])))continue;(changed||(changed={}))[attr]=val;}
return changed;},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr];},previousAttributes:function(){return _.clone(this._previousAttributes);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);return this.sync('read',this,options);},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==='object'){attrs=key;options=val;}else{(attrs={})[key]=val;}
options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false;}else{if(!this._validate(attrs,options))return false;}
if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs);}
if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false;}
if(success)success(model,resp,options);model.trigger('sync',model,resp,options);};wrapError(this,options);method=this.isNew()?'create':(options.patch?'patch':'update');if(method==='patch')options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr;},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger('destroy',model,model.collection,options);};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger('sync',model,resp,options);};if(this.isNew()){options.success();return false;}
wrapError(this,options);var xhr=this.sync('delete',this,options);if(!options.wait)destroy();return xhr;},url:function(){var base=_.result(this,'urlRoot')||_.result(this.collection,'url')||urlError();if(this.isNew())return base;return base+(base.charAt(base.length-1)==='/'?'':'/')+encodeURIComponent(this.id);},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.attributes);},isNew:function(){return this.id==null;},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}));},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger('invalid',this,error,_.extend(options,{validationError:error}));return false;}});var modelMethods=['keys','values','pairs','invert','pick','omit'];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args);};});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options));};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options);});},sync:function(){return Backbone.sync.apply(this,arguments);},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions));},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger('remove',model,this,options);}
this._removeReference(model);}
return singular?models[0]:models;},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?(models?[models]:[]):_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&(at==null)&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i];if(attrs instanceof Model){id=model=attrs;}else{id=attrs[targetModel.prototype.idAttribute];}
if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true;}
models[i]=existing;}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);model.on('all',this._onModelEvent,this);this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;}
if(order)order.push(existing||model);}
if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model);}
if(toRemove.length)this.remove(toRemove,options);}
if(toAdd.length||(order&&order.length)){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i]);}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i]);}}}
if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger('add',model,this,options);}
if(sort||(order&&order.length))this.trigger('sort',this,options);}
return singular?models[0]:models;},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i]);}
options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger('reset',this,options);return models;},push:function(model,options){return this.add(model,_.extend({at:this.length},options));},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model;},unshift:function(model,options){return this.add(model,_.extend({at:0},options));},shift:function(options){var model=this.at(0);this.remove(model,options);return model;},slice:function(){return slice.apply(this.models,arguments);},get:function(obj){if(obj==null)return void 0;return this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj];},at:function(index){return this.models[index];},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?'find':'filter'](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false;}
return true;});},findWhere:function(attrs){return this.where(attrs,true);},sort:function(options){if(!this.comparator)throw new Error('Cannot sort a set without a comparator');options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this);}else{this.models.sort(_.bind(this.comparator,this));}
if(!options.silent)this.trigger('sort',this,options);return this;},pluck:function(attr){return _.invoke(this.models,'get',attr);},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?'reset':'set';collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger('sync',collection,resp,options);};wrapError(this,options);return this.sync('read',this,options);},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp,options){if(options.wait)collection.add(model,options);if(success)success(model,resp,options);};model.save(null,options);return model;},parse:function(resp,options){return resp;},clone:function(){return new this.constructor(this.models);},_reset:function(){this.length=0;this.models=[];this._byId={};},_prepareModel:function(attrs,options){if(attrs instanceof Model){if(!attrs.collection)attrs.collection=this;return attrs;}
options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger('invalid',this,model.validationError,options);return false;},_removeReference:function(model){if(this===model.collection)delete model.collection;model.off('all',this._onModelEvent,this);},_onModelEvent:function(event,model,collection,options){if((event==='add'||event==='remove')&&collection!==this)return;if(event==='destroy')this.remove(model,options);if(model&&event==='change:'+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model;}
this.trigger.apply(this,arguments);}});var methods=['forEach','each','map','collect','reduce','foldl','inject','reduceRight','foldr','find','detect','filter','select','reject','every','all','some','any','include','contains','invoke','max','min','toArray','size','first','head','take','initial','rest','tail','drop','last','without','difference','indexOf','shuffle','lastIndexOf','isEmpty','chain'];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args);};});var attributeMethods=['groupBy','countBy','sortBy'];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value);};return _[method](this.models,iterator,context);};});var View=Backbone.View=function(options){this.cid=_.uniqueId('view');options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents();};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=['model','collection','el','id','attributes','className','tagName','events'];_.extend(View.prototype,Events,{tagName:'div',$:function(selector){return this.$el.find(selector);},initialize:function(){},render:function(){return this;},remove:function(){this.$el.remove();this.stopListening();return this;},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this;},delegateEvents:function(events){if(!(events||(events=_.result(this,'events'))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+='.delegateEvents'+this.cid;if(selector===''){this.$el.on(eventName,method);}else{this.$el.on(eventName,selector,method);}}
return this;},undelegateEvents:function(){this.$el.off('.delegateEvents'+this.cid);return this;},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,'attributes'));if(this.id)attrs.id=_.result(this,'id');if(this.className)attrs['class']=_.result(this,'className');var $el=Backbone.$('<'+_.result(this,'tagName')+'>').attr(attrs);this.setElement($el,false);}else{this.setElement(_.result(this,'el'),false);}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:'json'};if(!options.url){params.url=_.result(model,'url')||urlError();}
if(options.data==null&&model&&(method==='create'||method==='update'||method==='patch')){params.contentType='application/json';params.data=JSON.stringify(options.attrs||model.toJSON(options));}
if(options.emulateJSON){params.contentType='application/x-www-form-urlencoded';params.data=params.data?{model:params.data}:{};}
if(options.emulateHTTP&&(type==='PUT'||type==='DELETE'||type==='PATCH')){params.type='POST';if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader('X-HTTP-Method-Override',type);if(beforeSend)return beforeSend.apply(this,arguments);};}
if(params.type!=='GET'&&!options.emulateJSON){params.processData=false;}
if(params.type==='PATCH'&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP");};}
var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger('request',model,xhr,options);return xhr;};var noXhrPatch=typeof window!=='undefined'&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={'create':'POST','update':'PUT','patch':'PATCH','delete':'DELETE','read':'GET'};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments);};var extend=function(protoProps,staticProps){var parent=this;var child;if(protoProps&&_.has(protoProps,'constructor')){child=protoProps.constructor;}else{child=function(){return parent.apply(this,arguments);};}
_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child;};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child;};Model.extend=Collection.extend=View.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified');};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger('error',model,resp,options);};};}).call(this);
(function defineMustache(global,factory){if(typeof exports==='object'&&exports&&typeof exports.nodeName!=='string'){factory(exports);}else if(typeof define==='function'&&define.amd){define(['exports'],factory);}else{global.Mustache={};factory(global.Mustache);}}(this,function mustacheFactory(mustache){var objectToString=Object.prototype.toString;var isArray=Array.isArray||function isArrayPolyfill(object){return objectToString.call(object)==='[object Array]';};function isFunction(object){return typeof object==='function';}
function typeStr(obj){return isArray(obj)?'array':typeof obj;}
function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,'\\$&');}
function hasProperty(obj,propName){return obj!=null&&typeof obj==='object'&&(propName in obj);}
var regExpTest=RegExp.prototype.test;function testRegExp(re,string){return regExpTest.call(re,string);}
var nonSpaceRe=/\S/;function isWhitespace(string){return!testRegExp(nonSpaceRe,string);}
var entityMap={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'};function escapeHtml(string){return String(string).replace(/[&<>"'`=\/]/g,function fromEntityMap(s){return entityMap[s];});}
var whiteRe=/\s*/;var spaceRe=/\s+/;var equalsRe=/\s*=/;var curlyRe=/\s*\}/;var tagRe=/#|\^|\/|>|\{|&|=|!/;function parseTemplate(template,tags){if(!template)
return[];var sections=[];var tokens=[];var spaces=[];var hasTag=false;var nonSpace=false;function stripSpace(){if(hasTag&&!nonSpace){while(spaces.length)
delete tokens[spaces.pop()];}else{spaces=[];}
hasTag=false;nonSpace=false;}
var openingTagRe,closingTagRe,closingCurlyRe;function compileTags(tagsToCompile){if(typeof tagsToCompile==='string')
tagsToCompile=tagsToCompile.split(spaceRe,2);if(!isArray(tagsToCompile)||tagsToCompile.length!==2)
throw new Error('Invalid tags: '+tagsToCompile);openingTagRe=new RegExp(escapeRegExp(tagsToCompile[0])+'\\s*');closingTagRe=new RegExp('\\s*'+escapeRegExp(tagsToCompile[1]));closingCurlyRe=new RegExp('\\s*'+escapeRegExp('}'+tagsToCompile[1]));}
compileTags(tags||mustache.tags);var scanner=new Scanner(template);var start,type,value,chr,token,openSection;while(!scanner.eos()){start=scanner.pos;value=scanner.scanUntil(openingTagRe);if(value){for(var i=0,valueLength=value.length;i<valueLength;++i){chr=value.charAt(i);if(isWhitespace(chr)){spaces.push(tokens.length);}else{nonSpace=true;}
tokens.push(['text',chr,start,start+1]);start+=1;if(chr==='\n')
stripSpace();}}
if(!scanner.scan(openingTagRe))
break;hasTag=true;type=scanner.scan(tagRe)||'name';scanner.scan(whiteRe);if(type==='='){value=scanner.scanUntil(equalsRe);scanner.scan(equalsRe);scanner.scanUntil(closingTagRe);}else if(type==='{'){value=scanner.scanUntil(closingCurlyRe);scanner.scan(curlyRe);scanner.scanUntil(closingTagRe);type='&';}else{value=scanner.scanUntil(closingTagRe);}
if(!scanner.scan(closingTagRe))
throw new Error('Unclosed tag at '+scanner.pos);token=[type,value,start,scanner.pos];tokens.push(token);if(type==='#'||type==='^'){sections.push(token);}else if(type==='/'){openSection=sections.pop();if(!openSection)
throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)
throw new Error('Unclosed section "'+openSection[1]+'" at '+start);}else if(type==='name'||type==='{'||type==='&'){nonSpace=true;}else if(type==='='){compileTags(value);}}
openSection=sections.pop();if(openSection)
throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens));}
function squashTokens(tokens){var squashedTokens=[];var token,lastToken;for(var i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];if(token){if(token[0]==='text'&&lastToken&&lastToken[0]==='text'){lastToken[1]+=token[1];lastToken[3]=token[3];}else{squashedTokens.push(token);lastToken=token;}}}
return squashedTokens;}
function nestTokens(tokens){var nestedTokens=[];var collector=nestedTokens;var sections=[];var token,section;for(var i=0,numTokens=tokens.length;i<numTokens;++i){token=tokens[i];switch(token[0]){case'#':case'^':collector.push(token);sections.push(token);collector=token[4]=[];break;case'/':section=sections.pop();section[5]=token[2];collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token);}}
return nestedTokens;}
function Scanner(string){this.string=string;this.tail=string;this.pos=0;}
Scanner.prototype.eos=function eos(){return this.tail==='';};Scanner.prototype.scan=function scan(re){var match=this.tail.match(re);if(!match||match.index!==0)
return'';var string=match[0];this.tail=this.tail.substring(string.length);this.pos+=string.length;return string;};Scanner.prototype.scanUntil=function scanUntil(re){var index=this.tail.search(re),match;switch(index){case-1:match=this.tail;this.tail='';break;case 0:match='';break;default:match=this.tail.substring(0,index);this.tail=this.tail.substring(index);}
this.pos+=match.length;return match;};function Context(view,parentContext){this.view=view;this.cache={'.':this.view};this.parent=parentContext;}
Context.prototype.push=function push(view){return new Context(view,this);};Context.prototype.lookup=function lookup(name){var cache=this.cache;var value;if(cache.hasOwnProperty(name)){value=cache[name];}else{var context=this,names,index,lookupHit=false;while(context){if(name.indexOf('.')>0){value=context.view;names=name.split('.');index=0;while(value!=null&&index<names.length){if(index===names.length-1)
lookupHit=hasProperty(value,names[index]);value=value[names[index++]];}}else{value=context.view[name];lookupHit=hasProperty(context.view,name);}
if(lookupHit)
break;context=context.parent;}
cache[name]=value;}
if(isFunction(value))
value=value.call(this.view);return value;};function Writer(){this.cache={};}
Writer.prototype.clearCache=function clearCache(){this.cache={};};Writer.prototype.parse=function parse(template,tags){var cache=this.cache;var tokens=cache[template];if(tokens==null)
tokens=cache[template]=parseTemplate(template,tags);return tokens;};Writer.prototype.render=function render(template,view,partials){var tokens=this.parse(template);var context=(view instanceof Context)?view:new Context(view);return this.renderTokens(tokens,context,partials,template);};Writer.prototype.renderTokens=function renderTokens(tokens,context,partials,originalTemplate){var buffer='';var token,symbol,value;for(var i=0,numTokens=tokens.length;i<numTokens;++i){value=undefined;token=tokens[i];symbol=token[0];if(symbol==='#')value=this.renderSection(token,context,partials,originalTemplate);else if(symbol==='^')value=this.renderInverted(token,context,partials,originalTemplate);else if(symbol==='>')value=this.renderPartial(token,context,partials,originalTemplate);else if(symbol==='&')value=this.unescapedValue(token,context);else if(symbol==='name')value=this.escapedValue(token,context);else if(symbol==='text')value=this.rawValue(token);if(value!==undefined)
buffer+=value;}
return buffer;};Writer.prototype.renderSection=function renderSection(token,context,partials,originalTemplate){var self=this;var buffer='';var value=context.lookup(token[1]);function subRender(template){return self.render(template,context,partials);}
if(!value)return;if(isArray(value)){for(var j=0,valueLength=value.length;j<valueLength;++j){buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate);}}else if(typeof value==='object'||typeof value==='string'||typeof value==='number'){buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate);}else if(isFunction(value)){if(typeof originalTemplate!=='string')
throw new Error('Cannot use higher-order sections without the original template');value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender);if(value!=null)
buffer+=value;}else{buffer+=this.renderTokens(token[4],context,partials,originalTemplate);}
return buffer;};Writer.prototype.renderInverted=function renderInverted(token,context,partials,originalTemplate){var value=context.lookup(token[1]);if(!value||(isArray(value)&&value.length===0))
return this.renderTokens(token[4],context,partials,originalTemplate);};Writer.prototype.renderPartial=function renderPartial(token,context,partials){if(!partials)return;var value=isFunction(partials)?partials(token[1]):partials[token[1]];if(value!=null)
return this.renderTokens(this.parse(value),context,partials,value);};Writer.prototype.unescapedValue=function unescapedValue(token,context){var value=context.lookup(token[1]);if(value!=null)
return value;};Writer.prototype.escapedValue=function escapedValue(token,context){var value=context.lookup(token[1]);if(value!=null)
return mustache.escape(value);};Writer.prototype.rawValue=function rawValue(token){return token[1];};mustache.name='mustache.js';mustache.version='2.2.1';mustache.tags=['{{','}}'];var defaultWriter=new Writer();mustache.clearCache=function clearCache(){return defaultWriter.clearCache();};mustache.parse=function parse(template,tags){return defaultWriter.parse(template,tags);};mustache.render=function render(template,view,partials){if(typeof template!=='string'){throw new TypeError('Invalid template! Template should be a "string" '+'but "'+typeStr(template)+'" was given as the first '+'argument for mustache#render(template, view, partials)');}
return defaultWriter.render(template,view,partials);};mustache.to_html=function to_html(template,view,partials,send){var result=mustache.render(template,view,partials);if(isFunction(send)){send(result);}else{return result;}};mustache.escape=escapeHtml;mustache.Scanner=Scanner;mustache.Context=Context;mustache.Writer=Writer;}));;(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):global.moment=factory()}(this,(function(){'use strict';var hookCallback;function hooks(){return hookCallback.apply(null,arguments);}
function setHookCallback(callback){hookCallback=callback;}
function isArray(input){return input instanceof Array||Object.prototype.toString.call(input)==='[object Array]';}
function isObject(input){return input!=null&&Object.prototype.toString.call(input)==='[object Object]';}
function isObjectEmpty(obj){if(Object.getOwnPropertyNames){return(Object.getOwnPropertyNames(obj).length===0);}else{var k;for(k in obj){if(obj.hasOwnProperty(k)){return false;}}
return true;}}
function isUndefined(input){return input===void 0;}
function isNumber(input){return typeof input==='number'||Object.prototype.toString.call(input)==='[object Number]';}
function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==='[object Date]';}
function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i));}
return res;}
function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b);}
function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i];}}
if(hasOwnProp(b,'toString')){a.toString=b.toString;}
if(hasOwnProp(b,'valueOf')){a.valueOf=b.valueOf;}
return a;}
function createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc();}
function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null,rfc2822:false,weekdayMismatch:false};}
function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags();}
return m._pf;}
var some;if(Array.prototype.some){some=Array.prototype.some;}else{some=function(fun){var t=Object(this);var len=t.length>>>0;for(var i=0;i<len;i++){if(i in t&&fun.call(this,t[i],i,t)){return true;}}
return false;};}
function isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);var parsedParts=some.call(flags.parsedDateParts,function(i){return i!=null;});var isNowValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.weekdayMismatch&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated&&(!flags.meridiem||(flags.meridiem&&parsedParts));if(m._strict){isNowValid=isNowValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined;}
if(Object.isFrozen==null||!Object.isFrozen(m)){m._isValid=isNowValid;}
else{return isNowValid;}}
return m._isValid;}
function createInvalid(flags){var m=createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags);}
else{getParsingFlags(m).userInvalidated=true;}
return m;}
var momentProperties=hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(!isUndefined(from._isAMomentObject)){to._isAMomentObject=from._isAMomentObject;}
if(!isUndefined(from._i)){to._i=from._i;}
if(!isUndefined(from._f)){to._f=from._f;}
if(!isUndefined(from._l)){to._l=from._l;}
if(!isUndefined(from._strict)){to._strict=from._strict;}
if(!isUndefined(from._tzm)){to._tzm=from._tzm;}
if(!isUndefined(from._isUTC)){to._isUTC=from._isUTC;}
if(!isUndefined(from._offset)){to._offset=from._offset;}
if(!isUndefined(from._pf)){to._pf=getParsingFlags(from);}
if(!isUndefined(from._locale)){to._locale=from._locale;}
if(momentProperties.length>0){for(i=0;i<momentProperties.length;i++){prop=momentProperties[i];val=from[prop];if(!isUndefined(val)){to[prop]=val;}}}
return to;}
var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(config._d!=null?config._d.getTime():NaN);if(!this.isValid()){this._d=new Date(NaN);}
if(updateInProgress===false){updateInProgress=true;hooks.updateOffset(this);updateInProgress=false;}}
function isMoment(obj){return obj instanceof Moment||(obj!=null&&obj._isAMomentObject!=null);}
function absFloor(number){if(number<0){return Math.ceil(number)||0;}else{return Math.floor(number);}}
function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){value=absFloor(coercedNumber);}
return value;}
function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if((dontConvert&&array1[i]!==array2[i])||(!dontConvert&&toInt(array1[i])!==toInt(array2[i]))){diffs++;}}
return diffs+lengthDiff;}
function warn(msg){if(hooks.suppressDeprecationWarnings===false&&(typeof console!=='undefined')&&console.warn){console.warn('Deprecation warning: '+msg);}}
function deprecate(msg,fn){var firstTime=true;return extend(function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,msg);}
if(firstTime){var args=[];var arg;for(var i=0;i<arguments.length;i++){arg='';if(typeof arguments[i]==='object'){arg+='\n['+i+'] ';for(var key in arguments[0]){arg+=key+': '+arguments[0][key]+', ';}
arg=arg.slice(0,-2);}else{arg=arguments[i];}
args.push(arg);}
warn(msg+'\nArguments: '+Array.prototype.slice.call(args).join('')+'\n'+(new Error()).stack);firstTime=false;}
return fn.apply(this,arguments);},fn);}
var deprecations={};function deprecateSimple(name,msg){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(name,msg);}
if(!deprecations[name]){warn(msg);deprecations[name]=true;}}
hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(input){return input instanceof Function||Object.prototype.toString.call(input)==='[object Function]';}
function set(config){var prop,i;for(i in config){prop=config[i];if(isFunction(prop)){this[i]=prop;}else{this['_'+i]=prop;}}
this._config=config;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+'|'+(/\d{1,2}/).source);}
function mergeConfigs(parentConfig,childConfig){var res=extend({},parentConfig),prop;for(prop in childConfig){if(hasOwnProp(childConfig,prop)){if(isObject(parentConfig[prop])&&isObject(childConfig[prop])){res[prop]={};extend(res[prop],parentConfig[prop]);extend(res[prop],childConfig[prop]);}else if(childConfig[prop]!=null){res[prop]=childConfig[prop];}else{delete res[prop];}}}
for(prop in parentConfig){if(hasOwnProp(parentConfig,prop)&&!hasOwnProp(childConfig,prop)&&isObject(parentConfig[prop])){res[prop]=extend({},res[prop]);}}
return res;}
function Locale(config){if(config!=null){this.set(config);}}
var keys;if(Object.keys){keys=Object.keys;}else{keys=function(obj){var i,res=[];for(i in obj){if(hasOwnProp(obj,i)){res.push(i);}}
return res;};}
var defaultCalendar={sameDay:'[Today at] LT',nextDay:'[Tomorrow at] LT',nextWeek:'dddd [at] LT',lastDay:'[Yesterday at] LT',lastWeek:'[Last] dddd [at] LT',sameElse:'L'};function calendar(key,mom,now){var output=this._calendar[key]||this._calendar['sameElse'];return isFunction(output)?output.call(mom,now):output;}
var defaultLongDateFormat={LTS:'h:mm:ss A',LT:'h:mm A',L:'MM/DD/YYYY',LL:'MMMM D, YYYY',LLL:'MMMM D, YYYY h:mm A',LLLL:'dddd, MMMM D, YYYY h:mm A'};function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];if(format||!formatUpper){return format;}
this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1);});return this._longDateFormat[key];}
var defaultInvalidDate='Invalid date';function invalidDate(){return this._invalidDate;}
var defaultOrdinal='%d';var defaultDayOfMonthOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace('%d',number);}
var defaultRelativeTime={future:'in %s',past:'%s ago',s:'a few seconds',ss:'%d seconds',m:'a minute',mm:'%d minutes',h:'an hour',hh:'%d hours',d:'a day',dd:'%d days',M:'a month',MM:'%d months',y:'a year',yy:'%d years'};function relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return(isFunction(output))?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number);}
function pastFuture(diff,output){var format=this._relativeTime[diff>0?'future':'past'];return isFunction(format)?format(output):format.replace(/%s/i,output);}
var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+'s']=aliases[shorthand]=unit;}
function normalizeUnits(units){return typeof units==='string'?aliases[units]||aliases[units.toLowerCase()]:undefined;}
function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop];}}}
return normalizedInput;}
var priorities={};function addUnitPriority(unit,priority){priorities[unit]=priority;}
function getPrioritizedUnits(unitsObj){var units=[];for(var u in unitsObj){units.push({unit:u,priority:priorities[u]});}
units.sort(function(a,b){return a.priority-b.priority;});return units;}
function zeroFill(number,targetLength,forceSign){var absNumber=''+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?(forceSign?'+':''):'-')+
Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber;}
var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==='string'){func=function(){return this[callback]();};}
if(token){formatTokenFunctions[token]=func;}
if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2]);};}
if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token);};}}
function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,'');}
return input.replace(/\\/g,'');}
function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]];}else{array[i]=removeFormattingTokens(array[i]);}}
return function(mom){var output='',i;for(i=0;i<length;i++){output+=isFunction(array[i])?array[i].call(mom,format):array[i];}
return output;};}
function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate();}
format=expandFormat(format,m.localeData());formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format);return formatFunctions[format](m);}
function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input;}
localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1;}
return format;}
var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match3to4=/\d\d\d\d?/;var match5to6=/\d\d\d\d\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;var regexes={};function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return(isStrict&&strictRegex)?strictRegex:regex;};}
function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token));}
return regexes[token](config._strict,config._locale);}
function unescapeFormat(s){return regexEscape(s.replace('\\','').replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4;}));}
function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&');}
var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==='string'){token=[token];}
if(isNumber(callback)){func=function(input,array){array[callback]=toInt(input);};}
for(i=0;i<token.length;i++){tokens[token[i]]=func;}}
function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token);});}
function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token);}}
var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;var WEEK=7;var WEEKDAY=8;addFormatToken('Y',0,0,function(){var y=this.year();return y<=9999?''+y:'+'+y;});addFormatToken(0,['YY',2],0,function(){return this.year()%100;});addFormatToken(0,['YYYY',4],0,'year');addFormatToken(0,['YYYYY',5],0,'year');addFormatToken(0,['YYYYYY',6,true],0,'year');addUnitAlias('year','y');addUnitPriority('year',1);addRegexToken('Y',matchSigned);addRegexToken('YY',match1to2,match2);addRegexToken('YYYY',match1to4,match4);addRegexToken('YYYYY',match1to6,match6);addRegexToken('YYYYYY',match1to6,match6);addParseToken(['YYYYY','YYYYYY'],YEAR);addParseToken('YYYY',function(input,array){array[YEAR]=input.length===2?hooks.parseTwoDigitYear(input):toInt(input);});addParseToken('YY',function(input,array){array[YEAR]=hooks.parseTwoDigitYear(input);});addParseToken('Y',function(input,array){array[YEAR]=parseInt(input,10);});function daysInYear(year){return isLeapYear(year)?366:365;}
function isLeapYear(year){return(year%4===0&&year%100!==0)||year%400===0;}
hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2000);};var getSetYear=makeGetSet('FullYear',true);function getIsLeapYear(){return isLeapYear(this.year());}
function makeGetSet(unit,keepTime){return function(value){if(value!=null){set$1(this,unit,value);hooks.updateOffset(this,keepTime);return this;}else{return get(this,unit);}};}
function get(mom,unit){return mom.isValid()?mom._d['get'+(mom._isUTC?'UTC':'')+unit]():NaN;}
function set$1(mom,unit,value){if(mom.isValid()&&!isNaN(value)){if(unit==='FullYear'&&isLeapYear(mom.year())&&mom.month()===1&&mom.date()===29){mom._d['set'+(mom._isUTC?'UTC':'')+unit](value,mom.month(),daysInMonth(value,mom.month()));}
else{mom._d['set'+(mom._isUTC?'UTC':'')+unit](value);}}}
function stringGet(units){units=normalizeUnits(units);if(isFunction(this[units])){return this[units]();}
return this;}
function stringSet(units,value){if(typeof units==='object'){units=normalizeObjectUnits(units);var prioritized=getPrioritizedUnits(units);for(var i=0;i<prioritized.length;i++){this[prioritized[i].unit](units[prioritized[i].unit]);}}else{units=normalizeUnits(units);if(isFunction(this[units])){return this[units](value);}}
return this;}
function mod(n,x){return((n%x)+x)%x;}
var indexOf;if(Array.prototype.indexOf){indexOf=Array.prototype.indexOf;}else{indexOf=function(o){var i;for(i=0;i<this.length;++i){if(this[i]===o){return i;}}
return-1;};}
function daysInMonth(year,month){if(isNaN(year)||isNaN(month)){return NaN;}
var modMonth=mod(month,12);year+=(month-modMonth)/12;return modMonth===1?(isLeapYear(year)?29:28):(31-modMonth%7%2);}
addFormatToken('M',['MM',2],'Mo',function(){return this.month()+1;});addFormatToken('MMM',0,0,function(format){return this.localeData().monthsShort(this,format);});addFormatToken('MMMM',0,0,function(format){return this.localeData().months(this,format);});addUnitAlias('month','M');addUnitPriority('month',8);addRegexToken('M',match1to2);addRegexToken('MM',match1to2,match2);addRegexToken('MMM',function(isStrict,locale){return locale.monthsShortRegex(isStrict);});addRegexToken('MMMM',function(isStrict,locale){return locale.monthsRegex(isStrict);});addParseToken(['M','MM'],function(input,array){array[MONTH]=toInt(input)-1;});addParseToken(['MMM','MMMM'],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month;}else{getParsingFlags(config).invalidMonth=input;}});var MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var defaultLocaleMonths='January_February_March_April_May_June_July_August_September_October_November_December'.split('_');function localeMonths(m,format){if(!m){return isArray(this._months)?this._months:this._months['standalone'];}
return isArray(this._months)?this._months[m.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(format)?'format':'standalone'][m.month()];}
var defaultLocaleMonthsShort='Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');function localeMonthsShort(m,format){if(!m){return isArray(this._monthsShort)?this._monthsShort:this._monthsShort['standalone'];}
return isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?'format':'standalone'][m.month()];}
function handleStrictParse(monthName,format,strict){var i,ii,mom,llc=monthName.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){mom=createUTC([2000,i]);this._shortMonthsParse[i]=this.monthsShort(mom,'').toLocaleLowerCase();this._longMonthsParse[i]=this.months(mom,'').toLocaleLowerCase();}}
if(strict){if(format==='MMM'){ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null;}else{ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null;}}else{if(format==='MMM'){ii=indexOf.call(this._shortMonthsParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null;}else{ii=indexOf.call(this._longMonthsParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null;}}}
function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(this._monthsParseExact){return handleStrictParse.call(this,monthName,format,strict);}
if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];}
for(i=0;i<12;i++){mom=createUTC([2000,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp('^'+this.months(mom,'').replace('.','')+'$','i');this._shortMonthsParse[i]=new RegExp('^'+this.monthsShort(mom,'').replace('.','')+'$','i');}
if(!strict&&!this._monthsParse[i]){regex='^'+this.months(mom,'')+'|^'+this.monthsShort(mom,'');this._monthsParse[i]=new RegExp(regex.replace('.',''),'i');}
if(strict&&format==='MMMM'&&this._longMonthsParse[i].test(monthName)){return i;}else if(strict&&format==='MMM'&&this._shortMonthsParse[i].test(monthName)){return i;}else if(!strict&&this._monthsParse[i].test(monthName)){return i;}}}
function setMonth(mom,value){var dayOfMonth;if(!mom.isValid()){return mom;}
if(typeof value==='string'){if(/^\d+$/.test(value)){value=toInt(value);}else{value=mom.localeData().monthsParse(value);if(!isNumber(value)){return mom;}}}
dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d['set'+(mom._isUTC?'UTC':'')+'Month'](value,dayOfMonth);return mom;}
function getSetMonth(value){if(value!=null){setMonth(this,value);hooks.updateOffset(this,true);return this;}else{return get(this,'Month');}}
function getDaysInMonth(){return daysInMonth(this.year(),this.month());}
var defaultMonthsShortRegex=matchWord;function monthsShortRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,'_monthsRegex')){computeMonthsParse.call(this);}
if(isStrict){return this._monthsShortStrictRegex;}else{return this._monthsShortRegex;}}else{if(!hasOwnProp(this,'_monthsShortRegex')){this._monthsShortRegex=defaultMonthsShortRegex;}
return this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex;}}
var defaultMonthsRegex=matchWord;function monthsRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,'_monthsRegex')){computeMonthsParse.call(this);}
if(isStrict){return this._monthsStrictRegex;}else{return this._monthsRegex;}}else{if(!hasOwnProp(this,'_monthsRegex')){this._monthsRegex=defaultMonthsRegex;}
return this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex;}}
function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length;}
var shortPieces=[],longPieces=[],mixedPieces=[],i,mom;for(i=0;i<12;i++){mom=createUTC([2000,i]);shortPieces.push(this.monthsShort(mom,''));longPieces.push(this.months(mom,''));mixedPieces.push(this.months(mom,''));mixedPieces.push(this.monthsShort(mom,''));}
shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<12;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i]);}
for(i=0;i<24;i++){mixedPieces[i]=regexEscape(mixedPieces[i]);}
this._monthsRegex=new RegExp('^('+mixedPieces.join('|')+')','i');this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp('^('+longPieces.join('|')+')','i');this._monthsShortStrictRegex=new RegExp('^('+shortPieces.join('|')+')','i');}
function createDate(y,m,d,h,M,s,ms){var date;if(y<100&&y>=0){date=new Date(y+400,m,d,h,M,s,ms);if(isFinite(date.getFullYear())){date.setFullYear(y);}}else{date=new Date(y,m,d,h,M,s,ms);}
return date;}
function createUTCDate(y){var date;if(y<100&&y>=0){var args=Array.prototype.slice.call(arguments);args[0]=y+400;date=new Date(Date.UTC.apply(null,args));if(isFinite(date.getUTCFullYear())){date.setUTCFullYear(y);}}else{date=new Date(Date.UTC.apply(null,arguments));}
return date;}
function firstWeekOffset(year,dow,doy){var
fwd=7+dow-doy,fwdlw=(7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7;return-fwdlw+fwd-1;}
function dayOfYearFromWeeks(year,week,weekday,dow,doy){var localWeekday=(7+weekday-dow)%7,weekOffset=firstWeekOffset(year,dow,doy),dayOfYear=1+7*(week-1)+localWeekday+weekOffset,resYear,resDayOfYear;if(dayOfYear<=0){resYear=year-1;resDayOfYear=daysInYear(resYear)+dayOfYear;}else if(dayOfYear>daysInYear(year)){resYear=year+1;resDayOfYear=dayOfYear-daysInYear(year);}else{resYear=year;resDayOfYear=dayOfYear;}
return{year:resYear,dayOfYear:resDayOfYear};}
function weekOfYear(mom,dow,doy){var weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1,resWeek,resYear;if(week<1){resYear=mom.year()-1;resWeek=week+weeksInYear(resYear,dow,doy);}else if(week>weeksInYear(mom.year(),dow,doy)){resWeek=week-weeksInYear(mom.year(),dow,doy);resYear=mom.year()+1;}else{resYear=mom.year();resWeek=week;}
return{week:resWeek,year:resYear};}
function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7;}
addFormatToken('w',['ww',2],'wo','week');addFormatToken('W',['WW',2],'Wo','isoWeek');addUnitAlias('week','w');addUnitAlias('isoWeek','W');addUnitPriority('week',5);addUnitPriority('isoWeek',5);addRegexToken('w',match1to2);addRegexToken('ww',match1to2,match2);addRegexToken('W',match1to2);addRegexToken('WW',match1to2,match2);addWeekParseToken(['w','ww','W','WW'],function(input,week,config,token){week[token.substr(0,1)]=toInt(input);});function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week;}
var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow;}
function localeFirstDayOfYear(){return this._week.doy;}
function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,'d');}
function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,'d');}
addFormatToken('d',0,'do','day');addFormatToken('dd',0,0,function(format){return this.localeData().weekdaysMin(this,format);});addFormatToken('ddd',0,0,function(format){return this.localeData().weekdaysShort(this,format);});addFormatToken('dddd',0,0,function(format){return this.localeData().weekdays(this,format);});addFormatToken('e',0,0,'weekday');addFormatToken('E',0,0,'isoWeekday');addUnitAlias('day','d');addUnitAlias('weekday','e');addUnitAlias('isoWeekday','E');addUnitPriority('day',11);addUnitPriority('weekday',11);addUnitPriority('isoWeekday',11);addRegexToken('d',match1to2);addRegexToken('e',match1to2);addRegexToken('E',match1to2);addRegexToken('dd',function(isStrict,locale){return locale.weekdaysMinRegex(isStrict);});addRegexToken('ddd',function(isStrict,locale){return locale.weekdaysShortRegex(isStrict);});addRegexToken('dddd',function(isStrict,locale){return locale.weekdaysRegex(isStrict);});addWeekParseToken(['dd','ddd','dddd'],function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);if(weekday!=null){week.d=weekday;}else{getParsingFlags(config).invalidWeekday=input;}});addWeekParseToken(['d','e','E'],function(input,week,config,token){week[token]=toInt(input);});function parseWeekday(input,locale){if(typeof input!=='string'){return input;}
if(!isNaN(input)){return parseInt(input,10);}
input=locale.weekdaysParse(input);if(typeof input==='number'){return input;}
return null;}
function parseIsoWeekday(input,locale){if(typeof input==='string'){return locale.weekdaysParse(input)%7||7;}
return isNaN(input)?null:input;}
function shiftWeekdays(ws,n){return ws.slice(n,7).concat(ws.slice(0,n));}
var defaultLocaleWeekdays='Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');function localeWeekdays(m,format){var weekdays=isArray(this._weekdays)?this._weekdays:this._weekdays[(m&&m!==true&&this._weekdays.isFormat.test(format))?'format':'standalone'];return(m===true)?shiftWeekdays(weekdays,this._week.dow):(m)?weekdays[m.day()]:weekdays;}
var defaultLocaleWeekdaysShort='Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');function localeWeekdaysShort(m){return(m===true)?shiftWeekdays(this._weekdaysShort,this._week.dow):(m)?this._weekdaysShort[m.day()]:this._weekdaysShort;}
var defaultLocaleWeekdaysMin='Su_Mo_Tu_We_Th_Fr_Sa'.split('_');function localeWeekdaysMin(m){return(m===true)?shiftWeekdays(this._weekdaysMin,this._week.dow):(m)?this._weekdaysMin[m.day()]:this._weekdaysMin;}
function handleStrictParse$1(weekdayName,format,strict){var i,ii,mom,llc=weekdayName.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){mom=createUTC([2000,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(mom,'').toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(mom,'').toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(mom,'').toLocaleLowerCase();}}
if(strict){if(format==='dddd'){ii=indexOf.call(this._weekdaysParse,llc);return ii!==-1?ii:null;}else if(format==='ddd'){ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null;}else{ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null;}}else{if(format==='dddd'){ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null;}else if(format==='ddd'){ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null;}else{ii=indexOf.call(this._minWeekdaysParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii;}
ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null;}}}
function localeWeekdaysParse(weekdayName,format,strict){var i,mom,regex;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,weekdayName,format,strict);}
if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[];}
for(i=0;i<7;i++){mom=createUTC([2000,1]).day(i);if(strict&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp('^'+this.weekdays(mom,'').replace('.','\\.?')+'$','i');this._shortWeekdaysParse[i]=new RegExp('^'+this.weekdaysShort(mom,'').replace('.','\\.?')+'$','i');this._minWeekdaysParse[i]=new RegExp('^'+this.weekdaysMin(mom,'').replace('.','\\.?')+'$','i');}
if(!this._weekdaysParse[i]){regex='^'+this.weekdays(mom,'')+'|^'+this.weekdaysShort(mom,'')+'|^'+this.weekdaysMin(mom,'');this._weekdaysParse[i]=new RegExp(regex.replace('.',''),'i');}
if(strict&&format==='dddd'&&this._fullWeekdaysParse[i].test(weekdayName)){return i;}else if(strict&&format==='ddd'&&this._shortWeekdaysParse[i].test(weekdayName)){return i;}else if(strict&&format==='dd'&&this._minWeekdaysParse[i].test(weekdayName)){return i;}else if(!strict&&this._weekdaysParse[i].test(weekdayName)){return i;}}}
function getSetDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN;}
var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,'d');}else{return day;}}
function getSetLocaleDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN;}
var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,'d');}
function getSetISODayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN;}
if(input!=null){var weekday=parseIsoWeekday(input,this.localeData());return this.day(this.day()%7?weekday:weekday-7);}else{return this.day()||7;}}
var defaultWeekdaysRegex=matchWord;function weekdaysRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,'_weekdaysRegex')){computeWeekdaysParse.call(this);}
if(isStrict){return this._weekdaysStrictRegex;}else{return this._weekdaysRegex;}}else{if(!hasOwnProp(this,'_weekdaysRegex')){this._weekdaysRegex=defaultWeekdaysRegex;}
return this._weekdaysStrictRegex&&isStrict?this._weekdaysStrictRegex:this._weekdaysRegex;}}
var defaultWeekdaysShortRegex=matchWord;function weekdaysShortRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,'_weekdaysRegex')){computeWeekdaysParse.call(this);}
if(isStrict){return this._weekdaysShortStrictRegex;}else{return this._weekdaysShortRegex;}}else{if(!hasOwnProp(this,'_weekdaysShortRegex')){this._weekdaysShortRegex=defaultWeekdaysShortRegex;}
return this._weekdaysShortStrictRegex&&isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex;}}
var defaultWeekdaysMinRegex=matchWord;function weekdaysMinRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,'_weekdaysRegex')){computeWeekdaysParse.call(this);}
if(isStrict){return this._weekdaysMinStrictRegex;}else{return this._weekdaysMinRegex;}}else{if(!hasOwnProp(this,'_weekdaysMinRegex')){this._weekdaysMinRegex=defaultWeekdaysMinRegex;}
return this._weekdaysMinStrictRegex&&isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex;}}
function computeWeekdaysParse(){function cmpLenRev(a,b){return b.length-a.length;}
var minPieces=[],shortPieces=[],longPieces=[],mixedPieces=[],i,mom,minp,shortp,longp;for(i=0;i<7;i++){mom=createUTC([2000,1]).day(i);minp=this.weekdaysMin(mom,'');shortp=this.weekdaysShort(mom,'');longp=this.weekdays(mom,'');minPieces.push(minp);shortPieces.push(shortp);longPieces.push(longp);mixedPieces.push(minp);mixedPieces.push(shortp);mixedPieces.push(longp);}
minPieces.sort(cmpLenRev);shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<7;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i]);mixedPieces[i]=regexEscape(mixedPieces[i]);}
this._weekdaysRegex=new RegExp('^('+mixedPieces.join('|')+')','i');this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp('^('+longPieces.join('|')+')','i');this._weekdaysShortStrictRegex=new RegExp('^('+shortPieces.join('|')+')','i');this._weekdaysMinStrictRegex=new RegExp('^('+minPieces.join('|')+')','i');}
function hFormat(){return this.hours()%12||12;}
function kFormat(){return this.hours()||24;}
addFormatToken('H',['HH',2],0,'hour');addFormatToken('h',['hh',2],0,hFormat);addFormatToken('k',['kk',2],0,kFormat);addFormatToken('hmm',0,0,function(){return''+hFormat.apply(this)+zeroFill(this.minutes(),2);});addFormatToken('hmmss',0,0,function(){return''+hFormat.apply(this)+zeroFill(this.minutes(),2)+
zeroFill(this.seconds(),2);});addFormatToken('Hmm',0,0,function(){return''+this.hours()+zeroFill(this.minutes(),2);});addFormatToken('Hmmss',0,0,function(){return''+this.hours()+zeroFill(this.minutes(),2)+
zeroFill(this.seconds(),2);});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase);});}
meridiem('a',true);meridiem('A',false);addUnitAlias('hour','h');addUnitPriority('hour',13);function matchMeridiem(isStrict,locale){return locale._meridiemParse;}
addRegexToken('a',matchMeridiem);addRegexToken('A',matchMeridiem);addRegexToken('H',match1to2);addRegexToken('h',match1to2);addRegexToken('k',match1to2);addRegexToken('HH',match1to2,match2);addRegexToken('hh',match1to2,match2);addRegexToken('kk',match1to2,match2);addRegexToken('hmm',match3to4);addRegexToken('hmmss',match5to6);addRegexToken('Hmm',match3to4);addRegexToken('Hmmss',match5to6);addParseToken(['H','HH'],HOUR);addParseToken(['k','kk'],function(input,array,config){var kInput=toInt(input);array[HOUR]=kInput===24?0:kInput;});addParseToken(['a','A'],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input;});addParseToken(['h','hh'],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true;});addParseToken('hmm',function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos));getParsingFlags(config).bigHour=true;});addParseToken('hmmss',function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2));getParsingFlags(config).bigHour=true;});addParseToken('Hmm',function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos));});addParseToken('Hmmss',function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2));});function localeIsPM(input){return((input+'').toLowerCase().charAt(0)==='p');}
var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?'pm':'PM';}else{return isLower?'am':'AM';}}
var getSetHour=makeGetSet('Hours',true);var baseConfig={calendar:defaultCalendar,longDateFormat:defaultLongDateFormat,invalidDate:defaultInvalidDate,ordinal:defaultOrdinal,dayOfMonthOrdinalParse:defaultDayOfMonthOrdinalParse,relativeTime:defaultRelativeTime,months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:defaultLocaleWeek,weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:defaultLocaleMeridiemParse};var locales={};var localeFamilies={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace('_','-'):key;}
function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split('-');j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split('-'):null;while(j>0){locale=loadLocale(split.slice(0,j).join('-'));if(locale){return locale;}
if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break;}
j--;}
i++;}
return globalLocale;}
function loadLocale(name){var oldLocale=null;if(!locales[name]&&(typeof module!=='undefined')&&module&&module.exports){try{oldLocale=globalLocale._abbr;var aliasedRequire=require;aliasedRequire('./locale/'+name);getSetGlobalLocale(oldLocale);}catch(e){}}
return locales[name];}
function getSetGlobalLocale(key,values){var data;if(key){if(isUndefined(values)){data=getLocale(key);}
else{data=defineLocale(key,values);}
if(data){globalLocale=data;}
else{if((typeof console!=='undefined')&&console.warn){console.warn('Locale '+key+' not found. Did you forget to load it?');}}}
return globalLocale._abbr;}
function defineLocale(name,config){if(config!==null){var locale,parentConfig=baseConfig;config.abbr=name;if(locales[name]!=null){deprecateSimple('defineLocaleOverride','use moment.updateLocale(localeName, config) to change '+'an existing locale. moment.defineLocale(localeName, '+'config) should only be used for creating a new locale '+'See http://momentjs.com/guides/#/warnings/define-locale/ for more info.');parentConfig=locales[name]._config;}else if(config.parentLocale!=null){if(locales[config.parentLocale]!=null){parentConfig=locales[config.parentLocale]._config;}else{locale=loadLocale(config.parentLocale);if(locale!=null){parentConfig=locale._config;}else{if(!localeFamilies[config.parentLocale]){localeFamilies[config.parentLocale]=[];}
localeFamilies[config.parentLocale].push({name:name,config:config});return null;}}}
locales[name]=new Locale(mergeConfigs(parentConfig,config));if(localeFamilies[name]){localeFamilies[name].forEach(function(x){defineLocale(x.name,x.config);});}
getSetGlobalLocale(name);return locales[name];}else{delete locales[name];return null;}}
function updateLocale(name,config){if(config!=null){var locale,tmpLocale,parentConfig=baseConfig;tmpLocale=loadLocale(name);if(tmpLocale!=null){parentConfig=tmpLocale._config;}
config=mergeConfigs(parentConfig,config);locale=new Locale(config);locale.parentLocale=locales[name];locales[name]=locale;getSetGlobalLocale(name);}else{if(locales[name]!=null){if(locales[name].parentLocale!=null){locales[name]=locales[name].parentLocale;}else if(locales[name]!=null){delete locales[name];}}}
return locales[name];}
function getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr;}
if(!key){return globalLocale;}
if(!isArray(key)){locale=loadLocale(key);if(locale){return locale;}
key=[key];}
return chooseLocale(key);}
function listLocales(){return keys(locales);}
function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||(a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0))?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE;}
if(getParsingFlags(m)._overflowWeeks&&overflow===-1){overflow=WEEK;}
if(getParsingFlags(m)._overflowWeekday&&overflow===-1){overflow=WEEKDAY;}
getParsingFlags(m).overflow=overflow;}
return m;}
function defaults(a,b,c){if(a!=null){return a;}
if(b!=null){return b;}
return c;}
function currentDateArray(config){var nowValue=new Date(hooks.now());if(config._useUTC){return[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()];}
return[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()];}
function configFromArray(config){var i,date,input=[],currentDate,expectedWeekday,yearToUse;if(config._d){return;}
currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config);}
if(config._dayOfYear!=null){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)||config._dayOfYear===0){getParsingFlags(config)._overflowDayOfYear=true;}
date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate();}
for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i];}
for(;i<7;i++){config._a[i]=input[i]=(config._a[i]==null)?(i===2?1:0):config._a[i];}
if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0;}
config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);expectedWeekday=config._useUTC?config._d.getUTCDay():config._d.getDay();if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm);}
if(config._nextDay){config._a[HOUR]=24;}
if(config._w&&typeof config._w.d!=='undefined'&&config._w.d!==expectedWeekday){getParsingFlags(config).weekdayMismatch=true;}}
function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1);if(weekday<1||weekday>7){weekdayOverflow=true;}}else{dow=config._locale._week.dow;doy=config._locale._week.doy;var curWeek=weekOfYear(createLocal(),dow,doy);weekYear=defaults(w.gg,config._a[YEAR],curWeek.year);week=defaults(w.w,curWeek.week);if(w.d!=null){weekday=w.d;if(weekday<0||weekday>6){weekdayOverflow=true;}}else if(w.e!=null){weekday=w.e+dow;if(w.e<0||w.e>6){weekdayOverflow=true;}}else{weekday=dow;}}
if(week<1||week>weeksInYear(weekYear,dow,doy)){getParsingFlags(config)._overflowWeeks=true;}else if(weekdayOverflow!=null){getParsingFlags(config)._overflowWeekday=true;}else{temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear;}}
var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var tzRegex=/Z|[+-]\d\d(?::?\d\d)?/;var isoDates=[['YYYYYY-MM-DD',/[+-]\d{6}-\d\d-\d\d/],['YYYY-MM-DD',/\d{4}-\d\d-\d\d/],['GGGG-[W]WW-E',/\d{4}-W\d\d-\d/],['GGGG-[W]WW',/\d{4}-W\d\d/,false],['YYYY-DDD',/\d{4}-\d{3}/],['YYYY-MM',/\d{4}-\d\d/,false],['YYYYYYMMDD',/[+-]\d{10}/],['YYYYMMDD',/\d{8}/],['GGGG[W]WWE',/\d{4}W\d{3}/],['GGGG[W]WW',/\d{4}W\d{2}/,false],['YYYYDDD',/\d{7}/]];var isoTimes=[['HH:mm:ss.SSSS',/\d\d:\d\d:\d\d\.\d+/],['HH:mm:ss,SSSS',/\d\d:\d\d:\d\d,\d+/],['HH:mm:ss',/\d\d:\d\d:\d\d/],['HH:mm',/\d\d:\d\d/],['HHmmss.SSSS',/\d\d\d\d\d\d\.\d+/],['HHmmss,SSSS',/\d\d\d\d\d\d,\d+/],['HHmmss',/\d\d\d\d\d\d/],['HHmm',/\d\d\d\d/],['HH',/\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string),allowTime,dateFormat,timeFormat,tzFormat;if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0];allowTime=isoDates[i][2]!==false;break;}}
if(dateFormat==null){config._isValid=false;return;}
if(match[3]){for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||' ')+isoTimes[i][0];break;}}
if(timeFormat==null){config._isValid=false;return;}}
if(!allowTime&&timeFormat!=null){config._isValid=false;return;}
if(match[4]){if(tzRegex.exec(match[4])){tzFormat='Z';}else{config._isValid=false;return;}}
config._f=dateFormat+(timeFormat||'')+(tzFormat||'');configFromStringAndFormat(config);}else{config._isValid=false;}}
var rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function extractFromRFC2822Strings(yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr){var result=[untruncateYear(yearStr),defaultLocaleMonthsShort.indexOf(monthStr),parseInt(dayStr,10),parseInt(hourStr,10),parseInt(minuteStr,10)];if(secondStr){result.push(parseInt(secondStr,10));}
return result;}
function untruncateYear(yearStr){var year=parseInt(yearStr,10);if(year<=49){return 2000+year;}else if(year<=999){return 1900+year;}
return year;}
function preprocessRFC2822(s){return s.replace(/\([^)]*\)|[\n\t]/g,' ').replace(/(\s\s+)/g,' ').replace(/^\s\s*/,'').replace(/\s\s*$/,'');}
function checkWeekday(weekdayStr,parsedInput,config){if(weekdayStr){var weekdayProvided=defaultLocaleWeekdaysShort.indexOf(weekdayStr),weekdayActual=new Date(parsedInput[0],parsedInput[1],parsedInput[2]).getDay();if(weekdayProvided!==weekdayActual){getParsingFlags(config).weekdayMismatch=true;config._isValid=false;return false;}}
return true;}
var obsOffsets={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function calculateOffset(obsOffset,militaryOffset,numOffset){if(obsOffset){return obsOffsets[obsOffset];}else if(militaryOffset){return 0;}else{var hm=parseInt(numOffset,10);var m=hm%100,h=(hm-m)/100;return h*60+m;}}
function configFromRFC2822(config){var match=rfc2822.exec(preprocessRFC2822(config._i));if(match){var parsedArray=extractFromRFC2822Strings(match[4],match[3],match[2],match[5],match[6],match[7]);if(!checkWeekday(match[1],parsedArray,config)){return;}
config._a=parsedArray;config._tzm=calculateOffset(match[8],match[9],match[10]);config._d=createUTCDate.apply(null,config._a);config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm);getParsingFlags(config).rfc2822=true;}else{config._isValid=false;}}
function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date(+matched[1]);return;}
configFromISO(config);if(config._isValid===false){delete config._isValid;}else{return;}
configFromRFC2822(config);if(config._isValid===false){delete config._isValid;}else{return;}
hooks.createFromInputFallback(config);}
hooks.createFromInputFallback=deprecate('value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), '+'which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are '+'discouraged and will be removed in an upcoming major release. Please refer to '+'http://momentjs.com/guides/#/warnings/js-date/ for more info.',function(config){config._d=new Date(config._i+(config._useUTC?' UTC':''));});hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(config){if(config._f===hooks.ISO_8601){configFromISO(config);return;}
if(config._f===hooks.RFC_2822){configFromRFC2822(config);return;}
config._a=[];getParsingFlags(config).empty=true;var string=''+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped);}
string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length;}
if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false;}
else{getParsingFlags(config).unusedTokens.push(token);}
addTimeToArrayFromToken(token,parsedInput,config);}
else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token);}}
getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string);}
if(config._a[HOUR]<=12&&getParsingFlags(config).bigHour===true&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined;}
getParsingFlags(config).parsedDateParts=config._a.slice(0);getParsingFlags(config).meridiem=config._meridiem;config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config);}
function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour;}
if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem);}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12;}
if(!isPm&&hour===12){hour=0;}
return hour;}else{return hour;}}
function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return;}
for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC;}
tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!isValid(tempConfig)){continue;}
currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig;}}
extend(config,bestMoment||tempConfig);}
function configFromObject(config){if(config._d){return;}
var i=normalizeObjectUnits(config._i);config._a=map([i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],function(obj){return obj&&parseInt(obj,10);});configFromArray(config);}
function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));if(res._nextDay){res.add(1,'d');res._nextDay=undefined;}
return res;}
function prepareConfig(config){var input=config._i,format=config._f;config._locale=config._locale||getLocale(config._l);if(input===null||(format===undefined&&input==='')){return createInvalid({nullInput:true});}
if(typeof input==='string'){config._i=input=config._locale.preparse(input);}
if(isMoment(input)){return new Moment(checkOverflow(input));}else if(isDate(input)){config._d=input;}else if(isArray(format)){configFromStringAndArray(config);}else if(format){configFromStringAndFormat(config);}else{configFromInput(config);}
if(!isValid(config)){config._d=null;}
return config;}
function configFromInput(config){var input=config._i;if(isUndefined(input)){config._d=new Date(hooks.now());}else if(isDate(input)){config._d=new Date(input.valueOf());}else if(typeof input==='string'){configFromString(config);}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10);});configFromArray(config);}else if(isObject(input)){configFromObject(config);}else if(isNumber(input)){config._d=new Date(input);}else{hooks.createFromInputFallback(config);}}
function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(locale===true||locale===false){strict=locale;locale=undefined;}
if((isObject(input)&&isObjectEmpty(input))||(isArray(input)&&input.length===0)){input=undefined;}
c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c);}
function createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false);}
var prototypeMin=deprecate('moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/',function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other<this?this:other;}else{return createInvalid();}});var prototypeMax=deprecate('moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/',function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other>this?this:other;}else{return createInvalid();}});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0];}
if(!moments.length){return createLocal();}
res=moments[0];for(i=1;i<moments.length;++i){if(!moments[i].isValid()||moments[i][fn](res)){res=moments[i];}}
return res;}
function min(){var args=[].slice.call(arguments,0);return pickBy('isBefore',args);}
function max(){var args=[].slice.call(arguments,0);return pickBy('isAfter',args);}
var now=function(){return Date.now?Date.now():+(new Date());};var ordering=['year','quarter','month','week','day','hour','minute','second','millisecond'];function isDurationValid(m){for(var key in m){if(!(indexOf.call(ordering,key)!==-1&&(m[key]==null||!isNaN(m[key])))){return false;}}
var unitHasDecimal=false;for(var i=0;i<ordering.length;++i){if(m[ordering[i]]){if(unitHasDecimal){return false;}
if(parseFloat(m[ordering[i]])!==toInt(m[ordering[i]])){unitHasDecimal=true;}}}
return true;}
function isValid$1(){return this._isValid;}
function createInvalid$1(){return createDuration(NaN);}
function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||normalizedInput.isoWeek||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._isValid=isDurationValid(normalizedInput);this._milliseconds=+milliseconds+
seconds*1e3+
minutes*6e4+
hours*1000*60*60;this._days=+days+
weeks*7;this._months=+months+
quarters*3+
years*12;this._data={};this._locale=getLocale();this._bubble();}
function isDuration(obj){return obj instanceof Duration;}
function absRound(number){if(number<0){return Math.round(-1*number)*-1;}else{return Math.round(number);}}
function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign='+';if(offset<0){offset=-offset;sign='-';}
return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~(offset)%60,2);});}
offset('Z',':');offset('ZZ','');addRegexToken('Z',matchShortOffset);addRegexToken('ZZ',matchShortOffset);addParseToken(['Z','ZZ'],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(matchShortOffset,input);});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(matcher,string){var matches=(string||'').match(matcher);if(matches===null){return null;}
var chunk=matches[matches.length-1]||[];var parts=(chunk+'').match(chunkOffset)||['-',0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return minutes===0?0:parts[0]==='+'?minutes:-minutes;}
function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?input.valueOf():createLocal(input).valueOf())-res.valueOf();res._d.setTime(res._d.valueOf()+diff);hooks.updateOffset(res,false);return res;}else{return createLocal(input).local();}}
function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15;}
hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime,keepMinutes){var offset=this._offset||0,localAdjust;if(!this.isValid()){return input!=null?this:NaN;}
if(input!=null){if(typeof input==='string'){input=offsetFromString(matchShortOffset,input);if(input===null){return this;}}else if(Math.abs(input)<16&&!keepMinutes){input=input*60;}
if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this);}
this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,'m');}
if(offset!==input){if(!keepLocalTime||this._changeInProgress){addSubtract(this,createDuration(input-offset,'m'),1,false);}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null;}}
return this;}else{return this._isUTC?offset:getDateOffset(this);}}
function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=='string'){input=-input;}
this.utcOffset(input,keepLocalTime);return this;}else{return-this.utcOffset();}}
function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime);}
function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),'m');}}
return this;}
function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm,false,true);}else if(typeof this._i==='string'){var tZone=offsetFromString(matchOffset,this._i);if(tZone!=null){this.utcOffset(tZone);}
else{this.utcOffset(0,true);}}
return this;}
function hasAlignedHourOffset(input){if(!this.isValid()){return false;}
input=input?createLocal(input).utcOffset():0;return(this.utcOffset()-input)%60===0;}
function isDaylightSavingTime(){return(this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset());}
function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted;}
var c={};copyConfig(c,this);c=prepareConfig(c);if(c._a){var other=c._isUTC?createUTC(c._a):createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0;}else{this._isDSTShifted=false;}
return this._isDSTShifted;}
function isLocal(){return this.isValid()?!this._isUTC:false;}
function isUtcOffset(){return this.isValid()?this._isUTC:false;}
function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false;}
var aspNetRegex=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var isoRegex=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months};}else if(isNumber(input)){duration={};if(key){duration[key]=input;}else{duration.milliseconds=input;}}else if(!!(match=aspNetRegex.exec(input))){sign=(match[1]==='-')?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(absRound(match[MILLISECOND]*1000))*sign};}else if(!!(match=isoRegex.exec(input))){sign=(match[1]==='-')?-1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)};}else if(duration==null){duration={};}else if(typeof duration==='object'&&('from'in duration||'to'in duration)){diffRes=momentsDifference(createLocal(duration.from),createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months;}
ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,'_locale')){ret._locale=input._locale;}
return ret;}
createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(',','.'));return(isNaN(res)?0:res)*sign;}
function positiveMomentsDifference(base,other){var res={};res.months=other.month()-base.month()+
(other.year()-base.year())*12;if(base.clone().add(res.months,'M').isAfter(other)){--res.months;}
res.milliseconds=+other-+(base.clone().add(res.months,'M'));return res;}
function momentsDifference(base,other){var res;if(!(base.isValid()&&other.isValid())){return{milliseconds:0,months:0};}
other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other);}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months;}
return res;}
function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,'moment().'+name+'(period, number) is deprecated. Please use moment().'+name+'(number, period). '+'See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.');tmp=val;val=period;period=tmp;}
val=typeof val==='string'?+val:val;dur=createDuration(val,period);addSubtract(this,dur,direction);return this;};}
function addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);if(!mom.isValid()){return;}
updateOffset=updateOffset==null?true:updateOffset;if(months){setMonth(mom,get(mom,'Month')+months*isAdding);}
if(days){set$1(mom,'Date',get(mom,'Date')+days*isAdding);}
if(milliseconds){mom._d.setTime(mom._d.valueOf()+milliseconds*isAdding);}
if(updateOffset){hooks.updateOffset(mom,days||months);}}
var add=createAdder(1,'add');var subtract=createAdder(-1,'subtract');function getCalendarFormat(myMoment,now){var diff=myMoment.diff(now,'days',true);return diff<-6?'sameElse':diff<-1?'lastWeek':diff<0?'lastDay':diff<1?'sameDay':diff<2?'nextDay':diff<7?'nextWeek':'sameElse';}
function calendar$1(time,formats){var now=time||createLocal(),sod=cloneWithOffset(now,this).startOf('day'),format=hooks.calendarFormat(this,sod)||'sameElse';var output=formats&&(isFunction(formats[format])?formats[format].call(this,now):formats[format]);return this.format(output||this.localeData().calendar(format,this,createLocal(now)));}
function clone(){return new Moment(this);}
function isAfter(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false;}
units=normalizeUnits(units)||'millisecond';if(units==='millisecond'){return this.valueOf()>localInput.valueOf();}else{return localInput.valueOf()<this.clone().startOf(units).valueOf();}}
function isBefore(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false;}
units=normalizeUnits(units)||'millisecond';if(units==='millisecond'){return this.valueOf()<localInput.valueOf();}else{return this.clone().endOf(units).valueOf()<localInput.valueOf();}}
function isBetween(from,to,units,inclusivity){var localFrom=isMoment(from)?from:createLocal(from),localTo=isMoment(to)?to:createLocal(to);if(!(this.isValid()&&localFrom.isValid()&&localTo.isValid())){return false;}
inclusivity=inclusivity||'()';return(inclusivity[0]==='('?this.isAfter(localFrom,units):!this.isBefore(localFrom,units))&&(inclusivity[1]===')'?this.isBefore(localTo,units):!this.isAfter(localTo,units));}
function isSame(input,units){var localInput=isMoment(input)?input:createLocal(input),inputMs;if(!(this.isValid()&&localInput.isValid())){return false;}
units=normalizeUnits(units)||'millisecond';if(units==='millisecond'){return this.valueOf()===localInput.valueOf();}else{inputMs=localInput.valueOf();return this.clone().startOf(units).valueOf()<=inputMs&&inputMs<=this.clone().endOf(units).valueOf();}}
function isSameOrAfter(input,units){return this.isSame(input,units)||this.isAfter(input,units);}
function isSameOrBefore(input,units){return this.isSame(input,units)||this.isBefore(input,units);}
function diff(input,units,asFloat){var that,zoneDelta,output;if(!this.isValid()){return NaN;}
that=cloneWithOffset(input,this);if(!that.isValid()){return NaN;}
zoneDelta=(that.utcOffset()-this.utcOffset())*6e4;units=normalizeUnits(units);switch(units){case'year':output=monthDiff(this,that)/12;break;case'month':output=monthDiff(this,that);break;case'quarter':output=monthDiff(this,that)/3;break;case'second':output=(this-that)/1e3;break;case'minute':output=(this-that)/6e4;break;case'hour':output=(this-that)/36e5;break;case'day':output=(this-that-zoneDelta)/864e5;break;case'week':output=(this-that-zoneDelta)/6048e5;break;default:output=this-that;}
return asFloat?output:absFloor(output);}
function monthDiff(a,b){var wholeMonthDiff=((b.year()-a.year())*12)+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,'months'),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,'months');adjust=(b-anchor)/(anchor-anchor2);}else{anchor2=a.clone().add(wholeMonthDiff+1,'months');adjust=(b-anchor)/(anchor2-anchor);}
return-(wholeMonthDiff+adjust)||0;}
hooks.defaultFormat='YYYY-MM-DDTHH:mm:ssZ';hooks.defaultFormatUtc='YYYY-MM-DDTHH:mm:ss[Z]';function toString(){return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ');}
function toISOString(keepOffset){if(!this.isValid()){return null;}
var utc=keepOffset!==true;var m=utc?this.clone().utc():this;if(m.year()<0||m.year()>9999){return formatMoment(m,utc?'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]':'YYYYYY-MM-DD[T]HH:mm:ss.SSSZ');}
if(isFunction(Date.prototype.toISOString)){if(utc){return this.toDate().toISOString();}else{return new Date(this.valueOf()+this.utcOffset()*60*1000).toISOString().replace('Z',formatMoment(m,'Z'));}}
return formatMoment(m,utc?'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]':'YYYY-MM-DD[T]HH:mm:ss.SSSZ');}
function inspect(){if(!this.isValid()){return'moment.invalid(/* '+this._i+' */)';}
var func='moment';var zone='';if(!this.isLocal()){func=this.utcOffset()===0?'moment.utc':'moment.parseZone';zone='Z';}
var prefix='['+func+'("]';var year=(0<=this.year()&&this.year()<=9999)?'YYYY':'YYYYYY';var datetime='-MM-DD[T]HH:mm:ss.SSS';var suffix=zone+'[")]';return this.format(prefix+year+datetime+suffix);}
function format(inputString){if(!inputString){inputString=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat;}
var output=formatMoment(this,inputString);return this.localeData().postformat(output);}
function from(time,withoutSuffix){if(this.isValid()&&((isMoment(time)&&time.isValid())||createLocal(time).isValid())){return createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix);}else{return this.localeData().invalidDate();}}
function fromNow(withoutSuffix){return this.from(createLocal(),withoutSuffix);}
function to(time,withoutSuffix){if(this.isValid()&&((isMoment(time)&&time.isValid())||createLocal(time).isValid())){return createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix);}else{return this.localeData().invalidDate();}}
function toNow(withoutSuffix){return this.to(createLocal(),withoutSuffix);}
function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr;}else{newLocaleData=getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData;}
return this;}}
var lang=deprecate('moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',function(key){if(key===undefined){return this.localeData();}else{return this.locale(key);}});function localeData(){return this._locale;}
var MS_PER_SECOND=1000;var MS_PER_MINUTE=60*MS_PER_SECOND;var MS_PER_HOUR=60*MS_PER_MINUTE;var MS_PER_400_YEARS=(365*400+97)*24*MS_PER_HOUR;function mod$1(dividend,divisor){return(dividend%divisor+divisor)%divisor;}
function localStartOfDate(y,m,d){if(y<100&&y>=0){return new Date(y+400,m,d)-MS_PER_400_YEARS;}else{return new Date(y,m,d).valueOf();}}
function utcStartOfDate(y,m,d){if(y<100&&y>=0){return Date.UTC(y+400,m,d)-MS_PER_400_YEARS;}else{return Date.UTC(y,m,d);}}
function startOf(units){var time;units=normalizeUnits(units);if(units===undefined||units==='millisecond'||!this.isValid()){return this;}
var startOfDate=this._isUTC?utcStartOfDate:localStartOfDate;switch(units){case'year':time=startOfDate(this.year(),0,1);break;case'quarter':time=startOfDate(this.year(),this.month()-this.month()%3,1);break;case'month':time=startOfDate(this.year(),this.month(),1);break;case'week':time=startOfDate(this.year(),this.month(),this.date()-this.weekday());break;case'isoWeek':time=startOfDate(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case'day':case'date':time=startOfDate(this.year(),this.month(),this.date());break;case'hour':time=this._d.valueOf();time-=mod$1(time+(this._isUTC?0:this.utcOffset()*MS_PER_MINUTE),MS_PER_HOUR);break;case'minute':time=this._d.valueOf();time-=mod$1(time,MS_PER_MINUTE);break;case'second':time=this._d.valueOf();time-=mod$1(time,MS_PER_SECOND);break;}
this._d.setTime(time);hooks.updateOffset(this,true);return this;}
function endOf(units){var time;units=normalizeUnits(units);if(units===undefined||units==='millisecond'||!this.isValid()){return this;}
var startOfDate=this._isUTC?utcStartOfDate:localStartOfDate;switch(units){case'year':time=startOfDate(this.year()+1,0,1)-1;break;case'quarter':time=startOfDate(this.year(),this.month()-this.month()%3+3,1)-1;break;case'month':time=startOfDate(this.year(),this.month()+1,1)-1;break;case'week':time=startOfDate(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case'isoWeek':time=startOfDate(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case'day':case'date':time=startOfDate(this.year(),this.month(),this.date()+1)-1;break;case'hour':time=this._d.valueOf();time+=MS_PER_HOUR-mod$1(time+(this._isUTC?0:this.utcOffset()*MS_PER_MINUTE),MS_PER_HOUR)-1;break;case'minute':time=this._d.valueOf();time+=MS_PER_MINUTE-mod$1(time,MS_PER_MINUTE)-1;break;case'second':time=this._d.valueOf();time+=MS_PER_SECOND-mod$1(time,MS_PER_SECOND)-1;break;}
this._d.setTime(time);hooks.updateOffset(this,true);return this;}
function valueOf(){return this._d.valueOf()-((this._offset||0)*60000);}
function unix(){return Math.floor(this.valueOf()/1000);}
function toDate(){return new Date(this.valueOf());}
function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()];}
function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()};}
function toJSON(){return this.isValid()?this.toISOString():null;}
function isValid$2(){return isValid(this);}
function parsingFlags(){return extend({},getParsingFlags(this));}
function invalidAt(){return getParsingFlags(this).overflow;}
function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict};}
addFormatToken(0,['gg',2],0,function(){return this.weekYear()%100;});addFormatToken(0,['GG',2],0,function(){return this.isoWeekYear()%100;});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter);}
addWeekYearFormatToken('gggg','weekYear');addWeekYearFormatToken('ggggg','weekYear');addWeekYearFormatToken('GGGG','isoWeekYear');addWeekYearFormatToken('GGGGG','isoWeekYear');addUnitAlias('weekYear','gg');addUnitAlias('isoWeekYear','GG');addUnitPriority('weekYear',1);addUnitPriority('isoWeekYear',1);addRegexToken('G',matchSigned);addRegexToken('g',matchSigned);addRegexToken('GG',match1to2,match2);addRegexToken('gg',match1to2,match2);addRegexToken('GGGG',match1to4,match4);addRegexToken('gggg',match1to4,match4);addRegexToken('GGGGG',match1to6,match6);addRegexToken('ggggg',match1to6,match6);addWeekParseToken(['gggg','ggggg','GGGG','GGGGG'],function(input,week,config,token){week[token.substr(0,2)]=toInt(input);});addWeekParseToken(['gg','GG'],function(input,week,config,token){week[token]=hooks.parseTwoDigitYear(input);});function getSetWeekYear(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy);}
function getSetISOWeekYear(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4);}
function getISOWeeksInYear(){return weeksInYear(this.year(),1,4);}
function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy);}
function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;if(input==null){return weekOfYear(this,dow,doy).year;}else{weeksTarget=weeksInYear(input,dow,doy);if(week>weeksTarget){week=weeksTarget;}
return setWeekAll.call(this,input,week,weekday,dow,doy);}}
function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);this.year(date.getUTCFullYear());this.month(date.getUTCMonth());this.date(date.getUTCDate());return this;}
addFormatToken('Q',0,'Qo','quarter');addUnitAlias('quarter','Q');addUnitPriority('quarter',7);addRegexToken('Q',match1);addParseToken('Q',function(input,array){array[MONTH]=(toInt(input)-1)*3;});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3);}
addFormatToken('D',['DD',2],'Do','date');addUnitAlias('date','D');addUnitPriority('date',9);addRegexToken('D',match1to2);addRegexToken('DD',match1to2,match2);addRegexToken('Do',function(isStrict,locale){return isStrict?(locale._dayOfMonthOrdinalParse||locale._ordinalParse):locale._dayOfMonthOrdinalParseLenient;});addParseToken(['D','DD'],DATE);addParseToken('Do',function(input,array){array[DATE]=toInt(input.match(match1to2)[0]);});var getSetDayOfMonth=makeGetSet('Date',true);addFormatToken('DDD',['DDDD',3],'DDDo','dayOfYear');addUnitAlias('dayOfYear','DDD');addUnitPriority('dayOfYear',4);addRegexToken('DDD',match1to3);addRegexToken('DDDD',match3);addParseToken(['DDD','DDDD'],function(input,array,config){config._dayOfYear=toInt(input);});function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf('day')-this.clone().startOf('year'))/864e5)+1;return input==null?dayOfYear:this.add((input-dayOfYear),'d');}
addFormatToken('m',['mm',2],0,'minute');addUnitAlias('minute','m');addUnitPriority('minute',14);addRegexToken('m',match1to2);addRegexToken('mm',match1to2,match2);addParseToken(['m','mm'],MINUTE);var getSetMinute=makeGetSet('Minutes',false);addFormatToken('s',['ss',2],0,'second');addUnitAlias('second','s');addUnitPriority('second',15);addRegexToken('s',match1to2);addRegexToken('ss',match1to2,match2);addParseToken(['s','ss'],SECOND);var getSetSecond=makeGetSet('Seconds',false);addFormatToken('S',0,0,function(){return~~(this.millisecond()/100);});addFormatToken(0,['SS',2],0,function(){return~~(this.millisecond()/10);});addFormatToken(0,['SSS',3],0,'millisecond');addFormatToken(0,['SSSS',4],0,function(){return this.millisecond()*10;});addFormatToken(0,['SSSSS',5],0,function(){return this.millisecond()*100;});addFormatToken(0,['SSSSSS',6],0,function(){return this.millisecond()*1000;});addFormatToken(0,['SSSSSSS',7],0,function(){return this.millisecond()*10000;});addFormatToken(0,['SSSSSSSS',8],0,function(){return this.millisecond()*100000;});addFormatToken(0,['SSSSSSSSS',9],0,function(){return this.millisecond()*1000000;});addUnitAlias('millisecond','ms');addUnitPriority('millisecond',16);addRegexToken('S',match1to3,match1);addRegexToken('SS',match1to3,match2);addRegexToken('SSS',match1to3,match3);var token;for(token='SSSS';token.length<=9;token+='S'){addRegexToken(token,matchUnsigned);}
function parseMs(input,array){array[MILLISECOND]=toInt(('0.'+input)*1000);}
for(token='S';token.length<=9;token+='S'){addParseToken(token,parseMs);}
var getSetMillisecond=makeGetSet('Milliseconds',false);addFormatToken('z',0,0,'zoneAbbr');addFormatToken('zz',0,0,'zoneName');function getZoneAbbr(){return this._isUTC?'UTC':'';}
function getZoneName(){return this._isUTC?'Coordinated Universal Time':'';}
var proto=Moment.prototype;proto.add=add;proto.calendar=calendar$1;proto.clone=clone;proto.diff=diff;proto.endOf=endOf;proto.format=format;proto.from=from;proto.fromNow=fromNow;proto.to=to;proto.toNow=toNow;proto.get=stringGet;proto.invalidAt=invalidAt;proto.isAfter=isAfter;proto.isBefore=isBefore;proto.isBetween=isBetween;proto.isSame=isSame;proto.isSameOrAfter=isSameOrAfter;proto.isSameOrBefore=isSameOrBefore;proto.isValid=isValid$2;proto.lang=lang;proto.locale=locale;proto.localeData=localeData;proto.max=prototypeMax;proto.min=prototypeMin;proto.parsingFlags=parsingFlags;proto.set=stringSet;proto.startOf=startOf;proto.subtract=subtract;proto.toArray=toArray;proto.toObject=toObject;proto.toDate=toDate;proto.toISOString=toISOString;proto.inspect=inspect;proto.toJSON=toJSON;proto.toString=toString;proto.unix=unix;proto.valueOf=valueOf;proto.creationData=creationData;proto.year=getSetYear;proto.isLeapYear=getIsLeapYear;proto.weekYear=getSetWeekYear;proto.isoWeekYear=getSetISOWeekYear;proto.quarter=proto.quarters=getSetQuarter;proto.month=getSetMonth;proto.daysInMonth=getDaysInMonth;proto.week=proto.weeks=getSetWeek;proto.isoWeek=proto.isoWeeks=getSetISOWeek;proto.weeksInYear=getWeeksInYear;proto.isoWeeksInYear=getISOWeeksInYear;proto.date=getSetDayOfMonth;proto.day=proto.days=getSetDayOfWeek;proto.weekday=getSetLocaleDayOfWeek;proto.isoWeekday=getSetISODayOfWeek;proto.dayOfYear=getSetDayOfYear;proto.hour=proto.hours=getSetHour;proto.minute=proto.minutes=getSetMinute;proto.second=proto.seconds=getSetSecond;proto.millisecond=proto.milliseconds=getSetMillisecond;proto.utcOffset=getSetOffset;proto.utc=setOffsetToUTC;proto.local=setOffsetToLocal;proto.parseZone=setOffsetToParsedOffset;proto.hasAlignedHourOffset=hasAlignedHourOffset;proto.isDST=isDaylightSavingTime;proto.isLocal=isLocal;proto.isUtcOffset=isUtcOffset;proto.isUtc=isUtc;proto.isUTC=isUtc;proto.zoneAbbr=getZoneAbbr;proto.zoneName=getZoneName;proto.dates=deprecate('dates accessor is deprecated. Use date instead.',getSetDayOfMonth);proto.months=deprecate('months accessor is deprecated. Use month instead',getSetMonth);proto.years=deprecate('years accessor is deprecated. Use year instead',getSetYear);proto.zone=deprecate('moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/',getSetZone);proto.isDSTShifted=deprecate('isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information',isDaylightSavingTimeShifted);function createUnix(input){return createLocal(input*1000);}
function createInZone(){return createLocal.apply(null,arguments).parseZone();}
function preParsePostFormat(string){return string;}
var proto$1=Locale.prototype;proto$1.calendar=calendar;proto$1.longDateFormat=longDateFormat;proto$1.invalidDate=invalidDate;proto$1.ordinal=ordinal;proto$1.preparse=preParsePostFormat;proto$1.postformat=preParsePostFormat;proto$1.relativeTime=relativeTime;proto$1.pastFuture=pastFuture;proto$1.set=set;proto$1.months=localeMonths;proto$1.monthsShort=localeMonthsShort;proto$1.monthsParse=localeMonthsParse;proto$1.monthsRegex=monthsRegex;proto$1.monthsShortRegex=monthsShortRegex;proto$1.week=localeWeek;proto$1.firstDayOfYear=localeFirstDayOfYear;proto$1.firstDayOfWeek=localeFirstDayOfWeek;proto$1.weekdays=localeWeekdays;proto$1.weekdaysMin=localeWeekdaysMin;proto$1.weekdaysShort=localeWeekdaysShort;proto$1.weekdaysParse=localeWeekdaysParse;proto$1.weekdaysRegex=weekdaysRegex;proto$1.weekdaysShortRegex=weekdaysShortRegex;proto$1.weekdaysMinRegex=weekdaysMinRegex;proto$1.isPM=localeIsPM;proto$1.meridiem=localeMeridiem;function get$1(format,index,field,setter){var locale=getLocale();var utc=createUTC().set(setter,index);return locale[field](utc,format);}
function listMonthsImpl(format,index,field){if(isNumber(format)){index=format;format=undefined;}
format=format||'';if(index!=null){return get$1(format,index,field,'month');}
var i;var out=[];for(i=0;i<12;i++){out[i]=get$1(format,i,field,'month');}
return out;}
function listWeekdaysImpl(localeSorted,format,index,field){if(typeof localeSorted==='boolean'){if(isNumber(format)){index=format;format=undefined;}
format=format||'';}else{format=localeSorted;index=format;localeSorted=false;if(isNumber(format)){index=format;format=undefined;}
format=format||'';}
var locale=getLocale(),shift=localeSorted?locale._week.dow:0;if(index!=null){return get$1(format,(index+shift)%7,field,'day');}
var i;var out=[];for(i=0;i<7;i++){out[i]=get$1(format,(i+shift)%7,field,'day');}
return out;}
function listMonths(format,index){return listMonthsImpl(format,index,'months');}
function listMonthsShort(format,index){return listMonthsImpl(format,index,'monthsShort');}
function listWeekdays(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,'weekdays');}
function listWeekdaysShort(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,'weekdaysShort');}
function listWeekdaysMin(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,'weekdaysMin');}
getSetGlobalLocale('en',{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=(toInt(number%100/10)===1)?'th':(b===1)?'st':(b===2)?'nd':(b===3)?'rd':'th';return number+output;}});hooks.lang=deprecate('moment.lang is deprecated. Use moment.locale instead.',getSetGlobalLocale);hooks.langData=deprecate('moment.langData is deprecated. Use moment.localeData instead.',getLocale);var mathAbs=Math.abs;function abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this;}
function addSubtract$1(duration,input,value,direction){var other=createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble();}
function add$1(input,value){return addSubtract$1(this,input,value,1);}
function subtract$1(input,value){return addSubtract$1(this,input,value,-1);}
function absCeil(number){if(number<0){return Math.floor(number);}else{return Math.ceil(number);}}
function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years,monthsFromDays;if(!((milliseconds>=0&&days>=0&&months>=0)||(milliseconds<=0&&days<=0&&months<=0))){milliseconds+=absCeil(monthsToDays(months)+days)*864e5;days=0;months=0;}
data.milliseconds=milliseconds%1000;seconds=absFloor(milliseconds/1000);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);monthsFromDays=absFloor(daysToMonths(days));months+=monthsFromDays;days-=absCeil(monthsToDays(monthsFromDays));years=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this;}
function daysToMonths(days){return days*4800/146097;}
function monthsToDays(months){return months*146097/4800;}
function as(units){if(!this.isValid()){return NaN;}
var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==='month'||units==='quarter'||units==='year'){days=this._days+milliseconds/864e5;months=this._months+daysToMonths(days);switch(units){case'month':return months;case'quarter':return months/3;case'year':return months/12;}}else{days=this._days+Math.round(monthsToDays(this._months));switch(units){case'week':return days/7+milliseconds/6048e5;case'day':return days+milliseconds/864e5;case'hour':return days*24+milliseconds/36e5;case'minute':return days*1440+milliseconds/6e4;case'second':return days*86400+milliseconds/1000;case'millisecond':return Math.floor(days*864e5)+milliseconds;default:throw new Error('Unknown unit '+units);}}}
function valueOf$1(){if(!this.isValid()){return NaN;}
return(this._milliseconds+
this._days*864e5+
(this._months%12)*2592e6+
toInt(this._months/12)*31536e6);}
function makeAs(alias){return function(){return this.as(alias);};}
var asMilliseconds=makeAs('ms');var asSeconds=makeAs('s');var asMinutes=makeAs('m');var asHours=makeAs('h');var asDays=makeAs('d');var asWeeks=makeAs('w');var asMonths=makeAs('M');var asQuarters=makeAs('Q');var asYears=makeAs('y');function clone$1(){return createDuration(this);}
function get$2(units){units=normalizeUnits(units);return this.isValid()?this[units+'s']():NaN;}
function makeGetter(name){return function(){return this.isValid()?this._data[name]:NaN;};}
var milliseconds=makeGetter('milliseconds');var seconds=makeGetter('seconds');var minutes=makeGetter('minutes');var hours=makeGetter('hours');var days=makeGetter('days');var months=makeGetter('months');var years=makeGetter('years');function weeks(){return absFloor(this.days()/7);}
var round=Math.round;var thresholds={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture);}
function relativeTime$1(posNegDuration,withoutSuffix,locale){var duration=createDuration(posNegDuration).abs();var seconds=round(duration.as('s'));var minutes=round(duration.as('m'));var hours=round(duration.as('h'));var days=round(duration.as('d'));var months=round(duration.as('M'));var years=round(duration.as('y'));var a=seconds<=thresholds.ss&&['s',seconds]||seconds<thresholds.s&&['ss',seconds]||minutes<=1&&['m']||minutes<thresholds.m&&['mm',minutes]||hours<=1&&['h']||hours<thresholds.h&&['hh',hours]||days<=1&&['d']||days<thresholds.d&&['dd',days]||months<=1&&['M']||months<thresholds.M&&['MM',months]||years<=1&&['y']||['yy',years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a);}
function getSetRelativeTimeRounding(roundingFunction){if(roundingFunction===undefined){return round;}
if(typeof(roundingFunction)==='function'){round=roundingFunction;return true;}
return false;}
function getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false;}
if(limit===undefined){return thresholds[threshold];}
thresholds[threshold]=limit;if(threshold==='s'){thresholds.ss=limit-1;}
return true;}
function humanize(withSuffix){if(!this.isValid()){return this.localeData().invalidDate();}
var locale=this.localeData();var output=relativeTime$1(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output);}
return locale.postformat(output);}
var abs$1=Math.abs;function sign(x){return((x>0)-(x<0))||+x;}
function toISOString$1(){if(!this.isValid()){return this.localeData().invalidDate();}
var seconds=abs$1(this._milliseconds)/1000;var days=abs$1(this._days);var months=abs$1(this._months);var minutes,hours,years;minutes=absFloor(seconds/60);hours=absFloor(minutes/60);seconds%=60;minutes%=60;years=absFloor(months/12);months%=12;var Y=years;var M=months;var D=days;var h=hours;var m=minutes;var s=seconds?seconds.toFixed(3).replace(/\.?0+$/,''):'';var total=this.asSeconds();if(!total){return'P0D';}
var totalSign=total<0?'-':'';var ymSign=sign(this._months)!==sign(total)?'-':'';var daysSign=sign(this._days)!==sign(total)?'-':'';var hmsSign=sign(this._milliseconds)!==sign(total)?'-':'';return totalSign+'P'+
(Y?ymSign+Y+'Y':'')+
(M?ymSign+M+'M':'')+
(D?daysSign+D+'D':'')+
((h||m||s)?'T':'')+
(h?hmsSign+h+'H':'')+
(m?hmsSign+m+'M':'')+
(s?hmsSign+s+'S':'');}
var proto$2=Duration.prototype;proto$2.isValid=isValid$1;proto$2.abs=abs;proto$2.add=add$1;proto$2.subtract=subtract$1;proto$2.as=as;proto$2.asMilliseconds=asMilliseconds;proto$2.asSeconds=asSeconds;proto$2.asMinutes=asMinutes;proto$2.asHours=asHours;proto$2.asDays=asDays;proto$2.asWeeks=asWeeks;proto$2.asMonths=asMonths;proto$2.asQuarters=asQuarters;proto$2.asYears=asYears;proto$2.valueOf=valueOf$1;proto$2._bubble=bubble;proto$2.clone=clone$1;proto$2.get=get$2;proto$2.milliseconds=milliseconds;proto$2.seconds=seconds;proto$2.minutes=minutes;proto$2.hours=hours;proto$2.days=days;proto$2.weeks=weeks;proto$2.months=months;proto$2.years=years;proto$2.humanize=humanize;proto$2.toISOString=toISOString$1;proto$2.toString=toISOString$1;proto$2.toJSON=toISOString$1;proto$2.locale=locale;proto$2.localeData=localeData;proto$2.toIsoString=deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)',toISOString$1);proto$2.lang=lang;addFormatToken('X',0,0,'unix');addFormatToken('x',0,0,'valueOf');addRegexToken('x',matchSigned);addRegexToken('X',matchTimestamp);addParseToken('X',function(input,array,config){config._d=new Date(parseFloat(input,10)*1000);});addParseToken('x',function(input,array,config){config._d=new Date(toInt(input));});hooks.version='2.24.0';setHookCallback(createLocal);hooks.fn=proto;hooks.min=min;hooks.max=max;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=proto;hooks.HTML5_FMT={DATETIME_LOCAL:'YYYY-MM-DDTHH:mm',DATETIME_LOCAL_SECONDS:'YYYY-MM-DDTHH:mm:ss',DATETIME_LOCAL_MS:'YYYY-MM-DDTHH:mm:ss.SSS',DATE:'YYYY-MM-DD',TIME:'HH:mm',TIME_SECONDS:'HH:mm:ss',TIME_MS:'HH:mm:ss.SSS',WEEK:'GGGG-[W]WW',MONTH:'YYYY-MM'};return hooks;})));
pen.define("cdf-legacy/lib/CCC/def",[],function(){function def(qname,value,space){if(qname&&!(qname instanceof def.QualifiedName)){var t=typeof qname;if("object"===t){for(var p in qname)def_1(p,qname[p],value);return def;}
if("array"===t){for(var p in qname)def_1(qname[p],value);return def;}}
def_1(qname,value,space);return value;}
function def_1(qname,value,space){qname=def.qualName(qname);space=def.space(qname.namespace,space);if(qname.name){space[qname.name]=value;value instanceof Object&&def.qualNameOf(value,qname);}}
function def_syncLog(level){def.log=def.logger("[DEF]");def_onDebugChanged&&def_onDebugChanged.forEach(function(f){f(level);});}
function def_debugLevel(){return def.debug;}
function def_loggerReal(prompt,target){prompt=def_evalPrompt(prompt,target);var logger=def_createLogFn("log",prompt);logger.log=logger;logger.level=def_debugLevel;def_logNames.forEach(function(name){logger[name]=def_createLogFn(def_logNamesMap[name]||name,prompt);});return logger;}
function def_evalPrompt(prompt,x){return prompt&&(def.fun.is(prompt)?prompt.call(x):prompt);}
function def_loggerAutoEnableOnce(target,loggerProp,prompt){var baseLogger=function(name){if(def.debug>1){var logger=target[loggerProp||"log"]=def_loggerReal(prompt,target);logger[name||"log"].apply(logger,A_slice.call(arguments,1));}else"error"===name&&def_logError.apply(null,def.array.append([def_evalPrompt(prompt,target)],arguments,1));},logger=baseLogger.bind("log");logger.log=logger;logger.level=def_debugLevel;def_logNames.forEach(function(name){logger[name]=baseLogger.bind(name);});return logger;}
function def_loggerDisabled(){function logger(){}
logger.log=logger;logger.level=def_debugLevel;def_logNames.forEach(function(name){logger[name]=logger;});return logger;}
function def_logError(prompt,e,s){e&&"object"==typeof e&&e.message&&(e=e.message);e=(prompt?prompt+": ":"")+def.nullyTo(e,"")+(s?" "+s:"");throw new Error(e);}
function def_createLogFn(name,prompt){var fun,c=console,m=c[name]||c.log;if(m){var mask=prompt?prompt+": %s":"%s";if(def.fun.is(m))fun=m.bind(c,mask);else{var apply=Function.prototype.apply;fun=function(){apply.call(m,c,def.array.append([mask],arguments));};}}
return fun;}
function def_priv_key(){function newSafe(value){function safe(){_channel=value;}
safe.toString=def_priv_safeToString;return safe;}
function key(safe){if(void 0!==_channel)throw new Error("Access denied.");var secret=(safe(),_channel);return _channel=void 0,secret;}
var _channel;key.safe=newSafe;key.property=def_priv_propCreate;return key;}
function def_priv_safeToString(){return"SAFE";}
function def_priv_propCreate(p,prefix){function instInit(inst,secret){def.setNonEnum(inst,p,key.safe(secret));return secret;}
function propKey(inst){return key(inst[p]);}
p||(p=def_priv_random(prefix));var key=this;propKey.init=instInit;propKey.propertyName=p;return propKey;}
function def_QualifiedName(full){var parts;if(full)if(full instanceof Array){parts=full;full=parts.join(".");}else parts=full.split(".");if(parts&&parts.length>1){this.name=parts.pop();this.namespace=parts.join(".");}else{this.name=full||null;this.namespace=null;}}
function def_getNamespace(name,base){var current=base||def_currentSpace;if(name){var parts=name.split("."),L=parts.length;if(L){var part,i=0;if(current===def.global){part=parts[0];var globalSpace=def.getOwn(def_globalSpaces,part);if(globalSpace){current=globalSpace;i++;}}
for(;i<L;){part=parts[i++];current=current[part]||(current[part]={});}}}
return current;}
function createMixin(protectNativeObject){return function(instance){return mixinMany(instance,A_slice.call(arguments,1),protectNativeObject);};}
function mixinMany(instance,mixins,protectNativeObject){for(var mixin,i=0,L=mixins.length;i<L;)if(mixin=mixins[i++]){mixin=def.object.as(mixin.prototype||mixin);mixin&&mixinRecursive(instance,mixin,protectNativeObject);}
return instance;}
function mixinRecursive(instance,mixin,protectNativeObject){for(var p in mixin)mixinProp(instance,p,mixin[p],protectNativeObject);}
function mixinProp(instance,p,vMixin,protectNativeObject){if(void 0!==vMixin){var oMixin,oTo=def.object.asNative(instance[p]);if(oTo){oMixin=def.object.as(vMixin);if(oMixin){O_hasOwn.call(instance,p)||(instance[p]=oTo=Object.create(oTo));mixinRecursive(oTo,oMixin,protectNativeObject);}else instance[p]=vMixin;}else{oMixin=def.object.asNative(vMixin);oMixin&&(vMixin=(protectNativeObject||Object.create)(oMixin));instance[p]=vMixin;}}}
function createRecursive(instance){var p,vObj;for(p in instance)(vObj=def.object.asNative(instance[p]))&&createRecursive(instance[p]=Object.create(vObj));}
function def_config(pub,config){if(config){var cfg=pub.configure;def.fun.is(cfg)?cfg.call(pub,config):def_config.generic(pub,config);}
return pub;}
function def_config_expand(configs,one){function processConfig(config){var root={};roots.push(root);for(var name in config)if(name){var v=config[name];if(void 0===v)continue;var L,i,n,next,curr=root,di=name.indexOf("."),names=null;if(di>=0){if(one){names=[name.substr(0,di)];name=name.substr(di+1);}else{names=name.split(".");name=names.pop();}
L=names.length;i=-1;for(;++i<L;)if(n=names[i]){next=curr[n];if(void 0===next)curr[n]=next={};else if(null===next||!def.object.is(next)||next.constructor!==Object){roots.push(root=next={});i=-1;}
curr=next;}}
var v0=curr[name];if(v0!==v){if(void 0!==v0){if(!def_config_isMergeableObject(v)||!def_config_isMergeableObject(v0))continue;roots.push(root=curr={});if(names){i=-1;for(;++i<L;)(n=names[i])&&(curr=curr[n]={});}}
curr[name]=v;}}}
if(!configs)return[];var roots=[];def.array.each(configs,processConfig);return roots;}
function def_config_isMergeableObject(v){return v&&def.object.is(v)&&!def_config_isCustomObject(v);}
function def_config_isCustomObject(v){return v.constructor!==Object&&!(v instanceof Array);}
function def_inherit(Ctor,BaseCtor){if(BaseCtor){var baseProto=BaseCtor.prototype,proto=Ctor.prototype=Object.create(baseProto);def.setNonEnum(proto,"constructor",Ctor);"__proto__"in proto||def.setNonEnum(proto,"__proto__",baseProto);}
return Ctor;}
function def_overrides(method,base,proto){function overridenClass(){var _=proto.base;proto.base=base;try{return method.apply(this,arguments);}finally{proto.base=_;}}
function overridenInstance(){var proto=def_safeProtoBase(this),_=proto.base;proto.base=base;try{return method.apply(this,arguments);}finally{proto.base=_;}}
if(!method)return base;if(!base||base===method||!def_callsBase(method))return method;def_validateProtoBase(proto);return def.fun.wraps(proto?overridenClass:overridenInstance,method);}
function def_callsBase(f){return _reCallsBase.test(f);}
function def_validateProtoBase(proto){if(proto===O_proto)throw def.error.invalidArgument("proto","Cannot change Object.prototype.");return proto;}
function def_safeProtoBase(inst){def_validateProtoBase(def.protoOf(inst));}
function def_inheritedMethod(proto,p){var m=def.fun.as(proto[p]);return m===O_proto[p]?null:m;}
function def_methods(proto,mixins,ka){proto=F_protoOrSelf(proto);var baseProto=def.protoOf(proto),rootProto=def.rootProtoOf(proto),enumerable=def.get(ka,"enumerable",!0);def.array.each(mixins,function(mixin){(mixin=F_protoOrSelf(mixin))&&(O_getOwnPropDesc?def.ownKeys(mixin).forEach(function(p){def_methodPropDesc_(proto,p,O_getOwnPropDesc(mixin,p),baseProto,rootProto,enumerable);}):def.eachOwn(mixin,function(v,p){def_method_(proto,p,v,baseProto,rootProto,enumerable);}));});return def;}
function def_method(proto,p,v,ka){proto=F_protoOrSelf(proto);var enumerable=def.get(ka,"enumerable",!0);return def_method_(proto,p,v,def.protoOf(proto),def.rootProtoOf(proto),enumerable);}
function def_isValidMethodName(p){return"base"!==p&&"constructor"!==p;}
function def_method_(proto,p,v,baseProto,rootProto,enumerable){void 0!==v&&baseProto[p]!==v&&def_isValidMethodName(p)&&def_methodValue(proto,p,v,rootProto,enumerable);return def;}
function def_methodValue(proto,p,v,rootProto,enumerable){var m;if(v&&(m=def.fun.as(v))){v=def.overrides(m,def_inheritedMethod(proto,p),rootProto);enumerable?proto[p]=v:def.setNonEnum(proto,p,v);}else mixinProp(proto,p,v,def.identity);}
function def_methodPropDesc_(proto,p,propDesc,baseProto,rootProto,enumerable){"use strict";var v;if(def_isValidMethodName(p))if(propDesc.get||propDesc.set){var basePropDesc=def_inheritedPropDesc(baseProto,p);if(basePropDesc){(propDesc.get||basePropDesc.get)&&(propDesc.get=def.overrides(propDesc.get,basePropDesc.get,rootProto));(propDesc.set||basePropDesc.set)&&(propDesc.set=def.overrides(propDesc.set,basePropDesc.set,rootProto));}
enumerable||(propDesc.enumerable=!1);O_defProp(proto,p,propDesc);}else void 0!==(v=propDesc.value)&&def_methodValue(proto,p,v,rootProto,enumerable);return def;}
function def_inheritedPropDesc(proto,p){var propDesc;if(p in proto)for(;proto=def.protoOf(proto);)if(propDesc=O_getOwnPropDesc(proto,p))return propDesc;}
function def_MetaType(TypeCtor,baseType,keyArgs){this.baseType=baseType||null;var MetaType=this.constructor;if(MetaType.Ctor)throw def.error.operationInvalid("MetaType already has an associated type constructor.");if(TypeCtor&&TypeCtor.Meta)throw def.error.argumentInvalid("TypeCtor","Specified type constructor already has an associated MetaType.");this.external=!!TypeCtor;this.rootType=baseType?baseType.rootType:this;this._init=baseType?baseType._init:null;this._post=baseType?baseType._post:null;var baseMixins=baseType&&baseType._mixins;this._mixins=baseMixins?baseMixins.slice():null;this.steps=void 0;TypeCtor=this._initConstructor(TypeCtor||this._createConstructor());this.Ctor=MetaType.Ctor=TypeCtor;}
function def_isMetaType(fun){return def.fun.is(fun)&&fun.meta instanceof def_MetaType;}
function def_MetaTypeStatic_methods(mixins,ka){def.methods(this,mixins,ka);var TypeCtor=this.Ctor;TypeCtor&&def_MetaTypeStatic_syncCtor.call(this,TypeCtor,mixins);return this;}
function def_MetaTypeStatic_syncCtor(TypeCtor,mixins){var TypeProto=this.prototype;def.array.each(mixins,function(mixin){def.each(F_protoOrSelf(mixin),function(v,p){if(!def.isPropPrivate(p)){v=TypeProto[p];def.fun.is(v)?def_MetaTypeStatic_exportMethod(TypeCtor,p,v):TypeCtor[p]=v;}});});}
function def_MetaTypeStatic_exportMethod(to,p,m){function exportedTypeMethod(){var metaType=this.meta,result=m.apply(metaType,arguments);return result===metaType?this:result;}
to[p]=def.fun.wraps(exportedTypeMethod,m);}
function fields_createChild(config){return def.classOf(this)(config,this);}
function def_makeSetter(name,spec){function setter(fields,v2){if(void 0!==v2){var v1=fields[name];if(null===v2){if(fields.___proto&&O_hasOwn.call(fields,name)){delete fields[name];v2=fields[name];change&&v2!==v1&&change(v2,v1,this,name);}}else if(v2!==v1){if(fail&&(msg=fail(v2)))throw new def.error.argumentInvalid(name,def.string.is(msg)?msg:"");cast&&(v2=convert.call(this,fields,v2,v1));if(null!=v2){fields[name]=v2;change&&change(v2,v1,this,name);}}}
return this;}
function convert(fields,v2,v1){var vSet=cast(v2);if(null==vSet){if(!configurable)return;if(O_hasOwn.call(fields,name)){def.configure(v1,v2);return;}
if(!factory)return;vSet=factory(v2,v1);}
return vSet;}
def.fun.is(spec)&&(spec={factory:spec});var msg,factory=def.get(spec,"factory"),configurable=def.get(spec,"configurable",!!factory),change=def.get(spec,"change"),cast=def.get(spec,"cast"),fail=def.get(spec,"fail");spec=null;return setter;}
function FieldsMetaType(Ctor,baseType,keyArgs){def.MetaType.apply(this,arguments);var baseType=this.baseType;baseType&&(this.fieldsPrivProp=baseType.constructor===FieldsMetaType?def.get(keyArgs,"fieldsPrivProp")||fields_privProp:baseType.fieldsPrivProp);}
function eventSource_on1(inst,type,handler,before){var hi,evs=def.lazy(inst,"__eventz"),has=evs[type]||(evs[type]={before:[],after:[],count:0});if(def.fun.is(handler))hi={handler:handler,_handler:null,_filter:null};else{if(!(handler instanceof Object))throw def.error.argumentInvalid("handler","Invalid type.");hi=handler;if(!hi.handler)throw def.error.argumentRequired("handler.handler");hi._filter=null;}
hi._handler=hi.handler;has[before?"before":"after"].push(hi);has.count++;inst._on&&inst._on(type,hi,!!before);}
function eventSource_off1(inst,type,handler){var evs,has,handlerFun;if(null!=handler)if(def.fun.is(handler))handlerFun=handler;else{if(!(handler instanceof Object))throw def.error.argumentInvalid("handler","Invalid type.");handlerFun=handler.handler;}
if((evs=inst.__eventz)&&(has=evs[type])&&has.count){var pha,hi,i,isAfter;if(handlerFun){pha=has.before;i=findHandlerIndex(pha,handlerFun);isAfter=i<0;if(isAfter){pha=has.after;i=findHandlerIndex(pha,handlerFun);if(i<0)return;}
hi=pha[i];if(0==--has.count)evs[type]=null;else{pha=pha.slice();pha.splice(i,1);has[isAfter?"after":"before"]=pha;}
eventSource_off1Core(inst,type,hi,!isAfter);}else{var befores=has.before,afters=has.after;evs[type]=null;i=befores.length;for(;i--;)eventSource_off1Core(inst,type,befores[i],!0);i=afters.length;for(;i--;)eventSource_off1Core(inst,type,afters[i],!1);}}}
function eventSource_off1Core(inst,type,hi,isBefore){inst._off&&inst._off(type,hi,isBefore);hi._filter=hi._handler=null;}
function eventSource_acting(source,type,defExpr){var evs,has,phaB,phaA,LB,LA;if((evs=source.__eventz)&&(has=evs[type])){LB=(phaB=has.before).length;LA=(phaA=has.after).length;}
if(!LA&&!LB&&!defExpr)return null;var preventable=!1,prevented=!1;return{type:type,phase:null,source:source,result:void 0,cancelable:!1,defaultPrevented:prevented,preventDefault:function(){preventable&&(this.defaultPrevented=prevented=!0);},trigger:function(ctx,args){if(this.phase)throw def.error.operationInvalid("Event can only be triggered once.");ctx||(ctx=source);args||(args=[this]);preventable=!!this.cancelable;var result;LB&&eventSource_actPhase(ctx,this,args,phaB,LB,!0);if(!preventable||!this.defaultPrevented){if(defExpr){this.phase="default";this.result=result=defExpr.apply(ctx,args);}
LA&&eventSource_actPhase(ctx,this,args,phaA,LA,!1);}
this.phase="done";return result;}};}
function eventSource_actPhase(inst,ev,args,has,L,before){var hi,i=-1;ev.phase=before?"before":"after";for(;++i<L;){hi=has[i];hi._filter&&!hi._filter.apply(inst,args)||hi._handler.apply(inst,args);}}
function eventSource_each(fun,inst,type,handler,before,allowNullHandler){if(def.string.is(type))eventSource_eachHandler(fun,inst,type,handler,before,allowNullHandler);else if(def.array.is(type))type.forEach(function(typei){if(!def.string.is(typei))throw def.error.argumentInvalid("type");eventSource_eachHandler(fun,inst,typei,handler,before,allowNullHandler);});else{if(!def.object.is(type))throw def.error.argumentInvalid("type");def.eachOwn(type,function(hi,typei){eventSource_eachHandler(fun,inst,typei,hi,before,allowNullHandler);});}}
function eventSource_eachHandler(fun,inst,type1,handler,before,allowNullHandler){if(!allowNullHandler&&!handler)throw def.error.argumentRequired("handler");def.array.is(handler)?handler.forEach(function(hi){fun(inst,type1,hi,before);}):fun(inst,type1,handler,before);}
function findHandlerIndex(a,e){for(var i=0,L=a.length;i<L;i++)if(a[i].handler===e)return i;return-1;}
function query_nextMany(){for(;this._source.next();){var manySource=this._selectMany?this._selectMany.call(this._ctx,this._source.item,this._source.index):this._source.item;if(null!=manySource){this._manySource=def.query(manySource);return!0;}}}
function mult10(value,exponent){if(!exponent)return value;value=value.toString().split("e");return+(value[0]+"e"+(value[1]?+value[1]+exponent:exponent));}
var IS_DONTENUM_BUGGY=function(){for(var p in{toString:1})if("toString"===p)return!1;return!0;}(),O_proto=Object.prototype,O_hasOwn=O_proto.hasOwnProperty,O_needEnumProps=IS_DONTENUM_BUGGY?["toString","valueOf"]:null;Object.keys||(Object.keys=function(o){if(o!==Object(o))throw new TypeError("Object.keys called on non-object");var ret=[];for(var p in o)O_hasOwn.call(o,p)&&ret.push(p);O_needEnumProps&&O_needEnumProps.forEach(function(p){O_hasOwn.call(o,p)&&ret.push(p);});return ret;});Array.prototype.some||(Array.prototype.some=function(fun){"use strict";for(var t=Object(this),len=t.length>>>0,thisArg=arguments.length>=2?arguments[1]:void 0,i=0;i<len;i++)if(i in t&&fun.call(thisArg,t[i],i,t))return!0;return!1;});Array.prototype.map||(Array.prototype.map=function(f,o){for(var n=this.length,result=new Array(n),i=0;i<n;i++)i in this&&(result[i]=f.call(o,this[i],i,this));return result;});Array.prototype.filter||(Array.prototype.filter=function(f,o){for(var n=this.length,result=new Array(),i=0;i<n;i++)if(i in this){var v=this[i];f.call(o,v,i,this)&&result.push(v);}
return result;});Array.prototype.forEach||(Array.prototype.forEach=function(f,o){for(var n=this.length>>>0,i=0;i<n;i++)i in this&&f.call(o,this[i],i,this);});Object.create||(Object.create=function(){function create(baseProto){Klass.prototype=baseProto||{};var instance=new Klass();Klass.prototype=proto;return instance;}
var Klass=function(){},proto=Klass.prototype;return create;}());Function.prototype.bind||(Function.prototype.bind=function(A_slice){return function(ctx){var staticArgs=A_slice.call(arguments,1),fToBind=this;return function(){return fToBind.apply(ctx,staticArgs.concat(A_slice.call(arguments)));};};}(Array.prototype.slice));this.JSON||(this.JSON={});this.JSON.stringify||(this.JSON.stringify=function(t){return String(t);});var A_slice=Array.prototype.slice,A_empty=[],O_defProp=function(){var defProp=Object.defineProperty;if(defProp)try{defProp({},"test",{});}catch(ex){return null;}
return defProp;}(),O_getOwnPropDesc=function(){var ownPropDesc=O_defProp&&Object.getOwnPropertyDescriptor;if(ownPropDesc&&null===ownPropDesc({value:null},"value").value)return ownPropDesc;}(),F_protoOrSelf=function(F){return F.prototype||F;};def.global=this;def.copyOwn=function(a,b){var to,from;arguments.length>=2?(to=a||{},from=b):(to={},from=a);for(var p in from)O_hasOwn.call(from,p)&&(to[p]=from[p]);return to;};def.copyOwn(def,{get:function(o,p,dv){var v;return o&&null!=(v=o[p])?v:dv;},gets:function(o,props){return props.map(function(p){return o[p];});},getPath:function(o,path,dv,create){if(!o)return dv;if(null!=path){var parts=def.array.is(path)?path:path.split("."),L=parts.length;if(L)for(var i=0;i<L;){var part=parts[i++],value=o[part];if(null==value){if(!create)return dv;value=o[part]=null==dv||isNaN(+dv)?{}:[];}
o=value;}}
return o;},setPath:function(o,path,v){if(o&&null!=path){var parts=def.array.is(path)?path:path.split(".");if(parts.length){var pLast=parts.pop();o=def.getPath(o,parts,pLast,!0);null!=o&&(o[pLast]=v);}}
return o;},propGet:function(p,dv){p=""+p;return function(o){return o?o[p]:dv;};},getOwn:function(o,p,dv){var v;return o&&O_hasOwn.call(o,p)&&null!=(v=o[p])?v:dv;},hasOwn:function(o,p){return!!o&&O_hasOwn.call(o,p);},protoOf:Object.getPrototypeOf||function(o){return o.__proto__||o.constructor&&o.constructor.prototype;},rootProtoOf:function(inst){for(var proto=null,proto2=def.protoOf(inst);proto2&&proto2!==O_proto&&proto2!==proto;)proto2=def.protoOf(proto=proto2);return proto;},hasOwnProp:O_hasOwn,set:function(o){for(var oo=o||{},a=arguments,i=1,A=a.length-1;i<A;i+=2)oo[a[i]]=a[i+1];return oo;},setDefaults:function(o,o2){var p,oo=o||{},a=arguments,A=a.length;if(2===A&&def.object.is(o2))def.each(o2,function(v,p){null==oo[p]&&(oo[p]=v);});else{A--;for(var i=1;i<A;i+=2){p=a[i];null==oo[p]&&(oo[p]=a[i+1]);}}
return oo;},setUDefaults:function(o,o2){var p,oo=o||{},a=arguments,A=a.length;if(2===A&&def.object.is(o2))def.each(o2,function(v,p){void 0===oo[p]&&(oo[p]=v);});else{A--;for(var i=1;i<A;i+=2){p=a[i];void 0===oo[p]&&(oo[p]=a[i+1]);}}
return oo;},setNonEnum:function(){if(!O_defProp)return function(o,p,v){o[p]=v;return o;};var nonEnumDesc={enumerable:!1,configurable:!0,writable:!0,value:void 0};return function(o,p,v){nonEnumDesc.value=v;O_defProp(o,p,nonEnumDesc);nonEnumDesc.value=null;return o;};}(),setConst:function(){if(!O_defProp)return function(o,p,v){o[p]=v;return o;};var constDesc={enumerable:!1,configurable:!1,writable:!1,value:void 0};return function(o,p,v){constDesc.value=v;O_defProp(o,p,constDesc);constDesc.value=null;return o;};}(),eachOwn:function(o,fun,ctx){for(var p in o)O_hasOwn.call(o,p)&&fun.call(ctx,o[p],p,o);o&&O_needEnumProps&&O_needEnumProps.forEach(function(p){O_hasOwn.call(o,p)&&fun.call(ctx,o[p],p,o);});},each:function(o,fun,ctx){for(var p in o)fun.call(ctx,o[p],p,o);o&&O_needEnumProps&&O_needEnumProps.forEach(function(p){O_hasOwn.call(o,p)&&fun.call(ctx,o[p],p,o);});},copy:function(a,b){var to,from;if(arguments.length>=2){to=a||{};from=b;}else{to={};from=a;}
def.each(from,function(v,p){to[p]=v;});return to;},copyx:function(to,from,keyArgs){var where=def.get(keyArgs,"where"),set=def.get(keyArgs,"set");def.each(from,function(v,p){where&&!where(from,p,to)||(set?set(to,p,v):to[p]=v);});return to;},copyProps:function(a,b,props){var to,from;arguments.length>=3?(to=a||{},from=b):(to={},from=a,props=b);if(props){var i=-1,L=props.length;if(from)for(;++i<L;)to[props[i]]=from[props[i]];else for(;++i<L;)to[props[i]]=void 0;}
return to;},keys:function(o){var keys=[];for(var p in o)keys.push(p);o&&O_needEnumProps&&O_needEnumProps.forEach(function(p){keys.push(p);});return keys;},values:function(o){var values=[];def.each(o,function(v){values.push(v);});return values;},uniqueIndex:function(o,key,ctx){var index={};def.each(o,function(v,p){key&&(v=key.call(ctx,v));null==v||O_hasOwn.call(index,v)||(index[v]=p);});return index;},ownKeys:Object.keys,own:function(o,f,ctx){var keys=Object.keys(o);return f?keys.map(function(key){return f.call(ctx,o[key],key);}):keys.map(function(key){return o[key];});},make:function(Ctor,args){var inst=Object.create(Ctor.prototype);return Ctor.apply(inst,args||A_empty)||inst;},isPropPrivate:function(p){return!!p&&"_"===p.charAt(0);},whiteList:function(o,ps){var o2=null;if(o)for(var L=ps.length,i=-1;++i<L;){var p=ps[i];if(p in o){null==o2&&(o2={});o2[p]=o[p];}}
return o2;}});def.object={is:function(v){return!!v&&"object"==typeof v;},isNative:function(v){return!!v&&v.constructor===Object;},as:function(v){return v&&"object"==typeof v?v:null;},asNative:function(v){return v&&v.constructor===Object?v:null;},lazy:function(scope,p,f,ctx){return scope[p]||(scope[p]=f?f.call(ctx,p):{});}};def.lazy=def.object.lazy;def.info=function(o,info){var i;if(o&&info){i=o.__info__;if(arguments.length<2)return i;i||def.setNonEnum(o,"__info__",i={});def.copyOwn(i,info);}
return o;};def.info.get=function(o,p,dv){return def.get(o&&o.__info__,p,dv);};def.copyOwn(def,{bit:{set:function(bits,set,on){return on||null==on?bits|set:bits&~set;}}});def.copyOwn(def,{compare:function(a,b){return a===b?0:a>b?1:-1;},compareReverse:function(a,b){return a===b?0:a>b?-1:1;},methodCaller:function(p,x){return x?function(){return x[p].apply(x,arguments);}:function(){return this[p].apply(this,arguments);};},identity:function(x){return x;},add:function(a,b){return a+b;},addPreservingNull:function(a,b){return null==a?b:null==b?a:a+b;},negate:function(f){return function(){return!f.apply(this,arguments);};},sqr:function(v){return v*v;},noop:function(){},retTrue:function(){return!0;},retFalse:function(){return!1;},fun:{is:function(v){return"function"==typeof v;},as:function(v){return"function"==typeof v?v:null;},to:function(v){return"function"==typeof v?v:def.fun.constant(v);},constant:function(v){return function(){return v;};},wraps:function(by,wrapped){by.valueOf=def.fun.constant(wrapped);return by;},typeFactory:function(Ctor){function typeFactory(){return def.make(Ctor,arguments);}
typeFactory.of=Ctor;return typeFactory;}}});def.ascending=def.compare;def.descending=def.compareReverse;def.number={is:function(v){return"number"==typeof v;},as:function(v,dv){return"number"==typeof v?v:dv;},to:function(v,dv){if(null==v)return dv;var v2=+v;return isNaN(v2)?dv:v2;},toPositive:function(v,dv){v=def.number.to(v);return null==v||v>0?v:dv;},toNonNegative:function(v,dv){v=def.number.to(v);return null!=v&&v<0?dv:v;},toBetween:function(v,vmin,vmax,dv){var v2=def.number.to(v);return null==v2?dv:Math.max(vmin,Math.min(vmax,v2));}};def.array={empty:function(v){return!(v&&v.length);},is:function(v){return v instanceof Array;},isLike:function(v){return v&&null!=v.length&&"string"!=typeof v;},as:function(thing){return thing instanceof Array?thing:null!=thing?[thing]:null;},to:function(thing){return thing instanceof Array?thing:null!=thing?[thing]:null;},lazy:function(scope,p,f,ctx){return scope[p]||(scope[p]=f?f.call(ctx,p):[]);},copy:function(al){return A_slice.apply(al,A_slice.call(arguments,1));},each:function(a,f,x){null!=a&&(def.array.is(a)?a.forEach(f,x):f.call(x,a,0));},eachReverse:function(a,f,x){if(null!=a)if(def.array.is(a)){for(var i=a.length;i--;)if(!1===f.call(x,a[i],i))return!1;}else if(!1===f.call(x,a,0))return!1;return!0;},like:def.copyOwn(function(v){return AL.is(v)?v:[v];},{is:function(v){return!!v&&null!=v.length&&"string"!=typeof v;},as:function(v){return AL.is(v)?v:null;}}),create:function(len,dv){var a=len>=0?new Array(len):[];if(void 0!==dv)for(var i=0;i<len;i++)a[i]=dv;return a;},append:function(target,source,start){null==start&&(start=0);for(var i=0,L=source.length,T=target.length;i<L;i++)target[T+i]=source[start+i];return target;},appendMany:function(target){var source,a=arguments,S=a.length;if(S>1)for(var s=1;s<S;s++)if(source=def.array.to(a[s]))for(var i=0,L=source.length;i<L;)target.push(source[i++]);return target;},prepend:function(target,source,start){null==start&&(start=0);for(var i=0,L=source.length;i<L;i++)target.unshift(source[start+i]);return target;},removeAt:function(array,index){return array.splice(index,1)[0];},insertAt:function(array,index,elem){array.splice(index,0,elem);return array;},removeIf:function(array,p,x){for(var i=0,L=array.length;i<L;)if(p.call(x,array[i],i)){L--;array.splice(i,1);}else i++;return array;},binarySearch:function(array,item,comparer,key){comparer||(comparer=def.compare);for(var low=0,high=array.length-1;low<=high;){var mid=low+high>>1,result=comparer(item,key?key(array[mid]):array[mid]);if(result<0)high=mid-1;else{if(!(result>0))return mid;low=mid+1;}}
return~low;},insert:function(array,item,comparer){var index=def.array.binarySearch(array,item,comparer);index<0?array.splice(~index,0,item):array[index]!==item&&array.splice(index+1,0,item);return index;},remove:function(array,item,comparer){var index=def.array.binarySearch(array,item,comparer);if(index>=0)return array.splice(index,1)[0];}};var AL=def.array.like;AL.to=AL;def.string={is:function(v){return"string"==typeof v;},to:function(v,ds){return null!=v?String(v):ds||"";},join:function(sep){var v,v2,a=arguments,L=a.length;switch(L){case 3:v=a[1];v2=a[2];return null!=v&&""!==v?null!=v2&&""!==v2?""+v+sep+v2:""+v:null!=v2&&""!==v2?""+v2:"";case 2:v=a[1];return null!=v?""+v:"";case 1:case 0:return"";}
for(var args=[],i=1;i<L;i++){v=a[i];null!=v&&""!==v&&args.push(""+v);}
return args.join(sep);},padRight:function(s,n,p){s||(s="");null==p&&(p=" ");var k=~~((n-s.length)/p.length);return k>0?s+new Array(k+1).join(p):s;}};def.copyOwn(def,{firstUpperCase:function(s){if(s){var c=s.charAt(0),cU=c.toUpperCase();c!==cU&&(s=cU+s.substr(1));}
return s;},firstLowerCase:function(s){if(s){var c=s.charAt(0),cL=c.toLowerCase();c!==cL&&(s=cL+s.substr(1));}
return s;},titleFromName:function(name){return def.firstUpperCase(name).replace(/([a-z\d])([A-Z])/g,"$1 $2");},format:function(mask,scope,ctx){if(null==mask||""===mask)return"";var isScopeFun=scope&&def.fun.is(scope);return mask.replace(/(^|[^{])\{([^{}]+)\}/g,function($0,before,prop){var value=scope?isScopeFun?scope.call(ctx,prop):scope[prop]:null;return before+(null==value?"":String(value));});}});def.copyOwn(def,{nullyTo:function(v,dv){return null!=v?v:dv;}});def.copyOwn(def,{between:function(v,min,max){return Math.max(min,Math.min(v,max));},nully:function(v){return null==v;},notNully:function(v){return null!=v;},notUndef:function(v){return void 0!==v;},empty:function(v){return null==v||""===v;},notEmpty:function(v){return null!=v&&""!==v;},truthy:function(x){return!!x;},falsy:function(x){return!x;}});def.copyOwn(def,{error:function(error){return error instanceof Error?error:new Error(error);},fail:function(error){throw def.error(error);},assert:function(msg,scope){throw def.error.assertionFailed(msg,scope);}});def.eachOwn({operationInvalid:function(msg,scope){return def.error(def.string.join(" ","Invalid operation.",def.format(msg,scope)));},notImplemented:function(){return def.error("Not implemented.");},argumentRequired:function(name){return def.error(def.format("Required argument '{0}'.",[name]));},argumentInvalid:function(name,msg,scope){return def.error(def.string.join(" ",def.format("Invalid argument '{0}'.",[name]),def.format(msg,scope)));},assertionFailed:function(msg,scope){return def.error(def.string.join(" ","Assertion failed.",def.format(msg,scope)));}},function(errorFun,name){def.error[name]=errorFun;def.fail[name]=function(){throw errorFun.apply(null,arguments);};});def.debug=0;!function(){if("undefined"!=typeof window&&window.location){var urlIfHasDebug=function(url){return url&&/\bdebug=true\b/.test(url)?url:null;},url=urlIfHasDebug(window.location.href);if(!url)try{url=urlIfHasDebug(window.top.location.href);}catch(e){}
if(url){var m=/\bdebugLevel=(\d+)/.exec(url);def.debug=m?+m[1]:3;}}}();def.logSeparator="------------------------------------------";def.setDebug=function(level){level=+level;level=isNaN(level)?0:level;level>1&&"undefined"==typeof console&&(level=1);if(!def.log||def.debug!=level){def.debug=level;def_syncLog(level);}
return def.debug;};var def_onDebugChanged=null;def.addOnDebugChanged=function(f){def_onDebugChanged||(def_onDebugChanged=[]).push(f);};var def_disabledLogger,def_logNames=["info","debug","error","warn","group","groupEnd"],def_logNamesMap={group:"groupCollapsed"};def.logger=function(prompt,target,loggerProp){return def.debug>1?def_loggerReal(prompt,target):target?def_loggerAutoEnableOnce(target,loggerProp,prompt):def_disabledLogger||(def_disabledLogger=def_loggerDisabled());};def.setDebug(def.debug);def.priv={key:def_priv_key};var def_priv_random=function(prefix){return"_"+def.nullyTo(prefix,"safe")+new Date().getTime()+Math.round(1e3*Math.random());},the_priv_key=def.priv.key();def.copyOwn(def,{scope:function(scopeFun,ctx){return scopeFun.call(ctx);},firstDefined:function(funs,args,x){var v,i=0,L=funs.length;args||(args=[]);for(;i<L;)if(void 0!==(v=funs[i++].apply(x,args)))return v;},indexedId:function(prefix,index){return index>0?prefix+""+(index+1):prefix;},splitIndexedId:function(indexedId){var match=/^(.*?)(\d*)$/.exec(indexedId),index=null;if(match[2]){index=Number(match[2]);index<=1?index=1:index--;}
return[match[1],index];},parseDistinctIndexArray:function(value,min,max){value=def.array.as(value);if(null==value)return null;null==min&&(min=0);null==max&&(max=1/0);var a=def.query(value).select(function(index){return+index;}).where(function(index){return!isNaN(index)&&index>=min&&index<=max;}).distinct().array();return a.length?a:null;},argumentsTypeBind:function(types,values){var V,T=types.length,result=new Array(T);if(T&&values&&(V=values.length)){var v=0,t=0;do{var value=values[v];if(null==value||typeof value===types[t]){result[t]=value;v++;}
t++;}while(t<T&&v<V);}
return result;},argumentsTypeBound:function(types,fun){return function(){var args=def.argumentsTypeBind(types,arguments);return fun.apply(this,args);};}});def.qualName=function(full){return full instanceof def_QualifiedName?full:new def_QualifiedName(full);};def.QualifiedName=def_QualifiedName;def_QualifiedName.prototype.toString=function(){return def.string.join(".",this.namespace,this.name);};def.qualNameOf=function(o,n){if(arguments.length>1){o.__qname__=def.qualName(n);return o;}
return o.__qname__;};var def_currentSpace=def,def_globalSpaces={},def_spaceStack=[];def.globalSpace=function(name,space){return def_globalSpaces[name]=space;};def.space=function(name,base,definition){if(def.fun.is(base)){definition=base;base=null;}
def.string.is(base)&&(base=def_getNamespace(base));var space=def_getNamespace(name,base);if(definition){def_spaceStack.push(def_currentSpace);try{definition(space);}finally{def_currentSpace=def_spaceStack.pop();}}
return space;};def.describe=function(t,keyArgs){var maxLevel=def.get(keyArgs,"maxLevel")||5,out=[];def.describeRecursive(out,t,maxLevel,keyArgs);return out.join("");};def.describeRecursive=function(out,t,remLevels,keyArgs){if(remLevels>0){remLevels--;switch(typeof t){case"undefined":return out.push("undefined");case"object":if(!t){out.push("null");return!0;}
if(def.fun.is(t.describe))return t.describe(out,remLevels,keyArgs);if(t instanceof Array){out.push("[");t.forEach(function(item,index){index&&out.push(", ");def.describeRecursive(out,item,remLevels,keyArgs)||out.pop();});out.push("]");}else if(t instanceof Date)out.push(t.toISOString());else{var ownOnly=def.get(keyArgs,"ownOnly",!0);if(t===def.global)return out.push("<window>"),!0;if(def.fun.is(t.cloneNode))return out.push("<dom #"+(t.id||t.name||"?")+">"),!0;if(remLevels>1&&t.constructor!==Object){remLevels=1;ownOnly=!0;}
out.push("{");var first=!0;for(var p in t)if(!ownOnly||def.hasOwnProp.call(t,p)){first||out.push(", ");out.push(p+": ");if(def.describeRecursive(out,t[p],remLevels,keyArgs))first&&(first=!1);else{out.pop();first||out.pop();}}
if(first){var s=""+t;"[object Object]"!==s&&out.push("{"+s+"}");}
out.push("}");}
return!0;case"number":out.push(""+Math.round(1e5*t)/1e5);return!0;case"boolean":out.push(""+t);return!0;case"string":out.push(JSON.stringify(t));return!0;case"function":return!!def.get(keyArgs,"funs",!1)&&(out.push(JSON.stringify(t.toString().substr(0,13)+"...")),!0);}
out.push("'new ???'");return!0;}};def.mixin=createMixin(Object.create);def.copyOwn(def.mixin,{custom:createMixin,inherit:def.mixin,copy:createMixin(def.copy),share:createMixin(def.identity)});def.create=function(){var mixins=A_slice.call(arguments),deep=!0,baseProto=mixins.shift();if("boolean"==typeof baseProto){deep=baseProto;baseProto=mixins.shift();}
var instance;if(baseProto){instance=Object.create(baseProto);deep&&createRecursive(instance);}else instance={};if(mixins.length>0){mixins.unshift(instance);def.mixin.apply(def,mixins);}
return instance;};def.attached=function(o,n,v){var at=o.__attached__;if(arguments.length>2){if(void 0!==v){at||def.setNonEnum(o,"__attached__",at={});at[n]=v;}
return o;}
return at&&at[n];};def.attached.is=function(n){return!(!n||n.indexOf("$")<0);};var def_configBlackList={tryConfigure:1,configure:1,$type:1};def.configure=def.config=def_config;def.configurable=function(yes,v){return def.info(v,{configurable:!!yes});};def.copyOwn(def_config,{generic:function(pub,configs){configs&&def.array.each(configs,function(config){var m;config.constructor===Object?def_config.setters(pub,config):pub!==config&&(m=pub.tryConfigure)&&def.fun.is(m)&&m.call(pub,config);});return pub;},isPropConfigurable:function(n){return!!n&&"_"!==n.charAt(0)&&!O_hasOwn.call(def_configBlackList,n);},setters:function(pub,config){config&&def_config.expand1(config).forEach(function(configx){def.each(configx,function(v,name){def_config.setter(pub,name,v);});});return pub;},setter:function(pub,name,value){var m,m0,l,v0;if(void 0!==value&&def_config.isPropConfigurable(name)&&def.fun.is(m=pub[name])&&(m0=m.valueOf())&&def.info.get(m0,"configurable",(l=m0.length)>=1))if(def.attached.is(name))def.attached(pub,name,value);else if(l)m.call(pub,value);else{v0=m.call(pub);(def.object.is(v0)||def.fun.is(v0))&&def_config(v0,value);}
return pub;},expand1:function(configs){return def_config_expand(configs,!0);},expand:def_config_expand});def.fun.inherit=def_inherit;def.overrides=def_overrides;def.fun.callsBase=def_callsBase;var _reCallsBase=/\.\s*base\b/;def.methods=def_methods;def.method=def_method;def.abstractMethod=def.fail.notImplemented;def("MetaType",def_MetaType);var metaTypeExcludeStaticCopy={Ctor:1,BaseType:1,prototype:1};def.copyOwn(def_MetaType,{methods:def_MetaTypeStatic_methods,add:def.configurable(!1,function(){return def_MetaTypeStatic_methods.apply(this,arguments);}),inst:def.configurable(!1,function(){return this.Ctor;}),subType:def.configurable(!1,function(MetaType,metaTypeConfig,metaTypeKeyArgs){var BaseMetaType=this,BaseTypeCtor=BaseMetaType.Ctor,baseMetaType=BaseTypeCtor&&BaseTypeCtor.meta||def.fail.operationInvalid("MetaType is not yet instantiated.");def.fun.inherit(MetaType,BaseMetaType);def.copyx(MetaType,BaseMetaType,{where:function(o,p){return O_hasOwn.call(o,p)&&"_"!==p.charAt(0)&&!O_hasOwn.call(metaTypeExcludeStaticCopy,p);}});MetaType.BaseType=BaseMetaType;new MetaType(null,baseMetaType,metaTypeKeyArgs);metaTypeConfig&&def.configure(MetaType,metaTypeConfig);return MetaType;}),extend:def.configurable(!1,function(typeConfig,typeKeyArgs){function MetaType(){return BaseMetaType.apply(this,arguments);}
var BaseMetaType=this;def.fun.wraps(MetaType,BaseMetaType);return BaseMetaType.subType(MetaType,typeConfig,typeKeyArgs);})});def_MetaType.add({closed:function(){return!!this.steps;},close:function(){this.steps||this._closeCore(this.steps=[]);return this;},_assertOpened:function(){if(this.closed())throw def.error.operationInvalid("MetaType is closed.");},_closeCore:function(steps){this._addPostSteps(steps);this._addInitSteps(steps);},_createConstructor:function(){function Class(){for(var i=S;i--;)!0===steps[i].apply(this,arguments)&&(i=S);}
var S=1,type=this,steps=[function(){steps=type.close().steps;S=steps.length;return!0;}];return Class;},_initConstructor:function(TypeCtor){var MetaType=this.constructor;def_MetaTypeStatic_syncCtor.call(MetaType,TypeCtor,MetaType);TypeCtor.meta=this;this.baseType&&def.fun.inherit(TypeCtor,this.baseType.close().Ctor);TypeCtor.MetaType=MetaType;return TypeCtor;},_addPostSteps:function(steps){def.array.eachReverse(this._mixins,function(mixin){mixin._post&&steps.push(mixin._post);});this._post&&steps.push(this._post);},_addInitSteps:function(steps){def.array.eachReverse(this._mixins,function(mixin){mixin._init&&steps.push(mixin._init);});this._init&&steps.push(this._init);},init:function(init){if(!init)throw def.error.argumentRequired("init");this._assertOpened();this._init=def.overrides(init,this._init,this.rootType.Ctor.prototype);return this;},postInit:function(postInit){if(!postInit)throw def.error.argumentRequired("postInit");this._assertOpened();this._post=def.overrides(postInit,this._post,this.rootType.Ctor.prototype);return this;},type:def.configurable(!0,function(){return this.constructor;}),add:def.configurable(!1,function(mixin,ka){def_isMetaType(mixin)&&this._mixMetaType(mixin.meta);return def.methods(this.Ctor,mixin,ka),this;}),_mixMetaType:function(meta){def.array.lazy(this,"_mixins").push(meta);},methods:function(mixins,ka){def.array.each(mixins,this.add,this);return this;},method:def.configurable(!1,function(p,v,ka){return def.method(this.Ctor,p,v,ka),this;}),configure:function(config){return def.configure.generic(this,config),this;},extend:def.configurable(!1,function(instConfig,typeKeyArgs){return this.constructor.extend(null,typeKeyArgs).Ctor.configure(instConfig);})});var def_Object=new def_MetaType().close().Ctor.add({override:function(p,v){return def_method_(this,p,v,def.protoOf(this),def_Object.prototype,!0),this;},toString:function(){return"[object "+String(def.qualNameOf(def.classOf(this)))+"]";}},{enumerable:!1});def("Object",def_Object);def.type=def.argumentsTypeBound(["string","function","object"],function(name,baseCtor,space){return def(name,(baseCtor?baseCtor.MetaType:def_MetaType).extend().Ctor,space);});def.makeEnum=function(a,ka){var i=1,all=0,e={},allItem=def.get(ka,"all"),zeroItem=def.get(ka,"zero");a.forEach(function(p){e[p]=i;allItem&&(all|=i);i<<=1;});zeroItem&&(e[zeroItem]=0);allItem&&(e[allItem]=all);return e;};def.copyOwn(def,{classify:function(v,Class){def.setNonEnum(v,"_class",Class);return v;},classOf:function(v){return v&&(v._class||v.constructor)||void 0;},is:function(v,Class){return!!v&&(v._class&&v._class===Class||v instanceof(Class.of||Class));},as:function(v,Class,dv){return def.is(v,Class)?v:dv;},createIs:function(Class){function isClass(v){return def.is(v,Class);}
return isClass;},createAs:function(Class){function asClass(v,dv){return def.as(v,Class,dv);}
return asClass;},isSubClassOf:function(Ctor,BaseCtor){return!(!Ctor||!BaseCtor)&&(Ctor===BaseCtor||def.is(F_protoOrSelf(Ctor),BaseCtor));}});var fields_privProp=the_priv_key.property();def.copyOwn(def,{instance:function(inst,config,proto,specs,privProp){var fields=def.fields(inst,proto,privProp);specs&&def.instanceAccessors(inst,fields,specs);inst.createChild=fields_createChild;config&&def.configure(inst,config);return fields;},fields:function(inst,proto,privProp){var klass=def.classOf(inst);proto&&def.is(proto,klass)||(proto=klass.defaults);void 0===privProp&&(privProp=fields_privProp);var protoFields=proto&&privProp&&privProp(proto),fields=protoFields?Object.create(protoFields):{};fields.___proto=proto;privProp&&privProp.init(inst,fields);return fields;},classAccessors:function(classOrProto,specs,privProp){var classProto=F_protoOrSelf(classOrProto);for(var name in specs)classProto[name]=def.classAccessor(name,specs[name],privProp);return def;},classAccessor:function(name,spec,privProp){function classAccessor(v){var fields=privProp(this);return arguments.length?setter.call(this,fields,v):fields[name];}
var setter=def_makeSetter(name,spec);privProp||(privProp=fields_privProp);return classAccessor;},instanceAccessors:function(inst,fields,specs){for(var name in specs)inst[name]=def.instanceAccessor(inst,name,specs[name],fields);return def;},instanceAccessor:function(inst,name,spec,fields){function instanceAccessor(v){return arguments.length?setter.call(inst,fields,v):fields[name];}
var setter=def_makeSetter(name,spec);return instanceAccessor;}});def.MetaType.subType(FieldsMetaType,{methods:{fields:function(specs){var accessors={};for(var name in specs)accessors[name]=def.classAccessor(name,specs[name],this.fieldsPrivProp);return this.methods(accessors);},_addInitSteps:function(steps){function initConfig(config,proto){config&&def.configure(this,config);}
function initFields(config,proto){def.fields(this,proto,type.fieldsPrivProp);}
steps.push(initConfig);this.base(steps);var type=this;steps.push(initFields);}}});def("FieldsBase",FieldsMetaType.Ctor);var nextGlobalId=1,nextIdByScope={};def.nextId=function(scope){if(scope){var nextId=def.getOwn(nextIdByScope,scope)||1;nextIdByScope[scope]=nextId+1;return nextId;}
return nextGlobalId++;};def.id=function(inst){var id=def.getOwn(inst,"__def_id__");id||def.setConst(inst,"__def_id__",id=def.nextId());return id;};def.hashKey=function(value){var t=(typeof value).charAt(0);switch(t){case"n":case"b":case"s":return t+":"+value;}
return t+":"+(value||def.id(value));};def("Set",def.Object.extend({init:function(source,count){this.source=source||{};this.count=source?null!=count?count:def.ownKeys(source).length:0;},methods:{has:function(p){return O_hasOwn.call(this.source,p);},add:function(p){var source=this.source;if(!O_hasOwn.call(source,p)){this.count++;source[p]=!0;}
return this;},rem:function(p){if(O_hasOwn.call(this.source,p)){delete this.source[p];this.count--;}
return this;},clear:function(){if(this.count){this.source={};this.count=0;}
return this;},members:function(){return def.ownKeys(this.source);}}}));def("Map",def.Object.extend({init:function(source,count){this.source=source||{};this.count=source?null!=count?count:def.ownKeys(source).length:0;},methods:{has:function(p){return O_hasOwn.call(this.source,p);},get:function(p){return O_hasOwn.call(this.source,p)?this.source[p]:void 0;},set:function(p,v){var source=this.source;O_hasOwn.call(source,p)||this.count++;source[p]=v;return this;},rem:function(p){if(O_hasOwn.call(this.source,p)){delete this.source[p];this.count--;}
return this;},clear:function(){if(this.count){this.source={};this.count=0;}
return this;},copy:function(other){def.eachOwn(other.source,function(value,p){this.set(p,value);},this);},values:function(){return def.own(this.source);},keys:function(){return def.ownKeys(this.source);},clone:function(){return new def.Map(def.copy(this.source),this.count);},symmetricDifference:function(other){if(!this.count)return other.clone();if(!other.count)return this.clone();var result={},count=0,as=this.source,bs=other.source;def.eachOwn(as,function(a,p){if(!O_hasOwn.call(bs,p)){result[p]=a;count++;}});def.eachOwn(bs,function(b,p){if(!O_hasOwn.call(as,p)){result[p]=b;count++;}});return new def.Map(result,count);},intersect:function(other,result){result||(result=new def.Map());def.eachOwn(this.source,function(value,p){other.has(p)&&result.set(p,value);});return result;}}}));def("OrderedMap",def.Object.extend({init:function(baseMap){if(baseMap instanceof def.OrderedMap){this._list=baseMap._list.slice();this._map=def.copy(baseMap._map);}else{this._list=[];this._map={};}},methods:{has:function(key){return O_hasOwn.call(this._map,key);},count:function(){return this._list.length;},get:function(key){var map=this._map;return O_hasOwn.call(map,key)?map[key].value:void 0;},at:function(index){var bucket=this._list[index];return bucket?bucket.value:void 0;},add:function(key,v,index){var map=this._map,bucket=O_hasOwn.call(map,key)&&map[key];if(bucket)bucket.value!==v&&(bucket.value=v);else{bucket=map[key]={key:key,value:v};null==index?this._list.push(bucket):def.array.insertAt(this._list,index,bucket);}
return this;},rem:function(key){var map=this._map,bucket=O_hasOwn.call(map,key)&&map[key];if(bucket){var index=this._list.indexOf(bucket);this._list.splice(index,1);delete this._map[key];}
return this;},clear:function(){if(this._list.length){this._map={};this._list.length=0;}
return this;},keys:function(){return def.ownKeys(this._map);},forEach:function(fun,ctx){return this._list.forEach(function(bucket){fun.call(ctx,bucket.value,bucket.key);});}}}));def("EventSource",def.Object.extend({methods:{on:function(type,handler){return eventSource_each(eventSource_on1,this,type,handler,!0),this;},before:function(type,handler){return eventSource_each(eventSource_on1,this,type,handler,!0),this;},after:function(type,handler){return eventSource_each(eventSource_on1,this,type,handler,!1),this;},off:function(type,handler){return eventSource_each(eventSource_off1,this,type,handler,null,!0),this;},_acting:function(type,defExpr){if(!type)throw def.error.argumentRequired("type");return eventSource_acting(this,type,defExpr);}}}));def.html={escape:function(str){return def.string.to(str).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;");},tag:function(name,attrs){attrs=attrs?def.ownKeys(attrs).map(function(n){var v=attrs[n];return def.empty(v)?"":" "+n+'="'+String(v)+'"';}).join(""):"";var content=arguments.length>2?A_slice.call(arguments,2).map(function(cont){if(null!=cont){def.fun.is(cont)&&(cont=cont());cont=def.array.is(cont)?cont.map(def.string.to).join(""):def.string.to(cont);}
return cont||"";}).join(""):"";return"<"+name+attrs+">"+content+"</"+name+">";},classes:function(prefix){prefix=prefix?prefix+"-":"";var out=[];A_slice.call(arguments,1).forEach(function(s,i){def.empty(s)||out.push(prefix+def.css.escapeClass(s));});return out.join(" ");}};def.css={escapeClass:function(name){return(name||"").replace(/\s/g,"_");}};def.type("Query").add({index:-1,item:void 0,next:function(){var me=this,index=me.index;if(-2===index)return!1;index++;if(!me._next(index)){me._finish();return!1;}
me.index=index;return!0;},_next:def.abstractMethod,_finish:function(){var me=this;if(me.index>-2){me.next=def.retFalse;me.index=-2;delete me.item;}},each:function(f,x){for(var me=this;me.next();)if(!1===f.call(x,me.item,me.index))return!0;return!1;},array:function(to){for(var array=to||[],me=this;me.next();)array.push(me.item);return array;},sort:function(compare,by){compare||(compare=def.compare);if(by){var keyCompare=compare;compare=function(a,b){return keyCompare(by(a),by(b));};}
var sorted=this.array().sort(compare);return new def.ArrayLikeQuery(sorted);},object:function(keyArgs){for(var target=def.get(keyArgs,"target")||{},nameFun=def.get(keyArgs,"name"),valueFun=def.get(keyArgs,"value"),ctx=def.get(keyArgs,"context");this.next();){target[""+(nameFun?nameFun.call(ctx,this.item,this.index):this.item)]=valueFun?valueFun.call(ctx,this.item,this.index):this.item;}
return target;},reduce:function(accumulator){var result,i=0;if(arguments.length<2){if(!this.next())throw new TypeError("Length is 0 and no second argument");result=this.item;}else result=arguments[1];for(;this.next();){result=accumulator(result,this.item,this.index);++i;}
return result;},count:function(){for(var count=0;this.next();)count++;return count;},first:function(pred,ctx,dv){for(;this.next();)if(!pred||pred.call(ctx,this.item,this.index)){var item=this.item;this._finish();return item;}
return dv;},last:function(pred,ctx,dv){for(var theItem=dv;this.next();)pred&&!pred.call(ctx,this.item,this.index)||(theItem=this.item);return theItem;},any:function(pred,ctx){for(;this.next();)if(!pred||pred.call(ctx,this.item,this.index))return this._finish(),!0;return!1;},all:function(pred,ctx){for(;this.next();)if(!pred.call(ctx,this.item,this.index))return this._finish(),!1;return!0;},min:function(){for(var min=null;this.next();)(null===min||this.item<min)&&(min=this.item);return min;},max:function(){for(var max=null;this.next();)(null===max||this.item>max)&&(max=this.item);return max;},range:function(){for(var min=null,max=null;this.next();){var item=this.item;if(null===min)min=max=item;else{item<min&&(min=item);item>max&&(max=item);}}
return null!=min?{min:min,max:max}:null;},multipleIndex:function(keyFun,ctx){var keyIndex={};this.each(function(item){var key=keyFun?keyFun.call(ctx,item):item;if(null!=key){(def.getOwn(keyIndex,key)||(keyIndex[key]=[])).push(item);}});return keyIndex;},uniqueIndex:function(keyFun,ctx){var keyIndex={};this.each(function(item){var key=keyFun?keyFun.call(ctx,item):item;null==key||O_hasOwn.call(keyIndex,key)||(keyIndex[key]=item);});return keyIndex;},select:function(fun,ctx){return new def.SelectQuery(this,fun,ctx);},prop:function(p){return new def.SelectQuery(this,function(item){if(item)return item[p];});},selectMany:function(fun,ctx){return new def.SelectManyQuery(this,fun,ctx);},union:function(){var queries=def.array.append([this],arguments);return new def.SelectManyQuery(new def.ArrayLikeQuery(queries));},where:function(fun,ctx){return fun?new def.WhereQuery(this,fun,ctx):this;},distinct:function(fun,ctx){return fun?new def.DistinctQuery(this,fun,ctx):this;},skip:function(n){return new def.SkipQuery(this,n);},take:function(n){return n<=0?new def.NullQuery():isFinite(n)?new def.TakeQuery(this,n):this;},whayl:function(pred,ctx){return new def.WhileQuery(this,pred,ctx);},reverse:function(){return new def.ReverseQuery(this);}});def.type("NullQuery",def.Query).add({next:def.retFalse});def.type("AdhocQuery",def.Query).init(function(next){this._next=next;});def.type("ArrayLikeQuery",def.Query).init(function(list){function arraLike_next(){for(;++i<I;)if(O_hasOwn.call(list,i)){me.index=i;me.item=list[i];return!0;}
me._finish();return!1;}
var me=this;def.array.isLike(list)||(list=[list]);me._list=list;me._count=list.length;var i=-1,I=list.length;me.next=arraLike_next;}).add({count:function(){var remaining=this._count;this.index>=0&&(remaining-=this.index+1);this._finish();return remaining;}});def.type("RangeQuery",def.Query).init(function(start,count,step){this._index=start;this._count=count;this._step=null==step?1:step;}).add({_next:function(nextIndex){if(nextIndex<this._count){this.item=this._index;this._index+=this._step;return!0;}},count:function(){var remaining=this._count;this.index>=0&&(remaining-=this.index+1);this._finish();return remaining;}});def.type("WhereQuery",def.Query).init(function(source,p,x){function where_next(){for(;source.next();){var e=source.item;if(p.call(x,e,source.index)){me.item=e;me.index=++i;return!0;}}
me._finish();return!1;}
var me=this,i=-1;me.next=where_next;});def.type("WhileQuery",def.Query).init(function(s,p,x){function while_next(){if(s.next()){var e=s.item;if(p.call(x,e,s.index)){me.item=e;me.index=++i;return!0;}}
me._finish();return!1;}
var me=this,i=-1;me.next=while_next;});def.type("SelectQuery",def.Query).init(function(s,f,x){function select_next(){if(s.next()){me.item=f.call(x,s.item,s.index);me.index=++i;return!0;}
me._finish();return!1;}
var me=this,i=-1;me.next=select_next;});def.type("SelectManyQuery",def.Query).init(function(source,selectMany,ctx){this._selectMany=selectMany;this._ctx=ctx;this._source=source;this._manySource=null;}).add({_next:function(nextIndex){for(;;){if(this._manySource){if(this._manySource.next()){this.item=this._manySource.item;return!0;}
this._manySource=null;}
if(!query_nextMany.call(this))break;}}});def.type("DistinctQuery",def.Query).init(function(s,k,x){function distinct_next(){for(;s.next();){var e=s.item,v=k?k.call(x,e,s.index):e;if(null!=v&&!O_hasOwn.call(ks,v)){me.item=e;me.index=++i;return ks[v]=!0;}}
me._finish();return!1;}
var me=this,i=-1,ks={};me.next=distinct_next;});def.type("SkipQuery",def.Query).init(function(source,skip){this._source=source;this._skip=skip;}).add({_next:function(nextIndex){for(;this._source.next();){if(!(this._skip>0)){this.item=this._source.item;return!0;}
this._skip--;}}});def.type("TakeQuery",def.Query).init(function(source,take){this._source=source;this._take=take;}).add({_next:function(nextIndex){if(this._take>0&&this._source.next()){this._take--;this.item=this._source.item;return!0;}}});def.type("ReverseQuery",def.Query).init(function(source){this._source=source;}).add({_next:function(nextIndex){if(!nextIndex){this._source instanceof def.Query&&(this._source=this._source instanceof def.ArrayLikeQuery?this._source._list:this._source.array());this._count=this._source.length;}
var count=this._count;if(nextIndex<count){for(var index=count-nextIndex-1,source=this._source;!O_hasOwn.call(source,index);){if(--index<0)return!1;this._count--;}
this.item=source[index];return!0;}}});def.query=function(q){return void 0===q?new def.NullQuery():q instanceof def.Query?q:def.fun.is(q)?new def.AdhocQuery(q):new def.ArrayLikeQuery(q);};def.range=function(start,count,step){return new def.RangeQuery(start,count,step);};def.textTable=function(C){function table(){return rows.map(function(r){switch(r){case rowSepMarkerFirst:return renderRow(r,"","","","");case rowSepMarker:return rowSep||(rowSep=renderRow(r,"","","",""));case rowSepMarkerLast:return renderRow(r,"","","","");}
return renderRow(r,""," ","","");}).join("\n");}
function renderRow(r,colSep,pad,first,last){return first+r.map(function(s,i){return def.string.padRight(s||"",colsMaxLen[i],pad);}).join(colSep)+last;}
var rowSep,rows=[],colsMaxLen=new Array(C),rowSepMarkerFirst=def.array.create(C,""),rowSepMarker=rowSepMarkerFirst.slice(),rowSepMarkerLast=rowSepMarkerFirst.slice();table.row=function(){for(var v,s,args=arguments,i=-1,r=new Array(C);++i<C;){v=args[i];s=r[i]=" "+(void 0===v?"":String(v))+" ";colsMaxLen[i]=Math.max(colsMaxLen[i]||0,s.length);}
rows.push(r);return table;};table.rowSep=function(isLast){rows.push(rows.length?isLast?rowSepMarkerLast:rowSepMarker:rowSepMarkerFirst);return table;};return table;};def.round10=function(value,places){if(!places)return Math.round(value);value=+value;if(isNaN(value)||"number"!=typeof places||places%1!=0)return NaN;value=Math.round(mult10(value,places));return mult10(value,-places);};def.mult10=function(value,exponent){return exponent?mult10(+value,exponent):value;};def.delta=function(a,b){if(a===b)return 0;var d=a-b;return d<0?-d:d;};def_currentSpace=def.global;return def;});
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+
this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}
return output;},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}
if(enc4!=64){output=output+String.fromCharCode(chr3);}}
output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}};
pen.define("cdf-legacy/lib/CCC/jquery.tipsy",["cdf-legacy/jquery"],function(jQuery){!function($){function fixTitle($ele){var title=$ele.attr("title");(title||"string"!=typeof $ele.attr("original-title"))&&$ele.attr("original-title",title||"").removeAttr("title");}
function Tipsy(element,options){this.$element=$(element);this.options=options;this.enabled=!0;fixTitle(this.$element);}
Tipsy.prototype={enter:function(){var tipsy=this,options=this.options;if(0==options.delayIn){tipsy.hoverState=null;tipsy.show();}else{tipsy.hoverState="in";setTimeout(function(){if("in"===tipsy.hoverState){tipsy.hoverState=null;tipsy.show();}},options.delayIn);}},leave:function(){var tipsy=this,options=this.options;if(0==options.delayOut)tipsy.hide();else{tipsy.hoverState="out";setTimeout(function(){"out"===tipsy.hoverState&&tipsy.hide();},options.delayOut);}},visible:function(){var parent;return"in"===this.hoverState||"out"!==this.hoverState&&!(!this.$tip||!(parent=this.$tip[0].parentNode)||11===parent.nodeType);},update:function(){this.visible()?this.show(!0):this.enter();},setOptions:function(options){options=$.extend({},$.fn.tipsy.defaults,options);null==options.arrowVisible&&(options.arrowVisible=!options.useCorners);this.options=$.fn.tipsy.elementOptions(this.$element[0],options);},show:function(isUpdate){function calcPosition(gravity){var tp;switch(gravity.charAt(0)){case"n":tp={top:pos.top+pos.height+tipOffset,left:pos.left+pos.width/2-actualWidth/2};break;case"s":tp={top:pos.top-actualHeight-tipOffset,left:pos.left+pos.width/2-actualWidth/2};break;case"e":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth-tipOffset};break;case"w":tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width+tipOffset};}
2===gravity.length&&("w"==gravity.charAt(1)?tp.left=useCorners?pos.left+pos.width+tipOffset:pos.left+pos.width/2-15:tp.left=useCorners?pos.left-actualWidth-tipOffset:pos.left+pos.width/2-actualWidth+15);return tp;}
if("in"!==this.hoverState){var title=this.getTitle();if(this.enabled&&title){var $tip=this.tip(),tip=$tip[0];$tip.find(".tipsy-inner")[this.options.html?"html":"text"](title);var className=this.options.className;tip.className="tipsy"+(className?" "+className:"");isUpdate||$tip.remove();var parent=tip.parentNode;parent&&11!==parent.nodeType||$tip.css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(document.body);var pos,$elem=this.$element,elem=$elem[0];if("getBoundingClientRect"in elem){var rect=elem.getBoundingClientRect(),$doc=$(document);pos={left:rect.left+$doc.scrollLeft(),top:rect.top+$doc.scrollTop(),width:rect.right-rect.left,height:rect.bottom-rect.top};}else{pos=$.extend({},$elem.offset());pos.width=elem.offsetWidth;pos.height=elem.offsetHeight;}
var actualWidth,actualHeight,tipOffset=this.options.offset,useCorners=this.options.useCorners,showArrow=this.options.arrowVisible;if("getBoundingClientRect"in tip){var tipRect=tip.getBoundingClientRect();actualWidth=tipRect.right-tipRect.left;actualHeight=tipRect.bottom-tipRect.top;}else{actualWidth=tip.offsetWidth;actualHeight=tip.offsetHeight;}
showArrow||(tipOffset-=4);var gravity=this.options.gravity;"function"==typeof gravity&&(gravity=gravity.call(elem,{width:actualWidth,height:actualHeight},calcPosition));var tp=calcPosition(gravity);$tip.addClass("tipsy-"+gravity+(useCorners&&gravity.length>1?gravity.charAt(1):""));var cssNow,cssAnim,anim=this.options.animate;isUpdate&&anim>0?cssAnim=tp:cssNow=tp;if(showArrow){var hideArrow=useCorners&&2===gravity.length;$tip.find(".tipsy-arrow")[hideArrow?"hide":"show"]();}
if(this.options.fade&&!isUpdate){cssNow=$.extend(cssNow||{},{opacity:0,display:"block",visibility:"visible"});cssAnim=$.extend(cssAnim||{},{opacity:this.options.opacity});}else cssNow=$.extend(cssNow||{},{visibility:"visible",opacity:this.options.opacity});cssNow&&$tip.css(cssNow);cssAnim&&$tip.stop().animate(cssAnim,anim>0?anim:400);this._prevGravity=gravity;this.hoverState=null;}else{this.hoverState=null;this.hide();}}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){$(this).remove();}):this.$tip&&this.tip().remove();this.hoverState=null;},setTitle:function(title){title=null==title?"":""+title;this.$element.attr("original-title",title).removeAttr("title");},getTitle:function(){var title,$e=this.$element,o=this.options;fixTitle($e);"string"==typeof o.title?title=$e.attr("title"==o.title?"original-title":o.title):"function"==typeof o.title&&(title=o.title.call($e[0]));title=(""+title).replace(/(^\s*|\s*$)/,"");return title||o.fallback;},tip:function(){if(!this.$tip){var className=this.options.className;this.$tip=$('<div class="tipsy'+(className?" "+className:"")+'"></div>');this.options.arrowVisible?this.$tip.html('<div class="tipsy-arrow"></div><div class="tipsy-inner"/></div>'):this.$tip.html('<div class="tipsy-inner"/></div>');this.$tip.remove();}
return this.$tip;},validate:function(){var parent=this.$element[0].parentNode;if(!parent||11===parent.nodeType){this.hide();this.$element=null;this.options=null;}},enable:function(){this.enabled=!0;},disable:function(){this.enabled=!1;},toggleEnabled:function(){this.enabled=!this.enabled;}};$.fn.tipsy=function(options,arg){function get(ele){var tipsy=$.data(ele,"tipsy");if(!tipsy){tipsy=new Tipsy(ele,$.fn.tipsy.elementOptions(ele,options));$.data(ele,"tipsy",tipsy);}
return tipsy;}
function enter(){get(this).enter();}
function leave(){get(this).leave();}
if(!0===options)return this.data("tipsy");if("string"==typeof options)return this.data("tipsy")[options](arg);options=$.extend({},$.fn.tipsy.defaults,options);null==options.arrowVisible&&(options.arrowVisible=!options.useCorners);options.live||this.each(function(){get(this);});if("manual"!=options.trigger){var binder=options.live?"live":"bind",eventIn="hover"==options.trigger?"mouseenter":"focus",eventOut="hover"==options.trigger?"mouseleave":"blur";this[binder](eventIn,enter)[binder](eventOut,leave);}
return this;};$.fn.tipsy.defaults={delayIn:0,delayOut:0,animate:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover",useCorners:!1,arrowVisible:null,className:""};$.fn.tipsy.elementOptions=function(ele,options){return $.metadata?$.extend({},options,$(ele).metadata()):options;};$.fn.tipsy.autoNS=function(){return $(this).offset().top>$(document).scrollTop()+$(window).height()/2?"s":"n";};$.fn.tipsy.autoWE=function(){return $(this).offset().left>$(document).scrollLeft()+$(window).width()/2?"e":"w";};}(jQuery);return jQuery;});
pen.define("cdf-legacy/lib/CCC/protovis",[],function(){function correctSRgbComponent(s){s/=255;return s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4);}
Array.prototype.map||(Array.prototype.map=function(f,o){for(var n=this.length,result=new Array(n),i=0;i<n;i++)i in this&&(result[i]=f.call(o,this[i],i,this));return result;});Array.prototype.filter||(Array.prototype.filter=function(f,o){for(var n=this.length,result=new Array(),i=0;i<n;i++)if(i in this){var v=this[i];f.call(o,v,i,this)&&result.push(v);}
return result;});Array.prototype.forEach||(Array.prototype.forEach=function(f,o){for(var n=this.length>>>0,i=0;i<n;i++)i in this&&f.call(o,this[i],i,this);});Array.prototype.reduce||(Array.prototype.reduce=function(f,v){var len=this.length;if(!len&&1==arguments.length)throw new Error("reduce: empty array, no initial value");var i=0;if(arguments.length<2)for(;;){if(i in this){v=this[i++];break;}
if(++i>=len)throw new Error("reduce: no values, no initial value");}
for(;i<len;i++)i in this&&(v=f(v,this[i],i,this));return v;});Array.prototype.indexOf||(Array.prototype.indexOf=function(s,from){for(var n=this.length>>>0,i=!isFinite(from)||from<0?0:from>this.length?this.length:from;i<n;i++)if(this[i]===s)return i;return-1;});Date.now||(Date.now=function(){return+new Date();});Object.create||(Object.create=function(proto){function g(){}
g.prototype=proto;return new g();});var pv={};pv.version={major:3,minor:3};pv.identity=function(x){return x;};pv.index=function(){return this.index;};pv.child=function(){return this.childIndex;};pv.parent=function(){return this.parent.index;};!function(){pv.extend=function(f){return Object.create(f.prototype||f);};pv.extendType=function(g,f){(g.prototype=pv.extend(f)).constructor=g;return g;};pv.parse=function(js){for(var m,d,re=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),i=0,s="";m=re.exec(js);){var j=m.index+m[0].length;if("{"!=js.charAt(j)){s+=js.substring(i,j)+"{return ";i=j;for(var p=0;p>=0&&j<js.length;j++){var c=js.charAt(j);switch(c){case'"':case"'":for(;++j<js.length&&(d=js.charAt(j))!=c;)"\\"==d&&j++;break;case"[":case"(":p++;break;case"]":case")":p--;break;case";":case",":0==p&&p--;}}
s+=pv.parse(js.substring(i,--j))+";}";i=j;}
re.lastIndex=j;}
s+=js.substring(i);return s;};pv.error=function(e){"undefined"!=typeof console&&console.error?console.error(e):alert(e);};pv.listen=function(target,type,listener){listener=pv.listener(listener);if("load"===type||"onload"===type)return pv.listenForPageLoad(listener);if(target.addEventListener)target.addEventListener(type,listener,!1);else{target===window&&(target=document.documentElement);target.attachEvent("on"+type,listener);}
return listener;};pv.unlisten=function(target,type,listener){listener.$listener&&(listener=listener.$listener);target.removeEventListener?target.removeEventListener(type,listener,!1):target.detachEvent("on"+type,listener);};pv.listenForPageLoad=function(listener){"complete"!==document.readyState?document.addEventListener?window.addEventListener("load",listener,!1):document.attachEvent&&window.attachEvent("onload",listener):listener(null);};pv.listener=function(f){return f.$listener||(f.$listener=function(ev){try{pv.event=ev=ev&&pv.fixEvent(ev);return f.call(this,ev);}catch(ex){pv.error(ex);}finally{delete pv.event;}});};pv.fixEvent=function(ev){if(null==ev.pageX&&null!=ev.clientX){var eventDoc=ev.target&&ev.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body;ev.pageX=1*ev.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);ev.pageY=1*ev.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0);}
return ev;};pv.ancestor=function(a,e){for(;e;){if(e===a)return!0;e=e.parentNode;}
return!1;};pv.removeChildren=function(p){for(;p.lastChild;)p.removeChild(p.lastChild);};pv.getWindow=function(elem){return null!=elem&&elem==elem.window?elem:9===elem.nodeType&&(elem.defaultView||elem.parentWindow);};var _reHiphenSep=/\-([a-z])/g;pv.hiphen2camel=function(prop){return _reHiphenSep.test(prop)?prop.replace(_reHiphenSep,function($0,$1){return $1.toUpperCase();}):prop;};var _getCompStyle=window.getComputedStyle;pv.css=function(e,p){return _getCompStyle?_getCompStyle.call(window,e,null).getPropertyValue(p):e.currentStyle["float"===p?"styleFloat":pv.hiphen2camel(p)];};pv.cssStyle=function(e){var style;if(_getCompStyle){style=_getCompStyle.call(window,e,null);return function(p){return style.getPropertyValue(p);};}
style=e.currentStyle;return function(p){return style["float"===p?"styleFloat":pv.hiphen2camel(p)];};};pv._getElementsByClass=function(searchClass,node){null==node&&(node=document);for(var classElements=[],els=node.getElementsByTagName("*"),L=els.length,pattern=new RegExp("(^|\\s)"+searchClass+"(\\s|$)"),i=0,j=0;i<L;i++)if(pattern.test(els[i].className)){classElements[j]=els[i];j++;}
return classElements;};pv.getElementsByClassName=function(node,classname){return node.getElementsByClassName?node.getElementsByClassName(classname):pv._getElementsByClass(classname,node);};pv.elementOffset=function(elem){var doc=elem&&elem.ownerDocument;if(doc){var body=doc.body;if(body!==elem){var box;box=void 0!==elem.getBoundingClientRect?elem.getBoundingClientRect():{top:0,left:0};var win=pv.getWindow(doc),docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,scrollTop=win.pageYOffset||docElem.scrollTop,scrollLeft=win.pageXOffset||docElem.scrollLeft;return{top:box.top+scrollTop-clientTop-(elem.scrollTop||0),left:box.left+scrollLeft-clientLeft-(elem.scrollLeft||0)};}}};pv.renderer=function(){var renderer=document.svgImplementation||"nativesvg";pv.renderer=function(){return renderer;};return renderer;};var _id=1;pv.id=function(){return _id++;};pv.functor=function(v){return"function"==typeof v?v:function(){return v;};};pv.stringLowerCase=function(s){return String(s).toLowerCase();};pv.get=function(o,p,dv){var v;return o&&null!=(v=o[p])?v:dv;};var hasOwn=Object.prototype.hasOwnProperty;pv.lazyArrayOwn=function(o,p){var v;return o&&hasOwn.call(o,p)&&(v=o[p])?v:o[p]=[];};pv.parseNumNonNeg=function(v,dv){null!=v&&("string"==typeof v?v=+v:"number"!=typeof v&&(v=null));return null==v||isNaN(v)||v<0?null==dv?0:dv:v;};var epsilon=pv.epsilon=1e-6;pv.floatLess=function(a,b){return!pv.floatEqual(a,b)&&a<b;};pv.floatLessOrEqual=function(a,b){return a<b||pv.floatEqual(a,b);};pv.floatGreater=function(a,b){return!pv.floatEqual(a,b)&&a>b;};pv.floatEqual=function(a,b){return Math.abs(b-a)<epsilon;};pv.floatZero=function(value){return Math.abs(value)<epsilon;};pv.floatBelongsOpen=function(min,value,max){return pv.floatLess(min,value)&&pv.floatLess(value,max);};pv.floatBelongsClosed=function(min,value,max){return pv.floatLessOrEqual(min,value)&&pv.floatLessOrEqual(value,max);};}();pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.xlen=pv.$.x.length;for(;pv.$.i<pv.$.xlen;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if("text/javascript+protovis"==pv.$.s.type)try{window.eval(pv.parse(pv.$.s.text));}catch(e){pv.error(e);}}
delete pv.$;});pv.Format={};pv.Format.re=function(s){return s.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&");};pv.Format.pad=function(c,n,s){var m=n-String(s).length;return m<1?s:new Array(m+1).join(c)+s;};pv.Format.date=function(pattern){function format(d){return pattern.replace(/%[a-zA-Z0-9]/g,function(s){switch(s){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][d.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][d.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][d.getMonth()];case"%c":return d.toLocaleString();case"%C":return pad("0",2,Math.floor(d.getFullYear()/100)%100);case"%d":return pad("0",2,d.getDate());case"%x":case"%D":return pad("0",2,d.getMonth()+1)+"/"+pad("0",2,d.getDate())+"/"+pad("0",2,d.getFullYear()%100);case"%e":return pad(" ",2,d.getDate());case"%H":return pad("0",2,d.getHours());case"%I":var h=d.getHours()%12;return h?pad("0",2,h):12;case"%m":return pad("0",2,d.getMonth()+1);case"%M":return pad("0",2,d.getMinutes());case"%n":return"\n";case"%p":return d.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var h=d.getHours()%12;return(h?pad("0",2,h):12)+":"+pad("0",2,d.getMinutes())+":"+pad("0",2,d.getSeconds())+" "+(d.getHours()<12?"AM":"PM");case"%R":return pad("0",2,d.getHours())+":"+pad("0",2,d.getMinutes());case"%S":return pad("0",2,d.getSeconds());case"%Q":return pad("0",3,d.getMilliseconds());case"%t":return"\t";case"%u":var w=d.getDay();return w||1;case"%w":return d.getDay();case"%y":return pad("0",2,d.getFullYear()%100);case"%Y":return d.getFullYear();case"%%":return"%";}
return s;});}
var pad=pv.Format.pad;format.format=format;format.parse=function(s){var year=1970,month=0,date=1,hour=0,minute=0,second=0,fields=[function(){}],re=pv.Format.re(pattern).replace(/%[a-zA-Z0-9]/g,function(s){switch(s){case"%b":fields.push(function(x){month={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[x];});return"([A-Za-z]+)";case"%h":case"%B":fields.push(function(x){month={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[x];});return"([A-Za-z]+)";case"%e":case"%d":fields.push(function(x){date=x;});return"([0-9]+)";case"%I":case"%H":fields.push(function(x){hour=x;});return"([0-9]+)";case"%m":fields.push(function(x){month=x-1;});return"([0-9]+)";case"%M":fields.push(function(x){minute=x;});return"([0-9]+)";case"%p":fields.push(function(x){12==hour?"am"==x&&(hour=0):"pm"==x&&(hour=Number(hour)+12);});return"(am|pm)";case"%S":fields.push(function(x){second=x;});return"([0-9]+)";case"%y":fields.push(function(x){x=Number(x);year=x+(0<=x&&x<69?2e3:x>=69&&x<100?1900:0);});return"([0-9]+)";case"%Y":fields.push(function(x){year=x;});return"([0-9]+)";case"%%":fields.push(function(){});return"%";}
return s;}),match=s.match(re);match&&match.forEach(function(m,i){fields[i](m);});return new Date(year,month,date,hour,minute,second);};return format;};pv.Format.time=function(type){function format(t){t=Number(t);switch(type){case"short":return t>=31536e6?(t/31536e6).toFixed(1)+" years":t>=6048e5?(t/6048e5).toFixed(1)+" weeks":t>=864e5?(t/864e5).toFixed(1)+" days":t>=36e5?(t/36e5).toFixed(1)+" hours":t>=6e4?(t/6e4).toFixed(1)+" minutes":(t/1e3).toFixed(1)+" seconds";case"long":var a=[],s=t%6e4/1e3>>0,m=t%36e5/6e4>>0;a.push(pad("0",2,s));if(t>=36e5){var h=t%864e5/36e5>>0;a.push(pad("0",2,m));if(t>=864e5){a.push(pad("0",2,h));a.push(Math.floor(t/864e5).toFixed());}else a.push(h.toFixed());}else a.push(m.toFixed());return a.reverse().join(":");}}
var pad=pv.Format.pad;format.format=format;format.parse=function(s){switch(type){case"short":for(var a,re=/([0-9,.]+)\s*([a-z]+)/g,t=0;a=re.exec(s);){var f=parseFloat(a[0].replace(",","")),u=0;switch(a[2].toLowerCase()){case"year":case"years":u=31536e6;break;case"week":case"weeks":u=6048e5;break;case"day":case"days":u=864e5;break;case"hour":case"hours":u=36e5;break;case"minute":case"minutes":u=6e4;break;case"second":case"seconds":u=1e3;}
t+=f*u;}
return t;case"long":var a=s.replace(",","").split(":").reverse(),t=0;a.length&&(t+=1e3*parseFloat(a[0]));a.length>1&&(t+=6e4*parseFloat(a[1]));a.length>2&&(t+=36e5*parseFloat(a[2]));a.length>3&&(t+=864e5*parseFloat(a[3]));return t;}};return format;};pv.Format.number=function(){function format(x){1/0>maxf&&(x=Math.round(x*maxk)/maxk);var s=String(Math.abs(x)).split("."),i=s[0];i.length>maxi&&(i=i.substring(i.length-maxi));padg&&i.length<mini&&(i=new Array(mini-i.length+1).join(padi)+i);i.length>3&&(i=i.replace(/\B(?=(?:\d{3})+(?!\d))/g,group));!padg&&i.length<mins&&(i=new Array(mins-i.length+1).join(padi)+i);s[0]=x<0?np+i+ns:i;var f=s[1]||"";f.length>maxf&&(f=s[1]=f.substr(0,maxf));f.length<minf&&(s[1]=f+new Array(minf-f.length+1).join(padf));return s.join(decimal);}
var mini=0,maxi=1/0,mins=0,minf=0,maxf=0,maxk=1,padi="0",padf="0",padg=!0,decimal=".",group=",",np="",ns="";format.format=format;format.parse=function(x){var re=pv.Format.re,s=String(x).split(decimal);1==s.length&&(s[1]="");s[0].replace(new RegExp("^("+re(padi)+")*"),"");s[1].replace(new RegExp("("+re(padf)+")*$"),"");var i=s[0].replace(new RegExp(re(group),"g"),"");i.length>maxi&&(i=i.substring(i.length-maxi));var f=s[1]?Number("0."+s[1]):0;1/0>maxf&&(f=Math.round(f*maxk)/maxk);return Math.round(i)+f;};format.integerDigits=function(min,max){if(arguments.length){mini=Number(min);maxi=arguments.length>1?Number(max):mini;mins=mini+Math.floor(mini/3)*group.length;return this;}
return[mini,maxi];};format.fractionDigits=function(min,max){if(arguments.length){minf=Number(min);maxf=arguments.length>1?Number(max):minf;maxk=Math.pow(10,maxf);return this;}
return[minf,maxf];};format.integerPad=function(x){if(arguments.length){padi=String(x);padg=/\d/.test(padi);return this;}
return padi;};format.fractionPad=function(x){if(arguments.length){padf=String(x);return this;}
return padf;};format.decimal=function(x){if(arguments.length){decimal=String(x);return this;}
return decimal;};format.group=function(x){if(arguments.length){group=x?String(x):"";mins=mini+Math.floor(mini/3)*group.length;return this;}
return group;};format.negativeAffix=function(x,y){if(arguments.length){np=String(x||"");ns=String(y||"");return this;}
return[np,ns];};return format;};!function(){var _cache;pv.Text={};pv.Text.createCache=function(){return new FontSizeCache();};pv.Text.usingCache=function(cache,fun,ctx){if(!(cache instanceof FontSizeCache))throw new Error("Not a valid cache.");var prevCache=_cache;_cache=cache;try{return fun.call(ctx);}finally{_cache=prevCache;}};pv.Text.measure=function(text,font){text=null==text?"":String(text);var bbox=_cache&&_cache.get(font,text);if(!bbox){bbox=text?this.measureCore(text,font):{width:0,height:0};_cache&&_cache.put(font,text,bbox);}
return bbox;};pv.Text.measureWidth=function(text,font){return pv.Text.measure(text,font).width;};pv.Text.fontHeight=function(font){return pv.Text.measure("M",font).height;};pv.Text.measureCore=function(){function getTextSizeElement(){return _svgText||(_svgText=createTextSizeElement());}
function createTextSizeElement(){var div=document.createElement("div");div.id="pvSVGText_"+new Date().getTime();var style=div.style;style.position="absolute";style.visibility="hidden";style.width=0;style.height=0;style.left=0;style.top=0;style.lineHeight=1;style.textTransform="none";style.letterSpacing="normal";style.whiteSpace="nowrap";var svgElem=pv.SvgScene.create("svg");svgElem.setAttribute("font-size","10px");svgElem.setAttribute("font-family","sans-serif");div.appendChild(svgElem);var svgText=pv.SvgScene.create("text");svgElem.appendChild(svgText);svgText.appendChild(document.createTextNode(""));document.body.appendChild(div);return svgText;}
var _svgText,_lastFont="10px sans-serif";return function(text,font){font||(font=null);var svgText=getTextSizeElement();if(_lastFont!==font){_lastFont=font;pv.SvgScene.setStyle(svgText,{font:font});}
svgText.firstChild.nodeValue=String(text);var box;try{box=svgText.getBBox();}catch(ex){"function"==typeof console.error&&console.error("GetBBox failed: ",ex);throw ex;}
return{width:box.width,height:box.height};};}();var FontSizeCache=function(){this._fontsCache={};},hasOwnProp=Object.prototype.hasOwnProperty;FontSizeCache.prototype._getFont=function(font){font=font||"";return hasOwnProp.call(this._fontsCache,font)?this._fontsCache[font]:this._fontsCache[font]={};};FontSizeCache.prototype.get=function(font,text){text=text||"";var fontCache=this._getFont(font);return hasOwnProp.call(fontCache,text)?fontCache[text]:null;};FontSizeCache.prototype.put=function(font,text,size){return this._getFont(font)[text||""]=size;};}();pv.map=function(array,f){var o={};return f?array.map(function(d,i){o.index=i;return f.call(o,d);}):array.slice();};pv.repeat=function(array,n){1==arguments.length&&(n=2);return pv.blend(pv.range(n).map(function(){return array;}));};pv.array=function(len,dv){var a=len>=0?new Array(len):[];if(void 0!==dv)for(var i=0;i<len;i++)a[i]=dv;return a;};pv.cross=function(a,b){for(var array=[],i=0,n=a.length,m=b.length;i<n;i++)for(var j=0,x=a[i];j<m;j++)array.push([x,b[j]]);return array;};pv.blend=function(arrays){return Array.prototype.concat.apply([],arrays);};pv.transpose=function(arrays){var n=arrays.length,m=pv.max(arrays,function(d){return d.length;});if(m>n){arrays.length=m;for(var i=n;i<m;i++)arrays[i]=new Array(n);for(var i=0;i<n;i++)for(var j=i+1;j<m;j++){var t=arrays[i][j];arrays[i][j]=arrays[j][i];arrays[j][i]=t;}}else{for(var i=0;i<m;i++)arrays[i].length=n;for(var i=0;i<n;i++)for(var j=0;j<i;j++){var t=arrays[i][j];arrays[i][j]=arrays[j][i];arrays[j][i]=t;}}
arrays.length=m;for(var i=0;i<m;i++)arrays[i].length=n;return arrays;};pv.normalize=function(array,f){for(var norm=pv.map(array,f),sum=pv.sum(norm),i=0;i<norm.length;i++)norm[i]/=sum;return norm;};pv.permute=function(array,indexes,f){f||(f=pv.identity);var p=new Array(indexes.length),o={};indexes.forEach(function(j,i){o.index=j;p[i]=f.call(o,array[j]);});return p;};pv.numerate=function(keys,f){f||(f=pv.identity);var map={},o={};keys.forEach(function(x,i){o.index=i;map[f.call(o,x)]=i;});return map;};pv.uniq=function(array,f){f||(f=pv.identity);var y,map={},keys=[],o={};array.forEach(function(x,i){o.index=i;y=f.call(o,x);y in map||(map[y]=keys.push(y));});return keys;};pv.naturalOrder=function(a,b){return a<b?-1:a>b?1:0;};pv.reverseOrder=function(b,a){return a<b?-1:a>b?1:0;};pv.search=function(array,value,f){f||(f=pv.identity);for(var low=0,high=array.length-1;low<=high;){var mid=low+high>>1,midValue=f(array[mid]);if(midValue<value)low=mid+1;else{if(!(midValue>value))return mid;high=mid-1;}}
return-low-1;};pv.search.index=function(array,value,f){var i=pv.search(array,value,f);return i<0?-i-1:i;};pv.range=function(start,stop,step){if(1==arguments.length){stop=start;start=0;}
void 0==step&&(step=1);if((stop-start)/step==1/0)throw new Error("range must be finite");var j,array=[],i=0;stop-=1e-10*(stop-start);if(step<0)for(;(j=start+step*i++)>stop;)array.push(j);else for(;(j=start+step*i++)<stop;)array.push(j);return array;};pv.random=function(start,stop,step){if(1==arguments.length){stop=start;start=0;}
void 0==step&&(step=1);return step?Math.floor(Math.random()*(stop-start)/step)*step+start:Math.random()*(stop-start)+start;};pv.sum=function(array,f){var o={};return array.reduce(f?function(p,d,i){o.index=i;return p+f.call(o,d);}:function(p,d){return p+d;},0);};pv.max=function(array,f){return f==pv.index?array.length-1:Math.max.apply(null,f?pv.map(array,f):array);};pv.max.index=function(array,f){if(!array.length)return-1;if(f==pv.index)return array.length-1;f||(f=pv.identity);for(var maxi=0,maxx=-1/0,o={},i=0;i<array.length;i++){o.index=i;var x=f.call(o,array[i]);if(x>maxx){maxx=x;maxi=i;}}
return maxi;};pv.min=function(array,f){return f==pv.index?0:Math.min.apply(null,f?pv.map(array,f):array);};pv.min.index=function(array,f){if(!array.length)return-1;if(f==pv.index)return 0;f||(f=pv.identity);for(var mini=0,minx=1/0,o={},i=0;i<array.length;i++){o.index=i;var x=f.call(o,array[i]);if(x<minx){minx=x;mini=i;}}
return mini;};pv.mean=function(array,f){return pv.sum(array,f)/array.length;};pv.median=function(array,f){if(f==pv.index)return(array.length-1)/2;array=pv.map(array,f).sort(pv.naturalOrder);if(array.length%2)return array[Math.floor(array.length/2)];var i=array.length/2;return(array[i-1]+array[i])/2;};pv.variance=function(array,f){if(array.length<1)return NaN;if(1==array.length)return 0;var mean=pv.mean(array,f),sum=0,o={};f||(f=pv.identity);for(var i=0;i<array.length;i++){o.index=i;var d=f.call(o,array[i])-mean;sum+=d*d;}
return sum;};pv.deviation=function(array,f){return Math.sqrt(pv.variance(array,f)/(array.length-1));};pv.log=function(x,b){return Math.log(x)/Math.log(b);};pv.logSymmetric=function(x,b){return 0==x?0:x<0?-pv.log(-x,b):pv.log(x,b);};pv.logAdjusted=function(x,b){if(!isFinite(x))return x;var negative=x<0;x<b&&(x+=(b-x)/b);return negative?-pv.log(x,b):pv.log(x,b);};pv.logFloor=function(x,b){return x>0?Math.pow(b,Math.floor(pv.log(x,b))):-Math.pow(b,-Math.floor(-pv.log(-x,b)));};pv.logCeil=function(x,b){return x>0?Math.pow(b,Math.ceil(pv.log(x,b))):-Math.pow(b,-Math.ceil(-pv.log(-x,b)));};!function(){var _radians=Math.PI/180,_degrees=180/Math.PI;pv.radians=function(degrees){return _radians*degrees;};pv.degrees=function(radians){return _degrees*radians;};}();pv.keys=function(map){var array=[];for(var key in map)array.push(key);return array;};pv.entries=function(map){var array=[];for(var key in map)array.push({key:key,value:map[key]});return array;};pv.values=function(map){var array=[];for(var key in map)array.push(map[key]);return array;};pv.dict=function(keys,f){for(var m={},o={},i=0;i<keys.length;i++)if(i in keys){var k=keys[i];o.index=i;m[k]=f.call(o,k);}
return m;};pv.hasOwnProp=Object.prototype.hasOwnProperty;pv.copyOwn=function(a,b){if(b){var hop=pv.hasOwnProp;for(var p in b)hop.call(b,p)&&(a[p]=b[p]);}
return a;};pv.dom=function(map){return new pv.Dom(map);};pv.Dom=function(map){this.$map=map;};pv.Dom.prototype.$leaf=function(n){return"object"!=typeof n;};pv.Dom.prototype.leaf=function(f){if(arguments.length){this.$leaf=f;return this;}
return this.$leaf;};pv.Dom.prototype.root=function(nodeName){function recurse(map){var n=new pv.Dom.Node();for(var k in map){var v=map[k];n.appendChild(leaf(v)?new pv.Dom.Node(v):recurse(v)).nodeName=k;}
return n;}
var leaf=this.$leaf,root=recurse(this.$map);root.nodeName=nodeName;return root;};pv.Dom.prototype.nodes=function(){return this.root().nodes();};pv.Dom.Node=function(value){void 0!==value&&(this.nodeValue=value);};pv.Dom.Node.prototype.nodeValue=void 0;pv.Dom.Node.prototype.childNodes=[];pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype._firstDirtyChildIndex=1/0;pv.Dom.Node.prototype._childIndex=-1;pv.Dom.Node.prototype.findChildIndex=function(n){if(!n)throw new Error("Argument 'n' required");if(n.parentNode===this){var i=n.childIndex(!0);if(i>-1)return i;}
throw new Error("child not found");};pv.Dom.Node.prototype._childRemoved=function(n,i){};pv.Dom.Node.prototype._childAdded=function(n,i){};pv.Dom.Node.prototype.removeChild=function(n){var i=this.findChildIndex(n);return this.removeAt(i);};pv.Dom.Node.prototype.appendChild=function(n){var pn=n.parentNode;pn&&pn.removeChild(n);var lc=this.lastChild;n.parentNode=this;n.previousSibling=lc;if(lc){lc.nextSibling=n;n._childIndex=lc._childIndex+1;}else{this.firstChild=n;n._childIndex=0;}
this.lastChild=n;var L=pv.lazyArrayOwn(this,"childNodes").push(n);this._childAdded(n,L-1);return n;};pv.Dom.Node.prototype.insertBefore=function(n,r){if(!r)return this.appendChild(n);var i=this.findChildIndex(r);return this.insertAt(n,i);};pv.Dom.Node.prototype.insertAt=function(n,i){if(null==i)return this.appendChild(n);var ns=this.childNodes,L=ns.length;if(i===L)return this.appendChild(n);if(i<0||i>L)throw new Error("Index out of range.");var pn=n.parentNode;pn&&pn.removeChild(n);var ni=i+1;ni<this._firstDirtyChildIndex&&(this._firstDirtyChildIndex=ni);var r=ns[i];n.parentNode=this;n.nextSibling=r;n._childIndex=i;var psib=n.previousSibling=r.previousSibling;r.previousSibling=n;if(psib)psib.nextSibling=n;else{r===this.lastChild&&(this.lastChild=n);this.firstChild=n;}
ns.splice(i,0,n);this._childAdded(n,i);return n;};pv.Dom.Node.prototype.removeAt=function(i){var ns=this.childNodes,L=ns.length;if(!(i<0||i>=L)){var n=ns[i];ns.splice(i,1);i<L-1&&i<this._firstDirtyChildIndex&&(this._firstDirtyChildIndex=i);var psib=n.previousSibling,nsib=n.nextSibling;psib?psib.nextSibling=nsib:this.firstChild=nsib;nsib?nsib.previousSibling=psib:this.lastChild=psib;n.nextSibling=n.previousSibling=n.parentNode=null;this._childRemoved(n,i);return n;}};pv.Dom.Node.prototype.replaceChild=function(n,r){var i=this.findChildIndex(r),pn=n.parentNode;pn&&pn.removeChild(n);n.parentNode=this;n.nextSibling=r.nextSibling;n._childIndex=r._childIndex;var psib=n.previousSibling=r.previousSibling;psib?psib.nextSibling=n:this.firstChild=n;var nsib=r.nextSibling;nsib?nsib.previousSibling=n:this.lastChild=n;this.childNodes[i]=n;this._childRemoved(r,i);this._childAdded(n,i);return r;};pv.Dom.Node.prototype.childIndex=function(noRebuild){var p=this.parentNode;if(p){var di=p._firstDirtyChildIndex;if(di<1/0){var ns=p.childNodes;if(!noRebuild)return ns.indexOf(this);for(var L=ns.length;di<L;){ns[di]._childIndex=di;di++;}
p._firstDirtyChildIndex=1/0;}
return this._childIndex;}
return-1;};pv.Dom.Node.prototype.visitBefore=function(f){function visit(n,d){f(n,d);for(var c=n.firstChild;c;c=c.nextSibling)visit(c,d+1);}
visit(this,0);};pv.Dom.Node.prototype.visitAfter=function(f){function visit(n,d){for(var c=n.firstChild;c;c=c.nextSibling)visit(c,d+1);f(n,d);}
visit(this,0);};pv.Dom.Node.prototype.sort=function(f){if(this.firstChild){this._firstDirtyChildIndex=1/0;var cs=this.childNodes;cs.sort(f);var c,p=this.firstChild=cs[0];delete p.previousSibling;p._childIndex=0;for(var i=1,L=cs.length;i<L;i++){p.sort(f);c=cs[i];c._childIndex=i;c.previousSibling=p;p=p.nextSibling=c;}
this.lastChild=p;delete p.nextSibling;p.sort(f);}
return this;};pv.Dom.Node.prototype.reverse=function(){var childNodes=[];this.visitAfter(function(n){this._firstDirtyChildIndex=1/0;for(var c;c=n.lastChild;)childNodes.push(n.removeChild(c));if(childNodes.length)for(;c=childNodes.pop();)n.insertBefore(c,n.firstChild);});return this;};pv.Dom.Node.prototype.nodes=function(){var array=[];this.visitBefore(function(n){array.push(n);});return array;};pv.Dom.Node.prototype.toggle=function(recursive){if(recursive)return this.toggled?this.visitBefore(function(n){n.toggled&&n.toggle();}):this.visitAfter(function(n){n.toggled||n.toggle();});var c,n=this;if(n.toggled){for(;c=n.toggled.pop();)n.appendChild(c);delete n.toggled;}else if(c=n.lastChild){n.toggled=[];do{n.toggled.push(n.removeChild(c));}while(c=n.lastChild);}};pv.nodes=function(values){for(var root=new pv.Dom.Node(),i=0,V=values.length;i<V;i++)root.appendChild(new pv.Dom.Node(values[i]));return root.nodes();};pv.tree=function(array){return new pv.Tree(array);};pv.Tree=function(array){this.array=array;};pv.Tree.prototype.keys=function(k){this.k=k;return this;};pv.Tree.prototype.value=function(v){this.v=v;return this;};pv.Tree.prototype.map=function(){for(var map={},o={},i=0;i<this.array.length;i++){o.index=i;for(var value=this.array[i],keys=this.k.call(o,value),node=map,j=0;j<keys.length-1;j++)node=node[keys[j]]||(node[keys[j]]={});node[keys[j]]=this.v?this.v.call(o,value):value;}
return map;};pv.nest=function(array){return new pv.Nest(array);};pv.Nest=function(array){this.array=array;this.keys=[];};pv.Nest.prototype.key=function(key){this.keys.push(key);return this;};pv.Nest.prototype.sortKeys=function(order){this.keys[this.keys.length-1].order=order||pv.naturalOrder;return this;};pv.Nest.prototype.sortValues=function(order){this.order=order||pv.naturalOrder;return this;};pv.Nest.prototype.map=function(){for(var i,map={},values=[],j=0;j<this.array.length;j++){var x=this.array[j],m=map;for(i=0;i<this.keys.length-1;i++){var k=this.keys[i](x);m[k]||(m[k]={});m=m[k];}
k=this.keys[i](x);if(!m[k]){var a=[];values.push(a);m[k]=a;}
m[k].push(x);}
if(this.order)for(var i=0;i<values.length;i++)values[i].sort(this.order);return map;};pv.Nest.prototype.entries=function(){function entries(map){var array=[];for(var k in map){var v=map[k];array.push({key:k,values:v instanceof Array?v:entries(v)});}
return array;}
function sort(array,i){var o=this.keys[i].order;o&&array.sort(function(a,b){return o(a.key,b.key);});if(++i<this.keys.length)for(var j=0;j<array.length;j++)sort.call(this,array[j].values,i);return array;}
return sort.call(this,entries(this.map()),0);};pv.Nest.prototype.rollup=function(f){function rollup(map){for(var key in map){var value=map[key];value instanceof Array?map[key]=f(value):rollup(value);}
return map;}
return rollup(this.map());};pv.flatten=function(map){return new pv.Flatten(map);};pv.Flatten=function(map){this.map=map;this.keys=[];};pv.Flatten.prototype.key=function(key,f){this.keys.push({name:key,value:f});delete this.$leaf;return this;};pv.Flatten.prototype.leaf=function(f){this.keys.length=0;this.$leaf=f;return this;};pv.Flatten.prototype.array=function(){function recurse(value,i){if(leaf(value))entries.push({keys:stack.slice(),value:value});else for(var key in value){stack.push(key);recurse(value[key],i+1);stack.pop();}}
function visit(value,i){if(i<keys.length-1)for(var key in value){stack.push(key);visit(value[key],i+1);stack.pop();}else entries.push(stack.concat(value));}
var entries=[],stack=[],keys=this.keys,leaf=this.$leaf;if(leaf){recurse(this.map,0);return entries;}
visit(this.map,0);return entries.map(function(stack){for(var m={},i=0;i<keys.length;i++){var k=keys[i],v=stack[i];m[k.name]=k.value?k.value.call(null,v):v;}
return m;});};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform();pv.Transform.prototype.translate=function(x,y){var v=new pv.Transform();v.k=this.k;v.x=this.k*x+this.x;v.y=this.k*y+this.y;return v;};pv.Transform.prototype.scale=function(k){var v=new pv.Transform();v.k=this.k*k;v.x=this.x;v.y=this.y;return v;};pv.Transform.prototype.invert=function(){var v=new pv.Transform(),k=1/this.k;v.k=k;v.x=-this.x*k;v.y=-this.y*k;return v;};pv.Transform.prototype.times=function(m){var v=new pv.Transform();v.k=this.k*m.k;v.x=this.k*m.x+this.x;v.y=this.k*m.y+this.y;return v;};pv.Scale=function(){};pv.Scale.interpolator=function(start,end){if("number"==typeof start)return function(t){return t*(end-start)+start;};var startGradient=start.type&&"solid"!==start.type,endGradient=end.type&&"solid"!==end.type;if(startGradient||endGradient){start=startGradient?start:pv.color(start).rgb();end=endGradient?end:pv.color(end).rgb();return function(t){return t<.5?start:end;};}
start=pv.color(start).rgb();end=pv.color(end).rgb();return function(t){var a=start.a*(1-t)+end.a*t;a<1e-5&&(a=0);return 0==start.a?pv.rgb(end.r,end.g,end.b,a):0==end.a?pv.rgb(start.r,start.g,start.b,a):pv.rgb(Math.round(start.r*(1-t)+end.r*t),Math.round(start.g*(1-t)+end.g*t),Math.round(start.b*(1-t)+end.b*t),a);};};pv.Scale.common={by:function(f){function by(){return scale(f.apply(this,arguments));}
var scale=this;for(var method in scale)by[method]=scale[method];return by;},by1:function(f){function by1(x){return scale(f.call(this,x));}
var scale=this;for(var method in scale)by1[method]=scale[method];return by1;},transform:function(t){function transfScale(){return t.call(this,scale.apply(scale,arguments));}
var scale=this;for(var method in scale)transfScale[method]=scale[method];return transfScale;}};!function(){function genNumberTicks(N,min,max,options){var ticks,span=max-min;if(span&&isFinite(span)){var precision=pv.parseNumNonNeg(pv.get(options,"precision",0)),precisionMin=pv.parseNumNonNeg(pv.get(options,"precisionMin",0)),precisionMax=pv.parseNumNonNeg(pv.get(options,"precisionMax",1/0)),roundInside=pv.get(options,"roundInside",!0);isFinite(precision)||(precision=0);isFinite(precisionMin)||(precisionMin=0);precisionMax||(precisionMax=1/0);var exponentMin=pv.get(options,"numberExponentMin"),exponentMax=pv.get(options,"numberExponentMax");null!=exponentMin&&isFinite(exponentMin)&&(precisionMin=Math.max(precisionMin,Math.pow(10,Math.floor(exponentMin))));null!=exponentMax&&isFinite(exponentMax)&&(precisionMax=Math.min(precisionMax,5*Math.pow(10,Math.floor(exponentMax))));if(roundInside){precisionMin>span&&(precisionMin=span);precisionMax>span&&(precisionMax=span);}
precisionMax<precisionMin&&(precisionMax=precisionMin);precision?precision=Math.max(Math.min(precision,precisionMax),precisionMin):precisionMin===precisionMax&&(precision=precisionMin);var result,precMin,precMax,NObtained,overflow=0,fixed=!!precision;if(fixed){result={base:Math.abs(precision),mult:1,value:1};result.value=result.base;}else{var NMax=pv.parseNumNonNeg(pv.get(options,"tickCountMax",1/0));NMax<1&&(NMax=1);null==N?N=Math.min(10,NMax):isFinite(N)?N>NMax&&(N=NMax):N=isFinite(NMax)?NMax:10;result={base:isFinite(N)?pv.logFloor(span/N,10):0,mult:1,value:1};result.value=result.base;if(precisionMin>0){precMin=readNumberPrecision(precisionMin,!0);if(result.value<precMin.value){numberCopyResult(result,precMin);overflow=-1;}}
if(isFinite(precisionMax)){precMax=readNumberPrecision(precisionMax,!1);if(precMin&&precMax.value<=precMin.value)precMax=null;else if(precMax.value<result.value){numberCopyResult(result,precMax);overflow=1;}}
if(1!==overflow&&isFinite(N)&&result.mult<10){NObtained=span/result.base;if(N<NObtained){var err=N/NObtained;err<=.15?result.mult=10:result.mult<5&&(err<=.35?result.mult=5:result.mult<2&&err<=.75&&(result.mult=2));if(result.mult>1){result.value=result.base*result.mult;if(precMin&&result.value<precMin.value){numberCopyResult(result,precMin);overflow=-1;}else if(precMax&&precMax.value<result.value){numberCopyResult(result,precMax);overflow=1;}else if(10===result.mult){result.base*=10;result.mult=1;}}}}}
for(var resultPrev;;){var step=result.value,start=step*Math[roundInside?"ceil":"floor"](min/step),end=step*Math[roundInside?"floor":"ceil"](max/step);if(resultPrev&&(end<start||precMax&&end-start>precMax.value)){result=resultPrev;break;}
var exponent=Math.floor(pv.log(step,10)+1e-10);result.decPlaces=Math.max(0,-exponent);result.ticks=pv.range(start,end+step,step);if(fixed||overflow>0||result.ticks.length<=NMax)break;if(resultPrev&&resultPrev.ticks.length<=result.ticks.length){result=resultPrev;break;}
result=numberResultAbove(resultPrev=result);}
ticks=result.ticks;ticks.step=result.value;ticks.base=result.base;ticks.mult=result.mult;ticks.decPlaces=result.decPlaces;ticks.format=pv.Format.number().fractionDigits(result.decPlaces);}else{ticks=[+min];ticks.step=ticks.base=ticks.mult=1;ticks.decPlaces=0;ticks.format=pv.Format.number().fractionDigits(0);}
return ticks;}
function numberCopyResult(to,from){to.base=from.base;to.mult=from.mult;to.value=from.value;return to;}
function numberResultAbove(result){var out=numberCopyResult({},result);switch(out.mult){case 5:out.mult=1;out.base*=10;break;case 2:out.mult=5;break;case 1:out.mult=2;}
out.value=out.base*out.mult;return out;}
function readNumberPrecision(precision,isMin){precision<0&&(precision=-precision);var base=pv.logFloor(precision,10),mult=precision/base;isMin?mult>5?(mult=1,base*=10):mult=mult>2?5:mult>1?2:1:mult=mult>=5?5:mult>=2?2:1;return{base:base,mult:mult,value:base*mult,source:precision};}
function newDate(x){return new Date(x);}
function genDateTicks(N,min,max,precision,format,weekStart,options){var ticks,span=max-min;if(span&&isFinite(span)){precision=parseDatePrecision(pv.get(options,"precision"),precision);var precisionMin=parseDatePrecision(pv.get(options,"precisionMin"),0),precisionMax=parseDatePrecision(pv.get(options,"precisionMax"),1/0);precisionMax<precisionMin&&(precisionMax=precisionMin);precision?precision=Math.max(Math.min(precision,precisionMax),precisionMin):precisionMin===precisionMax&&(precision=precisionMin);var NMax=pv.parseNumNonNeg(pv.get(options,"tickCountMax",1/0));NMax<2&&(NMax=2);N=Math.min(null==N?5:N,NMax);for(var precResultPrev,keyArgs={weekStart:weekStart,roundInside:pv.get(options,"roundInside",1),alignmentValue:pv.get(options,"alignmentValue")},precResult=chooseDatePrecision(N,span,precision,precisionMin,precisionMax,keyArgs),fixed=precResult.fixed,overflow=precResult.overflow;;){precResult.ticks=ticks=precResult.comp.ticks(min,max,precResult.mult,keyArgs);if(precResultPrev&&precResult.precMax&&ticks[ticks.length-1]-ticks[0]>precResult.precMax.value){precResult=precResultPrev;break;}
if(fixed||overflow>0||precResult.ticks.length<=NMax)break;if(precResultPrev&&precResultPrev.ticks.length<=precResult.ticks.length){precResult=precResultPrev;break;}
precResultPrev=precResult;precResult=precResult.comp.resultAbove(precResult.mult);}
ticks=precResult.ticks;ticks.step=precResult.value;ticks.base=precResult.comp.value;ticks.mult=precResult.mult;ticks.format=parseTickDateFormat(format)||precResult.comp.format;}else{ticks=[newDate(min)];ticks.step=ticks.base=ticks.mult=1;ticks.format=pv.Format.date("%x");}
return ticks;}
function chooseDatePrecision(N,span,precision,precisionMin,precisionMax,options){var dateComp,castResult,precMin,precMax,overflow=0,mult=1,fixed=!!precision;if(precision){castResult=readDatePrecision(precision,!1);if(castResult.value!==precision)dateComp=castResult.comp.withPrecision(precision);else{dateComp=castResult.comp;mult=castResult.mult;}}else{if(isFinite(N)){dateComp=getGreatestLessOrEqualDateComp(span,N);mult=dateComp.multiple(span/dateComp.value,options);}else{dateComp=lowestPrecisionValueDateComp();mult=1;}
precision=dateComp.value*mult;precision<precisionMin&&(precMin=readDatePrecision(precisionMin,!0));precisionMax<precision&&(precMax=readDatePrecision(precisionMax,!1));if(precMin&&precision<precMin.value){dateComp=precMin.comp;mult=precMin.mult;overflow=-1;}else if(precMax&&precisionMin<precMax.value&&precMax.value<precision){dateComp=precMax.comp;mult=precMax.mult;overflow=1;}}
return{comp:dateComp,mult:mult,value:dateComp.value*mult,source:precision,overflow:overflow,fixed:fixed,precMin:precMin,precMax:precMax};}
function readDatePrecision(precision,ceil){return null==precision||precision<=0||!isFinite(precision)?null:(ceil?lowestPrecisionValueDateComp:highestPrecisionValueDateComp)().castValue(precision,ceil);}
function DateComponent(value,prev,keyArgs){this.value=value;this.mult=keyArgs.mult||1;this.base=1===this.mult?this.value:Math.floor(this.value/this.mult);dateCompCopyArgs.forEach(function(p){null!=keyArgs[p]&&(this[p]=keyArgs[p]);},this);keyArgs.floor&&(this.floorLocal=keyArgs.floor);this.format=parseTickDateFormat(keyArgs.format);this.first=pv.functor(keyArgs.first||0);this.prev=prev;this.next=null;prev&&(prev.next=this);}
function parseTickDateFormat(format){return null==format?null:"function"==typeof format?format:pv.Format.date(format);}
function firstWeekStartOfMonth(date,dateTickWeekStart){var d=new Date(date.getFullYear(),date.getMonth(),1),wd=dateTickWeekStart-d.getDay();if(wd){wd<0&&(wd+=7);d.setDate(d.getDate()+wd);}
return d;}
function parseDatePrecision(value,dv){if("string"==typeof value){var n=+value;if(isNaN(n)){if(value){var m=/^(\d*)([a-zA-Z]+)$/.exec(value);if(m){value=parseDateInterval(m[2]);value&&(value*=+m[1]||1);}}}else value=n;}
("number"!=typeof value||value<0)&&(value=null!=dv?dv:0);return value;}
function parseDateInterval(s){switch(s){case"year":case"y":return 31536e6;case"month":case"m":return 2592e6;case"week":case"w":return 6048e5;case"day":case"d":return 864e5;case"hour":case"h":return 36e5;case"minute":case"M":return 6e4;case"second":case"s":return 1e3;case"millisecond":case"ms":return 1;}}
function defDateComp(value,keyArgs){var prev=highestPrecisionValueDateComp();_dateComps.push(new DateComponent(value,prev,keyArgs));}
function lowestPrecisionValueDateComp(){return _dateComps[0];}
function highestPrecisionValueDateComp(){return _dateComps.length?_dateComps[_dateComps.length-1]:null;}
function getGreatestLessOrEqualDateComp(length,N){null==N&&(N=1);var comp,prev=highestPrecisionValueDateComp();do{comp=prev;}while(length<N*comp.value&&(prev=comp.prev));return comp;}
pv.Scale.quantitative=function(){function scale(x){var j=pv.search(d,x);j<0&&(j=-j-2);j=Math.max(0,Math.min(i.length-1,j));return i[j]((f(x)-l[j])/(l[j+1]-l[j]));}
var dateTickFormat,dateTickPrecision,lastTicks,d=[0,1],l=[0,1],r=[0,1],i=[pv.identity],type=Number,n=!1,f=pv.identity,g=pv.identity,tickFormatter=null,dateTickWeekStart=0;scale.transform=function(forward,inverse){f=function(x){return n?-forward(-x):forward(x);};g=function(y){return n?-inverse(-y):inverse(y);};l=d.map(f);return this;};scale.domain=function(array,min,max){if(arguments.length){var o;if(array instanceof Array){arguments.length<2&&(min=pv.identity);arguments.length<3&&(max=min);o=array.length&&min(array[0]);d=array.length?[pv.min(array,min),pv.max(array,max)]:[];}else{o=array;d=Array.prototype.slice.call(arguments).map(Number);}
d.length?1==d.length&&(d=[d[0],d[0]]):d=[-1/0,1/0];n=(d[0]||d[d.length-1])<0;l=d.map(f);type=o instanceof Date?newDate:Number;return this;}
return d.map(type);};scale.range=function(){if(arguments.length){r=Array.prototype.slice.call(arguments);r.length?1==r.length&&(r=[r[0],r[0]]):r=[-1/0,1/0];i=[];for(var j=0;j<r.length-1;j++)i.push(pv.Scale.interpolator(r[j],r[j+1]));return this;}
return r;};scale.invert=function(y){var j=pv.search(r,y);j<0&&(j=-j-2);j=Math.max(0,Math.min(i.length-1,j));return type(g(l[j]+(y-r[j])/(r[j+1]-r[j])*(l[j+1]-l[j])));};scale.ticks=function(N,options){var start=d[0],end=d[d.length-1],reverse=end<start,min=reverse?end:start,max=reverse?start:end;lastTicks=type===newDate?genDateTicks(N,min,max,dateTickPrecision,dateTickFormat,dateTickWeekStart,options):genNumberTicks(N,min,max,options);return reverse?lastTicks.reverse():lastTicks;};scale.dateTickFormat=function(){if(arguments.length){dateTickFormat=arguments[0];return this;}
return dateTickFormat;};scale.dateTickPrecision=function(){if(arguments.length){dateTickPrecision=parseDatePrecision(arguments[0],0);return this;}
return dateTickPrecision;};scale.dateTickWeekStart=function(weekStart){if(arguments.length){switch((""+weekStart).toLowerCase()){case"0":case"sunday":dateTickWeekStart=0;break;case"1":case"monday":dateTickWeekStart=1;break;case"2":case"tuesday":dateTickWeekStart=2;break;case"3":case"wednesday":dateTickWeekStart=3;break;case"4":case"thursday":dateTickWeekStart=4;break;case"5":case"friday":dateTickWeekStart=5;break;case"6":case"saturday":dateTickWeekStart=6;break;default:dateTickWeekStart=0;}
return this;}
return dateTickWeekStart;};scale.tickFormatter=function(f){if(arguments.length){tickFormatter=f;return this;}
return tickFormatter;};scale.tickFormat=function(t,index){var text;if(tickFormatter){if(!lastTicks){lastTicks=[];lastTicks.step=lastTicks.base=lastTicks.mult=1;lastTicks.decPlaces=0;lastTicks.format=String;}
var precision=type!==Number?lastTicks.step:lastTicks.decPlaces;text=tickFormatter.call(lastTicks,t,precision,null!=index?index:-1);}else text=lastTicks?lastTicks.format(t):String(t);return text;};scale.nice=function(){if(2!=d.length)return this;var start=d[0],end=d[d.length-1],reverse=end<start,min=reverse?end:start,max=reverse?start:end,span=max-min;if(!span||!isFinite(span))return this;var step=Math.pow(10,Math.round(Math.log(span)/Math.log(10))-1);d=[Math.floor(min/step)*step,Math.ceil(max/step)*step];reverse&&d.reverse();l=d.map(f);return this;};pv.copyOwn(scale,pv.Scale.common);scale.domain.apply(scale,arguments);return scale;};var dateCompCopyArgs=["get","set","multiple","multiples","thresholds","closeds","castValue"];DateComponent.prototype.increment=function(d,n){null==n&&(n=1);1!==this.mult&&(n*=this.mult);this.set(d,this.get(d)+n);};DateComponent.prototype.get=function(d){return d.getMilliseconds();};DateComponent.prototype.set=function(d,v){d.setMilliseconds(v);};DateComponent.prototype.floorLocal=function(d,options){};DateComponent.prototype.floor=function(d,options){var skip=0;if(1!==this.mult){this.floorLocal(d,options);skip=this.base;}
for(var comp=this.prev;comp;){1===comp.mult&&comp.value!==skip&&comp.clear(d,options);comp=comp.prev;}};DateComponent.prototype.floorMultiple=function(d,n,options){var align=pv.get(options,"alignmentValue"),ref=null!=align?this.get(align):this.first(d,options),delta=this.get(d)-ref,date=null;if(delta){var M=n*this.mult;if(align){date=new Date(align);for(;date<d;)this.set(date,this.get(date)+M);for(;date>d;)this.set(date,this.get(date)-M);ref=this.get(date);}else{ref+=Math.floor(delta/M)*M;}}
this.set(d,ref,date);};DateComponent.prototype.clear=function(d,options){this.set(d,this.first(d,options));};DateComponent.prototype.multiple=function(N,options){for(var ms=this.multiples,ts=this.thresholds,cl=this.closeds,L=ms.length,i=-1;++i<L;)if(cl[i]?N<=ts[i]:N<ts[i])return ms[i];throw new Error("Invalid configuration.");};DateComponent.prototype.resultAbove=function(mult){return this.castValue(this.value*mult+.1,!0);};DateComponent.prototype.castValue=function(value,ceil){var ms=this.multiples;if(!ms)return this._castValueResult(1,value,1);var i,m=value/this.value,L=ms.length;if(ceil){i=-1;for(;++i<L;)if(m<=ms[i])return this._castValueResult(ms[i],value,0);return this.next?this.next.castValue(value,ceil):this._castValueResult(ms[L-1],value,1);}
i=L;for(;i--;)if(ms[i]<=m)return this._castValueResult(ms[i],value,0);return this.prev?this.prev.castValue(value,ceil):this._castValueResult(ms[0],value,-1);};DateComponent.prototype._castValueResult=function(mult,value,overflow){return{comp:this,mult:mult,value:this.value*mult,source:value,overflow:overflow};};DateComponent.prototype.withPrecision=function(value){var comp=this;this.value!==value&&(comp=new DateComponent(value,null,{mult:value,format:this.format}));return comp;};DateComponent.prototype.ticks=function(min,max,mult,options){var ticks=[],tick=new Date(min);this.floor(tick,options);mult>1&&this.floorMultiple(tick,mult,options);if(pv.get(options,"roundInside",1)){min!==+tick&&this.increment(tick,mult);do{ticks.push(new Date(tick));this.increment(tick,mult);}while(tick<=max);}else{ticks.push(new Date(tick));do{this.increment(tick,mult);ticks.push(new Date(tick));}while(tick<max);}
return ticks;};pv.parseDatePrecision=parseDatePrecision;var _dateComps=[];defDateComp(1,{format:"%S.%Qs",multiples:[1,5,25,50,100,250],thresholds:[10,50,100,200,1e3,1/0],closeds:[1,1,1,1,1,1]});defDateComp(1e3,{get:function(d){return d.getSeconds();},set:function(d,v){d.setSeconds(v);},format:"%I:%M:%S",multiples:[1,5,10,15],thresholds:[10,60,90,1/0],closeds:[1,1,1,1]});defDateComp(6e4,{get:function(d){return d.getMinutes();},set:function(d,v){d.setMinutes(v);},format:"%I:%M %p",multiples:[1,5,10,15],thresholds:[10,15,30,1/0],closeds:[1,1,1,1]});defDateComp(36e5,{get:function(d){return d.getHours();},set:function(d,v){d.setHours(v);},format:"%I:%M %p",multiples:[1,3,6],thresholds:[10,20,1/0],closeds:[1,1,1]});defDateComp(864e5,{get:function(d){return d.getDate();},set:function(d,v,ad){var m=ad?ad.getMonth():d.getMonth(),y=ad?ad.getFullYear():d.getFullYear();d.setFullYear(y,m,v);},format:"%m/%d",first:1,multiples:[1,2,3,5],thresholds:[10,15,30,1/0],closeds:[1,0,0,1]});defDateComp(6048e5,{get:function(d){return d.getDate();},set:function(d,v,ad){var m=ad?ad.getMonth():d.getMonth(),y=ad?ad.getFullYear():d.getFullYear();d.setFullYear(y,m,v);},mult:7,floor:function(d,options){var wd=d.getDay()-pv.get(options,"weekStart",0);if(0!==wd){wd<0&&(wd+=7);this.set(d,this.get(d)-wd);}},first:function(d,options){return this.get(firstWeekStartOfMonth(d,pv.get(options,"weekStart",0)));},format:"%m/%d",multiples:[1,2,3],thresholds:[10,15,1/0],closeds:[1,1,1]});defDateComp(2592e6,{get:function(d){return d.getMonth();},set:function(d,v){d.setMonth(v);},format:"%m/%Y",multiples:[1,2,3],thresholds:[12,24,1/0],closeds:[1,1,1]});defDateComp(31536e6,{get:function(d){return d.getFullYear();},set:function(d,v){d.setFullYear(v);},format:"%Y",multiple:function(N){if(N<=10)return 1;var mult=pv.logCeil(N/15,10);N/mult<2?mult/=5:N/mult<5&&(mult/=2);return mult;},castValue:function(value,ceil){var base,mult,M=value/this.value;if(M<1){if(!ceil)return this.prev?this.prev.castValue(value,ceil):this._castValueResult(1,value,-1);base=1;}else base=pv.logFloor(M,10);mult=M/base;if(ceil)if(mult>5){base*=10;mult=1;}else mult=mult>2?5:mult>1?2:1;else if(mult>5)mult=5;else if(mult>2)mult=2;else if(mult>1)mult=1;else if(mult<1)return this.prev?this.prev.castValue(value,ceil):this._castValueResult(base,value,-1);return this._castValueResult(base*mult,value,0);}});}();pv.Scale.linear=function(){var scale=pv.Scale.quantitative();scale.domain.apply(scale,arguments);return scale;};pv.Scale.log=function(){var b,p,scale=pv.Scale.quantitative(1,10),log=function(x){return Math.log(x)/p;},pow=function(y){return Math.pow(b,y);};scale.ticks=function(){var d=scale.domain(),n=d[0]<0,i=Math.floor(n?-log(-d[0]):log(d[0])),j=Math.ceil(n?-log(-d[1]):log(d[1])),ticks=[];if(n){ticks.push(-pow(-i));for(;i++<j;)for(var k=b-1;k>0;k--)ticks.push(-pow(-i)*k);}else{for(;i<j;i++)for(var k=1;k<b;k++)ticks.push(pow(i)*k);ticks.push(pow(i));}
for(i=0;ticks[i]<d[0];i++);for(j=ticks.length;ticks[j-1]>d[1];j--);return ticks.slice(i,j);};scale.tickFormat=function(t){return t.toPrecision(1);};scale.nice=function(){var d=scale.domain();return scale.domain(pv.logFloor(d[0],b),pv.logCeil(d[1],b));};scale.base=function(v){if(arguments.length){b=Number(v);p=Math.log(b);scale.transform(log,pow);return this;}
return b;};scale.domain.apply(scale,arguments);return scale.base(10);};pv.Scale.root=function(){var scale=pv.Scale.quantitative();scale.power=function(v){if(arguments.length){var b=Number(v),p=1/b;scale.transform(function(x){return Math.pow(x,p);},function(y){return Math.pow(y,b);});return this;}
return b;};scale.domain.apply(scale,arguments);return scale.power(2);};pv.Scale.ordinal=function(){function scale(x){x in i||(i[x]=d.push(x)-1);return r[i[x]%r.length];}
var d=[],i={},r=[];scale.domain=function(array,f){if(arguments.length){array=array instanceof Array?arguments.length>1?pv.map(array,f):array:Array.prototype.slice.call(arguments);d=[];for(var seen={},j=0;j<array.length;j++){var o=array[j];if(!(o in seen)){seen[o]=!0;d.push(o);}}
i=pv.numerate(d);return this;}
return d;};scale.range=function(array,f){if(arguments.length){r=array instanceof Array?arguments.length>1?pv.map(array,f):array:Array.prototype.slice.call(arguments);"string"==typeof r[0]&&(r=r.map(pv.fillStyle));r.min=r[0];r.max=r[r.length-1];return this;}
return r;};scale.split=function(min,max){var R=max-min,N=this.domain().length,step=0;if(0===R)r=pv.array(N,min);else if(N){step=(max-min)/N;r=pv.range(min+step/2,max,step);}
r.min=min;r.max=max;r.step=step;return this;};scale.splitBandedCenter=function(min,max,bandRatio){null==bandRatio&&(bandRatio=1);return this._splitBandedCore(min,max,function(info){var S=info.range/info.count;info.step=S;info.band=S*bandRatio;info.offset=S/2;});};scale.splitBandedCenterAbs=function(min,max,band,margin){return this._splitBandedCore(min,max,function(info){var step;if(null==band||null==margin){step=info.range/info.count;if(null==band)if(null==margin){band=step;margin=0;}else{margin=Math.min(margin,step);band=step-margin;}else{band=Math.min(band,step);margin=step-band;}}else step=band+margin;info.step=step;info.band=band;info.offset=step/2;});};scale._splitBandedCore=function(min,max,fSplit){var margin,info={min:min,max:max,range:max-min,count:this.domain().length,offset:0,step:0,band:0};if(0===info.range){r=pv.array(info.count,min);margin=0;}else if(info.count){fSplit(info);margin=info.step-info.band;r=pv.range(min+info.offset,max,info.step);}
r.offset=info.offset;r.step=info.step;r.band=info.band;r.margin=margin;r.min=min;r.max=max;return this;};scale.splitBandedFlushCenter=function(min,max,bandRatio){null==bandRatio&&(bandRatio=1);return this._splitBandedCore(min,max,function(info){var R=info.range,N=info.count,B=R*bandRatio/N,M=N>1?(R-N*B)/(N-1):0;info.band=B;info.step=M+B;info.offset=B/2;});};scale.splitFlush=function(min,max){var n=this.domain().length,step=(max-min)/(n-1);r=1==n?[(min+max)/2]:pv.range(min,max+step/2,step);r.min=min;r.max=max;return this;};scale.splitBanded=function(min,max,band){arguments.length<3&&(band=1);if(band<0){var n=this.domain().length,total=-band*n,remaining=max-min-total,padding=remaining/(n+1);r=pv.range(min+padding,max,padding-band);r.band=-band;}else{var step=(max-min)/(this.domain().length+(1-band));r=pv.range(min+step*(1-band),max,step);r.band=step*band;r.step=step;r.margin=step-r.band;}
r.min=min;r.max=max;return this;};scale.invertIndex=function(y,noRound){var N=this.domain().length;if(0===N)return-1;var r=this.range(),R=r.max-r.min;if(0===R)return 0;var S=R/N;if(y>=r.max)return N;if(y<r.min)return 0;var i=(y-r.min)/S;return noRound?i:Math.round(i);};pv.copyOwn(scale,pv.Scale.common);scale.domain.apply(scale,arguments);return scale;};pv.Scale.quantile=function(){function scale(x){return y(Math.max(0,Math.min(j,pv.search.index(q,x)-1))/j);}
var n=-1,j=-1,q=[],d=[],y=pv.Scale.linear();scale.quantiles=function(x){if(arguments.length){n=Number(x);if(n<0){q=[d[0]].concat(d);j=d.length-1;}else{q=[];q[0]=d[0];for(var i=1;i<=n;i++)q[i]=d[~~(i*(d.length-1)/n)];j=n-1;}
return this;}
return q;};scale.domain=function(array,f){if(arguments.length){d=array instanceof Array?pv.map(array,f):Array.prototype.slice.call(arguments);d.sort(pv.naturalOrder);scale.quantiles(n);return this;}
return d;};scale.range=function(){if(arguments.length){y.range.apply(y,arguments);return this;}
return y.range();};pv.copyOwn(scale,pv.Scale.common);scale.domain.apply(scale,arguments);return scale;};pv.histogram=function(data,f){var frequency=!0;return{bins:function(ticks){var x=pv.map(data,f),bins=[];arguments.length||(ticks=pv.Scale.linear(x).ticks());for(var i=0;i<ticks.length-1;i++){var bin=bins[i]=[];bin.x=ticks[i];bin.dx=ticks[i+1]-ticks[i];bin.y=0;}
for(var i=0;i<x.length;i++){var j=pv.search.index(ticks,x[i])-1,bin=bins[Math.max(0,Math.min(bins.length-1,j))];bin.y++;bin.push(data[i]);}
if(!frequency)for(var i=0;i<bins.length;i++)bins[i].y/=x.length;return bins;},frequency:function(x){if(arguments.length){frequency=Boolean(x);return this;}
return frequency;}};};!function(){pv.Shape=function(){};var _k0={x:1,y:1};pv.Shape.dist2=function(v,w,k){k=k||_k0;var dx=v.x-w.x,dy=v.y-w.y,dx2=dx*dx,dy2=dy*dy;return{cost:dx2+dy2,dist2:k.x*dx2+k.y*dy2};};var pi=Math.PI,pi2=2*pi,atan2=Math.atan2;pv.Shape.normalizeAngle=function(a){a%=pi2;pv.floatLess(a,0)&&(a+=pi2);return a;};pv.Shape.atan2Norm=function(dy,dx){var a=atan2(dy,dx);pv.floatLess(a,0)&&(a+=pi2);return a;};pv.Shape.prototype.hasArea=function(){return!0;};pv.Shape.prototype.bbox=function(){return this._bbox||(this._bbox=this._calcBBox());};pv.Shape.prototype._calcBBox=function(){var minX,minY,maxX,maxY;this.points().forEach(function(point){var x=point.x,y=point.y;if(null==minX){minX=maxX=x;minY=maxY=y;}else{x<minX?minX=x:x>maxX&&(maxX=x);y<minY?minY=y:y>maxY&&(maxY=y);}});if(null!=minX)return new pv.Shape.Rect(minX,minY,maxX-minX,maxY-minY);};pv.Shape.prototype.containsPoint=function(p,k){if(k){var bbox;if(!k.y)return bbox=this.bbox(),pv.floatBelongsClosed(bbox.x,p.x,bbox.x2);if(!k.x)return bbox=this.bbox(),pv.floatBelongsClosed(bbox.y,p.y,bbox.y2);}
return this._containsPointCore(p);};pv.Shape.prototype._containsPointCore=function(){return!1;};}();!function(){var dist2=pv.Shape.dist2,cos=Math.cos,sin=Math.sin,sqrt=Math.sqrt;pv.vector=function(x,y){return new Point(x,y);};pv.Vector=function(x,y){this.x=x;this.y=y;};var Point=pv.Shape.Point=pv.Vector;pv.Vector.prototype=pv.extend(pv.Shape);pv.Vector.prototype.perp=function(){return new Point(-this.y,this.x);};pv.Vector.prototype.rotate=function(angle){var c=cos(angle),s=sin(angle);return new Point(c*this.x-s*this.y,s*this.x+c*this.y);};pv.Vector.prototype.norm=function(){var l=this.length();return this.times(l?1/l:1);};pv.Vector.prototype.length=function(){return sqrt(this.x*this.x+this.y*this.y);};pv.Vector.prototype.times=function(k){return new Point(this.x*k,this.y*k);};pv.Vector.prototype.plus=function(x,y){return 1===arguments.length?new Point(this.x+x.x,this.y+x.y):new Point(this.x+x,this.y+y);};pv.Vector.prototype.minus=function(x,y){return 1===arguments.length?new Point(this.x-x.x,this.y-x.y):new Point(this.x-x,this.y-y);};pv.Vector.prototype.dot=function(x,y){return 1==arguments.length?this.x*x.x+this.y*x.y:this.x*x+this.y*y;};pv.Vector.prototype.hasArea=function(){return!1;};pv.Vector.prototype.clone=function(){return new Point(this.x,this.y);};pv.Vector.prototype.apply=function(t){return new Point(t.x+t.k*this.x,t.y+t.k*this.y);};pv.Vector.prototype.intersectsRect=function(rect){return pv.floatBelongsClosed(rect.x,this.x,rect.x2)&&pv.floatBelongsClosed(rect.y,this.y,rect.y2);};pv.Vector.prototype._containsPointCore=function(p){return this.x===p.x&&this.y===p.y;};pv.Vector.prototype.points=function(){return[this];};pv.Vector.prototype.edges=function(){return[];};pv.Vector.prototype.center=function(){return this;};pv.Vector.prototype.distance2=function(p,k){return dist2(this,p,k);};}();!function(){var Point=pv.Shape.Point,dist2=pv.Shape.dist2;pv.Shape.Line=function(x,y,x2,y2){this.x=x||0;this.y=y||0;this.x2=x2||0;this.y2=y2||0;};var Line=pv.Shape.Line;Line.prototype=pv.extend(pv.Shape);Line.prototype.hasArea=function(){return!1;};Line.prototype.clone=function(){return new Line(this.x,this.y,this.x2,this.x2);};Line.prototype.apply=function(t){var x=t.x+t.k*this.x,y=t.y+t.k*this.y,x2=t.x+t.k*this.x2,y2=t.y+t.k*this.y2;return new Line(x,y,x2,y2);};Line.prototype.points=function(){return[new Point(this.x,this.y),new Point(this.x2,this.y2)];};Line.prototype.edges=function(){return[this];};Line.prototype.center=function(){return new Point((this.x+this.x2)/2,(this.y+this.y2)/2);};Line.prototype.normal=function(at,shapeCenter){var points=this.points(),norm=points[1].minus(points[0]).perp().norm();if(shapeCenter){points[0].minus(shapeCenter).dot(norm)<0&&(norm=norm.times(-1));}
return norm;};Line.prototype.intersectsRect=function(rect){var i,L,points=this.points();L=points.length;for(i=0;i<L;i++)if(points[i].intersectsRect(rect))return!0;var edges=rect.edges();L=edges.length;for(i=0;i<L;i++)if(this.intersectsLine(edges[i]))return!0;return!1;};Line.prototype._containsPointCore=function(p){var x=this.x,x2=this.x2,y=this.y,y2=this.y2;return pv.floatBelongsClosed(x,p.x,x2)&&(pv.floatEqual(x,x2)?pv.floatBelongsClosed(Math.min(y,y2),p.y,Math.max(y,y2)):pv.floatZero((y2-y)/(x2-x)*(p.x-x)+y-p.y));};Line.prototype.intersectsLine=function(b){var a=this,x21=a.x2-a.x,y21=a.y2-a.y,x43=b.x2-b.x,y43=b.y2-b.y,denom=y43*x21-x43*y21;if(pv.floatZero(denom))return!1;var y13=a.y-b.y,x13=a.x-b.x,numa=x43*y13-y43*x13,numb=x21*y13-y21*x13;if(pv.floatZero(denom))return pv.floatZero(numa)&&pv.floatZero(numb);var ua=numa/denom;if(!pv.floatBelongsClosed(0,ua,1))return!1;var ub=numb/denom;return!!pv.floatBelongsClosed(0,ub,1);};Line.prototype.distance2=function(p,k){var v=this,w={x:this.x2,y:this.y2},l2=dist2(v,w).cost;if(pv.floatZero(l2))return dist2(p,v,k);var wvx=w.x-v.x,wvy=w.y-v.y,t=((p.x-v.x)*wvx+(p.y-v.y)*wvy)/l2;if(pv.floatLess(t,0))return dist2(p,v,k);if(pv.floatGreater(t,1))return dist2(p,w,k);var proj={x:v.x+t*wvx,y:v.y+t*wvy};return dist2(p,proj,k);};}();!function(){var Point=pv.Shape.Point,Line=pv.Shape.Line;pv.Shape.Polygon=function(points){this._points=points||[];};var Polygon=pv.Shape.Polygon;Polygon.prototype=pv.extend(pv.Shape);Polygon.prototype.points=function(){return this._points;};Polygon.prototype.clone=function(){return new Polygon(this.points().slice());};Polygon.prototype.apply=function(t){for(var points=this.points(),L=points.length,points2=new Array(L),i=0;i<L;i++)points2[i]=points[i].apply(t);return new Polygon(points2);};Polygon.prototype.intersectsRect=function(rect){var i,L,points=this.points();L=points.length;for(i=0;i<L;i++)if(points[i].intersectsRect(rect))return!0;var edges=this.edges();L=edges.length;for(i=0;i<L;i++)if(edges[i].intersectsRect(rect))return!0;return!1;};Polygon.prototype.edges=function(){var edges=this._edges;if(!edges){edges=this._edges=[];var points=this.points(),L=points.length;if(L){for(var point,prevPoint=points[0],firstPoint=prevPoint,i=1;i<L;i++){point=points[i];edges.push(new Line(prevPoint.x,prevPoint.y,point.x,point.y));prevPoint=point;}
L>2&&edges.push(new Line(point.x,point.y,firstPoint.x,firstPoint.y));}}
return edges;};Polygon.prototype.distance2=function(p,k){var min={cost:1/0,dist2:1/0};this.edges().forEach(function(edge){var d=edge.distance2(p,k);pv.floatLess(d.cost,min.cost)&&(min=d);},this);return min;};Polygon.prototype.center=function(){for(var points=this.points(),x=0,y=0,i=0,L=points.length;i<L;i++){var p=points[i];x+=p.x;y+=p.y;}
return new Point(x/L,y/L);};Polygon.prototype._containsPointCore=function(p){var bbox=this.bbox();if(!bbox._containsPointCore(p))return!1;var e=.01*bbox.dx,ray=new Line(bbox.x-e,p.y,p.x,p.y),intersectCount=0;this.edges().forEach(function(edge){edge.intersectsLine(ray)&&intersectCount++;});return 1==(1&intersectCount);};}();!function(){var Point=pv.Shape.Point,Line=pv.Shape.Line;pv.Shape.Rect=function(x,y,dx,dy){this.x=x||0;this.y=y||0;this.dx=dx||0;this.dy=dy||0;if(this.dx<0){this.dx=Math.max(0,-this.dx);this.x=this.x-this.dx;}
if(this.dy<0){this.dy=Math.max(0,-this.dy);this.y=this.y-this.dy;}
this.x2=this.x+this.dx;this.y2=this.y+this.dy;};var Rect=pv.Shape.Rect;Rect.prototype=pv.extend(pv.Shape.Polygon);Rect.prototype.clone=function(){var r2=Object.create(Rect.prototype);r2.x=this.x;r2.y=this.y;r2.dx=this.dx;r2.dy=this.dy;r2.x2=this.x2;r2.y2=this.y2;return r2;};Rect.prototype.apply=function(t){var x=t.x+t.k*this.x,y=t.y+t.k*this.y,dx=t.k*this.dx,dy=t.k*this.dy;return new Rect(x,y,dx,dy);};Rect.prototype._containsPointCore=function(p){return pv.floatBelongsClosed(this.x,p.x,this.x2)&&pv.floatBelongsClosed(this.y,p.y,this.y2);};Rect.prototype.intersectsRect=function(rect){return pv.floatGreater(this.x2,rect.x)&&pv.floatLess(this.x,rect.x2)&&pv.floatGreater(this.y2,rect.y)&&pv.floatLess(this.y,rect.y2);};Rect.prototype.edges=function(){if(!this._edges){var x=this.x,y=this.y,x2=this.x2,y2=this.y2;this._edges=[new Line(x,y,x2,y),new Line(x2,y,x2,y2),new Line(x2,y2,x,y2),new Line(x,y2,x,y)];}
return this._edges;};Rect.prototype.center=function(){return new Point(this.x+this.dx/2,this.y+this.dy/2);};Rect.prototype.points=function(){var points=this._points;if(!points){var x=this.x,y=this.y,x2=this.x2,y2=this.y2;points=this._points=[new Point(x,y),new Point(x2,y),new Point(x2,y2),new Point(x,y2)];}
return points;};Rect.prototype._calcBBox=function(){return this;};}();!function(){var Point=pv.Shape.Point,dist2=pv.Shape.dist2,sqrt=Math.sqrt,abs=Math.abs,pow=Math.pow;pv.Shape.Circle=function(x,y,radius){this.x=x||0;this.y=y||0;this.radius=radius||0;};var Circle=pv.Shape.Circle;Circle.prototype=pv.extend(pv.Shape);Circle.prototype.clone=function(){return new Circle(this.x,this.y,this.radius);};Circle.prototype.apply=function(t){var x=t.x+t.k*this.x,y=t.y+t.k*this.y,r=t.k*this.radius;return new Circle(x,y,r);};Circle.prototype.intersectsRect=function(rect){var dx2=rect.dx/2,dy2=rect.dy/2,r=this.radius,circleDistX=abs(this.x-rect.x-dx2),circleDistY=abs(this.y-rect.y-dy2);return!(circleDistX>dx2+r||circleDistY>dy2+r)&&(circleDistX<=dx2||circleDistY<=dy2||pow(circleDistX-dx2,2)+pow(circleDistY-dy2,2)<=r*r);};Circle.prototype.intersectLine=function(line,isInfiniteLine){var baX=line.x2-line.x,baY=line.y2-line.y,caX=this.x-line.x,caY=this.y-line.y,ba2=baX*baX+baY*baY,bBy2=baX*caX+baY*caY,r=this.radius,c=caX*caX+caY*caY-r*r,pBy2=bBy2/ba2,disc=pBy2*pBy2-c/ba2;if(!(disc<0)){var discSqrt=sqrt(disc),t1=pBy2-discSqrt,t2=pBy2+discSqrt,ps=[];(isInfiniteLine||t1>=0&&t1<=1)&&ps.push(new Point(line.x+baX*t1,line.y+baY*t1));0!==disc&&(isInfiniteLine||t2>=0&&t2<=1)&&ps.push(new Point(line.x+baX*t2,line.y+baY*t2));return ps;}};Circle.prototype.points=function(){return[this.center()];};Circle.prototype.center=function(){return new Point(this.x,this.y);};Circle.prototype.normal=function(at){return at.minus(this.x,this.y).norm();};Circle.prototype._containsPointCore=function(p){var dx=p.x-this.x,dy=p.y-this.y,r=this.radius;return dx*dx+dy*dy<=r*r;};Circle.prototype.distance2=function(p,k){var r=this.radius,b=p.minus(this).norm().times(r).plus(this);return dist2(p,b,k);};Circle.prototype._calcBBox=function(){var r=this.radius,r_2=2*r;return new pv.Shape.Rect(this.x-r,this.y-r,r_2,r_2);};}();!function(){var Point=pv.Shape.Point,dist2=pv.Shape.dist2,normalizeAngle=pv.Shape.normalizeAngle,atan2Norm=pv.Shape.atan2Norm,cos=Math.cos,sin=Math.sin,sqrt=Math.sqrt,pi=Math.PI,pi_2=2*pi,pi_1_2=pi/2,pi_3_2=3*pi/2;pv.Shape.Arc=function(x,y,radius,startAngle,angleSpan){this.x=x;this.y=y;this.radius=radius;pv.floatBelongsClosed(0,angleSpan,pi_2)||(angleSpan=normalizeAngle(angleSpan));this.startAngle=normalizeAngle(startAngle);this.angleSpan=angleSpan;this.endAngle=this.startAngle+this.angleSpan;};var Arc=pv.Shape.Arc;Arc.prototype=pv.extend(pv.Shape);Arc.prototype.hasArea=function(){return!1;};Arc.prototype.clone=function(){var arc=Object.create(Arc.prototype),me=this;arc.x=me.x;arc.y=me.y;arc.radius=me.radius;arc.startAngle=me.startAngle;arc.angleSpan=me.angleSpan;arc.endAngle=me.endAngle;return arc;};Arc.prototype.apply=function(t){var x=t.x+t.k*this.x,y=t.y+t.k*this.y,r=t.k*this.radius;return new Arc(x,y,r,this.startAngle,this.angleSpan);};Arc.prototype.containsAngle=function(a,inside){pv.floatBelongsClosed(0,a,pi_2)||(a=normalizeAngle(a));var ai=this.startAngle,af=this.endAngle;if(inside?pv.floatBelongsOpen(ai,a,af):pv.floatBelongsClosed(ai,a,af))return!0;if(pv.floatLessOrEqual(af,pi_2))return!1;a+=pi_2;return inside?pv.floatBelongsOpen(ai,a,af):pv.floatBelongsClosed(ai,a,af);};Arc.prototype._containsPointCore=function(p){var dx=p.x-this.x,dy=p.y-this.y,r=sqrt(dx*dx+dy*dy);return pv.floatEqual(r,this.radius)&&this.containsAngle(atan2Norm(dy,dx));};Arc.prototype.intersectsRect=function(rect){var i,points=this.points(),L=points.length;for(i=0;i<L;i++)if(points[i].intersectsRect(rect))return!0;var edges=rect.edges();L=edges.length;for(i=0;i<L;i++)if(this.intersectLine(edges[i]))return!0;return!1;};var circleIntersectLine=pv.Shape.Circle.prototype.intersectLine;Arc.prototype.intersectLine=function(line,isInfiniteLine){var ps=circleIntersectLine.call(this,line,isInfiniteLine);if(ps){ps=ps.filter(function(p){return this._containsPointCore(p);},this);if(ps.length)return ps;}};Arc.prototype.points=function(){function addAngle(a){me.containsAngle(a,!0)&&points.push(new Point(x+r*cos(a),y+r*sin(a)));}
var me=this,x=me.x,y=me.y,r=me.radius,ai=me.startAngle,af=me.endAngle,points=[new Point(x+r*cos(ai),y+r*sin(ai)),new Point(x+r*cos(af),y+r*sin(af))];addAngle(0);addAngle(pi_1_2);addAngle(pi);addAngle(pi_3_2);return points;};Arc.prototype.center=function(){var x=this.x,y=this.y,r=this.radius,am=(this.startAngle+this.endAngle)/2;return new Point(x+r*cos(am),y+r*sin(am));};Arc.prototype.normal=function(at,shapeCenter){var norm=at.minus(this.x,this.y).norm();if(shapeCenter){this.center().minus(shapeCenter).dot(norm)<0&&(norm=norm.times(-1));}
return norm;};Arc.prototype.distance2=function(p,k){var dx=p.x-this.x,dy=p.y-this.y,a=atan2Norm(dy,dx);if(this.containsAngle(a)){var b=new Point(this.x+this.radius*cos(a),this.y+this.radius*sin(a));return dist2(p,b,k);}
var points=this.points(),d1=dist2(p,points[0],k),d2=dist2(p,points[1],k);return pv.floatLess(d1.cost,d2.cost)?d1:d2;};}();!function(){var Arc=pv.Shape.Arc,Line=pv.Shape.Line,Point=pv.Shape.Point,cos=Math.cos,sin=Math.sin,sqrt=Math.sqrt,pi=Math.PI,pi_2=2*pi,pi_1_2=pi/2,pi_3_2=3*pi/2,atan2Norm=pv.Shape.atan2Norm,normalizeAngle=pv.Shape.normalizeAngle;pv.Shape.Wedge=function(x,y,innerRadius,outerRadius,startAngle,angleSpan){this.x=x;this.y=y;this.innerRadius=innerRadius;this.outerRadius=outerRadius;pv.floatBelongsClosed(0,angleSpan,pi_2)||(angleSpan=normalizeAngle(angleSpan));this.startAngle=normalizeAngle(startAngle);this.angleSpan=angleSpan;this.endAngle=this.startAngle+angleSpan;};var Wedge=pv.Shape.Wedge;Wedge.prototype=pv.extend(pv.Shape);Wedge.prototype.clone=function(){return new Wedge(this.x,this.y,this.innerRadius,this.outerRadius,this.startAngle,this.angleSpan);};Wedge.prototype.apply=function(t){var x=t.x+t.k*this.x,y=t.y+t.k*this.y,ir=t.k*this.innerRadius,or=t.k*this.outerRadius;return new Wedge(x,y,ir,or,this.startAngle,this.angleSpan);};Wedge.prototype.containsAngle=Arc.prototype.containsAngle;Wedge.prototype._containsPointCore=function(p){var dx=p.x-this.x,dy=p.y-this.y,r=sqrt(dx*dx+dy*dy);return pv.floatBelongsClosed(this.innerRadius,r,this.outerRadius)&&this.containsAngle(atan2Norm(dy,dx));};Wedge.prototype.intersectsRect=function(rect){var i,L,points,edges;points=this.points();L=points.length;for(i=0;i<L;i++)if(points[i].intersectsRect(rect))return!0;points=rect.points();L=points.length;for(i=0;i<L;i++)if(this._containsPointCore(points[i]))return!0;edges=this.edges();L=edges.length;for(i=0;i<L;i++)if(edges[i].intersectsRect(rect))return!0;return!1;};Wedge.prototype.points=function(){this._points||this.edges();return this._points;};Wedge.prototype.edges=function(){function addAngle(a){me.containsAngle(a,!0)&&points.push(new Point(x+or*cos(a),y+or*sin(a)));}
var me=this,edges=me._edges;if(!edges){var pii,pfi,x=me.x,y=me.y,ir=me.innerRadius,irPositive=pv.floatGreater(ir,0),or=me.outerRadius,ai=me.startAngle,af=me.endAngle,aa=me.angleSpan,cai=cos(ai),sai=sin(ai),caf=cos(af),saf=sin(af);if(irPositive){pii=new Point(x+ir*cai,y+ir*sai);pfi=new Point(x+ir*caf,y+ir*saf);}else pii=pfi=new Point(x,y);var pio=new Point(x+or*cai,y+or*sai),pfo=new Point(x+or*caf,y+or*saf);edges=me._edges=[];irPositive&&edges.push(new Arc(x,y,ir,ai,aa));edges.push(new Line(pii.x,pii.y,pio.x,pio.y),new Arc(x,y,or,ai,aa),new Line(pfi.x,pfi.y,pfo.x,pfo.y));var points=me._points=[pii,pio,pfo];irPositive&&points.push(pfi);addAngle(0);addAngle(pi_1_2);addAngle(pi);addAngle(pi_3_2);}
return edges;};Wedge.prototype.distance2=function(p,k){var min={cost:1/0,dist2:1/0};this.edges().forEach(function(edge){var d=edge.distance2(p,k);pv.floatLess(d.cost,min.cost)&&(min=d);});return min;};Wedge.prototype.center=function(){var midAngle=(this.startAngle+this.endAngle)/2,midRadius=(this.innerRadius+this.outerRadius)/2;return new Point(this.x+midRadius*cos(midAngle),this.y+midRadius*sin(midAngle));};}();!function(){var round=Math.round,parseRgb=function(c){var f=parseFloat(c);return"%"==c[c.length-1]?round(2.55*f):f;},reSysColor=/([a-z]+)\((.*)\)/i,createColor=function(format){if("#"===format.charAt(0)){var r,g,b;if(4===format.length){r=format.charAt(1);r+=r;g=format.charAt(2);g+=g;b=format.charAt(3);b+=b;}else if(7===format.length){r=format.substring(1,3);g=format.substring(3,5);b=format.substring(5,7);}
return pv.rgb(parseInt(r,16),parseInt(g,16),parseInt(b,16),1);}
var m1=reSysColor.exec(format);if(m1){var m2=m1[2].split(","),a=1;switch(m1[1]){case"hsla":case"rgba":a=parseFloat(m2[3]);if(!a)return pv.Color.transparent;}
switch(m1[1]){case"hsla":case"hsl":var h=parseFloat(m2[0]),s=parseFloat(m2[1])/100,l=parseFloat(m2[2])/100;return new pv.Color.Hsl(h,s,l,a).rgb();case"rgba":case"rgb":var r=parseRgb(m2[0]),g=parseRgb(m2[1]),b=parseRgb(m2[2]);return pv.rgb(r,g,b,a);}}
return new pv.Color(format,1);},colorsByFormat={};pv.color=function(format){if(format.rgb)return format.rgb();var color=pv.Color.names[format];color||(color=colorsByFormat[format]||(colorsByFormat[format]=createColor(format)));return color;};}();pv.Color=function(color,opacity){this.color=color;this.opacity=opacity;this.key="solid "+color+" alpha("+opacity+")";};pv.Color.prototype.hsl=function(){return this.rgb().hsl();};pv.Color.prototype.brighter=function(k){return this.rgb().brighter(k);};pv.Color.prototype.darker=function(k){return this.rgb().darker(k);};pv.Color.prototype.relativeLuminance=function(mate){var rgb=this.alphaBlend(mate);return.2126*correctSRgbComponent(rgb.r)+.7152*correctSRgbComponent(rgb.g)+.0722*correctSRgbComponent(rgb.b);};pv.Color.prototype.alphaBlend=function(mate){var rgb=this.rgb(),a=rgb.a;if(1===a)return this;mate=mate?pv.color(mate).alphaBlend():pv.Color.names.white;mate=mate.rgb();var z=1-a;return pv.rgb(a*rgb.r+z*mate.r,a*rgb.g+z*mate.g,a*rgb.b+z*mate.b,1);};pv.Color.prototype.rgbDecimal=function(mate){var rgb=this.alphaBlend(mate);return rgb.r<<16|rgb.g<<8|rgb.b;};pv.Color.prototype.isDark=function(){return this.rgbDecimal()<8388607.5;};pv.Color.prototype.contrastRatioTo=function(mate){var bg=mate.alphaBlend(),fg=this.alphaBlend(bg),rlbg=bg.relativeLuminance(),rlfg=fg.relativeLuminance();return(Math.max(rlbg,rlfg)+.05)/(Math.min(rlbg,rlfg)+.05);};pv.rgb=function(r,g,b,a){return new pv.Color.Rgb(r,g,b,4==arguments.length?a:1);};pv.Color.Rgb=function(r,g,b,a){pv.Color.call(this,a?"rgb("+r+","+g+","+b+")":"none",a);this.r=r;this.g=g;this.b=b;this.a=a;};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(r){return pv.rgb(r,this.g,this.b,this.a);};pv.Color.Rgb.prototype.green=function(g){return pv.rgb(this.r,g,this.b,this.a);};pv.Color.Rgb.prototype.blue=function(b){return pv.rgb(this.r,this.g,b,this.a);};pv.Color.Rgb.prototype.alpha=function(a){return pv.rgb(this.r,this.g,this.b,a);};pv.Color.Rgb.prototype.rgb=function(){return this;};pv.Color.Rgb.prototype.brighter=function(k){k=Math.pow(.7,null!=k?k:1);var r=this.r,g=this.g,b=this.b,i=30;if(!r&&!g&&!b)return pv.rgb(i,i,i,this.a);r&&r<i&&(r=i);g&&g<i&&(g=i);b&&b<i&&(b=i);return pv.rgb(Math.min(255,Math.floor(r/k)),Math.min(255,Math.floor(g/k)),Math.min(255,Math.floor(b/k)),this.a);};pv.Color.Rgb.prototype.darker=function(k){k=Math.pow(.7,null!=k?k:1);return pv.rgb(Math.max(0,Math.floor(k*this.r)),Math.max(0,Math.floor(k*this.g)),Math.max(0,Math.floor(k*this.b)),this.a);};pv.Color.Rgb.prototype.hsl=function(){var h,s,r=this.r/255,g=this.g/255,b=this.b/255,max=Math.max(r,g,b),min=Math.min(r,g,b),l=(max+min)/2;if(max===min)h=s=0;else{var d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;}
h/=6;}
return pv.hsl(360*h,s,l,this.a);};pv.Color.Rgb.prototype.complementary=function(){return this.hsl().complementary().rgb();};pv.hsl=function(h,s,l,a){return new pv.Color.Hsl(h,s,l,4==arguments.length?a:1);};pv.Color.Hsl=function(h,s,l,a){pv.Color.call(this,"hsl("+h+","+100*s+"%,"+100*l+"%)",a);this.h=h;this.s=s;this.l=l;this.a=a;};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hsl=function(){return this;};pv.Color.Hsl.prototype.hue=function(h){return pv.hsl(h,this.s,this.l,this.a);};pv.Color.Hsl.prototype.saturation=function(s){return pv.hsl(this.h,s,this.l,this.a);};pv.Color.Hsl.prototype.lightness=function(l){return pv.hsl(this.h,this.s,l,this.a);};pv.Color.Hsl.prototype.alpha=function(a){return pv.hsl(this.h,this.s,this.l,a);};pv.Color.Hsl.prototype.complementary=function(){return pv.hsl((this.h+180)%360,1-this.s,1-this.l,this.a);};pv.Color.Hsl.prototype.rgb=function(){function v(h){h>360?h-=360:h<0&&(h+=360);return h<60?m1+(m2-m1)*h/60:h<180?m2:h<240?m1+(m2-m1)*(240-h)/60:m1;}
function vv(h){return Math.round(255*v(h));}
var h=this.h,s=this.s,l=this.l;h%=360;h<0&&(h+=360);s=Math.max(0,Math.min(s,1));l=Math.max(0,Math.min(l,1));var m2=l<=.5?l*(1+s):l+s-l*s,m1=2*l-m2;return pv.rgb(vv(h+120),vv(h),vv(h-120),this.a);};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};!function(){var names=pv.Color.names;names.none=names.transparent;for(var name in names)names[name]=pv.color(names[name]);}();pv.colors=function(){var scale=pv.Scale.ordinal();scale.range.apply(scale,arguments);return scale;};pv.Colors={};pv.Colors.category10=function(){var scale=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");scale.domain.apply(scale,arguments);return scale;};pv.Colors.category20=function(){var scale=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");scale.domain.apply(scale,arguments);return scale;};pv.Colors.category19=function(){var scale=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");scale.domain.apply(scale,arguments);return scale;};!function(){function parseLinearGradient(text){var terms=parseText(text);if(!terms.length)return null;var keyAngle,m,f,angle=Math.PI,term=terms[0];if(0===term.indexOf("to ")){m=/^to\s+(?:((top|bottom)(?:\s+(left|right))?)|((left|right)(?:\\s+(top|bottom))?))$/.exec(term);if(m){if(m[1]){keyAngle=m[2];m[3]&&(keyAngle+=" "+m[3]);}else{keyAngle=m[5];m[6]&&(keyAngle=m[6]+" "+keyAngle);}
angle=pv.radians(keyAnglesDeg[keyAngle]);terms.shift();}}else{f=parseFloat(term);if(!isNaN(f)){angle=f;/^.*?deg$/.test(term)&&(angle=pv.radians(angle));terms.shift();}}
var stops=parseStops(terms);switch(stops.length){case 0:return null;case 1:return new pv.FillStyle.Solid(stops[0].color,1);}
return new pv.FillStyle.LinearGradient(angle,stops,text);}
function parseRadialGradient(text){var terms=parseText(text);if(!terms.length)return null;var stops=parseStops(terms);switch(stops.length){case 0:return null;case 1:return new pv.FillStyle.Solid(stops[0].color,1);}
return new pv.FillStyle.RadialGradient(50,50,stops,text);}
function parseText(text){var colorFuns={},colorFunId=0;text=text.replace(/\b\w+?\(.*?\)/g,function($0){var id="__color"+colorFunId++;colorFuns[id]=$0;return id;});var terms=text.split(/\s*,\s*/);if(!terms.length)return null;colorFunId&&terms.forEach(function(id,index){colorFuns.hasOwnProperty(id)&&(terms[index]=colorFuns[id]);});return terms;}
function parseStops(terms){for(var stops=[],minOffsetPercent=1/0,maxOffsetPercent=-1/0,pendingOffsetStops=[],i=0,T=terms.length;i<T;){var term=terms[i++],m=/^(.+?)\s*([+\-]?[e\.\d]+%)?$/i.exec(term);if(m){var stop={color:pv.color(m[1])},offsetPercent=parseFloat(m[2]);isNaN(offsetPercent)&&(stops.length?i===T&&(offsetPercent=Math.max(maxOffsetPercent,100)):offsetPercent=0);stops.push(stop);if(isNaN(offsetPercent))pendingOffsetStops.push(stop);else{stop.offset=offsetPercent;!function(lastOffset){var count=pendingOffsetStops.length;if(count){for(var firstOffset=maxOffsetPercent,step=(lastOffset-firstOffset)/(count+1),i=0;i<count;i++){firstOffset+=step;pendingOffsetStops[i].offset=firstOffset;}
pendingOffsetStops.length=0;}}(offsetPercent);offsetPercent>maxOffsetPercent?maxOffsetPercent=offsetPercent:offsetPercent<maxOffsetPercent&&(offsetPercent=maxOffsetPercent);offsetPercent<minOffsetPercent&&(minOffsetPercent=offsetPercent);}}}
if(stops.length>=2&&(minOffsetPercent<0||maxOffsetPercent>100)){var colorDomain=[],colorRange=[];stops.forEach(function(stop){colorDomain.push(stop.offset);colorRange.push(stop.color);});var colorScale=pv.scale.linear().domain(colorDomain).range(colorRange);if(minOffsetPercent<0){for(;stops.length&&stops[0].offset<=0;)stops.shift();stops.unshift({offset:0,color:colorScale(0)});}
if(maxOffsetPercent>100){for(;stops.length&&stops[stops.length-1].offset>=100;)stops.pop();stops.push({offset:100,color:colorScale(100)});}}
return stops;}
pv.fillStyle=function(format){if(format.type)return format;var k=format.key||format,fillStyle=fillStylesByKey[k];fillStyle=fillStyle?fillStyle.clone():fillStylesByKey[k]=createFillStyle(format);return fillStyle;};var fillStylesByKey={},createFillStyle=function(format){if(format.rgb)return new pv.FillStyle.Solid(format.color,format.opacity);var match=/^\s*([a-z\-]+)\(\s*(.*?)\s*\)\s*$/.exec(format);if(match)switch(match[1]){case"linear-gradient":return parseLinearGradient(match[2]);case"radial-gradient":return parseRadialGradient(match[2]);}
return new pv.FillStyle.Solid(pv.color(format));},keyAnglesDeg={top:0,"top right":45,right:90,"bottom right":135,bottom:180,"bottom left":225,left:270,"top left":315},FillStyle=pv.FillStyle=function(type){this.type=type;this.key=type;};pv.extendType(FillStyle,new pv.Color("none",1));FillStyle.prototype.rgb=function(){var color=pv.color(this.color);this.opacity!==color.opacity&&(color=color.alpha(this.opacity));return color;};FillStyle.prototype.alphaBlend=function(mate){return this.rgb().alphaBlend(mate);};FillStyle.prototype.rgbDecimal=function(mate){return this.rgb().rgbDecimal(mate);};FillStyle.prototype.isDark=function(){return this.rgb().isDark();};var Solid=pv.FillStyle.Solid=function(color,opacity){FillStyle.call(this,"solid");if(color.rgb){this.color=color.color;this.opacity=color.opacity;}else{this.color=color;this.opacity=opacity;}
this.key+=" "+this.color+" alpha("+this.opacity+")";};pv.extendType(Solid,FillStyle);Solid.prototype.alpha=function(opacity){return new Solid(this.color,opacity);};Solid.prototype.brighter=function(k){return new Solid(this.rgb().brighter(k));};Solid.prototype.darker=function(k){return new Solid(this.rgb().darker(k));};Solid.prototype.complementary=function(){return new Solid(this.rgb().complementary());};Solid.prototype.clone=function(){var o=pv.extend(Solid);o.type=this.type;o.key=this.key;o.color=this.color;o.opacity=this.opacity;return o;};pv.FillStyle.transparent=new Solid(pv.Color.transparent);var gradient_id=0,Gradient=pv.FillStyle.Gradient=function(type,stops){FillStyle.call(this,type);this.id=++gradient_id;this.stops=stops;stops.length&&(this.color=stops[0].color.color);this.key+=" stops("+stops.map(function(stop){var color=stop.color;return color.color+" alpha("+color.opacity+") at("+stop.offset+")";}).join(", ")+")";};pv.extendType(Gradient,FillStyle);Gradient.prototype.rgb=function(){return this.stops.length?this.stops[0].color:void 0;};Gradient.prototype.alpha=function(opacity){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.alpha(opacity)};}));};Gradient.prototype.darker=function(k){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.darker(k)};}));};Gradient.prototype.brighter=function(k){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.brighter(k)};}));};Gradient.prototype.complementary=function(){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.complementary()};}));};Gradient.prototype.alphaBlend=function(mate){return this._cloneWithStops(this.stops.map(function(stop){return{offset:stop.offset,color:stop.color.alphaBlend(mate)};}));};Gradient.prototype.clone=function(){var Type=this.constructor,o=pv.extend(Type);o.constructor=Type;o.id=++gradient_id;o.type=this.type;o.key=this.key;var stops=this.stops;o.stops=stops;stops.length&&(o.color=stops[0].color.color);this._initClone(o);return o;};var LinearGradient=pv.FillStyle.LinearGradient=function(angle,stops){Gradient.call(this,"lineargradient",stops);this.angle=angle;this.key+=" angle("+angle+")";};pv.extendType(LinearGradient,Gradient);LinearGradient.prototype._cloneWithStops=function(stops){return new LinearGradient(this.angle,stops);};LinearGradient.prototype._initClone=function(o){o.angle=this.angle;};var RadialGradient=pv.FillStyle.RadialGradient=function(cx,cy,stops){Gradient.call(this,"radialgradient",stops);this.cx=cx;this.cy=cy;this.key+=" center("+cx+","+cy+")";};pv.extendType(RadialGradient,Gradient);RadialGradient.prototype._cloneWithStops=function(stops){return new RadialGradient(this.cx,this.cy,stops);};RadialGradient.prototype._initClone=function(o){o.cx=this.cx;o.cy=this.cy;};}();pv.ramp=function(start,end){var scale=pv.Scale.linear();scale.range.apply(scale,arguments);return scale;};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick","contextmenu"],mousePositionEventSet:{mousedown:1,mouseup:1,mouseover:1,mouseout:1,mousemove:1,click:1,dblclick:1,contextmenu:1},implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter","stroke-linecap":"butt","stroke-miterlimit":8,"stroke-dasharray":"none"},css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(scenes){if(scenes.length&&scenes[0].reverse&&"line"!==scenes.type&&"area"!==scenes.type){for(var reversed=Object.create(scenes),i=0,j=scenes.length-1;j>=0;i++,j--)reversed[i]=scenes[j];scenes=reversed;}
this.removeSiblings(this[scenes.type](scenes));};pv.SvgScene.create=function(type){return document.createElementNS(this.svg,type);};pv.SvgScene.expect=function(e,type,scenes,i,attributes,style){var tagName;if(e){tagName=e.tagName;if("defs"===tagName){e=e.nextSibling;e&&(tagName=e.tagName);}else"a"===tagName&&(e=e.firstChild);}
if(e){if(tagName!==type){var n=this.create(type);e.parentNode.replaceChild(n,e);e=n;}}else e=this.create(type);attributes&&this.setAttributes(e,attributes);style&&this.setStyle(e,style);return e;};pv.SvgScene.setAttributes=function(e,attributes){var implicitSvg=this.implicit.svg,prevAttrs=e.__attributes__;prevAttrs===attributes&&(prevAttrs=null);for(var name in attributes){var value=attributes[name];prevAttrs&&value===prevAttrs[name]||(null==value||value==implicitSvg[name]?e.removeAttribute(name):e.setAttribute(name,value));}
e.__attributes__=attributes;};pv.SvgScene.setStyle=function(e,style){var implicitCss=this.implicit.css,prevStyle=e.__style__;prevStyle===style&&(prevStyle=null);for(var name in style){var value=style[name];prevStyle&&value===prevStyle[name]||(null==value||value==implicitCss[name]?e.style.removeProperty(name):e.style[name]=value);}
e.__style__=style;};pv.SvgScene.append=function(e,scenes,index){e.$scene={scenes:scenes,index:index};e=this.title(e,scenes[index]);e.parentNode||scenes.$g.appendChild(e);return e.nextSibling;};pv.SvgScene.title=function(e,s){var a=e.parentNode;a&&"a"!=a.tagName&&(a=null);if(s.title){if(!a){a=this.create("a");a.setAttributeNS(this.xlink,"xlink:href","");e.parentNode&&e.parentNode.replaceChild(a,e);a.appendChild(e);}
a.setAttributeNS(this.xlink,"xlink:title",s.title);for(var t=null,c=e.firstChild;null!=c;c=c.nextSibling)if("title"==c.nodeName){t=c;break;}
if(t)t.removeChild(t.firstChild);else{t=this.create("title");e.appendChild(t);}
t.appendChild(document.createTextNode(s.title));return a;}
a&&a.parentNode.replaceChild(e,a);return e;};pv.SvgScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t){var type=e.type;switch(type){case"DOMMouseScroll":type="mousewheel";e.wheel=-480*e.detail;break;case"mousewheel":e.wheel=(window.opera?12:1)*e.wheelDelta;}
if(pv.Mark.dispatch(type,t.scenes,t.index,e)){e.preventDefault();e.stopPropagation();}}});pv.SvgScene.removeSiblings=function(e){for(;e;){var n=e.nextSibling;"defs"!==e.nodeName&&e.parentNode.removeChild(e);e=n;}};pv.SvgScene.undefined=function(){};!function(){var dashAliasMap={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},dashMap={shortdash:[3,1],shortdot:[1,1],shortdashdot:[3,1,1,1],shortdashdotdot:[3,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};pv.SvgScene.isStandardDashStyle=function(dashArray){return dashMap.hasOwnProperty(dashArray);};pv.SvgScene.translateDashStyleAlias=function(dashArray){return dashAliasMap.hasOwnProperty(dashArray)?dashAliasMap[dashArray]:dashArray;};pv.SvgScene.parseDasharray=function(s){var dashArray=s.strokeDasharray;if(dashArray&&"none"!==dashArray){dashArray=this.translateDashStyleAlias(dashArray);var standardDashArray=dashMap[dashArray];dashArray=standardDashArray||dashArray.split(/[\s,]+/);var lineWidth=s.lineWidth,lineCap=s.lineCap||"butt",isButtCap="butt"===lineCap;dashArray=dashArray.map(function(num,index){num=+num;isButtCap||(index%2?num++:num-=1);num<=0&&(num=.001);return num*lineWidth/this.scale;},this).join(" ");}else dashArray=null;return dashArray;};}();!function(){var reTestUrlColor=/^url\(#/,next_gradient_id=1,pi2=Math.PI/2,pi4=pi2/2,sqrt22=Math.SQRT2/2,abs=Math.abs,sin=Math.sin,cos=Math.cos,zr=function(x){return abs(x)<=1e-12?0:x;};pv.SvgScene.addFillStyleDefinition=function(scenes,fill){if(fill.type&&"solid"!==fill.type&&!reTestUrlColor.test(fill.color)){var rootMark=scenes.mark.root,fillStyleMap=rootMark.__fillStyleMap__||(rootMark.__fillStyleMap__={}),k=fill.key,instId=fillStyleMap[k];if(!instId){instId=fillStyleMap[k]="__pvGradient"+next_gradient_id++;var elem=createGradientDef.call(this,scenes,fill,instId);rootMark.scene.$defs.appendChild(elem);}
fill.color="url(#"+instId+")";}};var createGradientDef=function(scenes,fill,instId){var isLinear="lineargradient"===fill.type,elem=this.create(isLinear?"linearGradient":"radialGradient");elem.setAttribute("id",instId);if(isLinear){var svgAngle=fill.angle-pi2,diagAngle=abs(svgAngle%pi2)-pi4,r=abs(sqrt22*cos(diagAngle)),dirx=r*cos(svgAngle),diry=r*sin(svgAngle);elem.setAttribute("x1",zr(.5-dirx));elem.setAttribute("y1",zr(.5-diry));elem.setAttribute("x2",zr(.5+dirx));elem.setAttribute("y2",zr(.5+diry));}
for(var stops=fill.stops,S=stops.length,i=0;i<S;i++){var stop=stops[i],stopElem=elem.appendChild(this.create("stop")),color=stop.color;stopElem.setAttribute("offset",stop.offset+"%");stopElem.setAttribute("stop-color",color.color);stopElem.setAttribute("stop-opacity",color.opacity+"");}
return elem;};}();pv.SvgScene.pathBasis=function(){function weight(w,p0,p1,p2,p3){return{x:w[0]*p0.left+w[1]*p1.left+w[2]*p2.left+w[3]*p3.left,y:w[0]*p0.top+w[1]*p1.top+w[2]*p2.top+w[3]*p3.top};}
var basis=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]],convert=function(p0,p1,p2,p3){var b1=weight(basis[1],p0,p1,p2,p3),b2=weight(basis[2],p0,p1,p2,p3),b3=weight(basis[3],p0,p1,p2,p3);return"C"+b1.x+","+b1.y+","+b2.x+","+b2.y+","+b3.x+","+b3.y;};convert.segment=function(p0,p1,p2,p3){var b0=weight(basis[0],p0,p1,p2,p3),b1=weight(basis[1],p0,p1,p2,p3),b2=weight(basis[2],p0,p1,p2,p3),b3=weight(basis[3],p0,p1,p2,p3);return["M"+b0.x+","+b0.y,"C"+b1.x+","+b1.y+","+b2.x+","+b2.y+","+b3.x+","+b3.y];};return convert;}();pv.SvgScene.curveBasis=function(points,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;if(L<=2)return"";var path="",p0=points[from],p1=p0,p2=p0,p3=points[from+1];path+=this.pathBasis(p0,p1,p2,p3);for(var i=from+2;i<=to;i++){p0=p1;p1=p2;p2=p3;p3=points[i];path+=this.pathBasis(p0,p1,p2,p3);}
path+=this.pathBasis(p1,p2,p3,p3);path+=this.pathBasis(p2,p3,p3,p3);return path;};pv.SvgScene.curveBasisSegments=function(points,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;if(L<=2)return"";var paths=[],p0=points[from],p1=p0,p2=p0,p3=points[from+1],firstPath=this.pathBasis.segment(p0,p1,p2,p3);p0=p1;p1=p2;p2=p3;p3=points[from+2];firstPath[1]+=this.pathBasis(p0,p1,p2,p3);paths.push(firstPath);for(var i=from+3;i<=to;i++){p0=p1;p1=p2;p2=p3;p3=points[i];paths.push(this.pathBasis.segment(p0,p1,p2,p3));}
var lastPath=this.pathBasis.segment(p1,p2,p3,p3);lastPath[1]+=this.pathBasis(p2,p3,p3,p3);paths.push(lastPath);return paths;};pv.SvgScene.curveHermite=function(points,tangents,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;var T=tangents.length;if(T<1||L!==T&&L!==T+2)return"";var quad=L!==T,path="",p0=points[from],p=points[from+1],t0=tangents[0],t=t0,pi=from+1;if(quad){path+="Q"+(p.left-2*t0.x/3)+","+(p.top-2*t0.y/3)+","+p.left+","+p.top;p0=points[from+1];pi=from+2;}
if(T>1){t=tangents[1];p=points[pi];pi++;path+="C"+(p0.left+t0.x)+","+(p0.top+t0.y)+","+(p.left-t.x)+","+(p.top-t.y)+","+p.left+","+p.top;for(var i=2;i<T;i++,pi++){p=points[pi];t=tangents[i];path+="S"+(p.left-t.x)+","+(p.top-t.y)+","+p.left+","+p.top;}}
if(quad){var lp=points[pi];path+="Q"+(p.left+2*t.x/3)+","+(p.top+2*t.y/3)+","+lp.left+","+lp.top;}
return path;};pv.SvgScene.curveHermiteSegments=function(points,tangents,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;var T=tangents.length;if(T<1||L!==T&&L!==T+2)return[];var quad=L!==T,paths=[],p0=points[from],p=p0,t0=tangents[0],t=t0,pi=from+1;if(quad){p=points[from+1];paths.push(["M"+p0.left+","+p0.top,"Q"+(p.left-2*t.x/3)+","+(p.top-2*t.y/3)+","+p.left+","+p.top]);pi=from+2;}
for(var i=1;i<T;i++,pi++){p0=p;t0=t;p=points[pi];t=tangents[i];paths.push(["M"+p0.left+","+p0.top,"C"+(p0.left+t0.x)+","+(p0.top+t0.y)+","+(p.left-t.x)+","+(p.top-t.y)+","+p.left+","+p.top]);}
if(quad){var lp=points[pi];paths.push(["M"+p.left+","+p.top,"Q"+(p.left+2*t.x/3)+","+(p.top+2*t.y/3)+","+lp.left+","+lp.top]);}
return paths;};pv.SvgScene.cardinalTangents=function(points,tension,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;for(var tangents=[],a=(1-tension)/2,p0=points[from],p1=points[from+1],p2=points[from+2],i=from+3;i<=to;i++){tangents.push({x:a*(p2.left-p0.left),y:a*(p2.top-p0.top)});p0=p1;p1=p2;p2=points[i];}
tangents.push({x:a*(p2.left-p0.left),y:a*(p2.top-p0.top)});return tangents;};pv.SvgScene.curveCardinal=function(points,tension,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;return L<=2?"":this.curveHermite(points,this.cardinalTangents(points,tension,from,to),from,to);};pv.SvgScene.curveCardinalSegments=function(points,tension,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;return L<=2?"":this.curveHermiteSegments(points,this.cardinalTangents(points,tension,from,to),from,to);};pv.SvgScene.monotoneTangents=function(points,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;var j,tangents=[],d=[],m=[],dx=[],k=0;for(k=0;k<L-1;k++){j=from+k;var den=points[j+1].left-points[j].left;d[k]=Math.abs(den)<=1e-12?0:(points[j+1].top-points[j].top)/den;}
m[0]=d[0];dx[0]=points[from+1].left-points[from].left;for(k=1,j=from+k;k<L-1;k++,j++){m[k]=(d[k-1]+d[k])/2;dx[k]=(points[j+1].left-points[j-1].left)/2;}
m[k]=d[k-1];dx[k]=points[j].left-points[j-1].left;for(k=0;k<L-1;k++)if(0==d[k]){m[k]=0;m[k+1]=0;}
for(k=0;k<L-1;k++)if(!(Math.abs(m[k])<1e-5||Math.abs(m[k+1])<1e-5)){var ak=m[k]/d[k],bk=m[k+1]/d[k],s=ak*ak+bk*bk;if(s>9){var tk=3/Math.sqrt(s);m[k]=tk*ak*d[k];m[k+1]=tk*bk*d[k];}}
for(var len,i=0;i<L;i++){len=1+m[i]*m[i];tangents.push({x:dx[i]/3/len,y:m[i]*dx[i]/3/len});}
return tangents;};pv.SvgScene.curveMonotone=function(points,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;return L<=2?"":this.curveHermite(points,this.monotoneTangents(points,from,to),from,to);};pv.SvgScene.curveMonotoneSegments=function(points,from,to){var L;if(null==from){L=points.length;from=0;to=L-1;}else L=to-from+1;return L<=2?"":this.curveHermiteSegments(points,this.monotoneTangents(points,from,to),from,to);};pv.SvgScene.area=function(scenes){var e=scenes.$g.firstChild,count=scenes.length;if(!count)return e;var s=scenes[0];return"smart"===s.segmented?this.areaSegmentedSmart(e,scenes):s.segmented?this.areaSegmentedFull(e,scenes):this.areaFixed(e,scenes,0,count-1,!0);};pv.SvgScene.areaFixed=function(elm,scenes,from,to,addEvents){if(1==to-from+1)return this.lineAreaDotAlone(elm,scenes,from);var s=scenes[from];if(!s.visible)return elm;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)return elm;this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var isInterpBasis=!1,isInterpCardinal=!1,isInterpMonotone=!1,isInterpStepAfter=!1,isInterpStepBefore=!1;switch(s.interpolate){case"basis":isInterpBasis=!0;break;case"cardinal":isInterpCardinal=!0;break;case"monotone":isInterpMonotone=!0;break;case"step-after":isInterpStepAfter=!0;break;case"step-before":isInterpStepBefore=!0;}
for(var si,sj,isInterpBasisCardinalOrMonotone=isInterpBasis||isInterpCardinal||isInterpMonotone,d=[],i=from;i<=to;i++){si=scenes[i];if(si.width||si.height){for(var j=i+1;j<=to;j++){sj=scenes[j];if(!sj.width&&!sj.height)break;}
i>from&&!isInterpStepAfter&&i--;j<=to&&!isInterpStepBefore&&j++;var fun=isInterpBasisCardinalOrMonotone&&j-i>2?this.areaPathCurve:this.areaPathStraight;d.push(fun.call(this,scenes,i,j-1,s));i=j-1;}}
if(!d.length)return elm;var sop=stroke.opacity;elm=this.expect(elm,"path",scenes,from,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":addEvents?s.events:"none",cursor:s.cursor,d:"M"+d.join("ZM")+"Z",fill:fill.color,"fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":sop||null,"stroke-width":sop?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":sop?this.parseDasharray(s):null});s.svg&&this.setAttributes(elm,s.svg);s.css&&this.setStyle(elm,s.css);return this.append(elm,scenes,from);};pv.SvgScene.areaSegmentedSmart=function(elm,scenes){return this.eachLineAreaSegment(elm,scenes,function(elm,scenes,from,to){var segment=this.areaSegmentPaths(scenes,from,to),pathsT=segment.top,pathsB=segment.bottom,fromp=from,options={breakOnKeyChange:!0,from:from,to:to};return this.eachLineAreaSegment(elm,scenes,options,function(elm,scenes,from,to,ka,eventsMax){var s1=scenes[from],fill=s1.fillStyle,stroke=s1.strokeStyle;this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);if(from===to)return this.lineAreaDotAlone(elm,scenes,from);var d=this.areaJoinPaths(pathsT,pathsB,from-fromp,to-fromp-1),sop=stroke.opacity,attrs={"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":eventsMax,cursor:s1.cursor,d:d,fill:fill.color,"fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":sop||null,"stroke-width":sop?s1.lineWidth/this.scale:null,"stroke-linecap":s1.lineCap,"stroke-linejoin":s1.lineJoin,"stroke-miterlimit":s1.strokeMiterLimit,"stroke-dasharray":sop?this.parseDasharray(s1):null};elm=this.expect(elm,"path",scenes,from,attrs,s1.css);return this.append(elm,scenes,from);});});};pv.SvgScene.areaSegmentPaths=function(scenes,from,to){return this.areaSegmentCurvePaths(scenes,from,to)||this.areaSegmentStraightPaths(scenes,from,to);};pv.SvgScene.areaSegmentCurvePaths=function(scenes,from,to){var count=to-from+1,s=scenes[from],isBasis="basis"===s.interpolate,isCardinal=!isBasis&&"cardinal"===s.interpolate;if(isBasis||isCardinal||"monotone"==s.interpolate){for(var pointsT=[],pointsB=[],i=0;i<count;i++){var si=scenes[from+i],sj=scenes[to-i];pointsT.push(si);pointsB.push({left:sj.left+sj.width,top:sj.top+sj.height});}
var pathsT,pathsB;if(isBasis){pathsT=this.curveBasisSegments(pointsT);pathsB=this.curveBasisSegments(pointsB);}else if(isCardinal){pathsT=this.curveCardinalSegments(pointsT,s.tension);pathsB=this.curveCardinalSegments(pointsB,s.tension);}else{pathsT=this.curveMonotoneSegments(pointsT);pathsB=this.curveMonotoneSegments(pointsB);}
if(pathsT||pathsT.length)return{from:from,top:pathsT,bottom:pathsB};}};pv.SvgScene.areaSegmentStraightPaths=function(scenes,i,j){for(var pathsT=[],pathsB=[],k=j,m=i;i<k;i++,j--){var si=scenes[i],sj=scenes[j],pi=["M"+si.left+","+si.top],pj=["M"+(sj.left+sj.width)+","+(sj.top+sj.height)],sk=scenes[i+1],sl=scenes[j-1];switch(si.interpolate){case"step-before":pi.push("V"+sk.top+"H"+sk.left);break;case"step-after":pi.push("H"+sk.left+"V"+sk.top);break;default:pi.push("L"+sk.left+","+sk.top);}
pj.push("L"+(sl.left+sl.width)+","+(sl.top+sl.height));pathsT.push(pi);pathsB.push(pj);}
return{from:m,top:pathsT,bottom:pathsB};};pv.SvgScene.areaJoinPaths=function(pathsT,pathsB,i,j){for(var fullPathT="",fullPathB="",N=pathsT.length,k=i,l=N-1-j;k<=j;k++,l++){var dT,dB,pathT=pathsT[k],pathB=pathsB[l];if(k===i){dT=pathT.join("");dB="L"+pathB[0].substr(1)+pathB[1];}else{dT=pathT[1];dB=pathB[1];}
fullPathT+=dT;fullPathB+=dB;}
return fullPathT+fullPathB+"Z";};pv.SvgScene.areaSegmentedFull=function(e,scenes){var pathsT,pathsB,count=scenes.length,result=this.areaSegmentCurvePaths(scenes,0,count-1);if(result){pathsT=result.top;pathsB=result.bottom;}
for(var i=(scenes[0],0);i<count-1;i++){var s1=scenes[i],s2=scenes[i+1];if(s1.visible&&s2.visible){var fill=s1.fillStyle,stroke=s1.strokeStyle;if(fill.opacity||stroke.opacity){var d;if(pathsT){d=pathsT[i].join("")+("L"+pathsB[count-i-2].join("").substr(1))+"Z";}else{var si=s1,sj=s2;switch(s1.interpolate){case"step-before":si=s2;break;case"step-after":sj=s1;}
d="M"+s1.left+","+si.top+"L"+s2.left+","+sj.top+"L"+(s2.left+s2.width)+","+(sj.top+sj.height)+"L"+(s1.left+s1.width)+","+(si.top+si.height)+"Z";}
var attrs={"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":s1.events,cursor:s1.cursor,d:d,fill:fill.color,"fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s1.lineWidth/this.scale:null};e=this.expect(e,"path",scenes,i,attrs);s1.svg&&this.setAttributes(e,s1.svg);s1.css&&this.setStyle(e,s1.css);e=this.append(e,scenes,i);}}}
return e;};pv.SvgScene.areaPathStraight=function(scenes,i,j,s){for(var pointsT=[],pointsB=[],k=j;i<=k;i++,j--){var si=scenes[i],sj=scenes[j],pi=si.left+","+si.top,pj=sj.left+sj.width+","+(sj.top+sj.height);if(i<k){var sk=scenes[i+1],sl=scenes[j-1];switch(s.interpolate){case"step-before":pi+="V"+sk.top;pj+="H"+(sl.left+sl.width);break;case"step-after":pi+="H"+sk.left;pj+="V"+(sl.top+sl.height);}}
pointsT.push(pi);pointsB.push(pj);}
return pointsT.concat(pointsB).join("L");};pv.SvgScene.areaPathCurve=function(scenes,i,j,s){for(var pathT,pathB,pointsT=[],pointsB=[],k=j;i<=k;i++,j--){var sj=scenes[j];pointsT.push(scenes[i]);pointsB.push({left:sj.left+sj.width,top:sj.top+sj.height});}
switch(s.interpolate){case"basis":pathT=this.curveBasis(pointsT);pathB=this.curveBasis(pointsB);break;case"cardinal":pathT=this.curveCardinal(pointsT,s.tension);pathB=this.curveCardinal(pointsB,s.tension);break;default:pathT=this.curveMonotone(pointsT);pathB=this.curveMonotone(pointsB);}
return pointsT[0].left+","+pointsT[0].top+pathT+"L"+pointsB[0].left+","+pointsB[0].top+pathB;};pv.SvgScene.minBarWidth=1;pv.SvgScene.minBarHeight=1;pv.SvgScene.minBarLineWidth=.2;pv.SvgScene.bar=function(scenes){for(var e=scenes.$g.firstChild,i=0;i<scenes.length;i++){var s=scenes[i];if(!(!s.visible||Math.abs(s.width)<=1e-10||Math.abs(s.height)<=1e-10)){s.width<this.minBarWidth&&(s.width=this.minBarWidth);s.height<this.minBarHeight&&(s.height=this.minBarHeight);var fill=s.fillStyle,stroke=s.strokeStyle;if(fill.opacity||stroke.opacity){this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var lineWidth;if(stroke.opacity){lineWidth=s.lineWidth;lineWidth=lineWidth<1e-10?0:Math.max(this.minBarLineWidth,lineWidth/this.scale);}else lineWidth=null;e=this.expect(e,"rect",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,cursor:s.cursor,x:s.left,y:s.top,width:Math.max(1e-10,s.width),height:Math.max(1e-10,s.height),fill:fill.color,"fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":lineWidth,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});s.svg&&this.setAttributes(e,s.svg);s.css&&this.setStyle(e,s.css);e=this.append(e,scenes,i);}}}
return e;};pv.SvgScene.dot=function(scenes){for(var e=scenes.$g.firstChild,i=0,L=scenes.length;i<L;i++){var s=scenes[i];if(s.visible){var fill=s.fillStyle,fillOp=fill.opacity,stroke=s.strokeStyle,strokeOp=stroke.opacity;if(fillOp||strokeOp){this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var svg={"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,cursor:s.cursor,fill:fill.color,"fill-opacity":fillOp||null,stroke:stroke.color,"stroke-opacity":strokeOp||null,"stroke-width":strokeOp?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-dasharray":strokeOp?this.parseDasharray(s):null},shape=s.shape||"circle",ar=s.aspectRatio,sa=s.shapeAngle,t=null;if("circle"!==shape&&this.hasSymbol(shape)){var r=s.shapeRadius,rx=r,ry=r;if(ar>0&&1!==ar){var sy=1/Math.sqrt(ar);rx*=ar*sy;ry*=sy;}
svg.d=this.renderSymbol(shape,s,rx,ry);shape="path";t="translate("+s.left+","+s.top+") ";sa&&(t+="rotate("+pv.degrees(sa)+") ");}else if(1===ar){shape="circle";svg.cx=s.left;svg.cy=s.top;svg.r=s.shapeRadius;}else{shape="ellipse";svg.cx=svg.cy=0;t="translate("+s.left+","+s.top+") ";sa&&(t+="rotate("+pv.degrees(sa)+") ");svg.rx=s._width/2;svg.ry=s._height/2;}
t&&(svg.transform=t);e=this.expect(e,shape,scenes,i,svg);s.svg&&this.setAttributes(e,s.svg);s.css&&this.setStyle(e,s.css);e=this.append(e,scenes,i);}}}
return e;};!function(S){var _renderersBySymName={};S.registerSymbol=function(symName,funRenderer){_renderersBySymName[symName.toLowerCase()]=funRenderer;return S;};S.renderSymbol=function(symName,instance,rx,ry){return _renderersBySymName[symName].call(S,instance,symName,rx,ry);};S.hasSymbol=function(symName){return _renderersBySymName.hasOwnProperty(symName);};S.symbols=function(){return pv.keys(_renderersBySymName);};var C1=2/Math.sqrt(3);S.registerSymbol("circle",function(s){throw new Error("Not implemented as a symbol");}).registerSymbol("cross",function(s,name,rx,ry){var rxn=(s.shapeRadius,-rx),ryn=-ry;return"M"+rxn+","+ryn+"L"+rx+","+ry+"M"+rx+","+ryn+"L"+rxn+","+ry;}).registerSymbol("triangle",function(s,name,rx,ry){var hp=ry,wp=rx*C1,hn=-ry;return"M0,"+hp+"L"+wp+","+hn+" "+-wp+","+hn+"Z";}).registerSymbol("diamond",function(s,name,rx,ry){var rxp=rx*Math.SQRT2,ryp=ry*Math.SQRT2;return"M0,"+-ryp+"L"+rxp+",0 0,"+ryp+" "+-rxp+",0Z";}).registerSymbol("square",function(s,name,rx,ry){var rxn=-rx,ryn=-ry;return"M"+rxn+","+ryn+"L"+rx+","+ryn+" "+rx+","+ry+" "+rxn+","+ry+"Z";}).registerSymbol("tick",function(s,name,rx,ry){return"M0,0L0,"+-ry*ry;}).registerSymbol("bar",function(s,name,rx,ry){var z2=ry*ry/2;return"M0,"+z2+"L0,"+-z2;});}(pv.SvgScene);pv.SvgScene.image=function(scenes){for(var e=scenes.$g.firstChild,i=0;i<scenes.length;i++){var s=scenes[i];if(s.visible){e=this.fill(e,scenes,i);if(s.image){e=this.expect(e,"foreignObject",scenes,i,{cursor:s.cursor,x:s.left,y:s.top,width:s.width,height:s.height});s.svg&&this.setAttributes(e,s.svg);s.css&&this.setStyle(e,s.css);var c=e.firstChild||e.appendChild(document.createElementNS(this.xhtml,"canvas"));c.$scene={scenes:scenes,index:i};c.style.width=s.width;c.style.height=s.height;c.width=s.imageWidth;c.height=s.imageHeight;c.getContext("2d").putImageData(s.image,0,0);}else{e=this.expect(e,"image",scenes,i,{preserveAspectRatio:"none",cursor:s.cursor,x:s.left,y:s.top,width:s.width,height:s.height});s.svg&&this.setAttributes(e,s.svg);s.css&&this.setStyle(e,s.css);e.setAttributeNS(this.xlink,"xlink:href",s.url);}
e=this.append(e,scenes,i);e=this.stroke(e,scenes,i);}}
return e;};pv.SvgScene.label=function(scenes){for(var e=scenes.$g.firstChild,i=0;i<scenes.length;i++){var s=scenes[i];if(s.visible){var fill=s.textStyle;if(fill.opacity&&s.text){var x=0,y=0,dy=0,anchor="start";switch(s.textBaseline){case"middle":dy=".35em";break;case"top":dy=".71em";y=s.textMargin;break;case"bottom":y="-"+s.textMargin;}
switch(s.textAlign){case"right":anchor="end";x="-"+s.textMargin;break;case"center":anchor="middle";break;case"left":x=s.textMargin;}
e=this.expect(e,"text",scenes,i,{"pointer-events":s.events,cursor:s.cursor,x:x,y:y,dy:dy,transform:"translate("+s.left+","+s.top+")"+(s.textAngle?" rotate("+180*s.textAngle/Math.PI+")":"")+(1!=this.scale?" scale("+1/this.scale+")":""),fill:fill.color,"fill-opacity":fill.opacity||null,"text-anchor":anchor},{font:s.font,"text-shadow":s.textShadow,"text-decoration":s.textDecoration});s.svg&&this.setAttributes(e,s.svg);s.css&&this.setStyle(e,s.css);e.firstChild?e.firstChild.nodeValue=s.text:e.appendChild(document.createTextNode(s.text));e=this.append(e,scenes,i);}}}
return e;};pv.SvgScene.line=function(scenes){var e=scenes.$g.firstChild,count=scenes.length;if(!count)return e;var s=scenes[0];return"smart"===s.segmented?this.lineSegmentedSmart(e,scenes):count<2?e:s.segmented?this.lineSegmentedFull(e,scenes):this.lineFixed(e,scenes);};pv.SvgScene.lineFixed=function(elm,scenes){var count=scenes.length;if(1===count)return this.lineAreaDotAlone(elm,scenes,0);var s=scenes[0];if(!s.visible)return elm;var fill=s.fillStyle,stroke=s.strokeStyle;if(!fill.opacity&&!stroke.opacity)return elm;this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);var d="M"+s.left+","+s.top,curveInterpolated=count>2;if(curveInterpolated)switch(s.interpolate){case"basis":d+=this.curveBasis(scenes);break;case"cardinal":d+=this.curveCardinal(scenes,s.tension);break;case"monotone":d+=this.curveMonotone(scenes);break;default:curveInterpolated=!1;}
if(!curveInterpolated)for(var i=1;i<count;i++)d+=this.lineSegmentPath(scenes[i-1],scenes[i]);var sop=stroke.opacity,attrs={"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,cursor:s.cursor,d:d,fill:fill.color,"fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":sop||null,"stroke-width":sop?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":sop?this.parseDasharray(s):null};elm=this.expect(elm,"path",scenes,0,attrs,s.css);s.svg&&this.setAttributes(elm,s.svg);return this.append(elm,scenes,0);};pv.SvgScene.lineSegmentedSmart=function(elm,scenes){return this.eachLineAreaSegment(elm,scenes,function(elm,scenes,from,to){var paths=this.lineSegmentPaths(scenes,from,to),fromp=from,options={breakOnKeyChange:!0,from:from,to:to};return this.eachLineAreaSegment(elm,scenes,options,function(elm,scenes,from,to,ka,eventsMax){var s1=scenes[from],fill=s1.fillStyle;this.addFillStyleDefinition(scenes,fill);var stroke=s1.strokeStyle;this.addFillStyleDefinition(scenes,stroke);if(from===to)return this.lineAreaDotAlone(elm,scenes,from);var d=this.lineJoinPaths(paths,from-fromp,to-fromp-1),sop=stroke.opacity,attrs={"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":eventsMax,cursor:s1.cursor,d:d,fill:fill.color,"fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":sop||null,"stroke-width":sop?s1.lineWidth/this.scale:null,"stroke-linecap":s1.lineCap,"stroke-linejoin":s1.lineJoin,"stroke-miterlimit":s1.strokeMiterLimit,"stroke-dasharray":sop?this.parseDasharray(s1):null};elm=this.expect(elm,"path",scenes,from,attrs,s1.css);return this.append(elm,scenes,from);});});};pv.SvgScene.lineSegmentedFull=function(e,scenes){var paths,s=scenes[0];switch(s.interpolate){case"basis":paths=this.curveBasisSegments(scenes);break;case"cardinal":paths=this.curveCardinalSegments(scenes,s.tension);break;case"monotone":paths=this.curveMonotoneSegments(scenes);}
for(var i=0,n=scenes.length-1;i<n;i++){var s1=scenes[i],s2=scenes[i+1];if(s1.visible&&s2.visible){var stroke=s1.strokeStyle,fill=pv.FillStyle.transparent;if(stroke.opacity){var d;if("linear"==s1.interpolate&&"miter"==s1.lineJoin){fill=stroke;stroke=pv.FillStyle.transparent;d=this.pathJoin(scenes[i-1],s1,s2,scenes[i+2]);}else d=paths?paths[i].join(""):"M"+s1.left+","+s1.top+this.lineSegmentPath(s1,s2);e=this.expect(e,"path",scenes,i,{"shape-rendering":s1.antialias?null:"crispEdges","pointer-events":s1.events,cursor:s1.cursor,d:d,fill:fill.color,"fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s1.lineWidth/this.scale:null,"stroke-linejoin":s1.lineJoin});s1.svg&&this.setAttributes(e,s1.svg);s1.css&&this.setStyle(e,s1.css);e=this.append(e,scenes,i);}}}
return e;};pv.SvgScene.lineSegmentPath=function(s1,s2){var l=1;switch(s1.interpolate){case"polar-reverse":l=0;case"polar":var dx=s2.left-s1.left,dy=s2.top-s1.top,e=1-s1.eccentricity,r=Math.sqrt(dx*dx+dy*dy)/(2*e);if(e<=0||e>1)break;return"A"+r+","+r+" 0 0,"+l+" "+s2.left+","+s2.top;case"step-before":return"V"+s2.top+"H"+s2.left;case"step-after":return"H"+s2.left+"V"+s2.top;}
return"L"+s2.left+","+s2.top;};pv.SvgScene.lineSegmentPaths=function(scenes,from,to){var paths,s=scenes[from];switch(s.interpolate){case"basis":paths=this.curveBasisSegments(scenes,from,to);break;case"cardinal":paths=this.curveCardinalSegments(scenes,s.tension,from,to);break;case"monotone":paths=this.curveMonotoneSegments(scenes,from,to);}
if(!paths||!paths.length){paths=[];for(var i=from+1;i<=to;i++){var s1=scenes[i-1],s2=scenes[i];paths.push(["M"+s1.left+","+s1.top,this.lineSegmentPath(s1,s2)]);}}
return paths;};pv.strokeMiterLimit=4;pv.SvgScene.pathJoin=function(s0,s1,s2,s3){var miterLimit,miterRatio,miterLength,pts=[],w1=s1.lineWidth/this.scale,p1=pv.vector(s1.left,s1.top),p2=pv.vector(s2.left,s2.top),p21=p2.minus(p1),v21=p21.perp().norm(),w21=v21.times(w1/2),a=p1.plus(w21),d=p1.minus(w21),b=p2.plus(w21),c=p2.minus(w21);if(s0&&s0.visible){var p0=pv.vector(s0.left,s0.top),p10=p1.minus(p0),v10=p10.perp().norm(),v1=v10.plus(v21).norm(),am=this.lineIntersect(p1,v1,a,p21),dm=this.lineIntersect(p1,v1,d,p21);miterLength=am.minus(dm).length();var w0=s0.lineWidth/this.scale,w10avg=(w1+w0)/2;miterRatio=miterLength/w10avg;miterLimit=s1.strokeMiterLimit||pv.strokeMiterLimit;if(miterRatio<=miterLimit)pts.push(dm,am);else{var p12=p21.times(-1),v1Outer=p10.norm().plus(p12.norm()).norm(),bevel10=p1.plus(v1Outer.times(w10avg/2));v1Outer.dot(v21)>=0?pts.push(dm,bevel10,a):pts.push(d,bevel10,am);}}else pts.push(d,a);if(s3&&s3.visible){var p3=pv.vector(s3.left,s3.top),p32=p3.minus(p2),v32=p32.perp().norm(),v2=v32.plus(v21).norm(),bm=this.lineIntersect(p2,v2,b,p21),cm=this.lineIntersect(p2,v2,c,p21);miterLength=bm.minus(cm).length();var w3=s3.lineWidth/this.scale,w31avg=(w3+w1)/2;miterRatio=miterLength/w31avg;miterLimit=s2.strokeMiterLimit||pv.strokeMiterLimit;if(miterRatio<=miterLimit)pts.push(bm,cm);else{var p23=p32.times(-1),v2Outer=p21.norm().plus(p23.norm()).norm(),bevel31=p2.plus(v2Outer.times(w31avg/2));v2Outer.dot(v21)>=0?pts.push(b,bevel31,cm):pts.push(bm,bevel31,c);}}else pts.push(b,c);var pt=pts.shift();return"M"+pt.x+","+pt.y+"L"+pts.map(function(pt2){return pt2.x+","+pt2.y;}).join(" ");};pv.SvgScene.lineIntersect=function(o1,d1,o2,d2){return o1.plus(d1.times(o2.minus(o1).dot(d2.perp())/d1.dot(d2.perp())));};pv.SvgScene.lineJoinPaths=function(paths,from,to){for(var d=paths[from].join(""),i=from+1;i<=to;i++)d+=paths[i][1];return d;};pv.SvgScene.lineAreaDotAlone=function(elm,scenes,i){return elm;};pv.Scene.eventsToNumber={"":0,none:0,painted:1,all:2};pv.Scene.numberToEvents=["none","painted","all"];pv.SvgScene.eachLineAreaSegment=function(elm,scenes,keyArgs,lineAreaSegment){if("function"==typeof keyArgs){lineAreaSegment=keyArgs;keyArgs=null;}
var eventsNumber,ki,kf,breakOnKeyChange=pv.get(keyArgs,"breakOnKeyChange",!1),from=pv.get(keyArgs,"from")||0,to=pv.get(keyArgs,"to",scenes.length-1);if(breakOnKeyChange){ki=[];kf=[];}
for(var i=from;i<=to;){var si=scenes[i];if(this.isSceneVisible(si)){eventsNumber=this.eventsToNumber[si.events]||0;breakOnKeyChange&&this.lineAreaSceneKey(si,ki);for(var i2,f=i;;){var f2=f+1;if(f2>to){i2=f2;break;}
var sf=scenes[f2];if(!this.isSceneVisible(sf)){i2=f2+1;break;}
eventsNumber=Math.max(eventsNumber,this.eventsToNumber[sf.events]||0);f=f2;if(breakOnKeyChange){this.lineAreaSceneKey(sf,kf);if(!this.equalSceneKeys(ki,kf)){i2=f;break;}}}
elm=lineAreaSegment.call(this,elm,scenes,i,f,keyArgs,this.numberToEvents[eventsNumber]);i=i2;}else i++;}
return elm;};pv.SvgScene.lineAreaSceneKey=function(s,k){k[0]=s.fillStyle.key;k[1]=s.strokeStyle.key;k[2]=s.lineWidth;k[3]=s.strokeDasharray||"none";k[4]=s.interpolate;return k;};pv.SvgScene.isSceneVisible=function(s){return s.visible&&(s.fillStyle.opacity>0||s.strokeStyle.opacity>0);};pv.SvgScene.equalSceneKeys=function(ka,kb){for(var i=0,K=ka.length;i<K;i++)if(ka[i]!==kb[i])return!1;return!0;};pv.SvgScene.panel=function(scene){for(var g=scene.$g,e=g&&g.firstChild,i=0,L=scene.length;i<L;i++){var s=scene[i];if(s.visible){if(!scene.parent){var canvas=s.canvas;this.applyCanvasStyle(canvas);if(g&&g.parentNode!==canvas){g=canvas.firstChild;e=g&&g.firstChild;}
if(g)e&&"defs"===e.tagName&&(e=e.nextSibling);else{g=this.createRootPanelElement();e=null;this.initRootPanelElement(g,scene.mark);canvas.appendChild(g);scene.$defs=g.appendChild(this.create("defs"));scene.$g=g;}
g.setAttribute("width",s.width+s.left+s.right);g.setAttribute("height",s.height+s.top+s.bottom);}
var clip_g=null;if("hidden"===s.overflow){var clipResult=this.addPanelClipPath(g,e,scene,i,s);clip_g=clipResult.g;scene.$g=g=clip_g;e=clipResult.next;}
e=this.fill(e,scene,i);var k=this.scale,t=s.transform,x=s.left+t.x,y=s.top+t.y;this.scale*=t.k;if(s.children.length)for(var attrs={transform:"translate("+x+","+y+")"+(1!=t.k?" scale("+t.k+")":"")},childScenes=this.getSortedChildScenes(scene,i),j=0,C=childScenes.length;j<C;j++){var childScene=childScenes[j];childScene.$g=e=this.expect(e,"g",scene,i,attrs);this.updateAll(childScene);e.parentNode||g.appendChild(e);e=e.nextSibling;}
this.scale=k;e=this.stroke(e,scene,i);if(clip_g){scene.$g=g=clip_g.parentNode;e=clip_g.nextSibling;}}}
return e;};pv.SvgScene.applyCanvasStyle=function(canvas){canvas.style.display="inline-block";};pv.SvgScene.createRootPanelElement=function(){return this.create("svg");};pv.SvgScene.initRootPanelElement=function(g,panel){g.setAttribute("font-size","10px");g.setAttribute("font-family","sans-serif");g.setAttribute("fill","none");g.setAttribute("stroke","none");g.setAttribute("stroke-width",1.5);this.disableElementSelection(g);this.listenRootPanelElement(g,panel);};pv.SvgScene.listenRootPanelElement=function(g,panel){for(var j=0,evs=this.events,J=evs.length;j<J;j++){g.addEventListener(evs[j],this.dispatch,!1);panel._registerBoundEvent(g,evs[j],this.dispatch,!1);}};pv.SvgScene.disableElementSelection=function(g){g.setAttribute("style","-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;");if(void 0!==g.onselectstart){g.setAttribute("unselectable","on");g.onselectstart=function(){return!1;};}};pv.SvgScene.addPanelClipPath=function(g,e,scene,i,s){var id=pv.id().toString(36),clip_g=this.expect(e,"g",scene,i,{"clip-path":"url(#"+id+")"}),clip_p=this.expect(clip_g.firstChild,"clipPath",scene,i,{id:id}),r=clip_p.firstChild||clip_p.appendChild(this.create("rect"));r.setAttribute("x",s.left);r.setAttribute("y",s.top);r.setAttribute("width",s.width);r.setAttribute("height",s.height);clip_p.parentNode||clip_g.appendChild(clip_p);clip_g.parentNode||g.appendChild(clip_g);return{g:clip_g,next:clip_p.nextSibling};};pv.SvgScene.getSortedChildScenes=function(scene,i){var children=scene[i].children;if(scene.mark._zOrderChildCount){children=children.slice(0);children.sort(function(scenes1,scenes2){var compare=scenes1.mark._zOrder-scenes2.mark._zOrder;0===compare&&(compare=scenes1.childIndex-scenes2.childIndex);return compare;});}
return children;};pv.SvgScene.fill=function(e,scene,i){var s=scene[i],fill=s.fillStyle;if(fill.opacity||"all"==s.events){this.addFillStyleDefinition(scene,fill);e=this.expect(e,"rect",scene,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,cursor:s.cursor,x:s.left,y:s.top,width:s.width,height:s.height,fill:fill.color,"fill-opacity":fill.opacity,stroke:null});e=this.append(e,scene,i);}
return e;};pv.SvgScene.stroke=function(e,scene,i){var s=scene[i],stroke=s.strokeStyle;if(stroke.opacity||"all"==s.events){e=this.expect(e,"rect",scene,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":"all"==s.events?"stroke":s.events,cursor:s.cursor,x:s.left,y:s.top,width:Math.max(1e-10,s.width),height:Math.max(1e-10,s.height),fill:null,stroke:stroke.color,"stroke-opacity":stroke.opacity,"stroke-width":s.lineWidth/this.scale,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});e=this.append(e,scene,i);}
return e;};pv.SvgScene.minRuleLineWidth=1;pv.SvgScene.rule=function(scenes){for(var e=scenes.$g.firstChild,i=0;i<scenes.length;i++){var s=scenes[i];if(s.visible){var stroke=s.strokeStyle;if(stroke.opacity){var lineWidth=s.lineWidth;lineWidth=lineWidth<1e-10?0:Math.max(this.minRuleLineWidth,lineWidth/this.scale);e=this.expect(e,"line",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,cursor:s.cursor,x1:s.left,y1:s.top,x2:s.left+s.width,y2:s.top+s.height,stroke:stroke.color,"stroke-opacity":stroke.opacity,"stroke-width":lineWidth,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});s.svg&&this.setAttributes(e,s.svg);s.css&&this.setStyle(e,s.css);e=this.append(e,scenes,i);}}}
return e;};pv.SvgScene.wedge=function(scenes){for(var e=scenes.$g.firstChild,i=0;i<scenes.length;i++){var s=scenes[i];if(s.visible){var fill=s.fillStyle,stroke=s.strokeStyle;if(fill.opacity||stroke.opacity){var p,r1=s.innerRadius,r2=s.outerRadius,a=Math.abs(s.angle);if(a>=2*Math.PI)p=r1?"M0,"+r2+"A"+r2+","+r2+" 0 1,1 0,"+-r2+"A"+r2+","+r2+" 0 1,1 0,"+r2+"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":"M0,"+r2+"A"+r2+","+r2+" 0 1,1 0,"+-r2+"A"+r2+","+r2+" 0 1,1 0,"+r2+"Z";else{var sa=Math.min(s.startAngle,s.endAngle),ea=Math.max(s.startAngle,s.endAngle),c1=Math.cos(sa),c2=Math.cos(ea),s1=Math.sin(sa),s2=Math.sin(ea);p=r1?"M"+r2*c1+","+r2*s1+"A"+r2+","+r2+" 0 "+(a<Math.PI?"0":"1")+",1 "+r2*c2+","+r2*s2+"L"+r1*c2+","+r1*s2+"A"+r1+","+r1+" 0 "+(a<Math.PI?"0":"1")+",0 "+r1*c1+","+r1*s1+"Z":"M"+r2*c1+","+r2*s1+"A"+r2+","+r2+" 0 "+(a<Math.PI?"0":"1")+",1 "+r2*c2+","+r2*s2+"L0,0Z";}
this.addFillStyleDefinition(scenes,fill);this.addFillStyleDefinition(scenes,stroke);e=this.expect(e,"path",scenes,i,{"shape-rendering":s.antialias?null:"crispEdges","pointer-events":s.events,cursor:s.cursor,transform:"translate("+s.left+","+s.top+")",d:p,fill:fill.color,"fill-rule":"evenodd","fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-linecap":s.lineCap,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});s.svg&&this.setAttributes(e,s.svg);s.css&&this.setStyle(e,s.css);e=this.append(e,scenes,i);}}}
return e;};pv.Mark=function(){this.$properties=[];this.$propertiesMap={};this.$handlers={};};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(name,cast){this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties));this.properties[name]=!0;pv.Mark.prototype.propertyMethod(name,!1,pv.Mark.cast[name]=cast);return this;};pv.Mark.prototype.localProperty=function(name,cast){this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties));this.properties[name]=!0;var currCast=pv.Mark.cast[name];cast&&(pv.Mark.cast[name]=currCast=cast);this.propertyMethod(name,!1,currCast);return this;};pv.Mark.prototype.def=function(name,v){this.propertyMethod(name,!0);return this[name](arguments.length>1?v:null);};pv.Mark.prototype.propertyMethod=function(name,isDef,cast){cast||(cast=pv.Mark.cast[name]);this[name]=function(v,tag){if(isDef&&this.scene){var defs=this.scene.defs;if(arguments.length){defs[name]={id:null==v?0:pv.id(),value:null!=v&&cast?cast(v):v};return this;}
var def=defs[name];return def?def.value:null;}
if(arguments.length){this.setPropertyValue(name,v,isDef,cast,!1,tag);return this;}
var s=this.instance();if(pv.propBuildMark===this&&1!==pv.propBuilt[name]){pv.propBuilt[name]=1;return s[name]=this.evalProperty(this.binds.properties[name]);}
return s[name];};};pv.Mark.funPropertyCaller=function(fun,cast){function mark_callFunProperty(){var value=fun.apply(this,stack);return null!=value?cast(value):value;}
var stack=pv.Mark.stack;return mark_callFunProperty;};pv.Mark.prototype.setPropertyValue=function(name,v,isDef,cast,chain,tag){var type=!isDef<<1|"function"==typeof v;1&type&&cast?v=pv.Mark.funPropertyCaller(v,cast):null!=v&&cast&&(v=cast(v));var propertiesMap=this.$propertiesMap,properties=this.$properties,p={name:name,id:pv.id(),value:v,type:type,tag:tag,proto:null,root:null,_proto:null};p.root=p;var existing=propertiesMap[name];propertiesMap[name]=p;if(existing)for(var i=0,P=properties.length;i<P;i++)if(properties[i]===existing){properties.splice(i,1);break;}
properties.push(p);if(chain&&existing&&3===type){p.proto=existing;p.root=existing.root;}
return p;};pv.Mark.prototype.intercept=function(name,v,keyArgs){this.setPropertyValue(name,v,!1,pv.get(keyArgs,"noCast")?null:pv.Mark.cast[name],!0,pv.get(keyArgs,"tag"));return this;};pv.Mark.prototype.propertyValue=function(name,inherit){var p=this.$propertiesMap[name];if(p)return p.value;if(inherit){if(this.proto){var value=this.proto._propertyValueRecursive(name);if(void 0!==value)return value;}
return this.defaults._propertyValueRecursive(name);}};pv.Mark.prototype._propertyValueRecursive=function(name){var p=this.$propertiesMap[name];return p?p.value:this.proto?this.proto._propertyValueRecursive(name):void 0;};pv.Mark.stack=[];pv.Mark.prototype.property("data").property("visible",Boolean).property("css",Object).property("svg",Object).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",pv.stringLowerCase).property("id",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype._zOrder=0;pv.Mark.prototype.defaults=new pv.Mark().data(function(d){return[d];}).visible(!0).antialias(!0).events("painted");pv.Mark.prototype.extend=function(proto){this.proto=proto;this.target=proto.target;return this;};pv.Mark.prototype.add=function(type){return this.parent.add(type).extend(this);};pv.Mark.prototype.zOrder=function(zOrder){if(!arguments.length)return this._zOrder;zOrder=+zOrder||0;if(this._zOrder!==zOrder){var p=this.parent;p&&0!==this._zOrder&&p._zOrderChildCount--;this._zOrder=zOrder;p&&0!==this._zOrder&&p._zOrderChildCount++;}
return this;};pv.Mark.prototype.anchor=function(name){return new pv.Anchor(this).name(name||"center").data(function(){return this.scene.target.map(function(s){return s.data;});}).visible(function(){return this.scene.target[this.index].visible;}).id(function(){return this.scene.target[this.index].id;}).left(function(){var s=this.scene.target[this.index],w=s.width||0;switch(this.name()){case"bottom":case"top":case"center":return s.left+w/2;case"left":return null;}
return s.left+w;}).top(function(){var s=this.scene.target[this.index],h=s.height||0;switch(this.name()){case"left":case"right":case"center":return s.top+h/2;case"top":return null;}
return s.top+h;}).right(function(){var s=this.scene.target[this.index];return"left"==this.name()?s.right+(s.width||0):null;}).bottom(function(){var s=this.scene.target[this.index];return"top"==this.name()?s.bottom+(s.height||0):null;}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right";}
return"left";}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top";}
return"bottom";});};pv.Mark.prototype.anchorTarget=function(){return this.target;};pv.Mark.prototype.margin=function(n){return this.left(n).right(n).top(n).bottom(n);};pv.Mark.prototype.instance=function(defaultIndex){var scene=this.scene||this.parent.instance(-1).children[this.childIndex],index=null==defaultIndex||this.hasOwnProperty("index")?this.index:defaultIndex;return scene[index<0?scene.length-1:index];};pv.Mark.prototype.instances=function(source){for(var scene,mark=this,index=[];!(scene=mark.scene);){index.push({index:source.parentIndex,childIndex:mark.childIndex});source=source.parent;mark=mark.parent;}
for(var j=index.length;j--;){var info=index[j];scene=scene[info.index].children[info.childIndex];}
if(this.hasOwnProperty("index")){var s=pv.extend(scene[this.index]);s.right=s.top=s.left=s.bottom=0;return[s];}
return scene;};pv.Mark.prototype.first=function(){return this.scene[0];};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1];};pv.Mark.prototype.sibling=function(){return 0==this.index?null:this.scene[this.index-1];};pv.Mark.prototype.cousin=function(){var p=this.parent,s=p&&p.sibling();return s&&s.children?s.children[this.childIndex][this.index]:null;};pv.Mark.prototype._renderId=0;pv.Mark.prototype.renderId=function(){return this.root._renderId;};pv.Mark.prototype.render=function(){var root=this.root;if(!this.parent||root.scene){root._renderId++;this.renderCore();}else root.render();};pv.Mark.prototype.renderCore=function(){function render(mark,depth,scale){mark.scale=scale;if(depth<L){var addStack=depth>=stack.length;addStack&&stack.unshift(null);if(mark.hasOwnProperty("index"))renderCurrentInstance(mark,depth,scale,addStack);else{for(var i=0,n=mark.scene.length;i<n;i++){mark.index=i;renderCurrentInstance(mark,depth,scale,addStack);}
delete mark.index;}
addStack&&stack.shift();}else{mark.build();pv.Scene.scale=scale;pv.Scene.updateAll(mark.scene);}
delete mark.scale;}
function renderCurrentInstance(mark,depth,scale,fillStack){var i,s=mark.scene[mark.index];if(s.visible){var childMarks=mark.children,childScenez=s.children,childIndex=indexes[depth],childMark=childMarks[childIndex];childMark.scene||childIndex++;for(i=0;i<childIndex;i++)childMarks[i].scene=childScenez[i];fillStack&&(stack[0]=s.data);render(childMark,depth+1,scale*s.transform.k);for(i=0;i<childIndex;i++)childMarks[i].scene=void 0;}}
for(var parent=this.parent,stack=pv.Mark.stack,S=stack.length,indexes=[],mark=this;mark.parent;mark=mark.parent)indexes.unshift(mark.childIndex);var L=indexes.length;this.bind();for(;parent&&!parent.hasOwnProperty("index");)parent=parent.parent;try{this.context(parent?parent.scene:void 0,parent?parent.index:-1,function(){render(this.root,0,1);});}catch(e){stack.length>S&&(stack.length=S);throw e;}};pv.Mark.prototype.bind=function(){function bind(mark){do{for(var properties=mark.$properties,i=properties.length;i--;){var p=properties[i],name=p.name,pLeaf=seen[name];if(pLeaf){var pRoot=root[name];if(3===pRoot.type){pRoot._proto=p;pRoot=root[name]=p.root;pRoot._proto=null;}}else{seen[name]=p;root[name]=p.root;p.root._proto=null;switch(name){case"data":data=p;break;case"visible":case"id":required.push(p);break;default:types[p.type].push(p);}}}}while(mark=mark.proto);}
var data,seen={},root={},required=[],types=[[],[],[],[]];bind(this);bind(this.defaults);var types0=types[0],types1=types[1].reverse(),types2=types[2];types[3].reverse();var mark=this;do{for(var name in mark.properties)name in seen||types2.push(seen[name]={name:name,type:2,value:null});}while(mark=mark.proto);var defs;if(types0.length||types1.length){defs=types0.concat(types1);for(var i=0,D=defs.length;i<D;i++)this.propertyMethod(defs[i].name,!0);}else defs=[];this.binds={properties:seen,data:data,defs:defs,required:required,optional:pv.blend(types)};};pv.Mark.prototype.build=function(){var stack=pv.Mark.stack,scene=this.scene;if(!scene){scene=this.scene=[];scene.mark=this;scene.type=this.type;scene.childIndex=this.childIndex;var parent=this.parent;if(parent){scene.parent=parent.scene;scene.parentIndex=parent.index;}}
this.target&&(scene.target=this.target.instances(scene));var bdefs=this.binds.defs;if(bdefs.length)for(var defs=scene.defs||(scene.defs={}),i=0,B=bdefs.length;i<B;i++){var p=bdefs[i],d=defs[p.name];(!d||p.id>d.id)&&(defs[p.name]={id:0,value:1&p.type?p.value.apply(this,stack):p.value});}
var datas=this.evalProperty(this.binds.data),L=datas.length;scene.length=L;if(L){var markProto=pv.Mark.prototype;stack.unshift(null);var propBuildMarkBefore=pv.propBuildMark,propBuiltBefore=pv.propBuilt;pv.propBuildMark=this;try{for(var i=0;i<L;i++){markProto.index=this.index=i;pv.propBuilt={};var instance=scene[i];instance?instance._state&&delete instance._state:instance=scene[i]={};instance.data=stack[0]=datas[i];this.preBuildInstance(instance);this.buildInstance(instance);}}finally{markProto.index=-1;delete this.index;stack.shift();pv.propBuildMark=propBuildMarkBefore;pv.propBuilt=propBuiltBefore;}}
return this;};pv.Mark.prototype.instanceState=function(s){s||(s=this.instance());return s?s._state||(s._state={}):null;};pv.Mark.prototype.preBuildInstance=function(s){};pv.Mark.prototype.buildInstance=function(s){this.buildProperties(s,this.binds.required);if(s.visible){this.buildProperties(s,this.binds.optional);this.buildImplied(s);}};!function(){var _protoProp,_stack=pv.Mark.stack,_evalPropByType=[function(p){return this.scene.defs[p.name].value;},null,function(p){return p.value;},function(p){_protoProp=p.proto||p._proto;return p.value.apply(this,_stack);}];_evalPropByType[1]=_evalPropByType[0];pv.Mark.prototype.buildProperties=function(s,properties){var built=pv.propBuilt,localBuilt=!built;if(localBuilt){pv.propBuildMark=this;pv.propBuilt=built={};}
for(var protoPropBefore=_protoProp,i=0,P=properties.length;i<P;i++){var p=properties[i],pname=p.name;if(!(pname in built)){built[pname]=1;s[pname]=_evalPropByType[p.type].call(this,p);}}
_protoProp=protoPropBefore;localBuilt&&(pv.propBuildMark=pv.propBuilt=null);};pv.Mark.prototype.evalProperty=function(p){var protoPropBefore=_protoProp,v=_evalPropByType[p.type].call(this,p);_protoProp=protoPropBefore;return v;};pv.Mark.prototype.evalInPropertyContext=function(f,protoProp){var protoPropBefore=_protoProp;_protoProp=protoProp;var v=f.apply(this,_stack);_protoProp=protoPropBefore;return v;};pv.Mark.prototype.delegate=function(dv,tag){if(_protoProp&&(!tag||_protoProp.tag===tag)){var value=this.evalProperty(_protoProp);if(void 0!==value)return value;}
return dv;};pv.Mark.prototype.delegateExcept=function(dv,notTag){if(_protoProp&&(!notTag||_protoProp.tag!==notTag)){var value=this.evalProperty(_protoProp);if(void 0!==value)return value;}
return dv;};pv.Mark.prototype.hasDelegate=function(tag){return!(!_protoProp||tag&&_protoProp.tag!==tag);};}();pv.Mark.prototype.buildImplied=function(s){var parent_s,checked,l=s.left,r=s.right,t=s.top,b=s.bottom,p=this.properties,w=p.width?s.width:0,h=p.height?s.height:0;if(null==w||null==r||null==l){parent_s=this.parent&&this.parent.instance();checked=!0;var width=parent_s?parent_s.width:w+l+r;null==w?w=width-(r=r||0)-(l=l||0):null==r?null==l?l=r=(width-w)/2:r=width-w-l:l=width-w-r;}
if(null==h||null==b||null==t){checked||(parent_s=this.parent&&this.parent.instance());var height=parent_s?parent_s.height:h+t+b;null==h?h=height-(t=t||0)-(b=b||0):null==b?b=null==t?t=(height-h)/2:height-h-t:t=height-h-b;}
s.left=l;s.right=r;s.top=t;s.bottom=b;p.width&&(s.width=w);p.height&&(s.height=h);p.textStyle&&!s.textStyle&&(s.textStyle=pv.FillStyle.transparent);p.fillStyle&&!s.fillStyle&&(s.fillStyle=pv.FillStyle.transparent);p.strokeStyle&&!s.strokeStyle&&(s.strokeStyle=pv.FillStyle.transparent);};pv.Mark.prototype.mouse=function(){var n=this.root.canvas(),ev=pv.event,x=ev&&ev.pageX||0,y=ev&&ev.pageY||0,offset=pv.elementOffset(n);if(offset){var getStyle=pv.cssStyle(n);x-=offset.left+parseFloat(getStyle("padding-left")||0);y-=offset.top+parseFloat(getStyle("padding-top")||0);}
var t=pv.Transform.identity,p=this.properties.transform?this:this.parent,pz=[];do{pz.push(p);}while(p=p.parent);for(;p=pz.pop();){var pinst=p.instance();t=t.translate(pinst.left,pinst.top).times(pinst.transform);}
t=t.invert();return pv.vector(x*t.k+t.x,y*t.k+t.y);};pv.Mark.prototype.event=function(type,handler){handler=pv.functor(handler);var hs=this.$handlers[type];hs?hs instanceof Array?hs.push(handler):hs=[hs,handler]:hs=handler;this.$hasHandlers=!0;this.$handlers[type]=hs;return this;};pv.Mark.prototype.context=function(scene,index,f){function apply(scene,index){pv.Mark.scene=scene;proto.index=index;if(scene){var i,that=scene.mark,mark=that,ancestors=[];do{ancestors.push(mark);stack.push(scene[index].data);mark.index=index;mark.scene=scene;if(mark=mark.parent){index=scene.parentIndex;scene=scene.parent;}}while(mark);var k=1;i=ancestors.length-1;if(i>0)do{mark=ancestors[i--];mark.scale=k;k*=mark.scene[mark.index].transform.k;}while(i);that.scale=k;var n,children=that.children;if(children&&(n=children.length)>0){var thatInst=that.scene[that.index];k*=thatInst.transform.k;var childScenes=thatInst.children;i=n;for(;i--;){mark=children[i];mark.scene=childScenes[i];mark.scale=k;}}}}
function clear(scene){if(scene){var mark,that=scene.mark,children=that.children;if(children)for(var i=children.length;i--;){mark=children[i];mark.scene=void 0;mark.scale=1;}
mark=that;var parent,count=0;do{count++;delete mark.index;if(parent=mark.parent){mark.scene=void 0;mark.scale=1;}}while(mark=parent);count&&(stack.length-=count);}}
var proto=pv.Mark.prototype,stack=pv.Mark.stack,oscene=pv.Mark.scene,oindex=proto.index;if(scene&&scene===oscene&&index===oindex)try{f.apply(this,stack);}catch(ex){pv.error(ex);throw ex;}finally{pv.Mark.scene=oscene;proto.index=oindex;}else{clear(oscene);apply(scene,index);try{f.apply(this,stack);}catch(ex){pv.error(ex);throw ex;}finally{clear(scene);apply(oscene,oindex);}}};pv.Mark.prototype.getEventHandler=function(type,scenes,index,ev){var handler=this.$handlers[type];return handler?[handler,scenes,index,ev]:this.getParentEventHandler(type,scenes,index,ev);};pv.Mark.prototype.getParentEventHandler=function(type,scenes,index,ev){var parentScenes=scenes.parent;if(parentScenes)return parentScenes.mark.getEventHandler(type,parentScenes,scenes.parentIndex,ev);};pv.Mark.dispatch=function(type,scenes,index,event){var root=scenes.mark.root;if(root.$transition)return!0;var handlerInfo,interceptors=root.$interceptors&&root.$interceptors[type];if(interceptors)for(var i=0,L=interceptors.length;i<L;i++){handlerInfo=interceptors[i](type,event);if(handlerInfo)break;if(!1===handlerInfo)return!0;}
if(!handlerInfo){handlerInfo=scenes.mark.getEventHandler(type,scenes,index,event);if(!handlerInfo)return!1;}
return this.handle.apply(this,handlerInfo);};pv.Mark.handle=function(handler,scenes,index,event){var m=scenes.mark;m.context(scenes,index,function(){var i,L,mi,stack=pv.Mark.stack.concat(event);if(handler instanceof Array){var ms;for(i=0,L=handler.length;i<L;i++){mi=handler[i].apply(m,stack);mi&&mi.render&&(ms||(ms=[])).push(mi);}
if(ms)for(i=0,L=ms.length;i<L;i++)ms[i].render();}else{mi=handler.apply(m,stack);mi&&mi.render&&mi.render();}});return!0;};pv.Mark.prototype.addEventInterceptor=function(type,handler,before){var root=this.root;if(root){var ints=root.$interceptors||(root.$interceptors={}),list=ints[type]||(ints[type]=[]);before?list.unshift(handler):list.push(handler);}};pv.Mark.prototype.eachInstance=function(fun,ctx){function mapRecursive(scene,level,toScreen){var D=scene.length;if(D>0){var childIndex;level===L||(childIndex=indexes[level]);for(var index=0;index<D;index++){var instance=scene[index];if(instance.visible)if(level===L)fun.call(ctx,scene,index,toScreen);else{var childScene=instance.children[childIndex];if(childScene){var childToScreen=toScreen.times(instance.transform).translate(instance.left,instance.top);mapRecursive(childScene,level+1,childToScreen);}}}}}
for(var mark=this,indexes=[];mark.parent;){indexes.unshift(mark.childIndex);mark=mark.parent;}
var rootScene=mark.scene;if(rootScene){var L=indexes.length;mapRecursive(rootScene,0,pv.Transform.identity);}};pv.Mark.prototype.toScreenTransform=function(){var t=pv.Transform.identity;this instanceof pv.Panel&&(t=t.translate(this.left(),this.top()).times(this.transform()));var parent=this.parent;if(parent)do{t=t.translate(parent.left(),parent.top()).times(parent.transform());}while(parent=parent.parent);return t;};pv.Mark.prototype.transition=function(){return new pv.Transition(this);};pv.Mark.prototype.on=function(state){return this["$"+state]=new pv.Transient(this);};pv.Mark.prototype.getShape=function(scenes,index,inset){var s=scenes[index];if(!s.visible)return null;null==inset&&(inset=0);var key="_shape_inset_"+inset;return s[key]||(s[key]=this.getShapeCore(scenes,index,inset));};pv.Mark.prototype.getShapeCore=function(scenes,index,inset){var s=scenes[index],l=s.left,t=s.top,w=s.width,h=s.height;if(inset>0&&inset<=1){var dw=inset*w,dh=inset*h;l+=dw;t+=dh;w-=2*dw;h-=2*dh;}
return new pv.Shape.Rect(l,t,w,h);};pv.Mark.prototype.pointingRadiusMax=function(value){if(arguments.length){value=+value;this._pointingRadiusMax=isNaN(value)||value<0?0:value;return this;}
return this._pointingRadiusMax;};pv.Mark.prototype._pointingRadiusMax=1/0;pv.Anchor=function(target){pv.Mark.call(this);this.target=target;this.parent=target.parent;};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(proto){this.proto=proto;return this;};pv.Area=function(){pv.Mark.call(this);};pv.Area.castSegmented=function(v){if(!v)return"";v=String(v).toLowerCase();switch(v){case"smart":case"full":break;default:v="full";}
return v;};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("lineJoin",pv.stringLowerCase).property("strokeMiterLimit",Number).property("lineCap",pv.stringLowerCase).property("strokeDasharray",pv.stringLowerCase).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("segmented",pv.Area.castSegmented).property("interpolate",pv.stringLowerCase).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=new pv.Area().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Area.prototype.buildImplied=function(s){null==s.height&&(s.height=0);null==s.width&&(s.width=0);pv.Mark.prototype.buildImplied.call(this,s);};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeMiterLimit:1,lineCap:1,strokeStyle:1,strokeDasharray:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var binds=this.binds,required=binds.required,optional=binds.optional,i=0,n=optional.length;i<n;i++){var p=optional[i];p.fixed=p.name in pv.Area.fixed;if("segmented"==p.name){required.push(p);optional.splice(i,1);i--;n--;}}
this.binds.$required=required;this.binds.$optional=optional;};pv.Area.prototype.buildInstance=function(s){function f(p){return!p.fixed||(fixed.push(p),!1);}
var binds=this.binds;if(this.index){var fixed=binds.fixed;if(!fixed){fixed=binds.fixed=[];binds.required=binds.required.filter(f);this.scene[0].segmented||(binds.optional=binds.optional.filter(f));}
var n=fixed.length;if(n)for(var firstScene=this.scene[0],i=0;i<n;i++){var p=fixed[i].name;s[p]=firstScene[p];}}else{binds.required=binds.$required;binds.optional=binds.$optional;binds.fixed=null;}
pv.Mark.prototype.buildInstance.call(this,s);};pv.Area.prototype.anchor=function(name){return pv.Mark.prototype.anchor.call(this,name).interpolate(function(){return this.scene.target[this.index].interpolate;}).eccentricity(function(){return this.scene.target[this.index].eccentricity;}).tension(function(){return this.scene.target[this.index].tension;});};pv.Area.prototype.getEventHandler=function(type,scene,index,ev){var s=scene[index];if(1!==pv.Scene.mousePositionEventSet[type]||s.segmented&&"smart"!==s.segmented)return pv.Mark.prototype.getEventHandler.call(this,type,scene,index,ev);var mouseIndex,handlerMouseOver="mousemove"===type?this.$handlers.mouseover:null,handler=this.$handlers[type],handlers=handler||handlerMouseOver;if(handlers){mouseIndex=this.getNearestInstanceToMouse(scene,index);if(handlerMouseOver&&!this.filterMouseMove(scene,mouseIndex)){handlerMouseOver=null;handlers=handler;}}
if(!handlers)return this.getParentEventHandler(type,scene,index,ev);handler&&handlerMouseOver&&(handlers=[].concat(handler,handlerMouseOver));return[handlers,scene,mouseIndex,ev];};pv.Area.prototype.filterMouseMove=function(scene,mouseIndex){var prevMouseOverScene=this._mouseOverScene;if(!prevMouseOverScene||prevMouseOverScene!==scene||this._mouseOverIndex!==mouseIndex){this._mouseOverScene=scene;this._mouseOverIndex=mouseIndex;return!0;}};pv.Area.prototype.getNearestInstanceToMouse=function(scene,eventIndex){for(var p=this.mouse(),minDist2=1/0,minIndex=null,index=eventIndex,L=scene.length;index<L;index++){var shape=this.getShape(scene,index);if(shape){if(shape.containsPoint(p))return index;var dist2=shape.distance2(p).dist2;if(dist2<minDist2){minDist2=dist2;minIndex=index;}}}
return null!=minIndex?minIndex:eventIndex;};pv.Area.prototype.getShapeCore=function(scenes,index){var s=scenes[index],w=s.width||0,h=s.height||0,x=s.left,y=s.top,s2=index+1<scenes.length?scenes[index+1]:null;if(!s2||!s2.visible)return new pv.Shape.Line(x,y,x+w,y+h);var x2=s2.left,y2=s2.top,h2=s2.height||0,w2=s2.width||0;return new pv.Shape.Polygon([new pv.Vector(x,y),new pv.Vector(x2,y2),new pv.Vector(x2+w2,y2+h2),new pv.Vector(x+w,y+h)]);};pv.Bar=function(){pv.Mark.call(this);};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("lineCap",pv.stringLowerCase).property("strokeDasharray",pv.stringLowerCase);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=new pv.Bar().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot=function(){pv.Mark.call(this);};pv.Dot.prototype=pv.extend(pv.Mark).property("shape",pv.stringLowerCase).property("shapeAngle",Number).property("shapeRadius",Number).property("shapeSize",Number).property("aspectRatio",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",pv.stringLowerCase).property("strokeDasharray",pv.stringLowerCase).property("fillStyle",pv.fillStyle);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=new pv.Dot().extend(pv.Mark.prototype.defaults).shape("circle").aspectRatio(1).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot.prototype.anchor=function(name){return pv.Mark.prototype.anchor.call(this,name).left(function(){var s=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return s.left;case"left":return null;}
return s.left+s._width/2;}).right(function(){var s=this.scene.target[this.index];return"left"==this.name()?s.right+s._width/2:null;}).top(function(){var s=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return s.top;case"top":return null;}
return s.top+s._height/2;}).bottom(function(){var s=this.scene.target[this.index];return"top"==this.name()?s.bottom+s._height/2:null;}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";}
return"left";}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top";}
return"bottom";});};pv.Dot.prototype.buildImplied=function(s){var r=s.shapeRadius,z=s.shapeSize,a=s.aspectRatio||1;if(null==r)if(null==z){z=s.shapeSize=20.25;r=s.shapeRadius=4.5;}else r=s.shapeRadius=Math.sqrt(z);else null==z&&(z=s.shapeSize=r*r);var h,w;if(1===a||a<0)h=w=2*r;else{h=2*r/Math.sqrt(a);w=a*h;}
s._height=h;s._width=w;pv.Mark.prototype.buildImplied.call(this,s);};pv.Dot.prototype.width=function(){return this.instance()._width;};pv.Dot.prototype.height=function(){return this.instance()._height;};pv.Dot.prototype.getShapeCore=function(scenes,index){var s=scenes[index],h=s._width,w=s._height,cx=s.left,cy=s.top;switch(s.shape){case"diamond":h*=Math.SQRT2;w*=Math.SQRT2;case"square":case"cross":return new pv.Shape.Rect(cx-w/2,cy-h/2,w,h);}
return new pv.Shape.Circle(cx,cy,s.shapeRadius);};pv.Label=function(){pv.Mark.call(this);};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",pv.stringLowerCase).property("textBaseline",pv.stringLowerCase).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=new pv.Label().extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Label.prototype.getShapeCore=function(scenes,index,inset){var s=scenes[index],size=pv.Text.measure(s.text,s.font),l=s.left,t=s.top,w=size.width,h=size.height;if(inset>0&&inset<=1){var dw=inset*w,dh=inset*h;l+=dw;t+=dh;w-=2*dw;h-=2*dh;}
return pv.Label.getPolygon(w,h,s.textAlign,s.textBaseline,s.textAngle,s.textMargin).apply(pv.Transform.identity.translate(l,t));};pv.Label.getPolygon=function(textWidth,textHeight,align,baseline,angle,margin){var x,y;switch(baseline){case"middle":y=textHeight/2;break;case"top":y=margin+textHeight;break;case"bottom":y=-margin;}
switch(align){case"right":x=-margin-textWidth;break;case"center":x=-textWidth/2;break;case"left":x=margin;}
var bl=new pv.Vector(x,y),br=bl.plus(textWidth,0),tr=br.plus(0,-textHeight),tl=bl.plus(0,-textHeight);if(0!==angle){bl=bl.rotate(angle);br=br.rotate(angle);tl=tl.rotate(angle);tr=tr.rotate(angle);}
return new pv.Shape.Polygon([bl,br,tr,tl]);};pv.Line=function(){pv.Mark.call(this);};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",pv.stringLowerCase).property("strokeMiterLimit",Number).property("lineCap",pv.stringLowerCase).property("strokeStyle",pv.fillStyle).property("strokeDasharray",pv.stringLowerCase).property("fillStyle",pv.fillStyle).property("segmented",pv.Area.castSegmented).property("interpolate",pv.stringLowerCase).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=new pv.Line().extend(pv.Mark.prototype.defaults).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.getEventHandler=pv.Area.prototype.getEventHandler;pv.Line.prototype.getNearestInstanceToMouse=pv.Area.prototype.getNearestInstanceToMouse;pv.Line.prototype.filterMouseMove=pv.Area.prototype.filterMouseMove;pv.Line.prototype.anchor=function(name){return pv.Area.prototype.anchor.call(this,name).textAlign(function(d){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left";}}).textBaseline(function(d){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top";}});};pv.Line.prototype.getShapeCore=function(scenes,index){var s=scenes[index],s2=index+1<scenes.length?scenes[index+1]:null;return null!=s2&&s2.visible?new pv.Shape.Line(s.left,s.top,s2.left,s2.top):new pv.Shape.Point(s.left,s.top);};pv.Rule=function(){pv.Mark.call(this);};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",pv.stringLowerCase).property("strokeDasharray",pv.stringLowerCase);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=new pv.Rule().extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(!1).lineCap("butt").strokeDasharray("none");pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(s){var l=s.left,r=s.right;s.top,s.bottom;null!=s.width||null==l&&null==r||null!=r&&null!=l?s.height=0:s.width=0;pv.Mark.prototype.buildImplied.call(this,s);};pv.Rule.prototype.getShapeCore=function(scenes,index){var s=scenes[index];return new pv.Shape.Line(s.left,s.top,s.left+s.width,s.top+s.height);};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s;};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",pv.stringLowerCase).property("canvas",function(c){return"string"==typeof c?document.getElementById(c):c;});pv.Panel.prototype.type="panel";pv.Panel.prototype.isPointingBarrier=!1;pv.Panel.prototype._zOrderChildCount=0;pv.Panel.prototype.defaults=new pv.Panel().extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(name){var anchor=pv.Bar.prototype.anchor.call(this,name);anchor.parent=this;return anchor;};pv.Panel.prototype.add=function(Type){var child=new Type();child.parent=this;child.root=this.root;child.childIndex=this.children.length;this.children.push(child);0!==(+child._zOrder||0)&&this._zOrderChildCount++;return child;};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var children=this.children,i=0,n=children.length;i<n;i++)children[i].bind();};pv.Panel.prototype.buildInstance=function(s){pv.Bar.prototype.buildInstance.call(this,s);if(s.visible){var scale=this.scale*s.transform.k;pv.Mark.prototype.index=-1;for(var child,children=this.children,childScenes=s.children||(s.children=[]),i=0,n=children.length;i<n;i++){child=children[i];child.scene=childScenes[i];child.scale=scale;child.build();}
i=n;for(;i--;){child=children[i];childScenes[i]=child.scene;delete child.scene;delete child.scale;}
childScenes.length=n;}};pv.Panel.prototype.buildImplied=function(s){if(this.parent||this._buildRootInstanceImplied(s)){s.transform||(s.transform=pv.Transform.identity);pv.Mark.prototype.buildImplied.call(this,s);}else s.visible=!1;};pv.Panel.prototype._buildRootInstanceImplied=function(s){var c=s.canvas;if(c){if(!this._rootInstanceStealCanvas(s,c))return!1;this._rootInstanceInitCanvas(s,c);}else s.canvas=this._rootInstanceGetInlineCanvas(s);return!0;};pv.Panel.prototype._rootInstanceStealCanvas=function(s,c){var cPanel=c.$panel;if(cPanel!==this){if(cPanel){if(this.$lastCreateId)return!1;cPanel._disposeRootPanel();this._updateCreateId(c);}
c.$panel=this;pv.removeChildren(c);}else this._updateCreateId(c);return!0;};pv.Panel.prototype._registerBoundEvent=function(source,name,listener,capturePhase){if(source.removeEventListener){(this._boundEvents||(this._boundEvents=[])).push([source,name,listener,capturePhase]);}};pv.Panel.prototype.dispose=function(){var root=this.root,scene=root.scene;root._disposeRootPanel();var canvas=scene?root.canvas():null;root.canvas(null);canvas&&(canvas.$panel=null);root.binds=null;if(scene){scene.$defs=null;scene.$g=null;root.scene=null;}};pv.Panel.prototype._disposeRootPanel=function(){var t=this.$transition;t&&t.stop();var boundEvents=this._boundEvents;if(boundEvents){this._boundEvents=null;for(var i=0,L=boundEvents.length;i<L;i++){var be=boundEvents[i];be[0].removeEventListener(be[1],be[2],be[3]);}}};pv.Panel.prototype._rootInstanceInitCanvas=function(s,c){var w,h,cssStyle;if(null==s.width){cssStyle=pv.cssStyle(c);w=parseFloat(cssStyle("width")||0);s.width=w-s.left-s.right;}
if(null==s.height){cssStyle||(cssStyle=pv.cssStyle(c));h=parseFloat(cssStyle("height")||0);s.height=h-s.top-s.bottom;}
cssStyle=null;};pv.Panel.prototype._rootInstanceGetInlineCanvas=function(s){var c,cache=this.$canvas||(this.$canvas=[]);if(!(c=cache[this.index])){c=cache[this.index]=document.createElement("span");if(this.$dom)this.$dom.parentNode.insertBefore(c,this.$dom);else{for(var n=document.body;n.lastChild&&n.lastChild.tagName;)n=n.lastChild;n!=document.body&&(n=n.parentNode);n.appendChild(c);}}
return c;};pv.Panel.prototype._updateCreateId=function(c){this.$lastCreateId=c.$pvCreateId=(c.$pvCreateId||0)+1;};pv.Image=function(){pv.Bar.call(this);};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=new pv.Image().extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(f){this.$image=function(){var c=f.apply(this,arguments);return null==c?pv.Color.transparent:"string"==typeof c?pv.color(c):c;};return this;};pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var binds=this.binds,mark=this;do{binds.image=mark.$image;}while(!binds.image&&(mark=mark.proto));};pv.Image.prototype.buildImplied=function(s){pv.Bar.prototype.buildImplied.call(this,s);if(s.visible){null==s.imageWidth&&(s.imageWidth=s.width);null==s.imageHeight&&(s.imageHeight=s.height);if(null==s.url&&this.binds.image){var data,canvas=this.$canvas||(this.$canvas=document.createElement("canvas")),context=canvas.getContext("2d"),w=s.imageWidth,h=s.imageHeight,stack=pv.Mark.stack;canvas.width=w;canvas.height=h;data=(s.image=context.createImageData(w,h)).data;stack.unshift(null,null);for(var y=0,p=0;y<h;y++){stack[1]=y;for(var x=0;x<w;x++){stack[0]=x;var color=this.binds.image.apply(this,stack);data[p++]=color.r;data[p++]=color.g;data[p++]=color.b;data[p++]=255*color.a;}}
stack.splice(0,2);}}};pv.Wedge=function(){pv.Mark.call(this);};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineJoin",pv.stringLowerCase).property("strokeMiterLimit",Number).property("lineCap",pv.stringLowerCase).property("strokeDasharray",pv.stringLowerCase).property("fillStyle",pv.fillStyle);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=new pv.Wedge().extend(pv.Mark.prototype.defaults).startAngle(function(){var s=this.sibling();return s?s.endAngle:-Math.PI/2;}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index)).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2;};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2;};pv.Wedge.prototype.anchor=function(name){function partial(s){return s.innerRadius||s.angle<2*Math.PI;}
function midRadius(s){return(s.innerRadius+s.outerRadius)/2;}
function midAngle(s){return(s.startAngle+s.endAngle)/2;}
return pv.Mark.prototype.anchor.call(this,name).left(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return s.left+s.outerRadius*Math.cos(midAngle(s));case"inner":return s.left+s.innerRadius*Math.cos(midAngle(s));case"start":return s.left+midRadius(s)*Math.cos(s.startAngle);case"center":return s.left+midRadius(s)*Math.cos(midAngle(s));case"end":return s.left+midRadius(s)*Math.cos(s.endAngle);}
return s.left;}).top(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return s.top+s.outerRadius*Math.sin(midAngle(s));case"inner":return s.top+s.innerRadius*Math.sin(midAngle(s));case"start":return s.top+midRadius(s)*Math.sin(s.startAngle);case"center":return s.top+midRadius(s)*Math.sin(midAngle(s));case"end":return s.top+midRadius(s)*Math.sin(s.endAngle);}
return s.top;}).textAlign(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"outer":return pv.Wedge.upright(midAngle(s))?"right":"left";case"inner":return pv.Wedge.upright(midAngle(s))?"left":"right";}
return"center";}).textBaseline(function(){var s=this.scene.target[this.index];if(partial(s))switch(this.name()){case"start":return pv.Wedge.upright(s.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(s.endAngle)?"bottom":"top";}
return"middle";}).textAngle(function(){var s=this.scene.target[this.index],a=0;if(partial(s))switch(this.name()){case"center":case"inner":case"outer":a=midAngle(s);break;case"start":a=s.startAngle;break;case"end":a=s.endAngle;}
return pv.Wedge.upright(a)?a:a+Math.PI;});};pv.Wedge.upright=function(angle){angle%=2*Math.PI;angle=angle<0?2*Math.PI+angle:angle;return angle<Math.PI/2||angle>=3*Math.PI/2;};pv.Wedge.prototype.buildImplied=function(s){null==s.angle?s.angle=s.endAngle-s.startAngle:null==s.endAngle&&(s.endAngle=s.startAngle+s.angle);pv.Mark.prototype.buildImplied.call(this,s);};pv.Wedge.prototype.getShapeCore=function(scenes,index){var s=scenes[index];return new pv.Shape.Wedge(s.left,s.top,s.innerRadius,s.outerRadius,s.startAngle,s.angle);};pv.Ease=function(){function reverse(f){return function(t){return 1-f(1-t);};}
function reflect(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t));};}
function poly(e){return function(t){return t<0?0:t>1?1:Math.pow(t,e);};}
function sin(t){return 1-Math.cos(t*Math.PI/2);}
function exp(t){return t?Math.pow(2,10*(t-1))-.001:0;}
function circle(t){return-(Math.sqrt(1-t*t)-1);}
function elastic(a,p){var s;p||(p=.45);if(!a||a<1){a=1;s=p/4;}else s=p/(2*Math.PI)*Math.asin(1/a);return function(t){return t<=0||t>=1?t:-a*Math.pow(2,10*--t)*Math.sin((t-s)*(2*Math.PI)/p);};}
function back(s){s||(s=1.70158);return function(t){return t*t*((s+1)*t-s);};}
function bounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;}
var quad=poly(2),cubic=poly(3),elasticDefault=elastic(),backDefault=back(),eases={linear:pv.identity,"quad-in":quad,"quad-out":reverse(quad),"quad-in-out":reflect(quad),"quad-out-in":reflect(reverse(quad)),"cubic-in":cubic,"cubic-out":reverse(cubic),"cubic-in-out":reflect(cubic),"cubic-out-in":reflect(reverse(cubic)),"sin-in":sin,"sin-out":reverse(sin),"sin-in-out":reflect(sin),"sin-out-in":reflect(reverse(sin)),"exp-in":exp,"exp-out":reverse(exp),"exp-in-out":reflect(exp),"exp-out-in":reflect(reverse(exp)),"circle-in":circle,"circle-out":reverse(circle),"circle-in-out":reflect(circle),"circle-out-in":reflect(reverse(circle)),"elastic-in":elasticDefault,"elastic-out":reverse(elasticDefault),"elastic-in-out":reflect(elasticDefault),"elastic-out-in":reflect(reverse(elasticDefault)),"back-in":backDefault,"back-out":reverse(backDefault),"back-in-out":reflect(backDefault),"back-out-in":reflect(reverse(backDefault)),"bounce-in":bounce,"bounce-out":reverse(bounce),"bounce-in-out":reflect(bounce),"bounce-out-in":reflect(reverse(bounce))};pv.ease=function(f){return eases[f];};return{reverse:reverse,reflect:reflect,linear:function(){return pv.identity;},sin:function(){return sin;},exp:function(){return exp;},circle:function(){return circle;},elastic:elastic,back:back,bounce:bounce,poly:poly};}();pv.Transient=function(mark){pv.Mark.call(this);this.fillStyle(null).strokeStyle(null).textStyle(null);this.on=function(state){return mark.on(state);};};pv.Transient.prototype=pv.extend(pv.Mark);!function(){function ids(scene){for(var map={},i=scene.length;i--;){var s=scene[i],id=s.id;id&&(map[id]=s);}
return map;}
function interpolateProperty(list,name,before,after){var step;if(name in _interpolated){var interp=pv.Scale.interpolator(before[name],after[name]);step=function(t){before[name]=interp(t);};}else step=function(t){t>.5&&(before[name]=after[name]);};step.next=list.head;list.head=step;}
function interpolateInstance(list,beforeInst,afterInst){for(var name in beforeInst)"children"!==name&&beforeInst[name]!=afterInst[name]&&interpolateProperty(list,name,beforeInst,afterInst);var beforeChildScenes=beforeInst.children;if(beforeChildScenes)for(var afterChildScenes=afterInst.children,j=0,L=beforeChildScenes.length;j<L;j++)interpolate(list,beforeChildScenes[j],afterChildScenes[j]);}
function overrideInstance(scene,index,proto,other){var t,otherInst=Object.create(scene[index]),m=scene.mark,rs=m.root.scene;if(other.target&&(t=other.target[other.length])){scene=Object.create(scene);scene.target=Object.create(other.target);scene.target[index]=t;}
proto||(proto=_defaults);var ps=proto.$properties,overriden=proto.$propertiesMap;ps=m.binds.optional.filter(function(p){return!(p.name in overriden);}).concat(ps);m.context(scene,index,function(){this.buildProperties(otherInst,ps);this.buildImplied(otherInst);});m.root.scene=rs;return otherInst;}
function interpolate(list,before,after){for(var beforeInst,afterInst,mark=before.mark,beforeById=ids(before),afterById=ids(after),i=0,L=before.length;i<L;i++){beforeInst=before[i];afterInst=beforeInst.id?afterById[beforeInst.id]:after[i];beforeInst.index=i;if(beforeInst.visible){if(!afterInst||!afterInst.visible){var overridenAfterInst=overrideInstance(before,i,mark.$exit,after);beforeInst.transition=afterInst?2:(after.push(overridenAfterInst),1);afterInst=overridenAfterInst;}
interpolateInstance(list,beforeInst,afterInst);}}
i=0;L=after.length;for(;i<L;i++){afterInst=after[i];beforeInst=afterInst.id?beforeById[afterInst.id]:before[i];if((!beforeInst||!beforeInst.visible)&&afterInst.visible){var overridenBeforeInst=overrideInstance(after,i,mark.$enter,before);beforeInst?before[beforeInst.index]=overridenBeforeInst:before.push(overridenBeforeInst);interpolateInstance(list,overridenBeforeInst,afterInst);}}}
function cleanup(scene){for(var i=0,j=0;i<scene.length;i++){var s=scene[i];if(1!=s.transition){scene[j++]=s;2==s.transition&&(s.visible=!1);s.children&&s.children.forEach(cleanup);}}
scene.length=j;}
var _interpolated={top:1,left:1,right:1,bottom:1,width:1,height:1,innerRadius:1,outerRadius:1,radius:1,shapeRadius:1,shapeSize:1,startAngle:1,endAngle:1,angle:1,fillStyle:1,strokeStyle:1,lineWidth:1,eccentricity:1,tension:1,textAngle:1,textStyle:1,textMargin:1},_defaults=new pv.Transient();pv.Transition=function(mark){function doEnd(success){var started=mark.root.$transition===that;started&&(mark.root.$transition=null);if(null!=timer){clearInterval(timer);timer=null;}
started&&cleanupOnce(mark.scene);if(onEndCallback){var cb=onEndCallback;onEndCallback=null;cb(success);}
return success;}
var timer,onEndCallback,cleanedup,that=this,ease=pv.ease("cubic-in-out"),duration=250,cleanupOnce=function(scene){if(!cleanedup){cleanedup=!0;cleanup(scene);}};that.ease=function(x){return arguments.length?(ease="function"==typeof x?x:pv.ease(x),that):ease;};that.duration=function(x){return arguments.length?(duration=Number(x),that):duration;};that.start=function(onEnd){if(mark.parent)throw new Error("Animated partial rendering is not supported.");onEndCallback=onEnd;var root=mark.root;if(root.$transition)try{root.$transition.stop();}catch(ex){return doEnd(!1);}
var list,start;root.$transition=that;root._renderId++;var before=mark.scene;mark.scene=null;var i0=pv.Mark.prototype.index;try{mark.bind();mark.build();var after=mark.scene;mark.scene=before;pv.Mark.prototype.index=i0;start=Date.now();list={};interpolate(list,before,after);}catch(ex){pv.Mark.prototype.index=i0;return doEnd(!1);}
if(!list.head)return doEnd(!0);var advance=function(){var t=Math.max(0,Math.min(1,(Date.now()-start)/duration)),te=ease(t),step=list.head;do{step(te);}while(step=step.next);if(1===t){cleanupOnce(mark.scene);pv.Scene.updateAll(before);doEnd(!0);}else pv.Scene.updateAll(before);};timer=setInterval(function(){try{advance();}catch(ex){doEnd(!1);}},24);};that.stop=function(){doEnd(!0);};};}();pv.simulation=function(particles){return new pv.Simulation(particles);};pv.Simulation=function(particles){for(var i=0;i<particles.length;i++)this.particle(particles[i]);};pv.Simulation.prototype.particle=function(p){p.next=this.particles;isNaN(p.px)&&(p.px=p.x);isNaN(p.py)&&(p.py=p.y);isNaN(p.fx)&&(p.fx=0);isNaN(p.fy)&&(p.fy=0);this.particles=p;return this;};pv.Simulation.prototype.force=function(f){f.next=this.forces;this.forces=f;return this;};pv.Simulation.prototype.constraint=function(c){c.next=this.constraints;this.constraints=c;return this;};pv.Simulation.prototype.stabilize=function(n){var c;arguments.length||(n=3);for(var i=0;i<n;i++){var q=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,q);}
for(var p=this.particles;p;p=p.next){p.px=p.x;p.py=p.y;}
return this;};pv.Simulation.prototype.step=function(){var p,f,c;for(p=this.particles;p;p=p.next){var px=p.px,py=p.py;p.px=p.x;p.py=p.y;p.x+=p.vx=p.x-px+p.fx;p.y+=p.vy=p.y-py+p.fy;}
var q=new pv.Quadtree(this.particles);for(c=this.constraints;c;c=c.next)c.apply(this.particles,q);for(p=this.particles;p;p=p.next)p.fx=p.fy=0;for(f=this.forces;f;f=f.next)f.apply(this.particles,q);};pv.Quadtree=function(particles){function insert(n,p,x1,y1,x2,y2){if(!isNaN(p.x)&&!isNaN(p.y))if(n.leaf)if(n.p)if(Math.abs(n.p.x-p.x)+Math.abs(n.p.y-p.y)<.01)insertChild(n,p,x1,y1,x2,y2);else{var v=n.p;n.p=null;insertChild(n,v,x1,y1,x2,y2);insertChild(n,p,x1,y1,x2,y2);}else n.p=p;else insertChild(n,p,x1,y1,x2,y2);}
function insertChild(n,p,x1,y1,x2,y2){var sx=.5*(x1+x2),sy=.5*(y1+y2),right=p.x>=sx,bottom=p.y>=sy;n.leaf=!1;switch((bottom<<1)+right){case 0:n=n.c1||(n.c1=new pv.Quadtree.Node());break;case 1:n=n.c2||(n.c2=new pv.Quadtree.Node());break;case 2:n=n.c3||(n.c3=new pv.Quadtree.Node());break;case 3:n=n.c4||(n.c4=new pv.Quadtree.Node());}
right?x1=sx:x2=sx;bottom?y1=sy:y2=sy;insert(n,p,x1,y1,x2,y2);}
var p,x1=Number.POSITIVE_INFINITY,y1=x1,x2=Number.NEGATIVE_INFINITY,y2=x2;for(p=particles;p;p=p.next){p.x<x1&&(x1=p.x);p.y<y1&&(y1=p.y);p.x>x2&&(x2=p.x);p.y>y2&&(y2=p.y);}
var dx=x2-x1,dy=y2-y1;dx>dy?y2=y1+dx:x2=x1+dy;this.xMin=x1;this.yMin=y1;this.xMax=x2;this.yMax=y2;this.root=new pv.Quadtree.Node();for(p=particles;p;p=p.next)insert(this.root,p,x1,y1,x2,y2);};pv.Quadtree.Node=function(){this.leaf=!0;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null;};pv.Force={};pv.Force.charge=function(k){function accumulate(n){function accumulateChild(c){accumulate(c);n.cn+=c.cn;cx+=c.cn*c.cx;cy+=c.cn*c.cy;}
var cx=0,cy=0;n.cn=0;if(!n.leaf){n.c1&&accumulateChild(n.c1);n.c2&&accumulateChild(n.c2);n.c3&&accumulateChild(n.c3);n.c4&&accumulateChild(n.c4);}
if(n.p){n.cn+=k;cx+=k*n.p.x;cy+=k*n.p.y;}
n.cx=cx/n.cn;n.cy=cy/n.cn;}
function forces(n,p,x1,y1,x2,y2){var dx=n.cx-p.x,dy=n.cy-p.y,dn=1/Math.sqrt(dx*dx+dy*dy);if(n.leaf&&n.p!=p||(x2-x1)*dn<theta){if(dn<max1)return;dn>min1&&(dn=min1);var kc=n.cn*dn*dn*dn,fx=dx*kc,fy=dy*kc;p.fx+=fx;p.fy+=fy;}else if(!n.leaf){var sx=.5*(x1+x2),sy=.5*(y1+y2);n.c1&&forces(n.c1,p,x1,y1,sx,sy);n.c2&&forces(n.c2,p,sx,y1,x2,sy);n.c3&&forces(n.c3,p,x1,sy,sx,y2);n.c4&&forces(n.c4,p,sx,sy,x2,y2);if(dn<max1)return;dn>min1&&(dn=min1);if(n.p&&n.p!=p){var kc=k*dn*dn*dn,fx=dx*kc,fy=dy*kc;p.fx+=fx;p.fy+=fy;}}}
var min=2,min1=1/min,max=500,max1=1/max,theta=.9,force={};arguments.length||(k=-40);force.constant=function(x){if(arguments.length){k=Number(x);return force;}
return k;};force.domain=function(a,b){if(arguments.length){min=Number(a);min1=1/min;max=Number(b);max1=1/max;return force;}
return[min,max];};force.theta=function(x){if(arguments.length){theta=Number(x);return force;}
return theta;};force.apply=function(particles,q){accumulate(q.root);for(var p=particles;p;p=p.next)forces(q.root,p,q.xMin,q.yMin,q.xMax,q.yMax);};return force;};pv.Force.drag=function(k){var force={};arguments.length||(k=.1);force.constant=function(x){if(arguments.length){k=x;return force;}
return k;};force.apply=function(particles){if(k)for(var p=particles;p;p=p.next){p.fx-=k*p.vx;p.fy-=k*p.vy;}};return force;};pv.Force.spring=function(k){var links,kl,d=.1,l=20,force={};arguments.length||(k=.1);force.links=function(x){if(arguments.length){links=x;kl=x.map(function(l){return 1/Math.sqrt(Math.max(l.sourceNode.linkDegree,l.targetNode.linkDegree));});return force;}
return links;};force.constant=function(x){if(arguments.length){k=Number(x);return force;}
return k;};force.damping=function(x){if(arguments.length){d=Number(x);return force;}
return d;};force.length=function(x){if(arguments.length){l=Number(x);return force;}
return l;};force.apply=function(particles){for(var i=0;i<links.length;i++){var a=links[i].sourceNode,b=links[i].targetNode,dx=a.x-b.x,dy=a.y-b.y,dn=Math.sqrt(dx*dx+dy*dy),dd=dn?1/dn:1,ks=k*kl[i],kd=d*kl[i],kk=(ks*(dn-l)+kd*(dx*(a.vx-b.vx)+dy*(a.vy-b.vy))*dd)*dd,fx=-kk*(dn?dx:.01*(.5-Math.random())),fy=-kk*(dn?dy:.01*(.5-Math.random()));a.fx+=fx;a.fy+=fy;b.fx-=fx;b.fy-=fy;}};return force;};pv.Constraint={};pv.Constraint.collision=function(radius){function constrain(n,p,x1,y1,x2,y2){if(!n.leaf){var sx=.5*(x1+x2),sy=.5*(y1+y2),top=sy>py1,bottom=sy<py2,left=sx>px1,right=sx<px2;if(top){n.c1&&left&&constrain(n.c1,p,x1,y1,sx,sy);n.c2&&right&&constrain(n.c2,p,sx,y1,x2,sy);}
if(bottom){n.c3&&left&&constrain(n.c3,p,x1,sy,sx,y2);n.c4&&right&&constrain(n.c4,p,sx,sy,x2,y2);}}
if(n.p&&n.p!=p){var dx=p.x-n.p.x,dy=p.y-n.p.y,l=Math.sqrt(dx*dx+dy*dy),d=r1+radius(n.p);if(l<d){var k=(l-d)/l*.5;dx*=k;dy*=k;p.x-=dx;p.y-=dy;n.p.x+=dx;n.p.y+=dy;}}}
var r1,px1,py1,px2,py2,n=1,constraint={};arguments.length||(r1=10);constraint.repeat=function(x){if(arguments.length){n=Number(x);return constraint;}
return n;};constraint.apply=function(particles,q){var p,r,max=-1/0;for(p=particles;p;p=p.next){r=radius(p);r>max&&(max=r);}
for(var i=0;i<n;i++)for(p=particles;p;p=p.next){r=(r1=radius(p))+max;px1=p.x-r;px2=p.x+r;py1=p.y-r;py2=p.y+r;constrain(q.root,p,q.xMin,q.yMin,q.xMax,q.yMax);}};return constraint;};pv.Constraint.position=function(f){var a=1,constraint={};arguments.length||(f=function(p){return p.fix;});constraint.alpha=function(x){if(arguments.length){a=Number(x);return constraint;}
return a;};constraint.apply=function(particles){for(var p=particles;p;p=p.next){var v=f(p);if(v){p.x+=(v.x-p.x)*a;p.y+=(v.y-p.y)*a;p.fx=p.fy=p.vx=p.vy=0;}}};return constraint;};pv.Constraint.bound=function(){var x,y,constraint={};constraint.x=function(min,max){if(arguments.length){x={min:Math.min(min,max),max:Math.max(min,max)};return this;}
return x;};constraint.y=function(min,max){if(arguments.length){y={min:Math.min(min,max),max:Math.max(min,max)};return this;}
return y;};constraint.apply=function(particles){if(x)for(var p=particles;p;p=p.next)p.x=p.x<x.min?x.min:p.x>x.max?x.max:p.x;if(y)for(var p=particles;p;p=p.next)p.y=p.y<y.min?y.min:p.y>y.max?y.max:p.y;};return constraint;};pv.Layout=function(){pv.Panel.call(this);};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=pv.Mark.prototype.localProperty;pv.Layout.Network=function(){pv.Layout.call(this);var that=this;this.$id=pv.id();(this.node=new pv.Mark().data(function(){return that.nodes();}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(n){return n.x;}).top(function(n){return n.y;})).parent=this;this.link=new pv.Mark().extend(this.node).data(function(p){return[p.sourceNode,p.targetNode];}).fillStyle(null).lineWidth(function(d,p){return 1.5*p.linkValue;}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(type){return that.add(pv.Panel).data(function(){return that.links();}).add(type).extend(this);};(this.label=new pv.Mark().extend(this.node).textMargin(7).textBaseline("middle").text(function(n){return n.nodeName||n.nodeValue;}).textAngle(function(n){var a=n.midAngle;return pv.Wedge.upright(a)?a:a+Math.PI;}).textAlign(function(n){return pv.Wedge.upright(n.midAngle)?"left":"right";})).parent=this;};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(v){return v.map(function(d,i){"object"!=typeof d&&(d={nodeValue:d});d.index=i;return d;});}).property("links",function(v){return v.map(function(d){isNaN(d.linkValue)&&(d.linkValue=isNaN(d.value)?1:d.value);return d;});});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this;};pv.Layout.Network.prototype.buildProperties=function(s,properties){(s.$id||0)<this.$id&&pv.Layout.prototype.buildProperties.call(this,s,properties);};pv.Layout.Network.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);if(s.$id>=this.$id)return!0;s.$id=this.$id;s.nodes.forEach(function(d){d.linkDegree=0;});s.links.forEach(function(d){var v=d.linkValue;(d.sourceNode||(d.sourceNode=s.nodes[d.source])).linkDegree+=v;(d.targetNode||(d.targetNode=s.nodes[d.target])).linkDegree+=v;});};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc");};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(s){s.links||(s.links=pv.Layout.Hierarchy.links.call(this));pv.Layout.Network.prototype.buildImplied.call(this,s);};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(n){return n.parentNode;}).map(function(n){return{sourceNode:n,targetNode:n.parentNode,linkValue:1};});};pv.Layout.Hierarchy.NodeLink={buildImplied:function(s){function radius(n){return n.parentNode?n.depth*(or-ir)+ir:0;}
var nodes=s.nodes,orient=s.orient,horizontal=/^(top|bottom)$/.test(orient),w=s.width,h=s.height;if("radial"==orient){var ir=s.innerRadius,or=s.outerRadius;null==ir&&(ir=0);null==or&&(or=Math.min(w,h)/2);}
for(var i=0;i<nodes.length;i++){var n=nodes[i];n.midAngle="radial"==orient?function(n){return n.parentNode?2*(n.breadth-.25)*Math.PI:0;}(n):horizontal?Math.PI/2:0;n.x=function(n){switch(orient){case"left":return n.depth*w;case"right":return w-n.depth*w;case"top":return n.breadth*w;case"bottom":return w-n.breadth*w;case"radial":return w/2+radius(n)*Math.cos(n.midAngle);}}(n);n.y=function(n){switch(orient){case"left":return n.breadth*h;case"right":return h-n.breadth*h;case"top":return n.depth*h;case"bottom":return h-n.depth*h;case"radial":return h/2+radius(n)*Math.sin(n.midAngle);}}(n);n.firstChild&&(n.midAngle+=Math.PI);}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(n){return n.dx;}).height(function(n){return n.dy;}).innerRadius(function(n){return n.innerRadius;}).outerRadius(function(n){return n.outerRadius;}).startAngle(function(n){return n.startAngle;}).angle(function(n){return n.angle;});this.label.textAlign("center").left(function(n){return n.x+n.dx/2;}).top(function(n){return n.y+n.dy/2;});delete this.link;},buildImplied:function(s){function scale(d,depth){return(d+depth)/(1+depth);}
var nodes=s.nodes,orient=s.orient,horizontal=/^(top|bottom)$/.test(orient),w=s.width,h=s.height,depth=-nodes[0].minDepth;if("radial"==orient){var ir=s.innerRadius,or=s.outerRadius;null==ir&&(ir=0);ir&&(depth*=2);null==or&&(or=Math.min(w,h)/2);}
for(var i=0;i<nodes.length;i++){var n=nodes[i];n.x=function(n){switch(orient){case"left":return scale(n.minDepth,depth)*w;case"right":return(1-scale(n.maxDepth,depth))*w;case"top":return n.minBreadth*w;case"bottom":return(1-n.maxBreadth)*w;case"radial":return w/2;}}(n);n.y=function(n){switch(orient){case"left":return n.minBreadth*h;case"right":return(1-n.maxBreadth)*h;case"top":return scale(n.minDepth,depth)*h;case"bottom":return(1-scale(n.maxDepth,depth))*h;case"radial":return h/2;}}(n);if("radial"==orient){n.innerRadius=function(n){return Math.max(0,scale(n.minDepth,depth/2))*(or-ir)+ir;}(n);n.outerRadius=function(n){return scale(n.maxDepth,depth/2)*(or-ir)+ir;}(n);n.startAngle=function(n){return 2*(n.parentNode?n.minBreadth-.25:0)*Math.PI;}(n);n.angle=function(n){return 2*(n.parentNode?n.maxBreadth-n.minBreadth:1)*Math.PI;}(n);n.midAngle=n.startAngle+n.angle/2;}else n.midAngle=horizontal?-Math.PI/2:0;n.dx=function(n){switch(orient){case"left":case"right":return(n.maxDepth-n.minDepth)/(1+depth)*w;case"top":case"bottom":return(n.maxBreadth-n.minBreadth)*w;case"radial":return n.parentNode?(n.innerRadius+n.outerRadius)*Math.cos(n.midAngle):0;}}(n);n.dy=function(n){switch(orient){case"left":case"right":return(n.maxBreadth-n.minBreadth)*h;case"top":case"bottom":return(n.maxDepth-n.minDepth)/(1+depth)*h;case"radial":return n.parentNode?(n.innerRadius+n.outerRadius)*Math.sin(n.midAngle):0;}}(n);}}};pv.Layout.Grid=function(){pv.Layout.call(this);var that=this;(this.cell=new pv.Mark().data(function(){return that.scene[that.index].$grid;}).width(function(){return that.width()/that.cols();}).height(function(){return that.height()/that.rows();}).left(function(){return this.width()*(this.index%that.cols());}).top(function(){return this.height()*Math.floor(this.index/that.cols());})).parent=this;};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=new pv.Layout.Grid().extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);var r=s.rows,c=s.cols;"object"==typeof c&&(r=pv.transpose(c));if("object"==typeof r){s.$grid=pv.blend(r);s.rows=r.length;s.cols=r[0]?r[0].length:0;}else s.$grid=pv.repeat([s.data],r*c);};pv.Layout.Stack=function(){function proxy(name){return function(){return prop[name](this.parent.index,this.index);};}
pv.Layout.call(this);var values,that=this,none=function(){return null;},prop={t:none,l:none,r:none,b:none,w:none,h:none},buildImplied=that.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);var m,data=s.layers,n=data.length,orient=s.orient,horizontal=/^(top|bottom)\b/.test(orient),h=this.parent[horizontal?"height":"width"](),x=[],y=[],dy=[],stack=pv.Mark.stack,o={parent:{parent:this}};stack.unshift(null);values=[];for(var i=0;i<n;i++){dy[i]=[];y[i]=[];o.parent.index=i;stack[0]=data[i];values[i]=this.$values.apply(o.parent,stack);i||(m=values[i].length);stack.unshift(null);for(var j=0;j<m;j++){stack[0]=values[i][j];o.index=j;i||(x[j]=this.$x.apply(o,stack));dy[i][j]=this.$y.apply(o,stack);}
stack.shift();}
stack.shift();var index;switch(s.order){case"inside-out":for(var max=dy.map(function(v){return pv.max.index(v);}),map=pv.range(n).sort(function(a,b){return max[a]-max[b];}),sums=dy.map(function(v){return pv.sum(v);}),top=0,bottom=0,tops=[],bottoms=[],i=0;i<n;i++){var j=map[i];if(top<bottom){top+=sums[j];tops.push(j);}else{bottom+=sums[j];bottoms.push(j);}}
index=bottoms.reverse().concat(tops);break;case"reverse":index=pv.range(n-1,-1,-1);break;default:index=pv.range(n);}
switch(s.offset){case"silohouette":for(var j=0;j<m;j++){for(var o=0,i=0;i<n;i++)o+=dy[i][j];y[index[0]][j]=(h-o)/2;}
break;case"wiggle":for(var o=0,i=0;i<n;i++)o+=dy[i][0];y[index[0]][0]=o=(h-o)/2;for(var j=1;j<m;j++){for(var s1=0,s2=0,dx=x[j]-x[j-1],i=0;i<n;i++)s1+=dy[i][j];for(var i=0;i<n;i++){for(var s3=(dy[index[i]][j]-dy[index[i]][j-1])/(2*dx),k=0;k<i;k++)s3+=(dy[index[k]][j]-dy[index[k]][j-1])/dx;s2+=s3*dy[index[i]][j];}
y[index[0]][j]=o-=s1?s2/s1*dx:0;}
break;case"expand":for(var j=0;j<m;j++){y[index[0]][j]=0;for(var k=0,i=0;i<n;i++)k+=dy[i][j];if(k){k=h/k;for(var i=0;i<n;i++)dy[i][j]*=k;}else{k=h/n;for(var i=0;i<n;i++)dy[i][j]=k;}}
break;default:for(var j=0;j<m;j++)y[index[0]][j]=0;}
for(var j=0;j<m;j++)for(var o=y[index[0]][j],i=1;i<n;i++){o+=dy[index[i-1]][j];y[index[i]][j]=o;}
var i=orient.indexOf("-"),pdy=horizontal?"h":"w",px=i<0?horizontal?"l":"b":orient.charAt(i+1),py=orient.charAt(0);for(var p in prop)prop[p]=none;prop[px]=function(i,j){return x[j];};prop[py]=function(i,j){return y[i][j];};prop[pdy]=function(i,j){return dy[i][j];};};this.layer=new pv.Mark().data(function(){return values[this.parent.index];}).top(proxy("t")).left(proxy("l")).right(proxy("r")).bottom(proxy("b")).width(proxy("w")).height(proxy("h"));this.layer.add=function(type){return that.add(pv.Panel).data(function(){return that.layers();}).add(type).extend(this);};};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=new pv.Layout.Stack().extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0;};pv.Layout.Stack.prototype.x=function(f){this.$x=pv.functor(f);return this;};pv.Layout.Stack.prototype.y=function(f){this.$y=pv.functor(f);return this;};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(f){this.$values=pv.functor(f);return this;};pv.Layout.Band=function(){function proxy(name){return function(){return itemProps[name](this.index,this.parent.index);};}
pv.Layout.call(this);var itemProps,values,that=this,buildImplied=that.buildImplied,itemProto=new pv.Mark().data(function(){return values[this.parent.index];}).top(proxy("t")).left(proxy("l")).right(proxy("r")).bottom(proxy("b")).width(proxy("w")).height(proxy("h")).antialias(proxy("antialias"));this.buildImplied=function(s){buildImplied.call(this,s);itemProps=Object.create(pv.Layout.Band.$baseItemProps);values=[];var data=s.layers,L=data.length;if(L>0){var orient=s.orient,horizontal=/^(top|bottom)\b/.test(orient),bh=this.parent[horizontal?"height":"width"](),bands=this._readData(data,values,s),B=bands.length;"reverse"===s.bandOrder&&bands.reverse();if("reverse"===s.order){values.reverse();for(var b=0;b<B;b++)bands[b].items.reverse();}
switch(s.layout){case"grouped":this._calcGrouped(bands,L,bh,s);break;case"stacked":this._calcStacked(bands,L,bh,s);}
for(var hZero=s.hZero||0,isStacked="stacked"===s.layout,i=0;i<B;i++)for(var band=bands[i],hMargin2=isStacked?Math.max(0,band.vertiMargin)/2:0,j=0;j<L;j++){var item=band.items[j];if(item.zero){item.h=hZero;item.y-=hMargin2+hZero/2;}}
this._bindItemProps(bands,itemProps,orient,horizontal);}};var itemAccessor=this.item={end:this,add:function(type){return that.add(pv.Panel).data(function(){return that.layers();}).add(type).extend(itemProto);},order:function(value){that.order(value);return this;},w:function(f){that.$iw=pv.functor(f);return this;},h:function(f){that.$ih=pv.functor(f);return this;},horizontalRatio:function(f){that.$ihorizRatio=pv.functor(f);return this;},verticalMargin:function(f){that.$ivertiMargin=pv.functor(f);return this;}},bandAccessor=this.band={end:this,w:function(f){that.$bw=pv.functor(f);return this;},x:function(f){that.$bx=pv.functor(f);return this;},order:function(value){that.bandOrder(value);return this;},differentialControl:function(f){that.$bDiffControl=pv.functor(f);return this;}};this.band.item=itemAccessor;this.item.band=bandAccessor;};pv.Layout.Band.$baseItemProps=function(){var none=function(){return null;};return{t:none,l:none,r:none,b:none,w:none,h:none};}();pv.Layout.Band.prototype=pv.extend(pv.Layout).property("orient",String).property("layout",String).property("layers").property("yZero",Number).property("hZero",Number).property("verticalMode",String).property("horizontalMode",String).property("order",String).property("bandOrder",String);pv.Layout.Band.prototype.defaults=new pv.Layout.Band().extend(pv.Layout.prototype.defaults).orient("bottom-left").layout("grouped").yZero(0).hZero(1.5).layers([[]]);pv.Layout.Band.prototype.$bx=pv.Layout.Band.prototype.$bw=pv.Layout.Band.prototype.$bDiffControl=pv.Layout.Band.prototype.$iw=pv.Layout.Band.prototype.$ih=pv.Layout.Band.prototype.$ivertiMargin=pv.functor(0);pv.Layout.Band.prototype.$ihorizRatio=pv.functor(.9);pv.Layout.Band.prototype.$values=pv.identity;pv.Layout.Band.prototype.values=function(f){this.$values=pv.functor(f);return this;};pv.Layout.prototype._readData=function(data,layersValues,scene){var B,L=data.length,bands=[],stack=pv.Mark.stack,hZero=scene.hZero,o={parent:{parent:this}};stack.unshift(null);for(var l=0;l<L;l++){o.parent.index=l;stack[0]=data[l];var layerValues=layersValues[l]=this.$values.apply(o.parent,stack);l||(B=layerValues.length);stack.unshift(null);for(var b=0;b<B;b++){stack[0]=layerValues[b];o.index=b;var band=bands[b];band||(band=bands[b]={horizRatio:this.$ihorizRatio.apply(o,stack),vertiMargin:this.$ivertiMargin.apply(o,stack),w:this.$bw.apply(o,stack),x:this.$bx.apply(o,stack),diffControl:this.$bDiffControl?this.$bDiffControl.apply(o,stack):0,items:[]});var ih=this.$ih.apply(o,stack),h=null!=ih?Math.abs(ih):ih;band.items[l]={y:scene.yZero||0,x:0,w:this.$iw.apply(o,stack),h:h,zero:null!=h&&h<=hZero,dir:ih<0?-1:1};}
stack.shift();}
stack.shift();return bands;};pv.Layout.Band.prototype._normalizeBands=function(bands,L,bh,scene){var items,B=bands.length;if("expand"===scene.verticalMode)for(var b=0;b<B;b++){items=bands[b].items;for(var hSum=null,nonNullCount=0,l=0;l<L;l++){var item=items[l];item.dir=1;var h=item.h;if(null!=h){nonNullCount++;hSum+=h;}}
if(nonNullCount)if(hSum)for(var hScale=bh/hSum,l=0;l<L;l++){var h=items[l].h;if(null!=h){items[l].h=h*hScale;items[l].zero=items[l].h<=scene.hZero;}}else if(0==hSum)for(var l=0;l<L;l++)items[l].h=0;else for(var hAvg=bh/nonNullCount,l=0;l<L;l++){var h=items[l].h;null!=h&&(items[l].h=hAvg);}}
return items;};pv.Layout.Band.prototype._calcGrouped=function(bands,L,bh,scene){for(var items=this._normalizeBands(bands,L,bh,scene),b=0,B=bands.length;b<B;b++){for(var band=bands[b],items=band.items,w=band.w,horizRatio=band.horizRatio,wItems=0,l=0;l<L;l++)wItems+=items[l].w;1===L?horizRatio=1:horizRatio>0&&horizRatio<=1||(horizRatio=1);if(null==w)w=band.w=wItems/horizRatio;else if("expand"===scene.horizontalMode){var wItems2=horizRatio*w;if(wItems)for(var wScale=wItems2/wItems,l=0;l<L;l++)items[l].w*=wScale;else for(var wiavg=wItems2/L,l=0;l<L;l++)items[l].w=wiavg;wItems=wItems2;}
for(var wItemsWithMargin=wItems/horizRatio,ix=band.x-wItemsWithMargin/2,margin=L>1?(wItemsWithMargin-wItems)/(L-1):0,l=0;l<L;l++){var item=items[l];item.x=ix;ix+=item.w+margin;item.dir<0&&(item.y-=item.h);}}};pv.Layout.Band.prototype._calcStacked=function(bands,L,bh,scene){for(var items=this._normalizeBands(bands,L,bh,scene),yZero=scene.yZero,yOffset=yZero,b=0,B=bands.length;b<B;b++){var band=bands[b],bx=band.x,bDiffControl=band.diffControl,positiveGoesDown=bDiffControl<0,vertiMargin=Math.max(0,band.vertiMargin);items=band.items;var resultPos=this._layoutItemsOfDir(1,positiveGoesDown,items,vertiMargin,bx,yOffset),resultNeg=null;resultPos.existsOtherDir&&(resultNeg=this._layoutItemsOfDir(-1,positiveGoesDown,items,vertiMargin,bx,yOffset));if(bDiffControl){if(1===Math.abs(bDiffControl)){var yOffset0=yOffset;yOffset=resultPos.yOffset;resultNeg&&(yOffset-=yOffset0-resultNeg.yOffset);}}else yOffset=yZero;}};pv.Layout.Band.prototype._layoutItemsOfDir=function(stackDir,positiveGoesDown,items,vertiMargin,bx,yOffset){for(var existsOtherDir=!1,vertiMargin2=vertiMargin/2,efDir=positiveGoesDown?-stackDir:stackDir,reverseLayers=positiveGoesDown,l=0,L=items.length;l<L;l+=1){var item=items[reverseLayers?L-l-1:l];if(item.dir===stackDir){var h=item.h||0;if(efDir>0){item.y=yOffset+vertiMargin2;yOffset+=h;}else{item.y=yOffset-(h-vertiMargin2);yOffset-=h;}
var h2=h-vertiMargin;item.h=h2>0?h2:0;item.x=bx-item.w/2;}else existsOtherDir=!0;}
return{existsOtherDir:existsOtherDir,yOffset:yOffset};};pv.Layout.Band.prototype._bindItemProps=function(bands,itemProps,orient,horizontal){var index=orient.indexOf("-"),ph=horizontal?"h":"w",pw=horizontal?"w":"h",px=index<0?horizontal?"l":"b":orient.charAt(index+1),py=orient.charAt(0);itemProps[px]=function(b,l){return bands[b].items[l].x;};itemProps[py]=function(b,l){return bands[b].items[l].y;};itemProps[pw]=function(b,l){return bands[b].items[l].w;};itemProps[ph]=function(b,l){return bands[b].items[l].h||0;};itemProps.antialias=function(b,l){return bands[b].items[l].zero;};};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(n){return n.dx;}).height(function(n){return n.dy;});this.label.visible(function(n){return!n.firstChild;}).left(function(n){return n.x+n.dx/2;}).top(function(n){return n.y+n.dy/2;}).textAlign("center").textAngle(function(n){return n.dx>n.dy?0:-Math.PI/2;});(this.leaf=new pv.Mark().extend(this.node).fillStyle(null).strokeStyle(null).visible(function(n){return!n.firstChild;})).parent=this;delete this.link;};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=new pv.Layout.Treemap().extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.$size=function(d){return Number(d.nodeValue);};pv.Layout.Treemap.prototype.$padLeft=pv.Layout.Treemap.prototype.$padRight=pv.Layout.Treemap.prototype.$padBottom=pv.Layout.Treemap.prototype.$padTop=function(){return 0;};pv.Layout.Treemap.prototype.size=function(f){this.$size=pv.functor(f);return this;};pv.Layout.Treemap.prototype.padding=function(n){n=pv.functor(n);return this.paddingLeft(n).paddingRight(n).paddingTop(n).paddingBottom(n);};pv.Layout.Treemap.prototype.paddingLeft=function(f){if(arguments.length){this.$padLeft=pv.functor(f);return this;}
return this.$padLeft;};pv.Layout.Treemap.prototype.paddingRight=function(f){if(arguments.length){this.$padRight=pv.functor(f);return this;}
return this.$padRight;};pv.Layout.Treemap.prototype.paddingBottom=function(f){if(arguments.length){this.$padBottom=pv.functor(f);return this;}
return this.$padBottom;};pv.Layout.Treemap.prototype.paddingTop=function(f){if(arguments.length){this.$padTop=pv.functor(f);return this;}
return this.$padTop;};pv.Layout.Treemap.prototype.buildImplied=function(s){function slice(row,sum,horizontal,x,y,w,h){for(var i=0,d=0;i<row.length;i++){var n=row[i];if(horizontal){n.x=x+d;n.y=y;d+=n.dx=round(w*n.size/sum);n.dy=h;}else{n.x=x;n.y=y+d;n.dx=w;d+=n.dy=round(h*n.size/sum);}}
n&&(horizontal?n.dx+=w-d:n.dy+=h-d);}
function ratio(row,l){for(var rmax=-1/0,rmin=1/0,s=0,i=0;i<row.length;i++){var r=row[i].size;r<rmin&&(rmin=r);r>rmax&&(rmax=r);s+=r;}
s*=s;l*=l;return Math.max(l*rmax/s,s/(l*rmin));}
function layout(n,i){function position(row){var horizontal=w==l,sum=pv.sum(row,size),r=l?round(sum/l):0;slice(row,sum,horizontal,x,y,horizontal?w:r,horizontal?r:h);if(horizontal){y+=r;h-=r;}else{x+=r;w-=r;}
l=Math.min(w,h);return horizontal;}
var p=n.parentNode,x=n.x,y=n.y,w=n.dx,h=n.dy;if(p){x+=p.paddingLeft;y+=p.paddingTop;w+=-p.paddingLeft-p.paddingRight,h+=-p.paddingTop-p.paddingBottom;}
if("squarify"==mode){var row=[],mink=1/0,l=Math.min(w,h),k=w*h/n.size;if(!(n.size<=0)){n.visitBefore(function(n){n.size*=k;});for(var children=n.childNodes.slice();children.length;){var child=children[children.length-1];if(child.size){row.push(child);var k=ratio(row,l);if(k<=mink){children.pop();mink=k;}else{row.pop();position(row);row.length=0;mink=1/0;}}else children.pop();}
if(position(row))for(var i=0;i<row.length;i++)row[i].dy+=h;else for(var i=0;i<row.length;i++)row[i].dx+=w;}}else slice(n.childNodes,n.size,"slice"==mode||"dice"!=mode&&1&i,x,y,w,h);}
if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,s)){var that=this,nodes=s.nodes,root=nodes[0],stack=pv.Mark.stack,size=function(n){return n.size;},round=s.round?Math.round:Number,mode=s.mode;stack.unshift(null);try{root.visitAfter(function(n,i){n.depth=i;n.x=n.y=n.dx=n.dy=0;stack[0]=n;if(n.firstChild){n.size=pv.sum(n.childNodes,size);n.paddingRight=+that.$padRight.apply(that,stack)||0;n.paddingLeft=+that.$padLeft.apply(that,stack)||0;n.paddingBottom=+that.$padBottom.apply(that,stack)||0;n.paddingTop=+that.$padTop.apply(that,stack)||0;}else n.size=that.$size.apply(that,stack);});}finally{stack.shift();}
switch(s.order){case"ascending":root.sort(function(a,b){return a.size-b.size;});break;case"descending":root.sort(function(a,b){return b.size-a.size;});break;case"reverse":root.reverse();}
root.x=0;root.y=0;root.dx=s.width;root.dy=s.height;root.visitBefore(layout);}};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this);};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=new pv.Layout.Tree().extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(s){function firstWalk(v){var l,r,a;if(v.firstChild){l=v.firstChild;r=v.lastChild;a=l;for(var c=l;c;c=c.nextSibling){firstWalk(c);a=apportion(c,a);}
executeShifts(v);var midpoint=.5*(l.prelim+r.prelim);if(l=v.previousSibling){v.prelim=l.prelim+distance(v.depth,!0);v.mod=v.prelim-midpoint;}else v.prelim=midpoint;}else(l=v.previousSibling)&&(v.prelim=l.prelim+distance(v.depth,!0));}
function secondWalk(v,m,depth){v.breadth=v.prelim+m;m+=v.mod;for(var c=v.firstChild;c;c=c.nextSibling)secondWalk(c,m,depth);}
function apportion(v,a){var w=v.previousSibling;if(w){for(var vip=v,vop=v,vim=w,vom=v.parentNode.firstChild,sip=vip.mod,sop=vop.mod,sim=vim.mod,som=vom.mod,nr=nextRight(vim),nl=nextLeft(vip);nr&&nl;){vim=nr;vip=nl;vom=nextLeft(vom);vop=nextRight(vop);vop.ancestor=v;var shift=vim.prelim+sim-(vip.prelim+sip)+distance(vim.depth,!1);if(shift>0){moveSubtree(ancestor(vim,v,a),v,shift);sip+=shift;sop+=shift;}
sim+=vim.mod;sip+=vip.mod;som+=vom.mod;sop+=vop.mod;nr=nextRight(vim);nl=nextLeft(vip);}
if(nr&&!nextRight(vop)){vop.thread=nr;vop.mod+=sim-sop;}
if(nl&&!nextLeft(vom)){vom.thread=nl;vom.mod+=sip-som;a=v;}}
return a;}
function nextLeft(v){return v.firstChild||v.thread;}
function nextRight(v){return v.lastChild||v.thread;}
function moveSubtree(wm,wp,shift){var subtrees=wp.number-wm.number;wp.change-=shift/subtrees;wp.shift+=shift;wm.change+=shift/subtrees;wp.prelim+=shift;wp.mod+=shift;}
function executeShifts(v){for(var shift=0,change=0,c=v.lastChild;c;c=c.previousSibling){c.prelim+=shift;c.mod+=shift;change+=c.change;shift+=c.shift+change;}}
function ancestor(vim,v,a){return vim.ancestor.parentNode==v.parentNode?vim.ancestor:a;}
function distance(depth,siblings){return(siblings?1:group+1)/("radial"==orient?depth:1);}
function midAngle(n){return"radial"==orient?n.breadth/depth:0;}
function x(n){switch(orient){case"left":return n.depth;case"right":return w-n.depth;case"top":case"bottom":return n.breadth+w/2;case"radial":return w/2+n.depth*Math.cos(midAngle(n));}}
function y(n){switch(orient){case"left":case"right":return n.breadth+h/2;case"top":return n.depth;case"bottom":return h-n.depth;case"radial":return h/2+n.depth*Math.sin(midAngle(n));}}
if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,s)){var nodes=s.nodes,orient=s.orient,depth=s.depth,breadth=s.breadth,group=s.group,w=s.width,h=s.height,root=nodes[0];root.visitAfter(function(v,i){v.ancestor=v;v.prelim=0;v.mod=0;v.change=0;v.shift=0;v.number=v.previousSibling?v.previousSibling.number+1:0;v.depth=i;});firstWalk(root);secondWalk(root,-root.prelim,0);root.visitAfter(function(v){v.breadth*=breadth;v.depth*=depth;v.midAngle=midAngle(v);v.x=x(v);v.y=y(v);v.firstChild&&(v.midAngle+=Math.PI);delete v.breadth;delete v.depth;delete v.ancestor;delete v.prelim;delete v.mod;delete v.change;delete v.shift;delete v.number;delete v.thread;});}};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after");};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=new pv.Layout.Indent().extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(s){function position(n,breadth,depth){n.x=ax+depth++*dspace;n.y=ay+breadth++*bspace;n.midAngle=0;for(var c=n.firstChild;c;c=c.nextSibling)breadth=position(c,breadth,depth);return breadth;}
if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,s)){var nodes=s.nodes,bspace=s.breadth,dspace=s.depth,ax=0,ay=0;position(nodes[0],1,1);}};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.shapeRadius(function(n){return n.radius;}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link;};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=new pv.Layout.Pack().extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1;};pv.Layout.Pack.prototype.size=function(f){this.$radius="function"==typeof f?function(){return Math.sqrt(f.apply(this,arguments));}:(f=Math.sqrt(f),function(){return f;});return this;};pv.Layout.Pack.prototype.buildImplied=function(s){function packTree(n){for(var nodes=[],c=n.firstChild;c;c=c.nextSibling){c.firstChild&&(c.radius=packTree(c));c.n=c.p=c;nodes.push(c);}
switch(s.order){case"ascending":nodes.sort(function(a,b){return a.radius-b.radius;});break;case"descending":nodes.sort(function(a,b){return b.radius-a.radius;});break;case"reverse":nodes.reverse();}
return packCircle(nodes);}
function packCircle(nodes){function bound(n){xMin=Math.min(n.x-n.radius,xMin);xMax=Math.max(n.x+n.radius,xMax);yMin=Math.min(n.y-n.radius,yMin);yMax=Math.max(n.y+n.radius,yMax);}
function insert(a,b){var c=a.n;a.n=b;b.p=a;b.n=c;c.p=b;}
function splice(a,b){a.n=b;b.p=a;}
function intersects(a,b){var dx=b.x-a.x,dy=b.y-a.y,dr=a.radius+b.radius;return dr*dr-dx*dx-dy*dy>.001;}
var a,b,c,j,k,xMin=1/0,xMax=-1/0,yMin=1/0,yMax=-1/0;a=nodes[0];a.x=-a.radius;a.y=0;bound(a);if(nodes.length>1){b=nodes[1];b.x=b.radius;b.y=0;bound(b);if(nodes.length>2){c=nodes[2];place(a,b,c);bound(c);insert(a,c);a.p=c;insert(c,b);b=a.n;for(var i=3;i<nodes.length;i++){place(a,b,c=nodes[i]);var isect=0,s1=1,s2=1;for(j=b.n;j!=b;j=j.n,s1++)if(intersects(j,c)){isect=1;break;}
if(1==isect)for(k=a.p;k!=j.p;k=k.p,s2++)if(intersects(k,c)){if(s2<s1){isect=-1;j=k;}
break;}
if(0==isect){insert(a,c);b=c;bound(c);}else if(isect>0){splice(a,j);b=j;i--;}else if(isect<0){splice(j,b);a=j;i--;}}}}
for(var cx=(xMin+xMax)/2,cy=(yMin+yMax)/2,cr=0,i=0;i<nodes.length;i++){var n=nodes[i];n.x-=cx;n.y-=cy;cr=Math.max(cr,n.radius+Math.sqrt(n.x*n.x+n.y*n.y));}
return cr+s.spacing;}
function place(a,b,c){var da=b.radius+c.radius,db=a.radius+c.radius,dx=b.x-a.x,dy=b.y-a.y,dc=Math.sqrt(dx*dx+dy*dy),cos=(db*db+dc*dc-da*da)/(2*db*dc),theta=Math.acos(cos),x=cos*db,h=Math.sin(theta)*db;dx/=dc;dy/=dc;c.x=a.x+x*dx+h*dy;c.y=a.y+x*dy-h*dx;}
function transform(n,x,y,k){for(var c=n.firstChild;c;c=c.nextSibling){c.x+=n.x;c.y+=n.y;transform(c,x,y,k);}
n.x=x+k*n.x;n.y=y+k*n.y;n.radius*=k;}
if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,s)){var that=this,nodes=s.nodes,root=nodes[0];!function(nodes){var stack=pv.Mark.stack;stack.unshift(null);for(var i=0,n=nodes.length;i<n;i++){var c=nodes[i];c.firstChild||(c.radius=that.$radius.apply(that,(stack[0]=c,stack)));}
stack.shift();}(nodes);root.x=0;root.y=0;root.radius=packTree(root);var w=this.width(),h=this.height();transform(root,w/2,h/2,1/Math.max(2*root.radius/w,2*root.radius/h));}};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(d,p){return 1.5*Math.sqrt(p.linkValue);});this.label.textAlign("center");};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=new pv.Layout.Force().extend(pv.Layout.Network.prototype.defaults).dragConstant(.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(.9).springConstant(.1).springDamping(.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(s){function speed(n){return n.fix?1:n.vx*n.vx+n.vy*n.vy;}
if(pv.Layout.Network.prototype.buildImplied.call(this,s)){var f=s.$force;if(f){f.next=this.binds.$force;this.binds.$force=f;}}else{for(var n,that=this,nodes=s.nodes,links=s.links,k=s.iterations,w=s.width,h=s.height,i=0;i<nodes.length;i++){n=nodes[i];isNaN(n.x)&&(n.x=w/2+40*Math.random()-20);isNaN(n.y)&&(n.y=h/2+40*Math.random()-20);}
var sim=pv.simulation(nodes);sim.force(pv.Force.drag(s.dragConstant));sim.force(pv.Force.charge(s.chargeConstant).domain(s.chargeMinDistance,s.chargeMaxDistance).theta(s.chargeTheta));sim.force(pv.Force.spring(s.springConstant).damping(s.springDamping).length(s.springLength).links(links));sim.constraint(pv.Constraint.position());s.bound&&sim.constraint(pv.Constraint.bound().x(6,w-6).y(6,h-6));if(null==k){sim.step();sim.step();s.$force=this.binds.$force={next:this.binds.$force,nodes:nodes,min:1e-4*(links.length+1),sim:sim};this.$timer||(this.$timer=setInterval(function(){for(var render=!1,f=that.binds.$force;f;f=f.next)if(pv.max(f.nodes,speed)>f.min){f.sim.step();render=!0;}
render&&that.render();},42));}else for(var i=0;i<k;i++)sim.step();}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var interpolate,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);interpolate=/^(top|bottom)$/.test(s.orient)?"step-before":/^(left|right)$/.test(s.orient)?"step-after":"linear";};this.link.interpolate(function(){return interpolate;});};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=new pv.Layout.Cluster().extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(s){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,s)){var breadth,depth,root=s.nodes[0],group=s.group,leafCount=0,leafIndex=.5-group/2,p=void 0;root.visitAfter(function(n){if(n.firstChild)n.depth=1+pv.max(n.childNodes,function(n){return n.depth;});else{if(group&&p!=n.parentNode){p=n.parentNode;leafCount+=group;}
leafCount++;n.depth=0;}});breadth=1/leafCount;depth=1/root.depth;var p=void 0;root.visitAfter(function(n){if(n.firstChild)n.breadth=pv.mean(n.childNodes,function(n){return n.breadth;});else{if(group&&p!=n.parentNode){p=n.parentNode;leafIndex+=group;}
n.breadth=breadth*leafIndex++;}
n.depth=1-n.depth*depth;});root.visitAfter(function(n){n.minBreadth=n.firstChild?n.firstChild.minBreadth:n.breadth-breadth/2;n.maxBreadth=n.firstChild?n.lastChild.maxBreadth:n.breadth+breadth/2;});root.visitBefore(function(n){n.minDepth=n.parentNode?n.parentNode.maxDepth:0;n.maxDepth=n.parentNode?n.depth+root.depth:n.minDepth+2*root.depth;});root.minDepth=-depth;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,s);}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this);};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(s){pv.Layout.Cluster.prototype.buildImplied.call(this,s)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,s);};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this);};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=new pv.Layout.Partition().extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1;};pv.Layout.Partition.prototype.size=function(f){this.$size=f;return this;};pv.Layout.Partition.prototype.buildImplied=function(s){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,s)){var that=this,root=s.nodes[0],stack=pv.Mark.stack,maxDepth=0;stack.unshift(null);root.visitAfter(function(n,depth){depth>maxDepth&&(maxDepth=depth);n.size=n.firstChild?pv.sum(n.childNodes,function(n){return n.size;}):that.$size.apply(that,(stack[0]=n,stack));});stack.shift();switch(s.order){case"ascending":root.sort(function(a,b){return a.size-b.size;});break;case"descending":root.sort(function(b,a){return a.size-b.size;});}
root.minBreadth=0;root.breadth=.5;root.maxBreadth=1;root.visitBefore(function(n){for(var b=n.minBreadth,s=n.maxBreadth-b,c=n.firstChild;c;c=c.nextSibling){c.minBreadth=b;b+=c.size/n.size*s;c.maxBreadth=b;c.breadth=(b+c.minBreadth)/2;}});root.visitAfter(function(n,depth){n.minDepth=(depth-1)/maxDepth;n.maxDepth=n.depth=depth/maxDepth;});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,s);}};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this);};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(s){pv.Layout.Partition.prototype.buildImplied.call(this,s)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,s);};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var interpolate,directed,reverse,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);directed=s.directed;interpolate="radial"==s.orient?"linear":"polar";reverse="right"==s.orient||"top"==s.orient;};this.link.data(function(p){var s=p.sourceNode,t=p.targetNode;return reverse!=(directed||s.breadth<t.breadth)?[s,t]:[t,s];}).interpolate(function(){return interpolate;});};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=new pv.Layout.Arc().extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(f){this.$sort=f;return this;};pv.Layout.Arc.prototype.buildImplied=function(s){function midAngle(b){switch(orient){case"top":return-Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return 2*(b-.25)*Math.PI;}}
if(!pv.Layout.Network.prototype.buildImplied.call(this,s)){var nodes=s.nodes,orient=s.orient,sort=this.$sort,index=pv.range(nodes.length),w=s.width,h=s.height,r=Math.min(w,h)/2;sort&&index.sort(function(a,b){return sort(nodes[a],nodes[b]);});for(var i=0;i<nodes.length;i++){var n=nodes[index[i]],b=n.breadth=(i+.5)/nodes.length;n.x=function(b){switch(orient){case"top":case"bottom":return b*w;case"left":return 0;case"right":return w;case"radial":return w/2+r*Math.cos(midAngle(b));}}(b);n.y=function(b){switch(orient){case"top":return 0;case"bottom":return h;case"left":case"right":return b*h;case"radial":return h/2+r*Math.sin(midAngle(b));}}(b);n.midAngle=midAngle(b);}}};pv.Layout.Horizon=function(){pv.Layout.call(this);var bands,mode,size,fill,red,blue,that=this,buildImplied=this.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);bands=s.bands;mode=s.mode;size=Math.round(("color"==mode?.5:1)*s.height);fill=s.backgroundStyle;red=pv.ramp(fill,s.negativeStyle).domain(0,bands);blue=pv.ramp(fill,s.positiveStyle).domain(0,bands);};var bands=new pv.Panel().data(function(){return pv.range(2*bands);}).overflow("hidden").height(function(){return size;}).top(function(i){return"color"==mode?(1&i)*size:0;}).fillStyle(function(i){return i?null:fill;});this.band=new pv.Mark().top(function(d,i){return"mirror"==mode&&1&i?(i+1>>1)*size:null;}).bottom(function(d,i){return"mirror"==mode?1&i?null:(i+1>>1)*-size:(1&i||-1)*(i+1>>1)*size;}).fillStyle(function(d,i){return(1&i?red:blue)(1+(i>>1));});this.band.add=function(type){return that.add(pv.Panel).extend(bands).add(type).extend(this);};};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.fillStyle).property("positiveStyle",pv.fillStyle).property("negativeStyle",pv.fillStyle);pv.Layout.Horizon.prototype.defaults=new pv.Layout.Horizon().extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var nodes,links,that=this,buildImplied=that.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);nodes=s.$rollup.nodes;links=s.$rollup.links;};this.node.data(function(){return nodes;}).shapeSize(function(d){return 20*d.nodes.length;});this.link.interpolate("polar").eccentricity(.8);this.link.add=function(type){return that.add(pv.Panel).data(function(){return links;}).add(type).extend(this);};};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(f){this.$x=pv.functor(f);return this;};pv.Layout.Rollup.prototype.y=function(f){this.$y=pv.functor(f);return this;};pv.Layout.Rollup.prototype.buildImplied=function(s){function id(i){return x[i]+","+y[i];}
if(!pv.Layout.Network.prototype.buildImplied.call(this,s)){var nodes=s.nodes,links=s.links,directed=s.directed,n=nodes.length,x=[],y=[],rnindex=0,rnodes={},rlinks={},stack=pv.Mark.stack,o={parent:this};stack.unshift(null);for(var i=0;i<n;i++){o.index=i;stack[0]=nodes[i];x[i]=this.$x.apply(o,stack);y[i]=this.$y.apply(o,stack);}
stack.shift();for(var i=0;i<nodes.length;i++){var nodeId=id(i),rn=rnodes[nodeId];if(!rn){rn=rnodes[nodeId]=Object.create(nodes[i]);rn.index=rnindex++;rn.x=x[i];rn.y=y[i];rn.nodes=[];}
rn.nodes.push(nodes[i]);}
for(var i=0;i<links.length;i++){var source=links[i].sourceNode,target=links[i].targetNode,rsource=rnodes[id(source.index)],rtarget=rnodes[id(target.index)],reverse=!directed&&rsource.index>rtarget.index,linkId=reverse?rtarget.index+","+rsource.index:rsource.index+","+rtarget.index,rl=rlinks[linkId];rl||(rl=rlinks[linkId]={sourceNode:rsource,targetNode:rtarget,linkValue:0,links:[]});rl.links.push(links[i]);rl.linkValue+=links[i].linkValue;}
s.$rollup={nodes:pv.values(rnodes),links:pv.values(rlinks)};}};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var n,dx,dy,labels,pairs,that=this,buildImplied=that.buildImplied;this.buildImplied=function(s){buildImplied.call(this,s);n=s.nodes.length;dx=s.width/n;dy=s.height/n;labels=s.$matrix.labels;pairs=s.$matrix.pairs;};this.link.data(function(){return pairs;}).left(function(){return dx*(this.index%n);}).top(function(){return dy*Math.floor(this.index/n);}).width(function(){return dx;}).height(function(){return dy;}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(l){return l.linkValue?"#555":"#eee";}).parent=this;delete this.link.add;this.label.data(function(){return labels;}).left(function(){return 1&this.index?dx*(.5+(this.index>>1)):0;}).top(function(){return 1&this.index?0:dy*(.5+(this.index>>1));}).textMargin(4).textAlign(function(){return 1&this.index?"left":"right";}).textAngle(function(){return 1&this.index?-Math.PI/2:0;});delete this.node;};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(f){this.$sort=f;return this;};pv.Layout.Matrix.prototype.buildImplied=function(s){if(!pv.Layout.Network.prototype.buildImplied.call(this,s)){var nodes=s.nodes,links=s.links,sort=this.$sort,n=nodes.length,index=pv.range(n),labels=[],pairs=[],map={};s.$matrix={labels:labels,pairs:pairs};sort&&index.sort(function(a,b){return sort(nodes[a],nodes[b]);});for(var i=0;i<n;i++)for(var j=0;j<n;j++){var a=index[i],b=index[j],p={row:i,col:j,sourceNode:nodes[a],targetNode:nodes[b],linkValue:0};pairs.push(map[a+"."+b]=p);}
for(var i=0;i<n;i++){var a=index[i];labels.push(nodes[a],nodes[a]);}
for(var i=0;i<links.length;i++){var l=links[i],source=l.sourceNode.index,target=l.targetNode.index,value=l.linkValue;map[source+"."+target].linkValue+=value;s.directed||(map[target+"."+source].linkValue+=value);}}};pv.Layout.Bullet=function(){pv.Layout.call(this);var orient,horizontal,rangeColor,measureColor,x,that=this,buildImplied=that.buildImplied,scale=that.x=pv.Scale.linear();this.buildImplied=function(s){buildImplied.call(this,x=s);orient=s.orient;horizontal=/^left|right$/.test(orient);rangeColor=pv.ramp("#bbb","#eee").domain(0,Math.max(1,x.ranges.length-1));measureColor=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,x.measures.length-1));};(this.range=new pv.Mark()).data(function(){return x.ranges;}).reverse(!0).left(function(){return"left"==orient?0:null;}).top(function(){return"top"==orient?0:null;}).right(function(){return"right"==orient?0:null;}).bottom(function(){return"bottom"==orient?0:null;}).width(function(d){return horizontal?scale(d):null;}).height(function(d){return horizontal?null:scale(d);}).fillStyle(function(){return rangeColor(this.index);}).antialias(!1).parent=that;(this.measure=new pv.Mark()).extend(this.range).data(function(){return x.measures;}).left(function(){return"left"==orient?0:horizontal?null:this.parent.width()/3.25;}).top(function(){return"top"==orient?0:horizontal?this.parent.height()/3.25:null;}).right(function(){return"right"==orient?0:horizontal?null:this.parent.width()/3.25;}).bottom(function(){return"bottom"==orient?0:horizontal?this.parent.height()/3.25:null;}).fillStyle(function(){return measureColor(this.index);}).parent=that;(this.marker=new pv.Mark()).data(function(){return x.markers;}).left(function(d){return"left"==orient?scale(d):horizontal?null:this.parent.width()/2;}).top(function(d){return"top"==orient?scale(d):horizontal?this.parent.height()/2:null;}).right(function(d){return"right"==orient?scale(d):null;}).bottom(function(d){return"bottom"==orient?scale(d):null;}).strokeStyle("black").shape("bar").shapeAngle(function(){return horizontal?0:Math.PI/2;}).parent=that;(this.tick=new pv.Mark()).data(function(){return scale.ticks(7);}).left(function(d){return"left"==orient?scale(d):null;}).top(function(d){return"top"==orient?scale(d):null;}).right(function(d){return"right"==orient?scale(d):horizontal?null:-6;}).bottom(function(d){return"bottom"==orient?scale(d):horizontal?-8:null;}).height(function(){return horizontal?6:null;}).width(function(){return horizontal?null:6;}).parent=that;};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("minimum").property("maximum");pv.Layout.Bullet.prototype.defaults=new pv.Layout.Bullet().extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype._originIsZero=!0;pv.Layout.Bullet.prototype.originIsZero=function(value){return arguments.length?this._originIsZero=!!value:this._originIsZero;};pv.Layout.Bullet.prototype.buildImplied=function(s){pv.Layout.prototype.buildImplied.call(this,s);var allValues,size=this.parent[/^left|right$/.test(s.orient)?"width":"height"](),max=s.maximum,min=s.minimum;if(null==max){allValues=[].concat(s.ranges,s.markers,s.measures);max=pv.max(allValues);}else max=+max;if(null==min){allValues||(allValues=[].concat(s.ranges,s.markers,s.measures));min=pv.min(allValues);min*=.95;}else min=+min;(min>max||max-min<1e-10)&&(min=Math.abs(max)<1e-10?-.1:.99*max);this._originIsZero&&min*max>0&&(min>0?min=0:max=0);s.minimum=min;s.maximum=max;this.x.domain(min,max).range(0,size);};pv.Behavior={};pv.Behavior.dragBase=function(shared){function mousedown(d){if(!inited){inited=!0;this.addEventInterceptor("click",eventInterceptor,!0);}
if(!events){var root=this.root.scene.$g;events=[[root,"mousemove",pv.listen(root,"mousemove",mousemove)],[root,"mouseup",pv.listen(root,"mouseup",mouseup)],[document,"mousemove",pv.listen(document,"mousemove",mousemove)],[document,"mouseup",pv.listen(document,"mouseup",mouseup)]];}
var ev=arguments[arguments.length-1];downElem=ev.target;cancelClick=!1;ev.stopPropagation();var m1=this.mouse(),scene=this.scene,index=this.index;drag=scene[index].drag={phase:"start",m:m1,m1:m1,m2:null,d:d,scene:scene,index:index};ev=wrapEvent(ev,drag);shared.dragstart.call(this,ev);var m=drag.m;if(m!==m1){m1.x=m.x;m1.y=m.y;}}
function mousemove(ev){if(drag){drag.phase="move";ev.stopPropagation();ev=wrapEvent(ev,drag);var scene=drag.scene;scene.mark.context(scene,drag.index,function(){var mprev=drag.m2||drag.m1,m2=this.mouse();if(!(mprev&&m2.distance2(mprev).dist2<=2)){drag.m=drag.m2=m2;shared.drag.call(this,ev);var m=drag.m;if(m!==m2){m2.x=m.x;m2.y=m.y;}}});}}
function mouseup(ev){if(drag){drag.phase="end";var m2=drag.m2,isDrag=m2&&drag.m1.distance2(m2).dist2>.1;drag.canceled=!isDrag;cancelClick=isDrag&&downElem===ev.target;cancelClick||(downElem=null);ev.stopPropagation();ev=wrapEvent(ev,drag);if(events){events.forEach(function(registration){pv.unlisten.apply(pv,registration);});events=null;}
var scene=drag.scene,index=drag.index;try{scene.mark.context(scene,index,function(){shared.dragend.call(this,ev);});}finally{drag=null;delete scene[index].drag;}}}
function wrapEvent(ev,drag){try{ev.drag=drag;return ev;}catch(ex){}
var ev2={};for(var p in ev){var v=ev[p];ev2[p]="function"!=typeof v?v:bindEventFun(v,ev);}
ev2._sourceEvent=ev;return ev2;}
function bindEventFun(f,ctx){return function(){return f.apply(ctx,arguments);};}
function eventInterceptor(type,ev){if(cancelClick&&downElem===ev.target){cancelClick=!1;downElem=null;return!1;}}
var events,downElem,cancelClick,inited,drag;shared.autoRender=!0;shared.positionConstraint=null;shared.bound=function(v,a_p){return Math.max(drag.min[a_p],Math.min(drag.max[a_p],v));};mousedown.autoRender=function(_){if(arguments.length){shared.autoRender=!!_;return mousedown;}
return shared.autoRender;};mousedown.positionConstraint=function(_){if(arguments.length){shared.positionConstraint=_;return mousedown;}
return shared.positionConstraint;};return mousedown;};pv.Behavior.drag=function(){var v1,collapse=null,kx=1,ky=1,shared={dragstart:function(ev){var drag=ev.drag;drag.type="drag";var p=drag.d,fix=pv.vector(p.x,p.y);p.fix=fix;p.drag=drag;v1=fix.minus(drag.m1);var parent=this.parent;drag.max={x:parent.width()-(p.dx||0),y:parent.height()-(p.dy||0)};drag.min={x:0,y:0};shared.autoRender&&this.render();pv.Mark.dispatch("dragstart",drag.scene,drag.index,ev);},drag:function(ev){var drag=ev.drag,m2=drag.m2,p=drag.d;drag.m=v1.plus(m2);var constraint=shared.positionConstraint;constraint&&constraint(drag);var m=drag.m;kx&&(p.x=p.fix.x=shared.bound(m.x,"x"));ky&&(p.y=p.fix.y=shared.bound(m.y,"y"));shared.autoRender&&this.render();pv.Mark.dispatch("drag",drag.scene,drag.index,ev);},dragend:function(ev){var drag=ev.drag,p=drag.d;p.fix=null;v1=null;shared.autoRender&&this.render();try{pv.Mark.dispatch("dragend",drag.scene,drag.index,ev);}finally{delete p.drag;}}},mousedown=pv.Behavior.dragBase(shared);mousedown.collapse=function(x){if(arguments.length){collapse=String(x);switch(collapse){case"y":kx=1;ky=0;break;case"x":kx=0;ky=1;break;default:kx=1;ky=1;}
return mousedown;}
return collapse;};return mousedown;};pv.Behavior.point=function(keyArgs){function searchSceneChildren(scene,curr){if(scene.visible)for(var i=scene.children.length-1;i>=0;i--)if(searchScenes(scene.children[i],curr))return!0;}
function searchScenes(scenes,curr){var result,j,isPointingBarrier,mark=scenes.mark,isPanel="panel"===mark.type;if(mark.$handlers.point){var visibility,mouse=(isPanel&&mark.parent||mark).mouse(),markRMax=mark._pointingRadiusMax,markCostMax=markRMax*markRMax;j=scenes.length;for(;j--;)if((visibility=sceneVisibility(scenes,j))&&evalScene(scenes,j,mouse,curr,visibility,markCostMax)){result=!0;break;}}
if(isPanel){mark.scene=scenes;isPointingBarrier=!(!mark.isPointingBarrier||!mark.parent);try{j=scenes.length;for(;j--;){mark.index=j;if((!isPointingBarrier||mark.getShape(scenes,j).containsPoint(mark.parent.mouse()))&&searchSceneChildren(scenes[j],curr))return!0;}}finally{delete mark.scene;delete mark.index;}}
return result;}
function sceneVisibility(scenes,index){var s=scenes[index];if(!s.visible)return 0;if(!painted)return 1;var ps=scenes.mark.properties;if(!ps.fillStyle&&!ps.strokeStyle)return 1;var o1=s.fillStyle?s.fillStyle.opacity:0,o2=s.strokeStyle?s.strokeStyle.opacity:0,o=Math.max(o1,o2);return o<.02?0:o>.98?1:.5;}
function evalScene(scenes,index,mouse,curr,visibility,markCostMax){var cand,shape=scenes.mark.getShape(scenes,index),hasArea=shape.hasArea(),inside=shape.containsPoint(mouse,k)?!collapse||shape.containsPoint(mouse)?2:1:0,applyMarkCostMax=isFinite(markCostMax)&&inside<2,choice=function(){if(applyMarkCostMax&&markCostMax<=0)return-1;cand=shape.distance2(mouse,k);if(applyMarkCostMax&&pv.floatLess(markCostMax,cand.cost))return-2;if(finiteDist2Max&&!inside&&pv.floatLess(dist2Max,cand.dist2))return-3;if(hasArea===curr.hasArea){if(inside<curr.inside)return-4;if(inside>curr.inside)return 1;}else{if(collapse){if(!inside&&curr.inside)return-5;if(inside&&!curr.inside)return 2;}
if(hasArea||2!==curr.inside){if(hasArea&&2===inside){if(2===curr.inside)return-7;if(0===curr.inside&&pv.floatLess(3,curr.cost))return 4;}}else{if(2===inside)return 3;if(0===inside&&pv.floatLess(3,cand.cost))return-6;}}
if(!collapse||!inside){if(pv.floatLess(curr.dist2,cand.dist2))return-8;if(pv.floatLess(cand.dist2,curr.dist2))return 5;}
return collapse&&pv.floatLess(cand.cost,curr.cost)?6:-9;}();DEBUG&&function(){if(choice<-3||choice>0){var pointMark=scenes&&scenes.mark;console.log("POINT "+(choice>0?"choose":"skip")+" ("+choice+") "+(pointMark?pointMark.type+" "+index:"none")+" in="+inside+" d2="+(cand&&cand.dist2)+" cost="+(cand&&cand.cost)+" opaq="+(1===visibility));}}();if(choice>0){curr.hasArea=hasArea;curr.inside=inside;curr.dist2=cand.dist2;curr.cost=cand.cost;curr.scenes=scenes;curr.index=index;curr.shape=shape;if(hasArea&&2===inside&&1===visibility)return!0;}}
function mousemove(){var e=pv.event;DEBUG&&console.log("POINT MOUSE MOVE BEG");try{var point={cost:1/0,dist2:1/0,inside:0,hasArea:!1,x:e.pageX||0,y:e.pageY||0};if(unpoint&&radiusHyst2&&pv.Shape.dist2(point,unpoint).cost<radiusHyst2)return;searchSceneChildren(this.scene[this.index],point);point.inside||isFinite(point.cost)||(point=null);e.pointFrom=unpoint;e.pointTo=point;if(unpoint){if(point&&unpoint.scenes==point.scenes&&unpoint.index==point.index)return;e.isPointSwitch=!!point;pv.Mark.dispatch("unpoint",unpoint.scenes,unpoint.index,e);}
unpoint=point;if(point){pv.Mark.dispatch("point",point.scenes,point.index,e);if(pointingPanel);else if("panel"===this.type){pointingPanel=this;this.event("mouseout",function(){mouseout.call(this.scene.$g);});stealClick&&pointingPanel.addEventInterceptor("click",eventInterceptor);}else pv.listen(this.root.canvas(),"mouseout",mouseout);}}finally{DEBUG&&console.log("POINT MOUSE MOVE END");}}
function mouseout(){var e=pv.event;if(unpoint&&!pv.ancestor(this,e.relatedTarget)){pv.Mark.dispatch("unpoint",unpoint.scenes,unpoint.index,e);unpoint=null;}}
function eventInterceptor(type,ev){if(unpoint){var scenes=unpoint.scenes,handler=scenes.mark.$handlers[type];if(handler)return[handler,scenes,unpoint.index,ev];}}"object"!=typeof keyArgs&&(keyArgs={radius:keyArgs});var unpoint,DEBUG=0,collapse=null,painted=!!pv.get(keyArgs,"painted",!1),stealClick=!!pv.get(keyArgs,"stealClick",!1),k={x:1,y:1},pointingPanel=null,dist2Max=function(){var r=pv.parseNumNonNeg(pv.get(keyArgs,"radius"),30);return r*r;}(),finiteDist2Max=isFinite(dist2Max),radiusHyst2=function(){var r=pv.parseNumNonNeg(pv.get(keyArgs,"radiusHyst"),0);isFinite(r)||(r=4);return r*r;}();mousemove.collapse=function(x){if(arguments.length){collapse=String(x);switch(collapse){case"y":k.x=1;k.y=0;break;case"x":k.x=0;k.y=1;break;default:k.x=1;k.y=1;collapse=null;}
return mousemove;}
return collapse;};keyArgs&&null!=keyArgs.collapse&&mousemove.collapse(keyArgs.collapse);keyArgs=null;return mousemove;};pv.Behavior.select=function(){var collapse=null,kx=1,ky=1,preserveLength=!1,shared={dragstart:function(ev){var drag=ev.drag;drag.type="select";drag.dxmin=0;drag.dymin=0;var r=drag.d;r.drag=drag;drag.max={x:this.width(),y:this.height()};drag.min={x:0,y:0};var constraint=shared.positionConstraint;if(constraint){drag.m=drag.m.clone();constraint(drag);}
var m=drag.m;if(kx){r.x=shared.bound(m.x,"x");preserveLength||(r.dx=Math.max(0,drag.dxmin));}
if(ky){r.y=shared.bound(m.y,"y");preserveLength||(r.dy=Math.max(0,drag.dymin));}
pv.Mark.dispatch("selectstart",drag.scene,drag.index,ev);},drag:function(ev){var drag=ev.drag,m1=drag.m1,r=drag.d;drag.max.x=this.width();drag.max.y=this.height();var constraint=shared.positionConstraint;if(constraint){drag.m=drag.m.clone();constraint(drag);}
var m=drag.m;if(kx){var bx=Math.min(m1.x,m.x);bx=shared.bound(bx,"x");r.x=bx;if(!preserveLength){var ex=Math.max(m.x,m1.x);ex=shared.bound(ex,"x");r.dx=Math.max(0,drag.dxmin,ex-bx);}}
if(ky){var by=Math.min(m1.y,m.y);by=shared.bound(by,"y");r.y=by;if(!preserveLength){var ey=Math.max(m.y,m1.y);ey=shared.bound(ey,"y");r.dy=Math.max(0,drag.dymin,ey-by);}}
shared.autoRender&&this.render();pv.Mark.dispatch("select",drag.scene,drag.index,ev);},dragend:function(ev){var drag=ev.drag;try{pv.Mark.dispatch("selectend",drag.scene,drag.index,ev);}finally{delete drag.d.drag;}}},mousedown=pv.Behavior.dragBase(shared);mousedown.collapse=function(x){if(arguments.length){collapse=String(x);switch(collapse){case"y":kx=1;ky=0;break;case"x":kx=0;ky=1;break;default:kx=1;ky=1;}
return mousedown;}
return collapse;};mousedown.preserveLength=function(_){if(arguments.length){preserveLength=!!_;return mousedown;}
return preserveLength;};return mousedown;};pv.Behavior.resize=function(side){var preserveOrtho=!1,isLeftRight="left"===side||"right"===side,shared={dragstart:function(ev){var drag=ev.drag;drag.type="resize";var m1=drag.m1,r=drag.d;r.drag=drag;switch(side){case"left":m1.x=r.x+r.dx;break;case"right":m1.x=r.x;break;case"top":m1.y=r.y+r.dy;break;case"bottom":m1.y=r.y;}
var parent=this.parent;drag.max={x:parent.width(),y:parent.height()};drag.min={x:0,y:0};pv.Mark.dispatch("resizestart",drag.scene,drag.index,ev);},drag:function(ev){var drag=ev.drag,m1=drag.m1,constraint=shared.positionConstraint;if(constraint){drag.m=drag.m.clone();constraint(drag);}
var m=drag.m,r=drag.d;if(!preserveOrtho||isLeftRight){var bx=Math.min(m1.x,m.x),ex=Math.max(m.x,m1.x);bx=shared.bound(bx,"x");ex=shared.bound(ex,"x");r.x=bx;r.dx=ex-bx;}
if(!preserveOrtho||!isLeftRight){var by=Math.min(m1.y,m.y),ey=Math.max(m.y,m1.y);by=shared.bound(by,"y");ey=shared.bound(ey,"y");r.y=by;r.dy=ey-by;}
shared.autoRender&&this.render();pv.Mark.dispatch("resize",drag.scene,drag.index,ev);},dragend:function(ev){var drag=ev.drag;drag.max=null;try{pv.Mark.dispatch("resizeend",drag.scene,drag.index,ev);}finally{delete drag.d.drag;}}},mousedown=pv.Behavior.dragBase(shared);mousedown.preserveOrtho=function(_){if(arguments.length){preserveOrtho=!!_;return mousedown;}
return preserveOrtho;};return mousedown;};pv.Behavior.pan=function(){function mousedown(){index=this.index;scene=this.scene;v1=pv.vector(pv.event.pageX,pv.event.pageY);m1=this.transform();k=1/(m1.k*this.scale);bound&&(bound={x:(1-m1.k)*this.width(),y:(1-m1.k)*this.height()});}
function mousemove(e){if(scene){scene.mark.context(scene,index,function(){var x=(pv.event.pageX-v1.x)*k,y=(pv.event.pageY-v1.y)*k,m=m1.translate(x,y);if(bound){m.x=Math.max(bound.x,Math.min(0,m.x));m.y=Math.max(bound.y,Math.min(0,m.y));}
this.transform(m).render();});pv.Mark.dispatch("pan",scene,index,e);}}
function mouseup(){scene=null;}
var scene,index,m1,v1,k,bound;mousedown.bound=function(x){if(arguments.length){bound=Boolean(x);return this;}
return Boolean(bound);};pv.listen(window,"mousemove",mousemove);pv.listen(window,"mouseup",mouseup);return mousedown;};pv.Behavior.zoom=function(speed){function mousewheel(e){var v=this.mouse(),k=pv.event.wheel*speed,m=this.transform().translate(v.x,v.y).scale(k<0?1e3/(1e3-k):(1e3+k)/1e3).translate(-v.x,-v.y);if(bound){m.k=Math.max(1,m.k);m.x=Math.max((1-m.k)*this.width(),Math.min(0,m.x));m.y=Math.max((1-m.k)*this.height(),Math.min(0,m.y));}
this.transform(m).render();pv.Mark.dispatch("zoom",this.scene,this.index,e);}
var bound;arguments.length||(speed=1/48);mousewheel.bound=function(x){if(arguments.length){bound=Boolean(x);return this;}
return Boolean(bound);};return mousewheel;};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(latlng){return{x:latlng.lng/180,y:latlng.lat>85?1:latlng.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(latlng.lat)/2))/Math.PI};},invert:function(xy){return{lng:180*xy.x,lat:pv.degrees(2*Math.atan(Math.exp(xy.y*Math.PI))-Math.PI/2)};}},"gall-peters":{project:function(latlng){return{x:latlng.lng/180,y:Math.sin(pv.radians(latlng.lat))};},invert:function(xy){return{lng:180*xy.x,lat:pv.degrees(Math.asin(xy.y))};}},sinusoidal:{project:function(latlng){return{x:pv.radians(latlng.lng)*Math.cos(pv.radians(latlng.lat))/Math.PI,y:latlng.lat/90};},invert:function(xy){return{lng:pv.degrees(xy.x*Math.PI/Math.cos(xy.y*Math.PI/2)),lat:90*xy.y};}},aitoff:{project:function(latlng){var l=pv.radians(latlng.lng),f=pv.radians(latlng.lat),a=Math.acos(Math.cos(f)*Math.cos(l/2));return{x:2*(a?Math.cos(f)*Math.sin(l/2)*a/Math.sin(a):0)/Math.PI,y:2*(a?Math.sin(f)*a/Math.sin(a):0)/Math.PI};},invert:function(xy){var x=xy.x*Math.PI/2,y=xy.y*Math.PI/2;return{lng:pv.degrees(x/Math.cos(y)),lat:pv.degrees(y)};}},hammer:{project:function(latlng){var l=pv.radians(latlng.lng),f=pv.radians(latlng.lat),c=Math.sqrt(1+Math.cos(f)*Math.cos(l/2));return{x:2*Math.SQRT2*Math.cos(f)*Math.sin(l/2)/c/3,y:Math.SQRT2*Math.sin(f)/c/1.5};},invert:function(xy){var x=3*xy.x,y=1.5*xy.y,z=Math.sqrt(1-x*x/16-y*y/4);return{lng:pv.degrees(2*Math.atan2(z*x,2*(2*z*z-1))),lat:pv.degrees(Math.asin(z*y))};}},identity:{project:function(latlng){return{x:latlng.lng/180,y:latlng.lat/90};},invert:function(xy){return{lng:180*xy.x,lat:90*xy.y};}}};pv.Geo.scale=function(p){function scale(latlng){if(!lastLatLng||latlng.lng!=lastLatLng.lng||latlng.lat!=lastLatLng.lat){lastLatLng=latlng;var p=project(latlng);lastPoint={x:x(p.x),y:y(p.y)};}
return lastPoint;}
function project(latlng){var offset={lng:latlng.lng-c.lng,lat:latlng.lat};return j.project(offset);}
function invert(xy){var latlng=j.invert(xy);latlng.lng+=c.lng;return latlng;}
var lastLatLng,lastPoint,rmin={x:0,y:0},rmax={x:1,y:1},d=[],j=pv.Geo.projections.identity,x=pv.Scale.linear(-1,1).range(0,1),y=pv.Scale.linear(-1,1).range(1,0),c={lng:0,lat:0};scale.x=function(latlng){return scale(latlng).x;};scale.y=function(latlng){return scale(latlng).y;};scale.ticks={lng:function(m){var lat,lng;if(d.length>1){var s=pv.Scale.linear();void 0==m&&(m=10);lat=s.domain(d,function(d){return d.lat;}).ticks(m);lng=s.domain(d,function(d){return d.lng;}).ticks(m);}else{lat=pv.range(-80,81,10);lng=pv.range(-180,181,10);}
return lng.map(function(lng){return lat.map(function(lat){return{lat:lat,lng:lng};});});},lat:function(m){return pv.transpose(scale.ticks.lng(m));}};scale.invert=function(p){return invert({x:x.invert(p.x),y:y.invert(p.y)});};scale.domain=function(array,f){if(arguments.length){d=array instanceof Array?arguments.length>1?pv.map(array,f):array:Array.prototype.slice.call(arguments);if(d.length>1){var lngs=d.map(function(c){return c.lng;}),lats=d.map(function(c){return c.lat;});c={lng:(pv.max(lngs)+pv.min(lngs))/2,lat:(pv.max(lats)+pv.min(lats))/2};var n=d.map(project);x.domain(n,function(p){return p.x;});y.domain(n,function(p){return p.y;});}else{c={lng:0,lat:0};x.domain(-1,1);y.domain(-1,1);}
lastLatLng=null;return this;}
return d;};scale.range=function(min,max){if(arguments.length){if("object"==typeof min){rmin={x:Number(min.x),y:Number(min.y)};rmax={x:Number(max.x),y:Number(max.y)};}else{rmin={x:0,y:0};rmax={x:Number(min),y:Number(max)};}
x.range(rmin.x,rmax.x);y.range(rmax.y,rmin.y);lastLatLng=null;return this;}
return[rmin,rmax];};scale.projection=function(p){if(arguments.length){j="string"==typeof p?pv.Geo.projections[p]||pv.Geo.projections.identity:p;return this.domain(d);}
return p;};pv.copyOwn(scale,pv.Scale.common);arguments.length&&scale.projection(p);return scale;};return pv;});
pen.define("cdf-legacy/lib/CCC/protovis-msie",["cdf-legacy/lib/CCC/protovis"],function(pv){pv.have_SVG=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);pv.have_VML=function(d,a,b){a=d.createElement("div");a.innerHTML='<pvml:shape adj="1" />';b=a.firstChild;b.style.behavior="url(#default#VML)";return!b||"object"==typeof b.adj;}(document);!pv.have_SVG&&pv.have_VML&&function(){"function"!=typeof Date.now&&(Date.now=function(){return 1*new Date();});var vml={is64Bit:"x64"===window.navigator.cpuClass,round:function(n){return Math.round(21.6*(n||0));},styles:null,pre:"<pvml:",post:' class="msvml">',block:{group:1,shape:1,shapetype:1,line:1,polyline:1,curve:1,rect:1,roundrect:1,oval:1,arc:1,image:1},caps:{butt:"flat",round:"round",square:"square"},joins:{bevel:"bevel",round:"round",miter:"miter"},cursorstyles:{hand:"pointer",crosshair:1,pointer:1,move:1,text:1,wait:1,help:1,progress:1,"n-resize":1,"ne-resize":1,"nw-resize":1,"s-resize":1,"se-resize":1,"sw-resize":1,"e-resize":1,"w-resize":1},text_shim:null,text_dims:function(text,font){var shim=vml.text_shim||(vml.init(),vml.text_shim);shim.style.font=vml.processFont(font);shim.innerText=text;return{height:shim.offsetHeight,width:shim.offsetWidth};},_fontCache:{},_fontSubst:{default:"Arial","sans-serif":"Arial",sansserif:"Arial",sans:"Arial",serif:"Times New Roman",dialog:"Arial",monospaced:"Courier New",dialoginput:"Courier New"},_fontWhiteListIE64Bit:{"agency fb":1,aharoni:1,algerian:1,andalus:1,"angsana new":1,angsanaupc:1,aparajita:1,"arabic typesetting":1,arial:1,"arial black":1,"arial narrow":1,"arial rounded mt bold":1,"arial unicode ms":1,"baskerville old face":1,batang:1,batangche:1,"bauhaus 93":1,"bell mt":1,"berlin sans fb":1,"berlin sans fb demi":1,"bernard mt condensed":1,"blackadder itc":1,"bodoni mt":1,"bodoni mt black":1,"bodoni mt condensed":1,"bodoni mt poster compressed":1,"book antiqua":1,"bookman old style":1,"bookshelf symbol 7":1,"bradley hand itc":1,"britannic bold":1,broadway:1,"browallia new":1,browalliaupc:1,"brush script mt":1,calibri:1,"californian fb":1,"calisto mt":1,cambria:1,"cambria math":1,candara:1,castellar:1,centaur:1,century:1,"century gothic":1,"century schoolbook":1,chiller:1,"colonna mt":1,"comic sans ms":1,consolas:1,constantia:1,"cooper black":1,"copperplate gothic bold":1,"copperplate gothic light":1,corbel:1,"cordia new":1,cordiaupc:1,"courier new":1,"curlz mt":1,daunpenh:1,david:1,"dfkai-sb":1,dilleniaupc:1,dokchampa:1,dotum:1,dotumche:1,ebrima:1,"edwardian script itc":1,elephant:1,"engravers mt":1,"eras bold itc":1,"eras demi itc":1,"eras light itc":1,"eras medium itc":1,"estrangelo edessa":1,eucrosiaupc:1,euphemia:1,fangsong:1,"felix titling":1,"footlight mt light":1,forte:1,"franklin gothic book":1,"franklin gothic demi":1,"franklin gothic demi cond":1,"franklin gothic heavy":1,"franklin gothic medium":1,"franklin gothic medium cond":1,frankruehl:1,freesiaupc:1,"freestyle script":1,"french script mt":1,gabriola:1,garamond:1,gautami:1,georgia:1,gigi:1,"gill sans mt":1,"gill sans mt condensed":1,"gill sans mt ext condensed bold":1,"gill sans ultra bold":1,"gill sans ultra bold condensed":1,gisha:1,"gloucester mt extra condensed":1,"goudy old style":1,"goudy stout":1,gulim:1,gulimche:1,gungsuh:1,gungsuhche:1,"guttman adii":1,"guttman adii-light":1,"guttman aharoni":1,"guttman calligraphic":1,"guttman david":1,"guttman drogolin":1,"guttman frank":1,"guttman frnew":1,"guttman haim":1,"guttman haim-condensed":1,"guttman hatzvi":1,"guttman hodes":1,"guttman kav":1,"guttman kav-light":1,"guttman keren":1,"guttman logo1":1,"guttman mantova":1,"guttman mantova-decor":1,"guttman miryam":1,"guttman myamfix":1,"guttman rashi":1,"guttman stam":1,"guttman stam1":1,"guttman vilna":1,"guttman yad":1,"guttman yad-brush":1,"guttman yad-light":1,"guttman-aharoni":1,"guttman-aram":1,"guttman-courmir":1,"guttman-soncino":1,"guttman-toledo":1,haettenschweiler:1,"harlow solid italic":1,harrington:1,"high tower text":1,impact:1,"imprint mt shadow":1,"informal roman":1,irisupc:1,"iskoola pota":1,jasmineupc:1,jokerman:1,"juice itc":1,kaiti:1,kalinga:1,kartika:1,"khmer ui":1,kodchiangupc:1,kokila:1,"kristen itc":1,"kunstler script":1,"lao ui":1,latha:1,leelawadee:1,"levenim mt":1,lilyupc:1,"lucida bright":1,"lucida calligraphy":1,"lucida console":1,"lucida fax":1,"lucida handwriting":1,"lucida sans":1,"lucida sans typewriter":1,"lucida sans unicode":1,magneto:1,"maiandra gd":1,"malgun gothic":1,mangal:1,marlett:1,"matura mt script capitals":1,meiryo:1,"meiryo ui":1,"microsoft himalaya":1,"microsoft jhenghei":1,"microsoft new tai lue":1,"microsoft phagspa":1,"microsoft sans serif":1,"microsoft tai le":1,"microsoft uighur":1,"microsoft yahei":1,"microsoft yi baiti":1,mingliu:1,"mingliu-extb":1,mingliu_hkscs:1,"mingliu_hkscs-extb":1,miriam:1,"miriam fixed":1,mistral:1,"modern no. 20":1,"mongolian baiti":1,"monotype corsiva":1,"monotype hadassah":1,moolboran:1,"ms gothic":1,"ms mincho":1,"ms outlook":1,"ms pgothic":1,"ms pmincho":1,"ms reference sans serif":1,"ms reference specialty":1,"ms ui gothic":1,"mt extra":1,"mv boli":1,narkisim:1,"niagara engraved":1,"niagara solid":1,nsimsun:1,nyala:1,"ocr a extended":1,"old english text mt":1,onyx:1,"palace script mt":1,"palatino linotype":1,papyrus:1,parchment:1,perpetua:1,"perpetua titling mt":1,"plantagenet cherokee":1,playbill:1,pmingliu:1,"pmingliu-extb":1,"poor richard":1,pristina:1,raavi:1,"rage italic":1,ravie:1,rockwell:1,"rockwell condensed":1,"rockwell extra bold":1,rod:1,"sakkal majalla":1,"script mt bold":1,"segoe print":1,"segoe script":1,"segoe ui":1,"segoe ui light":1,"segoe ui semibold":1,"segoe ui symbol":1,"shonar bangla":1,"showcard gothic":1,shruti:1,simhei:1,"simplified arabic":1,"simplified arabic fixed":1,simsun:1,"simsun-extb":1,"snap itc":1,stencil:1,sylfaen:1,symbol:1,tahoma:1,"tempus sans itc":1,"times new roman":1,"toptype soncino":1,"traditional arabic":1,"trebuchet ms":1,tunga:1,"tw cen mt":1,"tw cen mt condensed":1,"tw cen mt condensed extra bold":1,utsaah:1,vani:1,verdana:1,vijaya:1,"viner hand itc":1,vivaldi:1,"vladimir script":1,vrinda:1,webdings:1,"wide latin":1,wingdings:1,"wingdings 2":1,"wingdings 3":1},_defaultFontIE64Bit:"Arial",processFont:function(font){var processedFont=vml._fontCache[font];if(!processedFont){var shim=vml.text_shim||(vml.init(),vml.text_shim),style=shim.style;style.font=font;var fontFamily=style.fontFamily;'"'===fontFamily.charAt(0)&&(fontFamily=fontFamily.substr(1,fontFamily.length-1));var ffKey=fontFamily.toLowerCase(),substFF=vml._fontSubst[ffKey];substFF?fontFamily=substFF:vml.is64Bit&&!vml._fontWhiteListIE64Bit[ffKey]&&(fontFamily=vml._defaultFontIE64Bit);style.fontFamily='"'+fontFamily+'"';vml._fontCache[font]=processedFont=style.font;}
return processedFont;},get_dim:function(attr,target){var o=target||{};o.rotation=o.tx=o.ty=0;o.sx=o.sy=1;var transf=attr.transform;if(transf){var t=/translate\((-?\d+(?:\.\d+)?(?:e-?\d+)?)(?:,(-?\d+(?:\.\d+)?(?:e-?\d+)?))?\)/.exec(transf);if(t){t[1]&&(o.tx=+t[1]);t[2]&&(o.ty=+t[2]);}
var r=/rotate\((-?\d+(?:\.\d+)?(?:e-?\d+)?)\)/.exec(transf);if(r){var r=+r[1]%360;r<0&&(r+=360);r=pv.radians(r);}
var s=/scale\((-?\d+(?:\.\d+)?(?:e-?\d+)?)(?:,(-?\d+(?:\.\d+)?(?:e-?\d+)?))?\)/.exec(transf);if(s){s[1]&&(o.sx=+s[1]);s[2]&&(o.sy=+s[2]);}
o.rotation=r||0;}
o.x=parseFloat(attr.x||0);o.y=parseFloat(attr.y||0);"width"in attr&&(o.width=parseFloat(attr.width));"height"in attr&&(o.height=parseFloat(attr.height));return o;},solidFillStyle:{type:"solid"},elm_defaults:{g:{rewrite:"span",attr:function(attr,style,elm,scene,i){var d=vml.get_dim(attr);elm.style.cssText="position:absolute;zoom:1;left:"+(d.tx+d.x)+"px;top:"+(d.ty+d.y)+"px;";}},line:{rewrite:"shape",attr:function(attr,style,elm,scene,i){var x1=parseFloat(attr.x1||0),y1=parseFloat(attr.y1||0),x2=parseFloat(attr.x2||0),y2=parseFloat(attr.y2||0),r=vml.round;elm.coordorigin="0,0";elm.coordsize="21600,21600";vml.path(elm).v="M "+r(x1)+" "+r(y1)+" L "+r(x2)+" "+r(y2)+" E";vml.stroke(elm,attr,scene,i);},css:"top:0px;left:0px;width:1000px;height:1000px"},rect:{rewrite:"shape",attr:function(attr,style,elm,scene,i){var d=vml.get_dim(attr),p=vml.path(elm),r=vml.round;elm.coordorigin="0,0";elm.coordsize="21600,21600";var x=r(d.tx+d.x),y=r(d.ty+d.y),w=r(d.width),h=r(d.height);p.v="M "+x+" "+y+" L "+(x+w)+" "+y+" L "+(x+w)+" "+(y+h)+" L "+x+" "+(y+h)+" x";vml.stroke(elm,attr,scene,i);vml.fill(elm,attr,scene,i);},css:"top:0px;left:0px;width:1000px;height:1000px"},path:{rewrite:"shape",attr:function(attr,style,elm,scene,i){var d=vml.get_dim(attr),es=elm.style;es.visibility="hidden";es.left=d.tx+d.x+"px";es.top=d.ty+d.y+"px";elm.coordorigin="0,0";elm.coordsize="21600,21600";elm._events=attr["pointer-events"]||"none";vml.path(elm,attr.d);var skew=vml.rotateAndScale(elm,d.rotation&&-d.rotation,d.sx,d.sy);skew&&(skew.origin="-0.5,-0.5");vml.fill(elm,attr,scene,i);vml.stroke(elm,attr,scene,i);es.visibility="visible";},css:"top:0px;left:0px;width:1000px;height:1000px;"},ellipse:{rewrite:"oval",attr:function(attr,style,elm,scene,i){var d=vml.get_dim(attr),rx=attr.rx,ry=attr.ry,es=elm.style;es.left=d.tx-rx+"px";es.top=d.ty-ry+"px";es.width=2*rx+"px";es.height=2*ry+"px";var skew=vml.rotateAndScale(elm,d.rotation&&-d.rotation);skew&&(skew.origin="0,0");vml.fill(elm,attr,scene,i);vml.stroke(elm,attr,scene,i);}},circle:{rewrite:"oval",attr:function(attr,style,elm,scene,i){var d=vml.get_dim(attr),r=parseFloat(attr.r||0)+.5,cx=parseFloat(attr.cx||0)+.7,cy=parseFloat(attr.cy||0)+.7,es=elm.style;es.left=d.tx+cx-r+"px";es.top=d.ty+cy-r+"px";es.width=es.height=2*r+"px";vml.fill(elm,attr,scene,i);vml.stroke(elm,attr,scene,i);}},text:{rewrite:"shape",attr:function(attr,style,elm,scene,i){elm.style;elm.stroked="False";elm.path="m0,0 l1,0 e";var tp=vml.textpath(elm);tp.string=attr.string;var tpStyle=tp.style;tpStyle["v-text-align"]=attr.textAlign;tpStyle.font=attr.font;attr.textDecoration&&(tpStyle.textDecoration=attr.textDecoration);vml.path(elm).textpathok="True";vml.rotateAndScale(elm,attr.rotation&&-attr.rotation);var s=scene[i];s.fillStyle=vml.solidFillStyle;vml.fill(elm,attr,scene,i);s.fillStyle=null;},css:"position:absolute;top:0px;left:0px;width:1px;height:1px;"},svg:{rewrite:"span",css:"position:relative;overflow:hidden;display:inline-block;"},"vml:path":{rewrite:"path"},"vml:stroke":{rewrite:"stroke"},"vml:fill":{rewrite:"fill"},"vml:textpath":{rewrite:"textpath"},"vml:skew":{rewrite:"skew"}},_elmcache:{span:document.createElement("span"),div:document.createElement("div")},createElement:function(type){var elm,cache=vml._elmcache,helper=vml.elm_defaults[type]||{},tagName=helper.rewrite||type;if(tagName in cache)elm=cache[tagName].cloneNode(!1);else{cache[tagName]=document.createElement(vml.pre+tagName+vml.post);tagName in vml.block&&(cache[tagName].className+=" msvml_block");elm=cache[tagName].cloneNode(!1);}
helper.css&&(elm.style.cssText=helper.css);return elm;},_hex:pv.range(0,256).map(function(i){return pv.Format.pad("0",2,i.toString(16));}),_colorcache:{},color:function(value){var rgb,result=vml._colorcache[value];!result&&(rgb=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(value))&&(vml._colorcache[value]=result="#"+vml._hex[rgb[1]]+vml._hex[rgb[2]]+vml._hex[rgb[3]]);return result||value;},fill:function(elm,attr,scene,i){var fill=elm.getElementsByTagName("fill")[0]||(fill=elm.appendChild(vml.createElement("vml:fill"))),fillStyle=scene[i].fillStyle,fillType=fillStyle&&fillStyle.type;fillType||(fillType="solid");if(!attr.fill||!fillStyle||"solid"===fillType&&"none"===attr.fill)fill.on="false";else{fill.on="true";if("solid"===fillType){fill.type="solid";fill.color=vml.color(attr.fill);}else{var isLinear="lineargradient"===fillType;fill.method="none";var stops=fillStyle.stops,S=stops.length;if(S>0){for(var stopsText=[],i=0;i<S;i++){var stop=stops[i];stopsText.push(stop.offset+"% "+vml.color(stop.color.color));}
fill.colors&&"object"==typeof fill.colors?fill.colors.value=stopsText.join(","):fill.colors=stopsText.join(",");}
if(isLinear){fill.type="gradient";var angle=-pv.degrees(fillStyle.angle)%360;fill.angle=angle<0?angle+360:angle;}else{fill.type="gradientTitle";fill.focus="100%";fill.focussize="0 0";fill.focusposition="0 0";fill.angle=0;}}
fill.opacity=Math.min(parseFloat(attr["fill-opacity"]||"1"),1)||"1";}},stroke:function(elm,attr,scene,i){var stroke=elm.getElementsByTagName("stroke")[0]||(stroke=elm.appendChild(vml.createElement("vml:stroke")));if(attr.stroke&&"none"!==attr.stroke){var strokeWidth=attr["stroke-width"];strokeWidth=null==strokeWidth||""===strokeWidth?1:+strokeWidth;strokeWidth<1e-10?strokeWidth=0:strokeWidth<1&&(strokeWidth=1);if(strokeWidth){stroke.on="true";stroke.weight=strokeWidth;stroke.color=vml.color(attr.stroke)||"black";stroke.opacity=Math.min(parseFloat(attr["stroke-opacity"]||"1"),1)||"1";stroke.joinstyle=vml.joins[attr["stroke-linejoin"]]||"miter";stroke.miterlimit=attr["stroke-miterlimit"]||8;stroke.endcap=vml.caps[attr["stroke-linecap"]]||"flat";var dashArray=attr["stroke-dasharray"];dashArray&&"none"!==dashArray||(dashArray="Solid");stroke.dashstyle=dashArray;}else{stroke.on="false";stroke.weight=0;}}else{stroke.on="false";stroke.weight=0;}},path:function(elm,svgpath){var p=elm.getElementsByTagName("path")[0]||(p=elm.appendChild(vml.createElement("vml:path")));arguments.length>1&&(p.v=vml.rewritePath(svgpath));return p;},skew:function(elm){var sk=elm.getElementsByTagName("skew")[0]||(sk=elm.appendChild(vml.createElement("vml:skew")));sk.on="false";return sk;},rotateAndScale:function(elm,r,sx,sy){r&&(r=pv.radians(Math.round(pv.degrees(r))%360));var hasScale=sx&&1!==sx||sy&&1!==sy;if(r||hasScale){var skew=vml.skew(elm);skew.on="true";skew.offset="0,0";sx||(sx=1);sy||(sy=1);var m;if(r){var ct=Math.cos(r),st=Math.sin(r);m=(sx*ct).toFixed(8)+","+(sy*st).toFixed(8)+","+(sx*-st).toFixed(8)+","+(sy*ct).toFixed(8)+",0,0";}else m=sx.toFixed(8)+",0,0,"+sy.toFixed(8)+",0,0";skew.matrix=m;return skew;}},textpath:function(elm){var tp=elm.getElementsByTagName("textpath")[0]||(tp=elm.appendChild(vml.createElement("vml:textpath")));tp.style["v-text-align"]="center";tp.style["v-text-kern"]="true";tp.on="true";return tp;},init:function(){if(!vml.text_shim){vml.text_shim=document.getElementById("pv_vml_text_shim")||document.createElement("span");vml.text_shim.id="protovisvml_text_shim";vml.text_shim.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline-block;white-space:nowrap;";document.body.appendChild(vml.text_shim);}
if(!vml.styles){vml.styles=document.getElementById("protovisvml_styles")||document.createElement("style");vml.styles.id="protovisvml_styles";document.documentElement.firstChild.appendChild(vml.styles);vml.styles.styleSheet.addRule(".msvml","behavior:url(#default#VML);");vml.styles.styleSheet.addRule(".msvml_block","position:absolute;top:0;left:0;");try{document.namespaces.pvml||document.namespaces.add("pvml","urn:schemas-microsoft-com:vml");}catch(e){vml.pre="<";vml.post=' class="msvml" xmlns="urn:schemas-microsoft.com:vml">';}}},_pathcache:{},rewritePath:function(p){var x=0,y=0,round=vml.round;if(!p)return p;if(p in vml._pathcache)return vml._pathcache[p];p=p.replace(/(\d*)((\.*\d*)(e ?-?\d*))/g,"$1");for(var bits=p.match(/([MLHVCSQTAZ ][^MLHVCSQTAZ ]*)/gi),np=[],lastcurve=[],oldOp="",i=0,bl=bits.length;i<bl;i++){var itm=bits[i],op=itm.charAt(0),args=itm.substring(1).split(/[,]/);" "==op&&(op=oldOp);oldOp=op;switch(op){case"M":op="m";x=round(args[0]);y=round(args[1]);args=[x,y];break;case"m":op="m";x+=round(args[0]);y+=round(args[1]);args=[x,y];break;case"A":op="l";args=[x=round(args[5]),y=round(args[6])];break;case"L":op="l";args=[x=round(args[0]),y=round(args[1])];break;case"l":op="l";args=[x+=round(args[0]),y+=round(args[1])];break;case"H":op="l";args=[x=round(args[0]),y];break;case"h":op="l";args=[x+=round(args[0]),y];break;case"V":op="l";args=[x,y=round(args[0])];break;case"v":op="l";args=[x,y+=round(args[0])];break;case"C":op="c";lastcurve=args=[round(args[0]),round(args[1]),round(args[2]),round(args[3]),x=round(args[4]),y=round(args[5])];break;case"c":op="c";lastcurve=args=[x+round(args[0]),y+round(args[1]),x+round(args[2]),y+round(args[3]),x+=round(args[4]),y+=round(args[5])];break;case"S":op="c";lastcurve=args=[lastcurve[4]+(lastcurve[4]-lastcurve[2]),lastcurve[5]+(lastcurve[5]-lastcurve[3]),round(args[0]),round(args[1]),x=round(args[2]),y=round(args[3])];break;case"s":op="c";lastcurve=args=[lastcurve[4]+(lastcurve[4]-lastcurve[2]),lastcurve[5]+(lastcurve[5]-lastcurve[3]),x+round(args[0]),y+round(args[1]),x+=round(args[2]),y+=round(args[3])];break;case"Q":op="c";var x1=round(args[0]),y1=round(args[1]),x2=round(args[2]),y2=round(args[3]);args=[~~(x+2*(x1-x)/3),~~(y+2*(y1-y)/3),~~(x1+(x2-x1)/3),~~(y1+(y2-y1)/3),x=x2,y=y2];break;case"q":op="l";x+=round(args[2]);y+=round(args[3]);args=[x,y];break;case"Z":case"z":op="xe";args=[];break;default:op="";args=[];}
np.push(op,args.join(","));}
return vml._pathcache[p]=np.join("")+"e";}};pv.Text.measure=vml.text_dims;pv.Vml=vml;pv.VmlScene={scale:1,events:["mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick","contextmenu"],mousePositionEventSet:pv.Scene.mousePositionEventSet,eventsToNumber:pv.Scene.eventsToNumber,numberToEvents:pv.Scene.numberToEvents,implicit:{css:{}},copy_functions:function(obj){for(var name in obj)"function"!=typeof obj[name]||name in pv.VmlScene||(pv.VmlScene[name]=obj[name]);}};pv.VmlScene.copy_functions(pv.SvgScene);pv.Scene=pv.VmlScene;pv.renderer=function(){return"vml";};!function(is64bit){pv.VmlScene.minRuleLineWidth=is64bit?1.2:1.1;pv.VmlScene.minBarWidth=is64bit?2.2:1.8;pv.VmlScene.minBarHeight=is64bit?2.2:1.8;pv.VmlScene.minBarLineWidth=is64bit?1.2:1;}(vml.is64Bit);pv.VmlScene.expect=function(e,type,scene,i,attr,style){style=style||{};var helper=vml.elm_defaults[type]||{},_type=helper.rewrite||type;if(e){if(e.tagName.toUpperCase()!==_type.toUpperCase()){var n=vml.createElement(type);e.parentNode.replaceChild(n,e);e=n;}}else e=vml.createElement(type);if(attr){"attr"in helper&&helper.attr(attr,style,e,scene,i);if(attr.cursor in vml.cursorstyles){var curs=vml.cursorstyles[attr.cursor];style.cursor=1===curs?attr.cursor:curs;}}
style&&this.setStyle(e,style);return e;};pv.VmlScene.removeSiblings=function(e){for(;e;){var n=e.nextSibling;e.parentNode.removeChild(e);e=n;}};pv.VmlScene.addFillStyleDefinition=function(){};pv.VmlScene.setAttributes=function(){};pv.VmlScene.setStyle=function(e,style){var prevStyle=e.__style__;prevStyle===style&&(prevStyle=null);var eStyle=e.style;for(var name in style){var value=style[name];prevStyle&&value===prevStyle[name]||(null==value?eStyle.removeAttribute(name):eStyle[name]=value);}
e.__style__=style;};pv.VmlScene.append=function(e,scene,index){e.$scene={scenes:scene,index:index};e=this.title(e,scene[index]);e.parentNode&&11!==e.parentNode.nodeType||scene.$g.appendChild(e);return e.nextSibling;};pv.VmlScene.title=function(e,s){e.title=s.title||"";return e;};pv.VmlScene.panel=function(scene){for(var style,g=scene.$g,e=g&&g.firstChild,inited=!1,i=0,L=scene.length;i<L;i++){var s=scene[i];if(s.visible){if(!scene.parent){var canvas=s.canvas;style=canvas.style;style.display="inline-block";style.zoom=1;if(g&&g.parentNode!==canvas){g=canvas.firstChild;e=g&&g.firstChild;}
if(!g){inited=!0;vml.init();g=canvas.appendChild(vml.createElement("svg"));g.unselectable="on";g.onselectstart=function(){return!1;};for(var events=this.events,dispatch=this.dispatch,j=0,E=events.length;j<E;j++)g.addEventListener?g.addEventListener(events[j],dispatch,!1):g.attachEvent("on"+events[j],dispatch);e=g.firstChild;}
scene.$g=g;var w=s.width+s.left+s.right,h=s.height+s.top+s.bottom;style=g.style;style.width=w+"px";style.height=h+"px";style.clip="rect(0px "+w+"px "+h+"px 0px)";}
var c;if("hidden"===s.overflow){c=this.expect(e,"g",scene,i);c.style.position="absolute";c.style.clip="rect("+s.top.toFixed(2)+"px "+(s.left+s.width).toFixed(2)+"px "+(s.top+s.height).toFixed(2)+"px "+s.left.toFixed(2)+"px)";c.parentNode||g.appendChild(c);scene.$g=g=c;e=c.firstChild;}
e=this.fill(e,scene,i);var k=this.scale,t=s.transform,x=s.left+t.x,y=s.top+t.y;this.scale*=t.k;if(s.children.length)for(var attrs={transform:"translate("+x+","+y+")"+(1!=t.k?" scale("+t.k+")":"")},childScenes=this.getSortedChildScenes(scene,i),j=0,C=childScenes.length;j<C;j++){var childScene=childScenes[j];childScene.$g=e=this.expect(e,"g",scene,i,attrs);this.updateAll(childScene);var parentNode=e.parentNode;if(!parentNode||11===parentNode.nodeType){g.appendChild(e);var helper=vml.elm_defaults[e.svgtype];helper&&"function"==typeof helper.onappend&&helper.onappend(e,scene[i]);}
e=e.nextSibling;}
this.scale=k;e=this.stroke(e,scene,i);if(c){scene.$g=g=c.parentNode;e=c.nextSibling;}}}
if(inited){this.removeSiblings(e);e=g.appendChild(vml.createElement("oval"));}
return e;};pv.VmlScene.parseDasharray=function(s){var dashArray=s.strokeDasharray;if(dashArray&&"none"!==dashArray){var standardDashArray=this.translateDashStyleAlias(dashArray);if(this.isStandardDashStyle(standardDashArray))dashArray=standardDashArray;else{dashArray=dashArray.split(/[\s,]+/).map(function(num){return+num/this.scale;},this);dashArray.length%2&&(dashArray=dashArray.concat(dashArray));dashArray=dashArray.join(" ");}}else dashArray=null;return dashArray;};pv.VmlScene.create=function(type){return vml.createElement(type);};!function(){function IEvent(src){if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=returnFalse;(src.defaultPrevented||!1===src.returnValue||src.getPreventDefault&&src.getPreventDefault())&&(this.isDefaultPrevented=returnTrue);this.timeStamp=src.timeStamp||Date.now();}else{this.type=src;this.timeStamp=Date.now();}}
var returnTrue=function(){return!0;},returnFalse=function(){return!1;},_event_props=["altKey","attrChange","attrName","bubbles","button","cancelable","charCode","clientX","clientY","ctrlKey","currentTarget","data","detail","eventPhase","fromElement","handler","keyCode","layerX","layerY","metaKey","newValue","offsetX","offsetY","pageX","pageY","prevValue","relatedNode","relatedTarget","screenX","screenY","shiftKey","srcElement","target","toElement","view","wheelDelta","which"],_evPropCount=_event_props.length;IEvent.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1);},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=!0;}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation();},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};var SCROLL_NODE=document.compatMode&&"BackCompat"!=document.compatMode?"documentElement":"body";vml.fixEvent=function(ev){var originalEvent=ev;ev=new IEvent(originalEvent);for(var type=ev.type,isKey="keypress"===type,i=_evPropCount;i;){var prop=_event_props[--i];ev[prop]=originalEvent[prop];}
var target=ev.target;if(!target){target=ev.srcElement||document;3===target.nodeType&&(target=target.parentNode);ev.target=target;}
var fromElem;!ev.relatedTarget&&(fromElem=ev.fromElement)&&(ev.relatedTarget=fromElem===target?ev.toElement:fromElem);if(!isKey){var clientX;if(null==ev.pageX&&null!=(clientX=ev.clientX)){var scrollNode=document[SCROLL_NODE];ev.pageX=clientX+(scrollNode.scrollLeft||0)-(scrollNode.clientLeft||0);ev.pageY=ev.clientY+(scrollNode.scrollTop||0)-(scrollNode.clientTop||0);}}
if(null==ev.which){var charCode,keyCode,btn;isKey?null!=(charCode=ev.charCode)?ev.which=charCode:null!=(keyCode=ev.keyCode)&&(ev.which=keyCode):null!==(btn=ev.button)&&(ev.which=1&btn?1:2&btn?3:4&btn?2:0);}
ev.metaKey=!!ev.metaKey;"mousewheel"===type&&(ev.wheel=ev.wheelDelta);return ev;};}();pv.fixEvent=function(ev){return vml.fixEvent(ev||window.event);};pv.VmlScene.dispatch=pv.listener(function(e){var t=e.target.$scene;if(t){if("none"===e.target._events||pv.Mark.dispatch(e.type,t.scenes,t.index,e)){e.preventDefault();e.stopPropagation();}}});pv.VmlScene.image=function(scene){for(var e=scene.$g.firstChild,i=0;i<scene.length;i++){var s=scene[i];if(s.visible){e=this.fill(e,scene,i);if(s.image);else{e=new Image();e.src=s.url;var st=e.style;st.position="absolute";st.top=s.top;st.left=s.left;st.width=s.width;st.height=s.height;st.cursor=s.cursor;st.msInterpolationMode="bicubic";}
e=this.append(e,scene,i);e=this.stroke(e,scene,i);}}
return e;};pv.VmlScene.label=function(scene){for(var e=scene.$g.firstChild,i=0,L=scene.length;i<L;i++){var s=scene[i];if(s.visible){var fill=s.textStyle;if(fill.opacity&&s.text){var txt=s.text.replace(/\s+/g,""),font=vml.processFont(s.font),label=vml.text_dims(txt,font),dx=0,dy=0;switch(s.textBaseline){case"middle":dy=.1*label.height;break;case"top":dy=s.textMargin+.5*label.height;break;case"bottom":dy=-(s.textMargin+.5*label.height);}
switch(s.textAlign){case"left":dx=s.textMargin;break;case"right":dx=-s.textMargin;}
var a=s.textAngle;if(a){var ct=Math.cos(a),st=Math.sin(a),dx2=dx*ct-dy*st,dy2=dx*st+dy*ct;dx=dx2;dy=dy2;}
var left=s.left+dx,top=s.top+dy,attr={};s.cursor&&(attr.cursor=s.cursor);attr.fill=vml.color(fill.color)||"black";vml.is64Bit&&(attr["fill-opacity"]=.7);attr.x=left;attr.y=top;attr.rotation=s.textAngle;attr.string=txt;attr.textAlign=s.textAlign;attr.font=font;attr.textDecoration=s.textDecoration;e=this.expect(e,"text",scene,i,attr,{display:"block",lineHeight:1,whiteSpace:"nowrap",zoom:1,position:"absolute",cursor:"default",top:top+"px",left:left+"px"});e=this.append(e,scene,i);}}}
return e;};pv.VmlScene.wedge=function(scene){for(var e=scene.$g.firstChild,round=vml.round,i=0,L=scene.length;i<L;i++){var s=scene[i];if(s.visible){var fill=s.fillStyle,stroke=s.strokeStyle;if(fill.opacity||stroke.opacity){e=this.expect(e,"path",scene,i,{"pointer-events":s.events,cursor:s.cursor,transform:"translate("+s.left+","+s.top+")",d:"",fill:fill.color,"fill-rule":"evenodd","fill-opacity":fill.opacity||null,stroke:stroke.color,"stroke-opacity":stroke.opacity||null,"stroke-width":stroke.opacity?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":stroke.opacity?this.parseDasharray(s):null});var p=e.getElementsByTagName("path")[0];if(!p){p=vml.make("path");e.appendChild(p);}
var d,r1=round(s.innerRadius),r2=round(s.outerRadius);if(s.angle>=2*Math.PI)d=r1?"AE0,0 "+r2+","+r2+" 0 23592960AL0,0 "+r1+","+r1+" 0 23592960":"AE0,0 "+r2+","+r2+" 0 23592960";else{var sa=Math.round(s.startAngle/Math.PI*11796480),a=Math.round(s.angle/Math.PI*11796480);d=r1?"AE 0,0 "+r2+","+r2+" "+-sa+" "+-a+" 0,0 "+r1+","+r1+" "+-(sa+a)+" "+a+"X":"M0,0AE0,0 "+r2+","+r2+" "+-sa+" "+-a+"X";}
p.v=d;e=this.append(e,scene,i);}}}
return e;};}();return pv;});
pen.define("cdf-legacy/lib/CCC/tipsy",["cdf-legacy/lib/CCC/protovis","cdf-legacy/jquery","cdf-legacy/lib/CCC/jquery.tipsy"],function(pv,$){!function(){function toParentTransform(parentPanel){return pv.Transform.identity.translate(parentPanel.left(),parentPanel.top()).times(parentPanel.transform());}
function getVisibleScreenBounds(mark){for(var right,bottom,parent,instance=mark.instance(),left=instance.left,top=instance.top,width=instance.width,height=instance.height;parent=mark.parent;){if(left<0){width+=left;left=0;}
if(top<0){height+=top;top=0;}
right=instance.right;right<0&&(width+=right);bottom=instance.bottom;bottom<0&&(height+=bottom);var t=toParentTransform(parent),s=t.k;left=t.x+s*left;top=t.y+s*top;width*=s;height*=s;mark=parent;instance=mark.instance();}
return{left:left,top:top,width:width,height:height};}
$.fn.tipsy.elementOptions=function(elem,options){var markOpts=elem.$tooltipOptions;options=$.extend({},options,markOpts||{},{gravity:options.gravity});return options;};var _nextTipsyId=0;pv.Behavior.tipsy=function(opts){function getTooltipText(){var instance=_mark.instance(),title=_mark.properties.tooltip?instance.tooltip:"function"==typeof _mark.tooltip?_mark.tooltip():instance.title||instance.text;"function"==typeof title&&(title=title());return title||"";}
function getInstanceBounds(){var left,top,width,height,instance=_mark.instance();if(_mark.properties.width){var bounds=getVisibleScreenBounds(_mark);left=bounds.left;top=bounds.top;width=bounds.width;height=bounds.height;}else{var radius,t=_mark.toScreenTransform();if(_mark.properties.outerRadius){var midAngle=instance.startAngle+instance.angle/2;radius=instance.outerRadius;left=t.x+instance.left+radius*Math.cos(midAngle);top=t.y+instance.top+radius*Math.sin(midAngle);}else if(_mark.properties.shapeRadius){radius=getTooltipOptions().ignoreRadius?0:Math.max(2,instance.shapeRadius);var cx=instance.left,cy=instance.top;switch(instance.shape){case"diamond":radius*=Math.SQRT2;break;case"circle":radius/=Math.SQRT2;}
left=(cx-radius)*t.k+t.x;top=(cy-radius)*t.k+t.y;height=width=2*radius*t.k;}else{left=instance.left*t.k+t.x;top=instance.top*t.k+t.y;}}
var left2=Math.ceil(left),top2=Math.ceil(top),leftE=left2-left,topE=top2-top;width=Math.max(1,Math.floor((width||0)-leftE));height=Math.max(1,Math.floor((height||0)-topE));return{left:left2,top:top2,width:width,height:height};}
function getTooltipOptions(){return _mark&&_mark.tooltipOptions||opts;}
function updateUserGravity(){var opts=getTooltipOptions(),grav=pv.get(opts,"gravity");grav&&"function"==typeof grav&&(grav=grav.call(_mark));_tip.debug>=21&&_tip.log("[TIPSY] #"+_tipsyId+" Update User Gravity "+grav);return _userGravity=grav||$.fn.tipsy.defaults.gravity;}
function calculateGravity(tipSize,calcPosition){function scoreGravity(gravity){return scorePosition(gravity,calcPosition(gravity));}
function scorePosition(gravity,tp){var wScore=calcPosScore(tp.left,"width"),hScore=calcPosScore(tp.top,"height"),isMouseInside=_mousePage&&!opts.followMouse;if(isMouseInside){isMouseInside=new pv.Shape.Rect(tp.left,tp.top,tipSize.width,tipSize.height).containsPoint(_mousePage);}
var isTotal=!isMouseInside&&wScore.fits&&hScore.fits;return{gravity:gravity,width:wScore,height:hScore,value:wScore.value+hScore.value+(2-gravity.length)+(isMouseInside?-1e3:0),isMouseInside:isMouseInside,isTotal:isTotal,isPartial:wScore.fits||hScore.fits};}
function calcPosScore(absPos,a_len){var maxLen=pageSize[a_len],len=tipSize[a_len],pos=absPos-scrollOffset[a_len],opos=maxLen-(pos+len);return{fits:pos>=0&&opos>=0,value:(pos>=0?pos:4*pos)+(opos>=0?opos:4*opos)};}
if(this!==$fakeTipTarget[0])throw new Error("Assertion failed.");var $win=$(window),scrollOffset={width:$win.scrollLeft(),height:$win.scrollTop()},pageSize={width:$win.width(),height:$win.height()},gravity=_userGravity;"c"===gravity&&(gravity="w");var bestScore=scoreGravity(gravity);if(!bestScore.isTotal){for(var g=_gravities.indexOf(gravity),n=1,L=_gravities.length;n<L;n++){bestScore=chooseScores(bestScore,scoreGravity(_gravities[(g+n)%L]));}
_tip.debug>=21&&gravity!==bestScore.gravity&&_tip.log("[TIPSY] #"+_tipsyId+" Choosing gravity '"+bestScore.gravity+"' over '"+gravity+"'");gravity=bestScore.gravity;}
_tip.debug>=21&&_tip.log("[TIPSY] #"+_tipsyId+" Gravity '"+gravity+"'");return gravity;}
function chooseScores(score1,score2){if(score1.isTotal){if(!score2.isTotal)return score1;}else if(score2.isTotal){if(!score1.isTotal)return score2;}else if(score1.isPartial){if(!score2.isPartial)return score1;}else if(score2.isPartial&&!score1.isPartial)return score2;return score2.value>score1.value?score2:score1;}
function setFakeTipTargetBounds(bounds){$fakeTipTarget.css({left:bounds.left+parseFloat($canvas.css("padding-left"))+$canvas.scrollLeft(),top:bounds.top+parseFloat($canvas.css("padding-top"))+$canvas.scrollTop(),width:bounds.width,height:bounds.height});}
function createTipsy(mark){_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Creating _id="+_id);var c=mark.root.canvas();$canvas=$(c);var position=c.style.position;position&&"static"!==position||(c.style.position="relative");$canvas.mouseleave(hideTipsy);opts.usesPoint&&opts.followMouse&&mark.root.event("mousemove",doFollowMouse);initTipsyCanvasSharedInfo();_id||(_id="tipsyPvBehavior_"+new Date().getTime());var fakeTipTarget=document.getElementById(_id);if(!fakeTipTarget){_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Creating Fake Tip Target="+_id);fakeTipTarget=document.createElement("div");fakeTipTarget.id=_id;fakeTipTarget.className="fakeTipsyTarget";c.appendChild(fakeTipTarget);}
var fakeStyle=fakeTipTarget.style;fakeStyle.padding="0px";fakeStyle.margin="0px";fakeStyle.position="absolute";fakeStyle.pointerEvents="none";fakeStyle.display="block";fakeStyle.zIndex=-10;$fakeTipTarget=$(fakeTipTarget);updateTipDebug();$fakeTipTarget.removeData("tipsy");$fakeTipTarget[0].$tooltipOptions=mark.tooltipOptions;var opts2=createTipsyOptions(opts);$fakeTipTarget.tipsy(opts2);}
function createTipsyOptions(optionsBase){var options=Object.create(optionsBase);options.gravity=calculateGravity;options.delayOut=0;options.trigger="manual";null==options.animate&&(options.animate=options.followMouse?0:400);return options;}
function initTipsyCanvasSharedInfo(){_sharedTipsyInfo=$canvas.data("tipsy-pv-shared-info");if(_sharedTipsyInfo){var createId=$canvas[0].$pvCreateId||0;if(_sharedTipsyInfo.createId===createId){_sharedTipsyInfo.behaviors.push(disposeTipsy);return;}
_sharedTipsyInfo.behaviors.forEach(function(dispose){dispose();});}
_sharedTipsyInfo={createId:$canvas[0].$pvCreateId||0,behaviors:[disposeTipsy]};$canvas.data("tipsy-pv-shared-info",_sharedTipsyInfo);}
function updateTipDebug(){$fakeTipTarget&&(_tip.debug>=22?$fakeTipTarget.css({borderColor:"red",borderWidth:"1px",borderStyle:"solid",zIndex:1e3}):$fakeTipTarget.css({borderWidth:"0px",zIndex:-10}));}
function getMouseBounds(ev){ev||(ev=pv.event);var offset=$canvas.offset(),left=offset.left+parseFloat($canvas.css("padding-left")||0),top=offset.top+parseFloat($canvas.css("padding-top")||0);return{left:ev.pageX-left-5,top:ev.pageY-top-5,width:20,height:20};}
function setMark(mark){mark||(mark=null);var index,renderId,scenes;if(mark!==_mark){_mark=mark;if(mark){_scenes=mark.scene;_index=getOwnerInstance(_scenes,_mark.index);_renderId=mark.renderId();}else{_renderId=_scenes=_index=null;_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Cleared Mark");}}else{if(!mark)return!1;if(_scenes!==(scenes=mark.scene)){_scenes=scenes;_index=getOwnerInstance(_scenes,_mark.index);_renderId=mark.renderId();}else if(_index!==(index=getOwnerInstance(_scenes,_mark.index))){_index=index;_renderId=mark.renderId();}else{if(_renderId===(renderId=mark.renderId()))return!1;_renderId=renderId;}}
$fakeTipTarget[0].$tooltipOptions=_mark&&_mark.tooltipOptions;var opts2=createTipsyOptions(opts);$fakeTipTarget.tipsy("setOptions",opts2);mark&&_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Set Mark State to "+mark.type+" scenes: #"+_scenes.length+" index: "+_index+" renderId: "+_renderId);return!0;}
function setTarget(targetElem,mark){targetElem&&mark||(targetElem=mark=null);var changedTargetElem=!$targetElem&&targetElem||$targetElem&&$targetElem[0]!==targetElem;if(changedTargetElem){_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" "+(targetElem?"Changing target element "+targetElem.tagName+".":"Clearing target element."));if(changedTargetElem){if($targetElem){$targetElem.off("mousemove",onTargetElemMouseMove);$targetElem.off("mouseleave",hideTipsy);}
$targetElem=targetElem?$(targetElem):null;}
setMark(mark);if($targetElem){$targetElem.mousemove(onTargetElemMouseMove);$targetElem.mouseleave(hideTipsy);}}}
function getRealIndex(scene,index){var index0=index;if("function"==typeof _mark.getNearestInstanceToMouse){index=_mark.getNearestInstanceToMouse(scene,index);_tip.debug>=20&&index0!==index&&_tip.log("[TIPSY] #"+_tipsyId+" Changing index "+index0+" to Nearest index "+index);}
return getOwnerInstance(scene,index);}
function getOwnerInstance(scene,index){if("function"==typeof _mark.getOwnerInstance){var index0=index;index=_mark.getOwnerInstance(scene,index);_tip.debug>=20&&index0!==index&&_tip.log("[TIPSY] #"+_tipsyId+" Changing index "+index0+" to Owner index "+index);}
return index;}
function getNewOperationId(){return _nextOperId++;}
function checkCanOperate(opId){return opId===_nextOperId-1;}
function hideTipsy(){var opId=getNewOperationId();_tip.debug>=30&&_tip.log("[TIPSY] #"+_tipsyId+" Delayed Hide Begin opId="+opId);if(_delayOut>0)window.setTimeout(function(){if(checkCanOperate(opId)){_tip.debug>=30&&_tip.log("[TIPSY] #"+_tipsyId+" Hiding opId="+opId);hideTipsyCore(opId);}else _tip.debug>=30&&_tip.log("[TIPSY] #"+_tipsyId+" Delayed Hide Cancelled opId="+opId);},_delayOut);else{_tip.debug>=30&&_tip.log("[TIPSY] #"+_tipsyId+" Hiding Immediately opId="+opId);hideTipsyCore(opId);}}
function disposeTipsy(){_tip.debug>=30&&_tip.log("[TIPSY] #"+_tipsyId+" Disposing");hideTipsyOther();if($fakeTipTarget){$fakeTipTarget.removeData("tipsy");$fakeTipTarget.each(function(elem){elem.$tooltipOptions=null;});$fakeTipTarget.remove();$fakeTipTarget=null;}
if($canvas){$canvas.off("mouseleave",hideTipsy);$canvas=null;}}
function hideTipsyOther(){var opId=getNewOperationId();_tip.debug>=30&&_tip.log("[TIPSY] #"+_tipsyId+" Hiding as Other opId="+opId);hideTipsyCore(opId);}
function hideTipsyCore(opId){setTarget(null,null);setMark(null);$fakeTipTarget&&$fakeTipTarget.data("tipsy")&&$fakeTipTarget.tipsy("leave");}
function hideOtherTipsies(){var hideTipsies=_sharedTipsyInfo&&_sharedTipsyInfo.behaviors;if(hideTipsies&&hideTipsies.length>1){_tip.debug>=30&&_tip.group("[TIPSY] #"+_tipsyId+" Hiding Others");hideTipsies.forEach(function(hideTipsyFun){hideTipsyFun!==disposeTipsy&&hideTipsyFun();});_tip.debug>=30&&_tip.groupEnd();}}
function isRealMouseMove(ev){_mousePage=new pv.Shape.Point(ev.pageX,ev.pageY);if(_prevMousePage&&_mousePage.distance2(_prevMousePage).cost<=8){_tip.debug>=30&&_tip.log("[TIPSY] #"+_tipsyId+" mousemove too close");return!1;}
return!0;}
function doFollowMouse(){_tip.debug>=30&&_tip.group("[TIPSY] #"+_tipsyId+" doFollowMouse");var ev=pv.event;if(!_mark||_isEnabledFun&&!_isEnabledFun(tipsyBehavior,_mark)){hideTipsy();_tip.debug>=30&&_tip.groupEnd();}else{if($fakeTipTarget&&_mark&&isRealMouseMove(ev)){_prevMousePage=_mousePage;setFakeTipTargetBounds(getMouseBounds(ev));hideOtherTipsies();$fakeTipTarget.tipsy("update");}
_tip.debug>=30&&_tip.groupEnd();}}
function onTargetElemMouseMove(ev){if($fakeTipTarget&&isRealMouseMove(ev)){var scenes,tag=this.$scene;if(tag&&(scenes=tag.scenes)&&scenes.mark&&scenes.mark===_mark){var renderId=_mark.renderId(),sceneChanged=renderId!==_renderId||scenes!==_scenes,followMouse=opts.followMouse,index=tag.index;if("function"==typeof _mark.getOwnerInstance||"function"==typeof _mark.getNearestInstanceToMouse){pv.event=ev;_mark.context(scenes,index,function(){index=getRealIndex(scenes,index);});pv.event=null;}
sceneChanged|=index!==_index;if(followMouse||sceneChanged){var opId=getNewOperationId();_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Updating opId="+opId);_prevMousePage=_mousePage;var bounds;followMouse&&(bounds=getMouseBounds(ev));if(sceneChanged){_renderId=renderId;_scenes=scenes;_index=index;_mark.context(scenes,index,function(){followMouse||(bounds=getInstanceBounds());var text=getTooltipText();_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Update text. Was hidden. Text: "+text.substr(0,50));$fakeTipTarget.tipsy("setTitle",text);updateUserGravity();});}
setFakeTipTargetBounds(bounds);hideOtherTipsies();$fakeTipTarget.tipsy("update");}else _tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" !followMouse and same scene");}else _tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" mousemove on != mark");}}
function initMark(mark){$canvas||createTipsy(mark);if(mark._tipsy!==tipsyBehavior){_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Initializing mark");mark._tipsy=tipsyBehavior;opts.usesPoint&&mark.event("unpoint",function(){_tip.debug>=20&&_tip.group("[TIPSY] #"+_tipsyId+" unpoint");hideTipsy();_tip.debug>=20&&_tip.groupEnd();});}}
function showTipsy(mark){function updateTextAndBounds(){var text=getTooltipText();_tip.debug>=20&&_tip.log("[TIPSY] #"+_tipsyId+" Set Text: "+text.substr(0,50));$fakeTipTarget.tipsy("setTitle",text);setFakeTipTargetBounds(opts.followMouse?getMouseBounds():getInstanceBounds());updateUserGravity();}
var opId=getNewOperationId();_tip.debug>=20&&_tip.group("[TIPSY] #"+_tipsyId+" ShowTipsy opId="+opId);initMark(mark);var isHidden=!_mark;opts.usesPoint?setMark(mark):setTarget(pv.event.target,mark);isRealMouseMove(pv.event);_prevMousePage=_mousePage;mark.index!==_index?mark.context(_scenes,_index,updateTextAndBounds):updateTextAndBounds();hideOtherTipsies();$fakeTipTarget.tipsy(isHidden?"enter":"update");_tip.debug>=20&&_tip.groupEnd();}
function tipsyBehavior(){var mark=this;_isEnabledFun&&!_isEnabledFun(tipsyBehavior,mark)||showTipsy(mark);}
opts||(opts={});var $fakeTipTarget,_prevMousePage,_mousePage,_userGravity,_renderId,_index,_scenes,_id,$canvas,_sharedTipsyInfo,$targetElem=null,_tipsyId=_nextTipsyId++,_nextOperId=0,_mark=null,_delayOut=opts.delayOut,_isEnabledFun=opts.isEnabled,_gravities=["nw","n","ne","e","se","s","sw","w"];return tipsyBehavior;};var _tip=pv.Behavior.tipsy;_tip.debug=0;_tip.setDebug=function(level){_tip.debug=level;};_tip.log=function(m){"undefined"!=typeof console&&console.log(""+m);};_tip.group=function(m){"undefined"!=typeof console&&console.group(""+m);};_tip.groupEnd=function(m){"undefined"!=typeof console&&console.groupEnd();};_tip.disposeAll=function(panel){var rootPanel=panel&&panel.root;if(rootPanel&&rootPanel.scene){var canvas=rootPanel.canvas();if(canvas){var $canvas=$(canvas),sharedTipsyInfo=$canvas.data("tipsy-pv-shared-info");if(sharedTipsyInfo){sharedTipsyInfo.behaviors&&sharedTipsyInfo.behaviors.forEach(function(dispose){dispose();});$canvas.removeData("tipsy-pv-shared-info");}}}
_tip.removeAll();};_tip.removeAll=function(){$(".tipsy").remove();};}();return pv.Behavior.tipsy;});
pen.define("cdf-legacy/lib/CCC/cdo",["cdf-legacy/lib/CCC/def","cdf-legacy/lib/CCC/protovis"],function(def,pv){function cdo_disposeChildList(list,parentProp){var L=list&&list.length;if(L){for(var i=0;i<L;i++){var child=list[i];parentProp&&(child[parentProp]=null);child.dispose();}
list.length=0;}}
function cdo_addColChild(parent,childrenProp,child,parentProp,index){child[parentProp]=parent;var col=parent[childrenProp]||(parent[childrenProp]=[]);null==index||index>=col.length?col.push(child):col.splice(index,0,child);}
function cdo_removeColChild(parent,childrenProp,child,parentProp){var index,children=parent[childrenProp];children&&(index=children.indexOf(child))>=0&&def.array.removeAt(children,index);child[parentProp]=null;}
function dimensionType_dateKey(date){return date.toISOString();}
function atom_idComparer(a,b){return a.id-b.id;}
function atom_idComparerReverse(a,b){return b.id-a.id;}
function datum_deselect(){delete this.isSelected;}
function datum_isNullOrSelected(d){return d.isNull||d.isSelected;}
function datum_isSelectedT(d){return!0===d.isSelected;}
function datum_isSelectedF(d){return!1===d.isSelected;}
function datum_isVisibleT(d){return!0===d.isVisible;}
function datum_isVisibleF(d){return!1===d.isVisible;}
function datum_isNullT(d){return!0===d.isNull;}
function datum_isNullF(d){return!1===d.isNull;}
function dim_createAndInternAtom(sourceValue,key,value,label,isVirtual){var atom;if(this.owner===this){atom=new cdo.Atom(this,value,label,sourceValue,key);isVirtual&&(atom.isVirtual=!0);}else{var source=this.parent||this.linkParent;atom=source._atomsByKey[key]||dim_createAndInternAtom.call(source,sourceValue,key,value,label,isVirtual);}
def.array.insert(this._atoms,atom,this._atomComparer);dim_clearVisiblesCache.call(this);this._atomsByKey[key]=atom;return atom;}
function dim_internAtom(atom){var key=atom.key,me=this,hasInited=!me._lazyInit;if(atom.dimension===me){me.owner===me||def.assert("Should be an owner dimension");key||atom!==me._virtualNullAtom?hasInited?dim_clearVisiblesCache.call(this):this._sumCache=null:atom=me.intern(null);return atom;}
if(hasInited){var localAtom=me._atomsByKey[key];if(localAtom){if(localAtom!==atom)throw def.error.operationInvalid("Atom is from a different root data.");dim_clearVisiblesCache.call(me);return atom;}
if(me.owner===me)throw def.error.operationInvalid("Atom is from a different root data.");}
dim_internAtom.call(me.parent||me.linkParent,atom);if(hasInited){me._atomsByKey[key]=atom;if(key)def.array.insert(me._atoms,atom,me._atomComparer);else{me._nullAtom=atom;me._atoms.unshift(atom);}
dim_clearVisiblesCache.call(me);}else this._sumCache=null;return atom;}
function dim_buildDatumsFilterKey(keyArgs){var visible=def.get(keyArgs,"visible"),selected=def.get(keyArgs,"selected");return(null==visible?null:!!visible)+":"+(null==selected?null:!!selected);}
function dim_createNullAtom(sourceLabel){var nullAtom=this._nullAtom;if(!nullAtom){this.owner===this?this.data._atomsBase[this.name]=nullAtom=new cdo.Atom(this,null,sourceLabel,null,""):nullAtom=dim_createNullAtom.call(this.parent||this.linkParent,sourceLabel);this._atomsByKey[""]=this._nullAtom=nullAtom;this._atoms.unshift(nullAtom);}
return nullAtom;}
function dim_createVirtualNullAtom(){this.owner===this||def.assert("Can only create atoms on an owner dimension.");if(!this._virtualNullAtom){this._virtualNullAtom=new cdo.Atom(this,null,"",null,"");this.data._atomsBase[this.name]=this._virtualNullAtom;}
return this._virtualNullAtom;}
function dim_uninternUnvisitedAtoms(){this.owner===this||def.assert("Can only unintern atoms of an owner dimension.");var atoms=this._atoms;if(atoms){for(var atomsByKey=this._atomsByKey,i=0,L=atoms.length;i<L;){var atom=atoms[i];if(atom.visited){delete atom.visited;i++;}else if(atom!==this._virtualNullAtom){atoms.splice(i,1);L--;var key=atom.key;delete atomsByKey[key];if(!key){delete this._nullAtom;this.data._atomsBase[this.name]=this._virtualNullAtom;}}}
dim_clearVisiblesCache.call(this);}}
function dim_uninternVirtualAtoms(){var atoms=this._atoms;if(atoms){for(var removed,atomsByKey=this._atomsByKey,i=0,L=atoms.length;i<L;){var atom=atoms[i];if(atom.isVirtual){atoms.splice(i,1);L--;removed=!0;delete atomsByKey[atom.key||def.assert("Cannot be the null or virtual null atom.")];}else i++;}
removed&&dim_clearVisiblesCache.call(this);}}
function dim_clearVisiblesCache(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null;}
function dim_addChild(child){cdo_addColChild(this,"childNodes",child,"parent");child.owner=this.owner;}
function dim_addLinkChild(linkChild){cdo_addColChild(this,"_linkChildren",linkChild,"linkParent");linkChild.owner=this.owner;}
function dim_onDatumVisibleChanged(datum,visible){var map;if(!this._disposed&&(map=this._atomVisibleDatumsCount)){var atom=datum.atoms[this.name],key=atom.key,count=map[key];map[key]=(count||0)+(visible?1:-1);this._visibleAtoms=this._sumCache=this._visibleIndexes=null;}}
function dim_getVisibleDatumsCountMap(){var map=this._atomVisibleDatumsCount;if(!map){map={};this.data.datums(null,{visible:!0}).each(function(datum){var atom=datum.atoms[this.name],key=atom.key;map[key]=(map[key]||0)+1;},this);this._atomVisibleDatumsCount=map;}
return map;}
function dim_calcVisibleIndexes(visible){var indexes=[];this._atoms.forEach(function(atom,index){this.isVisible(atom)===visible&&indexes.push(index);},this);return indexes;}
function dim_calcVisibleAtoms(visible){return def.query(this._atoms).where(function(atom){return this.isVisible(atom)===visible;},this).array();}
function cdo_addChild(child,index){this.insertAt(child,index);def.lazy(this,"_childrenByKey")[child.key]=child;}
function cdo_addLinkChild(linkChild,index){cdo_addColChild(this,"_linkChildren",linkChild,"linkParent",index);}
function cdo_removeLinkChild(linkChild){cdo_removeColChild(this,"_linkChildren",linkChild,"linkParent");}
function cdo_disposeChildLists(){cdo_disposeChildList(this.childNodes,"parent");this._childrenByKey=null;cdo_disposeChildList(this._linkChildren,"linkParent");this._groupByCache=null;this._sumAbsCache=null;}
function cdo_assertIsOwner(){this.isOwner()||def.fail("Can only be called on the owner data.");}
function data_onDatumSelectedChanged(datum,selected){!datum.isNull||def.assert("Null datums do not notify selected changes");selected?this._selectedNotNullDatums.set(datum.id,datum):this._selectedNotNullDatums.rem(datum.id);this._sumAbsCache=null;}
function data_onDatumVisibleChanged(datum,visible){var did=datum.id,me=this;if(def.hasOwnProp.call(me._datumsById,did)){!datum.isNull||def.assert("Null datums do not notify visible changes");visible?me._visibleNotNullDatums.set(did,datum):me._visibleNotNullDatums.rem(did);me._sumAbsCache=null;for(var list=me._dimensionsList,i=0,L=list.length;i<L;)dim_onDatumVisibleChanged.call(list[i++],datum,visible);list=me.childNodes;i=0;L=list.length;for(;i<L;)data_onDatumVisibleChanged.call(list[i++],datum,visible);list=me._linkChildren;if(list&&(L=list.length)){i=0;for(;i<L;)data_onDatumVisibleChanged.call(list[i++],datum,visible);}}}
function data_ancestorsAndSelfList(data){for(var p,ancestors=[data];p=data.parent||data.linkParent;)ancestors.unshift(data=p);return ancestors;}
function data_lowestCommonAncestor(listA,listB){for(var next,i=0,L=Math.min(listA.length,listB.length),a=null;i<L&&(next=listA[i])===listB[i];){a=next;i++;}
return a;}
function data_setDatums(setDatums,keyArgs){function maybeAddDatum(datumToSet){if(datumToSet){var key=datumToSet.key;if(!def.hasOwnProp.call(nextDatumsByKey,key)){null!==existingDatumsByKey&&def.hasOwnProp.call(existingDatumsByKey,key)&&(datumToSet=existingDatumsByKey[key]);var id=datumToSet.id;nextDatums.push(datumToSet);nextDatumsByKey[key]=datumToSet;nextDatumsById[id]=datumToSet;null!==preserveExistingAddedDatums&&preserveExistingAddedDatums.push(datumToSet);if(!datumToSet.isNull){datumToSet.isSelected&&selDatumsMap.set(id,datumToSet);datumToSet.isVisible&&visDatumsMap.set(id,datumToSet);}}}}
if(!setDatums)throw def.error.argumentRequired("setDatums");var nextDatums,nextDatumsByKey,nextDatumsById,hasExisting=this._datums.length>0,isPreserveExisting=!!def.get(keyArgs,"isAdditive"),existingDatumsByKey=null,visDatumsMap=this._visibleNotNullDatums,selDatumsMap=this._selectedNotNullDatums;if(hasExisting&&!isPreserveExisting){cdo_disposeChildLists.call(this);existingDatumsByKey=this._datumsByKey;this._datums=nextDatums=[];this._datumsById=nextDatumsById={};this._datumsByKey=nextDatumsByKey={};visDatumsMap.clear();selDatumsMap&&selDatumsMap.clear();}else{nextDatums=this._datums;nextDatumsByKey=this._datumsByKey;nextDatumsById=this._datumsById;hasExisting&&(this._sumAbsCache=null);}
var preserveExistingAddedDatums=null,notifyAddedDatums=!!this._linkChildren&&this._linkChildren.length>0;notifyAddedDatums&&hasExisting&&isPreserveExisting&&(preserveExistingAddedDatums=[]);if(def.array.is(setDatums))for(var i=0,L=setDatums.length;i<L;)maybeAddDatum.call(this,setDatums[i++]);else{if(!(setDatums instanceof def.Query))throw def.error.argumentInvalid("setDatums","Argument is of invalid type.");setDatums.each(maybeAddDatum,this);}
this.select&&this.select(nextDatums).forEach(function(removeDatum){cdo_removeDatumLocal.call(this,removeDatum);null!==preserveExistingAddedDatums&&preserveExistingAddedDatums.splice(preserveExistingAddedDatums.indexOf(removeDatum),1);},this);cdo_doAtomGC.call(this);notifyAddedDatums&&this._onDatumsAdded(preserveExistingAddedDatums||nextDatums);}
function cdo_doAtomGC(){for(var i=-1,datums=this._datums,L=datums.length;++i<L;)data_processDatumAtoms.call(this,datums[i],!1,!0);var dims=this._dimensionsList;i=-1;L=dims.length;for(;++i<L;)dim_uninternUnvisitedAtoms.call(dims[i]);}
function data_processDatumAtoms(datum,intern,markVisited){var dims=this._dimensionsList;dims||(intern=!1);if(intern||markVisited){var L,atom,dim,datoms=datum.atoms,i=0;if(dims){L=dims.length;for(;i<L;){dim=dims[i++];atom=datoms[dim.name];if(atom){intern&&dim_internAtom.call(dim,atom);markVisited&&(atom.visited=!0);}}}else{var dimNames=this.type.dimensionsNames();L=dimNames.length;for(;i<L;){atom=datoms[dimNames[i++]];atom&&(atom.visited=!0);}}}}
function cdo_removeDatumLocal(datum){var datums=this._datums,selDatums=this._selectedNotNullDatums,id=datum.id;datums.splice(datums.indexOf(datum),1);delete this._datumsById[id];delete this._datumsByKey[datum.key];selDatums&&datum.isSelected&&selDatums.rem(id);datum.isVisible&&this._visibleNotNullDatums.rem(id);}
function data_normalizeQuerySpec(querySpec){function processDatumFilter(datumFilter){if(null!=datumFilter){"object"==typeof datumFilter||def.fail.invalidArgument("datumFilter");var datumProcFilter={},any=!1;for(var dimName in datumFilter){var datumFilterValues=datumFilter[dimName],atoms=this.dimensions(dimName).getDistinctAtoms(null!==datumFilterValues?def.array.as(datumFilterValues):[null]);if(atoms.length){any=!0;datumProcFilter[dimName]=atoms;}}
any&&whereProcSpec.push(datumProcFilter);}}
var whereProcSpec=[];querySpec=def.array.as(querySpec);querySpec&&querySpec.forEach(processDatumFilter,this);return whereProcSpec;}
function data_whereState(q,keyArgs){var visible=def.get(keyArgs,"visible"),isNull=def.get(keyArgs,"isNull"),selected=def.get(keyArgs,"selected"),where=def.get(keyArgs,"where");null!=visible&&(q=q.where(visible?datum_isVisibleT:datum_isVisibleF));null!=isNull&&(q=q.where(isNull?datum_isNullT:datum_isNullF));null!=selected&&(q=q.where(selected?datum_isSelectedT:datum_isSelectedF));where&&(q=q.where(where));return q;}
function data_wherePredicate(querySpec,keyArgs){var visible=def.get(keyArgs,"visible"),isNull=def.get(keyArgs,"isNull"),selected=def.get(keyArgs,"selected"),where=def.get(keyArgs,"where"),ps=[];null!=visible&&ps.unshift(visible?datum_isVisibleT:datum_isVisibleF);null!=isNull&&ps.unshift(isNull?datum_isNullT:datum_isNullF);null!=selected&&ps.unshift(selected?datum_isSelectedT:datum_isSelectedF);where&&ps.unshift(where);querySpec&&ps.unshift(cdo_querySpecPredicate(querySpec));var P=ps.length;if(P){if(1===P)return ps[0];return function(d){for(var i=P;i;)if(!ps[--i](d))return!1;return!0;};}
return null;}
function cdo_querySpecPredicate(querySpec){function datumQuerySpecPredicate(d){for(var datoms=d.atoms,i=0;i<L;i++)if(datumFilterPredicate(datoms,querySpec[i]))return!0;return!1;}
function datumFilterPredicate(datoms,datumFilter){for(var dimName in datumFilter)if(datumFilter[dimName].indexOf(datoms[dimName])<0)return!1;return!0;}
var L=querySpec.length;return datumQuerySpecPredicate;}
function data_where(normalizedQuerySpec,keyArgs){var orderBys=def.array.as(def.get(keyArgs,"orderBy")),datumKeyArgs=def.create(keyArgs||{},{orderBy:null});return def.query(normalizedQuerySpec).selectMany(function(normalizedDatumFilter,index){orderBys&&(datumKeyArgs.orderBy=orderBys[index]);return data_queryDatumFilter.call(this,normalizedDatumFilter,datumKeyArgs);},this).distinct(def.propGet("id"));}
function data_queryDatumFilter(normalizedDatumFilter,keyArgs){var orderBySpecText=keyArgs.orderBy;if(orderBySpecText){if(orderBySpecText.indexOf("|")>=0)throw def.error.argumentInvalid("keyArgs.orderBy","Multi-dimension order by is not supported.");}else orderBySpecText=Object.keys(normalizedDatumFilter).sort().join(",");var rootData=this.groupBy(orderBySpecText,keyArgs),H=rootData.treeHeight,stateStack=[];return def.query(function(){var state;if(this._data){if(this._datumsQuery){this._data||def.assert("Must have a current data");stateStack.length||def.assert("Must have a parent data");!this._dimAtomsOrQuery||def.assert();if(this._datumsQuery.next()){this.item=this._datumsQuery.item;return 1;}
this._datumsQuery=null;state=stateStack.pop();this._data=state.data;this._dimAtomsOrQuery=state.dimAtomsOrQuery;}}else{this._data=rootData;this._dimAtomsOrQuery=def.query(normalizedDatumFilter[rootData.groupingLevelSpec.dimensions[0].name]);}
this._dimAtomsOrQuery||def.assert("Invalid programmer");this._data||def.assert("Must have a current data");for(var depth=stateStack.length;;){for(;this._dimAtomsOrQuery.next();){var dimAtomOr=this._dimAtomsOrQuery.item,childData=this._data.child(dimAtomOr.key);if(childData&&(depth<H-1||childData._datums.length)){stateStack.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery});this._data=childData;if(!(depth<H-1)){this._dimAtomsOrQuery=null;this._datumsQuery=def.query(childData._datums);this._datumsQuery.next();this.item=this._datumsQuery.item;return 1;}
this._dimAtomsOrQuery=def.query(normalizedDatumFilter[childData.groupingLevelSpec.dimensions[0].name]);depth++;}}
if(!depth)return 0;state=stateStack.pop();this._data=state.data;this._dimAtomsOrQuery=state.dimAtomsOrQuery;depth--;}
return 0;});}
function groupSpec_parseGroupingLevel(groupLevelText,complexType,extensionComplexTypesMap){def.string.is(groupLevelText)||def.fail.argumentInvalid("groupLevelText","Invalid grouping specification.");return def.query(groupLevelText.split(/\s*\|\s*/)).where(def.truthy).select(function(dimSpecText){var match=groupSpec_matchDimSpec.exec(dimSpecText)||def.fail.argumentInvalid("groupLevelText","Invalid grouping level syntax '{0}'.",[dimSpecText]),name=match[1],order=(match[2]||"").toLowerCase(),isReversed="desc"===order,dimSpec=new cdo.GroupingDimensionSpec(name,isReversed);complexType&&dimSpec.bindComplexType(complexType,extensionComplexTypesMap);return dimSpec;});}
function relTransl_dataPartGet(plot2DataSeriesIndexes,seriesReader){function calcAxis2SeriesKeySet(){var atoms={},seriesKeys=def.query(me.source).select(function(row){seriesReader(row,atoms);var value=atoms.series;null!=value&&null!=value.v&&(value=value.v);return value||null;}).distinct().array();return me._createPlot2SeriesKeySet(plot2DataSeriesIndexes,seriesKeys);}
var me=this;this._dataPartGet(calcAxis2SeriesKeySet);}
function numForm_tryConfigure(other){return def.string.is(other)?!!this.mask(other):def.is(other,numForm)?!!this.mask(other.mask()).style(other.style()):void 0;}
function numForm_cachedFormatter(mask){mask||(mask="");var key="_"+mask,f=numForm_cache[key];if(!f){if(numForm_cacheCount===numForm.cacheLimit){numForm_cache={};numForm_cacheCount=0;}
numForm_cache[key]=f=numberFormatter(mask);numForm_cacheCount++;}
return f;}
function numberFormatter(mask){function formatter(value,style){if(null==value)return nullFormat?nullFormat(style):"";value=+value;return isNaN(value)||!isFinite(value)?"":posFormat?0===value?zeroFormat?zeroFormat(style):posFormat(style,value,null,!1):value>0?posFormat(style,value,zeroFormat,!1):negFormat?negFormat(style,-value,zeroFormat||posFormat):posFormat(style,-value,zeroFormat,!0):String(value);}
var posFormat,negFormat,zeroFormat,nullFormat;!function(){var L,section,posSection,sections=numForm_parseMask(mask);sections.forEach(numForm_compileSection);L=sections.length;posFormat=nullFormat=negFormat=zeroFormat=null;if(L){posFormat=numForm_buildFormatSectionPosNeg(posSection=sections[0]);if(L>1){section=sections[1];negFormat=numForm_buildFormatSectionPosNeg(section.empty?posSection:section);if(L>2){section=sections[2];zeroFormat=numForm_buildFormatSectionZero(section.empty?posSection:section);if(L>3){section=sections[3];nullFormat=numForm_buildFormatSectionNull(section.empty?posSection:section);if(L>4)throw new Error("Invalid mask. More than 4 sections.");}}}}}();return formatter;}
function numForm_parseMask(mask){var sections=[];if(mask){var c,section,part,dcount,i=-1,L=mask.length,textFrag="",empty=1,beforeDecimal=1,hasInteger=0,hasDot=0,addToken0=function(token){empty=0;part.list.push(token);},addTextFrag=function(t){empty=0;textFrag+=t;},endTextFrag=function(){if(textFrag){tryParseAbbrCurr();addToken0({type:0,text:textFrag});textFrag="";}},addToken=function(token){endTextFrag();addToken0(token);},endInteger=function(){endTextFrag();!hasInteger&&hasDot&&addToken0({type:2});part.digits=dcount;dcount=0;beforeDecimal=0;part=section.fractional;},endSection=function(){if(section&&(!empty||!sections.length)){beforeDecimal?endInteger():endTextFrag();part.digits=dcount;sections.push(section);}
empty=beforeDecimal=1;hasDot=dcount=hasInteger=0;section={empty:0,scale:0,groupOn:0,scientific:0,abbreviationOn:0,integer:{list:[],digits:0},fractional:{list:[],digits:0}};part=section.integer;},tryParseAbbrCurr=function(){if("A"===textFrag){textFrag="";addToken({type:6});}else if("C"===textFrag){textFrag="";addToken({type:4});}else if("AC"===textFrag){textFrag="";addToken({type:6});addToken({type:4});}else if("CA"===textFrag){textFrag="";addToken({type:4});addToken({type:6});}};endSection();for(;++i<L;){c=mask.charAt(i);if("0"===c){addToken({type:1});hasInteger=1;dcount++;}else if("#"===c){addToken({type:2});hasInteger=1;dcount++;}else if(","===c)beforeDecimal&&addToken({type:3});else if("."===c){if(beforeDecimal){hasDot=1;endInteger();}}else if(""===c)addToken({type:4});else if("C"===c&&"Currency"===mask.substring(i,i+8)){addToken({type:4});i+=7;}else if("A"===c&&"Abbreviation"===mask.substring(i,i+12)){addToken({type:6});i+=11;}else if(";"===c){endSection();if(i+1>=L||";"===mask.charAt(i+1)){i++;sections.push({empty:1});}}else if("\\"===c){i++;i<L&&addTextFrag(mask.charAt(i));}else if('"'===c){i++;var j=mask.indexOf(c,i);j<0&&(j=L);addTextFrag(mask.substring(i,j));i=j;}else if(" "===c)addToken({type:7});else if("e"!==c&&"E"!==c||!function(){var c2,k=i+1,positive=!1,digits=0;if(k<L){c2=mask.charAt(k);if("-"===c2||"+"===c2){positive="+"===c2;if(!(++k<L))return 0;c2=mask.charAt(k);}
for(;"0"===c2&&++digits&&++k<L&&(c2=mask.charAt(k)););if(digits){i=k-1;addToken({type:5,text:c,digits:digits,positive:positive});section.scientific=1;return 1;}}
return 0;}()){"%"===c?section.scale+=2:""===c?section.scale+=3:""===c&&(section.scale+=4);addTextFrag(c);}else;}
endSection();}
return sections;}
function numForm_compileSection(section){if(!section.empty){numForm_compileSectionPart(section,!0);numForm_compileSectionPart(section,!1);}}
function numForm_compileSectionPart(section,beforeDecimal){function addStep(step){steps[stepMethName](step);}
for(var token,type,stepMethName=beforeDecimal?"push":"unshift",part=section[beforeDecimal?"integer":"fractional"],tokens=part.list,steps=part.list=[],digit=part.digits-1,hasInteger=0,hasZero=0,L=tokens.length,i=beforeDecimal?0:L,nextToken=beforeDecimal?function(){return i<L?tokens[i++]:null;}:function(){return i>0?tokens[--i]:null;};token=nextToken();)switch(type=token.type){case 0:addStep(numForm_buildLiteral(token.text));break;case 1:case 2:hasZero&&2===type&&(type=1);addStep(numForm_buildReadDigit(beforeDecimal,digit,1===type,!hasInteger));digit--;hasInteger=1;hasZero||1!==type||(hasZero=1);break;case 3:numForm_hasIntegerAhead(tokens,i,L)?hasInteger&&(section.groupOn=1):section.scale-=3;break;case 4:addStep(numFormRt_currencySymbol);break;case 5:addStep(numForm_buildExponent(section,token));break;case 6:section.abbreviationOn=1;addStep(numForm_abbreviationSymbol);break;case 7:addStep(numForm_buildLiteral(" "));}!beforeDecimal&&part.digits&&steps.unshift(numForm_buildReadDecimalSymbol(hasZero));}
function numForm_hasIntegerAhead(tokens,i,L){for(;i<L;){var type=tokens[i++].type;if(1===type||2===type)return 1;}
return 0;}
function numForm_buildFormatSectionZero(section){function numFormRt_formatSectionZero(style){return numFormRt_formatSection(section,style,0,!1);}
return numFormRt_formatSectionZero;}
function numForm_buildFormatSectionNull(section){function numFormRt_formatSectionNull(style){return numFormRt_formatSection(section,style,"",!1);}
return numFormRt_formatSectionNull;}
function numForm_buildFormatSectionPosNeg(section){function numFormRt_formatSectionPosNeg(style,value,zeroFormat,negativeMode){var sdigits,abbreviation,value0=value,exponent=0,scale=section.scale;if(section.abbreviationOn)for(var L=style.abbreviations.length,i=L;i>0;i--){var y=3*i;if(Math.pow(10,y)<=value){scale-=y;abbreviation=i-1;break;}}
if(section.scientific){sdigits=Math.floor(Math.log(value)/Math.LN10);exponent=scale+sdigits-section.integer.digits+1;scale-=exponent;}
scale&&(value=def.mult10(value,scale));value=def.round10(value,section.fractional.digits);return!value&&zeroFormat?zeroFormat(style,value0):numFormRt_formatSection(section,style,value,negativeMode,exponent,abbreviation);}
return numFormRt_formatSectionPosNeg;}
function numFormRt_formatSection(section,style,value,negativeMode,exponent,abbreviation){var svalue=""+value,idot=svalue.indexOf("."),itext=idot<0?svalue:svalue.substr(0,idot),ftext=idot<0?"":svalue.substr(idot+1);"0"===itext&&(itext="");exponent||(exponent=0);var out=[];negativeMode&&out.push(style.negativeSign);itext=itext.split("");ftext=ftext.split("");style.group&&section.groupOn&&numFormRt_addGroupSeparators(style,itext);section.integer.list.forEach(function(f){out.push(f(style,itext,exponent,abbreviation));});section.fractional.list.forEach(function(f){out.push(f(style,ftext,exponent,abbreviation));});return out.join("");}
function numFormRt_addGroupSeparators(style,itext){for(var S,gsym=style.group,separate=function(){itext[D-d-1]+=gsym;},D=itext.length,gs=style.groupSizes,G=gs.length,d=0,g=-1;++g<G;){d+=S=gs[g];if(!(d<D))return;separate();}
for(;(d+=S)<D;)separate();}
function numForm_buildLiteral(s){function numFormRt_literal(){return s;}
return numFormRt_literal;}
function numForm_buildReadDigit(beforeDecimal,digit,zero,edge){function numFormRt_stylePadding(style){return style[beforeDecimal?"integerPad":"fractionPad"];}
function numFormRt_readInteger(style,text){var L=text.length;if(digit<L){var i=L-1-digit;return edge?text.slice(0,i+1).join(""):text[i];}
return pad?pad(style):"";}
function numFormRt_readFractional(style,text){return digit<text.length?text[digit]:pad?pad(style):"";}
var pad=zero?numFormRt_stylePadding:null;return beforeDecimal?numFormRt_readInteger:numFormRt_readFractional;}
function numForm_buildReadDecimalSymbol(hasZero){return hasZero?numFormRt_decimalSymbol:numFormRt_decimalSymbolUnlessInt;}
function numForm_buildExponent(section,token){function numFormRt_exponent(style,text,exponent){var sign=exponent<0?style.negativeSign:token.positive?"+":"",exp=""+Math.abs(exponent),P=token.digits-exp.length;P>0&&(exp=new Array(P+1).join("0")+exp);return token.text+sign+exp;}
return numFormRt_exponent;}
function numFormRt_decimalSymbol(style){return style.decimal;}
function numFormRt_decimalSymbolUnlessInt(style,ftext){return ftext.length?style.decimal:"";}
function numFormRt_currencySymbol(style){return style.currency;}
function numForm_abbreviationSymbol(style,text,exponent,abbreviation){if(null!=abbreviation)return style.abbreviations[abbreviation];}
function dateForm_tryConfigure(other){return def.string.is(other)?!!this.mask(other):def.is(other,dateForm)?!!this.mask(other.mask()):void 0;}
function dateForm_createFormatter(mask){return mask?pv.Format.createFormatter(pv.Format.date(mask)):def.string.to;}
function customForm_tryConfigure(other){return def.is(other,customForm)?!!this.formatter(other.formatter()):def.fun.is(other)?!!this.formatter(other):void 0;}
function customForm_defaultFormatter(v){return null!=v?String(v):"";}
function formProvider_field(mainFactory){function fieldCast(value){return def.is(value,mainFactory)||def.is(value,customForm)?value:null;}
function fieldFactory(config,proto){return(def.fun.is(config)?customForm:mainFactory)(config,proto);}
return{cast:fieldCast,factory:fieldFactory};}
function formProvider_tryConfigure(other){switch(def.classOf(other)){case formProvider:return!!this.number(other.number()).percent(other.percent()).date(other.date()).any(other.any());case numForm:return!!this.number(other);case dateForm:return!!this.date(other);case customForm:return!!this.any(other);}
if(def.string.is(other)){var formP=langProvider(other);if(formP)return!!def.configure(this,formP);}}
function configLanguage(lang,config){lang=normalizeLanguageCode(lang);var langStyle=def.getOwn(_languages,lang);if(langStyle)def.configure(langStyle,config);else{langStyle=_languages[lang]=formProvider(config);langStyle.languageCode=lang;}
return langStyle;}
function parseLanguageCode(langCode){var re=/^([a-z]{2,8})(?:[-_]([a-z]{2}|\d{3}))?$/i,m=re.exec(langCode);if(!m)return null;var primary=m[1]?m[1].toLowerCase():"",region=m[2]?m[2].toLowerCase():"";return{code:primary+(region?"-"+region:""),primary:primary,region:region};}
function normalizeLanguageCode(langCode){return langCode?langCode.toLowerCase():"";}
function getLanguage(langCode,fallback){langCode=normalizeLanguageCode(langCode);var lang=def.getOwn(_languages,langCode);if(lang)return lang;if(!fallback)return null;var norm=parseLanguageCode(langCode);if(norm){if(norm.code!==langCode&&(lang=def.getOwn(_languages,norm.code)))return lang;if(norm.region&&(lang=def.getOwn(_languages,norm.primary)))return lang;}
return def.getOwn(_languages,_defaultLangCode,null);}
var cdo=def.globalSpace("cdo",{});def.type("cdo.DimensionType").init(function(complexType,name,keyArgs){this.complexType=complexType;this.name=name;this.label=def.get(keyArgs,"label")||def.titleFromName(name);var groupAndLevel=def.splitIndexedId(name);this.group=groupAndLevel[0];this.groupLevel=def.nullyTo(groupAndLevel[1],0);this.label.indexOf("{")>=0&&(this.label=def.format(this.label,[this.groupLevel+1]));this.isHidden=!!def.get(keyArgs,"isHidden");var valueType=def.get(keyArgs,"valueType")||null,valueTypeName=cdo.DimensionType.valueTypeName(valueType),cast=def.getOwn(cdo.DimensionType.cast,valueTypeName,null);this.valueType=valueType;this.valueTypeName=valueTypeName;this.cast=cast;var isNumber=this.valueType===Number,isDate=!isNumber&&this.valueType===Date;this.isDiscreteValueType=!isNumber&&!isDate;this.isDiscrete=def.get(keyArgs,"isDiscrete");if(null==this.isDiscrete)this.isDiscrete=this.isDiscreteValueType;else{this.isDiscrete=!!this.isDiscrete;if(!this.isDiscrete&&this.isDiscreteValueType)throw def.error.argumentInvalid("isDiscrete","The only supported continuous value types are Number and Date.");}
this._converter=def.get(keyArgs,"converter")||null;if(!this._converter){var rawFormat=def.get(keyArgs,"rawFormat");if(rawFormat)switch(this.valueType){case Date:this._converter=pv.Format.createParser(pv.Format.date(rawFormat));}}
this._key=def.get(keyArgs,"key")||null;null===this._key&&isDate&&(this._key=dimensionType_dateKey);this.setComparer(keyArgs&&keyArgs.comparer);var format,formatter=def.get(keyArgs,"formatter"),formatProto=def.get(keyArgs,"formatProto"),formatName=isNumber?"number":isDate?"date":"any";if(formatter)format=cdo.format(def.set({},formatName,formatter),formatProto);else if(this.isDiscreteValueType)format=formProvider(null,formatProto);else{format=def.get(keyArgs,"format");if(!format&&!isNumber){format=def.get(keyArgs,"rawFormat");format&&(format=format.replace(/-/g,"/"));}
if(format){if(!def.is(format,formProvider)){(def.string.is(format)||def.fun.is(format)&&!def.classOf(format))&&(format=def.set({},formatName,format));format=formProvider(format,formatProto);}}else format=formProvider(null,formatProto);formatter=format[formatName]();}
this._formatter=formatter||null;this._format=format||null;this.isKey=Boolean(def.get(keyArgs,"isKey"));}).add({isCalculated:!1,compare:function(a,b){return null==a?null==b?0:-1:null==b?1:this._comparer.call(null,a,b);},comparer:function(reverse){var me=this;return me.isComparable?reverse?me._rc||(me._rc=function(a,b){return me.compare(b,a);}):me._dc||(me._dc=function(a,b){return me.compare(a,b);}):null;},setComparer:function(comparer){if(void 0===comparer||!comparer&&!this.isDiscrete)switch(this.valueType){case Number:case Date:comparer=def.compare;}
this._comparer=comparer||null;this.isComparable=null!=this._comparer;this._rc=this._dc=this._rac=this._dac=null;},atomComparer:function(reverse){return reverse?this._rac||(this._rac=this._createReverseAtomComparer()):this._dac||(this._dac=this._createDirectAtomComparer());},_toDiscrete:function(){this.isDiscrete=!0;},_toCalculated:function(){this.isCalculated=!0;},_createReverseAtomComparer:function(){function reverseAtomComparer(a,b){return a===b?0:me.compare(b.value,a.value);}
if(!this.isComparable)return atom_idComparerReverse;var me=this;return reverseAtomComparer;},_createDirectAtomComparer:function(){function directAtomComparer(a,b){return a===b?0:me.compare(a.value,b.value);}
if(!this.isComparable)return atom_idComparer;var me=this;return directAtomComparer;},format:function(){return this._format;},formatter:function(){return this._formatter;},converter:function(){return this._converter;}});cdo.DimensionType.cast={Date:function(value){return value instanceof Date?value:new Date(value);},Number:function(value){value=Number(value);return isNaN(value)?null:value;},String:String,Boolean:Boolean,Object:Object,Any:null};cdo.DimensionType.dimensionGroupName=function(dimName){return dimName.replace(/^(.*?)(\d*)$/,"$1");};cdo.DimensionType.valueTypeName=function(valueType){if(null==valueType)return"Any";switch(valueType){case Boolean:return"Boolean";case Number:return"Number";case String:return"String";case Object:return"Object";case Date:return"Date";default:throw def.error.argumentInvalid("valueType","Invalid valueType function: '{0}'.",[valueType]);}};def.type("cdo.ComplexType").init(function(dimTypeSpecs,keyArgs){this._dims={};this._dimsList=[];this._dimsNames=[];this._calculations=[];this._calculatedDimNames={};this._dimsIndexByName=null;this._dimsByGroup={};this._dimsNamesByGroup={};this.format=formProvider(null,def.get(keyArgs,"formatProto"));this.nullNumberAtom=new cdo.NumberAtom(this,null);if(dimTypeSpecs)for(var name in dimTypeSpecs)this.addDimension(name,dimTypeSpecs[name]);}).add({describe:function(){var table=def.textTable(2).rowSep().row("Dimension","Properties").rowSep();this._dimsList.forEach(function(type){var features=[];features.push('"'+type.label+'"');features.push(type.valueTypeName);type.isComparable&&features.push("comparable");type.isDiscrete||features.push("continuous");type.isHidden&&features.push("hidden");table.row(type.name,features.join(", "));});table.rowSep(!0);return"COMPLEX TYPE INFORMATION\n"+table()+"\n";},dimensions:function(name,keyArgs){if(null==name)return this._dims;var dimType=def.getOwn(this._dims,name,null);if(!dimType&&def.get(keyArgs,"assertExists",!0))throw def.error.argumentInvalid("name","Undefined dimension '{0}'",[name]);return dimType;},filterExtensionDimensionNames:function(dimNames){return dimNames.filter(function(dimName){return!!def.hasOwn(this,dimName);},this._dims);},dimensionsList:function(){return this._dimsList;},calculatedDimensionsList:function(){return this._calcDimsList;},dimensionsNames:function(){return this._dimsNames;},groupDimensions:function(group,keyArgs){var dims=def.getOwn(this._dimsByGroup,group);if(!dims&&def.get(keyArgs,"assertExists",!0))throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[group]);return dims;},groupDimensionsNames:function(group,keyArgs){var dimNames=def.getOwn(this._dimsNamesByGroup,group);if(!dimNames&&def.get(keyArgs,"assertExists",!0))throw def.error.operationInvalid("There is no dimension type group with name '{0}'.",[group]);return dimNames;},addDimension:function(name,dimTypeSpec){name||def.fail.argumentRequired("name");!def.hasOwn(this._dims,name)||def.fail.operationInvalid("A dimension type with name '{0}' is already defined.",[name]);var dimension=new cdo.DimensionType(this,name,dimTypeSpec);this._dims[name]=dimension;this._dimsIndexByName=null;var groupLevel,group=dimension.group;if(group){var groupDimsNames,groupDims=def.getOwn(this._dimsByGroup,group);if(groupDims)groupDimsNames=this._dimsNamesByGroup[group];else{groupDims=this._dimsByGroup[group]=[];groupDimsNames=this._dimsNamesByGroup[group]=[];}
groupLevel=def.array.insert(groupDimsNames,name,def.compare);groupLevel=~groupLevel;def.array.insertAt(groupDims,groupLevel,dimension);}
var index,L=this._dimsList.length;if(group){groupLevel=dimension.groupLevel;for(var i=0;i<L;i++){var dim=this._dimsList[i];if(dim.group===group){if(dim.groupLevel>groupLevel){index=i;break;}
index=i+1;}}
null==index&&(index=L);}else index=L;def.array.insertAt(this._dimsList,index,dimension);def.array.insertAt(this._dimsNames,index,name);if(dimension._calculate){index=def.array.binarySearch(this._calcDimsList,dimension._calculationOrder,def.compare,function(dimType){return dimType._calculationOrder;});index>=0?index++:index=~index;def.array.insertAt(this._calcDimsList,index,dimension);}
return dimension;},addCalculation:function(calcSpec){calcSpec||def.fail.argumentRequired("calcSpec");var calculation=calcSpec.calculation||def.fail.argumentRequired("calculations[i].calculation"),dimNames=calcSpec.names;dimNames=def.string.is(dimNames)?dimNames.split(/\s*\,\s*/):def.array.as(dimNames);if(dimNames&&dimNames.length){var calcDimNames=this._calculatedDimNames;dimNames.forEach(function(name){if(name){name=name.replace(/^\s*(.+?)\s*$/,"$1");!def.hasOwn(calcDimNames,name)||def.fail.argumentInvalid("calculations[i].names","Dimension name '{0}' is already being calculated.",[name]);var dimType=this._dims[name]||def.fail.argumentInvalid("calculations[i].names","Undefined dimension with name '{0}'' ",[name]);calcDimNames[name]=!0;dimType._toCalculated();}},this);}
this._calculations.push(calculation);},isCalculated:function(dimName){return def.hasOwn(this._calculatedDimNames,dimName);},_calculate:function(complex){var calcs=this._calculations,L=calcs.length;if(L){for(var valuesByName={},i=0;i<L;i++){(0,calcs[i])(complex,valuesByName);}
return valuesByName;}},sortDimensionNames:function(dims,nameKey){var dimsIndexByName=this._dimsIndexByName;if(!dimsIndexByName){dimsIndexByName=def.query(this._dimsList).object({name:function(dim){return dim.name;},value:function(dim,index){return index;}});this._dimsIndexByName=dimsIndexByName;}
dims.sort(function(da,db){return def.compare(dimsIndexByName[nameKey?nameKey(da):da],dimsIndexByName[nameKey?nameKey(db):db]);});return dims;}});def.type("cdo.ComplexTypeProject").init(function(dimGroupSpecs){this._dims={};this._dimList=[];this._dimGroupsDims={};this._dimGroupSpecs=dimGroupSpecs||{};this._calcList=[];}).add({_ensureDim:function(name,spec){name||def.fail.argumentInvalid("name","Invalid dimension name '{0}'.",[name]);var info=def.getOwn(this._dims,name);if(info)spec&&def.setUDefaults(info.spec,spec);else{info=this._dims[name]=this._createDim(name,spec);this._dimList.push(info);var groupDimsNames=def.array.lazy(this._dimGroupsDims,info.groupName);def.array.insert(groupDimsNames,name,def.compare);}
return info;},hasDim:function(name){return def.hasOwn(this._dims,name);},setDim:function(name,spec){var _=this._ensureDim(name).spec;spec&&def.copy(_,spec);return this;},setDimDefaults:function(name,spec){def.setUDefaults(this._ensureDim(name).spec,spec);return this;},_createDim:function(name,spec){var dimGroupName=cdo.DimensionType.dimensionGroupName(name),dimGroupSpec=this._dimGroupSpecs[dimGroupName];dimGroupSpec&&(spec=def.create(dimGroupSpec,spec));return{name:name,groupName:dimGroupName,spec:spec||{}};},readDim:function(name,spec){var info=this._ensureDim(name,spec);if(info.isRead)throw def.error.operationInvalid("Dimension '{0}' already is the target of a reader.",[name]);if(info.isCalc)throw def.error.operationInvalid("Dimension '{0}' is being calculated, so it cannot be the target of a reader.",[name]);info.isRead=!0;},calcDim:function(name,spec){var info=this._ensureDim(name,spec);if(info.isCalc)throw def.error.operationInvalid("Dimension '{0}' already is being calculated.",[name]);if(info.isRead)throw def.error.operationInvalid("Dimension '{0}' is the target of a reader, so it cannot be calculated.",[name]);info.isCalc=!0;},isReadOrCalc:function(name){if(name){var info=def.getOwn(this._dims,name);if(info)return info.isRead||info.isCalc;}
return!1;},groupDimensionsNames:function(groupDimName){return this._dimGroupsDims[groupDimName];},setCalc:function(calcSpec){calcSpec||def.fail.argumentRequired("calculations[i]");calcSpec.calculation||def.fail.argumentRequired("calculations[i].calculation");var dimNames=calcSpec.names;dimNames=def.string.is(dimNames)?dimNames.split(/\s*\,\s*/):def.array.as(dimNames);dimNames&&dimNames.length&&dimNames.forEach(this.calcDim,this);this._calcList.push(calcSpec);},configureComplexType:function(complexType,dimsOptions){this._dimList.forEach(function(dimInfo){var dimName=dimInfo.name,spec=dimInfo.spec;spec=this._extendSpec(dimName,spec,dimsOptions);complexType.addDimension(dimName,spec);},this);this._calcList.forEach(function(calcSpec){complexType.addCalculation(calcSpec);});},_extendSpec:function(dimName,dimSpec,keyArgs){var dimGroup=cdo.DimensionType.dimensionGroupName(dimName);dimSpec||(dimSpec={});switch(dimGroup){case"category":def.get(keyArgs,"isCategoryTimeSeries",!1)&&void 0===dimSpec.valueType&&(dimSpec.valueType=Date);break;case"value":void 0===dimSpec.valueType&&(dimSpec.valueType=Number);}
void 0!==dimSpec.converter||dimSpec.valueType!==Date||dimSpec.rawFormat||(dimSpec.rawFormat=def.get(keyArgs,"timeSeriesFormat"));dimSpec.formatProto=def.get(keyArgs,"formatProto");return dimSpec;}});def.type("cdo.Atom").init(function(dimension,value,label,rawValue,key){this.dimension=dimension;this.id=null==value?-def.nextId():def.nextId();this.value=value;this._label=null==label?null:label;void 0!==rawValue&&(this.rawValue=rawValue);this.key=key;}).add({isVirtual:!1,rawValue:void 0,get label(){var label=this._label;null===label&&(this._label=label=this.dimension.format(this.value,this.rawValue));return label;},set label(label){this._label=def.string.to(label);},get labelPercent(){return this.dimension.type.format().percent()(this.value);},toString:function(){var label=this.label;if(null!=label)return label;label=this.value;return null!=label?""+label:"";}});def.type("cdo.NumberAtom").init(function(complexType,value,label){this.complexType=complexType;this.id=def.nextId();this.value=null==value?null:value;this._label=null==label?null:label;this.key=null==value?"":value.toString();}).add({dimension:null,get key(){return""+this.value;},get rawValue(){return this.value;},get label(){var label=this._label;null===label&&(this._label=label=this.complexType.format.number()(this.value,this.rawValue));return label;},set label(label){this._label=def.string.to(label);},get labelPercent(){return this.complexType.format.percent()(this.value);}});var complex_nextId=1;def.type("cdo.Complex").init(function(source,atomsByName,dimNames,atomsBase,wantLabel,calculate){this.id=complex_nextId++;atomsBase||(atomsBase=null);var owner;if(source){owner=source.owner;null===atomsBase&&(atomsBase=source.atoms);}else owner=this;this.owner=owner;this.atoms=atomsBase?Object.create(atomsBase):{};var dimNamesSpecified=!!dimNames;dimNames||(dimNames=owner.type._dimsNames);if(atomsByName){var dimName,atomsMap=this.atoms,ownerDims=owner._dimensions,addAtom=function(addDimName){var atom=atomsByName[addDimName],ownerDim=ownerDims[addDimName];if(void 0===ownerDim){if(!dimNamesSpecified)throw def.error.operationInvalid("Extension atom values require dimension names to be specified.");if(!(atom instanceof cdo.Atom))throw def.error.operationInvalid("Extension atom values must be cdo.Atom instances.");atomsMap[addDimName]=atom;}else{atom=ownerDim.intern(atom);null==atom.value||null!==atomsBase&&atom===atomsBase[addDimName]||(atomsMap[addDimName]=atom);}};if(dimNamesSpecified)for(var i=-1,D=dimNames.length;++i<D;)addAtom(dimNames[i]);else for(dimName in atomsByName)addAtom(dimName);if(calculate){atomsByName=owner.type._calculate(this);for(dimName in atomsByName)def.hasOwnProp.call(atomsMap,dimName)||addAtom(dimName);}}
this._initValueKeyLabel(dimNames,wantLabel);}).add({labelSep:" ~ ",keySep:"~",value:null,label:null,rawValue:void 0,_initValueKeyLabel:function(dimNames,wantLabel){var atom,D=dimNames.length;if(0===D){this.key="";this.value=null;wantLabel&&(this.label="");}else if(1===D){atom=this.atoms[dimNames[0]];this.key=this._getAtomKey(atom);this.value=atom.value;this.rawValue=atom.rawValue;wantLabel&&(this.label=atom.label);}else{for(var value,atomKey,atomLabel,key="",keySep=this.owner.keySep,labelSep=this.owner.labelSep,atomsMap=this.atoms,label="",i=-1;++i<D;){atom=atomsMap[dimNames[i]];0===i?value=atom.key:value+=keySep+atom.key;atomKey=this._getAtomKey(atom);null!==atomKey&&(0===i?key=atomKey:key+=keySep+atomKey);wantLabel&&""!==(atomLabel=atom.label)&&(""===label?label=atomLabel:label+=labelSep+atomLabel);}
this.value=this.rawValue=value;this.key=key;wantLabel&&(this.label=label);}},_getAtomKey:function(atom){return atom.key;},getSpecifiedAtom:function(dimName){return this.atoms[dimName];},ensureLabel:function(){var label=this.label;if(null==label){label="";var labelSep=this.owner.labelSep;def.eachOwn(this.atoms,function(atom){var alabel=atom.label;alabel&&(label?label+=labelSep+alabel:label=alabel);});this.label=label;}
return label;},view:function(dimNames){return new cdo.ComplexView(this,dimNames);},toString:function(){var s=[""+def.qualNameOf(this.constructor)];null!=this.index&&s.push("#"+this.index);this.owner.type.dimensionsNames().forEach(function(name){s.push(name+": "+def.describe(this.atoms[name].value));},this);return s.join(" ");},rightTrimKeySep:function(key){return key&&cdo.Complex.rightTrimKeySep(key,this.owner.keySep);},absKeyTrimmed:function(){return this.rightTrimKeySep(this.absKey);},keyTrimmed:function(){return this.rightTrimKeySep(this.key);}});cdo.Complex.rightTrimKeySep=function(key,keySep){if(key&&keySep)for(var j,K=keySep.length;key.lastIndexOf(keySep)===(j=key.length-K)&&j>=0;)key=key.substr(0,j);return key;};cdo.Complex.values=function(complex,dimNames){var atoms=complex.atoms;return dimNames.map(function(dimName){return atoms[dimName].value;});};cdo.Complex.compositeKey=function(complex,dimNames){for(var key="",D=dimNames.length,keySep=complex.owner.keySep,datoms=complex.atoms,i=0;i<D;i++){var k=datoms[dimNames[i]].key;i?key+=keySep+k:key=k;}
return key;};cdo.Complex.labels=function(complex,dimNames){var atoms=complex.atoms;return dimNames.map(function(dimName){return atoms[dimName].label;});};var complex_id=def.propGet("id");def.type("cdo.ComplexView",cdo.Complex).init(function(source,viewDimNames){this.source=source;this.viewDimNames=viewDimNames;this.base(source,source.atoms,viewDimNames,source.owner.atoms,!0);}).add({values:function(){return cdo.Complex.values(this,this.viewDimNames);},labels:function(){return cdo.Complex.labels(this,this.viewDimNames);}});def.type("cdo.Datum",cdo.Complex).init(function(data,atomsByName,dimNames){this.base(data,atomsByName,dimNames,null,!1,!0);this.key||(this.key=this.id);}).add({isSelected:!1,isVisible:!0,isNull:!1,isVirtual:!1,isTrend:!1,trend:null,isInterpolated:!1,interpolation:null,_getAtomKey:function(atom){return atom.dimension.isKey?atom.key:null;},setSelected:function(select){if(this.isNull)return!1;select=null==select||!!select;var changed=this.isSelected!==select;if(changed){select?this.isSelected=!0:delete this.isSelected;data_onDatumSelectedChanged.call(this.owner,this,select);}
return changed;},toggleSelected:function(){return this.setSelected(!this.isSelected);},setVisible:function(visible){if(this.isNull)return!1;visible=null==visible||!!visible;var changed=this.isVisible!==visible;if(changed){this.isVisible=visible;data_onDatumVisibleChanged.call(this.owner,this,visible);}
return changed;},toggleVisible:function(){return this.setVisible(!this.isVisible);}});var datum_isSelected=cdo.Datum.isSelected=def.propGet("isSelected");cdo.Datum.isSelectedT=datum_isSelectedT;cdo.Datum.isSelectedF=datum_isSelectedF;cdo.Datum.isVisibleT=datum_isVisibleT;cdo.Datum.isVisibleF=datum_isVisibleF;cdo.Datum.isNullT=datum_isNullT;cdo.Datum.isNullF=datum_isNullF;def.type("cdo.TrendDatum",cdo.Datum).init(function(data,atomsByName,dimNames,trend){this.base(data,atomsByName,dimNames);this.trend=trend;}).add({isVirtual:!0,isTrend:!0});def.type("cdo.InterpolationDatum",cdo.Datum).init(function(data,atomsByName,dimNames,interpolation,dimName){this.base(data,atomsByName,dimNames);this.interpolation=interpolation;this.interpDimName=dimName;}).add({isVirtual:!0,isInterpolated:!0});var dim_keyArgsAbsTrue={abs:!0};def.type("cdo.Dimension").init(function(data,type){this.data=data;this.type=type;this.root=this;this.owner=this;var name=type.name;this.name=name;this._atomComparer=type.atomComparer();this._atomsByKey={};this.isKey=type.isKey;if(data.isOwner()){this._atoms=[];this._lazyInit=null;dim_createVirtualNullAtom.call(this);}else{var source,parentData=data.parent;if(parentData){source=parentData._dimensions[name];dim_addChild.call(source,this);this.root=data.parent.root;}else{parentData=data.linkParent;parentData||def.assert("Data must have a linkParent");source=parentData._dimensions[name];dim_addLinkChild.call(source,this);}
this._nullAtom=this.owner._nullAtom;this._lazyInit=function(){this._lazyInit=null;for(var datums=this.data._datums,L=datums.length,atomsByKey=this._atomsByKey,isDiscrete=type.isDiscrete,i=0;i<L;i++){var datum=datums[i];if(isDiscrete||!datum.isNull){var atom=datum.atoms[name];atomsByKey[atom.key]=atom;}}
this._atoms=source.atoms().filter(function(atom){return def.hasOwnProp.call(atomsByKey,atom.key);});};}}).add({parent:null,linkParent:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:!1,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){null!==this._lazyInit&&this._lazyInit();return this._atoms.length;},isVisible:function(atom){null!==this._lazyInit&&this._lazyInit();def.hasOwn(this._atomsByKey,atom.key)||def.assert("Atom must exist in this dimension.");return dim_getVisibleDatumsCountMap.call(this)[atom.key]>0;},atoms:function(keyArgs){null!==this._lazyInit&&this._lazyInit();var visible=def.get(keyArgs,"visible");if(null==visible)return this._atoms;visible=!!visible;this._visibleAtoms||(this._visibleAtoms={});return this._visibleAtoms[visible]||(this._visibleAtoms[visible]=dim_calcVisibleAtoms.call(this,visible));},indexes:function(keyArgs){null!==this._lazyInit&&this._lazyInit();var visible=def.get(keyArgs,"visible");if(null==visible)return pv.range(0,this._atoms.length);visible=!!visible;this._visibleIndexes||(this._visibleIndexes={});return this._visibleIndexes[visible]||(this._visibleIndexes[visible]=dim_calcVisibleIndexes.call(this,visible));},atom:function(value){if(null==value||""===value)return this._nullAtom;if(value instanceof cdo.Atom)return value;null!==this._lazyInit&&this._lazyInit();var typeKey=this.type._key,key=typeKey?typeKey.call(null,value):value;return this._atomsByKey[key]||null;},getDistinctAtoms:function(values){var atom,key,atomsByKey,atoms=[],L=values?values.length:0;if(L){atomsByKey={};for(var i=0;i<L;i++)if((atom=this.atom(values[i]))&&!atomsByKey[key="\0"+atom.key]){atomsByKey[key]=atom;atoms.push(atom);}}
return atoms;},extent:function(keyArgs){var tmp,atoms=this.atoms(keyArgs),L=atoms.length;if(L){var offset=this._nullAtom&&null==atoms[0].value?1:0,countWithoutNull=L-offset;if(countWithoutNull>0){var min=atoms[offset],max=atoms[L-1];if(min!==max&&def.get(keyArgs,"abs",!1)){var minSign=min.value<0?-1:1,maxSign=max.value<0?-1:1;if(minSign===maxSign)maxSign<0&&(tmp=max,max=min,min=tmp);else if(countWithoutNull>2){max.value<-min.value&&(max=min);var zeroIndex=def.array.binarySearch(atoms,0,this.type.comparer(),function(a){return a.value;});if(zeroIndex<0){zeroIndex=~zeroIndex;var negAtom=atoms[zeroIndex-1],posAtom=atoms[zeroIndex];min=-negAtom.value<posAtom.value?negAtom:posAtom;}else min=atoms[zeroIndex];}else max.value<-min.value&&(tmp=max,max=min,min=tmp);}
return{min:min,max:max};}}},min:function(keyArgs){var atoms=this.atoms(keyArgs),L=atoms.length;if(L){var offset=this._nullAtom&&null==atoms[0].value?1:0;return L>offset?atoms[offset]:void 0;}},max:function(keyArgs){var atoms=this.atoms(keyArgs),L=atoms.length;return L&&null!=atoms[L-1].value?atoms[L-1]:void 0;},sumAbs:function(keyArgs){return this.sumAbsAtom(keyArgs).value;},value:function(keyArgs){return this.valueAtom(keyArgs).value;},valueAbs:function(keyArgs){return this.valueAbsAtom(keyArgs).value;},sum:function(keyArgs){return this.sumAtom(keyArgs).value;},sumAtom:function(keyArgs){var isAbs=!!def.get(keyArgs,"abs",!1),zeroIfNone=def.get(keyArgs,"zeroIfNone",!0),key=dim_buildDatumsFilterKey(keyArgs)+":"+isAbs,sumAtom=def.getOwn(this._sumCache,key);if(void 0===sumAtom){var dimName=this.name,sum=this.data.datums(null,keyArgs).reduce(function(result,datum){if(datum.isNull)return result;var value=datum.atoms[dimName].value;if(null===value)return result;isAbs&&value<0&&(value=-value);return null!=result?result+value:value;},null);(this._sumCache||(this._sumCache={}))[key]=sumAtom=this.read(sum);}
return zeroIfNone&&null===sumAtom.value?this.read(0):sumAtom;},sumAbsAtom:function(keyArgs){keyArgs=keyArgs?def.create(keyArgs,dim_keyArgsAbsTrue):dim_keyArgsAbsTrue;return this.sumAtom(keyArgs);},valueAtom:function(keyArgs){return this.sumAtom(keyArgs);},valueAbsAtom:function(keyArgs){var atom=this.valueAtom(keyArgs);return atom.value<0?this.read(-atom.value):atom;},percent:function(atomOrValue,keyArgs){var value=atomOrValue instanceof cdo.Atom?atomOrValue.value:atomOrValue;if(!value)return 0;var sum=this.sumAbs(keyArgs);return sum?Math.abs(value)/sum:0;},valuePercent:function(keyArgs){var valueAbs=this.valueAbs(keyArgs);if(!valueAbs)return 0;var parentData=this.data.parent;return parentData?valueAbs/parentData.dimensionsSumAbs(this.name,keyArgs):1;},percentOverParent:function(keyArgs){return this.valuePercent(keyArgs);},format:function(value,sourceValue){return def.string.to(this.type._formatter?this.type._formatter.call(null,value,sourceValue):value);},intern:function(sourceValue,isVirtual){return this._read(sourceValue,!0,isVirtual);},read:function(sourceValue){return this._read(sourceValue,!1);},_read:function(sourceValue,intern,isVirtual){var value,label;if(null==sourceValue||""===sourceValue)return this._nullAtom||(intern?dim_createNullAtom.call(this):this.owner._virtualNullAtom);if("object"==typeof sourceValue){if(sourceValue instanceof cdo.Atom){if(sourceValue.dimension!==this)throw def.error.operationInvalid("Atom is of a different dimension.");return sourceValue;}
if("v"in sourceValue){label=sourceValue.f;if(null==(sourceValue=sourceValue.v)||""===sourceValue)return this._nullAtom||(intern?dim_createNullAtom.call(this,label):this.owner._virtualNullAtom);}}
var auxFun,type=this.type;if(isVirtual||null===(auxFun=type._converter))value=sourceValue;else if(null==(value=auxFun(sourceValue))||""===value)return this._nullAtom||(intern?dim_createNullAtom.call(this):this.owner._virtualNullAtom);if(null!==(auxFun=type.cast)&&(null==(value=auxFun(value))||""===value))return this._nullAtom||(intern?dim_createNullAtom.call(this):this.owner._virtualNullAtom);var key=""+(null!==(auxFun=type._key)?auxFun(value):value);if(0===key.length)throw def.error.operationInvalid("Only a null value can have an empty key.");var atom;if(intern){null!==this._lazyInit&&this._lazyInit();if(void 0!==(atom=this._atomsByKey[key])){intern&&!isVirtual&&atom.isVirtual&&delete atom.isVirtual;return atom;}
return dim_createAndInternAtom.call(this,sourceValue,key,value,label,isVirtual);}
return void 0!==(atom=this.owner._atomsByKey[key])?atom:new cdo.Atom(this,value,label,sourceValue,key);},dispose:function(){var v,me=this;if(!me._disposed){cdo_disposeChildList(me.childNodes,"parent");cdo_disposeChildList(me._linkChildren,"linkParent");(v=me.parent)&&cdo_removeColChild(v,"childNodes",me,"parent");(v=me.linkParent)&&cdo_removeColChild(v,"_linkChildren",me,"linkParent");dim_clearVisiblesCache.call(me);me._lazyInit=me._atoms=me._nullAtom=me._virtualNullAtom=null;me._disposed=!0;}}});def.type("cdo.Data",cdo.Complex).init(function(keyArgs){if(null==keyArgs)throw def.error.argumentRequired("keyArgs");this._visibleNotNullDatums=new def.Map();var owner,atomsIsSet,atomsBase,atomsDimNames,childIndex,extensionDatums,datums=null,atoms=null,parent=this.parent=keyArgs.parent||null;if(parent){this.root=parent.root;this.depth=parent.depth+1;this.type=parent.type;owner=parent.owner;datums=keyArgs.datums||def.fail.argumentRequired("datums");atoms=keyArgs.atoms||def.fail.argumentRequired("atoms");atomsDimNames=keyArgs.atomsDimNames||def.fail.argumentRequired("atomsDimNames");atomsBase=parent.atoms;extensionDatums=keyArgs.extensionDatums||parent.extensionDatums;atomsIsSet=Object.create(parent.atomsIsSet);atomsDimNames.forEach(function(p){atomsIsSet[p]=!0;});}else{this.root=this;atomsDimNames=[];var linkParent=keyArgs.linkParent||null;if(linkParent){owner=linkParent.owner;this.type=owner.type;datums=keyArgs.datums||def.fail.argumentRequired("datums");this._leafs=[];atomsBase=keyArgs.atomsBase||linkParent.atoms;atomsIsSet=keyArgs.atomsBaseIsSet||Object.create(linkParent.atomsIsSet);extensionDatums=keyArgs.extensionDatums||linkParent.extensionDatums;childIndex=def.get(keyArgs,"index",null);cdo_addLinkChild.call(linkParent,this,childIndex);}else{owner=this;this.type=keyArgs.type||def.fail.argumentRequired("type");atomsBase={};atomsIsSet={};keyArgs.labelSep&&(this.labelSep=keyArgs.labelSep);keyArgs.keySep&&(this.keySep=keyArgs.keySep);this._selectedNotNullDatums=new def.Map();}}
this.owner=owner;this._datums=[];this._datumsById={};this._datumsByKey={};null!==datums&&this._addDatumsLocal(datums);this._atomsBase=atomsBase;this.atomsIsSet=atomsIsSet;this.extensionDatums=extensionDatums||null;this._dimensions={};this._dimensionsList=[];this.type.dimensionsList().forEach(this._initDimension,this);this.base(owner,atoms,atomsDimNames,atomsBase,!0);pv.Dom.Node.call(this);if(parent){childIndex=def.get(keyArgs,"index",null);cdo_addChild.call(parent,this,childIndex);this.absKey=parent.absKey?def.string.join(owner.keySep,parent.absKey,this.key):this.key;this.absLabel=parent.absLabel?def.string.join(owner.labelSep,parent.absLabel,this.label):this.label;}else{this.absKey=this.key;this.absLabel=this.label;}}).add(pv.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_dimensionsList:null,_freeDimensionNames:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_visibleNotNullDatums:null,_selectedNotNullDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_datums:null,_datumsById:null,_datumsByKey:null,depth:0,label:"",absLabel:"",_disposed:!1,_isFlattenGroup:!1,_isDegenerateFlattenGroup:!1,_initDimension:function(dimType){var dim=new cdo.Dimension(this,dimType);this._dimensions[dimType.name]=dim;this._dimensionsList.push(dim);},dimensions:function(name,keyArgs){if(null==name)return this._dimensions;var dim=def.getOwn(this._dimensions,name);if(!dim&&def.get(keyArgs,"assertExists",!0))throw def.error.argumentInvalid("name","Undefined dimension '{0}'.",[name]);return dim;},dimensionsList:function(){return this._dimensionsList;},getSpecifiedAtom:function(dimName){return!0===this.atomsIsSet[dimName]?this.atoms[dimName]:null;},freeDimensionsNames:function(){var free=this._freeDimensionNames;free||(this._freeDimensionNames=free=this.type.dimensionsNames().filter(function(dimName){var atom=this.atoms[dimName];return!(atom instanceof cdo.Atom)||null==atom.value;},this));return free;},isOwner:function(){return this.owner===this;},children:function(){var cs=this.childNodes;return cs.length>0?def.query(cs):def.query();},child:function(key){return def.getOwn(this._childrenByKey,key,null);},childCount:function(){return this.childNodes.length;},contains:function(datum){return def.hasOwn(this._datumsById,datum.id);},datumByKey:function(key){return def.getOwn(this._datumsByKey,key,null);},leafs:function(){return def.query(this._leafs);},count:function(){return this._datums.length;},firstDatum:function(){return this._datums.length>0?this._datums[0]:null;},firstAtoms:function(){return(this.firstDatum()||this).atoms;},singleDatum:function(){var datums=this._datums;return 1===datums.length?datums[0]:null;},dispose:function(){var me=this;if(!me._disposed){cdo_disposeChildLists.call(me);var v;(v=me._selectedNotNullDatums)&&v.clear();me._visibleNotNullDatums.clear();v=me._dimensionsList;for(var i=0,L=v.length;i<L;i++)v[i].dispose();me._dimensions=null;me._dimensionsList=null;if(v=me.parent){v.removeChild(me);me.parent=null;}
(v=me.linkParent)&&cdo_removeLinkChild.call(v,me);me._disposed=!0;}},disposeChildren:function(){cdo_disposeChildLists.call(this);}});cdo.Data.add({selectedCount:function(){return this.isOwner()?this._selectedNotNullDatums.count:this.datums(null,{selected:!0}).count();},selectedDatums:function(){return this.isOwner()?this._selectedNotNullDatums.values():this.datums(null,{selected:!0}).array();},selectedDatumMap:function(){if(this.isOwner())return this._selectedNotNullDatums.clone();var datums=this.datums(null,{selected:!0}).object({name:def.propGet("id")});return new def.Set(datums);},visibleCount:function(){return this._visibleNotNullDatums.count;},replaceSelected:function(datums){def.array.is(datums)||(datums=datums.array());var alreadySelectedById=def.query(datums).where(datum_isSelected).object({name:complex_id}),changed=this.owner.clearSelected(function(datum){return!def.hasOwn(alreadySelectedById,datum.id);});changed|=cdo.Data.setSelected(datums,!0);return changed;},clearSelected:function(funFilter){if(this.owner!==this)return this.owner.clearSelected(funFilter);if(!this._selectedNotNullDatums.count)return!1;var changed;if(funFilter){changed=!1;this._selectedNotNullDatums.values().filter(funFilter).forEach(function(datum){changed=!0;datum_deselect.call(datum);this._selectedNotNullDatums.rem(datum.id);},this);}else{changed=!0;this._selectedNotNullDatums.values().forEach(function(datum){datum_deselect.call(datum);});this._selectedNotNullDatums.clear();}
return changed;}});cdo.Data.setSelected=function(datums,selected){var anyChanged=0;datums&&def.query(datums).each(function(datum){anyChanged|=datum.setSelected(selected);});return!!anyChanged;};cdo.Data.toggleSelected=function(datums,any){def.array.isLike(datums)||(datums=def.query(datums).array());var q=def.query(datums),on=any?q.any(datum_isSelected):q.all(datum_isNullOrSelected);return this.setSelected(datums,!on);};cdo.Data.setVisible=function(datums,visible){var anyChanged=0;datums&&def.query(datums).each(function(datum){anyChanged|=datum.setVisible(visible);});return!!anyChanged;};cdo.Data.toggleVisible=function(datums){def.array.isLike(datums)||(datums=def.query(datums).array());var allVisible=def.query(datums).all(def.propGet("isVisible"));return cdo.Data.setVisible(datums,!allVisible);};cdo.Data.add({select:null,load:function(atomz,keyArgs){cdo_assertIsOwner.call(this);var whereFun=def.get(keyArgs,"where"),isNullFun=def.get(keyArgs,"isNull"),isAdditive=def.get(keyArgs,"isAdditive",!1),datums=def.query(atomz).select(function(atoms){var datum=new cdo.Datum(this,atoms);isNullFun&&isNullFun(datum)&&(datum.isNull=!0);return whereFun&&!whereFun(datum)?null:datum;},this);data_setDatums.call(this,datums,{isAdditive:isAdditive,doAtomGC:!0});},clearVirtuals:function(){var datums=this._datums,L=datums.length;if(L>0){this._sumAbsCache=null;for(var removed,i=0;i<L;){var datum=datums[i];if(datum.isVirtual){cdo_removeDatumLocal.call(this,datum);L--;removed=!0;}else i++;}
if(removed){if(!datums.length&&this.parent)return void this.dispose();var children=this.childNodes;if(children){i=0;L=children.length;for(;i<L;){var childData=children[i];childData.clearVirtuals();childData.parent?i++:L--;}}
this._linkChildren&&this._linkChildren.forEach(function(linkChildData){linkChildData.clearVirtuals();});}}
def.eachOwn(this._dimensions,function(dim){dim_uninternVirtualAtoms.call(dim);});},add:function(datums){cdo_assertIsOwner.call(this);data_setDatums.call(this,datums,{isAdditive:!0,doAtomGC:!0});},_addDatumsSimple:function(newDatums){this._addDatumsLocal(newDatums);this._onDatumsAdded(newDatums);},_onDatumsAdded:function(newDatums){var linkChildren=this._linkChildren;if(linkChildren)for(var i=-1,L=linkChildren.length;++i<L;)linkChildren[i]._addDatumsSimple(newDatums);},_addDatumsLocal:function(newDatums){var datums=this._datums,visibleDatumsMap=this._visibleNotNullDatums,selectedDatumsMap=this._selectedNotNullDatums,datumsById=this._datumsById,datumsByKey=this._datumsByKey,internAtoms=!!this._dimensions;this._sumAbsCache=null;for(var i=-1,L=newDatums.length;++i<L;){var newDatum=newDatums[i],id=newDatum.id;if(void 0===datumsById[id]){datums.push(newDatum);datumsById[id]=newDatum;datumsByKey[newDatum.key]=newDatum;internAtoms&&data_processDatumAtoms.call(this,newDatum,!0,!1);if(!newDatum.isNull){selectedDatumsMap&&newDatum.isSelected&&selectedDatumsMap.set(id,newDatum);newDatum.isVisible&&visibleDatumsMap.set(id,newDatum);}}}},groupBy:function(groupingSpecText,keyArgs){var groupByCache,data,groupOper=new cdo.GroupingOper(this,groupingSpecText,keyArgs),cacheKey=groupOper.key;if(cacheKey){groupByCache=this._groupByCache;data=groupByCache&&groupByCache[cacheKey];}
if(data)def.debug>=7&&def.log("[GroupBy] Cache key hit '"+cacheKey+"'");else{def.debug>=7&&def.log("[GroupBy] "+(cacheKey?"Cache key not found : '"+cacheKey+"' on '"+this.id+"'":"No Cache key"));data=groupOper.execute();cacheKey&&((groupByCache||(this._groupByCache={}))[cacheKey]=data);}
return data;},where:function(querySpec,keyArgs){var normalizedQuerySpec=querySpec&&data_normalizeQuerySpec.call(this,querySpec),datums=this._datums;datums.length>0&&(normalizedQuerySpec?datums=data_where.call(this,normalizedQuerySpec,keyArgs).array():keyArgs&&(datums=data_whereState(def.query(datums),keyArgs).array()));var where=(normalizedQuerySpec||keyArgs)&&data_wherePredicate(normalizedQuerySpec,keyArgs);return new cdo.FilteredData({linkParent:this,datums:datums,where:where});},datums:function(querySpec,keyArgs){if(0===this._datums.length)return def.query();if(!querySpec)return keyArgs?data_whereState(def.query(this._datums),keyArgs):def.query(this._datums);var normalizedQuerySpec=data_normalizeQuerySpec.call(this,querySpec);return data_where.call(this,normalizedQuerySpec,keyArgs);},datum:function(querySpec,keyArgs){return this.datums(querySpec,keyArgs).first()||null;},dimensionsSumAbs:function(dimName,keyArgs){var value=this.dimensionNumberValue(dimName,keyArgs).value;return null!==value&&value<0?-value:value;},dimensionNumberValue:function(dimName,keyArgs){var operArgs=this._createDimensionOperArgs(dimName,keyArgs);return this._dimensionNumberValue(operArgs);},_createDimensionOperArgs:function(dimName,keyArgs){var discrimFun,discrimPossibleDimNames,discrimKey=null;if("function"==typeof dimName){discrimFun=dimName;discrimPossibleDimNames=def.get(keyArgs,"discrimPossibleDims")||null;discrimKey=def.get(keyArgs,"discrimKey")||null;null!==discrimKey&&(discrimKey="discrim:"+discrimKey);}else{discrimFun=def.fun.constant(dimName);discrimPossibleDimNames=[dimName];discrimKey=dimName;}
var cacheKey=null;null!==discrimKey&&(cacheKey=discrimKey+":"+dim_buildDatumsFilterKey(keyArgs)+":"+(discrimPossibleDimNames||[]).join("|"));return{discrimFun:discrimFun,discrimPossibleDimNames:discrimPossibleDimNames,cacheKey:cacheKey,keyArgs:keyArgs};},_dimensionNumberValue:function(operArgs){var valueAtom,cacheKey=operArgs.cacheKey;if(null===cacheKey||void 0===(valueAtom=def.getOwn(this._sumAbsCache,cacheKey))){valueAtom=this._dimensionNumberValueCore(operArgs);null!==cacheKey&&((this._sumAbsCache||(this._sumAbsCache={}))[cacheKey]=valueAtom);}
return valueAtom;},_dimensionNumberValueCore:function(operArgs){var value,valueDimName=operArgs.discrimFun(this,null!==operArgs.discrimPossibleDimNames);if(0===this.childCount()){if(null!==valueDimName)return this.dimensions(valueDimName).valueAtom(operArgs.keyArgs);value=def.query(operArgs.discrimPossibleDimNames).select(function(possibleDimName){return this.dimensions(possibleDimName).valueAbsAtom(operArgs.keyArgs).value;},this).reduce(def.addPreservingNull,null);}else value=this.children().where(function(childData){return!childData._isFlattenGroup||childData._isDegenerateFlattenGroup;}).select(function(childData){var value=childData._dimensionNumberValue(operArgs).value;return null!==value&&value<0?-value:value;}).reduce(def.addPreservingNull,null);return null!==valueDimName?this.dimensions(valueDimName).read(value):null===value?this.type.nullNumberAtom:new cdo.NumberAtom(this.type,value);},dimensionPercentValue:function(dimName,keyArgs){function getAtom(value){return null===valueDim?new cdo.NumberAtom(this.type,value):valueDim.read(value);}
var operArgs=this._createDimensionOperArgs(dimName,keyArgs),valueAtom=this._dimensionNumberValue(operArgs),value=valueAtom.value;if(null===value)return valueAtom;var valueDim=valueAtom.dimension;if(0===value)return getAtom.call(this,0);var parentData=this.parent;if(null===parentData)return getAtom.call(this,1);var sumAbsAtom=parentData._dimensionNumberValue(operArgs);return getAtom.call(this,Math.abs(value)/sumAbsAtom.value);}}).type().add({lca:function(datas){var dataB,listA,listB,L=datas.length,a=null;if(L){if(1===L)return datas[0];var i=1;listA=data_ancestorsAndSelfList(datas[0]);do{dataB=datas[i];listB=data_ancestorsAndSelfList(dataB);if(!(a=data_lowestCommonAncestor(listA,listB)))return null;dataB;listA=listB;}while(++i<L);}
return a;}});cdo.querySpecPredicate=cdo_querySpecPredicate;def.type("cdo.FilteredData",cdo.Data).init(function(keyArgs){if(null==keyArgs||null!=keyArgs.parent||null==keyArgs.linkParent)throw def.error.argumentRequired("keyArgs.linkParent");this.base(keyArgs);this._wherePred=keyArgs.where||def.fail.argumentRequired("keyArgs.where");}).add({_addDatumsSimple:function(newDatums){newDatums=newDatums.filter(this._wherePred);this.base(newDatums);}});def.type("cdo.GroupingData",cdo.Data).init(function(keyArgs){if(null==keyArgs)throw def.error.argumentRequired("keyArgs");this.base(keyArgs);this.groupingOper=keyArgs.groupingOper||def.fail.argumentRequired("keyArgs.groupingOper");this.groupingSpec=keyArgs.groupingSpec||null;this.groupingLevelSpec=keyArgs.groupingLevelSpec||null;});def.type("cdo.GroupingRootData",cdo.GroupingData).init(function(keyArgs){if(null==keyArgs||null!=keyArgs.parent||null==keyArgs.linkParent)throw def.error.argumentRequired("keyArgs.linkParent");var groupSpec=keyArgs.groupingSpec;if(null==groupSpec)throw def.error.argumentRequired("keyArgs.groupingSpec");var groupOper=keyArgs.groupingOper;if(groupOper&&groupSpec.hasExtensionComplexTypes){keyArgs=Object.create(keyArgs);var atomsBase=keyArgs.atomsBase=Object.create(keyArgs.linkParent.atoms),extensionDataSetsMap=groupOper._extensionDataSetsMap;groupSpec.extensionDimensions().each(function(dimSpec){void 0===atomsBase[dimSpec.fullName]&&(atomsBase[dimSpec.fullName]=extensionDataSetsMap[dimSpec.dataSetName].owner.atoms[dimSpec.name]);});}
this.base(keyArgs);}).add({_addDatumsSimple:function(newDatums){newDatums=this.groupingOper.executeAdd(this,newDatums);this._onDatumsAdded(newDatums);}});def.type("cdo.GroupData",cdo.GroupingData).init(function(keyArgs){if(null==keyArgs||null==keyArgs.parent)throw def.error.argumentRequired("keyArgs.parent");this.base(keyArgs);});cdo.Data.add({getInfo:function(){var out=["DATA SUMMARY",def.logSeparator,"  Dimension",def.logSeparator];def.eachOwn(this.dimensions(),function(dimension,name){var count=dimension.count(),type=dimension.type,features=[];features.push();features.push(type.valueTypeName);type.isComparable&&features.push("comparable");type.isDiscrete||features.push("continuous");type.isHidden&&features.push("hidden");out.push("  "+name+' ("'+type.label+'", #'+count+")\n\t"+dimension.atoms().slice(0,10).map(function(atom){return atom.label;}).join(", ")+(count>10?"...":""));});return out.join("\n");},getValues:function(){return pv.range(0,this.getCategoriesSize()).map(function(categIndex){return this._getValuesForCategoryIndex(categIndex);},this);},_getDimensionValues:function(name){return this.dimensions(name).atoms().map(function(atom){return atom.value;});},_getDimensionVisibleValues:function(name){return this.dimensions(name).atoms({visible:!0}).map(function(atom){return atom.value;});},getSeries:function(){return this._getDimensionValues("series");},getVisibleSeriesIndexes:function(){return this.dimensions("series").indexes({visible:!0});},getVisibleCategoriesIndexes:function(){return this.dimensions("category").indexes({visible:!0});},getVisibleSeries:function(){return this._getDimensionVisibleValues("series");},getCategories:function(){return this._getDimensionValues("category");},getVisibleCategories:function(){return this._getDimensionVisibleValues("category");},_getValuesForCategoryIndex:function(categIdx){var categAtom=this.dimensions("category").atoms()[categIdx],datumsBySeriesKey=this.datums({category:categAtom}).uniqueIndex(function(datum){return datum.atoms.series.key;});return this.dimensions("series").atoms().map(function(atom){var datum=def.getOwn(datumsBySeriesKey,atom.key);return datum?datum.atoms.value.value:null;});},getSeriesSize:function(){var dim=this.dimensions("series",{assertExists:!1});return dim?dim.count():0;},getCategoriesSize:function(){var dim=this.dimensions("category",{assertExists:!1});return dim?dim.count():0;}});def.type("cdo.DataOper").init(function(linkParent,keyArgs){linkParent||def.fail.argumentRequired("linkParent");this._linkParent=linkParent;}).add({key:null,execute:def.abstractMethod});def.type("cdo.GroupingOper",cdo.DataOper).init(function(linkParent,groupingSpecs,keyArgs){groupingSpecs||def.fail.argumentRequired("groupingSpecs");groupingSpecs=def.array.as(groupingSpecs);if(0===groupingSpecs.length)throw def.error.argumentRequired("groupingSpecText");def.get(keyArgs,"inverted",!1)&&(groupingSpecs=groupingSpecs.slice().reverse());this.base(linkParent,keyArgs);var where=def.get(keyArgs,"where"),whereKey=where&&def.get(keyArgs,"whereKey")||"",isVisible=def.get(keyArgs,"visible",null),isSelected=def.get(keyArgs,"selected",null);this._preFilter=data_wherePredicate(null,{visible:isVisible,selected:isSelected,where:where});var isNull=def.get(keyArgs,"isNull",null);this._postFilter=data_wherePredicate(null,{isNull:isNull});var hasKey=null==isSelected&&!(where&&!whereKey),groupSpecKeys=hasKey?[]:null,extensionDataSetsKey="",extensionDataSetsMap=null,extensionDataSetsMapProvided=def.get(keyArgs,"extensionDataSetsMap",null),reverse=def.get(keyArgs,"reverse",!1);this._groupSpecs=groupingSpecs.map(function(groupSpec){if(groupSpec instanceof cdo.GroupingSpec){if(groupSpec.complexType!==linkParent.type)throw def.error.argumentInvalid("groupingSpecText","Invalid associated complex type.");}else groupSpec=cdo.GroupingSpec.parse(groupSpec,linkParent.type);if(groupSpec.isNull)throw def.error.argumentInvalid("groupingSpecText","Null grouping specification.");groupSpec.flatteningMode===cdo.FlatteningMode.SingleLevel&&(groupSpec=groupSpec.toSingleLevel());reverse&&(groupSpec=groupSpec.reverse());hasKey&&groupSpecKeys.push(groupSpec.key);null!==groupSpec.extensionComplexTypeNames&&groupSpec.extensionComplexTypeNames.forEach(function(dataSetName){var dataSet;if(null===extensionDataSetsMapProvided||!(dataSet=extensionDataSetsMapProvided[dataSetName]))throw def.error.operationInvalid("Grouping specification requires extension data set '{0}'.",[dataSetName]);null===extensionDataSetsMap&&(extensionDataSetsMap=Object.create(null));extensionDataSetsMap[dataSetName]=dataSet;hasKey&&(extensionDataSetsKey+=dataSetName+":"+dataSet.id+";");});return groupSpec;});this._extensionDataSetsMap=extensionDataSetsMap;hasKey&&(this.key=groupSpecKeys.join("!!")+":"+[isVisible,isNull,whereKey,extensionDataSetsKey].join(":"));}).add({_getExtensionDatumsMap:function(){var extensionDatumsMap=null,extensionDataSetsMap=this._extensionDataSetsMap;if(extensionDataSetsMap){extensionDatumsMap=Object.create(null);var baseExtensionDatumsMap=this._linkParent.extensionDatums;if(def.query(Object.keys(extensionDataSetsMap)).each(function(dataSetName){var dataSet=extensionDataSetsMap[dataSetName],datums=dataSet._datums;if(0===datums.length)return!1;if(null!==baseExtensionDatumsMap){var baseDatums=baseExtensionDatumsMap[dataSetName];baseDatums&&(datums=baseDatums.filter(function(baseDatum){return datums.indexOf(baseDatum)>=0;}));}
if(0===datums.length)return!1;extensionDatumsMap[dataSetName]=datums;}))return!1;}
return extensionDatumsMap;},execute:function(){var datums=this._linkParent._datums,datumsQuery=def.query(datums).where(this._preFilter),rootNode=this._group(datumsQuery);return this._generateData(rootNode,null,this._linkParent,null);},executeAdd:function(rootData,newDatums){var newDatumsQuery=def.query(newDatums).where(this._preFilter),newRootNode=this._group(newDatumsQuery);this._generateData(newRootNode,null,this._linkParent,rootData);return newRootNode.datums;},_group:function(datumsQuery){var rootNode={isRoot:!0,treeHeight:def.query(this._groupSpecs).select(function(groupSpec){return groupSpec.flatteningMode&cdo.FlatteningMode.Dfs?1:groupSpec.depth;}).reduce(def.add,0),datums:[],datumsById:{},groupSpec:this._groupSpecs[0],groupLevelSpec:this._groupSpecs[0].levels[0]},extensionDatumsMap=this._getExtensionDatumsMap();!1!==extensionDatumsMap&&this._groupSpecRecursive(rootNode,def.query(datumsQuery).array(),extensionDatumsMap,0);return rootNode;},_groupSpecRecursive:function(groupParentNode,groupDatums,groupExtensionDatumsMap,groupSpecIndex){var groupSpec=this._groupSpecs[groupSpecIndex];0!=(groupSpec.flatteningMode&cdo.FlatteningMode.Dfs)?this._groupSpecRecursiveFlattened(groupParentNode,groupDatums,groupExtensionDatumsMap,groupSpec,groupSpecIndex):this._groupSpecRecursiveNormal(groupParentNode,groupDatums,groupExtensionDatumsMap,groupSpec,groupSpecIndex);},_groupSpecRecursiveNormal:function(groupParentNode,groupDatums,groupExtensionDatumsMap,groupSpec,groupSpecIndex){function groupLevelRecursive(levelParentNode,levelDatums,levelExtensionDatumsMap,levelIndex){var levelSpec=levelSpecs[levelIndex],isLastLevel=levelIndex===L-1,isLastLevelOfLastGroupSpec=isLastGroupSpec&&isLastLevel;levelParentNode.groupSpec=groupSpec;levelParentNode.groupLevelSpec=levelSpec;for(var childNodes=levelParentNode.children=this._groupLevelDatums(levelSpec,levelParentNode,levelDatums,levelExtensionDatumsMap,!1),i=0,C=childNodes.length;i<C;i++){var childNode=childNodes[i];if(!isLastLevelOfLastGroupSpec){var childDatums=childNode.datums;childNode.datums=[];childNode.datumsById={};isLastLevel?this._groupSpecRecursive(childNode,childDatums,childNode.extensionDatumsMap,groupSpecIndex+1):groupLevelRecursive.call(this,childNode,childDatums,childNode.extensionDatumsMap,levelIndex+1);}
this._addChildDatums(levelParentNode.datums,levelParentNode.datumsById,childNode.datums,groupExtensionDatumsMap);}}
var levelSpecs=groupSpec.levels,L=levelSpecs.length,isLastGroupSpec=groupSpecIndex===this._groupSpecs.length-1;groupParentNode.isRoot&&(groupParentNode.label=groupSpec.rootLabel);groupLevelRecursive.call(this,groupParentNode,groupDatums,groupExtensionDatumsMap,0);},_addChildDatums:function(datums,datumsById,childDatums,groupExtensionDatumsMap){if(null===groupExtensionDatumsMap)def.array.append(datums,childDatums);else for(var i=-1,L=childDatums.length;++i<L;){var childDatum=childDatums[i];if(void 0===datumsById[childDatum.id]){datumsById[childDatum.id]=childDatum;datums.push(childDatum);}}},_groupSpecRecursiveFlattened:function(realGroupParentNode,groupDatums,groupExtensionDatumsMap,groupSpec,groupIndex){function groupLevelRecursive(levelParentNode,levelDatums,levelExtensionDatumsMap,levelIndex){for(var levelSpec=levelSpecs[levelIndex],isLastLevel=levelIndex===L-1,isLastLevelOfLastGroupSpec=isLastGroup&&isLastLevel,childNodes=this._groupLevelDatums(levelSpec,levelParentNode,levelDatums,levelExtensionDatumsMap,!0),levelParentNodeDatums=isLastGroup?levelParentNode.datums:[],levelParentNodeDatumsById=isLastGroup?levelParentNode.datumsById:{},i=0,C=childNodes.length;i<C;i++){var childNode=childNodes[i],childDatums=childNode.datums;def.array.lazy(levelParentNode,"_children").push(childNode);if(def.hasOwn(flatChildrenByKey,childNode.key))this._addChildDatums(levelParentNodeDatums,levelParentNodeDatumsById,childDatums,groupExtensionDatumsMap);else{var specParentChildIndex=flatChildren.length;if(!isPostOrder){addFlatChildNode(childNode);levelParentNode.isFlattenGroup=!0;}
if(!isLastLevelOfLastGroupSpec){childNode.datums=[];childNode.datumsById={};isLastLevel?this._groupSpecRecursive(childNode,childDatums,levelExtensionDatumsMap,groupIndex+1):groupLevelRecursive.call(this,childNode,childDatums,levelExtensionDatumsMap,levelIndex+1);}
this._addChildDatums(levelParentNodeDatums,levelParentNodeDatumsById,childNode.datums,groupExtensionDatumsMap);if(isPostOrder){if(def.hasOwn(flatChildrenByKey,childNode.key)){childNode.isFlattenGroup||def.assert("Must be a parent for duplicate keys to exist.");if(1===childNode._children.length){flatChildren.splice(specParentChildIndex,flatChildren.length-specParentChildIndex);childNode.isDegenerateFlattenGroup=!0;}}
addFlatChildNode(childNode);levelParentNode.isFlattenGroup=!0;}}}
isLastGroup||this._groupSpecRecursive(levelParentNode,levelParentNodeDatums,levelExtensionDatumsMap,groupIndex+1);}
var isPostOrder=groupSpec.flatteningMode===cdo.FlatteningMode.DfsPost,levelSpecs=groupSpec.levels,L=levelSpecs.length,isLastGroup=groupIndex===this._groupSpecs.length-1,flatChildren=[],flatChildrenByKey={},groupParentNode={key:"",absKey:"",atoms:{},datums:[],datumsById:{},label:groupSpec.rootLabel,dimNames:[]},addFlatChildNode=function(childNode){flatChildren.push(childNode);flatChildrenByKey[childNode.key]=childNode;};realGroupParentNode.children=flatChildren;realGroupParentNode.childrenByKey=flatChildrenByKey;isPostOrder||addFlatChildNode(groupParentNode);groupLevelRecursive.call(this,groupParentNode,groupDatums,groupExtensionDatumsMap,0);isPostOrder&&addFlatChildNode(groupParentNode);realGroupParentNode.datums=groupParentNode.datums;},_groupLevelDatums:function(levelSpec,levelParentNode,levelDatums,levelExtensionDatumsMap,doFlatten){function groupDatum(datum,extensionDatumsMap){var key=buildKey.call(levelSpec,datum,extensionDatumsMap),childNode=def.hasOwnProp.call(childNodeMap,key)&&childNodeMap[key];if(childNode)postFilter&&!postFilter(datum)||childNode.datums.push(datum);else{childNode=buildGroupNode.call(levelSpec,datum,extensionDatumsMap);childNode.key=key;childNode.firstDatum=datum;childNode.datums=!postFilter||postFilter(datum)?[datum]:[];childNode.extensionDatumsMap=extensionDatumsMap;if(doFlatten){null===keySep&&(keySep=datum.owner.keySep);this._onNewChildNodeFlattened(key,keySep,childNode,levelSpec,levelParentNode);}
def.array.insert(childNodeList,childNode,nodeComparer);childNodeMap[key]=childNode;}}
function groupDatumExtended(datum,extensionDatumsMaps){for(var i=-1,L=extensionDatumsMaps.length;++i<L;)groupDatum.call(this,datum,extensionDatumsMaps[i]);}
function crossJoinExtensionDatumsRecursive(outputMaps,extDimIndex,extensionDatumsMap){for(var extDimension=extensionDimensions[extDimIndex],extDataSetName=extDimension.dataSetName,extDatums=levelExtensionDatumsMap[extDataSetName],i=-1,L=extDatums.length,nextExtDimIndex=extDimIndex+1,isLastExtDim=nextExtDimIndex>=extensionDimensions.length;++i<L;){var childExtensionDatumsMap=Object.create(extensionDatumsMap);childExtensionDatumsMap[extDataSetName]=[extDatums[i]];isLastExtDim?outputMaps.push(childExtensionDatumsMap):crossJoinExtensionDatumsRecursive(outputMaps,nextExtDimIndex,childExtensionDatumsMap);}}
var buildKey,buildGroupNode,nodeComparer,childNodeList=[],childNodeMap=Object.create(null),postFilter=this._postFilter,keySep=null,j=-1,D=levelDatums.length,extensionDimensions=levelSpec.extensionDimensions;if(null!==extensionDimensions){buildKey=levelSpec.buildKeyWithExtension;buildGroupNode=levelSpec.buildGroupNodeWithExtension;nodeComparer=levelSpec.compareNodesWithExtension.bind(levelSpec);var crossJoinExtensionDatumsMaps=[];crossJoinExtensionDatumsRecursive(crossJoinExtensionDatumsMaps,0,levelExtensionDatumsMap);for(;++j<D;)groupDatumExtended.call(this,levelDatums[j],crossJoinExtensionDatumsMaps);}else{buildKey=levelSpec.buildKeyMain;buildGroupNode=levelSpec.buildGroupNodeMain;nodeComparer=levelSpec.compareNodesMain.bind(levelSpec);for(;++j<D;)groupDatum.call(this,levelDatums[j],levelExtensionDatumsMap);}
if(postFilter){j=childNodeList.length;for(;j--;)0===childNodeList[j].datums.length&&childNodeList.splice(j,1);}
return childNodeList;},_onNewChildNodeFlattened:function(key,keySep,childNode,level,levelParentNode){def.copy(childNode.atoms,levelParentNode.atoms);childNode.dimNames=level.accAllDimensionNames();if(levelParentNode.dimNames.length){var absKey=levelParentNode.absKey+keySep+key;childNode.absKey=absKey;childNode.key=cdo.Complex.rightTrimKeySep(absKey,keySep);}else childNode.absKey=key;},_generateData:function(node,parentNode,parentData,rootData){var data=null,isNew=!1;if(node.isRoot)if(null!==rootData){data=rootData;data._addDatumsLocal(node.datums);}else{isNew=!0;data=new cdo.GroupingRootData({groupingOper:this,groupingSpec:node.groupSpec,groupingLevelSpec:node.groupLevelSpec,linkParent:parentData,datums:node.datums,extensionDatums:node.extensionDatumsMap});data.treeHeight=node.treeHeight;}else{if(null!==rootData){data=parentData.child(node.key);null!==data&&data._addDatumsSimple(node.datums);}
if(null===data){isNew=!0;var siblings,index=null;null!==rootData&&(siblings=parentData.childNodes).length>0&&(index=~def.array.binarySearch(siblings,node.datums[0],parentNode.groupLevelSpec.mainDatumComparer));data=new cdo.GroupData({groupingOper:this,groupingSpec:node.groupSpec,groupingLevelSpec:node.groupLevelSpec,parent:parentData,atoms:node.atoms,datums:node.datums,index:index,atomsDimNames:node.dimNames,extensionDatums:node.extensionDatumsMap});}}
if(isNew){if(node.isFlattenGroup){data._isFlattenGroup=!0;data._isDegenerateFlattenGroup=!!node.isDegenerateFlattenGroup;}
var label=node.label;if(label){data.label+=label;data.absLabel+=label;}}
var childNodes=node.children,L=childNodes?childNodes.length:0;if(L>0)for(var i=-1;++i<L;)this._generateData(childNodes[i],node,data,rootData);else if(isNew&&!node.isRoot){var leafs=data.root._leafs;data.leafIndex=leafs.length;leafs.push(data);}
return data;}});def.space("cdo").FlatteningMode=def.makeEnum(["SingleLevel","DfsPre","DfsPost"],{zero:"None",all:"AllMask"});cdo.FlatteningMode.Dfs=cdo.FlatteningMode.DfsPre|cdo.FlatteningMode.DfsPost;def.type("cdo.GroupingSpec").init(function(levelSpecs,complexType,extensionComplexTypesMap,ka){this.complexType=complexType||null;complexType=this.complexType;var referencedExtensionComplexTypeNamesMap=null,levelKeys=[],mainDimNames=[],allDimNames=[],isDiscrete=!1,singleContinuousValueType=null;this.levels=def.query(levelSpecs||void 0).where(function(levelSpec){return levelSpec.allDimensions.length>0;}).select(function(levelSpec){levelKeys.push(levelSpec.key);mainDimNames.push.apply(mainDimNames,levelSpec.dimensionNames());levelSpec.allDimensions.forEach(function(dimSpec){if(dimSpec.dataSetName){null===referencedExtensionComplexTypeNamesMap&&(referencedExtensionComplexTypeNamesMap=Object.create(null));referencedExtensionComplexTypeNamesMap[dimSpec.dataSetName]=!0;allDimNames.push(dimSpec.fullName);}else allDimNames.push(dimSpec.name);if(null!==complexType&&!isDiscrete){var dimType=dimSpec.dimensionType;dimType.isDiscrete?isDiscrete=!0:null===singleContinuousValueType?singleContinuousValueType=dimType.valueType:singleContinuousValueType!==dimType.valueType&&(isDiscrete=!0);}});levelSpec._setAccAllDimNames(allDimNames.slice(0));return levelSpec;}).array();this.extensionComplexTypesMap=null;this.extensionComplexTypeNames=referencedExtensionComplexTypeNamesMap&&Object.keys(referencedExtensionComplexTypeNamesMap);null!==complexType&&referencedExtensionComplexTypeNamesMap&&this._setExtensionComplexTypesMap(extensionComplexTypesMap);this._dimNames=mainDimNames;this._allDimNames=allDimNames;this.depth=this.levels.length;this._isDiscrete=null!==complexType?isDiscrete:void 0;this._singleContinuousValueType=null!==complexType?isDiscrete?null:singleContinuousValueType:void 0;this.isSingleDimension=1===allDimNames.length;this.firstDimension=this.depth>0?this.levels[0].allDimensions[0]:null;this.lastDimension=this.depth>0?this.levels[this.depth-1].lastDimension():null;this.rootLabel=def.get(ka,"rootLabel")||"";this.flatteningMode=def.get(ka,"flatteningMode")||cdo.FlatteningMode.None;this._cacheKey=this._calcCacheKey();this.key=this._cacheKey+"##"+levelKeys.join("||");}).add({_calcCacheKey:function(ka){return[def.get(ka,"flatteningMode")||this.flatteningMode,def.get(ka,"rootLabel")||this.rootLabel].join("#");},bind:function(complexType,extensionComplexTypesMap){this.complexType=complexType||def.fail.argumentRequired("complexType");this._setExtensionComplexTypesMap(extensionComplexTypesMap);extensionComplexTypesMap=this.extensionComplexTypesMap;var isDiscrete=!1,singleContinuousValueType=null;this.levels.forEach(function(levelSpec){levelSpec.bind(complexType,extensionComplexTypesMap);if(!isDiscrete)for(var allDimSpecs=levelSpec.allDimensions,i=-1,L=allDimSpecs.length;++i<L;){var dimType=allDimSpecs[i].dimensionType;if(dimType.isDiscrete){isDiscrete=!0;break;}
if(null===singleContinuousValueType)singleContinuousValueType=dimType.valueType;else if(singleContinuousValueType!==dimType.valueType){isDiscrete=!0;break;}}});this._isDiscrete=isDiscrete;this._singleContinuousValueType=isDiscrete?null:singleContinuousValueType;},get isBound(){return!!this.complexType;},_setExtensionComplexTypesMap:function(extensionComplexTypesMap){if(this.hasExtensionComplexTypes){if(!extensionComplexTypesMap){var error=def.error.operationInvalid("Expects a map of extension types.");error.code="need-extension-map";throw error;}
this.extensionComplexTypesMap=def.copyProps(extensionComplexTypesMap,this.extensionComplexTypeNames);}else this.extensionComplexTypesMap=null;},get isNull(){return 0===this.depth;},get isSingleLevel(){return 1===this.depth;},get hasExtensionComplexTypes(){return!!this.extensionComplexTypeNames;},isDiscrete:function(){return this._isDiscrete;},get singleContinuousValueType(){return this._singleContinuousValueType;},get singleDimensionName(){if(this.isSingleDimension)return this.firstDimension.name;throw def.error.operationInvalid("Expected grouping to contain exactly one dimension.");},get singleDimensionType(){if(this.isSingleDimension)return this.firstDimension.dimensionType;throw def.error.operationInvalid("Grouping contains more than one dimension.");},dimensions:function(){return def.query(this.levels).prop("dimensions").selectMany();},allDimensions:function(){return def.query(this.levels).prop("allDimensions").selectMany();},extensionDimensions:function(){return def.query(this.levels).prop("extensionDimensions").selectMany();},dimensionNames:function(){return this._dimNames;},get allDimensionNames(){return this._allDimNames;},firstDimensionType:function(){var d=this.firstDimension;return d&&d.dimensionType;},firstDimensionName:function(){var dt=this.firstDimensionType();return dt&&dt.name;},firstDimensionValueType:function(){var dt=this.firstDimensionType();return dt&&dt.valueType;},lastDimensionType:function(){var d=this.lastDimension;return d&&d.dimensionType;},lastDimensionName:function(){var dt=this.lastDimensionType();return dt&&dt.name;},lastDimensionValueType:function(){var dt=this.lastDimensionType();return dt&&dt.valueType;},ensure:function(ka){var result;if(ka){var cacheKey=this._calcCacheKey(ka);if(cacheKey!==this._cacheKey){var cache=def.lazy(this,"_groupingCache");result=def.getOwn(cache,cacheKey);result||(result=cache[cacheKey]=this._ensure(ka));}}
return result||this;},_ensure:function(ka){return new cdo.GroupingSpec(this.levels,this.complexType,this.extensionComplexTypesMap,{flatteningMode:def.get(ka,"flatteningMode")||this.flatteningMode,rootLabel:def.get(ka,"rootLabel")||this.rootLabel});},toSingleLevel:function(){if(this.isSingleLevel)return this;var allDimSpecs=this.allDimensions().array(),singleLevelSpec=new cdo.GroupingLevelSpec(allDimSpecs,this.complexType,this.extensionComplexTypesMap);return new cdo.GroupingSpec([singleLevelSpec],this.complexType,this.extensionComplexTypesMap,{flatteningMode:cdo.FlatteningMode.SingleLevel,rootLabel:this.rootLabel});},reverse:function(){var reversedLevelSpecs=this.levels.map(function(levelSpec){return levelSpec.reverse();});return new cdo.GroupingSpec(reversedLevelSpecs,this.complexType,this.extensionComplexTypesMap,{flatteningMode:this.flatteningMode,rootLabel:this.rootLabel});},view:function(complex){var dimNames=complex instanceof cdo.Datum?this.dimensionNames():this.allDimensionNames;return complex.view(dimNames);},toString:function(){return this.levels.map(String).join(", ");}});def.type("cdo.GroupingLevelSpec").init(function(allDimSpecs){var allDimKeys=[],allDimNames=[],dimNames=[],dimensions=[],extDimensions=null;this.dimensions=dimensions;this.allDimensions=def.query(allDimSpecs).select(function(dimSpec){allDimKeys.push(dimSpec.key);if(dimSpec.dataSetName){allDimNames.push(dimSpec.fullName);null===extDimensions&&(extDimensions=[]);extDimensions.push(dimSpec);}else{allDimNames.push(dimSpec.name);dimNames.push(dimSpec.name);dimensions.push(dimSpec);}
return dimSpec;}).array();this.extensionDimensions=extDimensions;this._dimNames=dimNames;this._allDimNames=allDimNames;this._accDimNames=null;this.depth=this.allDimensions.length;this.key=allDimKeys.join(",");}).add({_setAccAllDimNames:function(accDimNames){this._accDimNames=accDimNames;},accAllDimensionNames:function(){return this._accDimNames;},dimensionNames:function(){return this._dimNames;},get allDimensionNames(){return this._allDimNames;},lastDimension:function(){return this.allDimensions[this.depth-1];},bind:function(complexType,extensionComplexTypesMap){this.allDimensions.forEach(function(dimSpec){dimSpec.bindComplexType(complexType,extensionComplexTypesMap);});},compareNodesMain:function(nodeA,nodeB){for(var result,dims=this.dimensions,D=dims.length,i=-1;++i<D;)if(0!==(result=dims[i].compareDatums(nodeA.firstDatum,nodeB.firstDatum)))return result;return 0;},compareNodesWithExtension:function(nodeA,nodeB){for(var result,dimSpec,dataSetName,datumA,datumB,allDimensions=this.allDimensions,D=allDimensions.length,i=-1;++i<D;){if(null!==(dataSetName=(dimSpec=allDimensions[i]).dataSetName)){datumA=nodeA.extensionDatumsMap[dataSetName][0];datumB=nodeB.extensionDatumsMap[dataSetName][0];}else{datumA=nodeA.firstDatum;datumB=nodeB.firstDatum;}
if(0!==(result=dimSpec.compareDatums(datumA,datumB)))return result;}
return 0;},buildKeyMain:function(datum){return cdo.Complex.compositeKey(datum,this._dimNames);},buildKeyWithExtension:function(datum,extensionDatumsMap){for(var dimSpec,key="",allDimensions=this.allDimensions,D=allDimensions.length,i=-1,keySep=datum.owner.keySep,datoms=datum.atoms;++i<D;){var atomKey=null!==(dimSpec=allDimensions[i]).dataSetName?extensionDatumsMap[dimSpec.dataSetName][0].atoms[dimSpec.name].key:datoms[dimSpec.name].key;i?key+=keySep+atomKey:key=atomKey;}
return key;},buildGroupNodeMain:function(datum){var dimNames=this._dimNames;return{atoms:def.copyProps(datum.atoms,dimNames),dimNames:dimNames};},buildGroupNodeWithExtension:function(datum,extensionDatumsMap){for(var dimSpec,atoms={},allDimensions=this.allDimensions,D=allDimensions.length,datoms=datum.atoms,i=-1;++i<D;)null!==(dimSpec=allDimensions[i]).dataSetName?atoms[dimSpec.fullName]=extensionDatumsMap[dimSpec.dataSetName][0].atoms[dimSpec.name]:atoms[dimSpec.name]=datoms[dimSpec.name];return{atoms:atoms,dimNames:this._allDimNames};},reverse:function(){var reversedDimSpecs=this.allDimensions.map(function(dimSpec){return dimSpec.reverse();});return new cdo.GroupingLevelSpec(reversedDimSpecs,this.complexType,this.extensionComplexTypesMap);},toString:function(){return def.query(this.allDimensions).select(String).array().join("|");}});def.type("cdo.GroupingDimensionSpec").init(function(fullName,isReversed,dimensionType){this.fullName=fullName;var m=/^(?:(.+?)\.)?(.+)$/.exec(fullName);this.dataSetName=m&&m[1]||null;this.name=m?m[2]:fullName;this.isReversed=!!isReversed;this.key=fullName+":"+(isReversed?"0":"1");this.dimensionType=null;dimensionType&&this.bind(dimensionType);}).add({bindComplexType:function(complexType,extensionComplexTypesMap){complexType||def.fail.argumentRequired("complexType");var dimComplexType;if(null!==this.dataSetName){var extensionComplexType=def.get(extensionComplexTypesMap,this.dataSetName);if(!extensionComplexType)throw def.error.operationInvalid("The data set name '{0}' of dimension '{1}' is not defined.",[this.dataSetName,this.fullName]);dimComplexType=extensionComplexType;}else dimComplexType=complexType;this.bind(dimComplexType.dimensions(this.name));return this;},bind:function(dimensionType){this.dimensionType=dimensionType||def.fail.argumentRequired("dimensionType");if(dimensionType.isComparable){var mainAtomComparer=dimensionType.atomComparer(this.isReversed),dimName=this.name;this.compareDatums=function(datumA,datumB){return mainAtomComparer(datumA.atoms[dimName],datumB.atoms[dimName]);};}else this.isReversed?this.compareDatums=function(datumA,datumB){return datumB.id-datumA.id;}:this.compareDatums=function(datumA,datumB){return datumA.id-datumB.id;};return this;},compareDatums:function(datumA,datumB){throw def.error.operationInvalid("Not Bound.");},reverse:function(){return new cdo.GroupingDimensionSpec(this.fullName,!this.isReversed,this.dimensionType);},toString:function(){return this.fullName+(this.dimensionType?' ("'+this.dimensionType.label+'")':"")+(this.isReversed?" desc":"");}});cdo.GroupingSpec.parse=function(specText,complexType,extensionComplexTypesMap){var levelSpecs=null;if(specText){var levels=def.string.is(specText)?specText.split(/\s*,\s*/):def.array.as(specText);levelSpecs=def.query(levels).select(function(levelText){var dimSpecs=groupSpec_parseGroupingLevel(levelText,complexType,extensionComplexTypesMap);return new cdo.GroupingLevelSpec(dimSpecs,complexType,extensionComplexTypesMap);});}
return new cdo.GroupingSpec(levelSpecs,complexType,extensionComplexTypesMap);};var groupSpec_matchDimSpec=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;def.type("cdo.LinearInterpolationOper").init(function(baseData,partData,visibleData,catRole,serRole,valRole,valDimName,stretchEnds){this._newDatums=[];this._data=visibleData;var qAllCatDatas=catRole.flatten(baseData).children();this._isCatDiscrete=catRole.grouping.isDiscrete();this._isCatDiscrete||(qAllCatDatas=qAllCatDatas.where(function(catData){return null!==catData.value;}));var serDatas1=serRole.isBound()?serRole.flatten(partData,{visible:!0,isNull:!1}).children().array():[null],valDim=this._valDim=baseData.owner.dimensions(valDimName),visibleKeyArgs={visible:!0,zeroIfNone:!1};this._stretchEnds=stretchEnds;this._catInfos=qAllCatDatas.select(function(allCatData,catIndex){var catData=visibleData.child(allCatData.key),catInfo={data:catData||allCatData,value:allCatData.value,isInterpolated:!1,serInfos:null,index:catIndex};catInfo.serInfos=[];serDatas1.forEach(function(serData1){var group=catData;group&&serData1&&(group=group.child(serData1.key));var valBoundDimName=valRole.getBoundDimensionName(group||serData1,!0);if(null===valBoundDimName||valBoundDimName===valDimName){var value=group?group.dimensions(valDim.name).value(visibleKeyArgs):null;catInfo.serInfos.push({data:serData1,group:group,value:value,isNull:null==value,catInfo:catInfo});}});return catInfo;}).array();this._serCount=serDatas1.length;this._serStates=def.range(0,this._serCount).select(function(serIndex){return new cdo.LinearInterpolationOperSeriesState(this,serIndex);},this).array();}).add({interpolate:function(){for(var catInfo;catInfo=this._catInfos.shift();)catInfo.serInfos.forEach(this._visitSeries,this);var newDatums=this._newDatums;newDatums.length&&this._data.owner.add(newDatums);},_visitSeries:function(catSerInfo,serIndex){this._serStates[serIndex].visit(catSerInfo);},nextUnprocessedNonNullCategOfSeries:function(serIndex){for(var catIndex=0,catCount=this._catInfos.length;catIndex<catCount;){var catInfo=this._catInfos[catIndex++],catSerInfo=catInfo.serInfos[serIndex];if(!catSerInfo.isNull)return catSerInfo;}}});def.type("cdo.LinearInterpolationOperSeriesState").init(function(interpolation,serIndex){this.interpolation=interpolation;this.index=serIndex;this._lastNonNull(null);}).add({visit:function(catSeriesInfo){catSeriesInfo.isNull?this._interpolate(catSeriesInfo):this._lastNonNull(catSeriesInfo);},_lastNonNull:function(catSerInfo){if(arguments.length){this.__lastNonNull=catSerInfo;this.__nextNonNull=void 0;}
return this.__lastNonNull;},_nextNonNull:function(){return this.__nextNonNull;},_initInterpData:function(){if(void 0===this.__nextNonNull){var last=this.__lastNonNull,next=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(next&&last){var fromValue=last.value,toValue=next.value,deltaValue=toValue-fromValue;if(this.interpolation._isCatDiscrete){var stepCount=next.catInfo.index-last.catInfo.index;stepCount>=2||def.assert("Must have at least one interpolation point.");this._stepValue=deltaValue/stepCount;this._middleIndex=~~(stepCount/2);var dotCount=stepCount-1;this._isOdd=dotCount%2>0;}else{var fromCat=+last.catInfo.value,toCat=+next.catInfo.value,deltaCat=toCat-fromCat;this._steep=deltaValue/deltaCat;this._middleCat=(toCat+fromCat)/2;}}}},_interpolate:function(catSerInfo){this._initInterpData();var next=this.__nextNonNull,prev=this.__lastNonNull,one=next||prev;if(one){var value,group,interpolation=this.interpolation,catInfo=catSerInfo.catInfo;if(next&&prev)if(interpolation._isCatDiscrete){var groupIndex=catInfo.index-prev.catInfo.index;value=prev.value+this._stepValue*groupIndex;group=(this._isOdd?groupIndex<this._middleIndex:groupIndex<=this._middleIndex)?prev.group:next.group;}else{var cat=+catInfo.value,lastCat=+prev.catInfo.value;value=prev.value+this._steep*(cat-lastCat);group=cat<this._middleCat?prev.group:next.group;}else{if(!interpolation._stretchEnds)return;value=one.value;group=one.group;}
var atoms=Object.create(group.atoms);def.copyOwn(atoms,catInfo.data.atoms);var valDim=interpolation._valDim,valueAtom=valDim.intern(value,!0);atoms[valDim.name]=valueAtom;var dimNames=interpolation._datumDimNames;dimNames||(interpolation._datumDimNames=dimNames=group.type.filterExtensionDimensionNames(def.keys(atoms)));interpolation._newDatums.push(new cdo.InterpolationDatum(group.owner,atoms,dimNames,"linear",valDim.name));}}});def.type("cdo.ZeroInterpolationOper").init(function(baseData,partData,visibleData,catRole,serRole,valRole,valDimName,stretchEnds){this._newDatums=[];this._data=visibleData;var qAllCatDatas=catRole.flatten(baseData).children();this._isCatDiscrete=catRole.grouping.isDiscrete();this._isCatDiscrete||(qAllCatDatas=qAllCatDatas.where(function(catData){return null!==catData.value;}));var serDatas1=serRole.isBound()?serRole.flatten(partData,{visible:!0,isNull:!1}).children().array():[null],valDim=this._valDim=baseData.owner.dimensions(valDimName),visibleKeyArgs={visible:!0,zeroIfNone:!1};this._stretchEnds=stretchEnds;this._catInfos=qAllCatDatas.select(function(allCatData,catIndex){var catData=visibleData.child(allCatData.key),catInfo={data:catData||allCatData,value:allCatData.value,isInterpolated:!1,serInfos:null,index:catIndex};catInfo.serInfos=[];serDatas1.forEach(function(serData1){var group=catData;group&&serData1&&(group=group.child(serData1.key));var valBoundDimName=valRole.getBoundDimensionName(group||serData1,!0);if(null===valBoundDimName||valBoundDimName===valDimName){var value=group?group.dimensions(valDim.name).value(visibleKeyArgs):null;catInfo.serInfos.push({data:serData1,group:group,value:value,isNull:null==value,catInfo:catInfo});}});return catInfo;}).array();this._serCount=serDatas1.length;this._serStates=def.range(0,this._serCount).select(function(serIndex){return new cdo.ZeroInterpolationOperSeriesState(this,serIndex);},this).array();}).add({interpolate:function(){for(var catInfo;catInfo=this._catInfos.shift();)catInfo.serInfos.forEach(this._visitSeries,this);var newDatums=this._newDatums;newDatums.length&&this._data.owner.add(newDatums);},_visitSeries:function(catSerInfo,serIndex){this._serStates[serIndex].visit(catSerInfo);},nextUnprocessedNonNullCategOfSeries:function(serIndex){for(var catIndex=0,catCount=this._catInfos.length;catIndex<catCount;){var catInfo=this._catInfos[catIndex++],catSerInfo=catInfo.serInfos[serIndex];if(!catSerInfo.isNull)return catSerInfo;}}});def.type("cdo.ZeroInterpolationOperSeriesState").init(function(interpolation,serIndex){this.interpolation=interpolation;this.index=serIndex;this._lastNonNull(null);}).add({visit:function(catSeriesInfo){catSeriesInfo.isNull?this._interpolate(catSeriesInfo):this._lastNonNull(catSeriesInfo);},_lastNonNull:function(catSerInfo){if(arguments.length){this.__lastNonNull=catSerInfo;this.__nextNonNull=void 0;}
return this.__lastNonNull;},_nextNonNull:function(){return this.__nextNonNull;},_initInterpData:function(){if(void 0===this.__nextNonNull){var last=this.__lastNonNull,next=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(next&&last)if(this.interpolation._isCatDiscrete){var stepCount=next.catInfo.index-last.catInfo.index;stepCount>=2||def.assert("Must have at least one interpolation point.");this._middleIndex=~~(stepCount/2);var dotCount=stepCount-1;this._isOdd=dotCount%2>0;}else{var fromCat=+last.catInfo.value,toCat=+next.catInfo.value;this._middleCat=(toCat+fromCat)/2;}}},_interpolate:function(catSerInfo){this._initInterpData();var next=this.__nextNonNull,last=this.__lastNonNull,one=next||last;if(one){var group,interpolation=this.interpolation,catInfo=catSerInfo.catInfo;if(next&&last)if(interpolation._isCatDiscrete){var groupIndex=catInfo.index-last.catInfo.index;group=this._isOdd?groupIndex<this._middleIndex?last.group:next.group:groupIndex<=this._middleIndex?last.group:next.group;}else{var cat=+catInfo.value;group=cat<this._middleCat?last.group:next.group;}else{if(!interpolation._stretchEnds)return;group=one.group;}
var atoms=Object.create(group.atoms);def.copyOwn(atoms,catInfo.data.atoms);var valDim=interpolation._valDim,zeroAtom=interpolation._zeroAtom||(interpolation._zeroAtom=valDim.intern(0,!0));atoms[valDim.name]=zeroAtom;var dimNames=interpolation._datumDimNames;dimNames||(interpolation._datumDimNames=dimNames=group.type.filterExtensionDimensionNames(def.keys(atoms)));interpolation._newDatums.push(new cdo.InterpolationDatum(group.owner,atoms,dimNames,"zero",valDim.name));}}});def.type("cdo.TranslationOper").init(function(complexTypeProj,source,metadata,options){this.complexTypeProj=complexTypeProj||def.fail.argumentRequired("complexTypeProj");this.source=source||def.fail.argumentRequired("source");this.metadata=metadata||def.fail.argumentRequired("metadata");this.options=options||{};this._initType();if(def.debug>=4){this._logLogicalRows=!0;this._logLogicalRowCount=0;}}).add({_logLogicalRows:!1,logSource:def.abstractMethod,logLogicalRow:def.abstractMethod,_translType:"Unknown",logTranslatorType:function(){return this._translType+" data source translator";},logicalColumnCount:function(){return this.metadata.length;},setSource:function(source){if(!source)throw def.error.argumentRequired("source");this.source=source;},defReader:function(dimReaderSpec){dimReaderSpec||def.fail.argumentRequired("readerSpec");var dimNames=def.string.is(dimReaderSpec)?dimReaderSpec:dimReaderSpec.names;dimNames=def.string.is(dimNames)?dimNames.split(/\s*\,\s*/):def.array.as(dimNames);var indexes=def.array.as(dimReaderSpec.indexes);indexes&&indexes.forEach(this._userUseIndex,this);var hasDims=!(!dimNames||!dimNames.length),reader=dimReaderSpec.reader;if(reader){hasDims||def.fail.argumentRequired("reader.names","Required argument when a reader function is specified.");this._userRead(reader,dimNames);}else{if(hasDims)return this._userCreateReaders(dimNames,indexes);indexes&&indexes.forEach(function(index){this._userIndexesToSingleDim[index]=null;},this);}
return indexes;},configureType:function(){this._configureTypeCore();},_configureTypeCore:def.abstractMethod,_initType:function(){this._userDimsReaders=[];this._userDimsReadersByDim={};this._userUsedIndexes={};this._userIndexesToSingleDim=[];var userDimReaders=this.options.readers;userDimReaders&&def.array.each(userDimReaders,this.defReader,this);var multiChartIndexes=def.parseDistinctIndexArray(this.options.multiChartIndexes);multiChartIndexes&&(this._multiChartIndexes=this.defReader({names:"multiChart",indexes:multiChartIndexes}));},_userUseIndex:function(index){index=+index;if(index<0)throw def.error.argumentInvalid("index","Invalid reader index: '{0}'.",[index]);if(def.hasOwn(this._userUsedIndexes,index))throw def.error.argumentInvalid("index","Column '{0}' of the logical table is already assigned.",[index]);this._userUsedIndexes[index]=!0;return index;},_userCreateReaders:function(dimNames,indexes){indexes?indexes.forEach(function(index,j){indexes[j]=+index;}):indexes=[];var dimName,I=indexes.length,N=dimNames.length;if(N>I){var nextIndex=I>0?indexes[I-1]+1:0;do{nextIndex=this._getNextFreeLogicalColumnIndex(nextIndex);indexes[I]=nextIndex;this._userUseIndex(nextIndex);I++;}while(N>I);}
for(var index,L=I===N?N:N-1,n=0;n<L;n++){dimName=dimNames[n];index=indexes[n];this._userIndexesToSingleDim[index]=dimName;this._userRead(this._propGet(dimName,index),dimName);}
if(L<N)for(var splitGroupName=def.splitIndexedId(dimNames[N-1]),groupName=splitGroupName[0],level=def.nullyTo(splitGroupName[1],0),i=L;i<I;i++,level++){dimName=def.indexedId(groupName,level);index=indexes[i];this._userIndexesToSingleDim[index]=dimName;this._userRead(this._propGet(dimName,index),dimName);}
return indexes;},_userRead:function(reader,dimNames){def.fun.is(reader)||def.fail.argumentInvalid("reader","Reader must be a function.");def.array.is(dimNames)?dimNames.forEach(function(name){this._readDim(name,reader);},this):this._readDim(dimNames,reader);this._userDimsReaders.push(reader);},_readDim:function(name,reader){var info,spec,index=this._userIndexesToSingleDim.indexOf(name);if(index>=0){info=this._logicalRowInfos[index];if(info&&!this.options.ignoreMetadataLabels){var label=info.label||info.name&&def.titleFromName(info.name);label&&(spec={label:label});}}
this.complexTypeProj.readDim(name,spec);this._userDimsReadersByDim[name]=reader;},execute:function(data){this.data=data;return this._executeCore();},_executeCore:function(){var dimsReaders=this._getDimensionsReaders();return def.query(this._getLogicalRows()).select(function(row){return this._readLogicalRow(row,dimsReaders);},this);},_getLogicalRows:function(){return this.source;},_getDimensionsReaders:function(){return this._userDimsReaders.slice().reverse();},_readLogicalRow:function(logicalRow,dimsReaders){for(var doLog=this._logLogicalRows&&this._logLogicalRowBefore(logicalRow),r=dimsReaders.length,data=this.data,atoms={};r--;)dimsReaders[r].call(data,logicalRow,atoms);doLog&&this._logLogicalRowAfter(atoms);return atoms;},_logLogicalRowBefore:function(logicalRow){if(this._logLogicalRowCount<10)return def.log("logical row ["+this._logLogicalRowCount+++"]: "+def.describe(logicalRow)),!0;def.log("...");return this._logLogicalRows=!1;},_logLogicalRowAfter:function(readAtoms){var logAtoms={};for(var dimName in readAtoms){var atom=readAtoms[dimName];def.object.is(atom)&&(atom="v"in atom?atom.v:"value"in atom?atom.value:"...");logAtoms[dimName]=atom;}
def.log("-> read: "+def.describe(logAtoms));},_propGet:function(dimName,prop){function propGet(logicalRow,atoms){atoms[dimName]=logicalRow[prop];}
return propGet;},_getNextFreeLogicalColumnIndex:function(index,L){null==index&&(index=0);null==L&&(L=1/0);for(;index<L&&def.hasOwn(this._userUsedIndexes,index);)index++;return index<L?index:-1;},_getPhysicalGroupStartIndex:function(name){return def.getOwn(this._logicalRowPhysicalGroupIndex,name);},_getPhysicalGroupLength:function(name){return def.getOwn(this._logicalRowPhysicalGroupsLength,name);},_configureTypeByPhysicalGroup:function(physicalGroupName,dimGroupName,dimCount,levelMax){var gStartIndex=this._logicalRowPhysicalGroupIndex[physicalGroupName],gLength=this._logicalRowPhysicalGroupsLength[physicalGroupName],gEndIndex=gStartIndex+gLength-1,index=gStartIndex;dimCount=null==dimCount?gLength:Math.min(gLength,dimCount);if(dimCount&&index<=gEndIndex){dimGroupName||(dimGroupName=physicalGroupName);levelMax||(levelMax=1/0);for(var dimName,level=0;dimCount&&level<levelMax;){dimName=def.indexedId(dimGroupName,level++);if(!this.complexTypeProj.isReadOrCalc(dimName)){index=this._getNextFreeLogicalColumnIndex(index);if(index>gEndIndex)return index;this.defReader({names:dimName,indexes:index});index++;dimCount--;}}}
return index;},_configureTypeByOrgLevel:function(discreteDimGroups,continuousDimGroups){var freeContinuous=[],freeDiscrete=[];this._logicalRowInfos.forEach(function(info,index){if(!this[index]){var indexes=1===info.type?freeContinuous:freeDiscrete;indexes&&indexes.push(index);}},this._userUsedIndexes);this._configureTypeByDimGroups(freeDiscrete,this._processDimGroupSpecs(discreteDimGroups,!0,1/0));this._configureTypeByDimGroups(freeContinuous,this._processDimGroupSpecs(continuousDimGroups,!1,1));},_processDimGroupSpecs:function(dimGroupSpecs,defaultGreedy,defaultMaxCount){return dimGroupSpecs.map(function(dimGroupSpec){return def.string.is(dimGroupSpec)?{name:dimGroupSpec,greedy:defaultGreedy,maxCount:defaultMaxCount}:def.setDefaults(dimGroupSpec,{greedy:defaultGreedy,maxCount:defaultMaxCount});});},_configureTypeByDimGroups:function(freeIndexes,dimGroups){if(dimGroups)for(var F,g=-1,G=dimGroups.length;++g<G&&(F=freeIndexes.length);){var dimGroupSpec=dimGroups[g],maxCount=Math.min(dimGroupSpec.maxCount,F),defaultDims=this._getFreeDimGroupNames(dimGroupSpec.name,maxCount,dimGroupSpec.greedy);if(defaultDims){defaultDims.length;this.defReader({names:defaultDims,indexes:freeIndexes.splice(0,defaultDims.length)});}}},_getFreeDimGroupNames:function(dimGroupName,dimCount,greedy){if(!dimGroupName)return null;var dims=[],level=0;null==dimCount&&(dimCount=1);for(;dimCount;){var dimName=def.indexedId(dimGroupName,level++);if(this.complexTypeProj.isReadOrCalc(dimName))greedy||dimCount--;else{dims.push(dimName);dimCount--;}}
return dims.length?dims:null;}});def.type("cdo.MatrixTranslationOper",cdo.TranslationOper).add({_initType:function(){this.J=this.metadata.length;this.I=this.source.length;this._processMetadata();this.base();},setSource:function(source){this.base(source);this.I=this.source.length;},_knownContinuousColTypes:{numeric:1,number:1,integer:1},_processMetadata:function(){var columnTypes,typeCheckingMode=this.options.typeCheckingMode,knownContinColTypes=this._knownContinuousColTypes;if("none"===typeCheckingMode)columnTypes=def.query(this.metadata).select(function(colDef,colIndex){colDef.colIndex=colIndex;var colType=colDef.colType;return colType&&1===knownContinColTypes[colType.toLowerCase()]?1:0;}).array();else{var checkNumericString="extended"===typeCheckingMode,columns=def.query(this.metadata).select(function(colDef,colIndex){colDef.colIndex=colIndex;return colDef;}).where(function(colDef){var colType=colDef.colType;return!colType||1!==knownContinColTypes[colType.toLowerCase()];}).select(function(colDef){return colDef.colIndex;}).array(),I=this.I,source=this.source,J=columns.length;columnTypes=def.array.create(this.J,1);for(var i=0;i<I&&J>0;i++)for(var row=source[i],m=0;m<J;){var j=columns[m],value=row[j];if(null!=value){columnTypes[j]=this._getSourceValueType(value,checkNumericString);columns.splice(m,1);J--;}else m++;}}
this._columnTypes=columnTypes;},_buildLogicalColumnInfoFromMetadata:function(index){var meta=this.metadata[index];return{type:this._columnTypes[index],name:meta.colName,label:meta.colLabel};},_getSourceValueType:function(value,checkNumericString){switch(typeof value){case"number":return 1;case"string":return checkNumericString&&""!==value&&!isNaN(+value)?1:0;case"object":return value instanceof Date?1:0;}
return 0;},logSource:function(){var R=cdo.previewRowsMax,C=cdo.previewColsMax,md=this.metadata,L=md.length,prepend=def.array.prepend;if(L>C){md=md.slice(0,C);md.push({colName:"("+C+"/"+L+")",colType:"..."});}
var table=def.textTable(md.length+1).rowSep().row.apply(table,prepend(md.map(function(col){return col.colName;}),["Name"])).rowSep().row.apply(table,prepend(md.map(function(col){return col.colLabel?'"'+col.colLabel+'"':"";}),["Label"])).rowSep().row.apply(table,prepend(md.map(function(col){return col.colType;}),["Type"])).rowSep();def.query(this.source).take(R).each(function(row,index){L>C&&(row=row.slice(0,C));table.row.apply(table,prepend(row.map(function(v){return def.describe(v);}),[index+1]));});table.rowSep().row("("+Math.min(R,this.I)+"/"+this.I+")").rowSep(!0);return"DATA SOURCE SUMMARY\n"+table()+"\n";},_logLogicalRow:function(kindList,kindScope){var table=def.textTable(6).rowSep().row("Index","Kind","Type","Name","Label","Dimension").rowSep(),index=0;kindList.forEach(function(kind){for(var i=0,L=kindScope[kind];i<L;i++){var info=this._logicalRowInfos[index];table.row(index,kind,info.type?"number":"string",info.name||"",info.label||"",this._userIndexesToSingleDim[index]||"");index++;}},this);table.rowSep(!0);return"LOGICAL TABLE\n"+table()+"\n";},_createPlot2SeriesKeySet:function(plot2DataSeriesIndexes,seriesKeys){var plot2SeriesKeySet=null,seriesCount=seriesKeys.length;def.query(plot2DataSeriesIndexes).each(function(indexText){var seriesIndex=+indexText;if(isNaN(seriesIndex))throw def.error.argumentInvalid("plot2SeriesIndexes","Element is not a number '{0}'.",[indexText]);if(seriesIndex<0){if(seriesIndex<=-seriesCount)throw def.error.argumentInvalid("plot2SeriesIndexes","Index is out of range '{0}'.",[seriesIndex]);seriesIndex=seriesCount+seriesIndex;}else if(seriesIndex>=seriesCount)throw def.error.argumentInvalid("plot2SeriesIndexes","Index is out of range '{0}'.",[seriesIndex]);plot2SeriesKeySet||(plot2SeriesKeySet={});plot2SeriesKeySet[seriesKeys[seriesIndex]]=!0;});return plot2SeriesKeySet;},_dataPartGet:function(calcAxis2SeriesKeySet){function calcDataPart(series,outAtoms){outAtoms[dataPartDimName]=def.hasOwn(plot2SeriesKeySet,series)?part2Atom||(part2Atom=dataPartDimension.intern("1")):part1Atom||(part1Atom=dataPartDimension.intern("0"));}
var dataPartDimension,plot2SeriesKeySet,part1Atom,part2Atom,me=this,dataPartDimName=this.options.dataPartDimName,init=function(){plot2SeriesKeySet=calcAxis2SeriesKeySet();dataPartDimension=me.data.dimensions(dataPartDimName);def.debug>=3&&plot2SeriesKeySet&&def.log("Second axis series values: "+def.describe(def.keys(plot2SeriesKeySet)));init=null;};this.complexTypeProj.setCalc({names:dataPartDimName,calculation:function(datum,outAtoms){init&&init();calcDataPart(datum.atoms.series.value,outAtoms);}});},_configureTypeCore:function(){["series","category","value"].forEach(function(physicalGroupName){this._configureTypeByPhysicalGroup(physicalGroupName);},this);}});cdo.previewRowsMax=15;cdo.previewColsMax=6;def.type("cdo.CrosstabTranslationOper",cdo.MatrixTranslationOper).add({_translType:"Crosstab",logicalColumnCount:function(){return this.R+this.C+this.M;},_executeCore:function(){function updateLogicalRowCrossGroup(crossGroupId,source){for(var logColIndex=logicalRowCrossGroupIndex[crossGroupId],sourceIndex=0,depth=me[crossGroupId];depth-->0;)logRow[logColIndex++]=source[sourceIndex++];}
function updateLogicalRowMeasure(line,cg){for(var logColIndex=logicalRowCrossGroupIndex.M,cgIndexes=me._colGroupsIndexes[cg],depth=me.M,i=0;i<depth;i++){var lineIndex=cgIndexes[i];logRow[logColIndex++]=null!=lineIndex?line[lineIndex]:null;}}
if(!this.metadata.length)return def.query();var dimsReaders=this._getDimensionsReaders(),logRow=new Array(this.logicalColumnCount()),logicalRowCrossGroupIndex=this._logicalRowCrossGroupIndex,me=this,q=def.query(this.source);if(this._colGroups&&this._colGroups.length){var expandLine=function(line){updateLogicalRowCrossGroup("R",line);return def.query(this._colGroups).select(function(colGroup,cg){updateLogicalRowCrossGroup("C",colGroup);updateLogicalRowMeasure(line,cg);return this._readLogicalRow(logRow,dimsReaders);},this);};return q.selectMany(expandLine,this);}
return q.select(function(line){updateLogicalRowCrossGroup("R",line);return this._readLogicalRow(logRow,dimsReaders);},this);},_processMetadata:function(){this.base();this._separator=this.options.separator||"~";var R=this.R=1;this.C=1;this.M=1;this.measuresDirection=null;var seriesInRows=this.options.seriesInRows,metadata=this.metadata,isV1Compat=this.options.compatVersion<=1,colNames=function(){var f=seriesInRows?function(d){return d.colName;}:isV1Compat?function(d){return{v:d.colName};}:function(d){return{v:d.colName,f:d.colLabel};};return metadata.map(f);}(),logicalRowCrossGroupInfos=this._logicalRowCrossGroupInfos={};if(this.options.isMultiValued){var measuresInColumns=def.get(this.options,"measuresInColumns",!0);if(measuresInColumns||null==this.options.measuresIndex){R=this.R=this._getCategoriesCount();var encodedColGroups=colNames.slice(R);if(encodedColGroups.length>0){if(measuresInColumns){this.measuresDirection="columns";this._processEncodedColGroups(encodedColGroups);}else{this._colGroups=encodedColGroups;this._colGroupsIndexes=[];this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=this._splitEncodedColGroupCell(colGroup);this._colGroupsIndexes[cg]=[this.R+cg];},this);logicalRowCrossGroupInfos.M=[this._buildLogicalColumnInfoFromMetadata(R)];}
this.C=this._colGroups[0].length;logicalRowCrossGroupInfos.C=def.range(0,this.C).select(function(){return{type:0};}).array();}else{this.C=this.M=0;logicalRowCrossGroupInfos.M=[];logicalRowCrossGroupInfos.C=[];}}else{this.measuresDirection="rows";this.R=+this.options.measuresIndex;var measuresCount=this.options.measuresCount;null==measuresCount&&(measuresCount=1);this.M=measuresCount;this._colGroups=colNames.slice(this.R+1);this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=[colGroup];},this);}}else{R=this.R=this._getCategoriesCount();this._colGroups=colNames.slice(R);this._colGroupsIndexes=new Array(this._colGroups.length);this._colGroups.forEach(function(colGroup,cg){this._colGroups[cg]=[colGroup];this._colGroupsIndexes[cg]=[R+cg];},this);logicalRowCrossGroupInfos.C=[{type:0}];logicalRowCrossGroupInfos.M=[{type:this._columnTypes[R]}];}
logicalRowCrossGroupInfos.R=def.range(0,this.R).select(this._buildLogicalColumnInfoFromMetadata,this).array();var logicalRowCrossGroupIndex=this._logicalRowCrossGroupIndex={C:seriesInRows?this.R:0,R:seriesInRows?0:this.C,M:this.C+this.R},logicalRowInfos=this._logicalRowInfos=new Array(this.logicalColumnCount());def.eachOwn(logicalRowCrossGroupIndex,function(groupStartIndex,crossGroup){logicalRowCrossGroupInfos[crossGroup].forEach(function(info,groupIndex){logicalRowInfos[groupStartIndex+groupIndex]=info;});});this._logicalRowPhysicalGroupsLength={series:seriesInRows?this.R:this.C,category:seriesInRows?this.C:this.R,value:this.M};this._logicalRowPhysicalGroupIndex={series:0,category:this._logicalRowPhysicalGroupsLength.series,value:this.C+this.R};},logLogicalRow:function(){return this._logLogicalRow(["C","R","M"],{C:this.C,R:this.R,M:this.M});},_getCategoriesCount:function(){var R=this.options.categoriesCount;null!=R&&(!isFinite(R)||R<0)&&(R=null);if(null==R){R=def.query(this._columnTypes).whayl(function(type){return 0===type;}).count();R||(R=1);}
return R;},_splitEncodedColGroupCell:function(colGroup){var labels,values=colGroup.v;if(null==values)values=[];else{values=values.split(this._separator);labels=colGroup.f;labels&&(labels=labels.split(this._separator));}
return values.map(function(value,index){return{v:value,f:labels&&labels[index]};});},_processEncodedColGroups:function(encodedColGroups){for(var currColGroup,L=encodedColGroups.length||def.assert("Must have columns"),R=this.R,colGroups=[],measuresInfo={},measuresInfoList=[],i=0;i<L;i++){var meaName,meaLabel,colGroupValues,colGroupLabels,colGroupCell=encodedColGroups[i],encColGroupValues=colGroupCell.v,encColGroupLabels=colGroupCell.f,sepIndex=encColGroupValues.lastIndexOf(this._separator);if(sepIndex<0){meaName=encColGroupValues;meaLabel=encColGroupLabels;encColGroupValues="";colGroupValues=[];}else{meaName=encColGroupValues.substring(sepIndex+1);encColGroupValues=encColGroupValues.substring(0,sepIndex);colGroupValues=encColGroupValues.split(this._separator);if(null!=encColGroupLabels){colGroupLabels=encColGroupLabels.split(this._separator);meaLabel=colGroupLabels.pop();}
colGroupValues.forEach(function(value,index){var label=colGroupLabels&&colGroupLabels[index];colGroupValues[index]={v:value,f:label};});}
if(currColGroup&&currColGroup.encValues===encColGroupValues)currColGroup.measureNames.push(meaName);else{currColGroup={startIndex:i,encValues:encColGroupValues,values:colGroupValues,measureNames:[meaName]};colGroups.push(currColGroup);}
var currMeaIndex=i-currColGroup.startIndex,meaInfo=def.getOwn(measuresInfo,meaName);if(meaInfo)currMeaIndex>meaInfo.groupIndex&&(meaInfo.groupIndex=currMeaIndex);else{measuresInfo[meaName]=meaInfo={name:meaName,label:meaLabel,type:this._columnTypes[R+i],groupIndex:currMeaIndex,index:i};measuresInfoList.push(meaInfo);}}
measuresInfoList.sort(function(meaInfoA,meaInfoB){return def.compare(meaInfoA.groupIndex,meaInfoB.groupIndex)||def.compare(meaInfoA.index,meaInfoB.index);});measuresInfoList.forEach(function(meaInfoA,index){meaInfoA.groupIndex=index;});var CG=colGroups.length,colGroupsValues=new Array(CG),colGroupsIndexes=new Array(CG),M=measuresInfoList.length;colGroups.map(function(colGroup,cg){colGroupsValues[cg]=colGroup.values;var colGroupStartIndex=colGroup.startIndex,meaIndexes=colGroupsIndexes[cg]=new Array(M);colGroup.measureNames.forEach(function(meaName2,localMeaIndex){var meaIndex=measuresInfo[meaName2].groupIndex;meaIndexes[meaIndex]=R+colGroupStartIndex+localMeaIndex;});});this._colGroups=colGroupsValues;this._colGroupsIndexes=colGroupsIndexes;this._logicalRowCrossGroupInfos.M=measuresInfoList;this.M=M;},configureType:function(){if("rows"===this.measuresDirection)throw def.error.notImplemented();var dataPartDimName=this.options.dataPartDimName;if(dataPartDimName&&1===this.C&&!this.complexTypeProj.isReadOrCalc(dataPartDimName)){var plot2DataSeriesIndexes=this.options.plot2DataSeriesIndexes;if(null!=plot2DataSeriesIndexes){var seriesKeys=this._colGroups.map(function(colGroup){return""+colGroup[0].v;});this._plot2SeriesKeySet=this._createPlot2SeriesKeySet(plot2DataSeriesIndexes,seriesKeys);}}
this.base();if(this._plot2SeriesKeySet){if(this._userDimsReadersByDim.series){var calcAxis2SeriesKeySet=def.fun.constant(this._plot2SeriesKeySet);this._dataPartGet(calcAxis2SeriesKeySet);}}}});def.type("cdo.RelationalTranslationOper",cdo.MatrixTranslationOper).add({M:0,C:0,S:0,_translType:"Relational",_processMetadata:function(){this.base();var S,valuesColIndexes,M,D,metadata=this.metadata,J=this.J,C=this.options.categoriesCount;null!=C&&(!isFinite(C)||C<0)&&(C=0);if(this.options.isMultiValued){valuesColIndexes=def.parseDistinctIndexArray(this.options.measuresIndexes,0,J-1);M=valuesColIndexes?valuesColIndexes.length:0;}
if(null==M)if(J>0&&J<=3&&(null==C||1===C)){M=1;valuesColIndexes=[J-1];C=J>=2?1:0;S=J>=3?1:0;D=C+S;}else if(null!=C&&C>=J){D=C=J;S=M=0;}else{var Mmax=null!=C?J-C:1/0;valuesColIndexes=def.query(metadata).where(function(colDef,index){return 0!==this._columnTypes[index];},this).select(function(colDef){return colDef.colIndex;}).take(Mmax).array();M=valuesColIndexes.length;}
if(null==D){D=J-M;if(0===D)S=C=0;else if(null!=C)if(C>D){C=D;S=0;}else S=D-C;else{S=D>1?1:0;C=D-S;}}
var seriesInRows=this.options.seriesInRows,colGroupSpecs=[];if(D){S&&!seriesInRows&&colGroupSpecs.push({name:"S",count:S});C&&colGroupSpecs.push({name:"C",count:C});S&&seriesInRows&&colGroupSpecs.push({name:"S",count:S});}
M&&colGroupSpecs.push({name:"M",count:M});var availableInputIndexes=def.range(0,J).array();valuesColIndexes&&valuesColIndexes.slice().sort(def.descending).forEach(function(inputIndex){availableInputIndexes.splice(inputIndex,1);});var specsByName={};colGroupSpecs.forEach(function(groupSpec){var count=groupSpec.count,name=groupSpec.name;specsByName[name]=groupSpec;groupSpec.indexes=valuesColIndexes&&"M"===name?valuesColIndexes:availableInputIndexes.splice(0,count);});this.M=M;this.S=S;this.C=C;var logicalRowPerm=[];["S","C","M"].forEach(function(name){var groupSpec=specsByName[name];groupSpec&&def.array.append(logicalRowPerm,groupSpec.indexes);});this._logicalRowInfos=logicalRowPerm.map(this._buildLogicalColumnInfoFromMetadata,this);this._logicalRowPerm=logicalRowPerm;this._logicalRowPhysicalGroupsLength={series:this.S,category:this.C,value:this.M};this._logicalRowPhysicalGroupIndex={series:0,category:this._logicalRowPhysicalGroupsLength.series,value:this.S+this.C};},logLogicalRow:function(){return this._logLogicalRow(["S","C","M"],{S:this.S,C:this.C,M:this.M});},configureType:function(){this.base();var dataPartDimName=this.options.dataPartDimName;if(dataPartDimName&&!this.complexTypeProj.isReadOrCalc(dataPartDimName)){var plot2DataSeriesIndexes=this.options.plot2DataSeriesIndexes;if(null!=plot2DataSeriesIndexes){var seriesReader=this._userDimsReadersByDim.series;seriesReader&&relTransl_dataPartGet.call(this,plot2DataSeriesIndexes,seriesReader);}}},_executeCore:function(){var dimsReaders=this._getDimensionsReaders(),permIndexes=this._logicalRowPerm;return def.query(this._getLogicalRows()).select(function(row){row=pv.permute(row,permIndexes);return this._readLogicalRow(row,dimsReaders);},this);}});var numFormStyle=cdo.numberFormatStyle=function(other,proto){return new NumFormStyle(other,proto);},numForm_privProp=def.priv.key().property(),NumFormStyle=numFormStyle.of=def("cdo.NumberFormatStyle",def.FieldsBase.extend({init:function(){def.classify(this,numFormStyle);},fields:{decimal:{cast:String,fail:def.falsy},group:{cast:String},groupSizes:{fail:def.array.empty},negativeSign:{cast:String,fail:def.falsy},currency:{cast:String,fail:def.falsy},integerPad:{cast:String,fail:def.falsy},fractionPad:{cast:String,fail:def.falsy},abbreviations:{fail:def.array.empty}},methods:{tryConfigure:function(other){if(def.is(other,numFormStyle))return!!this.integerPad(other.integerPad()).fractionPad(other.fractionPad()).decimal(other.decimal()).group(other.group()).groupSizes(other.groupSizes()).negativeSign(other.negativeSign()).currency(other.currency()).abbreviations(other.abbreviations());if(def.string.is(other)){var formP=langProvider(other);if(formP)return!!def.configure(this,formP.number().style());}}}},{fieldsPrivProp:numForm_privProp}));def.classify(NumFormStyle.prototype,numFormStyle);numFormStyle.defaults=numFormStyle({integerPad:"0",fractionPad:"0",decimal:".",group:",",groupSizes:[3],abbreviations:["k","m","b","t"],negativeSign:"-",currency:"$"});var numForm=cdo.numberFormat=function(config,proto){function numFormat(value){formatter||(formatter=numForm_cachedFormatter(fields.mask));return formatter(value,numForm_privProp(fields.style));}
var fields,formatter;numFormat.format=numFormat;numFormat.tryConfigure=numForm_tryConfigure;def.classify(numFormat,numForm);fields=def.instance(numFormat,config,proto,{mask:{cast:String,change:function(){formatter=null;}},style:{cast:def.createAs(NumFormStyle),factory:numFormStyle}});return numFormat;};numForm.defaults=numForm().style(numFormStyle());numForm.cacheLimit=20;var numForm_cache={},numForm_cacheCount=0,dateForm=cdo.dateFormat=function(config,proto){function dateFormat(value){formatter||(formatter=dateForm_createFormatter(fields.mask));return formatter(value);}
var fields,formatter;dateFormat.format=dateFormat;dateFormat.tryConfigure=dateForm_tryConfigure;def.classify(dateFormat,dateForm);fields=def.instance(dateFormat,config,proto,{mask:{cast:String,change:function(){formatter=null;}}});arguments.length&&def.configure(dateFormat,arguments[0]);return dateFormat;};dateForm.defaults=dateForm();var customForm=cdo.customFormat=function(config,proto){function customFormat(v){var formatter=fields.formatter;return String(formatter&&formatter.apply(null,arguments));}
var fields;customFormat.format=customFormat;customFormat.tryConfigure=customForm_tryConfigure;def.classify(customFormat,customForm);fields=def.instance(customFormat,config,proto,{formatter:{cast:def.fun.as}});return customFormat;};customForm.defaults=customForm().formatter(customForm_defaultFormatter);var _defaultLangCode="en-us",formProvider=cdo.format=function(config,proto){function formatProvider(){}
formatProvider.tryConfigure=formProvider_tryConfigure;var language;if(!proto&&def.string.is(config)){var formP=langProvider(config);language=formP.languageCode;if(formP){proto=formP;config=null;}}
formatProvider.languageCode=language||_defaultLangCode;def.classify(formatProvider,formProvider);def.instance(formatProvider,config,proto,{number:formProvider_field(numForm),percent:formProvider_field(numForm),date:formProvider_field(dateForm),any:{cast:def.createAs(customForm),factory:customForm}});return formatProvider;};formProvider.defaults=formProvider({number:"#,0.##",percent:"#,0.#%",date:"%Y/%m/%d",any:customForm()});var _languages={},_currentProvider=_languages[_defaultLangCode]=formProvider.defaults,langProvider=cdo.format.language=function(style,config){var L=arguments.length;if(!L)return _currentProvider;if(1==L){if(void 0===style)throw def.error.operationInvalid("Undefined 'style' value.");if(null===style||""===style)style=_defaultLangCode;else{if(def.is(style,formProvider))return _currentProvider=style;if("object"==typeof style){for(var key in style)configLanguage(key,def.getOwn(style,key));return cdo.format;}}
return getLanguage(style,!0);}
if(2==L)return configLanguage(style,config);throw def.error.operationInvalid("Wrong number of arguments");};langProvider({"en-gb":{number:{mask:"#,0.##",style:{integerPad:"0",fractionPad:"0",decimal:".",group:",",groupSizes:[3],abbreviations:["k","m","b","t"],negativeSign:"-",currency:""}},date:{mask:"%d/%m/%Y"}},"pt-pt":{number:{mask:"#,0.##",style:{integerPad:"0",fractionPad:"0",decimal:",",group:" ",groupSizes:[3],abbreviations:["k","m","b","t"],negativeSign:"-",currency:""}},date:{mask:"%d/%m/%Y"}}});return cdo;});
(function($){"use strict";$.prompt=function(message,options){if(options!==undefined&&options.classes!==undefined&&typeof options.classes==='string'){options={box:options.classes};}
$.prompt.options=$.extend({},$.prompt.defaults,options);$.prompt.currentPrefix=$.prompt.options.prefix;if($.prompt.timeout){clearTimeout($.prompt.timeout);}
$.prompt.timeout=false;var opts=$.prompt.options,$body=$(document.body),$window=$(window);var msgbox='<div class="'+$.prompt.options.prefix+'box '+opts.classes.box+'">';if(opts.useiframe&&($('object, applet').length>0)){msgbox+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+opts.prefix+'fade '+opts.classes.fade+'"></iframe>';}else{msgbox+='<div class="'+opts.prefix+'fade '+opts.classes.fade+'"></div>';}
msgbox+='<div class="'+opts.prefix+' '+opts.classes.prompt+'">'+'<form action="javascript:false;" onsubmit="return false;" class="'+opts.prefix+'form '+opts.classes.form+'">'+'<div class="'+opts.prefix+'close '+opts.classes.close+'">'+opts.closeText+'</div>'+'<div class="'+opts.prefix+'states"></div>'+'</form>'+'</div>'+'</div>';$.prompt.jqib=$(msgbox).appendTo($body);$.prompt.jqi=$.prompt.jqib.children('.'+opts.prefix);$.prompt.jqif=$.prompt.jqib.children('.'+opts.prefix+'fade');if(message.constructor===String){message={state0:{title:opts.title,html:message,buttons:opts.buttons,position:opts.position,focus:opts.focus,defaultButton:opts.defaultButton,submit:opts.submit}};}
$.prompt.options.states={};var k,v;for(k in message){v=$.extend({},$.prompt.defaults.state,{name:k},message[k]);$.prompt.addState(v.name,v);if($.prompt.currentStateName===''){$.prompt.currentStateName=v.name;}}
$.prompt.jqi.on('click','.'+opts.prefix+'buttons button',function(e){var $t=$(this),$state=$t.parents('.'+opts.prefix+'state'),stateobj=$.prompt.options.states[$state.data('jqi-name')],msg=$state.children('.'+opts.prefix+'message'),clicked=stateobj.buttons[$t.text()]||stateobj.buttons[$t.html()],forminputs={};if(clicked===undefined){for(var i in stateobj.buttons){if(stateobj.buttons[i].title===$t.text()||stateobj.buttons[i].title===$t.html()){clicked=stateobj.buttons[i].value;}}}
$.each($.prompt.jqi.children('form').serializeArray(),function(i,obj){if(forminputs[obj.name]===undefined){forminputs[obj.name]=obj.value;}else if(typeof forminputs[obj.name]===Array||typeof forminputs[obj.name]==='object'){forminputs[obj.name].push(obj.value);}else{forminputs[obj.name]=[forminputs[obj.name],obj.value];}});var promptsubmite=new $.Event('impromptu:submit');promptsubmite.stateName=stateobj.name;promptsubmite.state=$state;$state.trigger(promptsubmite,[clicked,msg,forminputs]);if(!promptsubmite.isDefaultPrevented()){$.prompt.close(true,clicked,msg,forminputs);}});var fadeClicked=function(){if(opts.persistent){var offset=(opts.top.toString().indexOf('%')>=0?($window.height()*(parseInt(opts.top,10)/100)):parseInt(opts.top,10)),top=parseInt($.prompt.jqi.css('top').replace('px',''),10)-offset;$('html,body').animate({scrollTop:top},'fast',function(){var i=0;$.prompt.jqib.addClass(opts.prefix+'warning');var intervalid=setInterval(function(){$.prompt.jqib.toggleClass(opts.prefix+'warning');if(i++>1){clearInterval(intervalid);$.prompt.jqib.removeClass(opts.prefix+'warning');}},100);});}
else{$.prompt.close(true);}};var keyDownEventHandler=function(e){var key=(window.event)?event.keyCode:e.keyCode;if(key===27){fadeClicked();}
if(key===13){var $defBtn=$.prompt.getCurrentState().find('.'+opts.prefix+'defaultbutton');var $tgt=$(e.target);if($tgt.is('textarea,.'+opts.prefix+'button')===false&&$defBtn.length>0){e.preventDefault();$defBtn.click();}}
if(key===9){var $inputels=$('input,select,textarea,button',$.prompt.getCurrentState());var fwd=!e.shiftKey&&e.target===$inputels[$inputels.length-1];var back=e.shiftKey&&e.target===$inputels[0];if(fwd||back){setTimeout(function(){if(!$inputels){return;}
var el=$inputels[back===true?$inputels.length-1:0];if(el){el.focus();}},10);return false;}}};$.prompt.position();$.prompt.style();$.prompt.jqif.click(fadeClicked);$window.resize({animate:false},$.prompt.position);$.prompt.jqi.find('.'+opts.prefix+'close').click($.prompt.close);$.prompt.jqib.on("keydown",keyDownEventHandler).on('impromptu:loaded',opts.loaded).on('impromptu:close',opts.close).on('impromptu:statechanging',opts.statechanging).on('impromptu:statechanged',opts.statechanged);$.prompt.jqif[opts.show](opts.overlayspeed);$.prompt.jqi[opts.show](opts.promptspeed,function(){var $firstState=$.prompt.jqi.find('.'+opts.prefix+'states .'+opts.prefix+'state').eq(0);$.prompt.goToState($firstState.data('jqi-name'));$.prompt.jqib.trigger('impromptu:loaded');});if(opts.timeout>0){$.prompt.timeout=setTimeout(function(){$.prompt.close(true);},opts.timeout);}
return $.prompt.jqib;};$.prompt.defaults={prefix:'jqi',classes:{box:'',fade:'',prompt:'',form:'',close:'',title:'',message:'',buttons:'',button:'',defaultButton:''},title:'',closeText:'&times;',buttons:{Ok:true},loaded:function(e){},submit:function(e,v,m,f){},close:function(e,v,m,f){},statechanging:function(e,from,to){},statechanged:function(e,to){},opacity:0.6,zIndex:999,overlayspeed:'slow',promptspeed:'fast',show:'fadeIn',focus:0,defaultButton:0,useiframe:false,top:'15%',position:{container:null,x:null,y:null,arrow:null,width:null},persistent:true,timeout:0,states:{},state:{name:null,title:'',html:'',buttons:{Ok:true},focus:0,defaultButton:0,position:{container:null,x:null,y:null,arrow:null,width:null},submit:function(e,v,m,f){return true;}}};$.prompt.currentPrefix=$.prompt.defaults.prefix;$.prompt.currentStateName="";$.prompt.setDefaults=function(o){$.prompt.defaults=$.extend({},$.prompt.defaults,o);};$.prompt.setStateDefaults=function(o){$.prompt.defaults.state=$.extend({},$.prompt.defaults.state,o);};$.prompt.position=function(e){var restoreFx=$.fx.off,$state=$.prompt.getCurrentState(),stateObj=$.prompt.options.states[$state.data('jqi-name')],pos=stateObj?stateObj.position:undefined,$window=$(window),bodyHeight=document.body.scrollHeight,windowHeight=$(window).height(),documentHeight=$(document).height(),height=bodyHeight>windowHeight?bodyHeight:windowHeight,top=parseInt($window.scrollTop(),10)+($.prompt.options.top.toString().indexOf('%')>=0?(windowHeight*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10));if(e!==undefined&&e.data.animate===false){$.fx.off=true;}
$.prompt.jqib.css({position:"absolute",height:height,width:"100%",top:0,left:0,right:0,bottom:0});$.prompt.jqif.css({position:"fixed",height:height,width:"100%",top:0,left:0,right:0,bottom:0});if(pos&&pos.container){var offset=$(pos.container).offset();if($.isPlainObject(offset)&&offset.top!==undefined){$.prompt.jqi.css({position:"absolute"});$.prompt.jqi.animate({top:offset.top+pos.y,left:offset.left+pos.x,marginLeft:0,width:(pos.width!==undefined)?pos.width:null});top=(offset.top+pos.y)-($.prompt.options.top.toString().indexOf('%')>=0?(windowHeight*(parseInt($.prompt.options.top,10)/100)):parseInt($.prompt.options.top,10));$('html,body').animate({scrollTop:top},'slow','swing',function(){});}}
else if(pos&&pos.width){$.prompt.jqi.css({position:"absolute",left:'50%'});$.prompt.jqi.animate({top:pos.y||top,left:pos.x||'50%',marginLeft:((pos.width/2)*-1),width:pos.width});}
else{$.prompt.jqi.css({position:"absolute",top:top,left:'50%',marginLeft:(($.prompt.jqi.outerWidth(false)/2)*-1)});}
if(e!==undefined&&e.data.animate===false){$.fx.off=restoreFx;}};$.prompt.style=function(){$.prompt.jqif.css({zIndex:$.prompt.options.zIndex,display:"none",opacity:$.prompt.options.opacity});$.prompt.jqi.css({zIndex:$.prompt.options.zIndex+1,display:"none"});$.prompt.jqib.css({zIndex:$.prompt.options.zIndex});};$.prompt.get=function(state){return $('.'+$.prompt.currentPrefix);};$.prompt.addState=function(statename,stateobj,afterState){var state="",$state=null,arrow="",title="",opts=$.prompt.options,$jqistates=$('.'+$.prompt.currentPrefix+'states'),defbtn,k,v,i=0;stateobj=$.extend({},$.prompt.defaults.state,{name:statename},stateobj);if(stateobj.position.arrow!==null){arrow='<div class="'+opts.prefix+'arrow '+opts.prefix+'arrow'+stateobj.position.arrow+'"></div>';}
if(stateobj.title&&stateobj.title!==''){title='<div class="lead '+opts.prefix+'title '+opts.classes.title+'">'+stateobj.title+'</div>';}
state+='<div id="'+opts.prefix+'state_'+statename+'" class="'+opts.prefix+'state" data-jqi-name="'+statename+'" style="display:none;">'+
arrow+title+'<div class="'+opts.prefix+'message '+opts.classes.message+'">'+stateobj.html+'</div>'+'<div class="'+opts.prefix+'buttons '+opts.classes.buttons+'"'+($.isEmptyObject(stateobj.buttons)?'style="display:none;"':'')+'>';for(k in stateobj.buttons){v=stateobj.buttons[k],defbtn=stateobj.focus===i||(isNaN(stateobj.focus)&&stateobj.defaultButton===i)?($.prompt.currentPrefix+'defaultbutton '+opts.classes.defaultButton):'';if(typeof v==='object'){state+='<button class="'+opts.classes.button+' '+$.prompt.currentPrefix+'button '+defbtn;if(typeof v.classes!=="undefined"){state+=' '+($.isArray(v.classes)?v.classes.join(' '):v.classes)+' ';}
state+='" name="'+opts.prefix+'_'+statename+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" id="'+opts.prefix+'_'+statename+'_button'+v.title.replace(/[^a-z0-9]+/gi,'')+'" value="'+v.value+'">'+v.title+'</button>';}else{state+='<button class="'+$.prompt.currentPrefix+'button '+opts.classes.button+' '+defbtn+'" name="'+opts.prefix+'_'+statename+'_button'+k.replace(/[^a-z0-9]+/gi,'')+'" id="'+opts.prefix+'_'+statename+'_button'+k.replace(/[^a-z0-9]+/gi,'')+'" value="'+v+'">'+k+'</button>';}
i++;}
state+='</div></div>';$state=$(state);$state.on('impromptu:submit',stateobj.submit);if(afterState!==undefined){$jqistates.find('#'+$.prompt.currentPrefix+'state_'+afterState).after($state);}
else{$jqistates.append($state);}
$.prompt.options.states[statename]=stateobj;return $state;};$.prompt.removeState=function(state,newState){var $state=$.prompt.getState(state),rm=function(){$state.remove();};if($state.length===0){return false;}
if($state.css('display')!=='none'){if(newState!==undefined&&$.prompt.getState(newState).length>0){$.prompt.goToState(newState,false,rm);}
else if($state.next().length>0){$.prompt.nextState(rm);}
else if($state.prev().length>0){$.prompt.prevState(rm);}
else{$.prompt.close();}}
else{$state.slideUp('slow',rm);}
return true;};$.prompt.getState=function(state){return $('#'+$.prompt.currentPrefix+'state_'+state);};$.prompt.getStateContent=function(state){return $.prompt.getState(state);};$.prompt.getCurrentState=function(){return $.prompt.getState($.prompt.getCurrentStateName());};$.prompt.getCurrentStateName=function(){return $.prompt.currentStateName;};$.prompt.goToState=function(state,subState,callback){var $jqi=$.prompt.get(),jqiopts=$.prompt.options,$state=$.prompt.getState(state),stateobj=jqiopts.states[$state.data('jqi-name')],promptstatechanginge=new $.Event('impromptu:statechanging');if(typeof subState==='function'){callback=subState;subState=false;}
$.prompt.jqib.trigger(promptstatechanginge,[$.prompt.getCurrentStateName(),state]);if(!promptstatechanginge.isDefaultPrevented()&&$state.length>0){$.prompt.jqi.find('.'+$.prompt.currentPrefix+'parentstate').removeClass($.prompt.currentPrefix+'parentstate');if(subState){$.prompt.jqi.find('.'+$.prompt.currentPrefix+'substate').not($state).slideUp(jqiopts.promptspeed).removeClass('.'+$.prompt.currentPrefix+'substate').find('.'+$.prompt.currentPrefix+'arrow').hide();$.prompt.jqi.find('.'+$.prompt.currentPrefix+'state:visible').addClass($.prompt.currentPrefix+'parentstate');$state.addClass($.prompt.currentPrefix+'substate');}
else{$.prompt.jqi.find('.'+$.prompt.currentPrefix+'state').not($state).slideUp(jqiopts.promptspeed).find('.'+$.prompt.currentPrefix+'arrow').hide();}
$.prompt.currentStateName=stateobj.name;$state.slideDown(jqiopts.promptspeed,function(){var $t=$(this);if(typeof(stateobj.focus)==='string'){$t.find(stateobj.focus).eq(0).focus();}
else{$t.find('.'+$.prompt.currentPrefix+'defaultbutton').focus();}
$t.find('.'+$.prompt.currentPrefix+'arrow').show(jqiopts.promptspeed);if(typeof callback==='function'){$.prompt.jqib.on('impromptu:statechanged',callback);}
$.prompt.jqib.trigger('impromptu:statechanged',[state]);if(typeof callback==='function'){$.prompt.jqib.off('impromptu:statechanged',callback);}});if(!subState){$.prompt.position();}}
return $state;};$.prompt.nextState=function(callback){var $next=$('#'+$.prompt.currentPrefix+'state_'+$.prompt.getCurrentStateName()).next();if($next.length>0){$.prompt.goToState($next.attr('id').replace($.prompt.currentPrefix+'state_',''),callback);}
return $next;};$.prompt.prevState=function(callback){var $prev=$('#'+$.prompt.currentPrefix+'state_'+$.prompt.getCurrentStateName()).prev();if($prev.length>0){$.prompt.goToState($prev.attr('id').replace($.prompt.currentPrefix+'state_',''),callback);}
return $prev;};$.prompt.close=function(callCallback,clicked,msg,formvals){if($.prompt.timeout){clearTimeout($.prompt.timeout);$.prompt.timeout=false;}
if($.prompt.jqib){$.prompt.jqib.fadeOut('fast',function(){$.prompt.jqib.trigger('impromptu:close',[clicked,msg,formvals]);$.prompt.jqib.remove();$(window).off('resize',$.prompt.position);});}
$.prompt.currentStateName="";};$.fn.prompt=function(options){if(options===undefined){options={};}
if(options.withDataAndEvents===undefined){options.withDataAndEvents=false;}
$.prompt($(this).clone(options.withDataAndEvents).html(),options);};})(jQuery);
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{factory(jQuery);}}(function($){$.ui=$.ui||{};var version=$.ui.version="1.12.1";var widgetUuid=0;var widgetSlice=Array.prototype.slice;$.cleanData=(function(orig){return function(elems){var events,elem,i;for(i=0;(elem=elems[i])!=null;i++){try{events=$._data(elem,"events");if(events&&events.remove){$(elem).triggerHandler("remove");}}catch(e){}}
orig(elems);};})($.cleanData);$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype;var proxiedPrototype={};var namespace=name.split(".")[0];name=name.split(".")[1];var fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}
if($.isArray(prototype)){prototype=$.extend.apply(null,[{}].concat(prototype));}
$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}
if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;}
proxiedPrototype[prop]=(function(){function _super(){return base.prototype[prop].apply(this,arguments);}
function _superApply(args){return base.prototype[prop].apply(this,args);}
return function(){var __super=this._super;var __superApply=this._superApply;var returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}
$.widget.bridge(name,constructor);return constructor;};$.widget.extend=function(target){var input=widgetSlice.call(arguments,1);var inputIndex=0;var inputLength=input.length;var key;var value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}
return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string";var args=widgetSlice.call(arguments,1);var returnValue=this;if(isMethodCall){if(!this.length&&options==="instance"){returnValue=undefined;}else{this.each(function(){var methodValue;var instance=$.data(this,fullName);if(options==="instance"){returnValue=instance;return false;}
if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}
methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}}else{if(args.length){options=$.widget.extend.apply(null,[options].concat(args));}
this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{});if(instance._init){instance._init();}}else{$.data(this,fullName,new object(options,this));}});}
return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=widgetUuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.bindings=$();this.hoverable=$();this.focusable=$();this.classesElementLookup={};if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}
this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this._create();if(this.options.disabled){this._setOptionDisabled(this.options.disabled);}
this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:function(){return{};},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy();$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key);});this.element.off(this.eventNamespace).removeData(this.widgetFullName);this.widget().off(this.eventNamespace).removeAttr("aria-disabled");this.bindings.off(this.eventNamespace);},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key;var parts;var curOption;var i;if(arguments.length===0){return $.widget.extend({},this.options);}
if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}
key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}
curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}
options[key]=value;}}
this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}
return this;},_setOption:function(key,value){if(key==="classes"){this._setOptionClasses(value);}
this.options[key]=value;if(key==="disabled"){this._setOptionDisabled(value);}
return this;},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value){currentElements=this.classesElementLookup[classKey];if(value[classKey]===this.options.classes[classKey]||!currentElements||!currentElements.length){continue;}
elements=$(currentElements.get());this._removeClass(currentElements,classKey);elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:true}));}},_setOptionDisabled:function(value){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value);if(value){this._removeClass(this.hoverable,null,"ui-state-hover");this._removeClass(this.focusable,null,"ui-state-focus");}},enable:function(){return this._setOptions({disabled:false});},disable:function(){return this._setOptions({disabled:true});},_classes:function(options){var full=[];var that=this;options=$.extend({element:this.element,classes:this.options.classes||{}},options);function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++){current=that.classesElementLookup[classes[i]]||$();if(options.add){current=$($.unique(current.get().concat(options.element.get())));}else{current=$(current.not(options.element).get());}
that.classesElementLookup[classes[i]]=current;full.push(classes[i]);if(checkOption&&options.classes[classes[i]]){full.push(options.classes[classes[i]]);}}}
this._on(options.element,{"remove":"_untrackClassesElement"});if(options.keys){processClassString(options.keys.match(/\S+/g)||[],true);}
if(options.extra){processClassString(options.extra.match(/\S+/g)||[]);}
return full.join(" ");},_untrackClassesElement:function(event){var that=this;$.each(that.classesElementLookup,function(key,value){if($.inArray(event.target,value)!==-1){that.classesElementLookup[key]=$(value.not(event.target).get());}});},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,false);},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,true);},_toggleClass:function(element,keys,extra,add){add=(typeof add==="boolean")?add:extra;var shift=(typeof element==="string"||element===null),options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};options.element.toggleClass(this._classes(options),add);return this;},_on:function(suppressDisabledCheck,element,handlers){var delegateElement;var instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}
if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}
$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return;}
return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}
var match=event.match(/^([\w:-]*)\s*(.*)$/);var eventName=match[1]+instance.eventNamespace;var selector=match[2];if(selector){delegateElement.on(eventName,selector,handlerProxy);}else{element.on(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+
this.eventNamespace;element.off(eventName).off(eventName);this.bindings=$(this.bindings.not(element).get());this.focusable=$(this.focusable.not(element).get());this.hoverable=$(this.hoverable.not(element).get());},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}
var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,"ui-state-hover");},mouseleave:function(event){this._removeClass($(event.currentTarget),null,"ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,"ui-state-focus");},focusout:function(event){this._removeClass($(event.currentTarget),null,"ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig;var callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}
this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}
var hasOptions;var effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}
hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}
if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}
next();});}};});var widget=$.widget;(function(){var cachedScrollbarWidth,max=Math.max,abs=Math.abs,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}
function parseCss(element,property){return parseInt($.css(element,property),10)||0;}
function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}
if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}
if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}
return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}
$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}
var w1,w2,div=$("<div "+"style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>"+"<div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}
div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9,hasOffset=!isWindow&&!isDocument;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:hasOffset?$(element).offset():{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}
options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}
targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}
pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}
if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}
if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}
atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+
scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+
scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}
if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}
position.left+=myOffset[0];position.top+=myOffset[1];collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}
if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}
if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}
options.using.call(this,props,feedback);};}
elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-
withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-
withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-
outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+
atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-
outerHeight-withinOffset;if(newOverBottom<0||newOverBottom<abs(overTop)){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+
offset-offsetTop;if(newOverTop>0||abs(newOverTop)<overBottom){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};})();var position=$.ui.position;var data=$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);}});var disableSelection=$.fn.extend({disableSelection:(function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(eventType+".ui-disableSelection",function(event){event.preventDefault();});};})(),enableSelection:function(){return this.off(".ui-disableSelection");}});var dataSpace="ui-effects-",dataSpaceStyle="ui-effects-style",dataSpaceAnimated="ui-effects-animated",jQuery=$;$.effects={effect:{}};(function(jQuery,undefined){var stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor "+"borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},propTypes={"byte":{floor:true,max:255},"percent":{max:1},"degrees":{mod:360,floor:true}},support=color.support={},supportElem=jQuery("<p>")[0],colors,each=jQuery.each;supportElem.style.cssText="background-color:rgba(1,1,1,.5)";support.rgba=supportElem.style.backgroundColor.indexOf("rgba")>-1;each(spaces,function(spaceName,space){space.cache="_"+spaceName;space.props.alpha={idx:3,type:"percent",def:1};});function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}
value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}
if(type.mod){return(value+type.mod)%type.mod;}
return 0>value?0:type.max<value?type.max:value;}
function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba";if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==="0,0,0,0"){jQuery.extend(rgba,colors.transparent);}
return inst;}
return colors[string];}
color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}
if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}
var inst=this,type=jQuery.type(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type="array";}
if(type==="string"){return this.parse(stringParse(red)||colors._default);}
if(type==="array"){each(spaces.rgba.props,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}
if(type==="object"){if(red instanceof color){each(spaces,function(spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==="alpha"||red[key]==null){return;}
inst[cache]=space.to(inst._rgba);}
inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&jQuery.inArray(null,inst[cache].slice(0,3))<0){inst[cache][3]=1;if(space.from){inst._rgba=space.from(inst[cache]);}}});}
return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}
return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color("transparent"):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}
if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod/2){startValue+=type.mod;}else if(startValue-endValue>type.mod/2){startValue-=type.mod;}}
result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}
var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return v==null?(i>2?1:0):v;});if(rgba[3]===1){rgba.pop();prefix="rgb(";}
return prefix+rgba.join()+")";},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}
if(i&&i<3){v=Math.round(v*100)+"%";}
return v;});if(hsla[3]===1){hsla.pop();prefix="hsl(";}
return prefix+hsla.join()+")";},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}
return"#"+jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?"0"+v:v;}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}
if(h*2<1){return q;}
if(h*3<2){return p+(q-p)*((2/3)-h)*6;}
return p;}
spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}
var r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/diff)+360;}else if(g===max){h=(60*(b-r)/diff)+120;}else{h=(60*(r-g)/diff)+240;}
if(diff===0){s=0;}else if(l<=0.5){s=diff/add;}else{s=diff/(2-add);}
return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}
var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1/3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1/3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}
if(value===undefined){return this[cache].slice();}
var ret,type=jQuery.type(value),arr=(type==="array"||type==="object")?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==="object"?key:prop.idx];if(val==null){val=local[prop.idx];}
local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}
color.fn[key]=function(value){var vtype=jQuery.type(value),fn=(key==="alpha"?(this._hsla?"hsla":"rgba"):spaceName),local=this[fn](),cur=local[prop.idx],match;if(vtype==="undefined"){return cur;}
if(vtype==="function"){value=value.call(this,cur);vtype=jQuery.type(value);}
if(value==null&&prop.empty){return this;}
if(vtype==="string"){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==="+"?1:-1);}}
local[prop.idx]=value;return this[fn](local);};});});color.hook=function(hook){var hooks=hook.split(" ");each(hooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor="";if(value!=="transparent"&&(jQuery.type(value)!=="string"||(parsed=stringParse(value)))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==="backgroundColor"?elem.parentNode:elem;while((backgroundColor===""||backgroundColor==="transparent")&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,"backgroundColor");curElem=curElem.parentNode;}catch(e){}}
value=value.blend(backgroundColor&&backgroundColor!=="transparent"?backgroundColor:"_default");}
value=value.toRgbaString();}
try{elem.style[hook]=value;}catch(e){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}
jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});};color.hook(stepHooks);jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(["Top","Right","Bottom","Left"],function(i,part){expanded["border"+part+"Color"]=value;});return expanded;}};colors=jQuery.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};})(jQuery);(function(){var classAnimationActions=["add","remove","toggle"],shorthandStyles={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};$.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(_,prop){$.fx.step[prop]=function(fx){if(fx.end!=="none"&&!fx.setAttr||fx.pos===1&&!fx.setAttr){jQuery.style(fx.elem,prop,fx.end);fx.setAttr=true;}};});function getElementStyles(elem){var key,len,style=elem.ownerDocument.defaultView?elem.ownerDocument.defaultView.getComputedStyle(elem,null):elem.currentStyle,styles={};if(style&&style.length&&style[0]&&style[style[0]]){len=style.length;while(len--){key=style[len];if(typeof style[key]==="string"){styles[$.camelCase(key)]=style[key];}}}else{for(key in style){if(typeof style[key]==="string"){styles[key]=style[key];}}}
return styles;}
function styleDifference(oldStyle,newStyle){var diff={},name,value;for(name in newStyle){value=newStyle[name];if(oldStyle[name]!==value){if(!shorthandStyles[name]){if($.fx.step[name]||!isNaN(parseFloat(value))){diff[name]=value;}}}}
return diff;}
if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}
$.effects.animateClass=function(value,duration,easing,callback){var o=$.speed(duration,easing,callback);return this.queue(function(){var animated=$(this),baseClass=animated.attr("class")||"",applyClassChange,allAnimations=o.children?animated.find("*").addBack():animated;allAnimations=allAnimations.map(function(){var el=$(this);return{el:el,start:getElementStyles(this)};});applyClassChange=function(){$.each(classAnimationActions,function(i,action){if(value[action]){animated[action+"Class"](value[action]);}});};applyClassChange();allAnimations=allAnimations.map(function(){this.end=getElementStyles(this.el[0]);this.diff=styleDifference(this.start,this.end);return this;});animated.attr("class",baseClass);allAnimations=allAnimations.map(function(){var styleInfo=this,dfd=$.Deferred(),opts=$.extend({},o,{queue:false,complete:function(){dfd.resolve(styleInfo);}});this.el.animate(this.diff,opts);return dfd.promise();});$.when.apply($,allAnimations.get()).done(function(){applyClassChange();$.each(arguments,function(){var el=this.el;$.each(this.diff,function(key){el.css(key,"");});});o.complete.call(animated[0]);});});};$.fn.extend({addClass:(function(orig){return function(classNames,speed,easing,callback){return speed?$.effects.animateClass.call(this,{add:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.addClass),removeClass:(function(orig){return function(classNames,speed,easing,callback){return arguments.length>1?$.effects.animateClass.call(this,{remove:classNames},speed,easing,callback):orig.apply(this,arguments);};})($.fn.removeClass),toggleClass:(function(orig){return function(classNames,force,speed,easing,callback){if(typeof force==="boolean"||force===undefined){if(!speed){return orig.apply(this,arguments);}else{return $.effects.animateClass.call(this,(force?{add:classNames}:{remove:classNames}),speed,easing,callback);}}else{return $.effects.animateClass.call(this,{toggle:classNames},force,speed,easing);}};})($.fn.toggleClass),switchClass:function(remove,add,speed,easing,callback){return $.effects.animateClass.call(this,{add:add,remove:remove},speed,easing,callback);}});})();(function(){if($.expr&&$.expr.filters&&$.expr.filters.animated){$.expr.filters.animated=(function(orig){return function(elem){return!!$(elem).data(dataSpaceAnimated)||orig(elem);};})($.expr.filters.animated);}
if($.uiBackCompat!==false){$.extend($.effects,{save:function(element,set){var i=0,length=set.length;for(;i<length;i++){if(set[i]!==null){element.data(dataSpace+set[i],element[0].style[set[i]]);}}},restore:function(element,set){var val,i=0,length=set.length;for(;i<length;i++){if(set[i]!==null){val=element.data(dataSpace+set[i]);element.css(set[i],val);}}},setMode:function(el,mode){if(mode==="toggle"){mode=el.is(":hidden")?"show":"hide";}
return mode;},createWrapper:function(element){if(element.parent().is(".ui-effects-wrapper")){return element.parent();}
var props={width:element.outerWidth(true),height:element.outerHeight(true),"float":element.css("float")},wrapper=$("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),size={width:element.width(),height:element.height()},active=document.activeElement;try{active.id;}catch(e){active=document.body;}
element.wrap(wrapper);if(element[0]===active||$.contains(element[0],active)){$(active).trigger("focus");}
wrapper=element.parent();if(element.css("position")==="static"){wrapper.css({position:"relative"});element.css({position:"relative"});}else{$.extend(props,{position:element.css("position"),zIndex:element.css("z-index")});$.each(["top","left","bottom","right"],function(i,pos){props[pos]=element.css(pos);if(isNaN(parseInt(props[pos],10))){props[pos]="auto";}});element.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"});}
element.css(size);return wrapper.css(props).show();},removeWrapper:function(element){var active=document.activeElement;if(element.parent().is(".ui-effects-wrapper")){element.parent().replaceWith(element);if(element[0]===active||$.contains(element[0],active)){$(active).trigger("focus");}}
return element;}});}
$.extend($.effects,{version:"1.12.1",define:function(name,mode,effect){if(!effect){effect=mode;mode="effect";}
$.effects.effect[name]=effect;$.effects.effect[name].mode=mode;return effect;},scaledDimensions:function(element,percent,direction){if(percent===0){return{height:0,width:0,outerHeight:0,outerWidth:0};}
var x=direction!=="horizontal"?((percent||100)/100):1,y=direction!=="vertical"?((percent||100)/100):1;return{height:element.height()*y,width:element.width()*x,outerHeight:element.outerHeight()*y,outerWidth:element.outerWidth()*x};},clipToBox:function(animation){return{width:animation.clip.right-animation.clip.left,height:animation.clip.bottom-animation.clip.top,left:animation.clip.left,top:animation.clip.top};},unshift:function(element,queueLength,count){var queue=element.queue();if(queueLength>1){queue.splice.apply(queue,[1,0].concat(queue.splice(queueLength,count)));}
element.dequeue();},saveStyle:function(element){element.data(dataSpaceStyle,element[0].style.cssText);},restoreStyle:function(element){element[0].style.cssText=element.data(dataSpaceStyle)||"";element.removeData(dataSpaceStyle);},mode:function(element,mode){var hidden=element.is(":hidden");if(mode==="toggle"){mode=hidden?"show":"hide";}
if(hidden?mode==="hide":mode==="show"){mode="none";}
return mode;},getBaseline:function(origin,original){var y,x;switch(origin[0]){case"top":y=0;break;case"middle":y=0.5;break;case"bottom":y=1;break;default:y=origin[0]/original.height;}
switch(origin[1]){case"left":x=0;break;case"center":x=0.5;break;case"right":x=1;break;default:x=origin[1]/original.width;}
return{x:x,y:y};},createPlaceholder:function(element){var placeholder,cssPosition=element.css("position"),position=element.position();element.css({marginTop:element.css("marginTop"),marginBottom:element.css("marginBottom"),marginLeft:element.css("marginLeft"),marginRight:element.css("marginRight")}).outerWidth(element.outerWidth()).outerHeight(element.outerHeight());if(/^(static|relative)/.test(cssPosition)){cssPosition="absolute";placeholder=$("<"+element[0].nodeName+">").insertAfter(element).css({display:/^(inline|ruby)/.test(element.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:element.css("marginTop"),marginBottom:element.css("marginBottom"),marginLeft:element.css("marginLeft"),marginRight:element.css("marginRight"),"float":element.css("float")}).outerWidth(element.outerWidth()).outerHeight(element.outerHeight()).addClass("ui-effects-placeholder");element.data(dataSpace+"placeholder",placeholder);}
element.css({position:cssPosition,left:position.left,top:position.top});return placeholder;},removePlaceholder:function(element){var dataKey=dataSpace+"placeholder",placeholder=element.data(dataKey);if(placeholder){placeholder.remove();element.removeData(dataKey);}},cleanUp:function(element){$.effects.restoreStyle(element);$.effects.removePlaceholder(element);},setTransition:function(element,list,factor,value){value=value||{};$.each(list,function(i,x){var unit=element.cssUnit(x);if(unit[0]>0){value[x]=unit[0]*factor+unit[1];}});return value;}});function _normalizeArguments(effect,options,speed,callback){if($.isPlainObject(effect)){options=effect;effect=effect.effect;}
effect={effect:effect};if(options==null){options={};}
if($.isFunction(options)){callback=options;speed=null;options={};}
if(typeof options==="number"||$.fx.speeds[options]){callback=speed;speed=options;options={};}
if($.isFunction(speed)){callback=speed;speed=null;}
if(options){$.extend(effect,options);}
speed=speed||options.duration;effect.duration=$.fx.off?0:typeof speed==="number"?speed:speed in $.fx.speeds?$.fx.speeds[speed]:$.fx.speeds._default;effect.complete=callback||options.complete;return effect;}
function standardAnimationOption(option){if(!option||typeof option==="number"||$.fx.speeds[option]){return true;}
if(typeof option==="string"&&!$.effects.effect[option]){return true;}
if($.isFunction(option)){return true;}
if(typeof option==="object"&&!option.effect){return true;}
return false;}
$.fn.extend({effect:function(){var args=_normalizeArguments.apply(this,arguments),effectMethod=$.effects.effect[args.effect],defaultMode=effectMethod.mode,queue=args.queue,queueName=queue||"fx",complete=args.complete,mode=args.mode,modes=[],prefilter=function(next){var el=$(this),normalizedMode=$.effects.mode(el,mode)||defaultMode;el.data(dataSpaceAnimated,true);modes.push(normalizedMode);if(defaultMode&&(normalizedMode==="show"||(normalizedMode===defaultMode&&normalizedMode==="hide"))){el.show();}
if(!defaultMode||normalizedMode!=="none"){$.effects.saveStyle(el);}
if($.isFunction(next)){next();}};if($.fx.off||!effectMethod){if(mode){return this[mode](args.duration,complete);}else{return this.each(function(){if(complete){complete.call(this);}});}}
function run(next){var elem=$(this);function cleanup(){elem.removeData(dataSpaceAnimated);$.effects.cleanUp(elem);if(args.mode==="hide"){elem.hide();}
done();}
function done(){if($.isFunction(complete)){complete.call(elem[0]);}
if($.isFunction(next)){next();}}
args.mode=modes.shift();if($.uiBackCompat!==false&&!defaultMode){if(elem.is(":hidden")?mode==="hide":mode==="show"){elem[mode]();done();}else{effectMethod.call(elem[0],args,done);}}else{if(args.mode==="none"){elem[mode]();done();}else{effectMethod.call(elem[0],args,cleanup);}}}
return queue===false?this.each(prefilter).each(run):this.queue(queueName,prefilter).queue(queueName,run);},show:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="show";return this.effect.call(this,args);}};})($.fn.show),hide:(function(orig){return function(option){if(standardAnimationOption(option)){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="hide";return this.effect.call(this,args);}};})($.fn.hide),toggle:(function(orig){return function(option){if(standardAnimationOption(option)||typeof option==="boolean"){return orig.apply(this,arguments);}else{var args=_normalizeArguments.apply(this,arguments);args.mode="toggle";return this.effect.call(this,args);}};})($.fn.toggle),cssUnit:function(key){var style=this.css(key),val=[];$.each(["em","px","%","pt"],function(i,unit){if(style.indexOf(unit)>0){val=[parseFloat(style),unit];}});return val;},cssClip:function(clipObj){if(clipObj){return this.css("clip","rect("+clipObj.top+"px "+clipObj.right+"px "+
clipObj.bottom+"px "+clipObj.left+"px)");}
return parseClip(this.css("clip"),this);},transfer:function(options,done){var element=$(this),target=$(options.to),targetFixed=target.css("position")==="fixed",body=$("body"),fixTop=targetFixed?body.scrollTop():0,fixLeft=targetFixed?body.scrollLeft():0,endPosition=target.offset(),animation={top:endPosition.top-fixTop,left:endPosition.left-fixLeft,height:target.innerHeight(),width:target.innerWidth()},startPosition=element.offset(),transfer=$("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(options.className).css({top:startPosition.top-fixTop,left:startPosition.left-fixLeft,height:element.innerHeight(),width:element.innerWidth(),position:targetFixed?"fixed":"absolute"}).animate(animation,options.duration,options.easing,function(){transfer.remove();if($.isFunction(done)){done();}});}});function parseClip(str,element){var outerWidth=element.outerWidth(),outerHeight=element.outerHeight(),clipRegex=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,values=clipRegex.exec(str)||["",0,outerWidth,outerHeight,0];return{top:parseFloat(values[1])||0,right:values[2]==="auto"?outerWidth:parseFloat(values[2]),bottom:values[3]==="auto"?outerHeight:parseFloat(values[3]),left:parseFloat(values[4])||0};}
$.fx.step.clip=function(fx){if(!fx.clipInit){fx.start=$(fx.elem).cssClip();if(typeof fx.end==="string"){fx.end=parseClip(fx.end,fx.elem);}
fx.clipInit=true;}
$(fx.elem).cssClip({top:fx.pos*(fx.end.top-fx.start.top)+fx.start.top,right:fx.pos*(fx.end.right-fx.start.right)+fx.start.right,bottom:fx.pos*(fx.end.bottom-fx.start.bottom)+fx.start.bottom,left:fx.pos*(fx.end.left-fx.start.left)+fx.start.left});};})();(function(){var baseEasings={};$.each(["Quad","Cubic","Quart","Quint","Expo"],function(i,name){baseEasings[name]=function(p){return Math.pow(p,i+2);};});$.extend(baseEasings,{Sine:function(p){return 1-Math.cos(p*Math.PI/2);},Circ:function(p){return 1-Math.sqrt(1-p*p);},Elastic:function(p){return p===0||p===1?p:-Math.pow(2,8*(p-1))*Math.sin(((p-1)*80-7.5)*Math.PI/15);},Back:function(p){return p*p*(3*p-2);},Bounce:function(p){var pow2,bounce=4;while(p<((pow2=Math.pow(2,--bounce))-1)/11){}
return 1/Math.pow(4,3-bounce)-7.5625*Math.pow((pow2*3-2)/22-p,2);}});$.each(baseEasings,function(name,easeIn){$.easing["easeIn"+name]=easeIn;$.easing["easeOut"+name]=function(p){return 1-easeIn(1-p);};$.easing["easeInOut"+name]=function(p){return p<0.5?easeIn(p*2)/2:1-easeIn(p*-2+2)/2;};});})();var effect=$.effects;var effectsEffectBlind=$.effects.define("blind","hide",function(options,done){var map={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},element=$(this),direction=options.direction||"up",start=element.cssClip(),animate={clip:$.extend({},start)},placeholder=$.effects.createPlaceholder(element);animate.clip[map[direction][0]]=animate.clip[map[direction][1]];if(options.mode==="show"){element.cssClip(animate.clip);if(placeholder){placeholder.css($.effects.clipToBox(animate));}
animate.clip=start;}
if(placeholder){placeholder.animate($.effects.clipToBox(animate),options.duration,options.easing);}
element.animate(animate,{queue:false,duration:options.duration,easing:options.easing,complete:done});});var effectsEffectBounce=$.effects.define("bounce",function(options,done){var upAnim,downAnim,refValue,element=$(this),mode=options.mode,hide=mode==="hide",show=mode==="show",direction=options.direction||"up",distance=options.distance,times=options.times||5,anims=times*2+(show||hide?1:0),speed=options.duration/anims,easing=options.easing,ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left"),i=0,queuelen=element.queue().length;$.effects.createPlaceholder(element);refValue=element.css(ref);if(!distance){distance=element[ref==="top"?"outerHeight":"outerWidth"]()/3;}
if(show){downAnim={opacity:1};downAnim[ref]=refValue;element.css("opacity",0).css(ref,motion?-distance*2:distance*2).animate(downAnim,speed,easing);}
if(hide){distance=distance/Math.pow(2,times-1);}
downAnim={};downAnim[ref]=refValue;for(;i<times;i++){upAnim={};upAnim[ref]=(motion?"-=":"+=")+distance;element.animate(upAnim,speed,easing).animate(downAnim,speed,easing);distance=hide?distance*2:distance/2;}
if(hide){upAnim={opacity:0};upAnim[ref]=(motion?"-=":"+=")+distance;element.animate(upAnim,speed,easing);}
element.queue(done);$.effects.unshift(element,queuelen,anims+1);});var effectsEffectClip=$.effects.define("clip","hide",function(options,done){var start,animate={},element=$(this),direction=options.direction||"vertical",both=direction==="both",horizontal=both||direction==="horizontal",vertical=both||direction==="vertical";start=element.cssClip();animate.clip={top:vertical?(start.bottom-start.top)/2:start.top,right:horizontal?(start.right-start.left)/2:start.right,bottom:vertical?(start.bottom-start.top)/2:start.bottom,left:horizontal?(start.right-start.left)/2:start.left};$.effects.createPlaceholder(element);if(options.mode==="show"){element.cssClip(animate.clip);animate.clip=start;}
element.animate(animate,{queue:false,duration:options.duration,easing:options.easing,complete:done});});var effectsEffectDrop=$.effects.define("drop","hide",function(options,done){var distance,element=$(this),mode=options.mode,show=mode==="show",direction=options.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",motion=(direction==="up"||direction==="left")?"-=":"+=",oppositeMotion=(motion==="+=")?"-=":"+=",animation={opacity:0};$.effects.createPlaceholder(element);distance=options.distance||element[ref==="top"?"outerHeight":"outerWidth"](true)/2;animation[ref]=motion+distance;if(show){element.css(animation);animation[ref]=oppositeMotion+distance;animation.opacity=1;}
element.animate(animation,{queue:false,duration:options.duration,easing:options.easing,complete:done});});var effectsEffectExplode=$.effects.define("explode","hide",function(options,done){var i,j,left,top,mx,my,rows=options.pieces?Math.round(Math.sqrt(options.pieces)):3,cells=rows,element=$(this),mode=options.mode,show=mode==="show",offset=element.show().css("visibility","hidden").offset(),width=Math.ceil(element.outerWidth()/cells),height=Math.ceil(element.outerHeight()/rows),pieces=[];function childComplete(){pieces.push(this);if(pieces.length===rows*cells){animComplete();}}
for(i=0;i<rows;i++){top=offset.top+i*height;my=i-(rows-1)/2;for(j=0;j<cells;j++){left=offset.left+j*width;mx=j-(cells-1)/2;element.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*width,top:-i*height}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:width,height:height,left:left+(show?mx*width:0),top:top+(show?my*height:0),opacity:show?0:1}).animate({left:left+(show?0:mx*width),top:top+(show?0:my*height),opacity:show?1:0},options.duration||500,options.easing,childComplete);}}
function animComplete(){element.css({visibility:"visible"});$(pieces).remove();done();}});var effectsEffectFade=$.effects.define("fade","toggle",function(options,done){var show=options.mode==="show";$(this).css("opacity",show?0:1).animate({opacity:show?1:0},{queue:false,duration:options.duration,easing:options.easing,complete:done});});var effectsEffectFold=$.effects.define("fold","hide",function(options,done){var element=$(this),mode=options.mode,show=mode==="show",hide=mode==="hide",size=options.size||15,percent=/([0-9]+)%/.exec(size),horizFirst=!!options.horizFirst,ref=horizFirst?["right","bottom"]:["bottom","right"],duration=options.duration/2,placeholder=$.effects.createPlaceholder(element),start=element.cssClip(),animation1={clip:$.extend({},start)},animation2={clip:$.extend({},start)},distance=[start[ref[0]],start[ref[1]]],queuelen=element.queue().length;if(percent){size=parseInt(percent[1],10)/100*distance[hide?0:1];}
animation1.clip[ref[0]]=size;animation2.clip[ref[0]]=size;animation2.clip[ref[1]]=0;if(show){element.cssClip(animation2.clip);if(placeholder){placeholder.css($.effects.clipToBox(animation2));}
animation2.clip=start;}
element.queue(function(next){if(placeholder){placeholder.animate($.effects.clipToBox(animation1),duration,options.easing).animate($.effects.clipToBox(animation2),duration,options.easing);}
next();}).animate(animation1,duration,options.easing).animate(animation2,duration,options.easing).queue(done);$.effects.unshift(element,queuelen,4);});var effectsEffectHighlight=$.effects.define("highlight","show",function(options,done){var element=$(this),animation={backgroundColor:element.css("backgroundColor")};if(options.mode==="hide"){animation.opacity=0;}
$.effects.saveStyle(element);element.css({backgroundImage:"none",backgroundColor:options.color||"#ffff99"}).animate(animation,{queue:false,duration:options.duration,easing:options.easing,complete:done});});var effectsEffectSize=$.effects.define("size",function(options,done){var baseline,factor,temp,element=$(this),cProps=["fontSize"],vProps=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],hProps=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],mode=options.mode,restore=mode!=="effect",scale=options.scale||"both",origin=options.origin||["middle","center"],position=element.css("position"),pos=element.position(),original=$.effects.scaledDimensions(element),from=options.from||original,to=options.to||$.effects.scaledDimensions(element,0);$.effects.createPlaceholder(element);if(mode==="show"){temp=from;from=to;to=temp;}
factor={from:{y:from.height/original.height,x:from.width/original.width},to:{y:to.height/original.height,x:to.width/original.width}};if(scale==="box"||scale==="both"){if(factor.from.y!==factor.to.y){from=$.effects.setTransition(element,vProps,factor.from.y,from);to=$.effects.setTransition(element,vProps,factor.to.y,to);}
if(factor.from.x!==factor.to.x){from=$.effects.setTransition(element,hProps,factor.from.x,from);to=$.effects.setTransition(element,hProps,factor.to.x,to);}}
if(scale==="content"||scale==="both"){if(factor.from.y!==factor.to.y){from=$.effects.setTransition(element,cProps,factor.from.y,from);to=$.effects.setTransition(element,cProps,factor.to.y,to);}}
if(origin){baseline=$.effects.getBaseline(origin,original);from.top=(original.outerHeight-from.outerHeight)*baseline.y+pos.top;from.left=(original.outerWidth-from.outerWidth)*baseline.x+pos.left;to.top=(original.outerHeight-to.outerHeight)*baseline.y+pos.top;to.left=(original.outerWidth-to.outerWidth)*baseline.x+pos.left;}
element.css(from);if(scale==="content"||scale==="both"){vProps=vProps.concat(["marginTop","marginBottom"]).concat(cProps);hProps=hProps.concat(["marginLeft","marginRight"]);element.find("*[width]").each(function(){var child=$(this),childOriginal=$.effects.scaledDimensions(child),childFrom={height:childOriginal.height*factor.from.y,width:childOriginal.width*factor.from.x,outerHeight:childOriginal.outerHeight*factor.from.y,outerWidth:childOriginal.outerWidth*factor.from.x},childTo={height:childOriginal.height*factor.to.y,width:childOriginal.width*factor.to.x,outerHeight:childOriginal.height*factor.to.y,outerWidth:childOriginal.width*factor.to.x};if(factor.from.y!==factor.to.y){childFrom=$.effects.setTransition(child,vProps,factor.from.y,childFrom);childTo=$.effects.setTransition(child,vProps,factor.to.y,childTo);}
if(factor.from.x!==factor.to.x){childFrom=$.effects.setTransition(child,hProps,factor.from.x,childFrom);childTo=$.effects.setTransition(child,hProps,factor.to.x,childTo);}
if(restore){$.effects.saveStyle(child);}
child.css(childFrom);child.animate(childTo,options.duration,options.easing,function(){if(restore){$.effects.restoreStyle(child);}});});}
element.animate(to,{queue:false,duration:options.duration,easing:options.easing,complete:function(){var offset=element.offset();if(to.opacity===0){element.css("opacity",from.opacity);}
if(!restore){element.css("position",position==="static"?"relative":position).offset(offset);$.effects.saveStyle(element);}
done();}});});var effectsEffectScale=$.effects.define("scale",function(options,done){var el=$(this),mode=options.mode,percent=parseInt(options.percent,10)||(parseInt(options.percent,10)===0?0:(mode!=="effect"?0:100)),newOptions=$.extend(true,{from:$.effects.scaledDimensions(el),to:$.effects.scaledDimensions(el,percent,options.direction||"both"),origin:options.origin||["middle","center"]},options);if(options.fade){newOptions.from.opacity=1;newOptions.to.opacity=0;}
$.effects.effect.size.call(this,newOptions,done);});var effectsEffectPuff=$.effects.define("puff","hide",function(options,done){var newOptions=$.extend(true,{},options,{fade:true,percent:parseInt(options.percent,10)||150});$.effects.effect.scale.call(this,newOptions,done);});var effectsEffectPulsate=$.effects.define("pulsate","show",function(options,done){var element=$(this),mode=options.mode,show=mode==="show",hide=mode==="hide",showhide=show||hide,anims=((options.times||5)*2)+(showhide?1:0),duration=options.duration/anims,animateTo=0,i=1,queuelen=element.queue().length;if(show||!element.is(":visible")){element.css("opacity",0).show();animateTo=1;}
for(;i<anims;i++){element.animate({opacity:animateTo},duration,options.easing);animateTo=1-animateTo;}
element.animate({opacity:animateTo},duration,options.easing);element.queue(done);$.effects.unshift(element,queuelen,anims+1);});var effectsEffectShake=$.effects.define("shake",function(options,done){var i=1,element=$(this),direction=options.direction||"left",distance=options.distance||20,times=options.times||3,anims=times*2+1,speed=Math.round(options.duration/anims),ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),animation={},animation1={},animation2={},queuelen=element.queue().length;$.effects.createPlaceholder(element);animation[ref]=(positiveMotion?"-=":"+=")+distance;animation1[ref]=(positiveMotion?"+=":"-=")+distance*2;animation2[ref]=(positiveMotion?"-=":"+=")+distance*2;element.animate(animation,speed,options.easing);for(;i<times;i++){element.animate(animation1,speed,options.easing).animate(animation2,speed,options.easing);}
element.animate(animation1,speed,options.easing).animate(animation,speed/2,options.easing).queue(done);$.effects.unshift(element,queuelen,anims+1);});var effectsEffectSlide=$.effects.define("slide","show",function(options,done){var startClip,startRef,element=$(this),map={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},mode=options.mode,direction=options.direction||"left",ref=(direction==="up"||direction==="down")?"top":"left",positiveMotion=(direction==="up"||direction==="left"),distance=options.distance||element[ref==="top"?"outerHeight":"outerWidth"](true),animation={};$.effects.createPlaceholder(element);startClip=element.cssClip();startRef=element.position()[ref];animation[ref]=(positiveMotion?-1:1)*distance+startRef;animation.clip=element.cssClip();animation.clip[map[direction][1]]=animation.clip[map[direction][0]];if(mode==="show"){element.cssClip(animation.clip);element.css(ref,animation[ref]);animation.clip=startClip;animation[ref]=startRef;}
element.animate(animation,{queue:false,duration:options.duration,easing:options.easing,complete:done});});var effect;if($.uiBackCompat!==false){effect=$.effects.define("transfer",function(options,done){$(this).transfer(options,done);});}
var effectsEffectTransfer=effect;$.ui.focusable=function(element,hasTabindex){var map,mapName,img,focusableIfVisible,fieldset,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}
img=$("img[usemap='#"+mapName+"']");return img.length>0&&img.is(":visible");}
if(/^(input|select|textarea|button|object)$/.test(nodeName)){focusableIfVisible=!element.disabled;if(focusableIfVisible){fieldset=$(element).closest("fieldset")[0];if(fieldset){focusableIfVisible=!fieldset.disabled;}}}else if("a"===nodeName){focusableIfVisible=element.href||hasTabindex;}else{focusableIfVisible=hasTabindex;}
return focusableIfVisible&&$(element).is(":visible")&&visible($(element));};function visible(element){var visibility=element.css("visibility");while(visibility==="inherit"){element=element.parent();visibility=element.css("visibility");}
return visibility!=="hidden";}
$.extend($.expr[":"],{focusable:function(element){return $.ui.focusable(element,$.attr(element,"tabindex")!=null);}});var focusable=$.ui.focusable;var form=$.fn.form=function(){return typeof this[0].form==="string"?this.closest("form"):$(this[0].form);};var formResetMixin=$.ui.formResetMixin={_formResetHandler:function(){var form=$(this);setTimeout(function(){var instances=form.data("ui-form-reset-instances");$.each(instances,function(){this.refresh();});});},_bindFormResetHandler:function(){this.form=this.element.form();if(!this.form.length){return;}
var instances=this.form.data("ui-form-reset-instances")||[];if(!instances.length){this.form.on("reset.ui-form-reset",this._formResetHandler);}
instances.push(this);this.form.data("ui-form-reset-instances",instances);},_unbindFormResetHandler:function(){if(!this.form.length){return;}
var instances=this.form.data("ui-form-reset-instances");instances.splice($.inArray(this,instances),1);if(instances.length){this.form.data("ui-form-reset-instances",instances);}else{this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset");}}};if($.fn.jquery.substring(0,3)==="1.7"){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}
if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}
$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}
return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}
return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};};var keycode=$.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};var escapeSelector=$.ui.escapeSelector=(function(){var selectorEscape=/([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;return function(selector){return selector.replace(selectorEscape,"\\$1");};})();var labels=$.fn.labels=function(){var ancestor,selector,id,labels,ancestors;if(this[0].labels&&this[0].labels.length){return this.pushStack(this[0].labels);}
labels=this.eq(0).parents("label");id=this.attr("id");if(id){ancestor=this.eq(0).parents().last();ancestors=ancestor.add(ancestor.length?ancestor.siblings():this.siblings());selector="label[for='"+$.ui.escapeSelector(id)+"']";labels=labels.add(ancestors.find(selector).addBack(selector));}
return this.pushStack(labels);};var scrollParent=$.fn.scrollParent=function(includeHidden){var position=this.css("position"),excludeStaticParent=position==="absolute",overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);if(excludeStaticParent&&parent.css("position")==="static"){return false;}
return overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+
parent.css("overflow-x"));}).eq(0);return position==="fixed"||!scrollParent.length?$(this[0].ownerDocument||document):scrollParent;};var tabbable=$.extend($.expr[":"],{tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),hasTabindex=tabIndex!=null;return(!hasTabindex||tabIndex>=0)&&$.ui.focusable(element,hasTabindex);}});var uniqueId=$.fn.extend({uniqueId:(function(){var uuid=0;return function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});};})(),removeUniqueId:function(){return this.each(function(){if(/^ui-id-\d+$/.test(this.id)){$(this).removeAttr("id");}});}});var widgetsAccordion=$.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:false,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var options=this.options;this.prevShow=this.prevHide=$();this._addClass("ui-accordion","ui-widget ui-helper-reset");this.element.attr("role","tablist");if(!options.collapsible&&(options.active===false||options.active==null)){options.active=0;}
this._processPanels();if(options.active<0){options.active+=this.headers.length;}
this._refresh();},_getCreateEventData:function(){return{header:this.active,panel:!this.active.length?$():this.active.next()};},_createIcons:function(){var icon,children,icons=this.options.icons;if(icons){icon=$("<span>");this._addClass(icon,"ui-accordion-header-icon","ui-icon "+icons.header);icon.prependTo(this.headers);children=this.active.children(".ui-accordion-header-icon");this._removeClass(children,icons.header)._addClass(children,null,icons.activeHeader)._addClass(this.headers,"ui-accordion-icons");}},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons");this.headers.children(".ui-accordion-header-icon").remove();},_destroy:function(){var contents;this.element.removeAttr("role");this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId();this._destroyIcons();contents=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId();if(this.options.heightStyle!=="content"){contents.css("height","");}},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
if(key==="event"){if(this.options.event){this._off(this.headers,this.options.event);}
this._setupEvents(value);}
this._super(key,value);if(key==="collapsible"&&!value&&this.options.active===false){this._activate(0);}
if(key==="icons"){this._destroyIcons();if(value){this._createIcons();}}},_setOptionDisabled:function(value){this._super(value);this.element.attr("aria-disabled",value);this._toggleClass(null,"ui-state-disabled",!!value);this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!value);},_keydown:function(event){if(event.altKey||event.ctrlKey){return;}
var keyCode=$.ui.keyCode,length=this.headers.length,currentIndex=this.headers.index(event.target),toFocus=false;switch(event.keyCode){case keyCode.RIGHT:case keyCode.DOWN:toFocus=this.headers[(currentIndex+1)%length];break;case keyCode.LEFT:case keyCode.UP:toFocus=this.headers[(currentIndex-1+length)%length];break;case keyCode.SPACE:case keyCode.ENTER:this._eventHandler(event);break;case keyCode.HOME:toFocus=this.headers[0];break;case keyCode.END:toFocus=this.headers[length-1];break;}
if(toFocus){$(event.target).attr("tabIndex",-1);$(toFocus).attr("tabIndex",0);$(toFocus).trigger("focus");event.preventDefault();}},_panelKeyDown:function(event){if(event.keyCode===$.ui.keyCode.UP&&event.ctrlKey){$(event.currentTarget).prev().trigger("focus");}},refresh:function(){var options=this.options;this._processPanels();if((options.active===false&&options.collapsible===true)||!this.headers.length){options.active=false;this.active=$();}else if(options.active===false){this._activate(0);}else if(this.active.length&&!$.contains(this.element[0],this.active[0])){if(this.headers.length===this.headers.find(".ui-state-disabled").length){options.active=false;this.active=$();}else{this._activate(Math.max(0,options.active-1));}}else{options.active=this.headers.index(this.active);}
this._destroyIcons();this._refresh();},_processPanels:function(){var prevHeaders=this.headers,prevPanels=this.panels;this.headers=this.element.find(this.options.header);this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default");this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide();this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content");if(prevPanels){this._off(prevHeaders.not(this.headers));this._off(prevPanels.not(this.panels));}},_refresh:function(){var maxHeight,options=this.options,heightStyle=options.heightStyle,parent=this.element.parent();this.active=this._findActive(options.active);this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed");this._addClass(this.active.next(),"ui-accordion-content-active");this.active.next().show();this.headers.attr("role","tab").each(function(){var header=$(this),headerId=header.uniqueId().attr("id"),panel=header.next(),panelId=panel.uniqueId().attr("id");header.attr("aria-controls",panelId);panel.attr("aria-labelledby",headerId);}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide();if(!this.active.length){this.headers.eq(0).attr("tabIndex",0);}else{this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"});}
this._createIcons();this._setupEvents(options.event);if(heightStyle==="fill"){maxHeight=parent.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});this.headers.each(function(){maxHeight-=$(this).outerHeight(true);});this.headers.next().each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(heightStyle==="auto"){maxHeight=0;this.headers.next().each(function(){var isVisible=$(this).is(":visible");if(!isVisible){$(this).show();}
maxHeight=Math.max(maxHeight,$(this).css("height","").height());if(!isVisible){$(this).hide();}}).height(maxHeight);}},_activate:function(index){var active=this._findActive(index)[0];if(active===this.active[0]){return;}
active=active||this.active[0];this._eventHandler({target:active,currentTarget:active,preventDefault:$.noop});},_findActive:function(selector){return typeof selector==="number"?this.headers.eq(selector):$();},_setupEvents:function(event){var events={keydown:"_keydown"};if(event){$.each(event.split(" "),function(index,eventName){events[eventName]="_eventHandler";});}
this._off(this.headers.add(this.headers.next()));this._on(this.headers,events);this._on(this.headers.next(),{keydown:"_panelKeyDown"});this._hoverable(this.headers);this._focusable(this.headers);},_eventHandler:function(event){var activeChildren,clickedChildren,options=this.options,active=this.active,clicked=$(event.currentTarget),clickedIsActive=clicked[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():clicked.next(),toHide=active.next(),eventData={oldHeader:active,oldPanel:toHide,newHeader:collapsing?$():clicked,newPanel:toShow};event.preventDefault();if((clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.headers.index(clicked);this.active=clickedIsActive?$():clicked;this._toggle(eventData);this._removeClass(active,"ui-accordion-header-active","ui-state-active");if(options.icons){activeChildren=active.children(".ui-accordion-header-icon");this._removeClass(activeChildren,null,options.icons.activeHeader)._addClass(activeChildren,null,options.icons.header);}
if(!clickedIsActive){this._removeClass(clicked,"ui-accordion-header-collapsed")._addClass(clicked,"ui-accordion-header-active","ui-state-active");if(options.icons){clickedChildren=clicked.children(".ui-accordion-header-icon");this._removeClass(clickedChildren,null,options.icons.header)._addClass(clickedChildren,null,options.icons.activeHeader);}
this._addClass(clicked.next(),"ui-accordion-content-active");}},_toggle:function(data){var toShow=data.newPanel,toHide=this.prevShow.length?this.prevShow:data.oldPanel;this.prevShow.add(this.prevHide).stop(true,true);this.prevShow=toShow;this.prevHide=toHide;if(this.options.animate){this._animate(toShow,toHide,data);}else{toHide.hide();toShow.show();this._toggleComplete(data);}
toHide.attr({"aria-hidden":"true"});toHide.prev().attr({"aria-selected":"false","aria-expanded":"false"});if(toShow.length&&toHide.length){toHide.prev().attr({"tabIndex":-1,"aria-expanded":"false"});}else if(toShow.length){this.headers.filter(function(){return parseInt($(this).attr("tabIndex"),10)===0;}).attr("tabIndex",-1);}
toShow.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});},_animate:function(toShow,toHide,data){var total,easing,duration,that=this,adjust=0,boxSizing=toShow.css("box-sizing"),down=toShow.length&&(!toHide.length||(toShow.index()<toHide.index())),animate=this.options.animate||{},options=down&&animate.down||animate,complete=function(){that._toggleComplete(data);};if(typeof options==="number"){duration=options;}
if(typeof options==="string"){easing=options;}
easing=easing||options.easing||animate.easing;duration=duration||options.duration||animate.duration;if(!toHide.length){return toShow.animate(this.showProps,duration,easing,complete);}
if(!toShow.length){return toHide.animate(this.hideProps,duration,easing,complete);}
total=toShow.show().outerHeight();toHide.animate(this.hideProps,{duration:duration,easing:easing,step:function(now,fx){fx.now=Math.round(now);}});toShow.hide().animate(this.showProps,{duration:duration,easing:easing,complete:complete,step:function(now,fx){fx.now=Math.round(now);if(fx.prop!=="height"){if(boxSizing==="content-box"){adjust+=fx.now;}}else if(that.options.heightStyle!=="content"){fx.now=Math.round(total-toHide.outerHeight()-adjust);adjust=0;}}});},_toggleComplete:function(data){var toHide=data.oldPanel,prev=toHide.prev();this._removeClass(toHide,"ui-accordion-content-active");this._removeClass(prev,"ui-accordion-header-active")._addClass(prev,"ui-accordion-header-collapsed");if(toHide.length){toHide.parent()[0].className=toHide.parent()[0].className;}
this._trigger("activate",null,data);}});var safeActiveElement=$.ui.safeActiveElement=function(document){var activeElement;try{activeElement=document.activeElement;}catch(error){activeElement=document.body;}
if(!activeElement){activeElement=document.body;}
if(!activeElement.nodeName){activeElement=document.body;}
return activeElement;};var widgetsMenu=$.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=false;this.element.uniqueId().attr({role:this.options.role,tabIndex:0});this._addClass("ui-menu","ui-widget ui-widget-content");this._on({"mousedown .ui-menu-item":function(event){event.preventDefault();},"click .ui-menu-item":function(event){var target=$(event.target);var active=$($.ui.safeActiveElement(this.document[0]));if(!this.mouseHandled&&target.not(".ui-state-disabled").length){this.select(event);if(!event.isPropagationStopped()){this.mouseHandled=true;}
if(target.has(".ui-menu").length){this.expand(event);}else if(!this.element.is(":focus")&&active.closest(".ui-menu").length){this.element.trigger("focus",[true]);if(this.active&&this.active.parents(".ui-menu").length===1){clearTimeout(this.timer);}}}},"mouseenter .ui-menu-item":function(event){if(this.previousFilter){return;}
var actualTarget=$(event.target).closest(".ui-menu-item"),target=$(event.currentTarget);if(actualTarget[0]!==target[0]){return;}
this._removeClass(target.siblings().children(".ui-state-active"),null,"ui-state-active");this.focus(event,target);},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(event,keepActiveItem){var item=this.active||this.element.find(this.options.items).eq(0);if(!keepActiveItem){this.focus(event,item);}},blur:function(event){this._delay(function(){var notContained=!$.contains(this.element[0],$.ui.safeActiveElement(this.document[0]));if(notContained){this.collapseAll(event);}});},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(event){if(this._closeOnDocumentClick(event)){this.collapseAll(event);}
this.mouseHandled=false;}});},_destroy:function(){var items=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),submenus=items.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled "+"tabIndex").removeUniqueId().show();submenus.children().each(function(){var elem=$(this);if(elem.data("ui-menu-submenu-caret")){elem.remove();}});},_keydown:function(event){var match,prev,character,skip,preventDefault=true;switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);break;case $.ui.keyCode.HOME:this._move("first","first",event);break;case $.ui.keyCode.END:this._move("last","last",event);break;case $.ui.keyCode.UP:this.previous(event);break;case $.ui.keyCode.DOWN:this.next(event);break;case $.ui.keyCode.LEFT:this.collapse(event);break;case $.ui.keyCode.RIGHT:if(this.active&&!this.active.is(".ui-state-disabled")){this.expand(event);}
break;case $.ui.keyCode.ENTER:case $.ui.keyCode.SPACE:this._activate(event);break;case $.ui.keyCode.ESCAPE:this.collapse(event);break;default:preventDefault=false;prev=this.previousFilter||"";skip=false;character=event.keyCode>=96&&event.keyCode<=105?(event.keyCode-96).toString():String.fromCharCode(event.keyCode);clearTimeout(this.filterTimer);if(character===prev){skip=true;}else{character=prev+character;}
match=this._filterMenuItems(character);match=skip&&match.index(this.active.next())!==-1?this.active.nextAll(".ui-menu-item"):match;if(!match.length){character=String.fromCharCode(event.keyCode);match=this._filterMenuItems(character);}
if(match.length){this.focus(event,match);this.previousFilter=character;this.filterTimer=this._delay(function(){delete this.previousFilter;},1000);}else{delete this.previousFilter;}}
if(preventDefault){event.preventDefault();}},_activate:function(event){if(this.active&&!this.active.is(".ui-state-disabled")){if(this.active.children("[aria-haspopup='true']").length){this.expand(event);}else{this.select(event);}}},refresh:function(){var menus,items,newSubmenus,newItems,newWrappers,that=this,icon=this.options.icons.submenu,submenus=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length);newSubmenus=submenus.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var menu=$(this),item=menu.prev(),submenuCaret=$("<span>").data("ui-menu-submenu-caret",true);that._addClass(submenuCaret,"ui-menu-icon","ui-icon "+icon);item.attr("aria-haspopup","true").prepend(submenuCaret);menu.attr("aria-labelledby",item.attr("id"));});this._addClass(newSubmenus,"ui-menu","ui-widget ui-widget-content ui-front");menus=submenus.add(this.element);items=menus.find(this.options.items);items.not(".ui-menu-item").each(function(){var item=$(this);if(that._isDivider(item)){that._addClass(item,"ui-menu-divider","ui-widget-content");}});newItems=items.not(".ui-menu-item, .ui-menu-divider");newWrappers=newItems.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()});this._addClass(newItems,"ui-menu-item")._addClass(newWrappers,"ui-menu-item-wrapper");items.filter(".ui-state-disabled").attr("aria-disabled","true");if(this.active&&!$.contains(this.element[0],this.active[0])){this.blur();}},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role];},_setOption:function(key,value){if(key==="icons"){var icons=this.element.find(".ui-menu-icon");this._removeClass(icons,null,this.options.icons.submenu)._addClass(icons,null,value.submenu);}
this._super(key,value);},_setOptionDisabled:function(value){this._super(value);this.element.attr("aria-disabled",String(value));this._toggleClass(null,"ui-state-disabled",!!value);},focus:function(event,item){var nested,focused,activeParent;this.blur(event,event&&event.type==="focus");this._scrollIntoView(item);this.active=item.first();focused=this.active.children(".ui-menu-item-wrapper");this._addClass(focused,null,"ui-state-active");if(this.options.role){this.element.attr("aria-activedescendant",focused.attr("id"));}
activeParent=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper");this._addClass(activeParent,null,"ui-state-active");if(event&&event.type==="keydown"){this._close();}else{this.timer=this._delay(function(){this._close();},this.delay);}
nested=item.children(".ui-menu");if(nested.length&&event&&(/^mouse/.test(event.type))){this._startOpening(nested);}
this.activeMenu=item.parent();this._trigger("focus",event,{item:item});},_scrollIntoView:function(item){var borderTop,paddingTop,offset,scroll,elementHeight,itemHeight;if(this._hasScroll()){borderTop=parseFloat($.css(this.activeMenu[0],"borderTopWidth"))||0;paddingTop=parseFloat($.css(this.activeMenu[0],"paddingTop"))||0;offset=item.offset().top-this.activeMenu.offset().top-borderTop-paddingTop;scroll=this.activeMenu.scrollTop();elementHeight=this.activeMenu.height();itemHeight=item.outerHeight();if(offset<0){this.activeMenu.scrollTop(scroll+offset);}else if(offset+itemHeight>elementHeight){this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight);}}},blur:function(event,fromFocus){if(!fromFocus){clearTimeout(this.timer);}
if(!this.active){return;}
this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active");this._trigger("blur",event,{item:this.active});this.active=null;},_startOpening:function(submenu){clearTimeout(this.timer);if(submenu.attr("aria-hidden")!=="true"){return;}
this.timer=this._delay(function(){this._close();this._open(submenu);},this.delay);},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(submenu.parents(".ui-menu")).hide().attr("aria-hidden","true");submenu.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(position);},collapseAll:function(event,all){clearTimeout(this.timer);this.timer=this._delay(function(){var currentMenu=all?this.element:$(event&&event.target).closest(this.element.find(".ui-menu"));if(!currentMenu.length){currentMenu=this.element;}
this._close(currentMenu);this.blur(event);this._removeClass(currentMenu.find(".ui-state-active"),null,"ui-state-active");this.activeMenu=currentMenu;},this.delay);},_close:function(startMenu){if(!startMenu){startMenu=this.active?this.active.parent():this.element;}
startMenu.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false");},_closeOnDocumentClick:function(event){return!$(event.target).closest(".ui-menu").length;},_isDivider:function(item){return!/[^\-\u2014\u2013\s]/.test(item.text());},collapse:function(event){var newItem=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(newItem&&newItem.length){this._close();this.focus(event,newItem);}},expand:function(event){var newItem=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();if(newItem&&newItem.length){this._open(newItem.parent());this._delay(function(){this.focus(event,newItem);});}},next:function(event){this._move("next","first",event);},previous:function(event){this._move("prev","last",event);},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length;},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length;},_move:function(direction,filter,event){var next;if(this.active){if(direction==="first"||direction==="last"){next=this.active
[direction==="first"?"prevAll":"nextAll"](".ui-menu-item").eq(-1);}else{next=this.active
[direction+"All"](".ui-menu-item").eq(0);}}
if(!next||!next.length||!this.active){next=this.activeMenu.find(this.options.items)[filter]();}
this.focus(event,next);},nextPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isLastItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base-height<0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.find(this.options.items)
[!this.active?"first":"last"]());}},previousPage:function(event){var item,base,height;if(!this.active){this.next(event);return;}
if(this.isFirstItem()){return;}
if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base+height>0;});this.focus(event,item);}else{this.focus(event,this.activeMenu.find(this.options.items).first());}},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight");},select:function(event){this.active=this.active||$(event.target).closest(".ui-menu-item");var ui={item:this.active};if(!this.active.has(".ui-menu").length){this.collapseAll(event,true);}
this._trigger("select",event,ui);},_filterMenuItems:function(character){var escapedCharacter=character.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),regex=new RegExp("^"+escapedCharacter,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return regex.test($.trim($(this).children(".ui-menu-item-wrapper").text()));});}});$.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:false,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var suppressKeyPress,suppressKeyPressRepeat,suppressInput,nodeName=this.element[0].nodeName.toLowerCase(),isTextarea=nodeName==="textarea",isInput=nodeName==="input";this.isMultiLine=isTextarea||!isInput&&this._isContentEditable(this.element);this.valueMethod=this.element[isTextarea||isInput?"val":"text"];this.isNewMenu=true;this._addClass("ui-autocomplete-input");this.element.attr("autocomplete","off");this._on(this.element,{keydown:function(event){if(this.element.prop("readOnly")){suppressKeyPress=true;suppressInput=true;suppressKeyPressRepeat=true;return;}
suppressKeyPress=false;suppressInput=false;suppressKeyPressRepeat=false;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=true;this._move("previousPage",event);break;case keyCode.PAGE_DOWN:suppressKeyPress=true;this._move("nextPage",event);break;case keyCode.UP:suppressKeyPress=true;this._keyEvent("previous",event);break;case keyCode.DOWN:suppressKeyPress=true;this._keyEvent("next",event);break;case keyCode.ENTER:if(this.menu.active){suppressKeyPress=true;event.preventDefault();this.menu.select(event);}
break;case keyCode.TAB:if(this.menu.active){this.menu.select(event);}
break;case keyCode.ESCAPE:if(this.menu.element.is(":visible")){if(!this.isMultiLine){this._value(this.term);}
this.close(event);event.preventDefault();}
break;default:suppressKeyPressRepeat=true;this._searchTimeout(event);break;}},keypress:function(event){if(suppressKeyPress){suppressKeyPress=false;if(!this.isMultiLine||this.menu.element.is(":visible")){event.preventDefault();}
return;}
if(suppressKeyPressRepeat){return;}
var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:this._move("previousPage",event);break;case keyCode.PAGE_DOWN:this._move("nextPage",event);break;case keyCode.UP:this._keyEvent("previous",event);break;case keyCode.DOWN:this._keyEvent("next",event);break;}},input:function(event){if(suppressInput){suppressInput=false;event.preventDefault();return;}
this._searchTimeout(event);},focus:function(){this.selectedItem=null;this.previous=this._value();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
clearTimeout(this.searching);this.close(event);this._change(event);}});this._initSource();this.menu=$("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance");this._addClass(this.menu.element,"ui-autocomplete","ui-front");this._on(this.menu.element,{mousedown:function(event){event.preventDefault();this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;if(this.element[0]!==$.ui.safeActiveElement(this.document[0])){this.element.trigger("focus");}});},menufocus:function(event,ui){var label,item;if(this.isNewMenu){this.isNewMenu=false;if(event.originalEvent&&/^mouse/.test(event.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){$(event.target).trigger(event.originalEvent);});return;}}
item=ui.item.data("ui-autocomplete-item");if(false!==this._trigger("focus",event,{item:item})){if(event.originalEvent&&/^key/.test(event.originalEvent.type)){this._value(item.value);}}
label=ui.item.attr("aria-label")||item.value;if(label&&$.trim(label).length){this.liveRegion.children().hide();$("<div>").text(label).appendTo(this.liveRegion);}},menuselect:function(event,ui){var item=ui.item.data("ui-autocomplete-item"),previous=this.previous;if(this.element[0]!==$.ui.safeActiveElement(this.document[0])){this.element.trigger("focus");this.previous=previous;this._delay(function(){this.previous=previous;this.selectedItem=item;});}
if(false!==this._trigger("select",event,{item:item})){this._value(item.value);}
this.term=this._value();this.close(event);this.selectedItem=item;}});this.liveRegion=$("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body);this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible");this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_destroy:function(){clearTimeout(this.searching);this.element.removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove();},_setOption:function(key,value){this._super(key,value);if(key==="source"){this._initSource();}
if(key==="appendTo"){this.menu.element.appendTo(this._appendTo());}
if(key==="disabled"&&value&&this.xhr){this.xhr.abort();}},_isEventTargetInWidget:function(event){var menuElement=this.menu.element[0];return event.target===this.element[0]||event.target===menuElement||$.contains(menuElement,event.target);},_closeOnClickOutside:function(event){if(!this._isEventTargetInWidget(event)){this.close();}},_appendTo:function(){var element=this.options.appendTo;if(element){element=element.jquery||element.nodeType?$(element):this.document.find(element).eq(0);}
if(!element||!element[0]){element=this.element.closest(".ui-front, dialog");}
if(!element.length){element=this.document[0].body;}
return element;},_initSource:function(){var array,url,that=this;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term));};}else if(typeof this.options.source==="string"){url=this.options.source;this.source=function(request,response){if(that.xhr){that.xhr.abort();}
that.xhr=$.ajax({url:url,data:request,dataType:"json",success:function(data){response(data);},error:function(){response([]);}});};}else{this.source=this.options.source;}},_searchTimeout:function(event){clearTimeout(this.searching);this.searching=this._delay(function(){var equalValues=this.term===this._value(),menuVisible=this.menu.element.is(":visible"),modifierKey=event.altKey||event.ctrlKey||event.metaKey||event.shiftKey;if(!equalValues||(equalValues&&!menuVisible&&!modifierKey)){this.selectedItem=null;this.search(null,event);}},this.options.delay);},search:function(value,event){value=value!=null?value:this._value();this.term=this._value();if(value.length<this.options.minLength){return this.close(event);}
if(this._trigger("search",event)===false){return;}
return this._search(value);},_search:function(value){this.pending++;this._addClass("ui-autocomplete-loading");this.cancelSearch=false;this.source({term:value},this._response());},_response:function(){var index=++this.requestIndex;return $.proxy(function(content){if(index===this.requestIndex){this.__response(content);}
this.pending--;if(!this.pending){this._removeClass("ui-autocomplete-loading");}},this);},__response:function(content){if(content){content=this._normalize(content);}
this._trigger("response",null,{content:content});if(!this.options.disabled&&content&&content.length&&!this.cancelSearch){this._suggest(content);this._trigger("open");}else{this._close();}},close:function(event){this.cancelSearch=true;this._close(event);},_close:function(event){this._off(this.document,"mousedown");if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=true;this._trigger("close",event);}},_change:function(event){if(this.previous!==this._value()){this._trigger("change",event,{item:this.selectedItem});}},_normalize:function(items){if(items.length&&items[0].label&&items[0].value){return items;}
return $.map(items,function(item){if(typeof item==="string"){return{label:item,value:item};}
return $.extend({},item,{label:item.label||item.value,value:item.value||item.label});});},_suggest:function(items){var ul=this.menu.element.empty();this._renderMenu(ul,items);this.isNewMenu=true;this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));if(this.options.autoFocus){this.menu.next();}
this._on(this.document,{mousedown:"_closeOnClickOutside"});},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth()+1,this.element.outerWidth()));},_renderMenu:function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item);});},_renderItemData:function(ul,item){return this._renderItem(ul,item).data("ui-autocomplete-item",item);},_renderItem:function(ul,item){return $("<li>").append($("<div>").text(item.label)).appendTo(ul);},_move:function(direction,event){if(!this.menu.element.is(":visible")){this.search(null,event);return;}
if(this.menu.isFirstItem()&&/^previous/.test(direction)||this.menu.isLastItem()&&/^next/.test(direction)){if(!this.isMultiLine){this._value(this.term);}
this.menu.blur();return;}
this.menu[direction](event);},widget:function(){return this.menu.element;},_value:function(){return this.valueMethod.apply(this.element,arguments);},_keyEvent:function(keyEvent,event){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(keyEvent,event);event.preventDefault();}},_isContentEditable:function(element){if(!element.length){return false;}
var editable=element.prop("contentEditable");if(editable==="inherit"){return this._isContentEditable(element.parent());}
return editable==="true";}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value);});}});$.widget("ui.autocomplete",$.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(amount){return amount+(amount>1?" results are":" result is")+" available, use up and down arrow keys to navigate.";}}},__response:function(content){var message;this._superApply(arguments);if(this.options.disabled||this.cancelSearch){return;}
if(content&&content.length){message=this.options.messages.results(content.length);}else{message=this.options.messages.noResults;}
this.liveRegion.children().hide();$("<div>").text(message).appendTo(this.liveRegion);}});var widgetsAutocomplete=$.ui.autocomplete;var controlgroupCornerRegex=/ui-corner-([a-z]){2,6}/g;var widgetsControlgroup=$.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:true,items:{"button":"input[type=button], input[type=submit], input[type=reset], button, a","controlgroupLabel":".ui-controlgroup-label","checkboxradio":"input[type='checkbox'], input[type='radio']","selectmenu":"select","spinner":".ui-spinner-input"}},_create:function(){this._enhance();},_enhance:function(){this.element.attr("role","toolbar");this.refresh();},_destroy:function(){this._callChildMethod("destroy");this.childWidgets.removeData("ui-controlgroup-data");this.element.removeAttr("role");if(this.options.items.controlgroupLabel){this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap();}},_initWidgets:function(){var that=this,childWidgets=[];$.each(this.options.items,function(widget,selector){var labels;var options={};if(!selector){return;}
if(widget==="controlgroupLabel"){labels=that.element.find(selector);labels.each(function(){var element=$(this);if(element.children(".ui-controlgroup-label-contents").length){return;}
element.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>");});that._addClass(labels,null,"ui-widget ui-widget-content ui-state-default");childWidgets=childWidgets.concat(labels.get());return;}
if(!$.fn[widget]){return;}
if(that["_"+widget+"Options"]){options=that["_"+widget+"Options"]("middle");}else{options={classes:{}};}
that.element.find(selector).each(function(){var element=$(this);var instance=element[widget]("instance");var instanceOptions=$.widget.extend({},options);if(widget==="button"&&element.parent(".ui-spinner").length){return;}
if(!instance){instance=element[widget]()[widget]("instance");}
if(instance){instanceOptions.classes=that._resolveClassesValues(instanceOptions.classes,instance);}
element[widget](instanceOptions);var widgetElement=element[widget]("widget");$.data(widgetElement[0],"ui-controlgroup-data",instance?instance:element[widget]("instance"));childWidgets.push(widgetElement[0]);});});this.childWidgets=$($.unique(childWidgets));this._addClass(this.childWidgets,"ui-controlgroup-item");},_callChildMethod:function(method){this.childWidgets.each(function(){var element=$(this),data=element.data("ui-controlgroup-data");if(data&&data[method]){data[method]();}});},_updateCornerClass:function(element,position){var remove="ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all";var add=this._buildSimpleOptions(position,"label").classes.label;this._removeClass(element,null,remove);this._addClass(element,null,add);},_buildSimpleOptions:function(position,key){var direction=this.options.direction==="vertical";var result={classes:{}};result.classes[key]={"middle":"","first":"ui-corner-"+(direction?"top":"left"),"last":"ui-corner-"+(direction?"bottom":"right"),"only":"ui-corner-all"}[position];return result;},_spinnerOptions:function(position){var options=this._buildSimpleOptions(position,"ui-spinner");options.classes["ui-spinner-up"]="";options.classes["ui-spinner-down"]="";return options;},_buttonOptions:function(position){return this._buildSimpleOptions(position,"ui-button");},_checkboxradioOptions:function(position){return this._buildSimpleOptions(position,"ui-checkboxradio-label");},_selectmenuOptions:function(position){var direction=this.options.direction==="vertical";return{width:direction?"auto":false,classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(direction?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(direction?"top":"left")},last:{"ui-selectmenu-button-open":direction?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(direction?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[position]};},_resolveClassesValues:function(classes,instance){var result={};$.each(classes,function(key){var current=instance.options.classes[key]||"";current=$.trim(current.replace(controlgroupCornerRegex,""));result[key]=(current+" "+classes[key]).replace(/\s+/g," ");});return result;},_setOption:function(key,value){if(key==="direction"){this._removeClass("ui-controlgroup-"+this.options.direction);}
this._super(key,value);if(key==="disabled"){this._callChildMethod(value?"disable":"enable");return;}
this.refresh();},refresh:function(){var children,that=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction);if(this.options.direction==="horizontal"){this._addClass(null,"ui-helper-clearfix");}
this._initWidgets();children=this.childWidgets;if(this.options.onlyVisible){children=children.filter(":visible");}
if(children.length){$.each(["first","last"],function(index,value){var instance=children[value]().data("ui-controlgroup-data");if(instance&&that["_"+instance.widgetName+"Options"]){var options=that["_"+instance.widgetName+"Options"](children.length===1?"only":value);options.classes=that._resolveClassesValues(options.classes,instance);instance.element[instance.widgetName](options);}else{that._updateCornerClass(children[value](),value);}});this._callChildMethod("refresh");}}});$.widget("ui.checkboxradio",[$.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:true,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var disabled,labels;var that=this;var options=this._super()||{};this._readType();labels=this.element.labels();this.label=$(labels[labels.length-1]);if(!this.label.length){$.error("No label found for checkboxradio widget");}
this.originalLabel="";this.label.contents().not(this.element[0]).each(function(){that.originalLabel+=this.nodeType===3?$(this).text():this.outerHTML;});if(this.originalLabel){options.label=this.originalLabel;}
disabled=this.element[0].disabled;if(disabled!=null){options.disabled=disabled;}
return options;},_create:function(){var checked=this.element[0].checked;this._bindFormResetHandler();if(this.options.disabled==null){this.options.disabled=this.element[0].disabled;}
this._setOption("disabled",this.options.disabled);this._addClass("ui-checkboxradio","ui-helper-hidden-accessible");this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget");if(this.type==="radio"){this._addClass(this.label,"ui-checkboxradio-radio-label");}
if(this.options.label&&this.options.label!==this.originalLabel){this._updateLabel();}else if(this.originalLabel){this.options.label=this.originalLabel;}
this._enhance();if(checked){this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active");if(this.icon){this._addClass(this.icon,null,"ui-state-hover");}}
this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus");},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus");}});},_readType:function(){var nodeName=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type;if(nodeName!=="input"||!/radio|checkbox/.test(this.type)){$.error("Can't create checkboxradio on element.nodeName="+nodeName+" and element.type="+this.type);}},_enhance:function(){this._updateIcon(this.element[0].checked);},widget:function(){return this.label;},_getRadioGroup:function(){var group;var name=this.element[0].name;var nameSelector="input[name='"+$.ui.escapeSelector(name)+"']";if(!name){return $([]);}
if(this.form.length){group=$(this.form[0].elements).filter(nameSelector);}else{group=$(nameSelector).filter(function(){return $(this).form().length===0;});}
return group.not(this.element);},_toggleClasses:function(){var checked=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",checked);if(this.options.icon&&this.type==="checkbox"){this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",checked)._toggleClass(this.icon,null,"ui-icon-blank",!checked);}
if(this.type==="radio"){this._getRadioGroup().each(function(){var instance=$(this).checkboxradio("instance");if(instance){instance._removeClass(instance.label,"ui-checkboxradio-checked","ui-state-active");}});}},_destroy:function(){this._unbindFormResetHandler();if(this.icon){this.icon.remove();this.iconSpace.remove();}},_setOption:function(key,value){if(key==="label"&&!value){return;}
this._super(key,value);if(key==="disabled"){this._toggleClass(this.label,null,"ui-state-disabled",value);this.element[0].disabled=value;return;}
this.refresh();},_updateIcon:function(checked){var toAdd="ui-icon ui-icon-background ";if(this.options.icon){if(!this.icon){this.icon=$("<span>");this.iconSpace=$("<span> </span>");this._addClass(this.iconSpace,"ui-checkboxradio-icon-space");}
if(this.type==="checkbox"){toAdd+=checked?"ui-icon-check ui-state-checked":"ui-icon-blank";this._removeClass(this.icon,null,checked?"ui-icon-blank":"ui-icon-check");}else{toAdd+="ui-icon-blank";}
this._addClass(this.icon,"ui-checkboxradio-icon",toAdd);if(!checked){this._removeClass(this.icon,null,"ui-icon-check ui-state-checked");}
this.icon.prependTo(this.label).after(this.iconSpace);}else if(this.icon!==undefined){this.icon.remove();this.iconSpace.remove();delete this.icon;}},_updateLabel:function(){var contents=this.label.contents().not(this.element[0]);if(this.icon){contents=contents.not(this.icon[0]);}
if(this.iconSpace){contents=contents.not(this.iconSpace[0]);}
contents.remove();this.label.append(this.options.label);},refresh:function(){var checked=this.element[0].checked,isDisabled=this.element[0].disabled;this._updateIcon(checked);this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",checked);if(this.options.label!==null){this._updateLabel();}
if(isDisabled!==this.options.disabled){this._setOptions({"disabled":isDisabled});}}}]);var widgetsCheckboxradio=$.ui.checkboxradio;$.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:true},_getCreateOptions:function(){var disabled,options=this._super()||{};this.isInput=this.element.is("input");disabled=this.element[0].disabled;if(disabled!=null){options.disabled=disabled;}
this.originalLabel=this.isInput?this.element.val():this.element.html();if(this.originalLabel){options.label=this.originalLabel;}
return options;},_create:function(){if(!this.option.showLabel&!this.options.icon){this.options.showLabel=true;}
if(this.options.disabled==null){this.options.disabled=this.element[0].disabled||false;}
this.hasTitle=!!this.element.attr("title");if(this.options.label&&this.options.label!==this.originalLabel){if(this.isInput){this.element.val(this.options.label);}else{this.element.html(this.options.label);}}
this._addClass("ui-button","ui-widget");this._setOption("disabled",this.options.disabled);this._enhance();if(this.element.is("a")){this._on({"keyup":function(event){if(event.keyCode===$.ui.keyCode.SPACE){event.preventDefault();if(this.element[0].click){this.element[0].click();}else{this.element.trigger("click");}}}});}},_enhance:function(){if(!this.element.is("button")){this.element.attr("role","button");}
if(this.options.icon){this._updateIcon("icon",this.options.icon);this._updateTooltip();}},_updateTooltip:function(){this.title=this.element.attr("title");if(!this.options.showLabel&&!this.title){this.element.attr("title",this.options.label);}},_updateIcon:function(option,value){var icon=option!=="iconPosition",position=icon?this.options.iconPosition:value,displayBlock=position==="top"||position==="bottom";if(!this.icon){this.icon=$("<span>");this._addClass(this.icon,"ui-button-icon","ui-icon");if(!this.options.showLabel){this._addClass("ui-button-icon-only");}}else if(icon){this._removeClass(this.icon,null,this.options.icon);}
if(icon){this._addClass(this.icon,null,value);}
this._attachIcon(position);if(displayBlock){this._addClass(this.icon,null,"ui-widget-icon-block");if(this.iconSpace){this.iconSpace.remove();}}else{if(!this.iconSpace){this.iconSpace=$("<span> </span>");this._addClass(this.iconSpace,"ui-button-icon-space");}
this._removeClass(this.icon,null,"ui-wiget-icon-block");this._attachIconSpace(position);}},_destroy:function(){this.element.removeAttr("role");if(this.icon){this.icon.remove();}
if(this.iconSpace){this.iconSpace.remove();}
if(!this.hasTitle){this.element.removeAttr("title");}},_attachIconSpace:function(iconPosition){this.icon[/^(?:end|bottom)/.test(iconPosition)?"before":"after"](this.iconSpace);},_attachIcon:function(iconPosition){this.element[/^(?:end|bottom)/.test(iconPosition)?"append":"prepend"](this.icon);},_setOptions:function(options){var newShowLabel=options.showLabel===undefined?this.options.showLabel:options.showLabel,newIcon=options.icon===undefined?this.options.icon:options.icon;if(!newShowLabel&&!newIcon){options.showLabel=true;}
this._super(options);},_setOption:function(key,value){if(key==="icon"){if(value){this._updateIcon(key,value);}else if(this.icon){this.icon.remove();if(this.iconSpace){this.iconSpace.remove();}}}
if(key==="iconPosition"){this._updateIcon(key,value);}
if(key==="showLabel"){this._toggleClass("ui-button-icon-only",null,!value);this._updateTooltip();}
if(key==="label"){if(this.isInput){this.element.val(value);}else{this.element.html(value);if(this.icon){this._attachIcon(this.options.iconPosition);this._attachIconSpace(this.options.iconPosition);}}}
this._super(key,value);if(key==="disabled"){this._toggleClass(null,"ui-state-disabled",value);this.element[0].disabled=value;if(value){this.element.blur();}}},refresh:function(){var isDisabled=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");if(isDisabled!==this.options.disabled){this._setOptions({disabled:isDisabled});}
this._updateTooltip();}});if($.uiBackCompat!==false){$.widget("ui.button",$.ui.button,{options:{text:true,icons:{primary:null,secondary:null}},_create:function(){if(this.options.showLabel&&!this.options.text){this.options.showLabel=this.options.text;}
if(!this.options.showLabel&&this.options.text){this.options.text=this.options.showLabel;}
if(!this.options.icon&&(this.options.icons.primary||this.options.icons.secondary)){if(this.options.icons.primary){this.options.icon=this.options.icons.primary;}else{this.options.icon=this.options.icons.secondary;this.options.iconPosition="end";}}else if(this.options.icon){this.options.icons.primary=this.options.icon;}
this._super();},_setOption:function(key,value){if(key==="text"){this._super("showLabel",value);return;}
if(key==="showLabel"){this.options.text=value;}
if(key==="icon"){this.options.icons.primary=value;}
if(key==="icons"){if(value.primary){this._super("icon",value.primary);this._super("iconPosition","beginning");}else if(value.secondary){this._super("icon",value.secondary);this._super("iconPosition","end");}}
this._superApply(arguments);}});$.fn.button=(function(orig){return function(){if(!this.length||(this.length&&this[0].tagName!=="INPUT")||(this.length&&this[0].tagName==="INPUT"&&(this.attr("type")!=="checkbox"&&this.attr("type")!=="radio"))){return orig.apply(this,arguments);}
if(!$.ui.checkboxradio){$.error("Checkboxradio widget missing");}
if(arguments.length===0){return this.checkboxradio({"icon":false});}
return this.checkboxradio.apply(this,arguments);};})($.fn.button);$.fn.buttonset=function(){if(!$.ui.controlgroup){$.error("Controlgroup widget missing");}
if(arguments[0]==="option"&&arguments[1]==="items"&&arguments[2]){return this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]);}
if(arguments[0]==="option"&&arguments[1]==="items"){return this.controlgroup.apply(this,[arguments[0],"items.button"]);}
if(typeof arguments[0]==="object"&&arguments[0].items){arguments[0].items={button:arguments[0].items};}
return this.controlgroup.apply(this,arguments);};}
var widgetsButton=$.ui.button;$.extend($.ui,{datepicker:{version:"1.12.1"}});var datepicker_instActive;function datepicker_getZindex(elem){var position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}
elem=elem.parent();}
return 0;}
function Datepicker(){this._curInst=null;this._keyEvent=false;this._disabledInputs=[];this._datepickerShowing=false;this._inDialog=false;this._mainDivId="ui-datepicker-div";this._inlineClass="ui-datepicker-inline";this._appendClass="ui-datepicker-append";this._triggerClass="ui-datepicker-trigger";this._dialogClass="ui-datepicker-dialog";this._disableClass="ui-datepicker-disabled";this._unselectableClass="ui-datepicker-unselectable";this._currentClass="ui-datepicker-current-day";this._dayOverClass="ui-datepicker-days-cell-over";this.regional=[];this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:""};this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:false,hideIfNoPrevNext:false,navigationAsDateFormat:false,gotoCurrent:false,changeMonth:false,changeYear:false,yearRange:"c-10:c+10",showOtherMonths:false,selectOtherMonths:false,showWeek:false,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:true,showButtonPanel:false,autoSize:false,disabled:false};$.extend(this._defaults,this.regional[""]);this.regional.en=$.extend(true,{},this.regional[""]);this.regional["en-US"]=$.extend(true,{},this.regional.en);this.dpDiv=datepicker_bindHover($("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"));}
$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv;},setDefaults:function(settings){datepicker_extendRemove(this._defaults,settings||{});return this;},_attachDatepicker:function(target,settings){var nodeName,inline,inst;nodeName=target.nodeName.toLowerCase();inline=(nodeName==="div"||nodeName==="span");if(!target.id){this.uuid+=1;target.id="dp"+this.uuid;}
inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{});if(nodeName==="input"){this._connectDatepicker(target,inst);}else if(inline){this._inlineDatepicker(target,inst);}},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:(!inline?this.dpDiv:datepicker_bindHover($("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")))};},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]);inst.trigger=$([]);if(input.hasClass(this.markerClassName)){return;}
this._attachments(input,inst);input.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp);this._autoSize(inst);$.data(target,"datepicker",inst);if(inst.settings.disabled){this._disableDatepicker(target);}},_attachments:function(input,inst){var showOn,buttonText,buttonImage,appendText=this._get(inst,"appendText"),isRTL=this._get(inst,"isRTL");if(inst.append){inst.append.remove();}
if(appendText){inst.append=$("<span class='"+this._appendClass+"'>"+appendText+"</span>");input[isRTL?"before":"after"](inst.append);}
input.off("focus",this._showDatepicker);if(inst.trigger){inst.trigger.remove();}
showOn=this._get(inst,"showOn");if(showOn==="focus"||showOn==="both"){input.on("focus",this._showDatepicker);}
if(showOn==="button"||showOn==="both"){buttonText=this._get(inst,"buttonText");buttonImage=this._get(inst,"buttonImage");inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$("<button type='button'></button>").addClass(this._triggerClass).html(!buttonImage?buttonText:$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText})));input[isRTL?"before":"after"](inst.trigger);inst.trigger.on("click",function(){if($.datepicker._datepickerShowing&&$.datepicker._lastInput===input[0]){$.datepicker._hideDatepicker();}else if($.datepicker._datepickerShowing&&$.datepicker._lastInput!==input[0]){$.datepicker._hideDatepicker();$.datepicker._showDatepicker(input[0]);}else{$.datepicker._showDatepicker(input[0]);}
return false;});}},_autoSize:function(inst){if(this._get(inst,"autoSize")&&!inst.inline){var findMax,max,maxI,i,date=new Date(2009,12-1,20),dateFormat=this._get(inst,"dateFormat");if(dateFormat.match(/[DM]/)){findMax=function(names){max=0;maxI=0;for(i=0;i<names.length;i++){if(names[i].length>max){max=names[i].length;maxI=i;}}
return maxI;};date.setMonth(findMax(this._get(inst,(dateFormat.match(/MM/)?"monthNames":"monthNamesShort"))));date.setDate(findMax(this._get(inst,(dateFormat.match(/DD/)?"dayNames":"dayNamesShort")))+20-date.getDay());}
inst.input.attr("size",this._formatDate(inst,date).length);}},_inlineDatepicker:function(target,inst){var divSpan=$(target);if(divSpan.hasClass(this.markerClassName)){return;}
divSpan.addClass(this.markerClassName).append(inst.dpDiv);$.data(target,"datepicker",inst);this._setDate(inst,this._getDefaultDate(inst),true);this._updateDatepicker(inst);this._updateAlternate(inst);if(inst.settings.disabled){this._disableDatepicker(target);}
inst.dpDiv.css("display","block");},_dialogDatepicker:function(input,date,onSelect,settings,pos){var id,browserWidth,browserHeight,scrollX,scrollY,inst=this._dialogInst;if(!inst){this.uuid+=1;id="dp"+this.uuid;this._dialogInput=$("<input type='text' id='"+id+"' style='position: absolute; top: -100px; width: 0px;'/>");this._dialogInput.on("keydown",this._doKeyDown);$("body").append(this._dialogInput);inst=this._dialogInst=this._newInst(this._dialogInput,false);inst.settings={};$.data(this._dialogInput[0],"datepicker",inst);}
datepicker_extendRemove(inst.settings,settings||{});date=(date&&date.constructor===Date?this._formatDate(inst,date):date);this._dialogInput.val(date);this._pos=(pos?(pos.length?pos:[pos.pageX,pos.pageY]):null);if(!this._pos){browserWidth=document.documentElement.clientWidth;browserHeight=document.documentElement.clientHeight;scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;scrollY=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[(browserWidth/2)-100+scrollX,(browserHeight/2)-150+scrollY];}
this._dialogInput.css("left",(this._pos[0]+20)+"px").css("top",this._pos[1]+"px");inst.settings.onSelect=onSelect;this._inDialog=true;this.dpDiv.addClass(this._dialogClass);this._showDatepicker(this._dialogInput[0]);if($.blockUI){$.blockUI(this.dpDiv);}
$.data(this._dialogInput[0],"datepicker",inst);return this;},_destroyDatepicker:function(target){var nodeName,$target=$(target),inst=$.data(target,"datepicker");if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();$.removeData(target,"datepicker");if(nodeName==="input"){inst.append.remove();inst.trigger.remove();$target.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp);}else if(nodeName==="div"||nodeName==="span"){$target.removeClass(this.markerClassName).empty();}
if(datepicker_instActive===inst){datepicker_instActive=null;}},_enableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,"datepicker");if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();if(nodeName==="input"){target.disabled=false;inst.trigger.filter("button").each(function(){this.disabled=false;}).end().filter("img").css({opacity:"1.0",cursor:""});}else if(nodeName==="div"||nodeName==="span"){inline=$target.children("."+this._inlineClass);inline.children().removeClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",false);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value===target?null:value);});},_disableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,"datepicker");if(!$target.hasClass(this.markerClassName)){return;}
nodeName=target.nodeName.toLowerCase();if(nodeName==="input"){target.disabled=true;inst.trigger.filter("button").each(function(){this.disabled=true;}).end().filter("img").css({opacity:"0.5",cursor:"default"});}else if(nodeName==="div"||nodeName==="span"){inline=$target.children("."+this._inlineClass);inline.children().addClass("ui-state-disabled");inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",true);}
this._disabledInputs=$.map(this._disabledInputs,function(value){return(value===target?null:value);});this._disabledInputs[this._disabledInputs.length]=target;},_isDisabledDatepicker:function(target){if(!target){return false;}
for(var i=0;i<this._disabledInputs.length;i++){if(this._disabledInputs[i]===target){return true;}}
return false;},_getInst:function(target){try{return $.data(target,"datepicker");}
catch(err){throw"Missing instance data for this datepicker";}},_optionDatepicker:function(target,name,value){var settings,date,minDate,maxDate,inst=this._getInst(target);if(arguments.length===2&&typeof name==="string"){return(name==="defaults"?$.extend({},$.datepicker._defaults):(inst?(name==="all"?$.extend({},inst.settings):this._get(inst,name)):null));}
settings=name||{};if(typeof name==="string"){settings={};settings[name]=value;}
if(inst){if(this._curInst===inst){this._hideDatepicker();}
date=this._getDateDatepicker(target,true);minDate=this._getMinMaxDate(inst,"min");maxDate=this._getMinMaxDate(inst,"max");datepicker_extendRemove(inst.settings,settings);if(minDate!==null&&settings.dateFormat!==undefined&&settings.minDate===undefined){inst.settings.minDate=this._formatDate(inst,minDate);}
if(maxDate!==null&&settings.dateFormat!==undefined&&settings.maxDate===undefined){inst.settings.maxDate=this._formatDate(inst,maxDate);}
if("disabled"in settings){if(settings.disabled){this._disableDatepicker(target);}else{this._enableDatepicker(target);}}
this._attachments($(target),inst);this._autoSize(inst);this._setDate(inst,date);this._updateAlternate(inst);this._updateDatepicker(inst);}},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value);},_refreshDatepicker:function(target){var inst=this._getInst(target);if(inst){this._updateDatepicker(inst);}},_setDateDatepicker:function(target,date){var inst=this._getInst(target);if(inst){this._setDate(inst,date);this._updateDatepicker(inst);this._updateAlternate(inst);}},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);if(inst&&!inst.inline){this._setDateFromField(inst,noDefault);}
return(inst?this._getDate(inst):null);},_doKeyDown:function(event){var onSelect,dateStr,sel,inst=$.datepicker._getInst(event.target),handled=true,isRTL=inst.dpDiv.is(".ui-datepicker-rtl");inst._keyEvent=true;if($.datepicker._datepickerShowing){switch(event.keyCode){case 9:$.datepicker._hideDatepicker();handled=false;break;case 13:sel=$("td."+$.datepicker._dayOverClass+":not(."+
$.datepicker._currentClass+")",inst.dpDiv);if(sel[0]){$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]);}
onSelect=$.datepicker._get(inst,"onSelect");if(onSelect){dateStr=$.datepicker._formatDate(inst);onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}else{$.datepicker._hideDatepicker();}
return false;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");break;case 34:$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");break;case 35:if(event.ctrlKey||event.metaKey){$.datepicker._clearDate(event.target);}
handled=event.ctrlKey||event.metaKey;break;case 36:if(event.ctrlKey||event.metaKey){$.datepicker._gotoToday(event.target);}
handled=event.ctrlKey||event.metaKey;break;case 37:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?+1:-1),"D");}
handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths")),"M");}
break;case 38:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,-7,"D");}
handled=event.ctrlKey||event.metaKey;break;case 39:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,(isRTL?-1:+1),"D");}
handled=event.ctrlKey||event.metaKey;if(event.originalEvent.altKey){$.datepicker._adjustDate(event.target,(event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths")),"M");}
break;case 40:if(event.ctrlKey||event.metaKey){$.datepicker._adjustDate(event.target,+7,"D");}
handled=event.ctrlKey||event.metaKey;break;default:handled=false;}}else if(event.keyCode===36&&event.ctrlKey){$.datepicker._showDatepicker(this);}else{handled=false;}
if(handled){event.preventDefault();event.stopPropagation();}},_doKeyPress:function(event){var chars,chr,inst=$.datepicker._getInst(event.target);if($.datepicker._get(inst,"constrainInput")){chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat"));chr=String.fromCharCode(event.charCode==null?event.keyCode:event.charCode);return event.ctrlKey||event.metaKey||(chr<" "||!chars||chars.indexOf(chr)>-1);}},_doKeyUp:function(event){var date,inst=$.datepicker._getInst(event.target);if(inst.input.val()!==inst.lastVal){try{date=$.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),(inst.input?inst.input.val():null),$.datepicker._getFormatConfig(inst));if(date){$.datepicker._setDateFromField(inst);$.datepicker._updateAlternate(inst);$.datepicker._updateDatepicker(inst);}}
catch(err){}}
return true;},_showDatepicker:function(input){input=input.target||input;if(input.nodeName.toLowerCase()!=="input"){input=$("input",input.parentNode)[0];}
if($.datepicker._isDisabledDatepicker(input)||$.datepicker._lastInput===input){return;}
var inst,beforeShow,beforeShowSettings,isFixed,offset,showAnim,duration;inst=$.datepicker._getInst(input);if($.datepicker._curInst&&$.datepicker._curInst!==inst){$.datepicker._curInst.dpDiv.stop(true,true);if(inst&&$.datepicker._datepickerShowing){$.datepicker._hideDatepicker($.datepicker._curInst.input[0]);}}
beforeShow=$.datepicker._get(inst,"beforeShow");beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{};if(beforeShowSettings===false){return;}
datepicker_extendRemove(inst.settings,beforeShowSettings);inst.lastVal=null;$.datepicker._lastInput=input;$.datepicker._setDateFromField(inst);if($.datepicker._inDialog){input.value="";}
if(!$.datepicker._pos){$.datepicker._pos=$.datepicker._findPos(input);$.datepicker._pos[1]+=input.offsetHeight;}
isFixed=false;$(input).parents().each(function(){isFixed|=$(this).css("position")==="fixed";return!isFixed;});offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null;inst.dpDiv.empty();inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});$.datepicker._updateDatepicker(inst);offset=$.datepicker._checkOffset(inst,offset,isFixed);inst.dpDiv.css({position:($.datepicker._inDialog&&$.blockUI?"static":(isFixed?"fixed":"absolute")),display:"none",left:offset.left+"px",top:offset.top+"px"});if(!inst.inline){showAnim=$.datepicker._get(inst,"showAnim");duration=$.datepicker._get(inst,"duration");inst.dpDiv.css("z-index",datepicker_getZindex($(input))+1);$.datepicker._datepickerShowing=true;if($.effects&&$.effects.effect[showAnim]){inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration);}else{inst.dpDiv[showAnim||"show"](showAnim?duration:null);}
if($.datepicker._shouldFocusInput(inst)){inst.input.trigger("focus");}
$.datepicker._curInst=inst;}},_updateDatepicker:function(inst){this.maxRows=4;datepicker_instActive=inst;inst.dpDiv.empty().append(this._generateHTML(inst));this._attachHandlers(inst);var origyearshtml,numMonths=this._getNumberOfMonths(inst),cols=numMonths[1],width=17,activeCell=inst.dpDiv.find("."+this._dayOverClass+" a");if(activeCell.length>0){datepicker_handleMouseover.apply(activeCell.get(0));}
inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");if(cols>1){inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",(width*cols)+"em");}
inst.dpDiv[(numMonths[0]!==1||numMonths[1]!==1?"add":"remove")+"Class"]("ui-datepicker-multi");inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl");if(inst===$.datepicker._curInst&&$.datepicker._datepickerShowing&&$.datepicker._shouldFocusInput(inst)){inst.input.trigger("focus");}
if(inst.yearshtml){origyearshtml=inst.yearshtml;setTimeout(function(){if(origyearshtml===inst.yearshtml&&inst.yearshtml){inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml);}
origyearshtml=inst.yearshtml=null;},0);}},_shouldFocusInput:function(inst){return inst.input&&inst.input.is(":visible")&&!inst.input.is(":disabled")&&!inst.input.is(":focus");},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth(),dpHeight=inst.dpDiv.outerHeight(),inputWidth=inst.input?inst.input.outerWidth():0,inputHeight=inst.input?inst.input.outerHeight():0,viewWidth=document.documentElement.clientWidth+(isFixed?0:$(document).scrollLeft()),viewHeight=document.documentElement.clientHeight+(isFixed?0:$(document).scrollTop());offset.left-=(this._get(inst,"isRTL")?(dpWidth-inputWidth):0);offset.left-=(isFixed&&offset.left===inst.input.offset().left)?$(document).scrollLeft():0;offset.top-=(isFixed&&offset.top===(inst.input.offset().top+inputHeight))?$(document).scrollTop():0;offset.left-=Math.min(offset.left,(offset.left+dpWidth>viewWidth&&viewWidth>dpWidth)?Math.abs(offset.left+dpWidth-viewWidth):0);offset.top-=Math.min(offset.top,(offset.top+dpHeight>viewHeight&&viewHeight>dpHeight)?Math.abs(dpHeight+inputHeight):0);return offset;},_findPos:function(obj){var position,inst=this._getInst(obj),isRTL=this._get(inst,"isRTL");while(obj&&(obj.type==="hidden"||obj.nodeType!==1||$.expr.filters.hidden(obj))){obj=obj[isRTL?"previousSibling":"nextSibling"];}
position=$(obj).offset();return[position.left,position.top];},_hideDatepicker:function(input){var showAnim,duration,postProcess,onClose,inst=this._curInst;if(!inst||(input&&inst!==$.data(input,"datepicker"))){return;}
if(this._datepickerShowing){showAnim=this._get(inst,"showAnim");duration=this._get(inst,"duration");postProcess=function(){$.datepicker._tidyDialog(inst);};if($.effects&&($.effects.effect[showAnim]||$.effects[showAnim])){inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess);}else{inst.dpDiv[(showAnim==="slideDown"?"slideUp":(showAnim==="fadeIn"?"fadeOut":"hide"))]((showAnim?duration:null),postProcess);}
if(!showAnim){postProcess();}
this._datepickerShowing=false;onClose=this._get(inst,"onClose");if(onClose){onClose.apply((inst.input?inst.input[0]:null),[(inst.input?inst.input.val():""),inst]);}
this._lastInput=null;if(this._inDialog){this._dialogInput.css({position:"absolute",left:"0",top:"-100px"});if($.blockUI){$.unblockUI();$("body").append(this.dpDiv);}}
this._inDialog=false;}},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar");},_checkExternalClick:function(event){if(!$.datepicker._curInst){return;}
var $target=$(event.target),inst=$.datepicker._getInst($target[0]);if((($target[0].id!==$.datepicker._mainDivId&&$target.parents("#"+$.datepicker._mainDivId).length===0&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&!($.datepicker._inDialog&&$.blockUI)))||($target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!==inst)){$.datepicker._hideDatepicker();}},_adjustDate:function(id,offset,period){var target=$(id),inst=this._getInst(target[0]);if(this._isDisabledDatepicker(target[0])){return;}
this._adjustInstDate(inst,offset+
(period==="M"?this._get(inst,"showCurrentAtPos"):0),period);this._updateDatepicker(inst);},_gotoToday:function(id){var date,target=$(id),inst=this._getInst(target[0]);if(this._get(inst,"gotoCurrent")&&inst.currentDay){inst.selectedDay=inst.currentDay;inst.drawMonth=inst.selectedMonth=inst.currentMonth;inst.drawYear=inst.selectedYear=inst.currentYear;}else{date=new Date();inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();}
this._notifyChange(inst);this._adjustDate(target);},_selectMonthYear:function(id,select,period){var target=$(id),inst=this._getInst(target[0]);inst["selected"+(period==="M"?"Month":"Year")]=inst["draw"+(period==="M"?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10);this._notifyChange(inst);this._adjustDate(target);},_selectDay:function(id,month,year,td){var inst,target=$(id);if($(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])){return;}
inst=this._getInst(target[0]);inst.selectedDay=inst.currentDay=$("a",td).html();inst.selectedMonth=inst.currentMonth=month;inst.selectedYear=inst.currentYear=year;this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear));},_clearDate:function(id){var target=$(id);this._selectDate(target,"");},_selectDate:function(id,dateStr){var onSelect,target=$(id),inst=this._getInst(target[0]);dateStr=(dateStr!=null?dateStr:this._formatDate(inst));if(inst.input){inst.input.val(dateStr);}
this._updateAlternate(inst);onSelect=this._get(inst,"onSelect");if(onSelect){onSelect.apply((inst.input?inst.input[0]:null),[dateStr,inst]);}else if(inst.input){inst.input.trigger("change");}
if(inst.inline){this._updateDatepicker(inst);}else{this._hideDatepicker();this._lastInput=inst.input[0];if(typeof(inst.input[0])!=="object"){inst.input.trigger("focus");}
this._lastInput=null;}},_updateAlternate:function(inst){var altFormat,date,dateStr,altField=this._get(inst,"altField");if(altField){altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat");date=this._getDate(inst);dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst));$(altField).val(dateStr);}},noWeekends:function(date){var day=date.getDay();return[(day>0&&day<6),""];},iso8601Week:function(date){var time,checkDate=new Date(date.getTime());checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7));time=checkDate.getTime();checkDate.setMonth(0);checkDate.setDate(1);return Math.floor(Math.round((time-checkDate)/86400000)/7)+1;},parseDate:function(format,value,settings){if(format==null||value==null){throw"Invalid arguments";}
value=(typeof value==="object"?value.toString():value+"");if(value===""){return null;}
var iFormat,dim,extra,iValue=0,shortYearCutoffTemp=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff,shortYearCutoff=(typeof shortYearCutoffTemp!=="string"?shortYearCutoffTemp:new Date().getFullYear()%100+parseInt(shortYearCutoffTemp,10)),dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,year=-1,month=-1,day=-1,doy=-1,literal=false,date,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;},getNumber=function(match){var isDoubled=lookAhead(match),size=(match==="@"?14:(match==="!"?20:(match==="y"&&isDoubled?4:(match==="o"?3:2)))),minSize=(match==="y"?size:1),digits=new RegExp("^\\d{"+minSize+","+size+"}"),num=value.substring(iValue).match(digits);if(!num){throw"Missing number at position "+iValue;}
iValue+=num[0].length;return parseInt(num[0],10);},getName=function(match,shortNames,longNames){var index=-1,names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]];}).sort(function(a,b){return-(a[1].length-b[1].length);});$.each(names,function(i,pair){var name=pair[1];if(value.substr(iValue,name.length).toLowerCase()===name.toLowerCase()){index=pair[0];iValue+=name.length;return false;}});if(index!==-1){return index+1;}else{throw"Unknown name at position "+iValue;}},checkLiteral=function(){if(value.charAt(iValue)!==format.charAt(iFormat)){throw"Unexpected literal at position "+iValue;}
iValue++;};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false;}else{checkLiteral();}}else{switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":date=new Date(getNumber("@"));year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"!":date=new Date((getNumber("!")-this._ticksTo1970)/10000);year=date.getFullYear();month=date.getMonth()+1;day=date.getDate();break;case"'":if(lookAhead("'")){checkLiteral();}else{literal=true;}
break;default:checkLiteral();}}}
if(iValue<value.length){extra=value.substr(iValue);if(!/^\s+/.test(extra)){throw"Extra/unparsed characters found in date: "+extra;}}
if(year===-1){year=new Date().getFullYear();}else if(year<100){year+=new Date().getFullYear()-new Date().getFullYear()%100+
(year<=shortYearCutoff?0:-100);}
if(doy>-1){month=1;day=doy;do{dim=this._getDaysInMonth(year,month-1);if(day<=dim){break;}
month++;day-=dim;}while(true);}
date=this._daylightSavingAdjust(new Date(year,month-1,day));if(date.getFullYear()!==year||date.getMonth()+1!==month||date.getDate()!==day){throw"Invalid date";}
return date;},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(((1970-1)*365+Math.floor(1970/4)-Math.floor(1970/100)+
Math.floor(1970/400))*24*60*60*10000000),formatDate:function(format,date,settings){if(!date){return"";}
var iFormat,dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;},formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match)){while(num.length<len){num="0"+num;}}
return num;},formatName=function(match,value,shortNames,longNames){return(lookAhead(match)?longNames[value]:shortNames[value]);},output="",literal=false;if(date){for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false;}else{output+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/86400000),3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=(lookAhead("y")?date.getFullYear():(date.getFullYear()%100<10?"0":"")+date.getFullYear()%100);break;case"@":output+=date.getTime();break;case"!":output+=date.getTime()*10000+this._ticksTo1970;break;case"'":if(lookAhead("'")){output+="'";}else{literal=true;}
break;default:output+=format.charAt(iFormat);}}}}
return output;},_possibleChars:function(format){var iFormat,chars="",literal=false,lookAhead=function(match){var matches=(iFormat+1<format.length&&format.charAt(iFormat+1)===match);if(matches){iFormat++;}
return matches;};for(iFormat=0;iFormat<format.length;iFormat++){if(literal){if(format.charAt(iFormat)==="'"&&!lookAhead("'")){literal=false;}else{chars+=format.charAt(iFormat);}}else{switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":if(lookAhead("'")){chars+="'";}else{literal=true;}
break;default:chars+=format.charAt(iFormat);}}}
return chars;},_get:function(inst,name){return inst.settings[name]!==undefined?inst.settings[name]:this._defaults[name];},_setDateFromField:function(inst,noDefault){if(inst.input.val()===inst.lastVal){return;}
var dateFormat=this._get(inst,"dateFormat"),dates=inst.lastVal=inst.input?inst.input.val():null,defaultDate=this._getDefaultDate(inst),date=defaultDate,settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate;}catch(event){dates=(noDefault?"":dates);}
inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();inst.currentDay=(dates?date.getDate():0);inst.currentMonth=(dates?date.getMonth():0);inst.currentYear=(dates?date.getFullYear():0);this._adjustInstDate(inst);},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,"defaultDate"),new Date()));},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date();date.setDate(date.getDate()+offset);return date;},offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),offset,$.datepicker._getFormatConfig(inst));}
catch(e){}
var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date(),year=date.getFullYear(),month=date.getMonth(),day=date.getDate(),pattern=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matches=pattern.exec(offset);while(matches){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=parseInt(matches[1],10)*7;break;case"m":case"M":month+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10);day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;}
matches=pattern.exec(offset);}
return new Date(year,month,day);},newDate=(date==null||date===""?defaultDate:(typeof date==="string"?offsetString(date):(typeof date==="number"?(isNaN(date)?defaultDate:offsetNumeric(date)):new Date(date.getTime()))));newDate=(newDate&&newDate.toString()==="Invalid Date"?defaultDate:newDate);if(newDate){newDate.setHours(0);newDate.setMinutes(0);newDate.setSeconds(0);newDate.setMilliseconds(0);}
return this._daylightSavingAdjust(newDate);},_daylightSavingAdjust:function(date){if(!date){return null;}
date.setHours(date.getHours()>12?date.getHours()+2:0);return date;},_setDate:function(inst,date,noChange){var clear=!date,origMonth=inst.selectedMonth,origYear=inst.selectedYear,newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date()));inst.selectedDay=inst.currentDay=newDate.getDate();inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth();inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear();if((origMonth!==inst.selectedMonth||origYear!==inst.selectedYear)&&!noChange){this._notifyChange(inst);}
this._adjustInstDate(inst);if(inst.input){inst.input.val(clear?"":this._formatDate(inst));}},_getDate:function(inst){var startDate=(!inst.currentYear||(inst.input&&inst.input.val()==="")?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return startDate;},_attachHandlers:function(inst){var stepMonths=this._get(inst,"stepMonths"),id="#"+inst.id.replace(/\\\\/g,"\\");inst.dpDiv.find("[data-handler]").map(function(){var handler={prev:function(){$.datepicker._adjustDate(id,-stepMonths,"M");},next:function(){$.datepicker._adjustDate(id,+stepMonths,"M");},hide:function(){$.datepicker._hideDatepicker();},today:function(){$.datepicker._gotoToday(id);},selectDay:function(){$.datepicker._selectDay(id,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return false;},selectMonth:function(){$.datepicker._selectMonthYear(id,this,"M");return false;},selectYear:function(){$.datepicker._selectMonthYear(id,this,"Y");return false;}};$(this).on(this.getAttribute("data-event"),handler[this.getAttribute("data-handler")]);});},_generateHTML:function(inst){var maxDraw,prevText,prev,nextText,next,currentText,gotoDate,controls,buttonPanel,firstDay,showWeek,dayNames,dayNamesMin,monthNames,monthNamesShort,beforeShowDay,showOtherMonths,selectOtherMonths,defaultDate,html,dow,row,group,col,selectedDate,cornerClass,calender,thead,day,daysInMonth,leadDays,curRows,numRows,printDate,dRow,tbody,daySettings,otherMonth,unselectable,tempDate=new Date(),today=this._daylightSavingAdjust(new Date(tempDate.getFullYear(),tempDate.getMonth(),tempDate.getDate())),isRTL=this._get(inst,"isRTL"),showButtonPanel=this._get(inst,"showButtonPanel"),hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext"),navigationAsDateFormat=this._get(inst,"navigationAsDateFormat"),numMonths=this._getNumberOfMonths(inst),showCurrentAtPos=this._get(inst,"showCurrentAtPos"),stepMonths=this._get(inst,"stepMonths"),isMultiMonth=(numMonths[0]!==1||numMonths[1]!==1),currentDate=this._daylightSavingAdjust((!inst.currentDay?new Date(9999,9,9):new Date(inst.currentYear,inst.currentMonth,inst.currentDay))),minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),drawMonth=inst.drawMonth-showCurrentAtPos,drawYear=inst.drawYear;if(drawMonth<0){drawMonth+=12;drawYear--;}
if(maxDate){maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-(numMonths[0]*numMonths[1])+1,maxDate.getDate()));maxDraw=(minDate&&maxDraw<minDate?minDate:maxDraw);while(this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw){drawMonth--;if(drawMonth<0){drawMonth=11;drawYear--;}}}
inst.drawMonth=drawMonth;inst.drawYear=drawYear;prevText=this._get(inst,"prevText");prevText=(!navigationAsDateFormat?prevText:this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)));prev=(this._canAdjustMonth(inst,-1,drawYear,drawMonth)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'"+" title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>":(hideIfNoPrevNext?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>"));nextText=this._get(inst,"nextText");nextText=(!navigationAsDateFormat?nextText:this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)));next=(this._canAdjustMonth(inst,+1,drawYear,drawMonth)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'"+" title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>":(hideIfNoPrevNext?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>"));currentText=this._get(inst,"currentText");gotoDate=(this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today);currentText=(!navigationAsDateFormat?currentText:this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)));controls=(!inst.inline?"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+
this._get(inst,"closeText")+"</button>":"");buttonPanel=(showButtonPanel)?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(isRTL?controls:"")+
(this._isInRange(inst,gotoDate)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'"+">"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"";firstDay=parseInt(this._get(inst,"firstDay"),10);firstDay=(isNaN(firstDay)?0:firstDay);showWeek=this._get(inst,"showWeek");dayNames=this._get(inst,"dayNames");dayNamesMin=this._get(inst,"dayNamesMin");monthNames=this._get(inst,"monthNames");monthNamesShort=this._get(inst,"monthNamesShort");beforeShowDay=this._get(inst,"beforeShowDay");showOtherMonths=this._get(inst,"showOtherMonths");selectOtherMonths=this._get(inst,"selectOtherMonths");defaultDate=this._getDefaultDate(inst);html="";for(row=0;row<numMonths[0];row++){group="";this.maxRows=4;for(col=0;col<numMonths[1];col++){selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay));cornerClass=" ui-corner-all";calender="";if(isMultiMonth){calender+="<div class='ui-datepicker-group";if(numMonths[1]>1){switch(col){case 0:calender+=" ui-datepicker-group-first";cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+=" ui-datepicker-group-last";cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+=" ui-datepicker-group-middle";cornerClass="";break;}}
calender+="'>";}
calender+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+cornerClass+"'>"+
(/all|left/.test(cornerClass)&&row===0?(isRTL?next:prev):"")+
(/all|right/.test(cornerClass)&&row===0?(isRTL?prev:next):"")+
this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>";thead=(showWeek?"<th class='ui-datepicker-week-col'>"+this._get(inst,"weekHeader")+"</th>":"");for(dow=0;dow<7;dow++){day=(dow+firstDay)%7;thead+="<th scope='col'"+((dow+firstDay+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+dayNames[day]+"'>"+dayNamesMin[day]+"</span></th>";}
calender+=thead+"</tr></thead><tbody>";daysInMonth=this._getDaysInMonth(drawYear,drawMonth);if(drawYear===inst.selectedYear&&drawMonth===inst.selectedMonth){inst.selectedDay=Math.min(inst.selectedDay,daysInMonth);}
leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7;curRows=Math.ceil((leadDays+daysInMonth)/7);numRows=(isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows);this.maxRows=numRows;printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays));for(dRow=0;dRow<numRows;dRow++){calender+="<tr>";tbody=(!showWeek?"":"<td class='ui-datepicker-week-col'>"+
this._get(inst,"calculateWeek")(printDate)+"</td>");for(dow=0;dow<7;dow++){daySettings=(beforeShowDay?beforeShowDay.apply((inst.input?inst.input[0]:null),[printDate]):[true,""]);otherMonth=(printDate.getMonth()!==drawMonth);unselectable=(otherMonth&&!selectOtherMonths)||!daySettings[0]||(minDate&&printDate<minDate)||(maxDate&&printDate>maxDate);tbody+="<td class='"+
((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+
(otherMonth?" ui-datepicker-other-month":"")+
((printDate.getTime()===selectedDate.getTime()&&drawMonth===inst.selectedMonth&&inst._keyEvent)||(defaultDate.getTime()===printDate.getTime()&&defaultDate.getTime()===selectedDate.getTime())?" "+this._dayOverClass:"")+
(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+
(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+
(printDate.getTime()===currentDate.getTime()?" "+this._currentClass:"")+
(printDate.getTime()===today.getTime()?" ui-datepicker-today":""))+"'"+
((!otherMonth||showOtherMonths)&&daySettings[2]?" title='"+daySettings[2].replace(/'/g,"&#39;")+"'":"")+
(unselectable?"":" data-handler='selectDay' data-event='click' data-month='"+printDate.getMonth()+"' data-year='"+printDate.getFullYear()+"'")+">"+
(otherMonth&&!showOtherMonths?"&#xa0;":(unselectable?"<span class='ui-state-default'>"+printDate.getDate()+"</span>":"<a class='ui-state-default"+
(printDate.getTime()===today.getTime()?" ui-state-highlight":"")+
(printDate.getTime()===currentDate.getTime()?" ui-state-active":"")+
(otherMonth?" ui-priority-secondary":"")+"' href='#'>"+printDate.getDate()+"</a>"))+"</td>";printDate.setDate(printDate.getDate()+1);printDate=this._daylightSavingAdjust(printDate);}
calender+=tbody+"</tr>";}
drawMonth++;if(drawMonth>11){drawMonth=0;drawYear++;}
calender+="</tbody></table>"+(isMultiMonth?"</div>"+
((numMonths[0]>0&&col===numMonths[1]-1)?"<div class='ui-datepicker-row-break'></div>":""):"");group+=calender;}
html+=group;}
html+=buttonPanel;inst._keyEvent=false;return html;},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var inMinYear,inMaxYear,month,years,thisYear,determineYear,year,endYear,changeMonth=this._get(inst,"changeMonth"),changeYear=this._get(inst,"changeYear"),showMonthAfterYear=this._get(inst,"showMonthAfterYear"),html="<div class='ui-datepicker-title'>",monthHtml="";if(secondary||!changeMonth){monthHtml+="<span class='ui-datepicker-month'>"+monthNames[drawMonth]+"</span>";}else{inMinYear=(minDate&&minDate.getFullYear()===drawYear);inMaxYear=(maxDate&&maxDate.getFullYear()===drawYear);monthHtml+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for(month=0;month<12;month++){if((!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||month<=maxDate.getMonth())){monthHtml+="<option value='"+month+"'"+
(month===drawMonth?" selected='selected'":"")+">"+monthNamesShort[month]+"</option>";}}
monthHtml+="</select>";}
if(!showMonthAfterYear){html+=monthHtml+(secondary||!(changeMonth&&changeYear)?"&#xa0;":"");}
if(!inst.yearshtml){inst.yearshtml="";if(secondary||!changeYear){html+="<span class='ui-datepicker-year'>"+drawYear+"</span>";}else{years=this._get(inst,"yearRange").split(":");thisYear=new Date().getFullYear();determineYear=function(value){var year=(value.match(/c[+\-].*/)?drawYear+parseInt(value.substring(1),10):(value.match(/[+\-].*/)?thisYear+parseInt(value,10):parseInt(value,10)));return(isNaN(year)?thisYear:year);};year=determineYear(years[0]);endYear=Math.max(year,determineYear(years[1]||""));year=(minDate?Math.max(year,minDate.getFullYear()):year);endYear=(maxDate?Math.min(endYear,maxDate.getFullYear()):endYear);inst.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for(;year<=endYear;year++){inst.yearshtml+="<option value='"+year+"'"+
(year===drawYear?" selected='selected'":"")+">"+year+"</option>";}
inst.yearshtml+="</select>";html+=inst.yearshtml;inst.yearshtml=null;}}
html+=this._get(inst,"yearSuffix");if(showMonthAfterYear){html+=(secondary||!(changeMonth&&changeYear)?"&#xa0;":"")+monthHtml;}
html+="</div>";return html;},_adjustInstDate:function(inst,offset,period){var year=inst.selectedYear+(period==="Y"?offset:0),month=inst.selectedMonth+(period==="M"?offset:0),day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+(period==="D"?offset:0),date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate();inst.drawMonth=inst.selectedMonth=date.getMonth();inst.drawYear=inst.selectedYear=date.getFullYear();if(period==="M"||period==="Y"){this._notifyChange(inst);}},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),newDate=(minDate&&date<minDate?minDate:date);return(maxDate&&newDate>maxDate?maxDate:newDate);},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");if(onChange){onChange.apply((inst.input?inst.input[0]:null),[inst.selectedYear,inst.selectedMonth+1,inst]);}},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return(numMonths==null?[1,1]:(typeof numMonths==="number"?[1,numMonths]:numMonths));},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+"Date"),null);},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate();},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay();},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst),date=this._daylightSavingAdjust(new Date(curYear,curMonth+(offset<0?offset:numMonths[0]*numMonths[1]),1));if(offset<0){date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth()));}
return this._isInRange(inst,date);},_isInRange:function(inst,date){var yearSplit,currentYear,minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),minYear=null,maxYear=null,years=this._get(inst,"yearRange");if(years){yearSplit=years.split(":");currentYear=new Date().getFullYear();minYear=parseInt(yearSplit[0],10);maxYear=parseInt(yearSplit[1],10);if(yearSplit[0].match(/[+\-].*/)){minYear+=currentYear;}
if(yearSplit[1].match(/[+\-].*/)){maxYear+=currentYear;}}
return((!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime())&&(!minYear||date.getFullYear()>=minYear)&&(!maxYear||date.getFullYear()<=maxYear));},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");shortYearCutoff=(typeof shortYearCutoff!=="string"?shortYearCutoff:new Date().getFullYear()%100+parseInt(shortYearCutoff,10));return{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")};},_formatDate:function(inst,day,month,year){if(!day){inst.currentDay=inst.selectedDay;inst.currentMonth=inst.selectedMonth;inst.currentYear=inst.selectedYear;}
var date=(day?(typeof day==="object"?day:this._daylightSavingAdjust(new Date(year,month,day))):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay)));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst));}});function datepicker_bindHover(dpDiv){var selector="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return dpDiv.on("mouseout",selector,function(){$(this).removeClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1){$(this).removeClass("ui-datepicker-prev-hover");}
if(this.className.indexOf("ui-datepicker-next")!==-1){$(this).removeClass("ui-datepicker-next-hover");}}).on("mouseover",selector,datepicker_handleMouseover);}
function datepicker_handleMouseover(){if(!$.datepicker._isDisabledDatepicker(datepicker_instActive.inline?datepicker_instActive.dpDiv.parent()[0]:datepicker_instActive.input[0])){$(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover");$(this).addClass("ui-state-hover");if(this.className.indexOf("ui-datepicker-prev")!==-1){$(this).addClass("ui-datepicker-prev-hover");}
if(this.className.indexOf("ui-datepicker-next")!==-1){$(this).addClass("ui-datepicker-next-hover");}}}
function datepicker_extendRemove(target,props){$.extend(target,props);for(var name in props){if(props[name]==null){target[name]=props[name];}}
return target;}
$.fn.datepicker=function(options){if(!this.length){return this;}
if(!$.datepicker.initialized){$(document).on("mousedown",$.datepicker._checkExternalClick);$.datepicker.initialized=true;}
if($("#"+$.datepicker._mainDivId).length===0){$("body").append($.datepicker.dpDiv);}
var otherArgs=Array.prototype.slice.call(arguments,1);if(typeof options==="string"&&(options==="isDisabled"||options==="getDate"||options==="widget")){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs));}
if(options==="option"&&arguments.length===2&&typeof arguments[1]==="string"){return $.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs));}
return this.each(function(){typeof options==="string"?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options);});};$.datepicker=new Datepicker();$.datepicker.initialized=false;$.datepicker.uuid=new Date().getTime();$.datepicker.version="1.12.1";var widgetsDatepicker=$.datepicker;var ie=$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var mouseHandled=false;$(document).on("mouseup",function(){mouseHandled=false;});var widgetsMouse=$.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.on("mousedown."+this.widgetName,function(event){return that._mouseDown(event);}).on("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.off("."+this.widgetName);if(this._mouseMoveDelegate){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}
this._mouseMoved=false;(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}
this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}
if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent");}
this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}else if(!event.which){if(event.originalEvent.altKey||event.originalEvent.ctrlKey||event.originalEvent.metaKey||event.originalEvent.shiftKey){this.ignoreMissingWhich=true;}else if(!this.ignoreMissingWhich){return this._mouseUp(event);}}}
if(event.which||event.button){this._mouseMoved=true;}
if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}
if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}
return!this._mouseStarted;},_mouseUp:function(event){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true);}
this._mouseStop(event);}
if(this._mouseDelayTimer){clearTimeout(this._mouseDelayTimer);delete this._mouseDelayTimer;}
this.ignoreMissingWhich=false;mouseHandled=false;event.preventDefault();},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});var plugin=$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(!set){return;}
if(!allowDisconnected&&(!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11)){return;}
for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}};var safeBlur=$.ui.safeBlur=function(element){if(element&&element.nodeName.toLowerCase()!=="body"){$(element).trigger("blur");}};$.widget("ui.draggable",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false,drag:null,start:null,stop:null},_create:function(){if(this.options.helper==="original"){this._setPositionRelative();}
if(this.options.addClasses){this._addClass("ui-draggable");}
this._setHandleClassName();this._mouseInit();},_setOption:function(key,value){this._super(key,value);if(key==="handle"){this._removeHandleClassName();this._setHandleClassName();}},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging")){this.destroyOnClear=true;return;}
this._removeHandleClassName();this._mouseDestroy();},_mouseCapture:function(event){var o=this.options;if(this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0){return false;}
this.handle=this._getHandle(event);if(!this.handle){return false;}
this._blurActiveElement(event);this._blockFrames(o.iframeFix===true?"iframe":o.iframeFix);return true;},_blockFrames:function(selector){this.iframeBlocks=this.document.find(selector).map(function(){var iframe=$(this);return $("<div>").css("position","absolute").appendTo(iframe.parent()).outerWidth(iframe.outerWidth()).outerHeight(iframe.outerHeight()).offset(iframe.offset())[0];});},_unblockFrames:function(){if(this.iframeBlocks){this.iframeBlocks.remove();delete this.iframeBlocks;}},_blurActiveElement:function(event){var activeElement=$.ui.safeActiveElement(this.document[0]),target=$(event.target);if(target.closest(activeElement).length){return;}
$.ui.safeBlur(activeElement);},_mouseStart:function(event){var o=this.options;this.helper=this._createHelper(event);this._addClass(this.helper,"ui-draggable-dragging");this._cacheHelperProportions();if($.ui.ddmanager){$.ui.ddmanager.current=this;}
this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent(true);this.offsetParent=this.helper.offsetParent();this.hasFixedAncestor=this.helper.parents().filter(function(){return $(this).css("position")==="fixed";}).length>0;this.positionAbs=this.element.offset();this._refreshOffsets(event);this.originalPosition=this.position=this._generatePosition(event,false);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this._setContainment();if(this._trigger("start",event)===false){this._clear();return false;}
this._cacheHelperProportions();if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this._mouseDrag(event,true);if($.ui.ddmanager){$.ui.ddmanager.dragStart(this,event);}
return true;},_refreshOffsets:function(event){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:false,parent:this._getParentOffset(),relative:this._getRelativeOffset()};this.offset.click={left:event.pageX-this.offset.left,top:event.pageY-this.offset.top};},_mouseDrag:function(event,noPropagation){if(this.hasFixedAncestor){this.offset.parent=this._getParentOffset();}
this.position=this._generatePosition(event,true);this.positionAbs=this._convertPositionTo("absolute");if(!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===false){this._mouseUp(new $.Event("mouseup",event));return false;}
this.position=ui.position;}
this.helper[0].style.left=this.position.left+"px";this.helper[0].style.top=this.position.top+"px";if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
return false;},_mouseStop:function(event){var that=this,dropped=false;if($.ui.ddmanager&&!this.options.dropBehaviour){dropped=$.ui.ddmanager.drop(this,event);}
if(this.dropped){dropped=this.dropped;this.dropped=false;}
if((this.options.revert==="invalid"&&!dropped)||(this.options.revert==="valid"&&dropped)||this.options.revert===true||($.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped))){$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){if(that._trigger("stop",event)!==false){that._clear();}});}else{if(this._trigger("stop",event)!==false){this._clear();}}
return false;},_mouseUp:function(event){this._unblockFrames();if($.ui.ddmanager){$.ui.ddmanager.dragStop(this,event);}
if(this.handleElement.is(event.target)){this.element.trigger("focus");}
return $.ui.mouse.prototype._mouseUp.call(this,event);},cancel:function(){if(this.helper.is(".ui-draggable-dragging")){this._mouseUp(new $.Event("mouseup",{target:this.element[0]}));}else{this._clear();}
return this;},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:true;},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element;this._addClass(this.handleElement,"ui-draggable-handle");},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle");},_createHelper:function(event){var o=this.options,helperIsFunction=$.isFunction(o.helper),helper=helperIsFunction?$(o.helper.apply(this.element[0],[event])):(o.helper==="clone"?this.element.clone().removeAttr("id"):this.element);if(!helper.parents("body").length){helper.appendTo((o.appendTo==="parent"?this.element[0].parentNode:o.appendTo));}
if(helperIsFunction&&helper[0]===this.element[0]){this._setPositionRelative();}
if(helper[0]!==this.element[0]&&!(/(fixed|absolute)/).test(helper.css("position"))){helper.css("position","absolute");}
return helper;},_setPositionRelative:function(){if(!(/^(?:r|a|f)/).test(this.element.css("position"))){this.element[0].style.position="relative";}},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ");}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if("left"in obj){this.offset.click.left=obj.left+this.margins.left;}
if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if("top"in obj){this.offset.click.top=obj.top+this.margins.top;}
if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_isRootNode:function(element){return(/(html|body)/i).test(element.tagName)||element===this.document[0];},_getParentOffset:function(){var po=this.offsetParent.offset(),document=this.document[0];if(this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this._isRootNode(this.offsetParent[0])){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition!=="relative"){return{top:0,left:0};}
var p=this.element.position(),scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+
(!scrollIsRootNode?this.scrollParent.scrollTop():0),left:p.left-(parseInt(this.helper.css("left"),10)||0)+
(!scrollIsRootNode?this.scrollParent.scrollLeft():0)};},_cacheMargins:function(){this.margins={left:(parseInt(this.element.css("marginLeft"),10)||0),top:(parseInt(this.element.css("marginTop"),10)||0),right:(parseInt(this.element.css("marginRight"),10)||0),bottom:(parseInt(this.element.css("marginBottom"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var isUserScrollable,c,ce,o=this.options,document=this.document[0];this.relativeContainer=null;if(!o.containment){this.containment=null;return;}
if(o.containment==="window"){this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-
this.helperProportions.width-this.margins.left,$(window).scrollTop()+
($(window).height()||document.body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];return;}
if(o.containment==="document"){this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-
this.helperProportions.height-this.margins.top];return;}
if(o.containment.constructor===Array){this.containment=o.containment;return;}
if(o.containment==="parent"){o.containment=this.helper[0].parentNode;}
c=$(o.containment);ce=c[0];if(!ce){return;}
isUserScrollable=/(scroll|auto)/.test(c.css("overflow"));this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+
(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+
(parseInt(c.css("paddingTop"),10)||0),(isUserScrollable?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-
(parseInt(c.css("borderRightWidth"),10)||0)-
(parseInt(c.css("paddingRight"),10)||0)-
this.helperProportions.width-
this.margins.left-
this.margins.right,(isUserScrollable?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-
(parseInt(c.css("borderBottomWidth"),10)||0)-
(parseInt(c.css("paddingBottom"),10)||0)-
this.helperProportions.height-
this.margins.top-
this.margins.bottom];this.relativeContainer=c;},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==="absolute"?1:-1,scrollIsRootNode=this._isRootNode(this.scrollParent[0]);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==="fixed"?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==="fixed"?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left))*mod))};},_generatePosition:function(event,constrainPosition){var containment,co,top,left,o=this.options,scrollIsRootNode=this._isRootNode(this.scrollParent[0]),pageX=event.pageX,pageY=event.pageY;if(!scrollIsRootNode||!this.offset.scroll){this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()};}
if(constrainPosition){if(this.containment){if(this.relativeContainer){co=this.relativeContainer.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top];}else{containment=this.containment;}
if(event.pageX-this.offset.click.left<containment[0]){pageX=containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<containment[1]){pageY=containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>containment[2]){pageX=containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>containment[3]){pageY=containment[3]+this.offset.click.top;}}
if(o.grid){top=o.grid[1]?this.originalPageY+Math.round((pageY-
this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment?((top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3])?top:((top-this.offset.click.top>=containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=o.grid[0]?this.originalPageX+
Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment?((left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2])?left:((left-this.offset.click.left>=containment[0])?left-o.grid[0]:left+o.grid[0])):left;}
if(o.axis==="y"){pageX=this.originalPageX;}
if(o.axis==="x"){pageY=this.originalPageY;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
(this.cssPosition==="fixed"?-this.offset.scroll.top:(scrollIsRootNode?0:this.offset.scroll.top))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
(this.cssPosition==="fixed"?-this.offset.scroll.left:(scrollIsRootNode?0:this.offset.scroll.left)))};},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging");if(this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval){this.helper.remove();}
this.helper=null;this.cancelHelperRemoval=false;if(this.destroyOnClear){this.destroy();}},_trigger:function(type,event,ui){ui=ui||this._uiHash();$.ui.plugin.call(this,type,[event,ui,this],true);if(/^(drag|start|stop)/.test(type)){this.positionAbs=this._convertPositionTo("absolute");ui.offset=this.positionAbs;}
return $.Widget.prototype._trigger.call(this,type,event,ui);},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.sortables=[];$(draggable.options.connectToSortable).each(function(){var sortable=$(this).sortable("instance");if(sortable&&!sortable.options.disabled){draggable.sortables.push(sortable);sortable.refreshPositions();sortable._trigger("activate",event,uiSortable);}});},stop:function(event,ui,draggable){var uiSortable=$.extend({},ui,{item:draggable.element});draggable.cancelHelperRemoval=false;$.each(draggable.sortables,function(){var sortable=this;if(sortable.isOver){sortable.isOver=0;draggable.cancelHelperRemoval=true;sortable.cancelHelperRemoval=false;sortable._storedCSS={position:sortable.placeholder.css("position"),top:sortable.placeholder.css("top"),left:sortable.placeholder.css("left")};sortable._mouseStop(event);sortable.options.helper=sortable.options._helper;}else{sortable.cancelHelperRemoval=true;sortable._trigger("deactivate",event,uiSortable);}});},drag:function(event,ui,draggable){$.each(draggable.sortables,function(){var innermostIntersecting=false,sortable=this;sortable.positionAbs=draggable.positionAbs;sortable.helperProportions=draggable.helperProportions;sortable.offset.click=draggable.offset.click;if(sortable._intersectsWith(sortable.containerCache)){innermostIntersecting=true;$.each(draggable.sortables,function(){this.positionAbs=draggable.positionAbs;this.helperProportions=draggable.helperProportions;this.offset.click=draggable.offset.click;if(this!==sortable&&this._intersectsWith(this.containerCache)&&$.contains(sortable.element[0],this.element[0])){innermostIntersecting=false;}
return innermostIntersecting;});}
if(innermostIntersecting){if(!sortable.isOver){sortable.isOver=1;draggable._parent=ui.helper.parent();sortable.currentItem=ui.helper.appendTo(sortable.element).data("ui-sortable-item",true);sortable.options._helper=sortable.options.helper;sortable.options.helper=function(){return ui.helper[0];};event.target=sortable.currentItem[0];sortable._mouseCapture(event,true);sortable._mouseStart(event,true,true);sortable.offset.click.top=draggable.offset.click.top;sortable.offset.click.left=draggable.offset.click.left;sortable.offset.parent.left-=draggable.offset.parent.left-
sortable.offset.parent.left;sortable.offset.parent.top-=draggable.offset.parent.top-
sortable.offset.parent.top;draggable._trigger("toSortable",event);draggable.dropped=sortable.element;$.each(draggable.sortables,function(){this.refreshPositions();});draggable.currentItem=draggable.element;sortable.fromOutside=draggable;}
if(sortable.currentItem){sortable._mouseDrag(event);ui.position=sortable.position;}}else{if(sortable.isOver){sortable.isOver=0;sortable.cancelHelperRemoval=true;sortable.options._revert=sortable.options.revert;sortable.options.revert=false;sortable._trigger("out",event,sortable._uiHash(sortable));sortable._mouseStop(event,true);sortable.options.revert=sortable.options._revert;sortable.options.helper=sortable.options._helper;if(sortable.placeholder){sortable.placeholder.remove();}
ui.helper.appendTo(draggable._parent);draggable._refreshOffsets(event);ui.position=draggable._generatePosition(event,true);draggable._trigger("fromSortable",event);draggable.dropped=false;$.each(draggable.sortables,function(){this.refreshPositions();});}}});}});$.ui.plugin.add("draggable","cursor",{start:function(event,ui,instance){var t=$("body"),o=instance.options;if(t.css("cursor")){o._cursor=t.css("cursor");}
t.css("cursor",o.cursor);},stop:function(event,ui,instance){var o=instance.options;if(o._cursor){$("body").css("cursor",o._cursor);}}});$.ui.plugin.add("draggable","opacity",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("opacity")){o._opacity=t.css("opacity");}
t.css("opacity",o.opacity);},stop:function(event,ui,instance){var o=instance.options;if(o._opacity){$(ui.helper).css("opacity",o._opacity);}}});$.ui.plugin.add("draggable","scroll",{start:function(event,ui,i){if(!i.scrollParentNotHidden){i.scrollParentNotHidden=i.helper.scrollParent(false);}
if(i.scrollParentNotHidden[0]!==i.document[0]&&i.scrollParentNotHidden[0].tagName!=="HTML"){i.overflowOffset=i.scrollParentNotHidden.offset();}},drag:function(event,ui,i){var o=i.options,scrolled=false,scrollParent=i.scrollParentNotHidden[0],document=i.document[0];if(scrollParent!==document&&scrollParent.tagName!=="HTML"){if(!o.axis||o.axis!=="x"){if((i.overflowOffset.top+scrollParent.offsetHeight)-event.pageY<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop+o.scrollSpeed;}else if(event.pageY-i.overflowOffset.top<o.scrollSensitivity){scrollParent.scrollTop=scrolled=scrollParent.scrollTop-o.scrollSpeed;}}
if(!o.axis||o.axis!=="y"){if((i.overflowOffset.left+scrollParent.offsetWidth)-event.pageX<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft+o.scrollSpeed;}else if(event.pageX-i.overflowOffset.left<o.scrollSensitivity){scrollParent.scrollLeft=scrolled=scrollParent.scrollLeft-o.scrollSpeed;}}}else{if(!o.axis||o.axis!=="x"){if(event.pageY-$(document).scrollTop()<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed);}else if($(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity){scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed);}}
if(!o.axis||o.axis!=="y"){if(event.pageX-$(document).scrollLeft()<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed);}else if($(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity){scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed);}}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(i,event);}}});$.ui.plugin.add("draggable","snap",{start:function(event,ui,i){var o=i.options;i.snapElements=[];$(o.snap.constructor!==String?(o.snap.items||":data(ui-draggable)"):o.snap).each(function(){var $t=$(this),$o=$t.offset();if(this!==i.element[0]){i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left});}});},drag:function(event,ui,inst){var ts,bs,ls,rs,l,r,t,b,i,first,o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--){l=inst.snapElements[i].left-inst.margins.left;r=l+inst.snapElements[i].width;t=inst.snapElements[i].top-inst.margins.top;b=t+inst.snapElements[i].height;if(x2<l-d||x1>r+d||y2<t-d||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)){if(inst.snapElements[i].snapping){(inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=false;continue;}
if(o.snapMode!=="inner"){ts=Math.abs(t-y2)<=d;bs=Math.abs(b-y1)<=d;ls=Math.abs(l-x2)<=d;rs=Math.abs(r-x1)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left;}}
first=(ts||bs||ls||rs);if(o.snapMode!=="outer"){ts=Math.abs(t-y1)<=d;bs=Math.abs(b-y2)<=d;ls=Math.abs(l-x1)<=d;rs=Math.abs(r-x2)<=d;if(ts){ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top;}
if(bs){ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top;}
if(ls){ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left;}
if(rs){ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left;}}
if(!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)){(inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})));}
inst.snapElements[i].snapping=(ts||bs||ls||rs||first);}}});$.ui.plugin.add("draggable","stack",{start:function(event,ui,instance){var min,o=instance.options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-
(parseInt($(b).css("zIndex"),10)||0);});if(!group.length){return;}
min=parseInt($(group[0]).css("zIndex"),10)||0;$(group).each(function(i){$(this).css("zIndex",min+i);});this.css("zIndex",(min+group.length));}});$.ui.plugin.add("draggable","zIndex",{start:function(event,ui,instance){var t=$(ui.helper),o=instance.options;if(t.css("zIndex")){o._zIndex=t.css("zIndex");}
t.css("zIndex",o.zIndex);},stop:function(event,ui,instance){var o=instance.options;if(o._zIndex){$(ui.helper).css("zIndex",o._zIndex);}}});var widgetsDraggable=$.ui.draggable;$.widget("ui.resizable",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(value){return parseFloat(value)||0;},_isNumber:function(value){return!isNaN(parseFloat(value));},_hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}
var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}
el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;},_create:function(){var margins,o=this.options,that=this;this._addClass("ui-resizable");$.extend(this,{_aspectRatio:!!(o.aspectRatio),aspectRatio:o.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:o.helper||o.ghost||o.animate?o.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)){this.element.wrap($("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance"));this.elementIsWrapper=true;margins={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")};this.element.css(margins);this.originalElement.css("margin",0);this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css(margins);this._proportionallyResize();}
this._setupHandles();if(o.autoHide){$(this.element).on("mouseenter",function(){if(o.disabled){return;}
that._removeClass("ui-resizable-autohide");that._handles.show();}).on("mouseleave",function(){if(o.disabled){return;}
if(!that.resizing){that._addClass("ui-resizable-autohide");that._handles.hide();}});}
this._mouseInit();},_destroy:function(){this._mouseDestroy();var wrapper,_destroy=function(exp){$(exp).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove();};if(this.elementIsWrapper){_destroy(this.element);wrapper=this.element;this.originalElement.css({position:wrapper.css("position"),width:wrapper.outerWidth(),height:wrapper.outerHeight(),top:wrapper.css("top"),left:wrapper.css("left")}).insertAfter(wrapper);wrapper.remove();}
this.originalElement.css("resize",this.originalResizeStyle);_destroy(this.originalElement);return this;},_setOption:function(key,value){this._super(key,value);switch(key){case"handles":this._removeHandles();this._setupHandles();break;default:break;}},_setupHandles:function(){var o=this.options,handle,i,n,hname,axis,that=this;this.handles=o.handles||(!$(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});this._handles=$();if(this.handles.constructor===String){if(this.handles==="all"){this.handles="n,e,s,w,se,sw,ne,nw";}
n=this.handles.split(",");this.handles={};for(i=0;i<n.length;i++){handle=$.trim(n[i]);hname="ui-resizable-"+handle;axis=$("<div>");this._addClass(axis,"ui-resizable-handle "+hname);axis.css({zIndex:o.zIndex});this.handles[handle]=".ui-resizable-"+handle;this.element.append(axis);}}
this._renderAxis=function(target){var i,axis,padPos,padWrapper;target=target||this.element;for(i in this.handles){if(this.handles[i].constructor===String){this.handles[i]=this.element.children(this.handles[i]).first().show();}else if(this.handles[i].jquery||this.handles[i].nodeType){this.handles[i]=$(this.handles[i]);this._on(this.handles[i],{"mousedown":that._mouseDown});}
if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)){axis=$(this.handles[i],this.element);padWrapper=/sw|ne|nw|se|n|s/.test(i)?axis.outerHeight():axis.outerWidth();padPos=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");target.css(padPos,padWrapper);this._proportionallyResize();}
this._handles=this._handles.add(this.handles[i]);}};this._renderAxis(this.element);this._handles=this._handles.add(this.element.find(".ui-resizable-handle"));this._handles.disableSelection();this._handles.on("mouseover",function(){if(!that.resizing){if(this.className){axis=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);}
that.axis=axis&&axis[1]?axis[1]:"se";}});if(o.autoHide){this._handles.hide();this._addClass("ui-resizable-autohide");}},_removeHandles:function(){this._handles.remove();},_mouseCapture:function(event){var i,handle,capture=false;for(i in this.handles){handle=$(this.handles[i])[0];if(handle===event.target||$.contains(handle,event.target)){capture=true;}}
return!this.options.disabled&&capture;},_mouseStart:function(event){var curleft,curtop,cursor,o=this.options,el=this.element;this.resizing=true;this._renderProxy();curleft=this._num(this.helper.css("left"));curtop=this._num(this.helper.css("top"));if(o.containment){curleft+=$(o.containment).scrollLeft()||0;curtop+=$(o.containment).scrollTop()||0;}
this.offset=this.helper.offset();this.position={left:curleft,top:curtop};this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:el.width(),height:el.height()};this.originalSize=this._helper?{width:el.outerWidth(),height:el.outerHeight()}:{width:el.width(),height:el.height()};this.sizeDiff={width:el.outerWidth()-el.width(),height:el.outerHeight()-el.height()};this.originalPosition={left:curleft,top:curtop};this.originalMousePosition={left:event.pageX,top:event.pageY};this.aspectRatio=(typeof o.aspectRatio==="number")?o.aspectRatio:((this.originalSize.width/this.originalSize.height)||1);cursor=$(".ui-resizable-"+this.axis).css("cursor");$("body").css("cursor",cursor==="auto"?this.axis+"-resize":cursor);this._addClass("ui-resizable-resizing");this._propagate("start",event);return true;},_mouseDrag:function(event){var data,props,smp=this.originalMousePosition,a=this.axis,dx=(event.pageX-smp.left)||0,dy=(event.pageY-smp.top)||0,trigger=this._change[a];this._updatePrevProperties();if(!trigger){return false;}
data=trigger.apply(this,[event,dx,dy]);this._updateVirtualBoundaries(event.shiftKey);if(this._aspectRatio||event.shiftKey){data=this._updateRatio(data,event);}
data=this._respectSize(data,event);this._updateCache(data);this._propagate("resize",event);props=this._applyChanges();if(!this._helper&&this._proportionallyResizeElements.length){this._proportionallyResize();}
if(!$.isEmptyObject(props)){this._updatePrevProperties();this._trigger("resize",event,this.ui());this._applyChanges();}
return false;},_mouseStop:function(event){this.resizing=false;var pr,ista,soffseth,soffsetw,s,left,top,o=this.options,that=this;if(this._helper){pr=this._proportionallyResizeElements;ista=pr.length&&(/textarea/i).test(pr[0].nodeName);soffseth=ista&&this._hasScroll(pr[0],"left")?0:that.sizeDiff.height;soffsetw=ista?0:that.sizeDiff.width;s={width:(that.helper.width()-soffsetw),height:(that.helper.height()-soffseth)};left=(parseFloat(that.element.css("left"))+
(that.position.left-that.originalPosition.left))||null;top=(parseFloat(that.element.css("top"))+
(that.position.top-that.originalPosition.top))||null;if(!o.animate){this.element.css($.extend(s,{top:top,left:left}));}
that.helper.height(that.size.height);that.helper.width(that.size.width);if(this._helper&&!o.animate){this._proportionallyResize();}}
$("body").css("cursor","auto");this._removeClass("ui-resizable-resizing");this._propagate("stop",event);if(this._helper){this.helper.remove();}
return false;},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left};this.prevSize={width:this.size.width,height:this.size.height};},_applyChanges:function(){var props={};if(this.position.top!==this.prevPosition.top){props.top=this.position.top+"px";}
if(this.position.left!==this.prevPosition.left){props.left=this.position.left+"px";}
if(this.size.width!==this.prevSize.width){props.width=this.size.width+"px";}
if(this.size.height!==this.prevSize.height){props.height=this.size.height+"px";}
this.helper.css(props);return props;},_updateVirtualBoundaries:function(forceAspectRatio){var pMinWidth,pMaxWidth,pMinHeight,pMaxHeight,b,o=this.options;b={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:Infinity,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:Infinity};if(this._aspectRatio||forceAspectRatio){pMinWidth=b.minHeight*this.aspectRatio;pMinHeight=b.minWidth/this.aspectRatio;pMaxWidth=b.maxHeight*this.aspectRatio;pMaxHeight=b.maxWidth/this.aspectRatio;if(pMinWidth>b.minWidth){b.minWidth=pMinWidth;}
if(pMinHeight>b.minHeight){b.minHeight=pMinHeight;}
if(pMaxWidth<b.maxWidth){b.maxWidth=pMaxWidth;}
if(pMaxHeight<b.maxHeight){b.maxHeight=pMaxHeight;}}
this._vBoundaries=b;},_updateCache:function(data){this.offset=this.helper.offset();if(this._isNumber(data.left)){this.position.left=data.left;}
if(this._isNumber(data.top)){this.position.top=data.top;}
if(this._isNumber(data.height)){this.size.height=data.height;}
if(this._isNumber(data.width)){this.size.width=data.width;}},_updateRatio:function(data){var cpos=this.position,csize=this.size,a=this.axis;if(this._isNumber(data.height)){data.width=(data.height*this.aspectRatio);}else if(this._isNumber(data.width)){data.height=(data.width/this.aspectRatio);}
if(a==="sw"){data.left=cpos.left+(csize.width-data.width);data.top=null;}
if(a==="nw"){data.top=cpos.top+(csize.height-data.height);data.left=cpos.left+(csize.width-data.width);}
return data;},_respectSize:function(data){var o=this._vBoundaries,a=this.axis,ismaxw=this._isNumber(data.width)&&o.maxWidth&&(o.maxWidth<data.width),ismaxh=this._isNumber(data.height)&&o.maxHeight&&(o.maxHeight<data.height),isminw=this._isNumber(data.width)&&o.minWidth&&(o.minWidth>data.width),isminh=this._isNumber(data.height)&&o.minHeight&&(o.minHeight>data.height),dw=this.originalPosition.left+this.originalSize.width,dh=this.originalPosition.top+this.originalSize.height,cw=/sw|nw|w/.test(a),ch=/nw|ne|n/.test(a);if(isminw){data.width=o.minWidth;}
if(isminh){data.height=o.minHeight;}
if(ismaxw){data.width=o.maxWidth;}
if(ismaxh){data.height=o.maxHeight;}
if(isminw&&cw){data.left=dw-o.minWidth;}
if(ismaxw&&cw){data.left=dw-o.maxWidth;}
if(isminh&&ch){data.top=dh-o.minHeight;}
if(ismaxh&&ch){data.top=dh-o.maxHeight;}
if(!data.width&&!data.height&&!data.left&&data.top){data.top=null;}else if(!data.width&&!data.height&&!data.top&&data.left){data.left=null;}
return data;},_getPaddingPlusBorderDimensions:function(element){var i=0,widths=[],borders=[element.css("borderTopWidth"),element.css("borderRightWidth"),element.css("borderBottomWidth"),element.css("borderLeftWidth")],paddings=[element.css("paddingTop"),element.css("paddingRight"),element.css("paddingBottom"),element.css("paddingLeft")];for(;i<4;i++){widths[i]=(parseFloat(borders[i])||0);widths[i]+=(parseFloat(paddings[i])||0);}
return{height:widths[0]+widths[2],width:widths[1]+widths[3]};},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length){return;}
var prel,i=0,element=this.helper||this.element;for(;i<this._proportionallyResizeElements.length;i++){prel=this._proportionallyResizeElements[i];if(!this.outerDimensions){this.outerDimensions=this._getPaddingPlusBorderDimensions(prel);}
prel.css({height:(element.height()-this.outerDimensions.height)||0,width:(element.width()-this.outerDimensions.width)||0});}},_renderProxy:function(){var el=this.element,o=this.options;this.elementOffset=el.offset();if(this._helper){this.helper=this.helper||$("<div style='overflow:hidden;'></div>");this._addClass(this.helper,this._helper);this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++o.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(event,dx){return{width:this.originalSize.width+dx};},w:function(event,dx){var cs=this.originalSize,sp=this.originalPosition;return{left:sp.left+dx,width:cs.width-dx};},n:function(event,dx,dy){var cs=this.originalSize,sp=this.originalPosition;return{top:sp.top+dy,height:cs.height-dy};},s:function(event,dx,dy){return{height:this.originalSize.height+dy};},se:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},sw:function(event,dx,dy){return $.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));},ne:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[event,dx,dy]));},nw:function(event,dx,dy){return $.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[event,dx,dy]));}},_propagate:function(n,event){$.ui.plugin.call(this,n,[event,this.ui()]);(n!=="resize"&&this._trigger(n,event,this.ui()));},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});$.ui.plugin.add("resizable","animate",{stop:function(event){var that=$(this).resizable("instance"),o=that.options,pr=that._proportionallyResizeElements,ista=pr.length&&(/textarea/i).test(pr[0].nodeName),soffseth=ista&&that._hasScroll(pr[0],"left")?0:that.sizeDiff.height,soffsetw=ista?0:that.sizeDiff.width,style={width:(that.size.width-soffsetw),height:(that.size.height-soffseth)},left=(parseFloat(that.element.css("left"))+
(that.position.left-that.originalPosition.left))||null,top=(parseFloat(that.element.css("top"))+
(that.position.top-that.originalPosition.top))||null;that.element.animate($.extend(style,top&&left?{top:top,left:left}:{}),{duration:o.animateDuration,easing:o.animateEasing,step:function(){var data={width:parseFloat(that.element.css("width")),height:parseFloat(that.element.css("height")),top:parseFloat(that.element.css("top")),left:parseFloat(that.element.css("left"))};if(pr&&pr.length){$(pr[0]).css({width:data.width,height:data.height});}
that._updateCache(data);that._propagate("resize",event);}});}});$.ui.plugin.add("resizable","containment",{start:function(){var element,p,co,ch,cw,width,height,that=$(this).resizable("instance"),o=that.options,el=that.element,oc=o.containment,ce=(oc instanceof $)?oc.get(0):(/parent/.test(oc))?el.parent().get(0):oc;if(!ce){return;}
that.containerElement=$(ce);if(/document/.test(oc)||oc===document){that.containerOffset={left:0,top:0};that.containerPosition={left:0,top:0};that.parentData={element:$(document),left:0,top:0,width:$(document).width(),height:$(document).height()||document.body.parentNode.scrollHeight};}else{element=$(ce);p=[];$(["Top","Right","Left","Bottom"]).each(function(i,name){p[i]=that._num(element.css("padding"+name));});that.containerOffset=element.offset();that.containerPosition=element.position();that.containerSize={height:(element.innerHeight()-p[3]),width:(element.innerWidth()-p[1])};co=that.containerOffset;ch=that.containerSize.height;cw=that.containerSize.width;width=(that._hasScroll(ce,"left")?ce.scrollWidth:cw);height=(that._hasScroll(ce)?ce.scrollHeight:ch);that.parentData={element:ce,left:co.left,top:co.top,width:width,height:height};}},resize:function(event){var woset,hoset,isParent,isOffsetRelative,that=$(this).resizable("instance"),o=that.options,co=that.containerOffset,cp=that.position,pRatio=that._aspectRatio||event.shiftKey,cop={top:0,left:0},ce=that.containerElement,continueResize=true;if(ce[0]!==document&&(/static/).test(ce.css("position"))){cop=co;}
if(cp.left<(that._helper?co.left:0)){that.size.width=that.size.width+
(that._helper?(that.position.left-co.left):(that.position.left-cop.left));if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}
that.position.left=o.helper?co.left:0;}
if(cp.top<(that._helper?co.top:0)){that.size.height=that.size.height+
(that._helper?(that.position.top-co.top):that.position.top);if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}
that.position.top=that._helper?co.top:0;}
isParent=that.containerElement.get(0)===that.element.parent().get(0);isOffsetRelative=/relative|absolute/.test(that.containerElement.css("position"));if(isParent&&isOffsetRelative){that.offset.left=that.parentData.left+that.position.left;that.offset.top=that.parentData.top+that.position.top;}else{that.offset.left=that.element.offset().left;that.offset.top=that.element.offset().top;}
woset=Math.abs(that.sizeDiff.width+
(that._helper?that.offset.left-cop.left:(that.offset.left-co.left)));hoset=Math.abs(that.sizeDiff.height+
(that._helper?that.offset.top-cop.top:(that.offset.top-co.top)));if(woset+that.size.width>=that.parentData.width){that.size.width=that.parentData.width-woset;if(pRatio){that.size.height=that.size.width/that.aspectRatio;continueResize=false;}}
if(hoset+that.size.height>=that.parentData.height){that.size.height=that.parentData.height-hoset;if(pRatio){that.size.width=that.size.height*that.aspectRatio;continueResize=false;}}
if(!continueResize){that.position.left=that.prevPosition.left;that.position.top=that.prevPosition.top;that.size.width=that.prevSize.width;that.size.height=that.prevSize.height;}},stop:function(){var that=$(this).resizable("instance"),o=that.options,co=that.containerOffset,cop=that.containerPosition,ce=that.containerElement,helper=$(that.helper),ho=helper.offset(),w=helper.outerWidth()-that.sizeDiff.width,h=helper.outerHeight()-that.sizeDiff.height;if(that._helper&&!o.animate&&(/relative/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}
if(that._helper&&!o.animate&&(/static/).test(ce.css("position"))){$(this).css({left:ho.left-cop.left-co.left,width:w,height:h});}}});$.ui.plugin.add("resizable","alsoResize",{start:function(){var that=$(this).resizable("instance"),o=that.options;$(o.alsoResize).each(function(){var el=$(this);el.data("ui-resizable-alsoresize",{width:parseFloat(el.width()),height:parseFloat(el.height()),left:parseFloat(el.css("left")),top:parseFloat(el.css("top"))});});},resize:function(event,ui){var that=$(this).resizable("instance"),o=that.options,os=that.originalSize,op=that.originalPosition,delta={height:(that.size.height-os.height)||0,width:(that.size.width-os.width)||0,top:(that.position.top-op.top)||0,left:(that.position.left-op.left)||0};$(o.alsoResize).each(function(){var el=$(this),start=$(this).data("ui-resizable-alsoresize"),style={},css=el.parents(ui.originalElement[0]).length?["width","height"]:["width","height","top","left"];$.each(css,function(i,prop){var sum=(start[prop]||0)+(delta[prop]||0);if(sum&&sum>=0){style[prop]=sum||null;}});el.css(style);});},stop:function(){$(this).removeData("ui-resizable-alsoresize");}});$.ui.plugin.add("resizable","ghost",{start:function(){var that=$(this).resizable("instance"),cs=that.size;that.ghost=that.originalElement.clone();that.ghost.css({opacity:0.25,display:"block",position:"relative",height:cs.height,width:cs.width,margin:0,left:0,top:0});that._addClass(that.ghost,"ui-resizable-ghost");if($.uiBackCompat!==false&&typeof that.options.ghost==="string"){that.ghost.addClass(this.options.ghost);}
that.ghost.appendTo(that.helper);},resize:function(){var that=$(this).resizable("instance");if(that.ghost){that.ghost.css({position:"relative",height:that.size.height,width:that.size.width});}},stop:function(){var that=$(this).resizable("instance");if(that.ghost&&that.helper){that.helper.get(0).removeChild(that.ghost.get(0));}}});$.ui.plugin.add("resizable","grid",{resize:function(){var outerDimensions,that=$(this).resizable("instance"),o=that.options,cs=that.size,os=that.originalSize,op=that.originalPosition,a=that.axis,grid=typeof o.grid==="number"?[o.grid,o.grid]:o.grid,gridX=(grid[0]||1),gridY=(grid[1]||1),ox=Math.round((cs.width-os.width)/gridX)*gridX,oy=Math.round((cs.height-os.height)/gridY)*gridY,newWidth=os.width+ox,newHeight=os.height+oy,isMaxWidth=o.maxWidth&&(o.maxWidth<newWidth),isMaxHeight=o.maxHeight&&(o.maxHeight<newHeight),isMinWidth=o.minWidth&&(o.minWidth>newWidth),isMinHeight=o.minHeight&&(o.minHeight>newHeight);o.grid=grid;if(isMinWidth){newWidth+=gridX;}
if(isMinHeight){newHeight+=gridY;}
if(isMaxWidth){newWidth-=gridX;}
if(isMaxHeight){newHeight-=gridY;}
if(/^(se|s|e)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;}else if(/^(ne)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.top=op.top-oy;}else if(/^(sw)$/.test(a)){that.size.width=newWidth;that.size.height=newHeight;that.position.left=op.left-ox;}else{if(newHeight-gridY<=0||newWidth-gridX<=0){outerDimensions=that._getPaddingPlusBorderDimensions(this);}
if(newHeight-gridY>0){that.size.height=newHeight;that.position.top=op.top-oy;}else{newHeight=gridY-outerDimensions.height;that.size.height=newHeight;that.position.top=op.top+os.height-newHeight;}
if(newWidth-gridX>0){that.size.width=newWidth;that.position.left=op.left-ox;}else{newWidth=gridX-outerDimensions.width;that.size.width=newWidth;that.position.left=op.left+os.width-newWidth;}}}});var widgetsResizable=$.ui.resizable;$.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:true,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:true,closeText:"Close",draggable:true,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:false,position:{my:"center",at:"center",of:window,collision:"fit",using:function(pos){var topOffset=$(this).css(pos).offset().top;if(topOffset<0){$(this).css("top",pos.top-topOffset);}}},resizable:true,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,width:true},resizableRelatedOptions:{maxHeight:true,maxWidth:true,minHeight:true,minWidth:true},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height};this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)};this.originalTitle=this.element.attr("title");if(this.options.title==null&&this.originalTitle!=null){this.options.title=this.originalTitle;}
if(this.options.disabled){this.options.disabled=false;}
this._createWrapper();this.element.show().removeAttr("title").appendTo(this.uiDialog);this._addClass("ui-dialog-content","ui-widget-content");this._createTitlebar();this._createButtonPane();if(this.options.draggable&&$.fn.draggable){this._makeDraggable();}
if(this.options.resizable&&$.fn.resizable){this._makeResizable();}
this._isOpen=false;this._trackFocus();},_init:function(){if(this.options.autoOpen){this.open();}},_appendTo:function(){var element=this.options.appendTo;if(element&&(element.jquery||element.nodeType)){return $(element);}
return this.document.find(element||"body").eq(0);},_destroy:function(){var next,originalPosition=this.originalPosition;this._untrackInstance();this._destroyOverlay();this.element.removeUniqueId().css(this.originalCss).detach();this.uiDialog.remove();if(this.originalTitle){this.element.attr("title",this.originalTitle);}
next=originalPosition.parent.children().eq(originalPosition.index);if(next.length&&next[0]!==this.element[0]){next.before(this.element);}else{originalPosition.parent.append(this.element);}},widget:function(){return this.uiDialog;},disable:$.noop,enable:$.noop,close:function(event){var that=this;if(!this._isOpen||this._trigger("beforeClose",event)===false){return;}
this._isOpen=false;this._focusedElement=null;this._destroyOverlay();this._untrackInstance();if(!this.opener.filter(":focusable").trigger("focus").length){$.ui.safeBlur($.ui.safeActiveElement(this.document[0]));}
this._hide(this.uiDialog,this.options.hide,function(){that._trigger("close",event);});},isOpen:function(){return this._isOpen;},moveToTop:function(){this._moveToTop();},_moveToTop:function(event,silent){var moved=false,zIndices=this.uiDialog.siblings(".ui-front:visible").map(function(){return+$(this).css("z-index");}).get(),zIndexMax=Math.max.apply(null,zIndices);if(zIndexMax>=+this.uiDialog.css("z-index")){this.uiDialog.css("z-index",zIndexMax+1);moved=true;}
if(moved&&!silent){this._trigger("focus",event);}
return moved;},open:function(){var that=this;if(this._isOpen){if(this._moveToTop()){this._focusTabbable();}
return;}
this._isOpen=true;this.opener=$($.ui.safeActiveElement(this.document[0]));this._size();this._position();this._createOverlay();this._moveToTop(null,true);if(this.overlay){this.overlay.css("z-index",this.uiDialog.css("z-index")-1);}
this._show(this.uiDialog,this.options.show,function(){that._focusTabbable();that._trigger("focus");});this._makeFocusTarget();this._trigger("open");},_focusTabbable:function(){var hasFocus=this._focusedElement;if(!hasFocus){hasFocus=this.element.find("[autofocus]");}
if(!hasFocus.length){hasFocus=this.element.find(":tabbable");}
if(!hasFocus.length){hasFocus=this.uiDialogButtonPane.find(":tabbable");}
if(!hasFocus.length){hasFocus=this.uiDialogTitlebarClose.filter(":tabbable");}
if(!hasFocus.length){hasFocus=this.uiDialog;}
hasFocus.eq(0).trigger("focus");},_keepFocus:function(event){function checkFocus(){var activeElement=$.ui.safeActiveElement(this.document[0]),isActive=this.uiDialog[0]===activeElement||$.contains(this.uiDialog[0],activeElement);if(!isActive){this._focusTabbable();}}
event.preventDefault();checkFocus.call(this);this._delay(checkFocus);},_createWrapper:function(){this.uiDialog=$("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo());this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front");this._on(this.uiDialog,{keydown:function(event){if(this.options.closeOnEscape&&!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===$.ui.keyCode.ESCAPE){event.preventDefault();this.close(event);return;}
if(event.keyCode!==$.ui.keyCode.TAB||event.isDefaultPrevented()){return;}
var tabbables=this.uiDialog.find(":tabbable"),first=tabbables.filter(":first"),last=tabbables.filter(":last");if((event.target===last[0]||event.target===this.uiDialog[0])&&!event.shiftKey){this._delay(function(){first.trigger("focus");});event.preventDefault();}else if((event.target===first[0]||event.target===this.uiDialog[0])&&event.shiftKey){this._delay(function(){last.trigger("focus");});event.preventDefault();}},mousedown:function(event){if(this._moveToTop(event)){this._focusTabbable();}}});if(!this.element.find("[aria-describedby]").length){this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")});}},_createTitlebar:function(){var uiDialogTitle;this.uiDialogTitlebar=$("<div>");this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix");this._on(this.uiDialogTitlebar,{mousedown:function(event){if(!$(event.target).closest(".ui-dialog-titlebar-close")){this.uiDialog.trigger("focus");}}});this.uiDialogTitlebarClose=$("<button type='button'></button>").button({label:$("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:false}).appendTo(this.uiDialogTitlebar);this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close");this._on(this.uiDialogTitlebarClose,{click:function(event){event.preventDefault();this.close(event);}});uiDialogTitle=$("<span>").uniqueId().prependTo(this.uiDialogTitlebar);this._addClass(uiDialogTitle,"ui-dialog-title");this._title(uiDialogTitle);this.uiDialogTitlebar.prependTo(this.uiDialog);this.uiDialog.attr({"aria-labelledby":uiDialogTitle.attr("id")});},_title:function(title){if(this.options.title){title.text(this.options.title);}else{title.html("&#160;");}},_createButtonPane:function(){this.uiDialogButtonPane=$("<div>");this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix");this.uiButtonSet=$("<div>").appendTo(this.uiDialogButtonPane);this._addClass(this.uiButtonSet,"ui-dialog-buttonset");this._createButtons();},_createButtons:function(){var that=this,buttons=this.options.buttons;this.uiDialogButtonPane.remove();this.uiButtonSet.empty();if($.isEmptyObject(buttons)||($.isArray(buttons)&&!buttons.length)){this._removeClass(this.uiDialog,"ui-dialog-buttons");return;}
$.each(buttons,function(name,props){var click,buttonOptions;props=$.isFunction(props)?{click:props,text:name}:props;props=$.extend({type:"button"},props);click=props.click;buttonOptions={icon:props.icon,iconPosition:props.iconPosition,showLabel:props.showLabel,icons:props.icons,text:props.text};delete props.click;delete props.icon;delete props.iconPosition;delete props.showLabel;delete props.icons;if(typeof props.text==="boolean"){delete props.text;}
$("<button></button>",props).button(buttonOptions).appendTo(that.uiButtonSet).on("click",function(){click.apply(that.element[0],arguments);});});this._addClass(this.uiDialog,"ui-dialog-buttons");this.uiDialogButtonPane.appendTo(this.uiDialog);},_makeDraggable:function(){var that=this,options=this.options;function filteredUi(ui){return{position:ui.position,offset:ui.offset};}
this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(event,ui){that._addClass($(this),"ui-dialog-dragging");that._blockFrames();that._trigger("dragStart",event,filteredUi(ui));},drag:function(event,ui){that._trigger("drag",event,filteredUi(ui));},stop:function(event,ui){var left=ui.offset.left-that.document.scrollLeft(),top=ui.offset.top-that.document.scrollTop();options.position={my:"left top",at:"left"+(left>=0?"+":"")+left+" "+"top"+(top>=0?"+":"")+top,of:that.window};that._removeClass($(this),"ui-dialog-dragging");that._unblockFrames();that._trigger("dragStop",event,filteredUi(ui));}});},_makeResizable:function(){var that=this,options=this.options,handles=options.resizable,position=this.uiDialog.css("position"),resizeHandles=typeof handles==="string"?handles:"n,e,s,w,se,sw,ne,nw";function filteredUi(ui){return{originalPosition:ui.originalPosition,originalSize:ui.originalSize,position:ui.position,size:ui.size};}
this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:options.maxWidth,maxHeight:options.maxHeight,minWidth:options.minWidth,minHeight:this._minHeight(),handles:resizeHandles,start:function(event,ui){that._addClass($(this),"ui-dialog-resizing");that._blockFrames();that._trigger("resizeStart",event,filteredUi(ui));},resize:function(event,ui){that._trigger("resize",event,filteredUi(ui));},stop:function(event,ui){var offset=that.uiDialog.offset(),left=offset.left-that.document.scrollLeft(),top=offset.top-that.document.scrollTop();options.height=that.uiDialog.height();options.width=that.uiDialog.width();options.position={my:"left top",at:"left"+(left>=0?"+":"")+left+" "+"top"+(top>=0?"+":"")+top,of:that.window};that._removeClass($(this),"ui-dialog-resizing");that._unblockFrames();that._trigger("resizeStop",event,filteredUi(ui));}}).css("position",position);},_trackFocus:function(){this._on(this.widget(),{focusin:function(event){this._makeFocusTarget();this._focusedElement=$(event.target);}});},_makeFocusTarget:function(){this._untrackInstance();this._trackingInstances().unshift(this);},_untrackInstance:function(){var instances=this._trackingInstances(),exists=$.inArray(this,instances);if(exists!==-1){instances.splice(exists,1);}},_trackingInstances:function(){var instances=this.document.data("ui-dialog-instances");if(!instances){instances=[];this.document.data("ui-dialog-instances",instances);}
return instances;},_minHeight:function(){var options=this.options;return options.height==="auto"?options.minHeight:Math.min(options.minHeight,options.height);},_position:function(){var isVisible=this.uiDialog.is(":visible");if(!isVisible){this.uiDialog.show();}
this.uiDialog.position(this.options.position);if(!isVisible){this.uiDialog.hide();}},_setOptions:function(options){var that=this,resize=false,resizableOptions={};$.each(options,function(key,value){that._setOption(key,value);if(key in that.sizeRelatedOptions){resize=true;}
if(key in that.resizableRelatedOptions){resizableOptions[key]=value;}});if(resize){this._size();this._position();}
if(this.uiDialog.is(":data(ui-resizable)")){this.uiDialog.resizable("option",resizableOptions);}},_setOption:function(key,value){var isDraggable,isResizable,uiDialog=this.uiDialog;if(key==="disabled"){return;}
this._super(key,value);if(key==="appendTo"){this.uiDialog.appendTo(this._appendTo());}
if(key==="buttons"){this._createButtons();}
if(key==="closeText"){this.uiDialogTitlebarClose.button({label:$("<a>").text(""+this.options.closeText).html()});}
if(key==="draggable"){isDraggable=uiDialog.is(":data(ui-draggable)");if(isDraggable&&!value){uiDialog.draggable("destroy");}
if(!isDraggable&&value){this._makeDraggable();}}
if(key==="position"){this._position();}
if(key==="resizable"){isResizable=uiDialog.is(":data(ui-resizable)");if(isResizable&&!value){uiDialog.resizable("destroy");}
if(isResizable&&typeof value==="string"){uiDialog.resizable("option","handles",value);}
if(!isResizable&&value!==false){this._makeResizable();}}
if(key==="title"){this._title(this.uiDialogTitlebar.find(".ui-dialog-title"));}},_size:function(){var nonContentHeight,minContentHeight,maxContentHeight,options=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0});if(options.minWidth>options.width){options.width=options.minWidth;}
nonContentHeight=this.uiDialog.css({height:"auto",width:options.width}).outerHeight();minContentHeight=Math.max(0,options.minHeight-nonContentHeight);maxContentHeight=typeof options.maxHeight==="number"?Math.max(0,options.maxHeight-nonContentHeight):"none";if(options.height==="auto"){this.element.css({minHeight:minContentHeight,maxHeight:maxContentHeight,height:"auto"});}else{this.element.height(Math.max(0,options.height-nonContentHeight));}
if(this.uiDialog.is(":data(ui-resizable)")){this.uiDialog.resizable("option","minHeight",this._minHeight());}},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var iframe=$(this);return $("<div>").css({position:"absolute",width:iframe.outerWidth(),height:iframe.outerHeight()}).appendTo(iframe.parent()).offset(iframe.offset())[0];});},_unblockFrames:function(){if(this.iframeBlocks){this.iframeBlocks.remove();delete this.iframeBlocks;}},_allowInteraction:function(event){if($(event.target).closest(".ui-dialog").length){return true;}
return!!$(event.target).closest(".ui-datepicker").length;},_createOverlay:function(){if(!this.options.modal){return;}
var isOpening=true;this._delay(function(){isOpening=false;});if(!this.document.data("ui-dialog-overlays")){this._on(this.document,{focusin:function(event){if(isOpening){return;}
if(!this._allowInteraction(event)){event.preventDefault();this._trackingInstances()[0]._focusTabbable();}}});}
this.overlay=$("<div>").appendTo(this._appendTo());this._addClass(this.overlay,null,"ui-widget-overlay ui-front");this._on(this.overlay,{mousedown:"_keepFocus"});this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1);},_destroyOverlay:function(){if(!this.options.modal){return;}
if(this.overlay){var overlays=this.document.data("ui-dialog-overlays")-1;if(!overlays){this._off(this.document,"focusin");this.document.removeData("ui-dialog-overlays");}else{this.document.data("ui-dialog-overlays",overlays);}
this.overlay.remove();this.overlay=null;}}});if($.uiBackCompat!==false){$.widget("ui.dialog",$.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super();this.uiDialog.addClass(this.options.dialogClass);},_setOption:function(key,value){if(key==="dialogClass"){this.uiDialog.removeClass(this.options.dialogClass).addClass(value);}
this._superApply(arguments);}});}
var widgetsDialog=$.ui.dialog;$.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:true,greedy:false,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var proportions,o=this.options,accept=o.accept;this.isover=false;this.isout=true;this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept);};this.proportions=function(){if(arguments.length){proportions=arguments[0];}else{return proportions?proportions:proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight};}};this._addToManager(o.scope);o.addClasses&&this._addClass("ui-droppable");},_addToManager:function(scope){$.ui.ddmanager.droppables[scope]=$.ui.ddmanager.droppables[scope]||[];$.ui.ddmanager.droppables[scope].push(this);},_splice:function(drop){var i=0;for(;i<drop.length;i++){if(drop[i]===this){drop.splice(i,1);}}},_destroy:function(){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);},_setOption:function(key,value){if(key==="accept"){this.accept=$.isFunction(value)?value:function(d){return d.is(value);};}else if(key==="scope"){var drop=$.ui.ddmanager.droppables[this.options.scope];this._splice(drop);this._addToManager(value);}
this._super(key,value);},_activate:function(event){var draggable=$.ui.ddmanager.current;this._addActiveClass();if(draggable){this._trigger("activate",event,this.ui(draggable));}},_deactivate:function(event){var draggable=$.ui.ddmanager.current;this._removeActiveClass();if(draggable){this._trigger("deactivate",event,this.ui(draggable));}},_over:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this._addHoverClass();this._trigger("over",event,this.ui(draggable));}},_out:function(event){var draggable=$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this._removeHoverClass();this._trigger("out",event,this.ui(draggable));}},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=false;if(!draggable||(draggable.currentItem||draggable.element)[0]===this.element[0]){return false;}
this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var inst=$(this).droppable("instance");if(inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],(draggable.currentItem||draggable.element))&&intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance,event)){childrenIntersection=true;return false;}});if(childrenIntersection){return false;}
if(this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this._removeActiveClass();this._removeHoverClass();this._trigger("drop",event,this.ui(draggable));return this.element;}
return false;},ui:function(c){return{draggable:(c.currentItem||c.element),helper:c.helper,position:c.position,offset:c.positionAbs};},_addHoverClass:function(){this._addClass("ui-droppable-hover");},_removeHoverClass:function(){this._removeClass("ui-droppable-hover");},_addActiveClass:function(){this._addClass("ui-droppable-active");},_removeActiveClass:function(){this._removeClass("ui-droppable-active");}});var intersect=$.ui.intersect=(function(){function isOverAxis(x,reference,size){return(x>=reference)&&(x<(reference+size));}
return function(draggable,droppable,toleranceMode,event){if(!droppable.offset){return false;}
var x1=(draggable.positionAbs||draggable.position.absolute).left+draggable.margins.left,y1=(draggable.positionAbs||draggable.position.absolute).top+draggable.margins.top,x2=x1+draggable.helperProportions.width,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,t=droppable.offset.top,r=l+droppable.proportions().width,b=t+droppable.proportions().height;switch(toleranceMode){case"fit":return(l<=x1&&x2<=r&&t<=y1&&y2<=b);case"intersect":return(l<x1+(draggable.helperProportions.width/2)&&x2-(draggable.helperProportions.width/2)<r&&t<y1+(draggable.helperProportions.height/2)&&y2-(draggable.helperProportions.height/2)<b);case"pointer":return isOverAxis(event.pageY,t,droppable.proportions().height)&&isOverAxis(event.pageX,l,droppable.proportions().width);case"touch":return((y1>=t&&y1<=b)||(y2>=t&&y2<=b)||(y1<t&&y2>b))&&((x1>=l&&x1<=r)||(x2>=l&&x2<=r)||(x1<l&&x2>r));default:return false;}};})();$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++){if(m[i].options.disabled||(t&&!m[i].accept.call(m[i].element[0],(t.currentItem||t.element)))){continue;}
for(j=0;j<list.length;j++){if(list[j]===m[i].element[0]){m[i].proportions().height=0;continue droppablesLoop;}}
m[i].visible=m[i].element.css("display")!=="none";if(!m[i].visible){continue;}
if(type==="mousedown"){m[i]._activate.call(m[i],event);}
m[i].offset=m[i].element.offset();m[i].proportions({width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight});}},drop:function(draggable,event){var dropped=false;$.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){if(!this.options){return;}
if(!this.options.disabled&&this.visible&&intersect(draggable,this,this.options.tolerance,event)){dropped=this._drop.call(this,event)||dropped;}
if(!this.options.disabled&&this.visible&&this.accept.call(this.element[0],(draggable.currentItem||draggable.element))){this.isout=true;this.isover=false;this._deactivate.call(this,event);}});return dropped;},dragStart:function(draggable,event){draggable.element.parentsUntil("body").on("scroll.droppable",function(){if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}});},drag:function(draggable,event){if(draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}
$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible){return;}
var parentInstance,scope,parent,intersects=intersect(draggable,this,this.options.tolerance,event),c=!intersects&&this.isover?"isout":(intersects&&!this.isover?"isover":null);if(!c){return;}
if(this.options.greedy){scope=this.options.scope;parent=this.element.parents(":data(ui-droppable)").filter(function(){return $(this).droppable("instance").options.scope===scope;});if(parent.length){parentInstance=$(parent[0]).droppable("instance");parentInstance.greedyChild=(c==="isover");}}
if(parentInstance&&c==="isover"){parentInstance.isover=false;parentInstance.isout=true;parentInstance._out.call(parentInstance,event);}
this[c]=true;this[c==="isout"?"isover":"isout"]=false;this[c==="isover"?"_over":"_out"].call(this,event);if(parentInstance&&c==="isout"){parentInstance.isout=false;parentInstance.isover=true;parentInstance._over.call(parentInstance,event);}});},dragStop:function(draggable,event){draggable.element.parentsUntil("body").off("scroll.droppable");if(!draggable.options.refreshPositions){$.ui.ddmanager.prepareOffsets(draggable,event);}}};if($.uiBackCompat!==false){$.widget("ui.droppable",$.ui.droppable,{options:{hoverClass:false,activeClass:false},_addActiveClass:function(){this._super();if(this.options.activeClass){this.element.addClass(this.options.activeClass);}},_removeActiveClass:function(){this._super();if(this.options.activeClass){this.element.removeClass(this.options.activeClass);}},_addHoverClass:function(){this._super();if(this.options.hoverClass){this.element.addClass(this.options.hoverClass);}},_removeHoverClass:function(){this._super();if(this.options.hoverClass){this.element.removeClass(this.options.hoverClass);}}});}
var widgetsDroppable=$.ui.droppable;var widgetsProgressbar=$.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue();this.element.attr({role:"progressbar","aria-valuemin":this.min});this._addClass("ui-progressbar","ui-widget ui-widget-content");this.valueDiv=$("<div>").appendTo(this.element);this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header");this._refreshValue();},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow");this.valueDiv.remove();},value:function(newValue){if(newValue===undefined){return this.options.value;}
this.options.value=this._constrainedValue(newValue);this._refreshValue();},_constrainedValue:function(newValue){if(newValue===undefined){newValue=this.options.value;}
this.indeterminate=newValue===false;if(typeof newValue!=="number"){newValue=0;}
return this.indeterminate?false:Math.min(this.options.max,Math.max(this.min,newValue));},_setOptions:function(options){var value=options.value;delete options.value;this._super(options);this.options.value=this._constrainedValue(value);this._refreshValue();},_setOption:function(key,value){if(key==="max"){value=Math.max(this.min,value);}
this._super(key,value);},_setOptionDisabled:function(value){this._super(value);this.element.attr("aria-disabled",value);this._toggleClass(null,"ui-state-disabled",!!value);},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min);},_refreshValue:function(){var value=this.options.value,percentage=this._percentage();this.valueDiv.toggle(this.indeterminate||value>this.min).width(percentage.toFixed(0)+"%");this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,value===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate);if(this.indeterminate){this.element.removeAttr("aria-valuenow");if(!this.overlayDiv){this.overlayDiv=$("<div>").appendTo(this.valueDiv);this._addClass(this.overlayDiv,"ui-progressbar-overlay");}}else{this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":value});if(this.overlayDiv){this.overlayDiv.remove();this.overlayDiv=null;}}
if(this.oldValue!==value){this.oldValue=value;this._trigger("change");}
if(value===this.options.max){this._trigger("complete");}}});var widgetsSelectable=$.widget("ui.selectable",$.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:true,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var that=this;this._addClass("ui-selectable");this.dragged=false;this.refresh=function(){that.elementPos=$(that.element[0]).offset();that.selectees=$(that.options.filter,that.element[0]);that._addClass(that.selectees,"ui-selectee");that.selectees.each(function(){var $this=$(this),selecteeOffset=$this.offset(),pos={left:selecteeOffset.left-that.elementPos.left,top:selecteeOffset.top-that.elementPos.top};$.data(this,"selectable-item",{element:this,$element:$this,left:pos.left,top:pos.top,right:pos.left+$this.outerWidth(),bottom:pos.top+$this.outerHeight(),startselected:false,selected:$this.hasClass("ui-selected"),selecting:$this.hasClass("ui-selecting"),unselecting:$this.hasClass("ui-unselecting")});});};this.refresh();this._mouseInit();this.helper=$("<div>");this._addClass(this.helper,"ui-selectable-helper");},_destroy:function(){this.selectees.removeData("selectable-item");this._mouseDestroy();},_mouseStart:function(event){var that=this,options=this.options;this.opos=[event.pageX,event.pageY];this.elementPos=$(this.element[0]).offset();if(this.options.disabled){return;}
this.selectees=$(options.filter,this.element[0]);this._trigger("start",event);$(options.appendTo).append(this.helper);this.helper.css({"left":event.pageX,"top":event.pageY,"width":0,"height":0});if(options.autoRefresh){this.refresh();}
this.selectees.filter(".ui-selected").each(function(){var selectee=$.data(this,"selectable-item");selectee.startselected=true;if(!event.metaKey&&!event.ctrlKey){that._removeClass(selectee.$element,"ui-selected");selectee.selected=false;that._addClass(selectee.$element,"ui-unselecting");selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}});$(event.target).parents().addBack().each(function(){var doSelect,selectee=$.data(this,"selectable-item");if(selectee){doSelect=(!event.metaKey&&!event.ctrlKey)||!selectee.$element.hasClass("ui-selected");that._removeClass(selectee.$element,doSelect?"ui-unselecting":"ui-selected")._addClass(selectee.$element,doSelect?"ui-selecting":"ui-unselecting");selectee.unselecting=!doSelect;selectee.selecting=doSelect;selectee.selected=doSelect;if(doSelect){that._trigger("selecting",event,{selecting:selectee.element});}else{that._trigger("unselecting",event,{unselecting:selectee.element});}
return false;}});},_mouseDrag:function(event){this.dragged=true;if(this.options.disabled){return;}
var tmp,that=this,options=this.options,x1=this.opos[0],y1=this.opos[1],x2=event.pageX,y2=event.pageY;if(x1>x2){tmp=x2;x2=x1;x1=tmp;}
if(y1>y2){tmp=y2;y2=y1;y1=tmp;}
this.helper.css({left:x1,top:y1,width:x2-x1,height:y2-y1});this.selectees.each(function(){var selectee=$.data(this,"selectable-item"),hit=false,offset={};if(!selectee||selectee.element===that.element[0]){return;}
offset.left=selectee.left+that.elementPos.left;offset.right=selectee.right+that.elementPos.left;offset.top=selectee.top+that.elementPos.top;offset.bottom=selectee.bottom+that.elementPos.top;if(options.tolerance==="touch"){hit=(!(offset.left>x2||offset.right<x1||offset.top>y2||offset.bottom<y1));}else if(options.tolerance==="fit"){hit=(offset.left>x1&&offset.right<x2&&offset.top>y1&&offset.bottom<y2);}
if(hit){if(selectee.selected){that._removeClass(selectee.$element,"ui-selected");selectee.selected=false;}
if(selectee.unselecting){that._removeClass(selectee.$element,"ui-unselecting");selectee.unselecting=false;}
if(!selectee.selecting){that._addClass(selectee.$element,"ui-selecting");selectee.selecting=true;that._trigger("selecting",event,{selecting:selectee.element});}}else{if(selectee.selecting){if((event.metaKey||event.ctrlKey)&&selectee.startselected){that._removeClass(selectee.$element,"ui-selecting");selectee.selecting=false;that._addClass(selectee.$element,"ui-selected");selectee.selected=true;}else{that._removeClass(selectee.$element,"ui-selecting");selectee.selecting=false;if(selectee.startselected){that._addClass(selectee.$element,"ui-unselecting");selectee.unselecting=true;}
that._trigger("unselecting",event,{unselecting:selectee.element});}}
if(selectee.selected){if(!event.metaKey&&!event.ctrlKey&&!selectee.startselected){that._removeClass(selectee.$element,"ui-selected");selectee.selected=false;that._addClass(selectee.$element,"ui-unselecting");selectee.unselecting=true;that._trigger("unselecting",event,{unselecting:selectee.element});}}}});return false;},_mouseStop:function(event){var that=this;this.dragged=false;$(".ui-unselecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");that._removeClass(selectee.$element,"ui-unselecting");selectee.unselecting=false;selectee.startselected=false;that._trigger("unselected",event,{unselected:selectee.element});});$(".ui-selecting",this.element[0]).each(function(){var selectee=$.data(this,"selectable-item");that._removeClass(selectee.$element,"ui-selecting")._addClass(selectee.$element,"ui-selected");selectee.selecting=false;selectee.selected=true;selectee.startselected=true;that._trigger("selected",event,{selected:selectee.element});});this._trigger("stop",event);this.helper.remove();return false;}});var widgetsSelectmenu=$.widget("ui.selectmenu",[$.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:false,change:null,close:null,focus:null,open:null,select:null},_create:function(){var selectmenuId=this.element.uniqueId().attr("id");this.ids={element:selectmenuId,button:selectmenuId+"-button",menu:selectmenuId+"-menu"};this._drawButton();this._drawMenu();this._bindFormResetHandler();this._rendered=false;this.menuItems=$();},_drawButton:function(){var icon,that=this,item=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button);this._on(this.labels,{click:function(event){this.button.focus();event.preventDefault();}});this.element.hide();this.button=$("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element);this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget");icon=$("<span>").appendTo(this.button);this._addClass(icon,"ui-selectmenu-icon","ui-icon "+this.options.icons.button);this.buttonItem=this._renderButtonItem(item).appendTo(this.button);if(this.options.width!==false){this._resizeButton();}
this._on(this.button,this._buttonEvents);this.button.one("focusin",function(){if(!that._rendered){that._refreshMenu();}});},_drawMenu:function(){var that=this;this.menu=$("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu});this.menuWrap=$("<div>").append(this.menu);this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front");this.menuWrap.appendTo(this._appendTo());this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(event,ui){event.preventDefault();that._setSelection();that._select(ui.item.data("ui-selectmenu-item"),event);},focus:function(event,ui){var item=ui.item.data("ui-selectmenu-item");if(that.focusIndex!=null&&item.index!==that.focusIndex){that._trigger("focus",event,{item:item});if(!that.isOpen){that._select(item,event);}}
that.focusIndex=item.index;that.button.attr("aria-activedescendant",that.menuItems.eq(item.index).attr("id"));}}).menu("instance");this.menuInstance._off(this.menu,"mouseleave");this.menuInstance._closeOnDocumentClick=function(){return false;};this.menuInstance._isDivider=function(){return false;};},refresh:function(){this._refreshMenu();this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{}));if(this.options.width===null){this._resizeButton();}},_refreshMenu:function(){var item,options=this.element.find("option");this.menu.empty();this._parseOptions(options);this._renderMenu(this.menu,this.items);this.menuInstance.refresh();this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper");this._rendered=true;if(!options.length){return;}
item=this._getSelectedItem();this.menuInstance.focus(null,item);this._setAria(item.data("ui-selectmenu-item"));this._setOption("disabled",this.element.prop("disabled"));},open:function(event){if(this.options.disabled){return;}
if(!this._rendered){this._refreshMenu();}else{this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active");this.menuInstance.focus(null,this._getSelectedItem());}
if(!this.menuItems.length){return;}
this.isOpen=true;this._toggleAttr();this._resizeMenu();this._position();this._on(this.document,this._documentClick);this._trigger("open",event);},_position:function(){this.menuWrap.position($.extend({of:this.button},this.options.position));},close:function(event){if(!this.isOpen){return;}
this.isOpen=false;this._toggleAttr();this.range=null;this._off(this.document);this._trigger("close",event);},widget:function(){return this.button;},menuWidget:function(){return this.menu;},_renderButtonItem:function(item){var buttonItem=$("<span>");this._setText(buttonItem,item.label);this._addClass(buttonItem,"ui-selectmenu-text");return buttonItem;},_renderMenu:function(ul,items){var that=this,currentOptgroup="";$.each(items,function(index,item){var li;if(item.optgroup!==currentOptgroup){li=$("<li>",{text:item.optgroup});that._addClass(li,"ui-selectmenu-optgroup","ui-menu-divider"+
(item.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""));li.appendTo(ul);currentOptgroup=item.optgroup;}
that._renderItemData(ul,item);});},_renderItemData:function(ul,item){return this._renderItem(ul,item).data("ui-selectmenu-item",item);},_renderItem:function(ul,item){var li=$("<li>"),wrapper=$("<div>",{title:item.element.attr("title")});if(item.disabled){this._addClass(li,null,"ui-state-disabled");}
this._setText(wrapper,item.label);return li.append(wrapper).appendTo(ul);},_setText:function(element,value){if(value){element.text(value);}else{element.html("&#160;");}},_move:function(direction,event){var item,next,filter=".ui-menu-item";if(this.isOpen){item=this.menuItems.eq(this.focusIndex).parent("li");}else{item=this.menuItems.eq(this.element[0].selectedIndex).parent("li");filter+=":not(.ui-state-disabled)";}
if(direction==="first"||direction==="last"){next=item[direction==="first"?"prevAll":"nextAll"](filter).eq(-1);}else{next=item[direction+"All"](filter).eq(0);}
if(next.length){this.menuInstance.focus(event,next);}},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li");},_toggle:function(event){this[this.isOpen?"close":"open"](event);},_setSelection:function(){var selection;if(!this.range){return;}
if(window.getSelection){selection=window.getSelection();selection.removeAllRanges();selection.addRange(this.range);}else{this.range.select();}
this.button.focus();},_documentClick:{mousedown:function(event){if(!this.isOpen){return;}
if(!$(event.target).closest(".ui-selectmenu-menu, #"+
$.ui.escapeSelector(this.ids.button)).length){this.close(event);}}},_buttonEvents:{mousedown:function(){var selection;if(window.getSelection){selection=window.getSelection();if(selection.rangeCount){this.range=selection.getRangeAt(0);}}else{this.range=document.selection.createRange();}},click:function(event){this._setSelection();this._toggle(event);},keydown:function(event){var preventDefault=true;switch(event.keyCode){case $.ui.keyCode.TAB:case $.ui.keyCode.ESCAPE:this.close(event);preventDefault=false;break;case $.ui.keyCode.ENTER:if(this.isOpen){this._selectFocusedItem(event);}
break;case $.ui.keyCode.UP:if(event.altKey){this._toggle(event);}else{this._move("prev",event);}
break;case $.ui.keyCode.DOWN:if(event.altKey){this._toggle(event);}else{this._move("next",event);}
break;case $.ui.keyCode.SPACE:if(this.isOpen){this._selectFocusedItem(event);}else{this._toggle(event);}
break;case $.ui.keyCode.LEFT:this._move("prev",event);break;case $.ui.keyCode.RIGHT:this._move("next",event);break;case $.ui.keyCode.HOME:case $.ui.keyCode.PAGE_UP:this._move("first",event);break;case $.ui.keyCode.END:case $.ui.keyCode.PAGE_DOWN:this._move("last",event);break;default:this.menu.trigger(event);preventDefault=false;}
if(preventDefault){event.preventDefault();}}},_selectFocusedItem:function(event){var item=this.menuItems.eq(this.focusIndex).parent("li");if(!item.hasClass("ui-state-disabled")){this._select(item.data("ui-selectmenu-item"),event);}},_select:function(item,event){var oldIndex=this.element[0].selectedIndex;this.element[0].selectedIndex=item.index;this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(item));this._setAria(item);this._trigger("select",event,{item:item});if(item.index!==oldIndex){this._trigger("change",event,{item:item});}
this.close(event);},_setAria:function(item){var id=this.menuItems.eq(item.index).attr("id");this.button.attr({"aria-labelledby":id,"aria-activedescendant":id});this.menu.attr("aria-activedescendant",id);},_setOption:function(key,value){if(key==="icons"){var icon=this.button.find("span.ui-icon");this._removeClass(icon,null,this.options.icons.button)._addClass(icon,null,value.button);}
this._super(key,value);if(key==="appendTo"){this.menuWrap.appendTo(this._appendTo());}
if(key==="width"){this._resizeButton();}},_setOptionDisabled:function(value){this._super(value);this.menuInstance.option("disabled",value);this.button.attr("aria-disabled",value);this._toggleClass(this.button,null,"ui-state-disabled",value);this.element.prop("disabled",value);if(value){this.button.attr("tabindex",-1);this.close();}else{this.button.attr("tabindex",0);}},_appendTo:function(){var element=this.options.appendTo;if(element){element=element.jquery||element.nodeType?$(element):this.document.find(element).eq(0);}
if(!element||!element[0]){element=this.element.closest(".ui-front, dialog");}
if(!element.length){element=this.document[0].body;}
return element;},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen);this._removeClass(this.button,"ui-selectmenu-button-"+
(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+
(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen);this.menu.attr("aria-hidden",!this.isOpen);},_resizeButton:function(){var width=this.options.width;if(width===false){this.button.css("width","");return;}
if(width===null){width=this.element.show().outerWidth();this.element.hide();}
this.button.outerWidth(width);},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1));},_getCreateOptions:function(){var options=this._super();options.disabled=this.element.prop("disabled");return options;},_parseOptions:function(options){var that=this,data=[];options.each(function(index,item){data.push(that._parseOption($(item),index));});this.items=data;},_parseOption:function(option,index){var optgroup=option.parent("optgroup");return{element:option,index:index,value:option.val(),label:option.text(),optgroup:optgroup.attr("label")||"",disabled:optgroup.prop("disabled")||option.prop("disabled")};},_destroy:function(){this._unbindFormResetHandler();this.menuWrap.remove();this.button.remove();this.element.show();this.element.removeUniqueId();this.labels.attr("for",this.ids.element);}}]);var widgetsSlider=$.widget("ui.slider",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:false,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this._calculateNewMax();this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content");this._refresh();this._animateOff=false;},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue();},_createHandles:function(){var i,handleCount,options=this.options,existingHandles=this.element.find(".ui-slider-handle"),handle="<span tabindex='0'></span>",handles=[];handleCount=(options.values&&options.values.length)||1;if(existingHandles.length>handleCount){existingHandles.slice(handleCount).remove();existingHandles=existingHandles.slice(0,handleCount);}
for(i=existingHandles.length;i<handleCount;i++){handles.push(handle);}
this.handles=existingHandles.add($(handles.join("")).appendTo(this.element));this._addClass(this.handles,"ui-slider-handle","ui-state-default");this.handle=this.handles.eq(0);this.handles.each(function(i){$(this).data("ui-slider-handle-index",i).attr("tabIndex",0);});},_createRange:function(){var options=this.options;if(options.range){if(options.range===true){if(!options.values){options.values=[this._valueMin(),this._valueMin()];}else if(options.values.length&&options.values.length!==2){options.values=[options.values[0],options.values[0]];}else if($.isArray(options.values)){options.values=options.values.slice(0);}}
if(!this.range||!this.range.length){this.range=$("<div>").appendTo(this.element);this._addClass(this.range,"ui-slider-range");}else{this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max");this.range.css({"left":"","bottom":""});}
if(options.range==="min"||options.range==="max"){this._addClass(this.range,"ui-slider-range-"+options.range);}}else{if(this.range){this.range.remove();}
this.range=null;}},_setupEvents:function(){this._off(this.handles);this._on(this.handles,this._handleEvents);this._hoverable(this.handles);this._focusable(this.handles);},_destroy:function(){this.handles.remove();if(this.range){this.range.remove();}
this._mouseDestroy();},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false;}
this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if((distance>thisDistance)||(distance===thisDistance&&(i===that._lastChangedValue||that.values(i)===o.min))){distance=thisDistance;closestHandle=$(this);index=i;}});allowed=this._start(event,index);if(allowed===false){return false;}
this._mouseSliding=true;this._handleIndex=index;this._addClass(closestHandle,null,"ui-state-active");closestHandle.trigger("focus");offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().addBack().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-
(closestHandle.height()/2)-
(parseInt(closestHandle.css("borderTopWidth"),10)||0)-
(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+
(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}
this._animateOff=true;return true;},_mouseStart:function(){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this._removeClass(this.handles,null,"ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-
(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-
(this._clickOffset?this._clickOffset.top:0);}
percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}
if(percentMouse<0){percentMouse=0;}
if(this.orientation==="vertical"){percentMouse=1-percentMouse;}
valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_uiHash:function(index,value,values){var uiHash={handle:this.handles[index],handleIndex:index,value:value!==undefined?value:this.value()};if(this._hasMultipleValues()){uiHash.value=value!==undefined?value:this.values(index);uiHash.values=values||this.values();}
return uiHash;},_hasMultipleValues:function(){return this.options.values&&this.options.values.length;},_start:function(event,index){return this._trigger("start",event,this._uiHash(index));},_slide:function(event,index,newVal){var allowed,otherVal,currentValue=this.value(),newValues=this.values();if(this._hasMultipleValues()){otherVal=this.values(index?0:1);currentValue=this.values(index);if(this.options.values.length===2&&this.options.range===true){newVal=index===0?Math.min(otherVal,newVal):Math.max(otherVal,newVal);}
newValues[index]=newVal;}
if(newVal===currentValue){return;}
allowed=this._trigger("slide",event,this._uiHash(index,newVal,newValues));if(allowed===false){return;}
if(this._hasMultipleValues()){this.values(index,newVal);}else{this.value(newVal);}},_stop:function(event,index){this._trigger("stop",event,this._uiHash(index));},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){this._lastChangedValue=index;this._trigger("change",event,this._uiHash(index));}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}
return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}
if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}
this._refreshValue();}else{if(this._hasMultipleValues()){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if(key==="range"&&this.options.range===true){if(value==="min"){this.options.value=this._values(0);this.options.values=null;}else if(value==="max"){this.options.value=this._values(this.options.values.length-1);this.options.values=null;}}
if($.isArray(this.options.values)){valsLength=this.options.values.length;}
this._super(key,value);switch(key){case"orientation":this._detectOrientation();this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation);this._refreshValue();if(this.options.range){this._refreshRange(value);}
this.handles.css(value==="horizontal"?"bottom":"left","");break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=valsLength-1;i>=0;i--){this._change(null,i);}
this._animateOff=false;break;case"step":case"min":case"max":this._animateOff=true;this._calculateNewMax();this._refreshValue();this._animateOff=false;break;case"range":this._animateOff=true;this._refresh();this._animateOff=false;break;}},_setOptionDisabled:function(value){this._super(value);this._toggleClass(null,"ui-state-disabled",!!value);},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else if(this._hasMultipleValues()){vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}
return vals;}else{return[];}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}
if(val>=this._valueMax()){return this._valueMax();}
var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}
return parseFloat(alignValue.toFixed(5));},_calculateNewMax:function(){var max=this.options.max,min=this._valueMin(),step=this.options.step,aboveMin=Math.round((max-min)/step)*step;max=aboveMin+min;if(max>this.options.max){max-=step;}
this.max=parseFloat(max.toFixed(this._precision()));},_precision:function(){var precision=this._precisionOf(this.options.step);if(this.options.min!==null){precision=Math.max(precision,this._precisionOf(this.options.min));}
return precision;},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf(".");return decimal===-1?0:str.length-decimal-1;},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.max;},_refreshRange:function(orientation){if(orientation==="vertical"){this.range.css({"width":"","left":""});}
if(orientation==="horizontal"){this.range.css({"height":"","bottom":""});}},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=(!this._animateOff)?o.animate:false,_set={};if(this._hasMultipleValues()){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-
that._valueMin())*100;_set[that.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(that.options.range===true){if(that.orientation==="horizontal"){if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}
if(i===1){that.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}
if(i===1){that.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}
lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:(100-valPercent)+"%"},o.animate);}
if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}
if(oRange==="max"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:(100-valPercent)+"%"},o.animate);}}},_handleEvents:{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;this._addClass($(event.target),null,"ui-state-active");allowed=this._start(event,index);if(allowed===false){return;}}
break;}
step=this.options.step;if(this._hasMultipleValues()){curVal=newVal=this.values(index);}else{curVal=newVal=this.value();}
switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+((this._valueMax()-this._valueMin())/this.numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-((this._valueMax()-this._valueMin())/this.numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return;}
newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return;}
newVal=this._trimAlignValue(curVal-step);break;}
this._slide(event,index,newVal);},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);this._removeClass($(event.target),null,"ui-state-active");}}}});var widgetsSortable=$.widget("ui.sortable",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(x,reference,size){return(x>=reference)&&(x<(reference+size));},_isFloating:function(item){return(/left|right/).test(item.css("float"))||(/inline|table-cell/).test(item.css("display"));},_create:function(){this.containerCache={};this._addClass("ui-sortable");this.refresh();this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true;},_setOption:function(key,value){this._super(key,value);if(key==="handle"){this._setHandleClassName();}},_setHandleClassName:function(){var that=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle");$.each(this.items,function(){that._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle");});},_destroy:function(){this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--){this.items[i].item.removeData(this.widgetName+"-item");}
return this;},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=false,that=this;if(this.reverting){return false;}
if(this.options.disabled||this.options.type==="static"){return false;}
this._refreshItems(event);$(event.target).parents().each(function(){if($.data(this,that.widgetName+"-item")===that){currentItem=$(this);return false;}});if($.data(event.target,that.widgetName+"-item")===that){currentItem=$(event.target);}
if(!currentItem){return false;}
if(this.options.handle&&!overrideHandle){$(this.options.handle,currentItem).find("*").addBack().each(function(){if(this===event.target){validHandle=true;}});if(!validHandle){return false;}}
this.currentItem=currentItem;this._removeCurrentsFromItems();return true;},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(event);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(event);this.originalPageX=event.pageX;this.originalPageY=event.pageY;(o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide();}
this._createPlaceholder();if(o.containment){this._setContainment();}
if(o.cursor&&o.cursor!=="auto"){body=this.document.find("body");this.storedCursor=body.css("cursor");body.css("cursor",o.cursor);this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body);}
if(o.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity");}
this.helper.css("opacity",o.opacity);}
if(o.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex");}
this.helper.css("zIndex",o.zIndex);}
if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset();}
this._trigger("start",event,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions();}
if(!noActivation){for(i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("activate",event,this._uiHash(this));}}
if($.ui.ddmanager){$.ui.ddmanager.current=this;}
if($.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}
this.dragging=true;this._addClass(this.helper,"ui-sortable-helper");this._mouseDrag(event);return true;},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=false;this.position=this._generatePosition(event);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs;}
if(this.options.scroll){if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-
event.pageY<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed;}else if(event.pageY-this.overflowOffset.top<o.scrollSensitivity){this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed;}
if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-
event.pageX<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed;}else if(event.pageX-this.overflowOffset.left<o.scrollSensitivity){this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed;}}else{if(event.pageY-this.document.scrollTop()<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed);}else if(this.window.height()-(event.pageY-this.document.scrollTop())<o.scrollSensitivity){scrolled=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed);}
if(event.pageX-this.document.scrollLeft()<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed);}else if(this.window.width()-(event.pageX-this.document.scrollLeft())<o.scrollSensitivity){scrolled=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed);}}
if(scrolled!==false&&$.ui.ddmanager&&!o.dropBehaviour){$.ui.ddmanager.prepareOffsets(this,event);}}
this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px";}
if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px";}
for(i=this.items.length-1;i>=0;i--){item=this.items[i];itemElement=item.item[0];intersection=this._intersectsWithPointer(item);if(!intersection){continue;}
if(item.instance!==this.currentContainer){continue;}
if(itemElement!==this.currentItem[0]&&this.placeholder[intersection===1?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&(this.options.type==="semi-dynamic"?!$.contains(this.element[0],itemElement):true)){this.direction=intersection===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(item)){this._rearrange(event,item);}else{break;}
this._trigger("change",event,this._uiHash());break;}}
this._contactContainers(event);if($.ui.ddmanager){$.ui.ddmanager.drag(this,event);}
this._trigger("sort",event,this._uiHash());this.lastPositionAbs=this.positionAbs;return false;},_mouseStop:function(event,noPropagation){if(!event){return;}
if($.ui.ddmanager&&!this.options.dropBehaviour){$.ui.ddmanager.drop(this,event);}
if(this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};if(!axis||axis==="x"){animation.left=cur.left-this.offset.parent.left-this.margins.left+
(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft);}
if(!axis||axis==="y"){animation.top=cur.top-this.offset.parent.top-this.margins.top+
(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop);}
this.reverting=true;$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event);});}else{this._clear(event,noPropagation);}
return false;},cancel:function(){if(this.dragging){this._mouseUp(new $.Event("mouseup",{target:null}));if(this.options.helper==="original"){this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper");}else{this.currentItem.show();}
for(var i=this.containers.length-1;i>=0;i--){this.containers[i]._trigger("deactivate",null,this._uiHash(this));if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",null,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0]);}
if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove();}
$.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){$(this.domPosition.prev).after(this.currentItem);}else{$(this.domPosition.parent).prepend(this.currentItem);}}
return this;},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];o=o||{};$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||(/(.+)[\-=_](.+)/));if(res){str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]));}});if(!str.length&&o.key){str.push(o.key+"=");}
return str.join("&");},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];o=o||{};items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"");});return ret;},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight=(this.options.axis==="x")||((y1+dyClick)>t&&(y1+dyClick)<b),isOverElementWidth=(this.options.axis==="y")||((x1+dxClick)>l&&(x1+dxClick)<r),isOverElement=isOverElementHeight&&isOverElementWidth;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"])){return isOverElement;}else{return(l<x1+(this.helperProportions.width/2)&&x2-(this.helperProportions.width/2)<r&&t<y1+(this.helperProportions.height/2)&&y2-(this.helperProportions.height/2)<b);}},_intersectsWithPointer:function(item){var verticalDirection,horizontalDirection,isOverElementHeight=(this.options.axis==="x")||this._isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth=(this.options.axis==="y")||this._isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth;if(!isOverElement){return false;}
verticalDirection=this._getDragVerticalDirection();horizontalDirection=this._getDragHorizontalDirection();return this.floating?((horizontalDirection==="right"||verticalDirection==="down")?2:1):(verticalDirection&&(verticalDirection==="down"?2:1));},_intersectsWithSides:function(item){var isOverBottomHalf=this._isOverAxis(this.positionAbs.top+
this.offset.click.top,item.top+(item.height/2),item.height),isOverRightHalf=this._isOverAxis(this.positionAbs.left+
this.offset.click.left,item.left+(item.width/2),item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();if(this.floating&&horizontalDirection){return((horizontalDirection==="right"&&isOverRightHalf)||(horizontalDirection==="left"&&!isOverRightHalf));}else{return verticalDirection&&((verticalDirection==="down"&&isOverBottomHalf)||(verticalDirection==="up"&&!isOverBottomHalf));}},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return delta!==0&&(delta>0?"down":"up");},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return delta!==0&&(delta>0?"right":"left");},refresh:function(event){this._refreshItems(event);this._setHandleClassName();this.refreshPositions();return this;},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith;},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst]);}}}}
queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function addItems(){items.push(this);}
for(i=queries.length-1;i>=0;i--){queries[i][0].each(addItems);}
return $(items);},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++){if(list[j]===item.item[0]){return false;}}
return true;});},_refreshItems:function(event){this.items=[];this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready){for(i=connectWith.length-1;i>=0;i--){cur=$(connectWith[i],this.document[0]);for(j=cur.length-1;j>=0;j--){inst=$.data(cur[j],this.widgetFullName);if(inst&&inst!==this&&!inst.options.disabled){queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]);this.containers.push(inst);}}}}
for(i=queries.length-1;i>=0;i--){targetData=queries[i][1];_queries=queries[i][0];for(j=0,queriesLength=_queries.length;j<queriesLength;j++){item=$(_queries[j]);item.data(this.widgetName+"-item",targetData);items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0});}}},refreshPositions:function(fast){this.floating=this.items.length?this.options.axis==="x"||this._isFloating(this.items[0].item):false;if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset();}
var i,item,t,p;for(i=this.items.length-1;i>=0;i--){item=this.items[i];if(item.instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]){continue;}
t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;if(!fast){item.width=t.outerWidth();item.height=t.outerHeight();}
p=t.offset();item.left=p.left;item.top=p.top;}
if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this);}else{for(i=this.containers.length-1;i>=0;i--){p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left;this.containers[i].containerCache.top=p.top;this.containers[i].containerCache.width=this.containers[i].element.outerWidth();this.containers[i].containerCache.height=this.containers[i].element.outerHeight();}}
return this;},_createPlaceholder:function(that){that=that||this;var className,o=that.options;if(!o.placeholder||o.placeholder.constructor===String){className=o.placeholder;o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]);that._addClass(element,"ui-sortable-placeholder",className||that.currentItem[0].className)._removeClass(element,"ui-sortable-helper");if(nodeName==="tbody"){that._createTrPlaceholder(that.currentItem.find("tr").eq(0),$("<tr>",that.document[0]).appendTo(element));}else if(nodeName==="tr"){that._createTrPlaceholder(that.currentItem,element);}else if(nodeName==="img"){element.attr("src",that.currentItem.attr("src"));}
if(!className){element.css("visibility","hidden");}
return element;},update:function(container,p){if(className&&!o.forcePlaceholderSize){return;}
if(!p.height()){p.height(that.currentItem.innerHeight()-
parseInt(that.currentItem.css("paddingTop")||0,10)-
parseInt(that.currentItem.css("paddingBottom")||0,10));}
if(!p.width()){p.width(that.currentItem.innerWidth()-
parseInt(that.currentItem.css("paddingLeft")||0,10)-
parseInt(that.currentItem.css("paddingRight")||0,10));}}};}
that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem));that.currentItem.after(that.placeholder);o.placeholder.update(that,that.placeholder);},_createTrPlaceholder:function(sourceTr,targetTr){var that=this;sourceTr.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(targetTr);});},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,cur,nearBottom,floating,axis,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--){if($.contains(this.currentItem[0],this.containers[i].element[0])){continue;}
if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0])){continue;}
innermostContainer=this.containers[i];innermostIndex=i;}else{if(this.containers[i].containerCache.over){this.containers[i]._trigger("out",event,this._uiHash(this));this.containers[i].containerCache.over=0;}}}
if(!innermostContainer){return;}
if(this.containers.length===1){if(!this.containers[innermostIndex].containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}}else{dist=10000;itemWithLeastDistance=null;floating=innermostContainer.floating||this._isFloating(this.currentItem);posProperty=floating?"left":"top";sizeProperty=floating?"width":"height";axis=floating?"pageX":"pageY";for(j=this.items.length-1;j>=0;j--){if(!$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])){continue;}
if(this.items[j].item[0]===this.currentItem[0]){continue;}
cur=this.items[j].item.offset()[posProperty];nearBottom=false;if(event[axis]-cur>this.items[j][sizeProperty]/2){nearBottom=true;}
if(Math.abs(event[axis]-cur)<dist){dist=Math.abs(event[axis]-cur);itemWithLeastDistance=this.items[j];this.direction=nearBottom?"up":"down";}}
if(!itemWithLeastDistance&&!this.options.dropOnEmpty){return;}
if(this.currentContainer===this.containers[innermostIndex]){if(!this.currentContainer.containerCache.over){this.containers[innermostIndex]._trigger("over",event,this._uiHash());this.currentContainer.containerCache.over=1;}
return;}
itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,true):this._rearrange(event,null,this.containers[innermostIndex].element,true);this._trigger("change",event,this._uiHash());this.containers[innermostIndex]._trigger("change",event,this._uiHash(this));this.currentContainer=this.containers[innermostIndex];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[innermostIndex]._trigger("over",event,this._uiHash(this));this.containers[innermostIndex].containerCache.over=1;}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):(o.helper==="clone"?this.currentItem.clone():this.currentItem);if(!helper.parents("body").length){$(o.appendTo!=="parent"?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]);}
if(helper[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")};}
if(!helper[0].style.width||o.forceHelperSize){helper.width(this.currentItem.width());}
if(!helper[0].style.height||o.forceHelperSize){helper.height(this.currentItem.height());}
return helper;},_adjustOffsetFromHelper:function(obj){if(typeof obj==="string"){obj=obj.split(" ");}
if($.isArray(obj)){obj={left:+obj[0],top:+obj[1]||0};}
if("left"in obj){this.offset.click.left=obj.left+this.margins.left;}
if("right"in obj){this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left;}
if("top"in obj){this.offset.click.top=obj.top+this.margins.top;}
if("bottom"in obj){this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0])){po.left+=this.scrollParent.scrollLeft();po.top+=this.scrollParent.scrollTop();}
if(this.offsetParent[0]===this.document[0].body||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&$.ui.ie)){po={top:0,left:0};}
return{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+
this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+
this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var ce,co,over,o=this.options;if(o.containment==="parent"){o.containment=this.helper[0].parentNode;}
if(o.containment==="document"||o.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,o.containment==="document"?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(o.containment==="document"?(this.document.height()||document.body.parentNode.scrollHeight):this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];}
if(!(/^(document|window|parent)$/).test(o.containment)){ce=$(o.containment)[0];co=$(o.containment).offset();over=($(ce).css("overflow")!=="hidden");this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+
(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+
(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-
(parseInt($(ce).css("borderLeftWidth"),10)||0)-
(parseInt($(ce).css("paddingRight"),10)||0)-
this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-
(parseInt($(ce).css("borderTopWidth"),10)||0)-
(parseInt($(ce).css("paddingBottom"),10)||0)-
this.helperProportions.height-this.margins.top];}},_convertPositionTo:function(d,pos){if(!pos){pos=this.position;}
var mod=d==="absolute"?1:-1,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);return{top:(pos.top+
this.offset.relative.top*mod+
this.offset.parent.top*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop()))*mod)),left:(pos.left+
this.offset.relative.left*mod+
this.offset.parent.left*mod-
((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod))};},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&$.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,scrollIsRootNode=(/(html|body)/i).test(scroll[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset();}
if(this.originalPosition){if(this.containment){if(event.pageX-this.offset.click.left<this.containment[0]){pageX=this.containment[0]+this.offset.click.left;}
if(event.pageY-this.offset.click.top<this.containment[1]){pageY=this.containment[1]+this.offset.click.top;}
if(event.pageX-this.offset.click.left>this.containment[2]){pageX=this.containment[2]+this.offset.click.left;}
if(event.pageY-this.offset.click.top>this.containment[3]){pageY=this.containment[3]+this.offset.click.top;}}
if(o.grid){top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment?((top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3])?top:((top-this.offset.click.top>=this.containment[1])?top-o.grid[1]:top+o.grid[1])):top;left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment?((left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2])?left:((left-this.offset.click.left>=this.containment[0])?left-o.grid[0]:left+o.grid[0])):left;}}
return{top:(pageY-
this.offset.click.top-
this.offset.relative.top-
this.offset.parent.top+
((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(scrollIsRootNode?0:scroll.scrollTop())))),left:(pageX-
this.offset.click.left-
this.offset.relative.left-
this.offset.parent.left+
((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())))};},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction==="down"?i.item[0]:i.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){if(counter===this.counter){this.refreshPositions(!hardRefresh);}});},_clear:function(event,noPropagation){this.reverting=false;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem);}
this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(i in this._storedCSS){if(this._storedCSS[i]==="auto"||this._storedCSS[i]==="static"){this._storedCSS[i]="";}}
this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper");}else{this.currentItem.show();}
if(this.fromOutside&&!noPropagation){delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside));});}
if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!noPropagation){delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash());});}
if(this!==this.currentContainer){if(!noPropagation){delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash());});delayedTriggers.push((function(c){return function(event){c._trigger("receive",event,this._uiHash(this));};}).call(this,this.currentContainer));delayedTriggers.push((function(c){return function(event){c._trigger("update",event,this._uiHash(this));};}).call(this,this.currentContainer));}}
function delayEvent(type,instance,container){return function(event){container._trigger(type,event,instance._uiHash(instance));};}
for(i=this.containers.length-1;i>=0;i--){if(!noPropagation){delayedTriggers.push(delayEvent("deactivate",this,this.containers[i]));}
if(this.containers[i].containerCache.over){delayedTriggers.push(delayEvent("out",this,this.containers[i]));this.containers[i].containerCache.over=0;}}
if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove();}
if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity);}
if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex);}
this.dragging=false;if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());}
this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(!this.cancelHelperRemoval){if(this.helper[0]!==this.currentItem[0]){this.helper.remove();}
this.helper=null;}
if(!noPropagation){for(i=0;i<delayedTriggers.length;i++){delayedTriggers[i].call(this,event);}
this._trigger("stop",event,this._uiHash());}
this.fromOutside=false;return!this.cancelHelperRemoval;},_trigger:function(){if($.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel();}},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null};}});function spinnerModifer(fn){return function(){var previous=this.element.val();fn.apply(this,arguments);this._refresh();if(previous!==this.element.val()){this._trigger("change");}};}
$.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:true,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max);this._setOption("min",this.options.min);this._setOption("step",this.options.step);if(this.value()!==""){this._value(this.element.val(),true);}
this._draw();this._on(this._events);this._refresh();this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete");}});},_getCreateOptions:function(){var options=this._super();var element=this.element;$.each(["min","max","step"],function(i,option){var value=element.attr(option);if(value!=null&&value.length){options[option]=value;}});return options;},_events:{keydown:function(event){if(this._start(event)&&this._keydown(event)){event.preventDefault();}},keyup:"_stop",focus:function(){this.previous=this.element.val();},blur:function(event){if(this.cancelBlur){delete this.cancelBlur;return;}
this._stop();this._refresh();if(this.previous!==this.element.val()){this._trigger("change",event);}},mousewheel:function(event,delta){if(!delta){return;}
if(!this.spinning&&!this._start(event)){return false;}
this._spin((delta>0?1:-1)*this.options.step,event);clearTimeout(this.mousewheelTimer);this.mousewheelTimer=this._delay(function(){if(this.spinning){this._stop(event);}},100);event.preventDefault();},"mousedown .ui-spinner-button":function(event){var previous;previous=this.element[0]===$.ui.safeActiveElement(this.document[0])?this.previous:this.element.val();function checkFocus(){var isActive=this.element[0]===$.ui.safeActiveElement(this.document[0]);if(!isActive){this.element.trigger("focus");this.previous=previous;this._delay(function(){this.previous=previous;});}}
event.preventDefault();checkFocus.call(this);this.cancelBlur=true;this._delay(function(){delete this.cancelBlur;checkFocus.call(this);});if(this._start(event)===false){return;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(event){if(!$(event.currentTarget).hasClass("ui-state-active")){return;}
if(this._start(event)===false){return false;}
this._repeat(null,$(event.currentTarget).hasClass("ui-spinner-up")?1:-1,event);},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>");},_draw:function(){this._enhance();this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content");this._addClass("ui-spinner-input");this.element.attr("role","spinbutton");this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",true).button({classes:{"ui-button":""}});this._removeClass(this.buttons,"ui-corner-all");this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up");this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down");this.buttons.first().button({"icon":this.options.icons.up,"showLabel":false});this.buttons.last().button({"icon":this.options.icons.down,"showLabel":false});if(this.buttons.height()>Math.ceil(this.uiSpinner.height()*0.5)&&this.uiSpinner.height()>0){this.uiSpinner.height(this.uiSpinner.height());}},_keydown:function(event){var options=this.options,keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.UP:this._repeat(null,1,event);return true;case keyCode.DOWN:this._repeat(null,-1,event);return true;case keyCode.PAGE_UP:this._repeat(null,options.page,event);return true;case keyCode.PAGE_DOWN:this._repeat(null,-options.page,event);return true;}
return false;},_start:function(event){if(!this.spinning&&this._trigger("start",event)===false){return false;}
if(!this.counter){this.counter=1;}
this.spinning=true;return true;},_repeat:function(i,steps,event){i=i||500;clearTimeout(this.timer);this.timer=this._delay(function(){this._repeat(40,steps,event);},i);this._spin(steps*this.options.step,event);},_spin:function(step,event){var value=this.value()||0;if(!this.counter){this.counter=1;}
value=this._adjustValue(value+step*this._increment(this.counter));if(!this.spinning||this._trigger("spin",event,{value:value})!==false){this._value(value);this.counter++;}},_increment:function(i){var incremental=this.options.incremental;if(incremental){return $.isFunction(incremental)?incremental(i):Math.floor(i*i*i/50000-i*i/500+17*i/200+1);}
return 1;},_precision:function(){var precision=this._precisionOf(this.options.step);if(this.options.min!==null){precision=Math.max(precision,this._precisionOf(this.options.min));}
return precision;},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf(".");return decimal===-1?0:str.length-decimal-1;},_adjustValue:function(value){var base,aboveMin,options=this.options;base=options.min!==null?options.min:0;aboveMin=value-base;aboveMin=Math.round(aboveMin/options.step)*options.step;value=base+aboveMin;value=parseFloat(value.toFixed(this._precision()));if(options.max!==null&&value>options.max){return options.max;}
if(options.min!==null&&value<options.min){return options.min;}
return value;},_stop:function(event){if(!this.spinning){return;}
clearTimeout(this.timer);clearTimeout(this.mousewheelTimer);this.counter=0;this.spinning=false;this._trigger("stop",event);},_setOption:function(key,value){var prevValue,first,last;if(key==="culture"||key==="numberFormat"){prevValue=this._parse(this.element.val());this.options[key]=value;this.element.val(this._format(prevValue));return;}
if(key==="max"||key==="min"||key==="step"){if(typeof value==="string"){value=this._parse(value);}}
if(key==="icons"){first=this.buttons.first().find(".ui-icon");this._removeClass(first,null,this.options.icons.up);this._addClass(first,null,value.up);last=this.buttons.last().find(".ui-icon");this._removeClass(last,null,this.options.icons.down);this._addClass(last,null,value.down);}
this._super(key,value);},_setOptionDisabled:function(value){this._super(value);this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!value);this.element.prop("disabled",!!value);this.buttons.button(value?"disable":"enable");},_setOptions:spinnerModifer(function(options){this._super(options);}),_parse:function(val){if(typeof val==="string"&&val!==""){val=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(val,10,this.options.culture):+val;}
return val===""||isNaN(val)?null:val;},_format:function(value){if(value===""){return"";}
return window.Globalize&&this.options.numberFormat?Globalize.format(value,this.options.numberFormat,this.options.culture):value;},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())});},isValid:function(){var value=this.value();if(value===null){return false;}
return value===this._adjustValue(value);},_value:function(value,allowAny){var parsed;if(value!==""){parsed=this._parse(value);if(parsed!==null){if(!allowAny){parsed=this._adjustValue(parsed);}
value=this._format(parsed);}}
this.element.val(value);this._refresh();},_destroy:function(){this.element.prop("disabled",false).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow");this.uiSpinner.replaceWith(this.element);},stepUp:spinnerModifer(function(steps){this._stepUp(steps);}),_stepUp:function(steps){if(this._start()){this._spin((steps||1)*this.options.step);this._stop();}},stepDown:spinnerModifer(function(steps){this._stepDown(steps);}),_stepDown:function(steps){if(this._start()){this._spin((steps||1)*-this.options.step);this._stop();}},pageUp:spinnerModifer(function(pages){this._stepUp((pages||1)*this.options.page);}),pageDown:spinnerModifer(function(pages){this._stepDown((pages||1)*this.options.page);}),value:function(newVal){if(!arguments.length){return this._parse(this.element.val());}
spinnerModifer(this._value).call(this,newVal);},widget:function(){return this.uiSpinner;}});if($.uiBackCompat!==false){$.widget("ui.spinner",$.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());},_uiSpinnerHtml:function(){return"<span>";},_buttonHtml:function(){return"<a></a><a></a>";}});}
var widgetsSpinner=$.ui.spinner;$.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:false,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:(function(){var rhash=/#.*$/;return function(anchor){var anchorUrl,locationUrl;anchorUrl=anchor.href.replace(rhash,"");locationUrl=location.href.replace(rhash,"");try{anchorUrl=decodeURIComponent(anchorUrl);}catch(error){}
try{locationUrl=decodeURIComponent(locationUrl);}catch(error){}
return anchor.hash.length>1&&anchorUrl===locationUrl;};})(),_create:function(){var that=this,options=this.options;this.running=false;this._addClass("ui-tabs","ui-widget ui-widget-content");this._toggleClass("ui-tabs-collapsible",null,options.collapsible);this._processTabs();options.active=this._initialActive();if($.isArray(options.disabled)){options.disabled=$.unique(options.disabled.concat($.map(this.tabs.filter(".ui-state-disabled"),function(li){return that.tabs.index(li);}))).sort();}
if(this.options.active!==false&&this.anchors.length){this.active=this._findActive(options.active);}else{this.active=$();}
this._refresh();if(this.active.length){this.load(options.active);}},_initialActive:function(){var active=this.options.active,collapsible=this.options.collapsible,locationHash=location.hash.substring(1);if(active===null){if(locationHash){this.tabs.each(function(i,tab){if($(tab).attr("aria-controls")===locationHash){active=i;return false;}});}
if(active===null){active=this.tabs.index(this.tabs.filter(".ui-tabs-active"));}
if(active===null||active===-1){active=this.tabs.length?0:false;}}
if(active!==false){active=this.tabs.index(this.tabs.eq(active));if(active===-1){active=collapsible?false:0;}}
if(!collapsible&&active===false&&this.anchors.length){active=0;}
return active;},_getCreateEventData:function(){return{tab:this.active,panel:!this.active.length?$():this._getPanelForTab(this.active)};},_tabKeydown:function(event){var focusedTab=$($.ui.safeActiveElement(this.document[0])).closest("li"),selectedIndex=this.tabs.index(focusedTab),goingForward=true;if(this._handlePageNav(event)){return;}
switch(event.keyCode){case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:selectedIndex++;break;case $.ui.keyCode.UP:case $.ui.keyCode.LEFT:goingForward=false;selectedIndex--;break;case $.ui.keyCode.END:selectedIndex=this.anchors.length-1;break;case $.ui.keyCode.HOME:selectedIndex=0;break;case $.ui.keyCode.SPACE:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex);return;case $.ui.keyCode.ENTER:event.preventDefault();clearTimeout(this.activating);this._activate(selectedIndex===this.options.active?false:selectedIndex);return;default:return;}
event.preventDefault();clearTimeout(this.activating);selectedIndex=this._focusNextTab(selectedIndex,goingForward);if(!event.ctrlKey&&!event.metaKey){focusedTab.attr("aria-selected","false");this.tabs.eq(selectedIndex).attr("aria-selected","true");this.activating=this._delay(function(){this.option("active",selectedIndex);},this.delay);}},_panelKeydown:function(event){if(this._handlePageNav(event)){return;}
if(event.ctrlKey&&event.keyCode===$.ui.keyCode.UP){event.preventDefault();this.active.trigger("focus");}},_handlePageNav:function(event){if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_UP){this._activate(this._focusNextTab(this.options.active-1,false));return true;}
if(event.altKey&&event.keyCode===$.ui.keyCode.PAGE_DOWN){this._activate(this._focusNextTab(this.options.active+1,true));return true;}},_findNextTab:function(index,goingForward){var lastTabIndex=this.tabs.length-1;function constrain(){if(index>lastTabIndex){index=0;}
if(index<0){index=lastTabIndex;}
return index;}
while($.inArray(constrain(),this.options.disabled)!==-1){index=goingForward?index+1:index-1;}
return index;},_focusNextTab:function(index,goingForward){index=this._findNextTab(index,goingForward);this.tabs.eq(index).trigger("focus");return index;},_setOption:function(key,value){if(key==="active"){this._activate(value);return;}
this._super(key,value);if(key==="collapsible"){this._toggleClass("ui-tabs-collapsible",null,value);if(!value&&this.options.active===false){this._activate(0);}}
if(key==="event"){this._setupEvents(value);}
if(key==="heightStyle"){this._setupHeightStyle(value);}},_sanitizeSelector:function(hash){return hash?hash.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):"";},refresh:function(){var options=this.options,lis=this.tablist.children(":has(a[href])");options.disabled=$.map(lis.filter(".ui-state-disabled"),function(tab){return lis.index(tab);});this._processTabs();if(options.active===false||!this.anchors.length){options.active=false;this.active=$();}else if(this.active.length&&!$.contains(this.tablist[0],this.active[0])){if(this.tabs.length===options.disabled.length){options.active=false;this.active=$();}else{this._activate(this._findNextTab(Math.max(0,options.active-1),false));}}else{options.active=this.tabs.index(this.active);}
this._refresh();},_refresh:function(){this._setOptionDisabled(this.options.disabled);this._setupEvents(this.options.event);this._setupHeightStyle(this.options.heightStyle);this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1});this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"});if(!this.active.length){this.tabs.eq(0).attr("tabIndex",0);}else{this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});this._addClass(this.active,"ui-tabs-active","ui-state-active");this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"});}},_processTabs:function(){var that=this,prevTabs=this.tabs,prevAnchors=this.anchors,prevPanels=this.panels;this.tablist=this._getList().attr("role","tablist");this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header");this.tablist.on("mousedown"+this.eventNamespace,"> li",function(event){if($(this).is(".ui-state-disabled")){event.preventDefault();}}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){if($(this).closest("li").is(".ui-state-disabled")){this.blur();}});this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1});this._addClass(this.tabs,"ui-tabs-tab","ui-state-default");this.anchors=this.tabs.map(function(){return $("a",this)[0];}).attr({role:"presentation",tabIndex:-1});this._addClass(this.anchors,"ui-tabs-anchor");this.panels=$();this.anchors.each(function(i,anchor){var selector,panel,panelId,anchorId=$(anchor).uniqueId().attr("id"),tab=$(anchor).closest("li"),originalAriaControls=tab.attr("aria-controls");if(that._isLocal(anchor)){selector=anchor.hash;panelId=selector.substring(1);panel=that.element.find(that._sanitizeSelector(selector));}else{panelId=tab.attr("aria-controls")||$({}).uniqueId()[0].id;selector="#"+panelId;panel=that.element.find(selector);if(!panel.length){panel=that._createPanel(panelId);panel.insertAfter(that.panels[i-1]||that.tablist);}
panel.attr("aria-live","polite");}
if(panel.length){that.panels=that.panels.add(panel);}
if(originalAriaControls){tab.data("ui-tabs-aria-controls",originalAriaControls);}
tab.attr({"aria-controls":panelId,"aria-labelledby":anchorId});panel.attr("aria-labelledby",anchorId);});this.panels.attr("role","tabpanel");this._addClass(this.panels,"ui-tabs-panel","ui-widget-content");if(prevTabs){this._off(prevTabs.not(this.tabs));this._off(prevAnchors.not(this.anchors));this._off(prevPanels.not(this.panels));}},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0);},_createPanel:function(id){return $("<div>").attr("id",id).data("ui-tabs-destroy",true);},_setOptionDisabled:function(disabled){var currentItem,li,i;if($.isArray(disabled)){if(!disabled.length){disabled=false;}else if(disabled.length===this.anchors.length){disabled=true;}}
for(i=0;(li=this.tabs[i]);i++){currentItem=$(li);if(disabled===true||$.inArray(i,disabled)!==-1){currentItem.attr("aria-disabled","true");this._addClass(currentItem,null,"ui-state-disabled");}else{currentItem.removeAttr("aria-disabled");this._removeClass(currentItem,null,"ui-state-disabled");}}
this.options.disabled=disabled;this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,disabled===true);},_setupEvents:function(event){var events={};if(event){$.each(event.split(" "),function(index,eventName){events[eventName]="_eventHandler";});}
this._off(this.anchors.add(this.tabs).add(this.panels));this._on(true,this.anchors,{click:function(event){event.preventDefault();}});this._on(this.anchors,events);this._on(this.tabs,{keydown:"_tabKeydown"});this._on(this.panels,{keydown:"_panelKeydown"});this._focusable(this.tabs);this._hoverable(this.tabs);},_setupHeightStyle:function(heightStyle){var maxHeight,parent=this.element.parent();if(heightStyle==="fill"){maxHeight=parent.height();maxHeight-=this.element.outerHeight()-this.element.height();this.element.siblings(":visible").each(function(){var elem=$(this),position=elem.css("position");if(position==="absolute"||position==="fixed"){return;}
maxHeight-=elem.outerHeight(true);});this.element.children().not(this.panels).each(function(){maxHeight-=$(this).outerHeight(true);});this.panels.each(function(){$(this).height(Math.max(0,maxHeight-
$(this).innerHeight()+$(this).height()));}).css("overflow","auto");}else if(heightStyle==="auto"){maxHeight=0;this.panels.each(function(){maxHeight=Math.max(maxHeight,$(this).height("").height());}).height(maxHeight);}},_eventHandler:function(event){var options=this.options,active=this.active,anchor=$(event.currentTarget),tab=anchor.closest("li"),clickedIsActive=tab[0]===active[0],collapsing=clickedIsActive&&options.collapsible,toShow=collapsing?$():this._getPanelForTab(tab),toHide=!active.length?$():this._getPanelForTab(active),eventData={oldTab:active,oldPanel:toHide,newTab:collapsing?$():tab,newPanel:toShow};event.preventDefault();if(tab.hasClass("ui-state-disabled")||tab.hasClass("ui-tabs-loading")||this.running||(clickedIsActive&&!options.collapsible)||(this._trigger("beforeActivate",event,eventData)===false)){return;}
options.active=collapsing?false:this.tabs.index(tab);this.active=clickedIsActive?$():tab;if(this.xhr){this.xhr.abort();}
if(!toHide.length&&!toShow.length){$.error("jQuery UI Tabs: Mismatching fragment identifier.");}
if(toShow.length){this.load(this.tabs.index(tab),event);}
this._toggle(event,eventData);},_toggle:function(event,eventData){var that=this,toShow=eventData.newPanel,toHide=eventData.oldPanel;this.running=true;function complete(){that.running=false;that._trigger("activate",event,eventData);}
function show(){that._addClass(eventData.newTab.closest("li"),"ui-tabs-active","ui-state-active");if(toShow.length&&that.options.show){that._show(toShow,that.options.show,complete);}else{toShow.show();complete();}}
if(toHide.length&&this.options.hide){this._hide(toHide,this.options.hide,function(){that._removeClass(eventData.oldTab.closest("li"),"ui-tabs-active","ui-state-active");show();});}else{this._removeClass(eventData.oldTab.closest("li"),"ui-tabs-active","ui-state-active");toHide.hide();show();}
toHide.attr("aria-hidden","true");eventData.oldTab.attr({"aria-selected":"false","aria-expanded":"false"});if(toShow.length&&toHide.length){eventData.oldTab.attr("tabIndex",-1);}else if(toShow.length){this.tabs.filter(function(){return $(this).attr("tabIndex")===0;}).attr("tabIndex",-1);}
toShow.attr("aria-hidden","false");eventData.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0});},_activate:function(index){var anchor,active=this._findActive(index);if(active[0]===this.active[0]){return;}
if(!active.length){active=this.active;}
anchor=active.find(".ui-tabs-anchor")[0];this._eventHandler({target:anchor,currentTarget:anchor,preventDefault:$.noop});},_findActive:function(index){return index===false?$():this.tabs.eq(index);},_getIndex:function(index){if(typeof index==="string"){index=this.anchors.index(this.anchors.filter("[href$='"+
$.ui.escapeSelector(index)+"']"));}
return index;},_destroy:function(){if(this.xhr){this.xhr.abort();}
this.tablist.removeAttr("role").off(this.eventNamespace);this.anchors.removeAttr("role tabIndex").removeUniqueId();this.tabs.add(this.panels).each(function(){if($.data(this,"ui-tabs-destroy")){$(this).remove();}else{$(this).removeAttr("role tabIndex "+"aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded");}});this.tabs.each(function(){var li=$(this),prev=li.data("ui-tabs-aria-controls");if(prev){li.attr("aria-controls",prev).removeData("ui-tabs-aria-controls");}else{li.removeAttr("aria-controls");}});this.panels.show();if(this.options.heightStyle!=="content"){this.panels.css("height","");}},enable:function(index){var disabled=this.options.disabled;if(disabled===false){return;}
if(index===undefined){disabled=false;}else{index=this._getIndex(index);if($.isArray(disabled)){disabled=$.map(disabled,function(num){return num!==index?num:null;});}else{disabled=$.map(this.tabs,function(li,num){return num!==index?num:null;});}}
this._setOptionDisabled(disabled);},disable:function(index){var disabled=this.options.disabled;if(disabled===true){return;}
if(index===undefined){disabled=true;}else{index=this._getIndex(index);if($.inArray(index,disabled)!==-1){return;}
if($.isArray(disabled)){disabled=$.merge([index],disabled).sort();}else{disabled=[index];}}
this._setOptionDisabled(disabled);},load:function(index,event){index=this._getIndex(index);var that=this,tab=this.tabs.eq(index),anchor=tab.find(".ui-tabs-anchor"),panel=this._getPanelForTab(tab),eventData={tab:tab,panel:panel},complete=function(jqXHR,status){if(status==="abort"){that.panels.stop(false,true);}
that._removeClass(tab,"ui-tabs-loading");panel.removeAttr("aria-busy");if(jqXHR===that.xhr){delete that.xhr;}};if(this._isLocal(anchor[0])){return;}
this.xhr=$.ajax(this._ajaxSettings(anchor,event,eventData));if(this.xhr&&this.xhr.statusText!=="canceled"){this._addClass(tab,"ui-tabs-loading");panel.attr("aria-busy","true");this.xhr.done(function(response,status,jqXHR){setTimeout(function(){panel.html(response);that._trigger("load",event,eventData);complete(jqXHR,status);},1);}).fail(function(jqXHR,status){setTimeout(function(){complete(jqXHR,status);},1);});}},_ajaxSettings:function(anchor,event,eventData){var that=this;return{url:anchor.attr("href").replace(/#.*$/,""),beforeSend:function(jqXHR,settings){return that._trigger("beforeLoad",event,$.extend({jqXHR:jqXHR,ajaxSettings:settings},eventData));}};},_getPanelForTab:function(tab){var id=$(tab).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+id));}});if($.uiBackCompat!==false){$.widget("ui.tabs",$.ui.tabs,{_processTabs:function(){this._superApply(arguments);this._addClass(this.tabs,"ui-tab");}});}
var widgetsTabs=$.ui.tabs;$.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var title=$(this).attr("title")||"";return $("<a>").text(title).html();},hide:true,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:true,track:false,close:null,open:null},_addDescribedBy:function(elem,id){var describedby=(elem.attr("aria-describedby")||"").split(/\s+/);describedby.push(id);elem.data("ui-tooltip-id",id).attr("aria-describedby",$.trim(describedby.join(" ")));},_removeDescribedBy:function(elem){var id=elem.data("ui-tooltip-id"),describedby=(elem.attr("aria-describedby")||"").split(/\s+/),index=$.inArray(id,describedby);if(index!==-1){describedby.splice(index,1);}
elem.removeData("ui-tooltip-id");describedby=$.trim(describedby.join(" "));if(describedby){elem.attr("aria-describedby",describedby);}else{elem.removeAttr("aria-describedby");}},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};this.liveRegion=$("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body);this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible");this.disabledTitles=$([]);},_setOption:function(key,value){var that=this;this._super(key,value);if(key==="content"){$.each(this.tooltips,function(id,tooltipData){that._updateContent(tooltipData.element);});}},_setOptionDisabled:function(value){this[value?"_disable":"_enable"]();},_disable:function(){var that=this;$.each(this.tooltips,function(id,tooltipData){var event=$.Event("blur");event.target=event.currentTarget=tooltipData.element[0];that.close(event,true);});this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var element=$(this);if(element.is("[title]")){return element.data("ui-tooltip-title",element.attr("title")).removeAttr("title");}}));},_enable:function(){this.disabledTitles.each(function(){var element=$(this);if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));}});this.disabledTitles=$([]);},open:function(event){var that=this,target=$(event?event.target:this.element).closest(this.options.items);if(!target.length||target.data("ui-tooltip-id")){return;}
if(target.attr("title")){target.data("ui-tooltip-title",target.attr("title"));}
target.data("ui-tooltip-open",true);if(event&&event.type==="mouseover"){target.parents().each(function(){var parent=$(this),blurEvent;if(parent.data("ui-tooltip-open")){blurEvent=$.Event("blur");blurEvent.target=blurEvent.currentTarget=this;that.close(blurEvent,true);}
if(parent.attr("title")){parent.uniqueId();that.parents[this.id]={element:this,title:parent.attr("title")};parent.attr("title","");}});}
this._registerCloseHandlers(event,target);this._updateContent(target,event);},_updateContent:function(target,event){var content,contentOption=this.options.content,that=this,eventType=event?event.type:null;if(typeof contentOption==="string"||contentOption.nodeType||contentOption.jquery){return this._open(event,target,contentOption);}
content=contentOption.call(target[0],function(response){that._delay(function(){if(!target.data("ui-tooltip-open")){return;}
if(event){event.type=eventType;}
this._open(event,target,response);});});if(content){this._open(event,target,content);}},_open:function(event,target,content){var tooltipData,tooltip,delayedShow,a11yContent,positionOption=$.extend({},this.options.position);if(!content){return;}
tooltipData=this._find(target);if(tooltipData){tooltipData.tooltip.find(".ui-tooltip-content").html(content);return;}
if(target.is("[title]")){if(event&&event.type==="mouseover"){target.attr("title","");}else{target.removeAttr("title");}}
tooltipData=this._tooltip(target);tooltip=tooltipData.tooltip;this._addDescribedBy(target,tooltip.attr("id"));tooltip.find(".ui-tooltip-content").html(content);this.liveRegion.children().hide();a11yContent=$("<div>").html(tooltip.find(".ui-tooltip-content").html());a11yContent.removeAttr("name").find("[name]").removeAttr("name");a11yContent.removeAttr("id").find("[id]").removeAttr("id");a11yContent.appendTo(this.liveRegion);function position(event){positionOption.of=event;if(tooltip.is(":hidden")){return;}
tooltip.position(positionOption);}
if(this.options.track&&event&&/^mouse/.test(event.type)){this._on(this.document,{mousemove:position});position(event);}else{tooltip.position($.extend({of:target},this.options.position));}
tooltip.hide();this._show(tooltip,this.options.show);if(this.options.track&&this.options.show&&this.options.show.delay){delayedShow=this.delayedShow=setInterval(function(){if(tooltip.is(":visible")){position(positionOption.of);clearInterval(delayedShow);}},$.fx.interval);}
this._trigger("open",event,{tooltip:tooltip});},_registerCloseHandlers:function(event,target){var events={keyup:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){var fakeEvent=$.Event(event);fakeEvent.currentTarget=target[0];this.close(fakeEvent,true);}}};if(target[0]!==this.element[0]){events.remove=function(){this._removeTooltip(this._find(target).tooltip);};}
if(!event||event.type==="mouseover"){events.mouseleave="close";}
if(!event||event.type==="focusin"){events.focusout="close";}
this._on(true,target,events);},close:function(event){var tooltip,that=this,target=$(event?event.currentTarget:this.element),tooltipData=this._find(target);if(!tooltipData){target.removeData("ui-tooltip-open");return;}
tooltip=tooltipData.tooltip;if(tooltipData.closing){return;}
clearInterval(this.delayedShow);if(target.data("ui-tooltip-title")&&!target.attr("title")){target.attr("title",target.data("ui-tooltip-title"));}
this._removeDescribedBy(target);tooltipData.hiding=true;tooltip.stop(true);this._hide(tooltip,this.options.hide,function(){that._removeTooltip($(this));});target.removeData("ui-tooltip-open");this._off(target,"mouseleave focusout keyup");if(target[0]!==this.element[0]){this._off(target,"remove");}
this._off(this.document,"mousemove");if(event&&event.type==="mouseleave"){$.each(this.parents,function(id,parent){$(parent.element).attr("title",parent.title);delete that.parents[id];});}
tooltipData.closing=true;this._trigger("close",event,{tooltip:tooltip});if(!tooltipData.hiding){tooltipData.closing=false;}},_tooltip:function(element){var tooltip=$("<div>").attr("role","tooltip"),content=$("<div>").appendTo(tooltip),id=tooltip.uniqueId().attr("id");this._addClass(content,"ui-tooltip-content");this._addClass(tooltip,"ui-tooltip","ui-widget ui-widget-content");tooltip.appendTo(this._appendTo(element));return this.tooltips[id]={element:element,tooltip:tooltip};},_find:function(target){var id=target.data("ui-tooltip-id");return id?this.tooltips[id]:null;},_removeTooltip:function(tooltip){tooltip.remove();delete this.tooltips[tooltip.attr("id")];},_appendTo:function(target){var element=target.closest(".ui-front, dialog");if(!element.length){element=this.document[0].body;}
return element;},_destroy:function(){var that=this;$.each(this.tooltips,function(id,tooltipData){var event=$.Event("blur"),element=tooltipData.element;event.target=event.currentTarget=element[0];that.close(event,true);$("#"+id).remove();if(element.data("ui-tooltip-title")){if(!element.attr("title")){element.attr("title",element.data("ui-tooltip-title"));}
element.removeData("ui-tooltip-title");}});this.liveRegion.remove();}});if($.uiBackCompat!==false){$.widget("ui.tooltip",$.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var tooltipData=this._superApply(arguments);if(this.options.tooltipClass){tooltipData.tooltip.addClass(this.options.tooltipClass);}
return tooltipData;}});}
var widgetsTooltip=$.ui.tooltip;}));;(function($){var msie=/MSIE/.test(navigator.userAgent);var style=document.createElement('div').style,moz=style['MozBorderRadius']!==undefined,webkit=style['WebkitBorderRadius']!==undefined,radius=style['borderRadius']!==undefined||style['BorderRadius']!==undefined,mode=document.documentMode||0,noBottomFold=msie&&(!mode||mode<8),expr=msie&&(function(){var div=document.createElement('div');try{div.style.setExpression('width','0+0');div.style.removeExpression('width');}
catch(e){return false;}
return true;})();$.support=$.support||{};$.support.borderRadius=moz||webkit||radius;function sz(el,p){return parseInt($.css(el,p),10)||0;}
function hex2(s){s=parseInt(s,10).toString(16);return(s.length<2)?'0'+s:s;}
function gpc(node){while(node){var v=$.css(node,'backgroundColor'),rgb;if(v&&v!='transparent'&&v!='rgba(0, 0, 0, 0)'){if(v.indexOf('rgb')>=0){rgb=v.match(/\d+/g);return'#'+hex2(rgb[0])+hex2(rgb[1])+hex2(rgb[2]);}
return v;}
if(node.nodeName.toLowerCase()=='html')
break;node=node.parentNode;}
return'#ffffff';}
function getWidth(fx,i,width){switch(fx){case'round':return Math.round(width*(1-Math.cos(Math.asin(i/width))));case'cool':return Math.round(width*(1+Math.cos(Math.asin(i/width))));case'sharp':return width-i;case'bite':return Math.round(width*(Math.cos(Math.asin((width-i-1)/width))));case'slide':return Math.round(width*(Math.atan2(i,width/i)));case'jut':return Math.round(width*(Math.atan2(width,(width-i-1))));case'curl':return Math.round(width*(Math.atan(i)));case'tear':return Math.round(width*(Math.cos(i)));case'wicked':return Math.round(width*(Math.tan(i)));case'long':return Math.round(width*(Math.sqrt(i)));case'sculpt':return Math.round(width*(Math.log((width-i-1),width)));case'dogfold':case'dog':return(i&1)?(i+1):width;case'dog2':return(i&2)?(i+1):width;case'dog3':return(i&3)?(i+1):width;case'fray':return(i%2)*width;case'notch':return width;case'bevelfold':case'bevel':return i+1;case'steep':return i/2+1;case'invsteep':return(width-i)/2+1;}}
$.fn.corner=function(options){if(this.length===0){if(!$.isReady&&this.selector){var s=this.selector,c=this.context;$(function(){$(s,c).corner(options);});}
return this;}
return this.each(function(index){var $this=$(this),o=[$this.attr($.fn.corner.defaults.metaAttr)||'',options||''].join(' ').toLowerCase(),keep=/keep/.test(o),cc=((o.match(/cc:(#[0-9a-f]+)/)||[])[1]),sc=((o.match(/sc:(#[0-9a-f]+)/)||[])[1]),width=parseInt((o.match(/(\d+)px/)||[])[1],10)||10,re=/round|bevelfold|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dogfold|dog|invsteep|steep/,fx=((o.match(re)||['round'])[0]),fold=/dogfold|bevelfold/.test(o),edges={T:0,B:1},opts={TL:/top|tl|left/.test(o),TR:/top|tr|right/.test(o),BL:/bottom|bl|left/.test(o),BR:/bottom|br|right/.test(o)},strip,pad,cssHeight,j,bot,d,ds,bw,i,w,e,c,common,$horz;if(!opts.TL&&!opts.TR&&!opts.BL&&!opts.BR)
opts={TL:1,TR:1,BL:1,BR:1};if($.fn.corner.defaults.useNative&&fx=='round'&&(radius||moz||webkit)&&!cc&&!sc){if(opts.TL)
$this.css(radius?'border-top-left-radius':moz?'-moz-border-radius-topleft':'-webkit-border-top-left-radius',width+'px');if(opts.TR)
$this.css(radius?'border-top-right-radius':moz?'-moz-border-radius-topright':'-webkit-border-top-right-radius',width+'px');if(opts.BL)
$this.css(radius?'border-bottom-left-radius':moz?'-moz-border-radius-bottomleft':'-webkit-border-bottom-left-radius',width+'px');if(opts.BR)
$this.css(radius?'border-bottom-right-radius':moz?'-moz-border-radius-bottomright':'-webkit-border-bottom-right-radius',width+'px');return;}
strip=document.createElement('div');$(strip).css({overflow:'hidden',height:'1px',minHeight:'1px',fontSize:'1px',backgroundColor:sc||'transparent',borderStyle:'solid'});pad={T:parseInt($.css(this,'paddingTop'),10)||0,R:parseInt($.css(this,'paddingRight'),10)||0,B:parseInt($.css(this,'paddingBottom'),10)||0,L:parseInt($.css(this,'paddingLeft'),10)||0};if(typeof this.style.zoom!==undefined)this.style.zoom=1;if(!keep)this.style.border='none';strip.style.borderColor=cc||gpc(this.parentNode);cssHeight=$(this).outerHeight();for(j in edges){bot=edges[j];if((bot&&(opts.BL||opts.BR))||(!bot&&(opts.TL||opts.TR))){strip.style.borderStyle='none '+(opts[j+'R']?'solid':'none')+' none '+(opts[j+'L']?'solid':'none');d=document.createElement('div');$(d).addClass('jquery-corner');ds=d.style;bot?this.appendChild(d):this.insertBefore(d,this.firstChild);if(bot&&cssHeight!='auto'){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.bottom=ds.left=ds.padding=ds.margin='0';if(expr)
ds.setExpression('width','this.parentNode.offsetWidth');else
ds.width='100%';}
else if(!bot&&msie){if($.css(this,'position')=='static')
this.style.position='relative';ds.position='absolute';ds.top=ds.left=ds.right=ds.padding=ds.margin='0';if(expr){bw=sz(this,'borderLeftWidth')+sz(this,'borderRightWidth');ds.setExpression('width','this.parentNode.offsetWidth - '+bw+'+ "px"');}
else
ds.width='100%';}
else{ds.position='relative';ds.margin=!bot?'-'+pad.T+'px -'+pad.R+'px '+(pad.T-width)+'px -'+pad.L+'px':(pad.B-width)+'px -'+pad.R+'px -'+pad.B+'px -'+pad.L+'px';}
for(i=0;i<width;i++){w=Math.max(0,getWidth(fx,i,width));e=strip.cloneNode(false);e.style.borderWidth='0 '+(opts[j+'R']?w:0)+'px 0 '+(opts[j+'L']?w:0)+'px';bot?d.appendChild(e):d.insertBefore(e,d.firstChild);}
if(fold&&$.support.boxModel){if(bot&&noBottomFold)continue;for(c in opts){if(!opts[c])continue;if(bot&&(c=='TL'||c=='TR'))continue;if(!bot&&(c=='BL'||c=='BR'))continue;common={position:'absolute',border:'none',margin:0,padding:0,overflow:'hidden',backgroundColor:strip.style.borderColor};$horz=$('<div/>').css(common).css({width:width+'px',height:'1px'});switch(c){case'TL':$horz.css({bottom:0,left:0});break;case'TR':$horz.css({bottom:0,right:0});break;case'BL':$horz.css({top:0,left:0});break;case'BR':$horz.css({top:0,right:0});break;}
d.appendChild($horz[0]);var $vert=$('<div/>').css(common).css({top:0,bottom:0,width:'1px',height:width+'px'});switch(c){case'TL':$vert.css({left:width});break;case'TR':$vert.css({right:width});break;case'BL':$vert.css({left:width});break;case'BR':$vert.css({right:width});break;}
d.appendChild($vert[0]);}}}}});};$.fn.uncorner=function(){if(radius||moz||webkit)
this.css(radius?'border-radius':moz?'-moz-border-radius':'-webkit-border-radius',0);$('div.jquery-corner',this).remove();return this;};$.fn.corner.defaults={useNative:true,metaAttr:'data-corner'};})(jQuery);
(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports==='object'){module.exports=factory;}else{factory(jQuery);}}(function($){$.fn.bgiframe=function(s){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;',conditional:/MSIE 6\.0/.test(navigator.userAgent)},s);if(!$.isFunction(s.conditional)){var condition=s.conditional;s.conditional=function(){return condition;};}
var $iframe=$('<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"'+'style="display:block;position:absolute;z-index:-1;"/>');return this.each(function(){var $this=$(this);if(s.conditional(this)===false){return;}
var existing=$this.children('iframe.bgiframe');var $el=existing.length===0?$iframe.clone():existing;$el.css({'top':s.top=='auto'?((parseInt($this.css('borderTopWidth'),10)||0)*-1)+'px':prop(s.top),'left':s.left=='auto'?((parseInt($this.css('borderLeftWidth'),10)||0)*-1)+'px':prop(s.left),'width':s.width=='auto'?(this.offsetWidth+'px'):prop(s.width),'height':s.height=='auto'?(this.offsetHeight+'px'):prop(s.height),'opacity':s.opacity===true?0:undefined});if(existing.length===0){$this.prepend($el);}});};$.fn.bgIframe=$.fn.bgiframe;function prop(n){return n&&n.constructor===Number?n+'px':n;}}));
(function($){function addEvents(ul){var settings=$.data($(ul).parents().addBack().filter('ul.jd_menu')[0],'jdMenuSettings');$('> li',ul).bind('mouseenter.jdmenu mouseleave.jdmenu',function(evt){$(this).toggleClass('jdm_hover');var ul=$('> ul',this);if(ul.length==1){clearTimeout(this.$jdTimer);var enter=(evt.type=='mouseenter');var fn=(enter?showMenu:hideMenu);this.$jdTimer=setTimeout(function(){fn(ul[0],settings.onAnimate,settings.isVertical);},enter?settings.showDelay:settings.hideDelay);}}).bind('click.jdmenu',function(evt){var ul=$('> ul',this);if(ul.length==1&&(settings.disableLinks==true||$(this).hasClass('accessible'))){showMenu(ul,settings.onAnimate,settings.isVertical);return false;}
if(evt.target==this){var link=$('> a',evt.target).not('.accessible');if(link.length>0){var a=link[0];if(!a.onclick){window.open(a.href,a.target||'_self');}else{$(a).trigger('click');}}}
if(settings.disableLinks||(!settings.disableLinks&&!$(this).parent().hasClass('jd_menu'))){$(this).parent().jdMenuHide();evt.stopPropagation();}}).find('> a').bind('focus.jdmenu blur.jdmenu',function(evt){var p=$(this).parents('li:eq(0)');if(evt.type=='focus'){p.addClass('jdm_hover');}else{p.removeClass('jdm_hover');}}).filter('.accessible').bind('click.jdmenu',function(evt){evt.preventDefault();});}
function showMenu(ul,animate,vertical){var ul=$(ul);if(ul.is(':visible')){return;}
ul.bgiframe();var li=ul.parent();ul.trigger('jdMenuShow').positionBy({target:li[0],targetPos:(vertical===true||!li.parent().hasClass('jd_menu')?1:3),elementPos:0,hideAfterPosition:true});if(!ul.hasClass('jdm_events')){ul.addClass('jdm_events');addEvents(ul);}
li.addClass('jdm_active').siblings('li').find('> ul:eq(0):visible').each(function(){hideMenu(this);});if(animate===undefined){ul.show();}else{animate.apply(ul[0],[true]);}}
function hideMenu(ul,animate){var ul=$(ul);$('.bgiframe',ul).remove();ul.filter(':not(.jd_menu)').find('> li > ul:eq(0):visible').each(function(){hideMenu(this);}).end();if(animate===undefined){ul.hide()}else{animate.apply(ul[0],[false]);}
ul.trigger('jdMenuHide').parents('li:eq(0)').removeClass('jdm_active jdm_hover').end().find('> li').removeClass('jdm_active jdm_hover');}
$.fn.jdMenu=function(settings){var settings=$.extend({showDelay:200,hideDelay:500,disableLinks:true},settings);if(!$.isFunction(settings.onAnimate)){settings.onAnimate=undefined;}
return this.filter('ul.jd_menu').each(function(){$.data(this,'jdMenuSettings',$.extend({isVertical:$(this).hasClass('jd_menu_vertical')},settings));addEvents(this);});};$.fn.jdMenuUnbind=function(){$('ul.jdm_events',this).unbind('.jdmenu').find('> a').unbind('.jdmenu');};$.fn.jdMenuHide=function(){return this.filter('ul').each(function(){hideMenu(this);});};$(window).bind('click.jdmenu',function(){$('ul.jd_menu ul:visible').jdMenuHide();});})(jQuery);$(function(){$('ul.jd_menu').jdMenu();});
(function($){var Range=function(x1,y1,x2,y2){this.x1=x1;this.x2=x2;this.y1=y1;this.y2=y2;};Range.prototype.contains=function(range){return(this.x1<=range.x1&&range.x2<=this.x2)&&(this.y1<=range.y1&&range.y2<=this.y2);};Range.prototype.transform=function(x,y){return new Range(this.x1+x,this.y1+y,this.x2+x,this.y2+y);};$.fn.positionBy=function(args){var date1=new Date();if(this.length==0){return this;}
var args=$.extend({target:null,targetPos:null,elementPos:null,x:null,y:null,positions:null,addClass:false,force:false,container:window,hideAfterPosition:false},args);if(args.x!=null){var tLeft=args.x;var tTop=args.y;var tWidth=0;var tHeight=0;}else{var $target=$($(args.target)[0]);var tWidth=$target.outerWidth();var tHeight=$target.outerHeight();var tOffset=$target.offset();var tLeft=tOffset.left;var tTop=tOffset.top;}
var tRight=tLeft+tWidth;var tBottom=tTop+tHeight;return this.each(function(){var $element=$(this);if(!$element.is(':visible')){$element.css({left:-3000,top:-3000}).show();}
var eWidth=$element.outerWidth();var eHeight=$element.outerHeight();var position=[];var next=[];position[0]=new Range(tRight,tTop,tRight+eWidth,tTop+eHeight);next[0]=[1,7,4];position[1]=new Range(tRight,tBottom-eHeight,tRight+eWidth,tBottom);next[1]=[0,6,4];position[2]=new Range(tRight,tBottom,tRight+eWidth,tBottom+eHeight);next[2]=[1,3,10];position[3]=new Range(tRight-eWidth,tBottom,tRight,tBottom+eHeight);next[3]=[1,6,10];position[4]=new Range(tLeft,tBottom,tLeft+eWidth,tBottom+eHeight);next[4]=[1,6,9];position[5]=new Range(tLeft-eWidth,tBottom,tLeft,tBottom+eHeight);next[5]=[6,4,9];position[6]=new Range(tLeft-eWidth,tBottom-eHeight,tLeft,tBottom);next[6]=[7,1,4];position[7]=new Range(tLeft-eWidth,tTop,tLeft,tTop+eHeight);next[7]=[6,0,4];position[8]=new Range(tLeft-eWidth,tTop-eHeight,tLeft,tTop);next[8]=[7,9,4];position[9]=new Range(tLeft,tTop-eHeight,tLeft+eWidth,tTop);next[9]=[0,7,4];position[10]=new Range(tRight-eWidth,tTop-eHeight,tRight,tTop);next[10]=[0,7,3];position[11]=new Range(tRight,tTop-eHeight,tRight+eWidth,tTop);next[11]=[0,10,3];position[12]=new Range(tRight-eWidth,tTop,tRight,tTop+eHeight);next[12]=[13,7,10];position[13]=new Range(tRight-eWidth,tBottom-eHeight,tRight,tBottom);next[13]=[12,6,3];position[14]=new Range(tLeft,tBottom-eHeight,tLeft+eWidth,tBottom);next[14]=[15,1,4];position[15]=new Range(tLeft,tTop,tLeft+eWidth,tTop+eHeight);next[15]=[14,0,9];if(args.positions!==null){var pos=args.positions[0];}else if(args.targetPos!=null&&args.elementPos!=null){var pos=[];pos[0]=[];pos[0][0]=15;pos[0][1]=7;pos[0][2]=8;pos[0][3]=9;pos[1]=[];pos[1][0]=0;pos[1][1]=12;pos[1][2]=10;pos[1][3]=11;pos[2]=[];pos[2][0]=2;pos[2][1]=3;pos[2][2]=13;pos[2][3]=1;pos[3]=[];pos[3][0]=4;pos[3][1]=5;pos[3][2]=6;pos[3][3]=14;var pos=pos[args.targetPos][args.elementPos];}
var ePos=position[pos];var fPos=pos;if(!args.force){$window=$(window);var sx=$window.scrollLeft();var sy=$window.scrollTop();var container=new Range(sx,sy,sx+$window.width(),sy+$window.height());var stack;if(args.positions){stack=args.positions;}else{stack=[pos];}
var test=[];while(stack.length>0){var p=stack.shift();if(test[p]){continue;}
test[p]=true;if(!container.contains(position[p])){if(args.positions===null){stack=jQuery.merge(stack,next[p]);}}else{ePos=position[p];break;}}}
$element.parents().each(function(){var $this=$(this);if($this.css('position')!='static'){var abs=$this.offset();ePos=ePos.transform(-abs.left,-abs.top);return false;}});var css={left:ePos.x1,top:ePos.y1};if(args.hideAfterPosition){css['display']='none';}
$element.css(css);if(args.addClass){$element.removeClass('positionBy0 positionBy1 positionBy2 positionBy3 positionBy4 positionBy5 '
+'positionBy6 positionBy7 positionBy8 positionBy9 positionBy10 positionBy11 '
+'positionBy12 positionBy13 positionBy14 positionBy15').addClass('positionBy'+p);}});};})(jQuery);;(function(){"use strict";function setup($){$.fn._fadeIn=$.fn.fadeIn;var noOp=$.noop||function(){};var msie=/MSIE/.test(navigator.userAgent);var ie6=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent);var mode=document.documentMode||0;var setExpr=$.isFunction(document.createElement('div').style.setExpression);$.blockUI=function(opts){install(window,opts);};$.unblockUI=function(opts){remove(window,opts);};$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');if(title)$m.append('<h1>'+title+'</h1>');if(message)$m.append('<h2>'+message+'</h2>');if(timeout===undefined)timeout=3000;var callBlock=function(opts){opts=opts||{};$.blockUI({message:$m,fadeIn:typeof opts.fadeIn!=='undefined'?opts.fadeIn:700,fadeOut:typeof opts.fadeOut!=='undefined'?opts.fadeOut:1000,timeout:typeof opts.timeout!=='undefined'?opts.timeout:timeout,centerY:false,showOverlay:false,onUnblock:onClose,css:$.blockUI.defaults.growlCSS});};callBlock();var nonmousedOpacity=$m.css('opacity');$m.mouseover(function(){callBlock({fadeIn:0,timeout:30000});var displayBlock=$('.blockMsg');displayBlock.stop();displayBlock.fadeTo(300,1);}).mouseout(function(){$('.blockMsg').fadeOut(1000);});};$.fn.block=function(opts){if(this[0]===window){$.blockUI(opts);return this;}
var fullOpts=$.extend({},$.blockUI.defaults,opts||{});this.each(function(){var $el=$(this);if(fullOpts.ignoreIfBlocked&&$el.data('blockUI.isBlocked'))
return;$el.unblock({fadeOut:0});});return this.each(function(){if($.css(this,'position')=='static'){this.style.position='relative';$(this).data('blockUI.static',true);}
this.style.zoom=1;install(this,opts);});};$.fn.unblock=function(opts){if(this[0]===window){$.unblockUI(opts);return this;}
return this.each(function(){remove(this,opts);});};$.blockUI.version=2.66;$.blockUI.defaults={message:'<h1>Please wait...</h1>',title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:'30%',top:'40%',left:'35%',textAlign:'center',color:'#000',border:'3px solid #aaa',backgroundColor:'#fff',cursor:'wait'},themedCSS:{width:'30%',top:'40%',left:'35%'},overlayCSS:{backgroundColor:'#000',opacity:0.6,cursor:'wait'},cursorReset:'default',growlCSS:{width:'350px',top:'10px',left:'',right:'10px',border:'none',padding:'5px',opacity:0.6,cursor:'default',color:'#fff',backgroundColor:'#000','-webkit-border-radius':'10px','-moz-border-radius':'10px','border-radius':'10px'},iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank',forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:400,timeout:0,showOverlay:true,focusInput:true,focusableElements:':input:enabled:visible',onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:'blockMsg',ignoreIfBlocked:false};var pageBlock=null;var pageBlockEls=[];function install(el,opts){var css,themedCSS;var full=(el==window);var msg=(opts&&opts.message!==undefined?opts.message:undefined);opts=$.extend({},$.blockUI.defaults,opts||{});if(opts.ignoreIfBlocked&&$(el).data('blockUI.isBlocked'))
return;opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{});css=$.extend({},$.blockUI.defaults.css,opts.css||{});if(opts.onOverlayClick)
opts.overlayCSS.cursor='pointer';themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{});msg=msg===undefined?opts.message:msg;if(full&&pageBlock)
remove(window,{fadeOut:0});if(msg&&typeof msg!='string'&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg;var data={};$(el).data('blockUI.history',data);data.el=node;data.parent=node.parentNode;data.display=node.style.display;data.position=node.style.position;if(data.parent)
data.parent.removeChild(node);}
$(el).data('blockUI.onUnblock',opts.onUnblock);var z=opts.baseZ;var lyr1,lyr2,lyr3,s;if(msie||opts.forceIframe)
lyr1=$('<iframe class="blockUI" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>');else
lyr1=$('<div class="blockUI" style="display:none"></div>');if(opts.theme)
lyr2=$('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+(z++)+';display:none"></div>');else
lyr2=$('<div class="blockUI blockOverlay" style="z-index:'+(z++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');if(opts.theme&&full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">';if(opts.title){s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||'&nbsp;')+'</div>';}
s+='<div class="ui-widget-content ui-dialog-content"></div>';s+='</div>';}
else if(opts.theme){s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">';if(opts.title){s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||'&nbsp;')+'</div>';}
s+='<div class="ui-widget-content ui-dialog-content"></div>';s+='</div>';}
else if(full){s='<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>';}
else{s='<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>';}
lyr3=$(s);if(msg){if(opts.theme){lyr3.css(themedCSS);lyr3.addClass('ui-widget-content');}
else
lyr3.css(css);}
if(!opts.theme)
lyr2.css(opts.overlayCSS);lyr2.css('position',full?'fixed':'absolute');if(msie||opts.forceIframe)
lyr1.css('opacity',0.0);var layers=[lyr1,lyr2,lyr3],$par=full?$('body'):$(el);$.each(layers,function(){this.appendTo($par);});if(opts.theme&&opts.draggable&&$.fn.draggable){lyr3.draggable({handle:'.ui-dialog-titlebar',cancel:'li'});}
var expr=setExpr&&(!$.support.boxModel||$('object,embed',full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.support.boxModel)
$('html,body').css('height','100%');if((ie6||!$.support.boxModel)&&!full){var t=sz(el,'borderTopWidth'),l=sz(el,'borderLeftWidth');var fixT=t?'(0 - '+t+')':0;var fixL=l?'(0 - '+l+')':0;}
$.each(layers,function(i,o){var s=o[0].style;s.position='absolute';if(i<2){if(full)
s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"');else
s.setExpression('height','this.parentNode.offsetHeight + "px"');if(full)
s.setExpression('width','jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"');else
s.setExpression('width','this.parentNode.offsetWidth + "px"');if(fixL)s.setExpression('left',fixL);if(fixT)s.setExpression('top',fixT);}
else if(opts.centerY){if(full)s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');s.marginTop=0;}
else if(!opts.centerY&&full){var top=(opts.css&&opts.css.top)?parseInt(opts.css.top,10):0;var expression='((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';s.setExpression('top',expression);}});}
if(msg){if(opts.theme)
lyr3.find('.ui-widget-content').append(msg);else
lyr3.append(msg);if(msg.jquery||msg.nodeType)
$(msg).show();}
if((msie||opts.forceIframe)&&opts.showOverlay)
lyr1.show();if(opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp;var cb1=(opts.showOverlay&&!msg)?cb:noOp;var cb2=msg?cb:noOp;if(opts.showOverlay)
lyr2._fadeIn(opts.fadeIn,cb1);if(msg)
lyr3._fadeIn(opts.fadeIn,cb2);}
else{if(opts.showOverlay)
lyr2.show();if(msg)
lyr3.show();if(opts.onBlock)
opts.onBlock();}
bind(1,el,opts);if(full){pageBlock=lyr3[0];pageBlockEls=$(opts.focusableElements,pageBlock);if(opts.focusInput)
setTimeout(focus,20);}
else
center(lyr3[0],opts.centerX,opts.centerY);if(opts.timeout){var to=setTimeout(function(){if(full)
$.unblockUI(opts);else
$(el).unblock(opts);},opts.timeout);$(el).data('blockUI.timeout',to);}}
function remove(el,opts){var count;var full=(el==window);var $el=$(el);var data=$el.data('blockUI.history');var to=$el.data('blockUI.timeout');if(to){clearTimeout(to);$el.removeData('blockUI.timeout');}
opts=$.extend({},$.blockUI.defaults,opts||{});bind(0,el,opts);if(opts.onUnblock===null){opts.onUnblock=$el.data('blockUI.onUnblock');$el.removeData('blockUI.onUnblock');}
var els;if(full)
els=$('body').children().filter('.blockUI').add('body > .blockUI');else
els=$el.find('>.blockUI');if(opts.cursorReset){if(els.length>1)
els[1].style.cursor=opts.cursorReset;if(els.length>2)
els[2].style.cursor=opts.cursorReset;}
if(full)
pageBlock=pageBlockEls=null;if(opts.fadeOut){count=els.length;els.stop().fadeOut(opts.fadeOut,function(){if(--count===0)
reset(els,data,opts,el);});}
else
reset(els,data,opts,el);}
function reset(els,data,opts,el){var $el=$(el);if($el.data('blockUI.isBlocked'))
return;els.each(function(i,o){if(this.parentNode)
this.parentNode.removeChild(this);});if(data&&data.el){data.el.style.display=data.display;data.el.style.position=data.position;if(data.parent)
data.parent.appendChild(data.el);$el.removeData('blockUI.history');}
if($el.data('blockUI.static')){$el.css('position','static');}
if(typeof opts.onUnblock=='function')
opts.onUnblock(el,opts);var body=$(document.body),w=body.width(),cssW=body[0].style.width;body.width(w-1).width(w);body[0].style.width=cssW;}
function bind(b,el,opts){var full=el==window,$el=$(el);if(!b&&(full&&!pageBlock||!full&&!$el.data('blockUI.isBlocked')))
return;$el.data('blockUI.isBlocked',b);if(!full||!opts.bindEvents||(b&&!opts.showOverlay))
return;var events='mousedown mouseup keydown keypress keyup touchstart touchend touchmove';if(b)
$(document).bind(events,opts,handler);else
$(document).unbind(events,handler);}
function handler(e){if(e.type==='keydown'&&e.keyCode&&e.keyCode==9){if(pageBlock&&e.data.constrainTabKey){var els=pageBlockEls;var fwd=!e.shiftKey&&e.target===els[els.length-1];var back=e.shiftKey&&e.target===els[0];if(fwd||back){setTimeout(function(){focus(back);},10);return false;}}}
var opts=e.data;var target=$(e.target);if(target.hasClass('blockOverlay')&&opts.onOverlayClick)
opts.onOverlayClick(e);if(target.parents('div.'+opts.blockMsgClass).length>0)
return true;return target.parents().children().filter('div.blockUI').length===0;}
function focus(back){if(!pageBlockEls)
return;var e=pageBlockEls[back===true?pageBlockEls.length-1:0];if(e)
e.focus();}
function center(el,x,y){var p=el.parentNode,s=el.style;var l=((p.offsetWidth-el.offsetWidth)/2)-sz(p,'borderLeftWidth');var t=((p.offsetHeight-el.offsetHeight)/2)-sz(p,'borderTopWidth');if(x)s.left=l>0?(l+'px'):'0';if(y)s.top=t>0?(t+'px'):'0';}
function sz(el,p){return parseInt($.css(el,p),10)||0;}}
if(typeof define==='function'&&define.amd&&define.amd.jQuery){define(['jquery'],setup);}else{setup(jQuery);}})();
jQuery.fn.extend({reverse:function(event){var events;if((events=$._data(this[0],"events"))&&events[event]){var reverseEvent=new Array;for(var e in events[event]){reverseEvent.unshift(events[event][e]);}
events[event]=reverseEvent;}
return this;},stack:function(event,data,fn){return this.reverse(event).bind(event,data,fn).reverse(event);},hover:function(fnOver,fnOut,reverse){if(reverse){return this.stack('mouseenter',fnOver).stack('mouseout',fnOut);}else{return this.bind('mouseenter',fnOver).bind('mouseout',fnOut);}}});jQuery.each(("blur,focus,load,resize,scroll,unload,click,dblclick,"+"mousedown,mouseup,mousemove,mouseover,mouseout,change,select,"+"submit,keydown,keypress,keyup,error").split(","),function(i,name){jQuery.fn[name]=function(fn,reverse){if(fn){return reverse?this.stack(name,fn):this.bind(name,fn);}else{return this.trigger(name);}};});
(function($){$.i18n={};$.i18n.map={};$.i18n.properties=function(settings){var defaults={name:'Messages',language:'',path:'',mode:'vars',callback:function(){}};settings=$.extend(defaults,settings);if(settings.language===null||settings.language==''){settings.language=$.i18n.browserLang();}
if(settings.language===null){settings.language='';}
var files=getFiles(settings.name);for(i=0;i<files.length;i++){loadAndParseFile(settings.path+files[i]+'.properties',settings.language,settings.mode);if(settings.language.length>=2){loadAndParseFile(settings.path+files[i]+'_'+settings.language.substring(0,2)+'.properties',settings.language,settings.mode);}
if(settings.language.length>=5){loadAndParseFile(settings.path+files[i]+'_'+settings.language.substring(0,5)+'.properties',settings.language,settings.mode);}}
if(settings.callback){settings.callback();}};$.i18n.prop=function(key,placeHolderValues){var value=$.i18n.map[key];if(value==null){return'['+key+']';}
if(!placeHolderValues){return value;}else{for(var i=0;i<placeHolderValues.length;i++){var regexp=new RegExp('\\{('+i+')\\}',"g");value=value.replace(regexp,placeHolderValues[i]);}
return value;}};$.i18n.browserLang=function(){return normaliseLanguageCode(navigator.language||navigator.userLanguage);}
function loadAndParseFile(filename,language,mode){$.ajax({url:filename,async:false,contentType:"application/x-www-form-urlencoded",dataType:'text',success:function(data,status){var parsed='';var parameters=data!=undefined?data.split(/\n/):[];var regPlaceHolder=/(\{\d+\})/g;var regRepPlaceHolder=/\{(\d+)\}/g;var unicodeRE=/(\\u.{4})/ig;for(var i=0;i<parameters.length;i++){parameters[i]=parameters[i].replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(parameters[i].length>0&&parameters[i].match("^#")!="#"){var pair=parameters[i].split('=');if(pair.length>0){var name=unescape(pair[0]).replace(/^\s\s*/,'').replace(/\s\s*$/,'');var value=pair.length==1?"":pair[1];for(var s=2;s<pair.length;s++){value+='='+pair[s];}
value=value.replace(/"/g,'\\"');value=value.replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(mode=='map'||mode=='both'){var unicodeMatches=value.match(unicodeRE);if(unicodeMatches){for(var u=0;u<unicodeMatches.length;u++){value=value.replace(unicodeMatches[u],unescapeUnicode(unicodeMatches[u]));}}
$.i18n.map[name]=value;}
if(mode=='vars'||mode=='both'){checkKeyNamespace(name);if(regPlaceHolder.test(value)){var parts=value.split(regPlaceHolder);var first=true;var fnArgs='';var usedArgs=[];for(var p=0;p<parts.length;p++){if(regPlaceHolder.test(parts[p])&&usedArgs.indexOf(parts[p])==-1){if(!first){fnArgs+=',';}
fnArgs+=parts[p].replace(regRepPlaceHolder,'v$1');usedArgs.push(parts[p]);first=false;}}
parsed+=name+'=function('+fnArgs+'){';var fnExpr='"'+value.replace(regRepPlaceHolder,'"+v$1+"')+'"';parsed+='return '+fnExpr+';'+'};';}else{parsed+=name+'="'+value+'";';}}}}}
eval(parsed);}});}
function checkKeyNamespace(key){var regDot=/\./;if(regDot.test(key)){var fullname='';var names=key.split(/\./);for(var i=0;i<names.length;i++){if(i>0){fullname+='.';}
fullname+=names[i];if(eval('typeof '+fullname+' == "undefined"')){eval(fullname+'={};');}}}}
function getFiles(names){return(names&&names.constructor==Array)?names:[names];}
function normaliseLanguageCode(lang){lang=lang.toLowerCase();if(lang.length>3){lang=lang.substring(0,3)+lang.substring(3).toUpperCase();}
return lang;}
function unescapeUnicode(str){var codes=[];var code=parseInt(str.substr(2),16);if(code>=0&&code<Math.pow(2,16)){codes.push(code);}
var unescaped='';for(var i=0;i<codes.length;++i){unescaped+=String.fromCharCode(codes[i]);}
return unescaped;}})(jQuery);

jQuery(function($){$.datepicker.regional['af']={closeText:'Selekteer',prevText:'Vorige',nextText:'Volgende',currentText:'Vandag',monthNames:['Januarie','Februarie','Maart','April','Mei','Junie','Julie','Augustus','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mrt','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNames:['Sondag','Maandag','Dinsdag','Woensdag','Donderdag','Vrydag','Saterdag'],dayNamesShort:['Son','Maa','Din','Woe','Don','Vry','Sat'],dayNamesMin:['So','Ma','Di','Wo','Do','Vr','Sa'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['af']);});
jQuery(function($){$.datepicker.regional['ar']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:[' ','','','','','','','','',' ',' ',' '],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ar']);});
jQuery(function($){$.datepicker.regional['az']={closeText:'Bala',prevText:'&#x3c;Geri',nextText:'rli&#x3e;',currentText:'Bugn',monthNames:['Yanvar','Fevral','Mart','Aprel','May','yun','yul','Avqust','Sentyabr','Oktyabr','Noyabr','Dekabr'],monthNamesShort:['Yan','Fev','Mar','Apr','May','yun','yul','Avq','Sen','Okt','Noy','Dek'],dayNames:['Bazar','Bazar ertsi','rnb axam','rnb','Cm axam','Cm','nb'],dayNamesShort:['B','Be','a','','Ca','C',''],dayNamesMin:['B','B','','','','C',''],weekHeader:'Hf',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['az']);});
jQuery(function($){$.datepicker.regional['bg']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',nextBigText:'&#x3e;&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'Wk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['bg']);});
jQuery(function($){$.datepicker.regional['bs']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Januar','Februar','Mart','April','Maj','Juni','Juli','August','Septembar','Oktobar','Novembar','Decembar'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljak','Utorak','Srijeda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sri','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Wk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['bs']);});jQuery(function($){$.datepicker.regional['ca']={closeText:'Tancar',prevText:'&#x3c;Ant',nextText:'Seg&#x3e;',currentText:'Avui',monthNames:['Gener','Febrer','Mar&ccedil;','Abril','Maig','Juny','Juliol','Agost','Setembre','Octubre','Novembre','Desembre'],monthNamesShort:['Gen','Feb','Mar','Abr','Mai','Jun','Jul','Ago','Set','Oct','Nov','Des'],dayNames:['Diumenge','Dilluns','Dimarts','Dimecres','Dijous','Divendres','Dissabte'],dayNamesShort:['Dug','Dln','Dmt','Dmc','Djs','Dvn','Dsb'],dayNamesMin:['Dg','Dl','Dt','Dc','Dj','Dv','Ds'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ca']);});
jQuery(function($){$.datepicker.regional['cs']={closeText:'Zavt',prevText:'&#x3c;Dve',nextText:'Pozdji&#x3e;',currentText:'Nyn',monthNames:['leden','nor','bezen','duben','kvten','erven','ervenec','srpen','z','jen','listopad','prosinec'],monthNamesShort:['led','no','be','dub','kv','er','vc','srp','z','j','lis','pro'],dayNames:['nedle','pondl','ter','steda','tvrtek','ptek','sobota'],dayNamesShort:['ne','po','t','st','t','p','so'],dayNamesMin:['ne','po','t','st','t','p','so'],weekHeader:'Td',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['cs']);});
jQuery(function($){$.datepicker.regional['da']={closeText:'Luk',prevText:'&#x3c;Forrige',nextText:'Nste&#x3e;',currentText:'Idag',monthNames:['Januar','Februar','Marts','April','Maj','Juni','Juli','August','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNames:['Sndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesShort:['Sn','Man','Tir','Ons','Tor','Fre','Lr'],dayNamesMin:['S','Ma','Ti','On','To','Fr','L'],weekHeader:'Uge',dateFormat:'dd-mm-yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['da']);});
jQuery(function($){$.datepicker.regional['de']={closeText:'schlieen',prevText:'&#x3c;zurck',nextText:'Vor&#x3e;',currentText:'heute',monthNames:['Januar','Februar','Mrz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'],monthNamesShort:['Jan','Feb','Mr','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'],dayNames:['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'],dayNamesShort:['So','Mo','Di','Mi','Do','Fr','Sa'],dayNamesMin:['So','Mo','Di','Mi','Do','Fr','Sa'],weekHeader:'Wo',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['de']);});
jQuery(function($){$.datepicker.regional['el']={closeText:'',prevText:'',nextText:'',currentText:' ',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['el']);});
jQuery(function($){$.datepicker.regional['en-GB']={closeText:'Done',prevText:'Prev',nextText:'Next',currentText:'Today',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],dayNamesMin:['Su','Mo','Tu','We','Th','Fr','Sa'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['en-GB']);});
jQuery(function($){$.datepicker.regional['eo']={closeText:'Fermi',prevText:'&lt;Anta',nextText:'Sekv&gt;',currentText:'Nuna',monthNames:['Januaro','Februaro','Marto','Aprilo','Majo','Junio','Julio','Agusto','Septembro','Oktobro','Novembro','Decembro'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Ag','Sep','Okt','Nov','Dec'],dayNames:['Dimano','Lundo','Mardo','Merkredo','ado','Vendredo','Sabato'],dayNamesShort:['Dim','Lun','Mar','Mer','a','Ven','Sab'],dayNamesMin:['Di','Lu','Ma','Me','a','Ve','Sa'],weekHeader:'Sb',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['eo']);});jQuery(function($){$.datepicker.regional['es']={closeText:'Cerrar',prevText:'&#x3c;Ant',nextText:'Sig&#x3e;',currentText:'Hoy',monthNames:['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'],monthNamesShort:['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'],dayNames:['Domingo','Lunes','Martes','Mi&eacute;rcoles','Jueves','Viernes','S&aacute;bado'],dayNamesShort:['Dom','Lun','Mar','Mi&eacute;','Juv','Vie','S&aacute;b'],dayNamesMin:['Do','Lu','Ma','Mi','Ju','Vi','S&aacute;'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['es']);});
jQuery(function($){$.datepicker.regional['et']={closeText:'Sulge',prevText:'Eelnev',nextText:'Jrgnev',currentText:'Tna',monthNames:['Jaanuar','Veebruar','Mrts','Aprill','Mai','Juuni','Juuli','August','September','Oktoober','November','Detsember'],monthNamesShort:['Jaan','Veebr','Mrts','Apr','Mai','Juuni','Juuli','Aug','Sept','Okt','Nov','Dets'],dayNames:['Phapev','Esmaspev','Teisipev','Kolmapev','Neljapev','Reede','Laupev'],dayNamesShort:['Phap','Esmasp','Teisip','Kolmap','Neljap','Reede','Laup'],dayNamesMin:['P','E','T','K','N','R','L'],weekHeader:'Sm',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['et']);});
jQuery(function($){$.datepicker.regional['eu']={closeText:'Egina',prevText:'&#x3c;Aur',nextText:'Hur&#x3e;',currentText:'Gaur',monthNames:['Urtarrila','Otsaila','Martxoa','Apirila','Maiatza','Ekaina','Uztaila','Abuztua','Iraila','Urria','Azaroa','Abendua'],monthNamesShort:['Urt','Ots','Mar','Api','Mai','Eka','Uzt','Abu','Ira','Urr','Aza','Abe'],dayNames:['Igandea','Astelehena','Asteartea','Asteazkena','Osteguna','Ostirala','Larunbata'],dayNamesShort:['Iga','Ast','Ast','Ast','Ost','Ost','Lar'],dayNamesMin:['Ig','As','As','As','Os','Os','La'],weekHeader:'Wk',dateFormat:'yy/mm/dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['eu']);});
jQuery(function($){$.datepicker.regional['fa']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:6,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fa']);});jQuery(function($){$.datepicker.regional['fi']={closeText:'Sulje',prevText:'&laquo;Edellinen',nextText:'Seuraava&raquo;',currentText:'T&auml;n&auml;&auml;n',monthNames:['Tammikuu','Helmikuu','Maaliskuu','Huhtikuu','Toukokuu','Kes&auml;kuu','Hein&auml;kuu','Elokuu','Syyskuu','Lokakuu','Marraskuu','Joulukuu'],monthNamesShort:['Tammi','Helmi','Maalis','Huhti','Touko','Kes&auml;','Hein&auml;','Elo','Syys','Loka','Marras','Joulu'],dayNamesShort:['Su','Ma','Ti','Ke','To','Pe','Su'],dayNames:['Sunnuntai','Maanantai','Tiistai','Keskiviikko','Torstai','Perjantai','Lauantai'],dayNamesMin:['Su','Ma','Ti','Ke','To','Pe','La'],weekHeader:'Vk',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fi']);});
jQuery(function($){$.datepicker.regional['fo']={closeText:'Lat aftur',prevText:'&#x3c;Fyrra',nextText:'Nsta&#x3e;',currentText:' dag',monthNames:['Januar','Februar','Mars','Aprl','Mei','Juni','Juli','August','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNames:['Sunnudagur','Mnadagur','Tsdagur','Mikudagur','Hsdagur','Frggjadagur','Leyardagur'],dayNamesShort:['Sun','Mn','Ts','Mik','Hs','Fr','Ley'],dayNamesMin:['Su','M','T','Mi','H','Fr','Le'],weekHeader:'Vk',dateFormat:'dd-mm-yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fo']);});
jQuery(function($){$.datepicker.regional['fr-CH']={closeText:'Fermer',prevText:'&#x3c;Prc',nextText:'Suiv&#x3e;',currentText:'Courant',monthNames:['Janvier','Fvrier','Mars','Avril','Mai','Juin','Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],monthNamesShort:['Jan','Fv','Mar','Avr','Mai','Jun','Jul','Ao','Sep','Oct','Nov','Dc'],dayNames:['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],dayNamesShort:['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],dayNamesMin:['Di','Lu','Ma','Me','Je','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fr-CH']);});
jQuery(function($){$.datepicker.regional['fr']={closeText:'Fermer',prevText:'&#x3c;Prc',nextText:'Suiv&#x3e;',currentText:'Courant',monthNames:['Janvier','Fvrier','Mars','Avril','Mai','Juin','Juillet','Aot','Septembre','Octobre','Novembre','Dcembre'],monthNamesShort:['Jan','Fv','Mar','Avr','Mai','Jun','Jul','Ao','Sep','Oct','Nov','Dc'],dayNames:['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],dayNamesShort:['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],dayNamesMin:['Di','Lu','Ma','Me','Je','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['fr']);});
jQuery(function($){$.datepicker.regional['he']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['\'','\'','\'','\'','\'','\'',''],dayNamesMin:['\'','\'','\'','\'','\'','\'',''],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:0,isRTL:true,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['he']);});
jQuery(function($){$.datepicker.regional['hr']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Sijeanj','Veljaa','Oujak','Travanj','Svibanj','Lipanj','Srpanj','Kolovoz','Rujan','Listopad','Studeni','Prosinac'],monthNamesShort:['Sij','Velj','Ou','Tra','Svi','Lip','Srp','Kol','Ruj','Lis','Stu','Pro'],dayNames:['Nedjelja','Ponedjeljak','Utorak','Srijeda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sri','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Tje',dateFormat:'dd.mm.yy.',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hr']);});jQuery(function($){$.datepicker.regional['hu']={closeText:'bezrs',prevText:'&laquo;&nbsp;vissza',nextText:'elre&nbsp;&raquo;',currentText:'ma',monthNames:['Janur','Februr','Mrcius','prilis','Mjus','Jnius','Jlius','Augusztus','Szeptember','Oktber','November','December'],monthNamesShort:['Jan','Feb','Mr','pr','Mj','Jn','Jl','Aug','Szep','Okt','Nov','Dec'],dayNames:['Vasrnap','Htf','Kedd','Szerda','Cstrtk','Pntek','Szombat'],dayNamesShort:['Vas','Ht','Ked','Sze','Cs','Pn','Szo'],dayNamesMin:['V','H','K','Sze','Cs','P','Szo'],weekHeader:'H',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hu']);});jQuery(function($){$.datepicker.regional['hy']={closeText:'',prevText:'&#x3c;.',nextText:'.&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['hy']);});jQuery(function($){$.datepicker.regional['id']={closeText:'Tutup',prevText:'&#x3c;mundur',nextText:'maju&#x3e;',currentText:'hari ini',monthNames:['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','Nopember','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agus','Sep','Okt','Nop','Des'],dayNames:['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'],dayNamesShort:['Min','Sen','Sel','Rab','kam','Jum','Sab'],dayNamesMin:['Mg','Sn','Sl','Rb','Km','jm','Sb'],weekHeader:'Mg',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['id']);});jQuery(function($){$.datepicker.regional['is']={closeText:'Loka',prevText:'&#x3c; Fyrri',nextText:'N&aelig;sti &#x3e;',currentText:'&Iacute; dag',monthNames:['Jan&uacute;ar','Febr&uacute;ar','Mars','Apr&iacute;l','Ma&iacute','J&uacute;n&iacute;','J&uacute;l&iacute;','&Aacute;g&uacute;st','September','Okt&oacute;ber','N&oacute;vember','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Ma&iacute;','J&uacute;n','J&uacute;l','&Aacute;g&uacute;','Sep','Okt','N&oacute;v','Des'],dayNames:['Sunnudagur','M&aacute;nudagur','&THORN;ri&eth;judagur','Mi&eth;vikudagur','Fimmtudagur','F&ouml;studagur','Laugardagur'],dayNamesShort:['Sun','M&aacute;n','&THORN;ri','Mi&eth;','Fim','F&ouml;s','Lau'],dayNamesMin:['Su','M&aacute;','&THORN;r','Mi','Fi','F&ouml;','La'],weekHeader:'Vika',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['is']);});jQuery(function($){$.datepicker.regional['it']={closeText:'Chiudi',prevText:'&#x3c;Prec',nextText:'Succ&#x3e;',currentText:'Oggi',monthNames:['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'],monthNamesShort:['Gen','Feb','Mar','Apr','Mag','Giu','Lug','Ago','Set','Ott','Nov','Dic'],dayNames:['Domenica','Luned&#236','Marted&#236','Mercoled&#236','Gioved&#236','Venerd&#236','Sabato'],dayNamesShort:['Dom','Lun','Mar','Mer','Gio','Ven','Sab'],dayNamesMin:['Do','Lu','Ma','Me','Gi','Ve','Sa'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['it']);});
jQuery(function($){$.datepicker.regional['ja']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['1','2','3','4','5','6','7','8','9','10','11','12'],monthNamesShort:['1','2','3','4','5','6','7','8','9','10','11','12'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ja']);});jQuery(function($){$.datepicker.regional['ko']={closeText:'',prevText:'',nextText:'',currentText:'',monthNames:['1(JAN)','2(FEB)','3(MAR)','4(APR)','5(MAY)','6(JUN)','7(JUL)','8(AUG)','9(SEP)','10(OCT)','11(NOV)','12(DEC)'],monthNamesShort:['1(JAN)','2(FEB)','3(MAR)','4(APR)','5(MAY)','6(JUN)','7(JUL)','8(AUG)','9(SEP)','10(OCT)','11(NOV)','12(DEC)'],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'Wk',dateFormat:'yy-mm-dd',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ko']);});jQuery(function($){$.datepicker.regional['lt']={closeText:'Udaryti',prevText:'&#x3c;Atgal',nextText:'Pirmyn&#x3e;',currentText:'iandien',monthNames:['Sausis','Vasaris','Kovas','Balandis','Gegu','Birelis','Liepa','Rugpjtis','Rugsjis','Spalis','Lapkritis','Gruodis'],monthNamesShort:['Sau','Vas','Kov','Bal','Geg','Bir','Lie','Rugp','Rugs','Spa','Lap','Gru'],dayNames:['sekmadienis','pirmadienis','antradienis','treiadienis','ketvirtadienis','penktadienis','etadienis'],dayNamesShort:['sek','pir','ant','tre','ket','pen','e'],dayNamesMin:['Se','Pr','An','Tr','Ke','Pe','e'],weekHeader:'Wk',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['lt']);});jQuery(function($){$.datepicker.regional['lv']={closeText:'Aizvrt',prevText:'Iepr',nextText:'Nka',currentText:'odien',monthNames:['Janvris','Februris','Marts','Aprlis','Maijs','Jnijs','Jlijs','Augusts','Septembris','Oktobris','Novembris','Decembris'],monthNamesShort:['Jan','Feb','Mar','Apr','Mai','Jn','Jl','Aug','Sep','Okt','Nov','Dec'],dayNames:['svtdiena','pirmdiena','otrdiena','trediena','ceturtdiena','piektdiena','sestdiena'],dayNamesShort:['svt','prm','otr','tre','ctr','pkt','sst'],dayNamesMin:['Sv','Pr','Ot','Tr','Ct','Pk','Ss'],weekHeader:'Nav',dateFormat:'dd-mm-yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['lv']);});jQuery(function($){$.datepicker.regional['ms']={closeText:'Tutup',prevText:'&#x3c;Sebelum',nextText:'Selepas&#x3e;',currentText:'hari ini',monthNames:['Januari','Februari','Mac','April','Mei','Jun','Julai','Ogos','September','Oktober','November','Disember'],monthNamesShort:['Jan','Feb','Mac','Apr','Mei','Jun','Jul','Ogo','Sep','Okt','Nov','Dis'],dayNames:['Ahad','Isnin','Selasa','Rabu','Khamis','Jumaat','Sabtu'],dayNamesShort:['Aha','Isn','Sel','Rab','kha','Jum','Sab'],dayNamesMin:['Ah','Is','Se','Ra','Kh','Ju','Sa'],weekHeader:'Mg',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ms']);});
jQuery(function($){$.datepicker.regional.nl={closeText:'Sluiten',prevText:'',nextText:'',currentText:'Vandaag',monthNames:['januari','februari','maart','april','mei','juni','juli','augustus','september','oktober','november','december'],monthNamesShort:['jan','feb','maa','apr','mei','jun','jul','aug','sep','okt','nov','dec'],dayNames:['zondag','maandag','dinsdag','woensdag','donderdag','vrijdag','zaterdag'],dayNamesShort:['zon','maa','din','woe','don','vri','zat'],dayNamesMin:['zo','ma','di','wo','do','vr','za'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional.nl);});jQuery(function($){$.datepicker.regional['no']={closeText:'Lukk',prevText:'&laquo;Forrige',nextText:'Neste&raquo;',currentText:'I dag',monthNames:['Januar','Februar','Mars','April','Mai','Juni','Juli','August','September','Oktober','November','Desember'],monthNamesShort:['Jan','Feb','Mar','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Des'],dayNamesShort:['Sn','Man','Tir','Ons','Tor','Fre','Lr'],dayNames:['Sndag','Mandag','Tirsdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesMin:['S','Ma','Ti','On','To','Fr','L'],weekHeader:'Uke',dateFormat:'yy-mm-dd',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['no']);});jQuery(function($){$.datepicker.regional['pl']={closeText:'Zamknij',prevText:'&#x3c;Poprzedni',nextText:'Nastpny&#x3e;',currentText:'Dzi',monthNames:['Stycze','Luty','Marzec','Kwiecie','Maj','Czerwiec','Lipiec','Sierpie','Wrzesie','Padziernik','Listopad','Grudzie'],monthNamesShort:['Sty','Lu','Mar','Kw','Maj','Cze','Lip','Sie','Wrz','Pa','Lis','Gru'],dayNames:['Niedziela','Poniedziaek','Wtorek','roda','Czwartek','Pitek','Sobota'],dayNamesShort:['Nie','Pn','Wt','r','Czw','Pt','So'],dayNamesMin:['N','Pn','Wt','r','Cz','Pt','So'],weekHeader:'Tydz',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['pl']);});jQuery(function($){$.datepicker.regional['pt-BR']={closeText:'Fechar',prevText:'&#x3c;Anterior',nextText:'Pr&oacute;ximo&#x3e;',currentText:'Hoje',monthNames:['Janeiro','Fevereiro','Mar&ccedil;o','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],monthNamesShort:['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'],dayNames:['Domingo','Segunda-feira','Ter&ccedil;a-feira','Quarta-feira','Quinta-feira','Sexta-feira','S&aacute;bado'],dayNamesShort:['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],dayNamesMin:['Dom','Seg','Ter','Qua','Qui','Sex','S&aacute;b'],weekHeader:'Sm',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['pt-BR']);});
jQuery(function($){$.datepicker.regional['ro']={closeText:'nchide',prevText:'&laquo; Luna precedent',nextText:'Luna urmtoare &raquo;',currentText:'Azi',monthNames:['Ianuarie','Februarie','Martie','Aprilie','Mai','Iunie','Iulie','August','Septembrie','Octombrie','Noiembrie','Decembrie'],monthNamesShort:['Ian','Feb','Mar','Apr','Mai','Iun','Iul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Duminic','Luni','Mari','Miercuri','Joi','Vineri','Smbt'],dayNamesShort:['Dum','Lun','Mar','Mie','Joi','Vin','Sm'],dayNamesMin:['Du','Lu','Ma','Mi','Jo','Vi','S'],weekHeader:'Spt',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ro']);});jQuery(function($){$.datepicker.regional['ru']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ru']);});jQuery(function($){$.datepicker.regional['sk']={closeText:'Zavrie',prevText:'&#x3c;Predchdzajci',nextText:'Nasledujci&#x3e;',currentText:'Dnes',monthNames:['Janur','Februr','Marec','Aprl','Mj','Jn','Jl','August','September','Oktber','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Mj','Jn','Jl','Aug','Sep','Okt','Nov','Dec'],dayNames:['Nedel\'a','Pondelok','Utorok','Streda','tvrtok','Piatok','Sobota'],dayNamesShort:['Ned','Pon','Uto','Str','tv','Pia','Sob'],dayNamesMin:['Ne','Po','Ut','St','t','Pia','So'],weekHeader:'Ty',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sk']);});jQuery(function($){$.datepicker.regional['sl']={closeText:'Zapri',prevText:'&lt;Prej&#x161;nji',nextText:'Naslednji&gt;',currentText:'Trenutni',monthNames:['Januar','Februar','Marec','April','Maj','Junij','Julij','Avgust','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Avg','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljek','Torek','Sreda','&#x10C;etrtek','Petek','Sobota'],dayNamesShort:['Ned','Pon','Tor','Sre','&#x10C;et','Pet','Sob'],dayNamesMin:['Ne','Po','To','Sr','&#x10C;e','Pe','So'],weekHeader:'Teden',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sl']);});
jQuery(function($){$.datepicker.regional['sq']={closeText:'mbylle',prevText:'&#x3c;mbrapa',nextText:'Prpara&#x3e;',currentText:'sot',monthNames:['Janar','Shkurt','Mars','Prill','Maj','Qershor','Korrik','Gusht','Shtator','Tetor','Nntor','Dhjetor'],monthNamesShort:['Jan','Shk','Mar','Pri','Maj','Qer','Kor','Gus','Sht','Tet','Nn','Dhj'],dayNames:['E Diel','E Hn','E Mart','E Mrkur','E Enjte','E Premte','E Shtune'],dayNamesShort:['Di','H','Ma','M','En','Pr','Sh'],dayNamesMin:['Di','H','Ma','M','En','Pr','Sh'],weekHeader:'Ja',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sq']);});
jQuery(function($){$.datepicker.regional['sr-SR']={closeText:'Zatvori',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'Danas',monthNames:['Januar','Februar','Mart','April','Maj','Jun','Jul','Avgust','Septembar','Oktobar','Novembar','Decembar'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Avg','Sep','Okt','Nov','Dec'],dayNames:['Nedelja','Ponedeljak','Utorak','Sreda','etvrtak','Petak','Subota'],dayNamesShort:['Ned','Pon','Uto','Sre','et','Pet','Sub'],dayNamesMin:['Ne','Po','Ut','Sr','e','Pe','Su'],weekHeader:'Sed',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sr-SR']);});
jQuery(function($){$.datepicker.regional['sr']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sr']);});
jQuery(function($){$.datepicker.regional['sv']={closeText:'Stng',prevText:'&laquo;Frra',nextText:'Nsta&raquo;',currentText:'Idag',monthNames:['Januari','Februari','Mars','April','Maj','Juni','Juli','Augusti','September','Oktober','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','Maj','Jun','Jul','Aug','Sep','Okt','Nov','Dec'],dayNamesShort:['Sn','Mn','Tis','Ons','Tor','Fre','Lr'],dayNames:['Sndag','Mndag','Tisdag','Onsdag','Torsdag','Fredag','Lrdag'],dayNamesMin:['S','M','Ti','On','To','Fr','L'],weekHeader:'Ve',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['sv']);});
jQuery(function($){$.datepicker.regional['ta']={closeText:'',prevText:'',nextText:'',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['ta']);});
jQuery(function($){$.datepicker.regional['th']={closeText:'',prevText:'&laquo;&nbsp;',nextText:'&nbsp;&raquo;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['..','..','..','..','..','..','..','..','..','..','..','..'],dayNames:['','','','','','',''],dayNamesShort:['.','.','.','.','.','.','.'],dayNamesMin:['.','.','.','.','.','.','.'],weekHeader:'Wk',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['th']);});jQuery(function($){$.datepicker.regional['tr']={closeText:'kapat',prevText:'&#x3c;geri',nextText:'ileri&#x3e',currentText:'bugn',monthNames:['Ocak','ubat','Mart','Nisan','Mays','Haziran','Temmuz','Austos','Eyll','Ekim','Kasm','Aralk'],monthNamesShort:['Oca','ub','Mar','Nis','May','Haz','Tem','Au','Eyl','Eki','Kas','Ara'],dayNames:['Pazar','Pazartesi','Sal','aramba','Perembe','Cuma','Cumartesi'],dayNamesShort:['Pz','Pt','Sa','a','Pe','Cu','Ct'],dayNamesMin:['Pz','Pt','Sa','a','Pe','Cu','Ct'],weekHeader:'Hf',dateFormat:'dd.mm.yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['tr']);});jQuery(function($){$.datepicker.regional['uk']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd/mm/yy',firstDay:1,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['uk']);});
jQuery(function($){$.datepicker.regional['vi']={closeText:'ng',prevText:'&#x3c;Trc',nextText:'Tip&#x3e;',currentText:'Hm nay',monthNames:['Thng Mt','Thng Hai','Thng Ba','Thng T','Thng Nm','Thng Su','Thng By','Thng Tm','Thng Chn','Thng Mi','Thng Mi Mt','Thng Mi Hai'],monthNamesShort:['Thng 1','Thng 2','Thng 3','Thng 4','Thng 5','Thng 6','Thng 7','Thng 8','Thng 9','Thng 10','Thng 11','Thng 12'],dayNames:['Ch Nht','Th Hai','Th Ba','Th T','Th Nm','Th Su','Th By'],dayNamesShort:['CN','T2','T3','T4','T5','T6','T7'],dayNamesMin:['CN','T2','T3','T4','T5','T6','T7'],weekHeader:'Tu',dateFormat:'dd/mm/yy',firstDay:0,isRTL:false,showMonthAfterYear:false,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['vi']);});jQuery(function($){$.datepicker.regional['zh-CN']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy-mm-dd',firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-CN']);});jQuery(function($){$.datepicker.regional['zh-HK']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'dd-mm-yy',firstDay:0,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-HK']);});
jQuery(function($){$.datepicker.regional['zh-TW']={closeText:'',prevText:'&#x3c;',nextText:'&#x3e;',currentText:'',monthNames:['','','','','','','','','','','',''],monthNamesShort:['','','','','','','','','','','',''],dayNames:['','','','','','',''],dayNamesShort:['','','','','','',''],dayNamesMin:['','','','','','',''],weekHeader:'',dateFormat:'yy/mm/dd',firstDay:1,isRTL:false,showMonthAfterYear:true,yearSuffix:''};$.datepicker.setDefaults($.datepicker.regional['zh-TW']);});
var MetaLayer={getCurrentDate:function(){var currentDate=new Date();return MetaLayer.toDateString(currentDate);},getYesterdayDate:function(){var currentDate=new Date();currentDate.setDate(currentDate.getDate()-1);return MetaLayer.toDateString(currentDate);},getFirstDayOfYearDate:function(){var currentDate=new Date();return currentDate.getFullYear()+"-01-01";},getFirstDayOfLastMonth:function(){var currentDate=new Date();currentDate.setMonth(currentDate.getMonth()-1);currentDate.setDate(1);return MetaLayer.toDateString(currentDate);},getLastDayOfLastMonth:function(){var currentDate=new Date();currentDate.setDate(0);return MetaLayer.toDateString(currentDate);},getLastMonthDate:function(){var currentDate=new Date();var prevDate=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate()-30);var prevMonth="0"+(prevDate.getMonth()+1);var prevDay="0"+(prevDate.getDate());var prevDateStr=prevDate.getFullYear()+"-"+(prevMonth.substring(prevMonth.length-2,prevMonth.length))+"-"+(prevDay.substring(prevDay.length-2,prevDay.length));return prevDateStr;},toDateString:function(d){var currentMonth="0"+(d.getMonth()+1);var currentDay="0"+(d.getDate());var dStr=d.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length))+"-"+(currentDay.substring(currentDay.length-2,currentDay.length));return dStr;},getMonth:function(){var currentDate=new Date();var currentMonth="0"+(currentDate.getMonth()+1);var currentDateStr=currentDate.getFullYear()+"-"+(currentMonth.substring(currentMonth.length-2,currentMonth.length));return currentDateStr;},getMdxMonth:function(){var currentDate=new Date();var currentDateStr="[Date].["+currentDate.getFullYear()+"].["+currentDate.getMonth()+"]";return currentDateStr;},getInitialMonth:function(){var c=new Date();c.setMonth(c.getMonth()-1);return c;},allValues:[["All","All"]]};jQuery.fn.check=function(mode){var mode=mode||'on';return this.each(function(){switch(mode){case'on':this.checked=true;break;case'off':this.checked=false;break;case'toggle':this.checked=!this.checked;break;}});};
(function(window,document,$,undefined){"use strict";window.console=window.console||{info:function(stuff){}};if(!$){return;}
if($.fn.fancybox){console.info("fancyBox already initialized");return;}
var defaults={closeExisting:false,loop:false,gutter:50,keyboard:true,preventCaptionOverlap:true,arrows:true,infobar:true,smallBtn:"auto",toolbar:"auto",buttons:["zoom","slideShow","thumbs","close"],idleTime:3,protect:false,modal:false,image:{preload:false},ajax:{settings:{data:{fancybox:true}}},iframe:{tpl:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" allowfullscreen="allowfullscreen" allow="autoplay; fullscreen" src=""></iframe>',preload:true,css:{},attr:{scrolling:"auto"}},video:{tpl:'<video class="fancybox-video" controls controlsList="nodownload" poster="{{poster}}">'+'<source src="{{src}}" type="{{format}}" />'+'Sorry, your browser doesn\'t support embedded videos, <a href="{{src}}">download</a> and watch with your favorite video player!'+"</video>",format:"",autoStart:true},defaultType:"image",animationEffect:"zoom",animationDuration:366,zoomOpacity:"auto",transitionEffect:"fade",transitionDuration:366,slideClass:"",baseClass:"",baseTpl:'<div class="fancybox-container" role="dialog" tabindex="-1">'+'<div class="fancybox-bg"></div>'+'<div class="fancybox-inner">'+'<div class="fancybox-infobar"><span data-fancybox-index></span>&nbsp;/&nbsp;<span data-fancybox-count></span></div>'+'<div class="fancybox-toolbar">{{buttons}}</div>'+'<div class="fancybox-navigation">{{arrows}}</div>'+'<div class="fancybox-stage"></div>'+'<div class="fancybox-caption"><div class="fancybox-caption__body"></div></div>'+"</div>"+"</div>",spinnerTpl:'<div class="fancybox-loading"></div>',errorTpl:'<div class="fancybox-error"><p>{{ERROR}}</p></div>',btnTpl:{download:'<a download data-fancybox-download class="fancybox-button fancybox-button--download" title="{{DOWNLOAD}}" href="javascript:;">'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.62 17.09V19H5.38v-1.91zm-2.97-6.96L17 11.45l-5 4.87-5-4.87 1.36-1.32 2.68 2.64V5h1.92v7.77z"/></svg>'+"</a>",zoom:'<button data-fancybox-zoom class="fancybox-button fancybox-button--zoom" title="{{ZOOM}}">'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.7 17.3l-3-3a5.9 5.9 0 0 0-.6-7.6 5.9 5.9 0 0 0-8.4 0 5.9 5.9 0 0 0 0 8.4 5.9 5.9 0 0 0 7.7.7l3 3a1 1 0 0 0 1.3 0c.4-.5.4-1 0-1.5zM8.1 13.8a4 4 0 0 1 0-5.7 4 4 0 0 1 5.7 0 4 4 0 0 1 0 5.7 4 4 0 0 1-5.7 0z"/></svg>'+"</button>",close:'<button data-fancybox-close class="fancybox-button fancybox-button--close" title="{{CLOSE}}">'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 10.6L6.6 5.2 5.2 6.6l5.4 5.4-5.4 5.4 1.4 1.4 5.4-5.4 5.4 5.4 1.4-1.4-5.4-5.4 5.4-5.4-1.4-1.4-5.4 5.4z"/></svg>'+"</button>",arrowLeft:'<button data-fancybox-prev class="fancybox-button fancybox-button--arrow_left" title="{{PREV}}">'+'<div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11.28 15.7l-1.34 1.37L5 12l4.94-5.07 1.34 1.38-2.68 2.72H19v1.94H8.6z"/></svg></div>'+"</button>",arrowRight:'<button data-fancybox-next class="fancybox-button fancybox-button--arrow_right" title="{{NEXT}}">'+'<div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.4 12.97l-2.68 2.72 1.34 1.38L19 12l-4.94-5.07-1.34 1.38 2.68 2.72H5v1.94z"/></svg></div>'+"</button>",smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="{{CLOSE}}">'+'<svg xmlns="http://www.w3.org/2000/svg" version="1" viewBox="0 0 24 24"><path d="M13 12l5-5-1-1-5 5-5-5-1 1 5 5-5 5 1 1 5-5 5 5 1-1z"/></svg>'+"</button>"},parentEl:"body",hideScrollbar:true,autoFocus:true,backFocus:true,trapFocus:true,fullScreen:{autoStart:false},touch:{vertical:true,momentum:true},hash:null,media:{},slideShow:{autoStart:false,speed:3000},thumbs:{autoStart:false,hideOnClose:true,parentEl:".fancybox-container",axis:"y"},wheel:"auto",onInit:$.noop,beforeLoad:$.noop,afterLoad:$.noop,beforeShow:$.noop,afterShow:$.noop,beforeClose:$.noop,afterClose:$.noop,onActivate:$.noop,onDeactivate:$.noop,clickContent:function(current,event){return current.type==="image"?"zoom":false;},clickSlide:"close",clickOutside:"close",dblclickContent:false,dblclickSlide:false,dblclickOutside:false,mobile:{preventCaptionOverlap:false,idleTime:false,clickContent:function(current,event){return current.type==="image"?"toggleControls":false;},clickSlide:function(current,event){return current.type==="image"?"toggleControls":"close";},dblclickContent:function(current,event){return current.type==="image"?"zoom":false;},dblclickSlide:function(current,event){return current.type==="image"?"zoom":false;}},lang:"en",i18n:{en:{CLOSE:"Close",NEXT:"Next",PREV:"Previous",ERROR:"The requested content cannot be loaded. <br/> Please try again later.",PLAY_START:"Start slideshow",PLAY_STOP:"Pause slideshow",FULL_SCREEN:"Full screen",THUMBS:"Thumbnails",DOWNLOAD:"Download",SHARE:"Share",ZOOM:"Zoom"},de:{CLOSE:"Schlie&szlig;en",NEXT:"Weiter",PREV:"Zur&uuml;ck",ERROR:"Die angeforderten Daten konnten nicht geladen werden. <br/> Bitte versuchen Sie es sp&auml;ter nochmal.",PLAY_START:"Diaschau starten",PLAY_STOP:"Diaschau beenden",FULL_SCREEN:"Vollbild",THUMBS:"Vorschaubilder",DOWNLOAD:"Herunterladen",SHARE:"Teilen",ZOOM:"Vergr&ouml;&szlig;ern"}}};var $W=$(window);var $D=$(document);var called=0;var isQuery=function(obj){return obj&&obj.hasOwnProperty&&obj instanceof $;};var requestAFrame=(function(){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(callback){return window.setTimeout(callback,1000/60);});})();var cancelAFrame=(function(){return(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(id){window.clearTimeout(id);});})();var transitionEnd=(function(){var el=document.createElement("fakeelement"),t;var transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions){if(el.style[t]!==undefined){return transitions[t];}}
return"transitionend";})();var forceRedraw=function($el){return $el&&$el.length&&$el[0].offsetHeight;};var mergeOpts=function(opts1,opts2){var rez=$.extend(true,{},opts1,opts2);$.each(opts2,function(key,value){if($.isArray(value)){rez[key]=value;}});return rez;};var inViewport=function(elem){var elemCenter,rez;if(!elem||elem.ownerDocument!==document){return false;}
$(".fancybox-container").css("pointer-events","none");elemCenter={x:elem.getBoundingClientRect().left+elem.offsetWidth/2,y:elem.getBoundingClientRect().top+elem.offsetHeight/2};rez=document.elementFromPoint(elemCenter.x,elemCenter.y)===elem;$(".fancybox-container").css("pointer-events","");return rez;};var FancyBox=function(content,opts,index){var self=this;self.opts=mergeOpts({index:index},$.fancybox.defaults);if($.isPlainObject(opts)){self.opts=mergeOpts(self.opts,opts);}
if($.fancybox.isMobile){self.opts=mergeOpts(self.opts,self.opts.mobile);}
self.id=self.opts.id||++called;self.currIndex=parseInt(self.opts.index,10)||0;self.prevIndex=null;self.prevPos=null;self.currPos=0;self.firstRun=true;self.group=[];self.slides={};self.addContent(content);if(!self.group.length){return;}
self.init();};$.extend(FancyBox.prototype,{init:function(){var self=this,firstItem=self.group[self.currIndex],firstItemOpts=firstItem.opts,$container,buttonStr;if(firstItemOpts.closeExisting){$.fancybox.close(true);}
$("body").addClass("fancybox-active");if(!$.fancybox.getInstance()&&firstItemOpts.hideScrollbar!==false&&!$.fancybox.isMobile&&document.body.scrollHeight>window.innerHeight){$("head").append('<style id="fancybox-style-noscroll" type="text/css">.compensate-for-scrollbar{margin-right:'+
(window.innerWidth-document.documentElement.clientWidth)+"px;}</style>");$("body").addClass("compensate-for-scrollbar");}
buttonStr="";$.each(firstItemOpts.buttons,function(index,value){buttonStr+=firstItemOpts.btnTpl[value]||"";});$container=$(self.translate(self,firstItemOpts.baseTpl.replace("{{buttons}}",buttonStr).replace("{{arrows}}",firstItemOpts.btnTpl.arrowLeft+firstItemOpts.btnTpl.arrowRight))).attr("id","fancybox-container-"+self.id).addClass(firstItemOpts.baseClass).data("FancyBox",self).appendTo(firstItemOpts.parentEl);self.$refs={container:$container};["bg","inner","infobar","toolbar","stage","caption","navigation"].forEach(function(item){self.$refs[item]=$container.find(".fancybox-"+item);});self.trigger("onInit");self.activate();self.jumpTo(self.currIndex);},translate:function(obj,str){var arr=obj.opts.i18n[obj.opts.lang]||obj.opts.i18n.en;return str.replace(/\{\{(\w+)\}\}/g,function(match,n){return arr[n]===undefined?match:arr[n];});},addContent:function(content){var self=this,items=$.makeArray(content),thumbs;$.each(items,function(i,item){var obj={},opts={},$item,type,found,src,srcParts;if($.isPlainObject(item)){obj=item;opts=item.opts||item;}else if($.type(item)==="object"&&$(item).length){$item=$(item);opts=$item.data()||{};opts=$.extend(true,{},opts,opts.options);opts.$orig=$item;obj.src=self.opts.src||opts.src||$item.attr("href");if(!obj.type&&!obj.src){obj.type="inline";obj.src=item;}}else{obj={type:"html",src:item+""};}
obj.opts=$.extend(true,{},self.opts,opts);if($.isArray(opts.buttons)){obj.opts.buttons=opts.buttons;}
if($.fancybox.isMobile&&obj.opts.mobile){obj.opts=mergeOpts(obj.opts,obj.opts.mobile);}
type=obj.type||obj.opts.type;src=obj.src||"";if(!type&&src){if((found=src.match(/\.(mp4|mov|ogv|webm)((\?|#).*)?$/i))){type="video";if(!obj.opts.video.format){obj.opts.video.format="video/"+(found[1]==="ogv"?"ogg":found[1]);}}else if(src.match(/(^data:image\/[a-z0-9+\/=]*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg|ico)((\?|#).*)?$)/i)){type="image";}else if(src.match(/\.(pdf)((\?|#).*)?$/i)){type="iframe";obj=$.extend(true,obj,{contentType:"pdf",opts:{iframe:{preload:false}}});}else if(src.charAt(0)==="#"){type="inline";}}
if(type){obj.type=type;}else{self.trigger("objectNeedsType",obj);}
if(!obj.contentType){obj.contentType=$.inArray(obj.type,["html","inline","ajax"])>-1?"html":obj.type;}
obj.index=self.group.length;if(obj.opts.smallBtn=="auto"){obj.opts.smallBtn=$.inArray(obj.type,["html","inline","ajax"])>-1;}
if(obj.opts.toolbar==="auto"){obj.opts.toolbar=!obj.opts.smallBtn;}
obj.$thumb=obj.opts.$thumb||null;if(obj.opts.$trigger&&obj.index===self.opts.index){obj.$thumb=obj.opts.$trigger.find("img:first");if(obj.$thumb.length){obj.opts.$orig=obj.opts.$trigger;}}
if(!(obj.$thumb&&obj.$thumb.length)&&obj.opts.$orig){obj.$thumb=obj.opts.$orig.find("img:first");}
if(obj.$thumb&&!obj.$thumb.length){obj.$thumb=null;}
obj.thumb=obj.opts.thumb||(obj.$thumb?obj.$thumb[0].src:null);if($.type(obj.opts.caption)==="function"){obj.opts.caption=obj.opts.caption.apply(item,[self,obj]);}
if($.type(self.opts.caption)==="function"){obj.opts.caption=self.opts.caption.apply(item,[self,obj]);}
if(!(obj.opts.caption instanceof $)){obj.opts.caption=obj.opts.caption===undefined?"":obj.opts.caption+"";}
if(obj.type==="ajax"){srcParts=src.split(/\s+/,2);if(srcParts.length>1){obj.src=srcParts.shift();obj.opts.filter=srcParts.shift();}}
if(obj.opts.modal){obj.opts=$.extend(true,obj.opts,{trapFocus:true,infobar:0,toolbar:0,smallBtn:0,keyboard:0,slideShow:0,fullScreen:0,thumbs:0,touch:0,clickContent:false,clickSlide:false,clickOutside:false,dblclickContent:false,dblclickSlide:false,dblclickOutside:false});}
self.group.push(obj);});if(Object.keys(self.slides).length){self.updateControls();thumbs=self.Thumbs;if(thumbs&&thumbs.isActive){thumbs.create();thumbs.focus();}}},addEvents:function(){var self=this;self.removeEvents();self.$refs.container.on("click.fb-close","[data-fancybox-close]",function(e){e.stopPropagation();e.preventDefault();self.close(e);}).on("touchstart.fb-prev click.fb-prev","[data-fancybox-prev]",function(e){e.stopPropagation();e.preventDefault();self.previous();}).on("touchstart.fb-next click.fb-next","[data-fancybox-next]",function(e){e.stopPropagation();e.preventDefault();self.next();}).on("click.fb","[data-fancybox-zoom]",function(e){self[self.isScaledDown()?"scaleToActual":"scaleToFit"]();});$W.on("orientationchange.fb resize.fb",function(e){if(e&&e.originalEvent&&e.originalEvent.type==="resize"){if(self.requestId){cancelAFrame(self.requestId);}
self.requestId=requestAFrame(function(){self.update(e);});}else{if(self.current&&self.current.type==="iframe"){self.$refs.stage.hide();}
setTimeout(function(){self.$refs.stage.show();self.update(e);},$.fancybox.isMobile?600:250);}});$D.on("keydown.fb",function(e){var instance=$.fancybox?$.fancybox.getInstance():null,current=instance.current,keycode=e.keyCode||e.which;if(keycode==9){if(current.opts.trapFocus){self.focus(e);}
return;}
if(!current.opts.keyboard||e.ctrlKey||e.altKey||e.shiftKey||$(e.target).is("input,textarea,video,audio")){return;}
if(keycode===8||keycode===27){e.preventDefault();self.close(e);return;}
if(keycode===37||keycode===38){e.preventDefault();self.previous();return;}
if(keycode===39||keycode===40){e.preventDefault();self.next();return;}
self.trigger("afterKeydown",e,keycode);});if(self.group[self.currIndex].opts.idleTime){self.idleSecondsCounter=0;$D.on("mousemove.fb-idle mouseleave.fb-idle mousedown.fb-idle touchstart.fb-idle touchmove.fb-idle scroll.fb-idle keydown.fb-idle",function(e){self.idleSecondsCounter=0;if(self.isIdle){self.showControls();}
self.isIdle=false;});self.idleInterval=window.setInterval(function(){self.idleSecondsCounter++;if(self.idleSecondsCounter>=self.group[self.currIndex].opts.idleTime&&!self.isDragging){self.isIdle=true;self.idleSecondsCounter=0;self.hideControls();}},1000);}},removeEvents:function(){var self=this;$W.off("orientationchange.fb resize.fb");$D.off("keydown.fb .fb-idle");this.$refs.container.off(".fb-close .fb-prev .fb-next");if(self.idleInterval){window.clearInterval(self.idleInterval);self.idleInterval=null;}},previous:function(duration){return this.jumpTo(this.currPos-1,duration);},next:function(duration){return this.jumpTo(this.currPos+1,duration);},jumpTo:function(pos,duration){var self=this,groupLen=self.group.length,firstRun,isMoved,loop,current,previous,slidePos,stagePos,prop,diff;if(self.isDragging||self.isClosing||(self.isAnimating&&self.firstRun)){return;}
pos=parseInt(pos,10);loop=self.current?self.current.opts.loop:self.opts.loop;if(!loop&&(pos<0||pos>=groupLen)){return false;}
firstRun=self.firstRun=!Object.keys(self.slides).length;previous=self.current;self.prevIndex=self.currIndex;self.prevPos=self.currPos;current=self.createSlide(pos);if(groupLen>1){if(loop||current.index<groupLen-1){self.createSlide(pos+1);}
if(loop||current.index>0){self.createSlide(pos-1);}}
self.current=current;self.currIndex=current.index;self.currPos=current.pos;self.trigger("beforeShow",firstRun);self.updateControls();current.forcedDuration=undefined;if($.isNumeric(duration)){current.forcedDuration=duration;}else{duration=current.opts[firstRun?"animationDuration":"transitionDuration"];}
duration=parseInt(duration,10);isMoved=self.isMoved(current);current.$slide.addClass("fancybox-slide--current");if(firstRun){if(current.opts.animationEffect&&duration){self.$refs.container.css("transition-duration",duration+"ms");}
self.$refs.container.addClass("fancybox-is-open").trigger("focus");self.loadSlide(current);self.preload("image");return;}
slidePos=$.fancybox.getTranslate(previous.$slide);stagePos=$.fancybox.getTranslate(self.$refs.stage);$.each(self.slides,function(index,slide){$.fancybox.stop(slide.$slide,true);});if(previous.pos!==current.pos){previous.isComplete=false;}
previous.$slide.removeClass("fancybox-slide--complete fancybox-slide--current");if(isMoved){diff=slidePos.left-(previous.pos*slidePos.width+previous.pos*previous.opts.gutter);$.each(self.slides,function(index,slide){slide.$slide.removeClass("fancybox-animated").removeClass(function(index,className){return(className.match(/(^|\s)fancybox-fx-\S+/g)||[]).join(" ");});var leftPos=slide.pos*slidePos.width+slide.pos*slide.opts.gutter;$.fancybox.setTranslate(slide.$slide,{top:0,left:leftPos-stagePos.left+diff});if(slide.pos!==current.pos){slide.$slide.addClass("fancybox-slide--"+(slide.pos>current.pos?"next":"previous"));}
forceRedraw(slide.$slide);$.fancybox.animate(slide.$slide,{top:0,left:(slide.pos-current.pos)*slidePos.width+(slide.pos-current.pos)*slide.opts.gutter},duration,function(){slide.$slide.css({transform:"",opacity:""}).removeClass("fancybox-slide--next fancybox-slide--previous");if(slide.pos===self.currPos){self.complete();}});});}else if(duration&&current.opts.transitionEffect){prop="fancybox-animated fancybox-fx-"+current.opts.transitionEffect;previous.$slide.addClass("fancybox-slide--"+(previous.pos>current.pos?"next":"previous"));$.fancybox.animate(previous.$slide,prop,duration,function(){previous.$slide.removeClass(prop).removeClass("fancybox-slide--next fancybox-slide--previous");},false);}
if(current.isLoaded){self.revealContent(current);}else{self.loadSlide(current);}
self.preload("image");},createSlide:function(pos){var self=this,$slide,index;index=pos%self.group.length;index=index<0?self.group.length+index:index;if(!self.slides[pos]&&self.group[index]){$slide=$('<div class="fancybox-slide"></div>').appendTo(self.$refs.stage);self.slides[pos]=$.extend(true,{},self.group[index],{pos:pos,$slide:$slide,isLoaded:false});self.updateSlide(self.slides[pos]);}
return self.slides[pos];},scaleToActual:function(x,y,duration){var self=this,current=self.current,$content=current.$content,canvasWidth=$.fancybox.getTranslate(current.$slide).width,canvasHeight=$.fancybox.getTranslate(current.$slide).height,newImgWidth=current.width,newImgHeight=current.height,imgPos,posX,posY,scaleX,scaleY;if(self.isAnimating||self.isMoved()||!$content||!(current.type=="image"&&current.isLoaded&&!current.hasError)){return;}
self.isAnimating=true;$.fancybox.stop($content);x=x===undefined?canvasWidth*0.5:x;y=y===undefined?canvasHeight*0.5:y;imgPos=$.fancybox.getTranslate($content);imgPos.top-=$.fancybox.getTranslate(current.$slide).top;imgPos.left-=$.fancybox.getTranslate(current.$slide).left;scaleX=newImgWidth/imgPos.width;scaleY=newImgHeight/imgPos.height;posX=canvasWidth*0.5-newImgWidth*0.5;posY=canvasHeight*0.5-newImgHeight*0.5;if(newImgWidth>canvasWidth){posX=imgPos.left*scaleX-(x*scaleX-x);if(posX>0){posX=0;}
if(posX<canvasWidth-newImgWidth){posX=canvasWidth-newImgWidth;}}
if(newImgHeight>canvasHeight){posY=imgPos.top*scaleY-(y*scaleY-y);if(posY>0){posY=0;}
if(posY<canvasHeight-newImgHeight){posY=canvasHeight-newImgHeight;}}
self.updateCursor(newImgWidth,newImgHeight);$.fancybox.animate($content,{top:posY,left:posX,scaleX:scaleX,scaleY:scaleY},duration||366,function(){self.isAnimating=false;});if(self.SlideShow&&self.SlideShow.isActive){self.SlideShow.stop();}},scaleToFit:function(duration){var self=this,current=self.current,$content=current.$content,end;if(self.isAnimating||self.isMoved()||!$content||!(current.type=="image"&&current.isLoaded&&!current.hasError)){return;}
self.isAnimating=true;$.fancybox.stop($content);end=self.getFitPos(current);self.updateCursor(end.width,end.height);$.fancybox.animate($content,{top:end.top,left:end.left,scaleX:end.width/$content.width(),scaleY:end.height/$content.height()},duration||366,function(){self.isAnimating=false;});},getFitPos:function(slide){var self=this,$content=slide.$content,$slide=slide.$slide,width=slide.width||slide.opts.width,height=slide.height||slide.opts.height,maxWidth,maxHeight,minRatio,aspectRatio,rez={};if(!slide.isLoaded||!$content||!$content.length){return false;}
maxWidth=$.fancybox.getTranslate(self.$refs.stage).width;maxHeight=$.fancybox.getTranslate(self.$refs.stage).height;maxWidth-=parseFloat($slide.css("paddingLeft"))+
parseFloat($slide.css("paddingRight"))+
parseFloat($content.css("marginLeft"))+
parseFloat($content.css("marginRight"));maxHeight-=parseFloat($slide.css("paddingTop"))+
parseFloat($slide.css("paddingBottom"))+
parseFloat($content.css("marginTop"))+
parseFloat($content.css("marginBottom"));if(!width||!height){width=maxWidth;height=maxHeight;}
minRatio=Math.min(1,maxWidth/width,maxHeight/height);width=minRatio*width;height=minRatio*height;if(width>maxWidth-0.5){width=maxWidth;}
if(height>maxHeight-0.5){height=maxHeight;}
if(slide.type==="image"){rez.top=Math.floor((maxHeight-height)*0.5)+parseFloat($slide.css("paddingTop"));rez.left=Math.floor((maxWidth-width)*0.5)+parseFloat($slide.css("paddingLeft"));}else if(slide.contentType==="video"){aspectRatio=slide.opts.width&&slide.opts.height?width/height:slide.opts.ratio||16/9;if(height>width/aspectRatio){height=width/aspectRatio;}else if(width>height*aspectRatio){width=height*aspectRatio;}}
rez.width=width;rez.height=height;return rez;},update:function(e){var self=this;$.each(self.slides,function(key,slide){self.updateSlide(slide,e);});},updateSlide:function(slide,e){var self=this,$content=slide&&slide.$content,width=slide.width||slide.opts.width,height=slide.height||slide.opts.height,$slide=slide.$slide;self.adjustCaption(slide);if($content&&(width||height||slide.contentType==="video")&&!slide.hasError){$.fancybox.stop($content);$.fancybox.setTranslate($content,self.getFitPos(slide));if(slide.pos===self.currPos){self.isAnimating=false;self.updateCursor();}}
self.adjustLayout(slide);if($slide.length){$slide.trigger("refresh");if(slide.pos===self.currPos){self.$refs.toolbar.add(self.$refs.navigation.find(".fancybox-button--arrow_right")).toggleClass("compensate-for-scrollbar",$slide.get(0).scrollHeight>$slide.get(0).clientHeight);}}
self.trigger("onUpdate",slide,e);},centerSlide:function(duration){var self=this,current=self.current,$slide=current.$slide;if(self.isClosing||!current){return;}
$slide.siblings().css({transform:"",opacity:""});$slide.parent().children().removeClass("fancybox-slide--previous fancybox-slide--next");$.fancybox.animate($slide,{top:0,left:0,opacity:1},duration===undefined?0:duration,function(){$slide.css({transform:"",opacity:""});if(!current.isComplete){self.complete();}},false);},isMoved:function(slide){var current=slide||this.current,slidePos,stagePos;if(!current){return false;}
stagePos=$.fancybox.getTranslate(this.$refs.stage);slidePos=$.fancybox.getTranslate(current.$slide);return(!current.$slide.hasClass("fancybox-animated")&&(Math.abs(slidePos.top-stagePos.top)>0.5||Math.abs(slidePos.left-stagePos.left)>0.5));},updateCursor:function(nextWidth,nextHeight){var self=this,current=self.current,$container=self.$refs.container,canPan,isZoomable;if(!current||self.isClosing||!self.Guestures){return;}
$container.removeClass("fancybox-is-zoomable fancybox-can-zoomIn fancybox-can-zoomOut fancybox-can-swipe fancybox-can-pan");canPan=self.canPan(nextWidth,nextHeight);isZoomable=canPan?true:self.isZoomable();$container.toggleClass("fancybox-is-zoomable",isZoomable);$("[data-fancybox-zoom]").prop("disabled",!isZoomable);if(canPan){$container.addClass("fancybox-can-pan");}else if(isZoomable&&(current.opts.clickContent==="zoom"||($.isFunction(current.opts.clickContent)&&current.opts.clickContent(current)=="zoom"))){$container.addClass("fancybox-can-zoomIn");}else if(current.opts.touch&&(current.opts.touch.vertical||self.group.length>1)&&current.contentType!=="video"){$container.addClass("fancybox-can-swipe");}},isZoomable:function(){var self=this,current=self.current,fitPos;if(current&&!self.isClosing&&current.type==="image"&&!current.hasError){if(!current.isLoaded){return true;}
fitPos=self.getFitPos(current);if(fitPos&&(current.width>fitPos.width||current.height>fitPos.height)){return true;}}
return false;},isScaledDown:function(nextWidth,nextHeight){var self=this,rez=false,current=self.current,$content=current.$content;if(nextWidth!==undefined&&nextHeight!==undefined){rez=nextWidth<current.width&&nextHeight<current.height;}else if($content){rez=$.fancybox.getTranslate($content);rez=rez.width<current.width&&rez.height<current.height;}
return rez;},canPan:function(nextWidth,nextHeight){var self=this,current=self.current,pos=null,rez=false;if(current.type==="image"&&(current.isComplete||(nextWidth&&nextHeight))&&!current.hasError){rez=self.getFitPos(current);if(nextWidth!==undefined&&nextHeight!==undefined){pos={width:nextWidth,height:nextHeight};}else if(current.isComplete){pos=$.fancybox.getTranslate(current.$content);}
if(pos&&rez){rez=Math.abs(pos.width-rez.width)>1.5||Math.abs(pos.height-rez.height)>1.5;}}
return rez;},loadSlide:function(slide){var self=this,type,$slide,ajaxLoad;if(slide.isLoading||slide.isLoaded){return;}
slide.isLoading=true;if(self.trigger("beforeLoad",slide)===false){slide.isLoading=false;return false;}
type=slide.type;$slide=slide.$slide;$slide.off("refresh").trigger("onReset").addClass(slide.opts.slideClass);switch(type){case"image":self.setImage(slide);break;case"iframe":self.setIframe(slide);break;case"html":self.setContent(slide,slide.src||slide.content);break;case"video":self.setContent(slide,slide.opts.video.tpl.replace(/\{\{src\}\}/gi,slide.src).replace("{{format}}",slide.opts.videoFormat||slide.opts.video.format||"").replace("{{poster}}",slide.thumb||""));break;case"inline":if($(slide.src).length){self.setContent(slide,$(slide.src));}else{self.setError(slide);}
break;case"ajax":self.showLoading(slide);ajaxLoad=$.ajax($.extend({},slide.opts.ajax.settings,{url:slide.src,success:function(data,textStatus){if(textStatus==="success"){self.setContent(slide,data);}},error:function(jqXHR,textStatus){if(jqXHR&&textStatus!=="abort"){self.setError(slide);}}}));$slide.one("onReset",function(){ajaxLoad.abort();});break;default:self.setError(slide);break;}
return true;},setImage:function(slide){var self=this,ghost;setTimeout(function(){var $img=slide.$image;if(!self.isClosing&&slide.isLoading&&(!$img||!$img.length||!$img[0].complete)&&!slide.hasError){self.showLoading(slide);}},50);self.checkSrcset(slide);slide.$content=$('<div class="fancybox-content"></div>').addClass("fancybox-is-hidden").appendTo(slide.$slide.addClass("fancybox-slide--image"));if(slide.opts.preload!==false&&slide.opts.width&&slide.opts.height&&slide.thumb){slide.width=slide.opts.width;slide.height=slide.opts.height;ghost=document.createElement("img");ghost.onerror=function(){$(this).remove();slide.$ghost=null;};ghost.onload=function(){self.afterLoad(slide);};slide.$ghost=$(ghost).addClass("fancybox-image").appendTo(slide.$content).attr("src",slide.thumb);}
self.setBigImage(slide);},checkSrcset:function(slide){var srcset=slide.opts.srcset||slide.opts.image.srcset,found,temp,pxRatio,windowWidth;if(srcset){pxRatio=window.devicePixelRatio||1;windowWidth=window.innerWidth*pxRatio;temp=srcset.split(",").map(function(el){var ret={};el.trim().split(/\s+/).forEach(function(el,i){var value=parseInt(el.substring(0,el.length-1),10);if(i===0){return(ret.url=el);}
if(value){ret.value=value;ret.postfix=el[el.length-1];}});return ret;});temp.sort(function(a,b){return a.value-b.value;});for(var j=0;j<temp.length;j++){var el=temp[j];if((el.postfix==="w"&&el.value>=windowWidth)||(el.postfix==="x"&&el.value>=pxRatio)){found=el;break;}}
if(!found&&temp.length){found=temp[temp.length-1];}
if(found){slide.src=found.url;if(slide.width&&slide.height&&found.postfix=="w"){slide.height=(slide.width/slide.height)*found.value;slide.width=found.value;}
slide.opts.srcset=srcset;}}},setBigImage:function(slide){var self=this,img=document.createElement("img"),$img=$(img);slide.$image=$img.one("error",function(){self.setError(slide);}).one("load",function(){var sizes;if(!slide.$ghost){self.resolveImageSlideSize(slide,this.naturalWidth,this.naturalHeight);self.afterLoad(slide);}
if(self.isClosing){return;}
if(slide.opts.srcset){sizes=slide.opts.sizes;if(!sizes||sizes==="auto"){sizes=(slide.width/slide.height>1&&$W.width()/$W.height()>1?"100":Math.round((slide.width/slide.height)*100))+"vw";}
$img.attr("sizes",sizes).attr("srcset",slide.opts.srcset);}
if(slide.$ghost){setTimeout(function(){if(slide.$ghost&&!self.isClosing){slide.$ghost.hide();}},Math.min(300,Math.max(1000,slide.height/1600)));}
self.hideLoading(slide);}).addClass("fancybox-image").attr("src",slide.src).appendTo(slide.$content);if((img.complete||img.readyState=="complete")&&$img.naturalWidth&&$img.naturalHeight){$img.trigger("load");}else if(img.error){$img.trigger("error");}},resolveImageSlideSize:function(slide,imgWidth,imgHeight){var maxWidth=parseInt(slide.opts.width,10),maxHeight=parseInt(slide.opts.height,10);slide.width=imgWidth;slide.height=imgHeight;if(maxWidth>0){slide.width=maxWidth;slide.height=Math.floor((maxWidth*imgHeight)/imgWidth);}
if(maxHeight>0){slide.width=Math.floor((maxHeight*imgWidth)/imgHeight);slide.height=maxHeight;}},setIframe:function(slide){var self=this,opts=slide.opts.iframe,$slide=slide.$slide,$iframe;slide.$content=$('<div class="fancybox-content'+(opts.preload?" fancybox-is-hidden":"")+'"></div>').css(opts.css).appendTo($slide);$slide.addClass("fancybox-slide--"+slide.contentType);slide.$iframe=$iframe=$(opts.tpl.replace(/\{rnd\}/g,new Date().getTime())).attr(opts.attr).appendTo(slide.$content);if(opts.preload){self.showLoading(slide);$iframe.on("load.fb error.fb",function(e){this.isReady=1;slide.$slide.trigger("refresh");self.afterLoad(slide);});$slide.on("refresh.fb",function(){var $content=slide.$content,frameWidth=opts.css.width,frameHeight=opts.css.height,$contents,$body;if($iframe[0].isReady!==1){return;}
try{$contents=$iframe.contents();$body=$contents.find("body");}catch(ignore){}
if($body&&$body.length&&$body.children().length){$slide.css("overflow","visible");$content.css({width:"100%","max-width":"100%",height:"9999px"});if(frameWidth===undefined){frameWidth=Math.ceil(Math.max($body[0].clientWidth,$body.outerWidth(true)));}
$content.css("width",frameWidth?frameWidth:"").css("max-width","");if(frameHeight===undefined){frameHeight=Math.ceil(Math.max($body[0].clientHeight,$body.outerHeight(true)));}
$content.css("height",frameHeight?frameHeight:"");$slide.css("overflow","auto");}
$content.removeClass("fancybox-is-hidden");});}else{self.afterLoad(slide);}
$iframe.attr("src",slide.src);$slide.one("onReset",function(){try{$(this).find("iframe").hide().unbind().attr("src","//about:blank");}catch(ignore){}
$(this).off("refresh.fb").empty();slide.isLoaded=false;slide.isRevealed=false;});},setContent:function(slide,content){var self=this;if(self.isClosing){return;}
self.hideLoading(slide);if(slide.$content){$.fancybox.stop(slide.$content);}
slide.$slide.empty();if(isQuery(content)&&content.parent().length){if(content.hasClass("fancybox-content")||content.parent().hasClass("fancybox-content")){content.parents(".fancybox-slide").trigger("onReset");}
slide.$placeholder=$("<div>").hide().insertAfter(content);content.css("display","inline-block");}else if(!slide.hasError){if($.type(content)==="string"){content=$("<div>").append($.trim(content)).contents();}
if(slide.opts.filter){content=$("<div>").html(content).find(slide.opts.filter);}}
slide.$slide.one("onReset",function(){$(this).find("video,audio").trigger("pause");if(slide.$placeholder){slide.$placeholder.after(content.removeClass("fancybox-content").hide()).remove();slide.$placeholder=null;}
if(slide.$smallBtn){slide.$smallBtn.remove();slide.$smallBtn=null;}
if(!slide.hasError){$(this).empty();slide.isLoaded=false;slide.isRevealed=false;}});$(content).appendTo(slide.$slide);if($(content).is("video,audio")){$(content).addClass("fancybox-video");$(content).wrap("<div></div>");slide.contentType="video";slide.opts.width=slide.opts.width||$(content).attr("width");slide.opts.height=slide.opts.height||$(content).attr("height");}
slide.$content=slide.$slide.children().filter("div,form,main,video,audio,article,.fancybox-content").first();slide.$content.siblings().hide();if(!slide.$content.length){slide.$content=slide.$slide.wrapInner("<div></div>").children().first();}
slide.$content.addClass("fancybox-content");slide.$slide.addClass("fancybox-slide--"+slide.contentType);self.afterLoad(slide);},setError:function(slide){slide.hasError=true;slide.$slide.trigger("onReset").removeClass("fancybox-slide--"+slide.contentType).addClass("fancybox-slide--error");slide.contentType="html";this.setContent(slide,this.translate(slide,slide.opts.errorTpl));if(slide.pos===this.currPos){this.isAnimating=false;}},showLoading:function(slide){var self=this;slide=slide||self.current;if(slide&&!slide.$spinner){slide.$spinner=$(self.translate(self,self.opts.spinnerTpl)).appendTo(slide.$slide).hide().fadeIn("fast");}},hideLoading:function(slide){var self=this;slide=slide||self.current;if(slide&&slide.$spinner){slide.$spinner.stop().remove();delete slide.$spinner;}},afterLoad:function(slide){var self=this;if(self.isClosing){return;}
slide.isLoading=false;slide.isLoaded=true;self.trigger("afterLoad",slide);self.hideLoading(slide);if(slide.opts.smallBtn&&(!slide.$smallBtn||!slide.$smallBtn.length)){slide.$smallBtn=$(self.translate(slide,slide.opts.btnTpl.smallBtn)).appendTo(slide.$content);}
if(slide.opts.protect&&slide.$content&&!slide.hasError){slide.$content.on("contextmenu.fb",function(e){if(e.button==2){e.preventDefault();}
return true;});if(slide.type==="image"){$('<div class="fancybox-spaceball"></div>').appendTo(slide.$content);}}
self.adjustCaption(slide);self.adjustLayout(slide);if(slide.pos===self.currPos){self.updateCursor();}
self.revealContent(slide);},adjustCaption:function(slide){var self=this,current=slide||self.current,caption=current.opts.caption,preventOverlap=current.opts.preventCaptionOverlap,$caption=self.$refs.caption,$clone,captionH=false;$caption.toggleClass("fancybox-caption--separate",preventOverlap);if(preventOverlap&&caption&&caption.length){if(current.pos!==self.currPos){$clone=$caption.clone().appendTo($caption.parent());$clone.children().eq(0).empty().html(caption);captionH=$clone.outerHeight(true);$clone.empty().remove();}else if(self.$caption){captionH=self.$caption.outerHeight(true);}
current.$slide.css("padding-bottom",captionH||"");}},adjustLayout:function(slide){var self=this,current=slide||self.current,scrollHeight,marginBottom,inlinePadding,actualPadding;if(current.isLoaded&&current.opts.disableLayoutFix!==true){current.$content.css("margin-bottom","");if(current.$content.outerHeight()>current.$slide.height()+0.5){inlinePadding=current.$slide[0].style["padding-bottom"];actualPadding=current.$slide.css("padding-bottom");if(parseFloat(actualPadding)>0){scrollHeight=current.$slide[0].scrollHeight;current.$slide.css("padding-bottom",0);if(Math.abs(scrollHeight-current.$slide[0].scrollHeight)<1){marginBottom=actualPadding;}
current.$slide.css("padding-bottom",inlinePadding);}}
current.$content.css("margin-bottom",marginBottom);}},revealContent:function(slide){var self=this,$slide=slide.$slide,end=false,start=false,isMoved=self.isMoved(slide),isRevealed=slide.isRevealed,effect,effectClassName,duration,opacity;slide.isRevealed=true;effect=slide.opts[self.firstRun?"animationEffect":"transitionEffect"];duration=slide.opts[self.firstRun?"animationDuration":"transitionDuration"];duration=parseInt(slide.forcedDuration===undefined?duration:slide.forcedDuration,10);if(isMoved||slide.pos!==self.currPos||!duration){effect=false;}
if(effect==="zoom"){if(slide.pos===self.currPos&&duration&&slide.type==="image"&&!slide.hasError&&(start=self.getThumbPos(slide))){end=self.getFitPos(slide);}else{effect="fade";}}
if(effect==="zoom"){self.isAnimating=true;end.scaleX=end.width/start.width;end.scaleY=end.height/start.height;opacity=slide.opts.zoomOpacity;if(opacity=="auto"){opacity=Math.abs(slide.width/slide.height-start.width/start.height)>0.1;}
if(opacity){start.opacity=0.1;end.opacity=1;}
$.fancybox.setTranslate(slide.$content.removeClass("fancybox-is-hidden"),start);forceRedraw(slide.$content);$.fancybox.animate(slide.$content,end,duration,function(){self.isAnimating=false;self.complete();});return;}
self.updateSlide(slide);if(!effect){slide.$content.removeClass("fancybox-is-hidden");if(!isRevealed&&isMoved&&slide.type==="image"&&!slide.hasError){slide.$content.hide().fadeIn("fast");}
if(slide.pos===self.currPos){self.complete();}
return;}
$.fancybox.stop($slide);effectClassName="fancybox-slide--"+(slide.pos>=self.prevPos?"next":"previous")+" fancybox-animated fancybox-fx-"+effect;$slide.addClass(effectClassName).removeClass("fancybox-slide--current");slide.$content.removeClass("fancybox-is-hidden");forceRedraw($slide);if(slide.type!=="image"){slide.$content.hide().show(0);}
$.fancybox.animate($slide,"fancybox-slide--current",duration,function(){$slide.removeClass(effectClassName).css({transform:"",opacity:""});if(slide.pos===self.currPos){self.complete();}},true);},getThumbPos:function(slide){var rez=false,$thumb=slide.$thumb,thumbPos,btw,brw,bbw,blw;if(!$thumb||!inViewport($thumb[0])){return false;}
thumbPos=$.fancybox.getTranslate($thumb);btw=parseFloat($thumb.css("border-top-width")||0);brw=parseFloat($thumb.css("border-right-width")||0);bbw=parseFloat($thumb.css("border-bottom-width")||0);blw=parseFloat($thumb.css("border-left-width")||0);rez={top:thumbPos.top+btw,left:thumbPos.left+blw,width:thumbPos.width-brw-blw,height:thumbPos.height-btw-bbw,scaleX:1,scaleY:1};return thumbPos.width>0&&thumbPos.height>0?rez:false;},complete:function(){var self=this,current=self.current,slides={},$el;if(self.isMoved()||!current.isLoaded){return;}
if(!current.isComplete){current.isComplete=true;current.$slide.siblings().trigger("onReset");self.preload("inline");forceRedraw(current.$slide);current.$slide.addClass("fancybox-slide--complete");$.each(self.slides,function(key,slide){if(slide.pos>=self.currPos-1&&slide.pos<=self.currPos+1){slides[slide.pos]=slide;}else if(slide){$.fancybox.stop(slide.$slide);slide.$slide.off().remove();}});self.slides=slides;}
self.isAnimating=false;self.updateCursor();self.trigger("afterShow");if(!!current.opts.video.autoStart){current.$slide.find("video,audio").filter(":visible:first").trigger("play").one("ended",function(){if(this.webkitExitFullscreen){this.webkitExitFullscreen();}
self.next();});}
if(current.opts.autoFocus&&current.contentType==="html"){$el=current.$content.find("input[autofocus]:enabled:visible:first");if($el.length){$el.trigger("focus");}else{self.focus(null,true);}}
current.$slide.scrollTop(0).scrollLeft(0);},preload:function(type){var self=this,prev,next;if(self.group.length<2){return;}
next=self.slides[self.currPos+1];prev=self.slides[self.currPos-1];if(prev&&prev.type===type){self.loadSlide(prev);}
if(next&&next.type===type){self.loadSlide(next);}},focus:function(e,firstRun){var self=this,focusableStr=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","video","audio","[contenteditable]",'[tabindex]:not([tabindex^="-"])'].join(","),focusableItems,focusedItemIndex;if(self.isClosing){return;}
if(e||!self.current||!self.current.isComplete){focusableItems=self.$refs.container.find("*:visible");}else{focusableItems=self.current.$slide.find("*:visible"+(firstRun?":not(.fancybox-close-small)":""));}
focusableItems=focusableItems.filter(focusableStr).filter(function(){return $(this).css("visibility")!=="hidden"&&!$(this).hasClass("disabled");});if(focusableItems.length){focusedItemIndex=focusableItems.index(document.activeElement);if(e&&e.shiftKey){if(focusedItemIndex<0||focusedItemIndex==0){e.preventDefault();focusableItems.eq(focusableItems.length-1).trigger("focus");}}else{if(focusedItemIndex<0||focusedItemIndex==focusableItems.length-1){if(e){e.preventDefault();}
focusableItems.eq(0).trigger("focus");}}}else{self.$refs.container.trigger("focus");}},activate:function(){var self=this;$(".fancybox-container").each(function(){var instance=$(this).data("FancyBox");if(instance&&instance.id!==self.id&&!instance.isClosing){instance.trigger("onDeactivate");instance.removeEvents();instance.isVisible=false;}});self.isVisible=true;if(self.current||self.isIdle){self.update();self.updateControls();}
self.trigger("onActivate");self.addEvents();},close:function(e,d){var self=this,current=self.current,effect,duration,$content,domRect,opacity,start,end;var done=function(){self.cleanUp(e);};if(self.isClosing){return false;}
self.isClosing=true;if(self.trigger("beforeClose",e)===false){self.isClosing=false;requestAFrame(function(){self.update();});return false;}
self.removeEvents();$content=current.$content;effect=current.opts.animationEffect;duration=$.isNumeric(d)?d:effect?current.opts.animationDuration:0;current.$slide.removeClass("fancybox-slide--complete fancybox-slide--next fancybox-slide--previous fancybox-animated");if(e!==true){$.fancybox.stop(current.$slide);}else{effect=false;}
current.$slide.siblings().trigger("onReset").remove();if(duration){self.$refs.container.removeClass("fancybox-is-open").addClass("fancybox-is-closing").css("transition-duration",duration+"ms");}
self.hideLoading(current);self.hideControls(true);self.updateCursor();if(effect==="zoom"&&!($content&&duration&&current.type==="image"&&!self.isMoved()&&!current.hasError&&(end=self.getThumbPos(current)))){effect="fade";}
if(effect==="zoom"){$.fancybox.stop($content);domRect=$.fancybox.getTranslate($content);start={top:domRect.top,left:domRect.left,scaleX:domRect.width/end.width,scaleY:domRect.height/end.height,width:end.width,height:end.height};opacity=current.opts.zoomOpacity;if(opacity=="auto"){opacity=Math.abs(current.width/current.height-end.width/end.height)>0.1;}
if(opacity){end.opacity=0;}
$.fancybox.setTranslate($content,start);forceRedraw($content);$.fancybox.animate($content,end,duration,done);return true;}
if(effect&&duration){$.fancybox.animate(current.$slide.addClass("fancybox-slide--previous").removeClass("fancybox-slide--current"),"fancybox-animated fancybox-fx-"+effect,duration,done);}else{if(e===true){setTimeout(done,duration);}else{done();}}
return true;},cleanUp:function(e){var self=this,instance,$focus=self.current.opts.$orig,x,y;self.current.$slide.trigger("onReset");self.$refs.container.empty().remove();self.trigger("afterClose",e);if(!!self.current.opts.backFocus){if(!$focus||!$focus.length||!$focus.is(":visible")){$focus=self.$trigger;}
if($focus&&$focus.length){x=window.scrollX;y=window.scrollY;$focus.trigger("focus");$("html, body").scrollTop(y).scrollLeft(x);}}
self.current=null;instance=$.fancybox.getInstance();if(instance){instance.activate();}else{$("body").removeClass("fancybox-active compensate-for-scrollbar");$("#fancybox-style-noscroll").remove();}},trigger:function(name,slide){var args=Array.prototype.slice.call(arguments,1),self=this,obj=slide&&slide.opts?slide:self.current,rez;if(obj){args.unshift(obj);}else{obj=self;}
args.unshift(self);if($.isFunction(obj.opts[name])){rez=obj.opts[name].apply(obj,args);}
if(rez===false){return rez;}
if(name==="afterClose"||!self.$refs){$D.trigger(name+".fb",args);}else{self.$refs.container.trigger(name+".fb",args);}},updateControls:function(){var self=this,current=self.current,index=current.index,$container=self.$refs.container,$caption=self.$refs.caption,caption=current.opts.caption;current.$slide.trigger("refresh");if(caption&&caption.length){self.$caption=$caption;$caption.children().eq(0).html(caption);}else{self.$caption=null;}
if(!self.hasHiddenControls&&!self.isIdle){self.showControls();}
$container.find("[data-fancybox-count]").html(self.group.length);$container.find("[data-fancybox-index]").html(index+1);$container.find("[data-fancybox-prev]").prop("disabled",!current.opts.loop&&index<=0);$container.find("[data-fancybox-next]").prop("disabled",!current.opts.loop&&index>=self.group.length-1);if(current.type==="image"){$container.find("[data-fancybox-zoom]").show().end().find("[data-fancybox-download]").attr("href",current.opts.image.src||current.src).show();}else if(current.opts.toolbar){$container.find("[data-fancybox-download],[data-fancybox-zoom]").hide();}
if($(document.activeElement).is(":hidden,[disabled]")){self.$refs.container.trigger("focus");}},hideControls:function(andCaption){var self=this,arr=["infobar","toolbar","nav"];if(andCaption||!self.current.opts.preventCaptionOverlap){arr.push("caption");}
this.$refs.container.removeClass(arr.map(function(i){return"fancybox-show-"+i;}).join(" "));this.hasHiddenControls=true;},showControls:function(){var self=this,opts=self.current?self.current.opts:self.opts,$container=self.$refs.container;self.hasHiddenControls=false;self.idleSecondsCounter=0;$container.toggleClass("fancybox-show-toolbar",!!(opts.toolbar&&opts.buttons)).toggleClass("fancybox-show-infobar",!!(opts.infobar&&self.group.length>1)).toggleClass("fancybox-show-caption",!!self.$caption).toggleClass("fancybox-show-nav",!!(opts.arrows&&self.group.length>1)).toggleClass("fancybox-is-modal",!!opts.modal);},toggleControls:function(){if(this.hasHiddenControls){this.showControls();}else{this.hideControls();}}});$.fancybox={version:"3.5.5",defaults:defaults,getInstance:function(command){var instance=$('.fancybox-container:not(".fancybox-is-closing"):last').data("FancyBox"),args=Array.prototype.slice.call(arguments,1);if(instance instanceof FancyBox){if($.type(command)==="string"){instance[command].apply(instance,args);}else if($.type(command)==="function"){command.apply(instance,args);}
return instance;}
return false;},open:function(items,opts,index){return new FancyBox(items,opts,index);},close:function(all){var instance=this.getInstance();if(instance){instance.close();if(all===true){this.close(all);}}},destroy:function(){this.close(true);$D.add("body").off("click.fb-start","**");},isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),use3d:(function(){var div=document.createElement("div");return(window.getComputedStyle&&window.getComputedStyle(div)&&window.getComputedStyle(div).getPropertyValue("transform")&&!(document.documentMode&&document.documentMode<11));})(),getTranslate:function($el){var domRect;if(!$el||!$el.length){return false;}
domRect=$el[0].getBoundingClientRect();return{top:domRect.top||0,left:domRect.left||0,width:domRect.width,height:domRect.height,opacity:parseFloat($el.css("opacity"))};},setTranslate:function($el,props){var str="",css={};if(!$el||!props){return;}
if(props.left!==undefined||props.top!==undefined){str=(props.left===undefined?$el.position().left:props.left)+"px, "+
(props.top===undefined?$el.position().top:props.top)+"px";if(this.use3d){str="translate3d("+str+", 0px)";}else{str="translate("+str+")";}}
if(props.scaleX!==undefined&&props.scaleY!==undefined){str+=" scale("+props.scaleX+", "+props.scaleY+")";}else if(props.scaleX!==undefined){str+=" scaleX("+props.scaleX+")";}
if(str.length){css.transform=str;}
if(props.opacity!==undefined){css.opacity=props.opacity;}
if(props.width!==undefined){css.width=props.width;}
if(props.height!==undefined){css.height=props.height;}
return $el.css(css);},animate:function($el,to,duration,callback,leaveAnimationName){var self=this,from;if($.isFunction(duration)){callback=duration;duration=null;}
self.stop($el);from=self.getTranslate($el);$el.on(transitionEnd,function(e){if(e&&e.originalEvent&&(!$el.is(e.originalEvent.target)||e.originalEvent.propertyName=="z-index")){return;}
self.stop($el);if($.isNumeric(duration)){$el.css("transition-duration","");}
if($.isPlainObject(to)){if(to.scaleX!==undefined&&to.scaleY!==undefined){self.setTranslate($el,{top:to.top,left:to.left,width:from.width*to.scaleX,height:from.height*to.scaleY,scaleX:1,scaleY:1});}}else if(leaveAnimationName!==true){$el.removeClass(to);}
if($.isFunction(callback)){callback(e);}});if($.isNumeric(duration)){$el.css("transition-duration",duration+"ms");}
if($.isPlainObject(to)){if(to.scaleX!==undefined&&to.scaleY!==undefined){delete to.width;delete to.height;if($el.parent().hasClass("fancybox-slide--image")){$el.parent().addClass("fancybox-is-scaling");}}
$.fancybox.setTranslate($el,to);}else{$el.addClass(to);}
$el.data("timer",setTimeout(function(){$el.trigger(transitionEnd);},duration+33));},stop:function($el,callCallback){if($el&&$el.length){clearTimeout($el.data("timer"));if(callCallback){$el.trigger(transitionEnd);}
$el.off(transitionEnd).css("transition-duration","");$el.parent().removeClass("fancybox-is-scaling");}}};function _run(e,opts){var items=[],index=0,$target,value,instance;if(e&&e.isDefaultPrevented()){return;}
e.preventDefault();opts=opts||{};if(e&&e.data){opts=mergeOpts(e.data.options,opts);}
$target=opts.$target||$(e.currentTarget).trigger("blur");instance=$.fancybox.getInstance();if(instance&&instance.$trigger&&instance.$trigger.is($target)){return;}
if(opts.selector){items=$(opts.selector);}else{value=$target.attr("data-fancybox")||"";if(value){items=e.data?e.data.items:[];items=items.length?items.filter('[data-fancybox="'+value+'"]'):$('[data-fancybox="'+value+'"]');}else{items=[$target];}}
index=$(items).index($target);if(index<0){index=0;}
instance=$.fancybox.open(items,opts,index);instance.$trigger=$target;}
$.fn.fancybox=function(options){var selector;options=options||{};selector=options.selector||false;if(selector){$("body").off("click.fb-start",selector).on("click.fb-start",selector,{options:options},_run);}else{this.off("click.fb-start").on("click.fb-start",{items:this,options:options},_run);}
return this;};$D.on("click.fb-start","[data-fancybox]",_run);$D.on("click.fb-start","[data-fancybox-trigger]",function(e){$('[data-fancybox="'+$(this).attr("data-fancybox-trigger")+'"]').eq($(this).attr("data-fancybox-index")||0).trigger("click.fb-start",{$trigger:$(this)});});(function(){var buttonStr=".fancybox-button",focusStr="fancybox-focus",$pressed=null;$D.on("mousedown mouseup focus blur",buttonStr,function(e){switch(e.type){case"mousedown":$pressed=$(this);break;case"mouseup":$pressed=null;break;case"focusin":$(buttonStr).removeClass(focusStr);if(!$(this).is($pressed)&&!$(this).is("[disabled]")){$(this).addClass(focusStr);}
break;case"focusout":$(buttonStr).removeClass(focusStr);break;}});})();})(window,document,jQuery);(function($){"use strict";var defaults={youtube:{matcher:/(youtube\.com|youtu\.be|youtube\-nocookie\.com)\/(watch\?(.*&)?v=|v\/|u\/|embed\/?)?(videoseries\?list=(.*)|[\w-]{11}|\?listType=(.*)&list=(.*))(.*)/i,params:{autoplay:1,autohide:1,fs:1,rel:0,hd:1,wmode:"transparent",enablejsapi:1,html5:1},paramPlace:8,type:"iframe",url:"https://www.youtube-nocookie.com/embed/$4",thumb:"https://img.youtube.com/vi/$4/hqdefault.jpg"},vimeo:{matcher:/^.+vimeo.com\/(.*\/)?([\d]+)(.*)?/,params:{autoplay:1,hd:1,show_title:1,show_byline:1,show_portrait:0,fullscreen:1},paramPlace:3,type:"iframe",url:"//player.vimeo.com/video/$2"},instagram:{matcher:/(instagr\.am|instagram\.com)\/p\/([a-zA-Z0-9_\-]+)\/?/i,type:"image",url:"//$1/p/$2/media/?size=l"},gmap_place:{matcher:/(maps\.)?google\.([a-z]{2,3}(\.[a-z]{2})?)\/(((maps\/(place\/(.*)\/)?\@(.*),(\d+.?\d+?)z))|(\?ll=))(.*)?/i,type:"iframe",url:function(rez){return("//maps.google."+
rez[2]+"/?ll="+
(rez[9]?rez[9]+"&z="+Math.floor(rez[10])+(rez[12]?rez[12].replace(/^\//,"&"):""):rez[12]+"").replace(/\?/,"&")+"&output="+
(rez[12]&&rez[12].indexOf("layer=c")>0?"svembed":"embed"));}},gmap_search:{matcher:/(maps\.)?google\.([a-z]{2,3}(\.[a-z]{2})?)\/(maps\/search\/)(.*)/i,type:"iframe",url:function(rez){return"//maps.google."+rez[2]+"/maps?q="+rez[5].replace("query=","q=").replace("api=1","")+"&output=embed";}}};var format=function(url,rez,params){if(!url){return;}
params=params||"";if($.type(params)==="object"){params=$.param(params,true);}
$.each(rez,function(key,value){url=url.replace("$"+key,value||"");});if(params.length){url+=(url.indexOf("?")>0?"&":"?")+params;}
return url;};$(document).on("objectNeedsType.fb",function(e,instance,item){var url=item.src||"",type=false,media,thumb,rez,params,urlParams,paramObj,provider;media=$.extend(true,{},defaults,item.opts.media);$.each(media,function(providerName,providerOpts){rez=url.match(providerOpts.matcher);if(!rez){return;}
type=providerOpts.type;provider=providerName;paramObj={};if(providerOpts.paramPlace&&rez[providerOpts.paramPlace]){urlParams=rez[providerOpts.paramPlace];if(urlParams[0]=="?"){urlParams=urlParams.substring(1);}
urlParams=urlParams.split("&");for(var m=0;m<urlParams.length;++m){var p=urlParams[m].split("=",2);if(p.length==2){paramObj[p[0]]=decodeURIComponent(p[1].replace(/\+/g," "));}}}
params=$.extend(true,{},providerOpts.params,item.opts[providerName],paramObj);url=$.type(providerOpts.url)==="function"?providerOpts.url.call(this,rez,params,item):format(providerOpts.url,rez,params);thumb=$.type(providerOpts.thumb)==="function"?providerOpts.thumb.call(this,rez,params,item):format(providerOpts.thumb,rez);if(providerName==="youtube"){url=url.replace(/&t=((\d+)m)?(\d+)s/,function(match,p1,m,s){return"&start="+((m?parseInt(m,10)*60:0)+parseInt(s,10));});}else if(providerName==="vimeo"){url=url.replace("&%23","#");}
return false;});if(type){if(!item.opts.thumb&&!(item.opts.$thumb&&item.opts.$thumb.length)){item.opts.thumb=thumb;}
if(type==="iframe"){item.opts=$.extend(true,item.opts,{iframe:{preload:false,attr:{scrolling:"no"}}});}
$.extend(item,{type:type,src:url,origSrc:item.src,contentSource:provider,contentType:type==="image"?"image":provider=="gmap_place"||provider=="gmap_search"?"map":"video"});}else if(url){item.type=item.opts.defaultType;}});var VideoAPILoader={youtube:{src:"https://www.youtube.com/iframe_api",class:"YT",loading:false,loaded:false},vimeo:{src:"https://player.vimeo.com/api/player.js",class:"Vimeo",loading:false,loaded:false},load:function(vendor){var _this=this,script;if(this[vendor].loaded){setTimeout(function(){_this.done(vendor);});return;}
if(this[vendor].loading){return;}
this[vendor].loading=true;script=document.createElement("script");script.type="text/javascript";script.src=this[vendor].src;if(vendor==="youtube"){window.onYouTubeIframeAPIReady=function(){_this[vendor].loaded=true;_this.done(vendor);};}else{script.onload=function(){_this[vendor].loaded=true;_this.done(vendor);};}
document.body.appendChild(script);},done:function(vendor){var instance,$el,player;if(vendor==="youtube"){delete window.onYouTubeIframeAPIReady;}
instance=$.fancybox.getInstance();if(instance){$el=instance.current.$content.find("iframe");if(vendor==="youtube"&&YT!==undefined&&YT){player=new YT.Player($el.attr("id"),{events:{onStateChange:function(e){if(e.data==0){instance.next();}}}});}else if(vendor==="vimeo"&&Vimeo!==undefined&&Vimeo){player=new Vimeo.Player($el);player.on("ended",function(){instance.next();});}}}};$(document).on({"afterShow.fb":function(e,instance,current){if(instance.group.length>1&&(current.contentSource==="youtube"||current.contentSource==="vimeo")){VideoAPILoader.load(current.contentSource);}}});})(jQuery);(function(window,document,$){"use strict";var requestAFrame=(function(){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(callback){return window.setTimeout(callback,1000/60);});})();var cancelAFrame=(function(){return(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(id){window.clearTimeout(id);});})();var getPointerXY=function(e){var result=[];e=e.originalEvent||e||window.e;e=e.touches&&e.touches.length?e.touches:e.changedTouches&&e.changedTouches.length?e.changedTouches:[e];for(var key in e){if(e[key].pageX){result.push({x:e[key].pageX,y:e[key].pageY});}else if(e[key].clientX){result.push({x:e[key].clientX,y:e[key].clientY});}}
return result;};var distance=function(point2,point1,what){if(!point1||!point2){return 0;}
if(what==="x"){return point2.x-point1.x;}else if(what==="y"){return point2.y-point1.y;}
return Math.sqrt(Math.pow(point2.x-point1.x,2)+Math.pow(point2.y-point1.y,2));};var isClickable=function($el){if($el.is('a,area,button,[role="button"],input,label,select,summary,textarea,video,audio,iframe')||$.isFunction($el.get(0).onclick)||$el.data("selectable")){return true;}
for(var i=0,atts=$el[0].attributes,n=atts.length;i<n;i++){if(atts[i].nodeName.substr(0,14)==="data-fancybox-"){return true;}}
return false;};var hasScrollbars=function(el){var overflowY=window.getComputedStyle(el)["overflow-y"],overflowX=window.getComputedStyle(el)["overflow-x"],vertical=(overflowY==="scroll"||overflowY==="auto")&&el.scrollHeight>el.clientHeight,horizontal=(overflowX==="scroll"||overflowX==="auto")&&el.scrollWidth>el.clientWidth;return vertical||horizontal;};var isScrollable=function($el){var rez=false;while(true){rez=hasScrollbars($el.get(0));if(rez){break;}
$el=$el.parent();if(!$el.length||$el.hasClass("fancybox-stage")||$el.is("body")){break;}}
return rez;};var Guestures=function(instance){var self=this;self.instance=instance;self.$bg=instance.$refs.bg;self.$stage=instance.$refs.stage;self.$container=instance.$refs.container;self.destroy();self.$container.on("touchstart.fb.touch mousedown.fb.touch",$.proxy(self,"ontouchstart"));};Guestures.prototype.destroy=function(){var self=this;self.$container.off(".fb.touch");$(document).off(".fb.touch");if(self.requestId){cancelAFrame(self.requestId);self.requestId=null;}
if(self.tapped){clearTimeout(self.tapped);self.tapped=null;}};Guestures.prototype.ontouchstart=function(e){var self=this,$target=$(e.target),instance=self.instance,current=instance.current,$slide=current.$slide,$content=current.$content,isTouchDevice=e.type=="touchstart";if(isTouchDevice){self.$container.off("mousedown.fb.touch");}
if(e.originalEvent&&e.originalEvent.button==2){return;}
if(!$slide.length||!$target.length||isClickable($target)||isClickable($target.parent())){return;}
if(!$target.is("img")&&e.originalEvent.clientX>$target[0].clientWidth+$target.offset().left){return;}
if(!current||instance.isAnimating||current.$slide.hasClass("fancybox-animated")){e.stopPropagation();e.preventDefault();return;}
self.realPoints=self.startPoints=getPointerXY(e);if(!self.startPoints.length){return;}
if(current.touch){e.stopPropagation();}
self.startEvent=e;self.canTap=true;self.$target=$target;self.$content=$content;self.opts=current.opts.touch;self.isPanning=false;self.isSwiping=false;self.isZooming=false;self.isScrolling=false;self.canPan=instance.canPan();self.startTime=new Date().getTime();self.distanceX=self.distanceY=self.distance=0;self.canvasWidth=Math.round($slide[0].clientWidth);self.canvasHeight=Math.round($slide[0].clientHeight);self.contentLastPos=null;self.contentStartPos=$.fancybox.getTranslate(self.$content)||{top:0,left:0};self.sliderStartPos=$.fancybox.getTranslate($slide);self.stagePos=$.fancybox.getTranslate(instance.$refs.stage);self.sliderStartPos.top-=self.stagePos.top;self.sliderStartPos.left-=self.stagePos.left;self.contentStartPos.top-=self.stagePos.top;self.contentStartPos.left-=self.stagePos.left;$(document).off(".fb.touch").on(isTouchDevice?"touchend.fb.touch touchcancel.fb.touch":"mouseup.fb.touch mouseleave.fb.touch",$.proxy(self,"ontouchend")).on(isTouchDevice?"touchmove.fb.touch":"mousemove.fb.touch",$.proxy(self,"ontouchmove"));if($.fancybox.isMobile){document.addEventListener("scroll",self.onscroll,true);}
if(!(self.opts||self.canPan)||!($target.is(self.$stage)||self.$stage.find($target).length)){if($target.is(".fancybox-image")){e.preventDefault();}
if(!($.fancybox.isMobile&&$target.hasClass("fancybox-caption"))){return;}}
self.isScrollable=isScrollable($target)||isScrollable($target.parent());if(!($.fancybox.isMobile&&self.isScrollable)){e.preventDefault();}
if(self.startPoints.length===1||current.hasError){if(self.canPan){$.fancybox.stop(self.$content);self.isPanning=true;}else{self.isSwiping=true;}
self.$container.addClass("fancybox-is-grabbing");}
if(self.startPoints.length===2&&current.type==="image"&&(current.isLoaded||current.$ghost)){self.canTap=false;self.isSwiping=false;self.isPanning=false;self.isZooming=true;$.fancybox.stop(self.$content);self.centerPointStartX=(self.startPoints[0].x+self.startPoints[1].x)*0.5-$(window).scrollLeft();self.centerPointStartY=(self.startPoints[0].y+self.startPoints[1].y)*0.5-$(window).scrollTop();self.percentageOfImageAtPinchPointX=(self.centerPointStartX-self.contentStartPos.left)/self.contentStartPos.width;self.percentageOfImageAtPinchPointY=(self.centerPointStartY-self.contentStartPos.top)/self.contentStartPos.height;self.startDistanceBetweenFingers=distance(self.startPoints[0],self.startPoints[1]);}};Guestures.prototype.onscroll=function(e){var self=this;self.isScrolling=true;document.removeEventListener("scroll",self.onscroll,true);};Guestures.prototype.ontouchmove=function(e){var self=this;if(e.originalEvent.buttons!==undefined&&e.originalEvent.buttons===0){self.ontouchend(e);return;}
if(self.isScrolling){self.canTap=false;return;}
self.newPoints=getPointerXY(e);if(!(self.opts||self.canPan)||!self.newPoints.length||!self.newPoints.length){return;}
if(!(self.isSwiping&&self.isSwiping===true)){e.preventDefault();}
self.distanceX=distance(self.newPoints[0],self.startPoints[0],"x");self.distanceY=distance(self.newPoints[0],self.startPoints[0],"y");self.distance=distance(self.newPoints[0],self.startPoints[0]);if(self.distance>0){if(self.isSwiping){self.onSwipe(e);}else if(self.isPanning){self.onPan();}else if(self.isZooming){self.onZoom();}}};Guestures.prototype.onSwipe=function(e){var self=this,instance=self.instance,swiping=self.isSwiping,left=self.sliderStartPos.left||0,angle;if(swiping===true){if(Math.abs(self.distance)>10){self.canTap=false;if(instance.group.length<2&&self.opts.vertical){self.isSwiping="y";}else if(instance.isDragging||self.opts.vertical===false||(self.opts.vertical==="auto"&&$(window).width()>800)){self.isSwiping="x";}else{angle=Math.abs((Math.atan2(self.distanceY,self.distanceX)*180)/Math.PI);self.isSwiping=angle>45&&angle<135?"y":"x";}
if(self.isSwiping==="y"&&$.fancybox.isMobile&&self.isScrollable){self.isScrolling=true;return;}
instance.isDragging=self.isSwiping;self.startPoints=self.newPoints;$.each(instance.slides,function(index,slide){var slidePos,stagePos;$.fancybox.stop(slide.$slide);slidePos=$.fancybox.getTranslate(slide.$slide);stagePos=$.fancybox.getTranslate(instance.$refs.stage);slide.$slide.css({transform:"",opacity:"","transition-duration":""}).removeClass("fancybox-animated").removeClass(function(index,className){return(className.match(/(^|\s)fancybox-fx-\S+/g)||[]).join(" ");});if(slide.pos===instance.current.pos){self.sliderStartPos.top=slidePos.top-stagePos.top;self.sliderStartPos.left=slidePos.left-stagePos.left;}
$.fancybox.setTranslate(slide.$slide,{top:slidePos.top-stagePos.top,left:slidePos.left-stagePos.left});});if(instance.SlideShow&&instance.SlideShow.isActive){instance.SlideShow.stop();}}
return;}
if(swiping=="x"){if(self.distanceX>0&&(self.instance.group.length<2||(self.instance.current.index===0&&!self.instance.current.opts.loop))){left=left+Math.pow(self.distanceX,0.8);}else if(self.distanceX<0&&(self.instance.group.length<2||(self.instance.current.index===self.instance.group.length-1&&!self.instance.current.opts.loop))){left=left-Math.pow(-self.distanceX,0.8);}else{left=left+self.distanceX;}}
self.sliderLastPos={top:swiping=="x"?0:self.sliderStartPos.top+self.distanceY,left:left};if(self.requestId){cancelAFrame(self.requestId);self.requestId=null;}
self.requestId=requestAFrame(function(){if(self.sliderLastPos){$.each(self.instance.slides,function(index,slide){var pos=slide.pos-self.instance.currPos;$.fancybox.setTranslate(slide.$slide,{top:self.sliderLastPos.top,left:self.sliderLastPos.left+pos*self.canvasWidth+pos*slide.opts.gutter});});self.$container.addClass("fancybox-is-sliding");}});};Guestures.prototype.onPan=function(){var self=this;if(distance(self.newPoints[0],self.realPoints[0])<($.fancybox.isMobile?10:5)){self.startPoints=self.newPoints;return;}
self.canTap=false;self.contentLastPos=self.limitMovement();if(self.requestId){cancelAFrame(self.requestId);}
self.requestId=requestAFrame(function(){$.fancybox.setTranslate(self.$content,self.contentLastPos);});};Guestures.prototype.limitMovement=function(){var self=this;var canvasWidth=self.canvasWidth;var canvasHeight=self.canvasHeight;var distanceX=self.distanceX;var distanceY=self.distanceY;var contentStartPos=self.contentStartPos;var currentOffsetX=contentStartPos.left;var currentOffsetY=contentStartPos.top;var currentWidth=contentStartPos.width;var currentHeight=contentStartPos.height;var minTranslateX,minTranslateY,maxTranslateX,maxTranslateY,newOffsetX,newOffsetY;if(currentWidth>canvasWidth){newOffsetX=currentOffsetX+distanceX;}else{newOffsetX=currentOffsetX;}
newOffsetY=currentOffsetY+distanceY;minTranslateX=Math.max(0,canvasWidth*0.5-currentWidth*0.5);minTranslateY=Math.max(0,canvasHeight*0.5-currentHeight*0.5);maxTranslateX=Math.min(canvasWidth-currentWidth,canvasWidth*0.5-currentWidth*0.5);maxTranslateY=Math.min(canvasHeight-currentHeight,canvasHeight*0.5-currentHeight*0.5);if(distanceX>0&&newOffsetX>minTranslateX){newOffsetX=minTranslateX-1+Math.pow(-minTranslateX+currentOffsetX+distanceX,0.8)||0;}
if(distanceX<0&&newOffsetX<maxTranslateX){newOffsetX=maxTranslateX+1-Math.pow(maxTranslateX-currentOffsetX-distanceX,0.8)||0;}
if(distanceY>0&&newOffsetY>minTranslateY){newOffsetY=minTranslateY-1+Math.pow(-minTranslateY+currentOffsetY+distanceY,0.8)||0;}
if(distanceY<0&&newOffsetY<maxTranslateY){newOffsetY=maxTranslateY+1-Math.pow(maxTranslateY-currentOffsetY-distanceY,0.8)||0;}
return{top:newOffsetY,left:newOffsetX};};Guestures.prototype.limitPosition=function(newOffsetX,newOffsetY,newWidth,newHeight){var self=this;var canvasWidth=self.canvasWidth;var canvasHeight=self.canvasHeight;if(newWidth>canvasWidth){newOffsetX=newOffsetX>0?0:newOffsetX;newOffsetX=newOffsetX<canvasWidth-newWidth?canvasWidth-newWidth:newOffsetX;}else{newOffsetX=Math.max(0,canvasWidth/2-newWidth/2);}
if(newHeight>canvasHeight){newOffsetY=newOffsetY>0?0:newOffsetY;newOffsetY=newOffsetY<canvasHeight-newHeight?canvasHeight-newHeight:newOffsetY;}else{newOffsetY=Math.max(0,canvasHeight/2-newHeight/2);}
return{top:newOffsetY,left:newOffsetX};};Guestures.prototype.onZoom=function(){var self=this;var contentStartPos=self.contentStartPos;var currentWidth=contentStartPos.width;var currentHeight=contentStartPos.height;var currentOffsetX=contentStartPos.left;var currentOffsetY=contentStartPos.top;var endDistanceBetweenFingers=distance(self.newPoints[0],self.newPoints[1]);var pinchRatio=endDistanceBetweenFingers/self.startDistanceBetweenFingers;var newWidth=Math.floor(currentWidth*pinchRatio);var newHeight=Math.floor(currentHeight*pinchRatio);var translateFromZoomingX=(currentWidth-newWidth)*self.percentageOfImageAtPinchPointX;var translateFromZoomingY=(currentHeight-newHeight)*self.percentageOfImageAtPinchPointY;var centerPointEndX=(self.newPoints[0].x+self.newPoints[1].x)/2-$(window).scrollLeft();var centerPointEndY=(self.newPoints[0].y+self.newPoints[1].y)/2-$(window).scrollTop();var translateFromTranslatingX=centerPointEndX-self.centerPointStartX;var translateFromTranslatingY=centerPointEndY-self.centerPointStartY;var newOffsetX=currentOffsetX+(translateFromZoomingX+translateFromTranslatingX);var newOffsetY=currentOffsetY+(translateFromZoomingY+translateFromTranslatingY);var newPos={top:newOffsetY,left:newOffsetX,scaleX:pinchRatio,scaleY:pinchRatio};self.canTap=false;self.newWidth=newWidth;self.newHeight=newHeight;self.contentLastPos=newPos;if(self.requestId){cancelAFrame(self.requestId);}
self.requestId=requestAFrame(function(){$.fancybox.setTranslate(self.$content,self.contentLastPos);});};Guestures.prototype.ontouchend=function(e){var self=this;var swiping=self.isSwiping;var panning=self.isPanning;var zooming=self.isZooming;var scrolling=self.isScrolling;self.endPoints=getPointerXY(e);self.dMs=Math.max(new Date().getTime()-self.startTime,1);self.$container.removeClass("fancybox-is-grabbing");$(document).off(".fb.touch");document.removeEventListener("scroll",self.onscroll,true);if(self.requestId){cancelAFrame(self.requestId);self.requestId=null;}
self.isSwiping=false;self.isPanning=false;self.isZooming=false;self.isScrolling=false;self.instance.isDragging=false;if(self.canTap){return self.onTap(e);}
self.speed=100;self.velocityX=(self.distanceX/self.dMs)*0.5;self.velocityY=(self.distanceY/self.dMs)*0.5;if(panning){self.endPanning();}else if(zooming){self.endZooming();}else{self.endSwiping(swiping,scrolling);}
return;};Guestures.prototype.endSwiping=function(swiping,scrolling){var self=this,ret=false,len=self.instance.group.length,distanceX=Math.abs(self.distanceX),canAdvance=swiping=="x"&&len>1&&((self.dMs>130&&distanceX>10)||distanceX>50),speedX=300;self.sliderLastPos=null;if(swiping=="y"&&!scrolling&&Math.abs(self.distanceY)>50){$.fancybox.animate(self.instance.current.$slide,{top:self.sliderStartPos.top+self.distanceY+self.velocityY*150,opacity:0},200);ret=self.instance.close(true,250);}else if(canAdvance&&self.distanceX>0){ret=self.instance.previous(speedX);}else if(canAdvance&&self.distanceX<0){ret=self.instance.next(speedX);}
if(ret===false&&(swiping=="x"||swiping=="y")){self.instance.centerSlide(200);}
self.$container.removeClass("fancybox-is-sliding");};Guestures.prototype.endPanning=function(){var self=this,newOffsetX,newOffsetY,newPos;if(!self.contentLastPos){return;}
if(self.opts.momentum===false||self.dMs>350){newOffsetX=self.contentLastPos.left;newOffsetY=self.contentLastPos.top;}else{newOffsetX=self.contentLastPos.left+self.velocityX*500;newOffsetY=self.contentLastPos.top+self.velocityY*500;}
newPos=self.limitPosition(newOffsetX,newOffsetY,self.contentStartPos.width,self.contentStartPos.height);newPos.width=self.contentStartPos.width;newPos.height=self.contentStartPos.height;$.fancybox.animate(self.$content,newPos,366);};Guestures.prototype.endZooming=function(){var self=this;var current=self.instance.current;var newOffsetX,newOffsetY,newPos,reset;var newWidth=self.newWidth;var newHeight=self.newHeight;if(!self.contentLastPos){return;}
newOffsetX=self.contentLastPos.left;newOffsetY=self.contentLastPos.top;reset={top:newOffsetY,left:newOffsetX,width:newWidth,height:newHeight,scaleX:1,scaleY:1};$.fancybox.setTranslate(self.$content,reset);if(newWidth<self.canvasWidth&&newHeight<self.canvasHeight){self.instance.scaleToFit(150);}else if(newWidth>current.width||newHeight>current.height){self.instance.scaleToActual(self.centerPointStartX,self.centerPointStartY,150);}else{newPos=self.limitPosition(newOffsetX,newOffsetY,newWidth,newHeight);$.fancybox.animate(self.$content,newPos,150);}};Guestures.prototype.onTap=function(e){var self=this;var $target=$(e.target);var instance=self.instance;var current=instance.current;var endPoints=(e&&getPointerXY(e))||self.startPoints;var tapX=endPoints[0]?endPoints[0].x-$(window).scrollLeft()-self.stagePos.left:0;var tapY=endPoints[0]?endPoints[0].y-$(window).scrollTop()-self.stagePos.top:0;var where;var process=function(prefix){var action=current.opts[prefix];if($.isFunction(action)){action=action.apply(instance,[current,e]);}
if(!action){return;}
switch(action){case"close":instance.close(self.startEvent);break;case"toggleControls":instance.toggleControls();break;case"next":instance.next();break;case"nextOrClose":if(instance.group.length>1){instance.next();}else{instance.close(self.startEvent);}
break;case"zoom":if(current.type=="image"&&(current.isLoaded||current.$ghost)){if(instance.canPan()){instance.scaleToFit();}else if(instance.isScaledDown()){instance.scaleToActual(tapX,tapY);}else if(instance.group.length<2){instance.close(self.startEvent);}}
break;}};if(e.originalEvent&&e.originalEvent.button==2){return;}
if(!$target.is("img")&&tapX>$target[0].clientWidth+$target.offset().left){return;}
if($target.is(".fancybox-bg,.fancybox-inner,.fancybox-outer,.fancybox-container")){where="Outside";}else if($target.is(".fancybox-slide")){where="Slide";}else if(instance.current.$content&&instance.current.$content.find($target).addBack().filter($target).length){where="Content";}else{return;}
if(self.tapped){clearTimeout(self.tapped);self.tapped=null;if(Math.abs(tapX-self.tapX)>50||Math.abs(tapY-self.tapY)>50){return this;}
process("dblclick"+where);}else{self.tapX=tapX;self.tapY=tapY;if(current.opts["dblclick"+where]&&current.opts["dblclick"+where]!==current.opts["click"+where]){self.tapped=setTimeout(function(){self.tapped=null;if(!instance.isAnimating){process("click"+where);}},500);}else{process("click"+where);}}
return this;};$(document).on("onActivate.fb",function(e,instance){if(instance&&!instance.Guestures){instance.Guestures=new Guestures(instance);}}).on("beforeClose.fb",function(e,instance){if(instance&&instance.Guestures){instance.Guestures.destroy();}});})(window,document,jQuery);(function(document,$){"use strict";$.extend(true,$.fancybox.defaults,{btnTpl:{slideShow:'<button data-fancybox-play class="fancybox-button fancybox-button--play" title="{{PLAY_START}}">'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.5 5.4v13.2l11-6.6z"/></svg>'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.33 5.75h2.2v12.5h-2.2V5.75zm5.15 0h2.2v12.5h-2.2V5.75z"/></svg>'+"</button>"},slideShow:{autoStart:false,speed:3000,progress:true}});var SlideShow=function(instance){this.instance=instance;this.init();};$.extend(SlideShow.prototype,{timer:null,isActive:false,$button:null,init:function(){var self=this,instance=self.instance,opts=instance.group[instance.currIndex].opts.slideShow;self.$button=instance.$refs.toolbar.find("[data-fancybox-play]").on("click",function(){self.toggle();});if(instance.group.length<2||!opts){self.$button.hide();}else if(opts.progress){self.$progress=$('<div class="fancybox-progress"></div>').appendTo(instance.$refs.inner);}},set:function(force){var self=this,instance=self.instance,current=instance.current;if(current&&(force===true||current.opts.loop||instance.currIndex<instance.group.length-1)){if(self.isActive&&current.contentType!=="video"){if(self.$progress){$.fancybox.animate(self.$progress.show(),{scaleX:1},current.opts.slideShow.speed);}
self.timer=setTimeout(function(){if(!instance.current.opts.loop&&instance.current.index==instance.group.length-1){instance.jumpTo(0);}else{instance.next();}},current.opts.slideShow.speed);}}else{self.stop();instance.idleSecondsCounter=0;instance.showControls();}},clear:function(){var self=this;clearTimeout(self.timer);self.timer=null;if(self.$progress){self.$progress.removeAttr("style").hide();}},start:function(){var self=this,current=self.instance.current;if(current){self.$button.attr("title",(current.opts.i18n[current.opts.lang]||current.opts.i18n.en).PLAY_STOP).removeClass("fancybox-button--play").addClass("fancybox-button--pause");self.isActive=true;if(current.isComplete){self.set(true);}
self.instance.trigger("onSlideShowChange",true);}},stop:function(){var self=this,current=self.instance.current;self.clear();self.$button.attr("title",(current.opts.i18n[current.opts.lang]||current.opts.i18n.en).PLAY_START).removeClass("fancybox-button--pause").addClass("fancybox-button--play");self.isActive=false;self.instance.trigger("onSlideShowChange",false);if(self.$progress){self.$progress.removeAttr("style").hide();}},toggle:function(){var self=this;if(self.isActive){self.stop();}else{self.start();}}});$(document).on({"onInit.fb":function(e,instance){if(instance&&!instance.SlideShow){instance.SlideShow=new SlideShow(instance);}},"beforeShow.fb":function(e,instance,current,firstRun){var SlideShow=instance&&instance.SlideShow;if(firstRun){if(SlideShow&&current.opts.slideShow.autoStart){SlideShow.start();}}else if(SlideShow&&SlideShow.isActive){SlideShow.clear();}},"afterShow.fb":function(e,instance,current){var SlideShow=instance&&instance.SlideShow;if(SlideShow&&SlideShow.isActive){SlideShow.set();}},"afterKeydown.fb":function(e,instance,current,keypress,keycode){var SlideShow=instance&&instance.SlideShow;if(SlideShow&&current.opts.slideShow&&(keycode===80||keycode===32)&&!$(document.activeElement).is("button,a,input")){keypress.preventDefault();SlideShow.toggle();}},"beforeClose.fb onDeactivate.fb":function(e,instance){var SlideShow=instance&&instance.SlideShow;if(SlideShow){SlideShow.stop();}}});$(document).on("visibilitychange",function(){var instance=$.fancybox.getInstance(),SlideShow=instance&&instance.SlideShow;if(SlideShow&&SlideShow.isActive){if(document.hidden){SlideShow.clear();}else{SlideShow.set();}}});})(document,jQuery);(function(document,$){"use strict";var fn=(function(){var fnMap=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]];var ret={};for(var i=0;i<fnMap.length;i++){var val=fnMap[i];if(val&&val[1]in document){for(var j=0;j<val.length;j++){ret[fnMap[0][j]]=val[j];}
return ret;}}
return false;})();if(fn){var FullScreen={request:function(elem){elem=elem||document.documentElement;elem[fn.requestFullscreen](elem.ALLOW_KEYBOARD_INPUT);},exit:function(){document[fn.exitFullscreen]();},toggle:function(elem){elem=elem||document.documentElement;if(this.isFullscreen()){this.exit();}else{this.request(elem);}},isFullscreen:function(){return Boolean(document[fn.fullscreenElement]);},enabled:function(){return Boolean(document[fn.fullscreenEnabled]);}};$.extend(true,$.fancybox.defaults,{btnTpl:{fullScreen:'<button data-fancybox-fullscreen class="fancybox-button fancybox-button--fsenter" title="{{FULL_SCREEN}}">'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z"/></svg>'+"</button>"},fullScreen:{autoStart:false}});$(document).on(fn.fullscreenchange,function(){var isFullscreen=FullScreen.isFullscreen(),instance=$.fancybox.getInstance();if(instance){if(instance.current&&instance.current.type==="image"&&instance.isAnimating){instance.isAnimating=false;instance.update(true,true,0);if(!instance.isComplete){instance.complete();}}
instance.trigger("onFullscreenChange",isFullscreen);instance.$refs.container.toggleClass("fancybox-is-fullscreen",isFullscreen);instance.$refs.toolbar.find("[data-fancybox-fullscreen]").toggleClass("fancybox-button--fsenter",!isFullscreen).toggleClass("fancybox-button--fsexit",isFullscreen);}});}
$(document).on({"onInit.fb":function(e,instance){var $container;if(!fn){instance.$refs.toolbar.find("[data-fancybox-fullscreen]").remove();return;}
if(instance&&instance.group[instance.currIndex].opts.fullScreen){$container=instance.$refs.container;$container.on("click.fb-fullscreen","[data-fancybox-fullscreen]",function(e){e.stopPropagation();e.preventDefault();FullScreen.toggle();});if(instance.opts.fullScreen&&instance.opts.fullScreen.autoStart===true){FullScreen.request();}
instance.FullScreen=FullScreen;}else if(instance){instance.$refs.toolbar.find("[data-fancybox-fullscreen]").hide();}},"afterKeydown.fb":function(e,instance,current,keypress,keycode){if(instance&&instance.FullScreen&&keycode===70){keypress.preventDefault();instance.FullScreen.toggle();}},"beforeClose.fb":function(e,instance){if(instance&&instance.FullScreen&&instance.$refs.container.hasClass("fancybox-is-fullscreen")){FullScreen.exit();}}});})(document,jQuery);(function(document,$){"use strict";var CLASS="fancybox-thumbs",CLASS_ACTIVE=CLASS+"-active";$.fancybox.defaults=$.extend(true,{btnTpl:{thumbs:'<button data-fancybox-thumbs class="fancybox-button fancybox-button--thumbs" title="{{THUMBS}}">'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.59 14.59h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76H5.65v-3.76zm8.94-4.47h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76h-3.76v-3.76zm-4.47 0h3.76v3.76H5.65v-3.76zm8.94-4.47h3.76v3.76h-3.76V5.65zm-4.47 0h3.76v3.76h-3.76V5.65zm-4.47 0h3.76v3.76H5.65V5.65z"/></svg>'+"</button>"},thumbs:{autoStart:false,hideOnClose:true,parentEl:".fancybox-container",axis:"y"}},$.fancybox.defaults);var FancyThumbs=function(instance){this.init(instance);};$.extend(FancyThumbs.prototype,{$button:null,$grid:null,$list:null,isVisible:false,isActive:false,init:function(instance){var self=this,group=instance.group,enabled=0;self.instance=instance;self.opts=group[instance.currIndex].opts.thumbs;instance.Thumbs=self;self.$button=instance.$refs.toolbar.find("[data-fancybox-thumbs]");for(var i=0,len=group.length;i<len;i++){if(group[i].thumb){enabled++;}
if(enabled>1){break;}}
if(enabled>1&&!!self.opts){self.$button.removeAttr("style").on("click",function(){self.toggle();});self.isActive=true;}else{self.$button.hide();}},create:function(){var self=this,instance=self.instance,parentEl=self.opts.parentEl,list=[],src;if(!self.$grid){self.$grid=$('<div class="'+CLASS+" "+CLASS+"-"+self.opts.axis+'"></div>').appendTo(instance.$refs.container.find(parentEl).addBack().filter(parentEl));self.$grid.on("click","a",function(){instance.jumpTo($(this).attr("data-index"));});}
if(!self.$list){self.$list=$('<div class="'+CLASS+'__list">').appendTo(self.$grid);}
$.each(instance.group,function(i,item){src=item.thumb;if(!src&&item.type==="image"){src=item.src;}
list.push('<a href="javascript:;" tabindex="0" data-index="'+
i+'"'+
(src&&src.length?' style="background-image:url('+src+')"':'class="fancybox-thumbs-missing"')+"></a>");});self.$list[0].innerHTML=list.join("");if(self.opts.axis==="x"){self.$list.width(parseInt(self.$grid.css("padding-right"),10)+
instance.group.length*self.$list.children().eq(0).outerWidth(true));}},focus:function(duration){var self=this,$list=self.$list,$grid=self.$grid,thumb,thumbPos;if(!self.instance.current){return;}
thumb=$list.children().removeClass(CLASS_ACTIVE).filter('[data-index="'+self.instance.current.index+'"]').addClass(CLASS_ACTIVE);thumbPos=thumb.position();if(self.opts.axis==="y"&&(thumbPos.top<0||thumbPos.top>$list.height()-thumb.outerHeight())){$list.stop().animate({scrollTop:$list.scrollTop()+thumbPos.top},duration);}else if(self.opts.axis==="x"&&(thumbPos.left<$grid.scrollLeft()||thumbPos.left>$grid.scrollLeft()+($grid.width()-thumb.outerWidth()))){$list.parent().stop().animate({scrollLeft:thumbPos.left},duration);}},update:function(){var that=this;that.instance.$refs.container.toggleClass("fancybox-show-thumbs",this.isVisible);if(that.isVisible){if(!that.$grid){that.create();}
that.instance.trigger("onThumbsShow");that.focus(0);}else if(that.$grid){that.instance.trigger("onThumbsHide");}
that.instance.update();},hide:function(){this.isVisible=false;this.update();},show:function(){this.isVisible=true;this.update();},toggle:function(){this.isVisible=!this.isVisible;this.update();}});$(document).on({"onInit.fb":function(e,instance){var Thumbs;if(instance&&!instance.Thumbs){Thumbs=new FancyThumbs(instance);if(Thumbs.isActive&&Thumbs.opts.autoStart===true){Thumbs.show();}}},"beforeShow.fb":function(e,instance,item,firstRun){var Thumbs=instance&&instance.Thumbs;if(Thumbs&&Thumbs.isVisible){Thumbs.focus(firstRun?0:250);}},"afterKeydown.fb":function(e,instance,current,keypress,keycode){var Thumbs=instance&&instance.Thumbs;if(Thumbs&&Thumbs.isActive&&keycode===71){keypress.preventDefault();Thumbs.toggle();}},"beforeClose.fb":function(e,instance){var Thumbs=instance&&instance.Thumbs;if(Thumbs&&Thumbs.isVisible&&Thumbs.opts.hideOnClose!==false){Thumbs.$grid.hide();}}});})(document,jQuery);(function(document,$){"use strict";$.extend(true,$.fancybox.defaults,{btnTpl:{share:'<button data-fancybox-share class="fancybox-button fancybox-button--share" title="{{SHARE}}">'+'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2.55 19c1.4-8.4 9.1-9.8 11.9-9.8V5l7 7-7 6.3v-3.5c-2.8 0-10.5 2.1-11.9 4.2z"/></svg>'+"</button>"},share:{url:function(instance,item){return((!instance.currentHash&&!(item.type==="inline"||item.type==="html")?item.origSrc||item.src:false)||window.location);},tpl:'<div class="fancybox-share">'+"<h1>{{SHARE}}</h1>"+"<p>"+'<a class="fancybox-share__button fancybox-share__button--fb" href="https://www.facebook.com/sharer/sharer.php?u={{url}}">'+'<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m287 456v-299c0-21 6-35 35-35h38v-63c-7-1-29-3-55-3-54 0-91 33-91 94v306m143-254h-205v72h196" /></svg>'+"<span>Facebook</span>"+"</a>"+'<a class="fancybox-share__button fancybox-share__button--tw" href="https://twitter.com/intent/tweet?url={{url}}&text={{descr}}">'+'<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m456 133c-14 7-31 11-47 13 17-10 30-27 37-46-15 10-34 16-52 20-61-62-157-7-141 75-68-3-129-35-169-85-22 37-11 86 26 109-13 0-26-4-37-9 0 39 28 72 65 80-12 3-25 4-37 2 10 33 41 57 77 57-42 30-77 38-122 34 170 111 378-32 359-208 16-11 30-25 41-42z" /></svg>'+"<span>Twitter</span>"+"</a>"+'<a class="fancybox-share__button fancybox-share__button--pt" href="https://www.pinterest.com/pin/create/button/?url={{url}}&description={{descr}}&media={{media}}">'+'<svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="m265 56c-109 0-164 78-164 144 0 39 15 74 47 87 5 2 10 0 12-5l4-19c2-6 1-8-3-13-9-11-15-25-15-45 0-58 43-110 113-110 62 0 96 38 96 88 0 67-30 122-73 122-24 0-42-19-36-44 6-29 20-60 20-81 0-19-10-35-31-35-25 0-44 26-44 60 0 21 7 36 7 36l-30 125c-8 37-1 83 0 87 0 3 4 4 5 2 2-3 32-39 42-75l16-64c8 16 31 29 56 29 74 0 124-67 124-157 0-69-58-132-146-132z" fill="#fff"/></svg>'+"<span>Pinterest</span>"+"</a>"+"</p>"+'<p><input class="fancybox-share__input" type="text" value="{{url_raw}}" onclick="select()" /></p>'+"</div>"}});function escapeHtml(string){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(string).replace(/[&<>"'`=\/]/g,function(s){return entityMap[s];});}
$(document).on("click","[data-fancybox-share]",function(){var instance=$.fancybox.getInstance(),current=instance.current||null,url,tpl;if(!current){return;}
if($.type(current.opts.share.url)==="function"){url=current.opts.share.url.apply(current,[instance,current]);}
tpl=current.opts.share.tpl.replace(/\{\{media\}\}/g,current.type==="image"?encodeURIComponent(current.src):"").replace(/\{\{url\}\}/g,encodeURIComponent(url)).replace(/\{\{url_raw\}\}/g,escapeHtml(url)).replace(/\{\{descr\}\}/g,instance.$caption?encodeURIComponent(instance.$caption.text()):"");$.fancybox.open({src:instance.translate(instance,tpl),type:"html",opts:{touch:false,animationEffect:false,afterLoad:function(shareInstance,shareCurrent){instance.$refs.container.one("beforeClose.fb",function(){shareInstance.close(null,0);});shareCurrent.$content.find(".fancybox-share__button").click(function(){window.open(this.href,"Share","width=550, height=450");return false;});},mobile:{autoFocus:false}}});});})(document,jQuery);(function(window,document,$){"use strict";if(!$.escapeSelector){$.escapeSelector=function(sel){var rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;var fcssescape=function(ch,asCodePoint){if(asCodePoint){if(ch==="\0"){return"\uFFFD";}
return ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" ";}
return"\\"+ch;};return(sel+"").replace(rcssescape,fcssescape);};}
function parseUrl(){var hash=window.location.hash.substr(1),rez=hash.split("-"),index=rez.length>1&&/^\+?\d+$/.test(rez[rez.length-1])?parseInt(rez.pop(-1),10)||1:1,gallery=rez.join("-");return{hash:hash,index:index<1?1:index,gallery:gallery};}
function triggerFromUrl(url){if(url.gallery!==""){$("[data-fancybox='"+$.escapeSelector(url.gallery)+"']").eq(url.index-1).focus().trigger("click.fb-start");}}
function getGalleryID(instance){var opts,ret;if(!instance){return false;}
opts=instance.current?instance.current.opts:instance.opts;ret=opts.hash||(opts.$orig?opts.$orig.data("fancybox")||opts.$orig.data("fancybox-trigger"):"");return ret===""?false:ret;}
$(function(){if($.fancybox.defaults.hash===false){return;}
$(document).on({"onInit.fb":function(e,instance){var url,gallery;if(instance.group[instance.currIndex].opts.hash===false){return;}
url=parseUrl();gallery=getGalleryID(instance);if(gallery&&url.gallery&&gallery==url.gallery){instance.currIndex=url.index-1;}},"beforeShow.fb":function(e,instance,current,firstRun){var gallery;if(!current||current.opts.hash===false){return;}
gallery=getGalleryID(instance);if(!gallery){return;}
instance.currentHash=gallery+(instance.group.length>1?"-"+(current.index+1):"");if(window.location.hash==="#"+instance.currentHash){return;}
if(firstRun&&!instance.origHash){instance.origHash=window.location.hash;}
if(instance.hashTimer){clearTimeout(instance.hashTimer);}
instance.hashTimer=setTimeout(function(){if("replaceState"in window.history){window.history[firstRun?"pushState":"replaceState"]({},document.title,window.location.pathname+window.location.search+"#"+instance.currentHash);if(firstRun){instance.hasCreatedHistory=true;}}else{window.location.hash=instance.currentHash;}
instance.hashTimer=null;},300);},"beforeClose.fb":function(e,instance,current){if(!current||current.opts.hash===false){return;}
clearTimeout(instance.hashTimer);if(instance.currentHash&&instance.hasCreatedHistory){window.history.back();}else if(instance.currentHash){if("replaceState"in window.history){window.history.replaceState({},document.title,window.location.pathname+window.location.search+(instance.origHash||""));}else{window.location.hash=instance.origHash;}}
instance.currentHash=null;}});$(window).on("hashchange.fb",function(){var url=parseUrl(),fb=null;$.each($(".fancybox-container").get().reverse(),function(index,value){var tmp=$(value).data("FancyBox");if(tmp&&tmp.currentHash){fb=tmp;return false;}});if(fb){if(fb.currentHash!==url.gallery+"-"+url.index&&!(url.index===1&&fb.currentHash==url.gallery)){fb.currentHash=null;fb.close();}}else if(url.gallery!==""){triggerFromUrl(url);}});setTimeout(function(){if(!$.fancybox.getInstance()){triggerFromUrl(parseUrl());}},50);});})(window,document,jQuery);(function(document,$){"use strict";var prevTime=new Date().getTime();$(document).on({"onInit.fb":function(e,instance,current){instance.$refs.stage.on("mousewheel DOMMouseScroll wheel MozMousePixelScroll",function(e){var current=instance.current,currTime=new Date().getTime();if(instance.group.length<2||current.opts.wheel===false||(current.opts.wheel==="auto"&&current.type!=="image")){return;}
e.preventDefault();e.stopPropagation();if(current.$slide.hasClass("fancybox-animated")){return;}
e=e.originalEvent||e;if(currTime-prevTime<250){return;}
prevTime=currTime;instance[(-e.deltaY||-e.deltaX||e.wheelDelta||-e.detail)<0?"next":"previous"]();});}});})(document,jQuery);
(function(factory){"use strict";if(typeof define==='function'&&define.amd){define(['jquery'],function($){return factory($,window,document);});}
else if(typeof exports==='object'){module.exports=function(root,$){if(!root){root=window;}
if(!$){$=typeof window!=='undefined'?require('jquery'):require('jquery')(root);}
return factory($,root,root.document);};}
else{factory(jQuery,window,document);}}
(function($,window,document,undefined){"use strict";var DataTable=function(options)
{this.$=function(sSelector,oOpts)
{return this.api(true).$(sSelector,oOpts);};this._=function(sSelector,oOpts)
{return this.api(true).rows(sSelector,oOpts).data();};this.api=function(traditional)
{return traditional?new _Api(_fnSettingsFromNode(this[_ext.iApiIndex])):new _Api(this);};this.fnAddData=function(data,redraw)
{var api=this.api(true);var rows=$.isArray(data)&&($.isArray(data[0])||$.isPlainObject(data[0]))?api.rows.add(data):api.row.add(data);if(redraw===undefined||redraw){api.draw();}
return rows.flatten().toArray();};this.fnAdjustColumnSizing=function(bRedraw)
{var api=this.api(true).columns.adjust();var settings=api.settings()[0];var scroll=settings.oScroll;if(bRedraw===undefined||bRedraw){api.draw(false);}
else if(scroll.sX!==""||scroll.sY!==""){_fnScrollDraw(settings);}};this.fnClearTable=function(bRedraw)
{var api=this.api(true).clear();if(bRedraw===undefined||bRedraw){api.draw();}};this.fnClose=function(nTr)
{this.api(true).row(nTr).child.hide();};this.fnDeleteRow=function(target,callback,redraw)
{var api=this.api(true);var rows=api.rows(target);var settings=rows.settings()[0];var data=settings.aoData[rows[0][0]];rows.remove();if(callback){callback.call(this,settings,data);}
if(redraw===undefined||redraw){api.draw();}
return data;};this.fnDestroy=function(remove)
{this.api(true).destroy(remove);};this.fnDraw=function(complete)
{this.api(true).draw(complete);};this.fnFilter=function(sInput,iColumn,bRegex,bSmart,bShowGlobal,bCaseInsensitive)
{var api=this.api(true);if(iColumn===null||iColumn===undefined){api.search(sInput,bRegex,bSmart,bCaseInsensitive);}
else{api.column(iColumn).search(sInput,bRegex,bSmart,bCaseInsensitive);}
api.draw();};this.fnGetData=function(src,col)
{var api=this.api(true);if(src!==undefined){var type=src.nodeName?src.nodeName.toLowerCase():'';return col!==undefined||type=='td'||type=='th'?api.cell(src,col).data():api.row(src).data()||null;}
return api.data().toArray();};this.fnGetNodes=function(iRow)
{var api=this.api(true);return iRow!==undefined?api.row(iRow).node():api.rows().nodes().flatten().toArray();};this.fnGetPosition=function(node)
{var api=this.api(true);var nodeName=node.nodeName.toUpperCase();if(nodeName=='TR'){return api.row(node).index();}
else if(nodeName=='TD'||nodeName=='TH'){var cell=api.cell(node).index();return[cell.row,cell.columnVisible,cell.column];}
return null;};this.fnIsOpen=function(nTr)
{return this.api(true).row(nTr).child.isShown();};this.fnOpen=function(nTr,mHtml,sClass)
{return this.api(true).row(nTr).child(mHtml,sClass).show().child()[0];};this.fnPageChange=function(mAction,bRedraw)
{var api=this.api(true).page(mAction);if(bRedraw===undefined||bRedraw){api.draw(false);}};this.fnSetColumnVis=function(iCol,bShow,bRedraw)
{var api=this.api(true).column(iCol).visible(bShow);if(bRedraw===undefined||bRedraw){api.columns.adjust().draw();}};this.fnSettings=function()
{return _fnSettingsFromNode(this[_ext.iApiIndex]);};this.fnSort=function(aaSort)
{this.api(true).order(aaSort).draw();};this.fnSortListener=function(nNode,iColumn,fnCallback)
{this.api(true).order.listener(nNode,iColumn,fnCallback);};this.fnUpdate=function(mData,mRow,iColumn,bRedraw,bAction)
{var api=this.api(true);if(iColumn===undefined||iColumn===null){api.row(mRow).data(mData);}
else{api.cell(mRow,iColumn).data(mData);}
if(bAction===undefined||bAction){api.columns.adjust();}
if(bRedraw===undefined||bRedraw){api.draw();}
return 0;};this.fnVersionCheck=_ext.fnVersionCheck;var _that=this;var emptyInit=options===undefined;var len=this.length;if(emptyInit){options={};}
this.oApi=this.internal=_ext.internal;for(var fn in DataTable.ext.internal){if(fn){this[fn]=_fnExternApiFunc(fn);}}
this.each(function(){var o={};var oInit=len>1?_fnExtend(o,options,true):options;var i=0,iLen,j,jLen,k,kLen;var sId=this.getAttribute('id');var bInitHandedOff=false;var defaults=DataTable.defaults;var $this=$(this);if(this.nodeName.toLowerCase()!='table')
{_fnLog(null,0,'Non-table node initialisation ('+this.nodeName+')',2);return;}
_fnCompatOpts(defaults);_fnCompatCols(defaults.column);_fnCamelToHungarian(defaults,defaults,true);_fnCamelToHungarian(defaults.column,defaults.column,true);_fnCamelToHungarian(defaults,$.extend(oInit,$this.data()));var allSettings=DataTable.settings;for(i=0,iLen=allSettings.length;i<iLen;i++)
{var s=allSettings[i];if(s.nTable==this||s.nTHead.parentNode==this||(s.nTFoot&&s.nTFoot.parentNode==this))
{var bRetrieve=oInit.bRetrieve!==undefined?oInit.bRetrieve:defaults.bRetrieve;var bDestroy=oInit.bDestroy!==undefined?oInit.bDestroy:defaults.bDestroy;if(emptyInit||bRetrieve)
{return s.oInstance;}
else if(bDestroy)
{s.oInstance.fnDestroy();break;}
else
{_fnLog(s,0,'Cannot reinitialise DataTable',3);return;}}
if(s.sTableId==this.id)
{allSettings.splice(i,1);break;}}
if(sId===null||sId==="")
{sId="DataTables_Table_"+(DataTable.ext._unique++);this.id=sId;}
var oSettings=$.extend(true,{},DataTable.models.oSettings,{"sDestroyWidth":$this[0].style.width,"sInstance":sId,"sTableId":sId});oSettings.nTable=this;oSettings.oApi=_that.internal;oSettings.oInit=oInit;allSettings.push(oSettings);oSettings.oInstance=(_that.length===1)?_that:$this.dataTable();_fnCompatOpts(oInit);if(oInit.oLanguage)
{_fnLanguageCompat(oInit.oLanguage);}
if(oInit.aLengthMenu&&!oInit.iDisplayLength)
{oInit.iDisplayLength=$.isArray(oInit.aLengthMenu[0])?oInit.aLengthMenu[0][0]:oInit.aLengthMenu[0];}
oInit=_fnExtend($.extend(true,{},defaults),oInit);_fnMap(oSettings.oFeatures,oInit,["bPaginate","bLengthChange","bFilter","bSort","bSortMulti","bInfo","bProcessing","bAutoWidth","bSortClasses","bServerSide","bDeferRender"]);_fnMap(oSettings,oInit,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay","rowId",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]);_fnMap(oSettings.oScroll,oInit,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]);_fnMap(oSettings.oLanguage,oInit,"fnInfoCallback");_fnCallbackReg(oSettings,'aoDrawCallback',oInit.fnDrawCallback,'user');_fnCallbackReg(oSettings,'aoServerParams',oInit.fnServerParams,'user');_fnCallbackReg(oSettings,'aoStateSaveParams',oInit.fnStateSaveParams,'user');_fnCallbackReg(oSettings,'aoStateLoadParams',oInit.fnStateLoadParams,'user');_fnCallbackReg(oSettings,'aoStateLoaded',oInit.fnStateLoaded,'user');_fnCallbackReg(oSettings,'aoRowCallback',oInit.fnRowCallback,'user');_fnCallbackReg(oSettings,'aoRowCreatedCallback',oInit.fnCreatedRow,'user');_fnCallbackReg(oSettings,'aoHeaderCallback',oInit.fnHeaderCallback,'user');_fnCallbackReg(oSettings,'aoFooterCallback',oInit.fnFooterCallback,'user');_fnCallbackReg(oSettings,'aoInitComplete',oInit.fnInitComplete,'user');_fnCallbackReg(oSettings,'aoPreDrawCallback',oInit.fnPreDrawCallback,'user');oSettings.rowIdFn=_fnGetObjectDataFn(oInit.rowId);_fnBrowserDetect(oSettings);var oClasses=oSettings.oClasses;if(oInit.bJQueryUI)
{$.extend(oClasses,DataTable.ext.oJUIClasses,oInit.oClasses);if(oInit.sDom===defaults.sDom&&defaults.sDom==="lfrtip")
{oSettings.sDom='<"H"lfr>t<"F"ip>';}
if(!oSettings.renderer){oSettings.renderer='jqueryui';}
else if($.isPlainObject(oSettings.renderer)&&!oSettings.renderer.header){oSettings.renderer.header='jqueryui';}}
else
{$.extend(oClasses,DataTable.ext.classes,oInit.oClasses);}
$this.addClass(oClasses.sTable);if(oSettings.iInitDisplayStart===undefined)
{oSettings.iInitDisplayStart=oInit.iDisplayStart;oSettings._iDisplayStart=oInit.iDisplayStart;}
if(oInit.iDeferLoading!==null)
{oSettings.bDeferLoading=true;var tmp=$.isArray(oInit.iDeferLoading);oSettings._iRecordsDisplay=tmp?oInit.iDeferLoading[0]:oInit.iDeferLoading;oSettings._iRecordsTotal=tmp?oInit.iDeferLoading[1]:oInit.iDeferLoading;}
var oLanguage=oSettings.oLanguage;$.extend(true,oLanguage,oInit.oLanguage);if(oLanguage.sUrl!=="")
{$.ajax({dataType:'json',url:oLanguage.sUrl,success:function(json){_fnLanguageCompat(json);_fnCamelToHungarian(defaults.oLanguage,json);$.extend(true,oLanguage,json);_fnInitialise(oSettings);},error:function(){_fnInitialise(oSettings);}});bInitHandedOff=true;}
if(oInit.asStripeClasses===null)
{oSettings.asStripeClasses=[oClasses.sStripeOdd,oClasses.sStripeEven];}
var stripeClasses=oSettings.asStripeClasses;var rowOne=$this.children('tbody').find('tr').eq(0);if($.inArray(true,$.map(stripeClasses,function(el,i){return rowOne.hasClass(el);}))!==-1){$('tbody tr',this).removeClass(stripeClasses.join(' '));oSettings.asDestroyStripes=stripeClasses.slice();}
var anThs=[];var aoColumnsInit;var nThead=this.getElementsByTagName('thead');if(nThead.length!==0)
{_fnDetectHeader(oSettings.aoHeader,nThead[0]);anThs=_fnGetUniqueThs(oSettings);}
if(oInit.aoColumns===null)
{aoColumnsInit=[];for(i=0,iLen=anThs.length;i<iLen;i++)
{aoColumnsInit.push(null);}}
else
{aoColumnsInit=oInit.aoColumns;}
for(i=0,iLen=aoColumnsInit.length;i<iLen;i++)
{_fnAddColumn(oSettings,anThs?anThs[i]:null);}
_fnApplyColumnDefs(oSettings,oInit.aoColumnDefs,aoColumnsInit,function(iCol,oDef){_fnColumnOptions(oSettings,iCol,oDef);});if(rowOne.length){var a=function(cell,name){return cell.getAttribute('data-'+name)!==null?name:null;};$(rowOne[0]).children('th, td').each(function(i,cell){var col=oSettings.aoColumns[i];if(col.mData===i){var sort=a(cell,'sort')||a(cell,'order');var filter=a(cell,'filter')||a(cell,'search');if(sort!==null||filter!==null){col.mData={_:i+'.display',sort:sort!==null?i+'.@data-'+sort:undefined,type:sort!==null?i+'.@data-'+sort:undefined,filter:filter!==null?i+'.@data-'+filter:undefined};_fnColumnOptions(oSettings,i);}}});}
var features=oSettings.oFeatures;if(oInit.bStateSave)
{features.bStateSave=true;_fnLoadState(oSettings,oInit);_fnCallbackReg(oSettings,'aoDrawCallback',_fnSaveState,'state_save');}
if(oInit.aaSorting===undefined)
{var sorting=oSettings.aaSorting;for(i=0,iLen=sorting.length;i<iLen;i++)
{sorting[i][1]=oSettings.aoColumns[i].asSorting[0];}}
_fnSortingClasses(oSettings);if(features.bSort)
{_fnCallbackReg(oSettings,'aoDrawCallback',function(){if(oSettings.bSorted){var aSort=_fnSortFlatten(oSettings);var sortedColumns={};$.each(aSort,function(i,val){sortedColumns[val.src]=val.dir;});_fnCallbackFire(oSettings,null,'order',[oSettings,aSort,sortedColumns]);_fnSortAria(oSettings);}});}
_fnCallbackReg(oSettings,'aoDrawCallback',function(){if(oSettings.bSorted||_fnDataSource(oSettings)==='ssp'||features.bDeferRender){_fnSortingClasses(oSettings);}},'sc');var captions=$this.children('caption').each(function(){this._captionSide=$this.css('caption-side');});var thead=$this.children('thead');if(thead.length===0)
{thead=$('<thead/>').appendTo(this);}
oSettings.nTHead=thead[0];var tbody=$this.children('tbody');if(tbody.length===0)
{tbody=$('<tbody/>').appendTo(this);}
oSettings.nTBody=tbody[0];var tfoot=$this.children('tfoot');if(tfoot.length===0&&captions.length>0&&(oSettings.oScroll.sX!==""||oSettings.oScroll.sY!==""))
{tfoot=$('<tfoot/>').appendTo(this);}
if(tfoot.length===0||tfoot.children().length===0){$this.addClass(oClasses.sNoFooter);}
else if(tfoot.length>0){oSettings.nTFoot=tfoot[0];_fnDetectHeader(oSettings.aoFooter,oSettings.nTFoot);}
if(oInit.aaData)
{for(i=0;i<oInit.aaData.length;i++)
{_fnAddData(oSettings,oInit.aaData[i]);}}
else if(oSettings.bDeferLoading||_fnDataSource(oSettings)=='dom')
{_fnAddTr(oSettings,$(oSettings.nTBody).children('tr'));}
oSettings.aiDisplay=oSettings.aiDisplayMaster.slice();oSettings.bInitialised=true;if(bInitHandedOff===false)
{_fnInitialise(oSettings);}});_that=null;return this;};var _ext;var _Api;var _api_register;var _api_registerPlural;var _re_dic={};var _re_new_lines=/[\r\n]/g;var _re_html=/<.*?>/g;var _re_date_start=/^[\w\+\-]/;var _re_date_end=/[\w\+\-]$/;var _re_escape_regex=new RegExp('(\\'+['/','.','*','+','?','|','(',')','[',']','{','}','\\','$','^','-'].join('|\\')+')','g');var _re_formatted_numeric=/[',$%\u2009\u202F\u20BD\u20a9\u20BArfk]/gi;var _empty=function(d){return!d||d===true||d==='-'?true:false;};var _intVal=function(s){var integer=parseInt(s,10);return!isNaN(integer)&&isFinite(s)?integer:null;};var _numToDecimal=function(num,decimalPoint){if(!_re_dic[decimalPoint]){_re_dic[decimalPoint]=new RegExp(_fnEscapeRegex(decimalPoint),'g');}
return typeof num==='string'&&decimalPoint!=='.'?num.replace(/\./g,'').replace(_re_dic[decimalPoint],'.'):num;};var _isNumber=function(d,decimalPoint,formatted){var strType=typeof d==='string';if(_empty(d)){return true;}
if(decimalPoint&&strType){d=_numToDecimal(d,decimalPoint);}
if(formatted&&strType){d=d.replace(_re_formatted_numeric,'');}
return!isNaN(parseFloat(d))&&isFinite(d);};var _isHtml=function(d){return _empty(d)||typeof d==='string';};var _htmlNumeric=function(d,decimalPoint,formatted){if(_empty(d)){return true;}
var html=_isHtml(d);return!html?null:_isNumber(_stripHtml(d),decimalPoint,formatted)?true:null;};var _pluck=function(a,prop,prop2){var out=[];var i=0,ien=a.length;if(prop2!==undefined){for(;i<ien;i++){if(a[i]&&a[i][prop]){out.push(a[i][prop][prop2]);}}}
else{for(;i<ien;i++){if(a[i]){out.push(a[i][prop]);}}}
return out;};var _pluck_order=function(a,order,prop,prop2)
{var out=[];var i=0,ien=order.length;if(prop2!==undefined){for(;i<ien;i++){if(a[order[i]][prop]){out.push(a[order[i]][prop][prop2]);}}}
else{for(;i<ien;i++){out.push(a[order[i]][prop]);}}
return out;};var _range=function(len,start)
{var out=[];var end;if(start===undefined){start=0;end=len;}
else{end=start;start=len;}
for(var i=start;i<end;i++){out.push(i);}
return out;};var _removeEmpty=function(a)
{var out=[];for(var i=0,ien=a.length;i<ien;i++){if(a[i]){out.push(a[i]);}}
return out;};var _stripHtml=function(d){return d.replace(_re_html,'');};var _unique=function(src)
{var
out=[],val,i,ien=src.length,j,k=0;again:for(i=0;i<ien;i++){val=src[i];for(j=0;j<k;j++){if(out[j]===val){continue again;}}
out.push(val);k++;}
return out;};DataTable.util={throttle:function(fn,freq){var
frequency=freq!==undefined?freq:200,last,timer;return function(){var
that=this,now=+new Date(),args=arguments;if(last&&now<last+frequency){clearTimeout(timer);timer=setTimeout(function(){last=undefined;fn.apply(that,args);},frequency);}
else{last=now;fn.apply(that,args);}};},escapeRegex:function(val){return val.replace(_re_escape_regex,'\\$1');}};function _fnHungarianMap(o)
{var
hungarian='a aa ai ao as b fn i m o s ',match,newKey,map={};$.each(o,function(key,val){match=key.match(/^([^A-Z]+?)([A-Z])/);if(match&&hungarian.indexOf(match[1]+' ')!==-1)
{newKey=key.replace(match[0],match[2].toLowerCase());map[newKey]=key;if(match[1]==='o')
{_fnHungarianMap(o[key]);}}});o._hungarianMap=map;}
function _fnCamelToHungarian(src,user,force)
{if(!src._hungarianMap){_fnHungarianMap(src);}
var hungarianKey;$.each(user,function(key,val){hungarianKey=src._hungarianMap[key];if(hungarianKey!==undefined&&(force||user[hungarianKey]===undefined))
{if(hungarianKey.charAt(0)==='o')
{if(!user[hungarianKey]){user[hungarianKey]={};}
$.extend(true,user[hungarianKey],user[key]);_fnCamelToHungarian(src[hungarianKey],user[hungarianKey],force);}
else{user[hungarianKey]=user[key];}}});}
function _fnLanguageCompat(lang)
{var defaults=DataTable.defaults.oLanguage;var zeroRecords=lang.sZeroRecords;if(!lang.sEmptyTable&&zeroRecords&&defaults.sEmptyTable==="No data available in table")
{_fnMap(lang,lang,'sZeroRecords','sEmptyTable');}
if(!lang.sLoadingRecords&&zeroRecords&&defaults.sLoadingRecords==="Loading...")
{_fnMap(lang,lang,'sZeroRecords','sLoadingRecords');}
if(lang.sInfoThousands){lang.sThousands=lang.sInfoThousands;}
var decimal=lang.sDecimal;if(decimal){_addNumericSort(decimal);}}
var _fnCompatMap=function(o,knew,old){if(o[knew]!==undefined){o[old]=o[knew];}};function _fnCompatOpts(init)
{_fnCompatMap(init,'ordering','bSort');_fnCompatMap(init,'orderMulti','bSortMulti');_fnCompatMap(init,'orderClasses','bSortClasses');_fnCompatMap(init,'orderCellsTop','bSortCellsTop');_fnCompatMap(init,'order','aaSorting');_fnCompatMap(init,'orderFixed','aaSortingFixed');_fnCompatMap(init,'paging','bPaginate');_fnCompatMap(init,'pagingType','sPaginationType');_fnCompatMap(init,'pageLength','iDisplayLength');_fnCompatMap(init,'searching','bFilter');if(typeof init.sScrollX==='boolean'){init.sScrollX=init.sScrollX?'100%':'';}
if(typeof init.scrollX==='boolean'){init.scrollX=init.scrollX?'100%':'';}
var searchCols=init.aoSearchCols;if(searchCols){for(var i=0,ien=searchCols.length;i<ien;i++){if(searchCols[i]){_fnCamelToHungarian(DataTable.models.oSearch,searchCols[i]);}}}}
function _fnCompatCols(init)
{_fnCompatMap(init,'orderable','bSortable');_fnCompatMap(init,'orderData','aDataSort');_fnCompatMap(init,'orderSequence','asSorting');_fnCompatMap(init,'orderDataType','sortDataType');var dataSort=init.aDataSort;if(dataSort&&!$.isArray(dataSort)){init.aDataSort=[dataSort];}}
function _fnBrowserDetect(settings)
{if(!DataTable.__browser){var browser={};DataTable.__browser=browser;var n=$('<div/>').css({position:'fixed',top:0,left:0,height:1,width:1,overflow:'hidden'}).append($('<div/>').css({position:'absolute',top:1,left:1,width:100,overflow:'scroll'}).append($('<div/>').css({width:'100%',height:10}))).appendTo('body');var outer=n.children();var inner=outer.children();browser.barWidth=outer[0].offsetWidth-outer[0].clientWidth;browser.bScrollOversize=inner[0].offsetWidth===100&&outer[0].clientWidth!==100;browser.bScrollbarLeft=Math.round(inner.offset().left)!==1;browser.bBounding=n[0].getBoundingClientRect().width?true:false;n.remove();}
$.extend(settings.oBrowser,DataTable.__browser);settings.oScroll.iBarWidth=DataTable.__browser.barWidth;}
function _fnReduce(that,fn,init,start,end,inc)
{var
i=start,value,isSet=false;if(init!==undefined){value=init;isSet=true;}
while(i!==end){if(!that.hasOwnProperty(i)){continue;}
value=isSet?fn(value,that[i],i,that):that[i];isSet=true;i+=inc;}
return value;}
function _fnAddColumn(oSettings,nTh)
{var oDefaults=DataTable.defaults.column;var iCol=oSettings.aoColumns.length;var oCol=$.extend({},DataTable.models.oColumn,oDefaults,{"nTh":nTh?nTh:document.createElement('th'),"sTitle":oDefaults.sTitle?oDefaults.sTitle:nTh?nTh.innerHTML:'',"aDataSort":oDefaults.aDataSort?oDefaults.aDataSort:[iCol],"mData":oDefaults.mData?oDefaults.mData:iCol,idx:iCol});oSettings.aoColumns.push(oCol);var searchCols=oSettings.aoPreSearchCols;searchCols[iCol]=$.extend({},DataTable.models.oSearch,searchCols[iCol]);_fnColumnOptions(oSettings,iCol,$(nTh).data());}
function _fnColumnOptions(oSettings,iCol,oOptions)
{var oCol=oSettings.aoColumns[iCol];var oClasses=oSettings.oClasses;var th=$(oCol.nTh);if(!oCol.sWidthOrig){oCol.sWidthOrig=th.attr('width')||null;var t=(th.attr('style')||'').match(/width:\s*(\d+[pxem%]+)/);if(t){oCol.sWidthOrig=t[1];}}
if(oOptions!==undefined&&oOptions!==null)
{_fnCompatCols(oOptions);_fnCamelToHungarian(DataTable.defaults.column,oOptions);if(oOptions.mDataProp!==undefined&&!oOptions.mData)
{oOptions.mData=oOptions.mDataProp;}
if(oOptions.sType)
{oCol._sManualType=oOptions.sType;}
if(oOptions.className&&!oOptions.sClass)
{oOptions.sClass=oOptions.className;}
$.extend(oCol,oOptions);_fnMap(oCol,oOptions,"sWidth","sWidthOrig");if(oOptions.iDataSort!==undefined)
{oCol.aDataSort=[oOptions.iDataSort];}
_fnMap(oCol,oOptions,"aDataSort");}
var mDataSrc=oCol.mData;var mData=_fnGetObjectDataFn(mDataSrc);var mRender=oCol.mRender?_fnGetObjectDataFn(oCol.mRender):null;var attrTest=function(src){return typeof src==='string'&&src.indexOf('@')!==-1;};oCol._bAttrSrc=$.isPlainObject(mDataSrc)&&(attrTest(mDataSrc.sort)||attrTest(mDataSrc.type)||attrTest(mDataSrc.filter));oCol._setter=null;oCol.fnGetData=function(rowData,type,meta){var innerData=mData(rowData,type,undefined,meta);return mRender&&type?mRender(innerData,type,rowData,meta):innerData;};oCol.fnSetData=function(rowData,val,meta){return _fnSetObjectDataFn(mDataSrc)(rowData,val,meta);};if(typeof mDataSrc!=='number'){oSettings._rowReadObject=true;}
if(!oSettings.oFeatures.bSort)
{oCol.bSortable=false;th.addClass(oClasses.sSortableNone);}
var bAsc=$.inArray('asc',oCol.asSorting)!==-1;var bDesc=$.inArray('desc',oCol.asSorting)!==-1;if(!oCol.bSortable||(!bAsc&&!bDesc))
{oCol.sSortingClass=oClasses.sSortableNone;oCol.sSortingClassJUI="";}
else if(bAsc&&!bDesc)
{oCol.sSortingClass=oClasses.sSortableAsc;oCol.sSortingClassJUI=oClasses.sSortJUIAscAllowed;}
else if(!bAsc&&bDesc)
{oCol.sSortingClass=oClasses.sSortableDesc;oCol.sSortingClassJUI=oClasses.sSortJUIDescAllowed;}
else
{oCol.sSortingClass=oClasses.sSortable;oCol.sSortingClassJUI=oClasses.sSortJUI;}}
function _fnAdjustColumnSizing(settings)
{if(settings.oFeatures.bAutoWidth!==false)
{var columns=settings.aoColumns;_fnCalculateColumnWidths(settings);for(var i=0,iLen=columns.length;i<iLen;i++)
{columns[i].nTh.style.width=columns[i].sWidth;}}
var scroll=settings.oScroll;if(scroll.sY!==''||scroll.sX!=='')
{_fnScrollDraw(settings);}
_fnCallbackFire(settings,null,'column-sizing',[settings]);}
function _fnVisibleToColumnIndex(oSettings,iMatch)
{var aiVis=_fnGetColumns(oSettings,'bVisible');return typeof aiVis[iMatch]==='number'?aiVis[iMatch]:null;}
function _fnColumnIndexToVisible(oSettings,iMatch)
{var aiVis=_fnGetColumns(oSettings,'bVisible');var iPos=$.inArray(iMatch,aiVis);return iPos!==-1?iPos:null;}
function _fnVisbleColumns(oSettings)
{var vis=0;$.each(oSettings.aoColumns,function(i,col){if(col.bVisible&&$(col.nTh).css('display')!=='none'){vis++;}});return vis;}
function _fnGetColumns(oSettings,sParam)
{var a=[];$.map(oSettings.aoColumns,function(val,i){if(val[sParam]){a.push(i);}});return a;}
function _fnColumnTypes(settings)
{var columns=settings.aoColumns;var data=settings.aoData;var types=DataTable.ext.type.detect;var i,ien,j,jen,k,ken;var col,cell,detectedType,cache;for(i=0,ien=columns.length;i<ien;i++){col=columns[i];cache=[];if(!col.sType&&col._sManualType){col.sType=col._sManualType;}
else if(!col.sType){for(j=0,jen=types.length;j<jen;j++){for(k=0,ken=data.length;k<ken;k++){if(cache[k]===undefined){cache[k]=_fnGetCellData(settings,k,i,'type');}
detectedType=types[j](cache[k],settings);if(!detectedType&&j!==types.length-1){break;}
if(detectedType==='html'){break;}}
if(detectedType){col.sType=detectedType;break;}}
if(!col.sType){col.sType='string';}}}}
function _fnApplyColumnDefs(oSettings,aoColDefs,aoCols,fn)
{var i,iLen,j,jLen,k,kLen,def;var columns=oSettings.aoColumns;if(aoColDefs)
{for(i=aoColDefs.length-1;i>=0;i--)
{def=aoColDefs[i];var aTargets=def.targets!==undefined?def.targets:def.aTargets;if(!$.isArray(aTargets))
{aTargets=[aTargets];}
for(j=0,jLen=aTargets.length;j<jLen;j++)
{if(typeof aTargets[j]==='number'&&aTargets[j]>=0)
{while(columns.length<=aTargets[j])
{_fnAddColumn(oSettings);}
fn(aTargets[j],def);}
else if(typeof aTargets[j]==='number'&&aTargets[j]<0)
{fn(columns.length+aTargets[j],def);}
else if(typeof aTargets[j]==='string')
{for(k=0,kLen=columns.length;k<kLen;k++)
{if(aTargets[j]=="_all"||$(columns[k].nTh).hasClass(aTargets[j]))
{fn(k,def);}}}}}}
if(aoCols)
{for(i=0,iLen=aoCols.length;i<iLen;i++)
{fn(i,aoCols[i]);}}}
function _fnAddData(oSettings,aDataIn,nTr,anTds)
{var iRow=oSettings.aoData.length;var oData=$.extend(true,{},DataTable.models.oRow,{src:nTr?'dom':'data',idx:iRow});oData._aData=aDataIn;oSettings.aoData.push(oData);var nTd,sThisType;var columns=oSettings.aoColumns;for(var i=0,iLen=columns.length;i<iLen;i++)
{columns[i].sType=null;}
oSettings.aiDisplayMaster.push(iRow);var id=oSettings.rowIdFn(aDataIn);if(id!==undefined){oSettings.aIds[id]=oData;}
if(nTr||!oSettings.oFeatures.bDeferRender)
{_fnCreateTr(oSettings,iRow,nTr,anTds);}
return iRow;}
function _fnAddTr(settings,trs)
{var row;if(!(trs instanceof $)){trs=$(trs);}
return trs.map(function(i,el){row=_fnGetRowElements(settings,el);return _fnAddData(settings,row.data,el,row.cells);});}
function _fnNodeToDataIndex(oSettings,n)
{return(n._DT_RowIndex!==undefined)?n._DT_RowIndex:null;}
function _fnNodeToColumnIndex(oSettings,iRow,n)
{return $.inArray(n,oSettings.aoData[iRow].anCells);}
function _fnGetCellData(settings,rowIdx,colIdx,type)
{var draw=settings.iDraw;var col=settings.aoColumns[colIdx];var rowData=settings.aoData[rowIdx]._aData;var defaultContent=col.sDefaultContent;var cellData=col.fnGetData(rowData,type,{settings:settings,row:rowIdx,col:colIdx});if(cellData===undefined){if(settings.iDrawError!=draw&&defaultContent===null){_fnLog(settings,0,"Requested unknown parameter "+
(typeof col.mData=='function'?'{function}':"'"+col.mData+"'")+" for row "+rowIdx+", column "+colIdx,4);settings.iDrawError=draw;}
return defaultContent;}
if((cellData===rowData||cellData===null)&&defaultContent!==null&&type!==undefined){cellData=defaultContent;}
else if(typeof cellData==='function'){return cellData.call(rowData);}
if(cellData===null&&type=='display'){return'';}
return cellData;}
function _fnSetCellData(settings,rowIdx,colIdx,val)
{var col=settings.aoColumns[colIdx];var rowData=settings.aoData[rowIdx]._aData;col.fnSetData(rowData,val,{settings:settings,row:rowIdx,col:colIdx});}
var __reArray=/\[.*?\]$/;var __reFn=/\(\)$/;function _fnSplitObjNotation(str)
{return $.map(str.match(/(\\.|[^\.])+/g)||[''],function(s){return s.replace(/\\./g,'.');});}
function _fnGetObjectDataFn(mSource)
{if($.isPlainObject(mSource))
{var o={};$.each(mSource,function(key,val){if(val){o[key]=_fnGetObjectDataFn(val);}});return function(data,type,row,meta){var t=o[type]||o._;return t!==undefined?t(data,type,row,meta):data;};}
else if(mSource===null)
{return function(data){return data;};}
else if(typeof mSource==='function')
{return function(data,type,row,meta){return mSource(data,type,row,meta);};}
else if(typeof mSource==='string'&&(mSource.indexOf('.')!==-1||mSource.indexOf('[')!==-1||mSource.indexOf('(')!==-1))
{var fetchData=function(data,type,src){var arrayNotation,funcNotation,out,innerSrc;if(src!=="")
{var a=_fnSplitObjNotation(src);for(var i=0,iLen=a.length;i<iLen;i++)
{arrayNotation=a[i].match(__reArray);funcNotation=a[i].match(__reFn);if(arrayNotation)
{a[i]=a[i].replace(__reArray,'');if(a[i]!==""){data=data[a[i]];}
out=[];a.splice(0,i+1);innerSrc=a.join('.');if($.isArray(data)){for(var j=0,jLen=data.length;j<jLen;j++){out.push(fetchData(data[j],type,innerSrc));}}
var join=arrayNotation[0].substring(1,arrayNotation[0].length-1);data=(join==="")?out:out.join(join);break;}
else if(funcNotation)
{a[i]=a[i].replace(__reFn,'');data=data[a[i]]();continue;}
if(data===null||data[a[i]]===undefined)
{return undefined;}
data=data[a[i]];}}
return data;};return function(data,type){return fetchData(data,type,mSource);};}
else
{return function(data,type){return data[mSource];};}}
function _fnSetObjectDataFn(mSource)
{if($.isPlainObject(mSource))
{return _fnSetObjectDataFn(mSource._);}
else if(mSource===null)
{return function(){};}
else if(typeof mSource==='function')
{return function(data,val,meta){mSource(data,'set',val,meta);};}
else if(typeof mSource==='string'&&(mSource.indexOf('.')!==-1||mSource.indexOf('[')!==-1||mSource.indexOf('(')!==-1))
{var setData=function(data,val,src){var a=_fnSplitObjNotation(src),b;var aLast=a[a.length-1];var arrayNotation,funcNotation,o,innerSrc;for(var i=0,iLen=a.length-1;i<iLen;i++)
{arrayNotation=a[i].match(__reArray);funcNotation=a[i].match(__reFn);if(arrayNotation)
{a[i]=a[i].replace(__reArray,'');data[a[i]]=[];b=a.slice();b.splice(0,i+1);innerSrc=b.join('.');if($.isArray(val))
{for(var j=0,jLen=val.length;j<jLen;j++)
{o={};setData(o,val[j],innerSrc);data[a[i]].push(o);}}
else
{data[a[i]]=val;}
return;}
else if(funcNotation)
{a[i]=a[i].replace(__reFn,'');data=data[a[i]](val);}
if(data[a[i]]===null||data[a[i]]===undefined)
{data[a[i]]={};}
data=data[a[i]];}
if(aLast.match(__reFn))
{data=data[aLast.replace(__reFn,'')](val);}
else
{data[aLast.replace(__reArray,'')]=val;}};return function(data,val){return setData(data,val,mSource);};}
else
{return function(data,val){data[mSource]=val;};}}
function _fnGetDataMaster(settings)
{return _pluck(settings.aoData,'_aData');}
function _fnClearTable(settings)
{settings.aoData.length=0;settings.aiDisplayMaster.length=0;settings.aiDisplay.length=0;settings.aIds={};}
function _fnDeleteIndex(a,iTarget,splice)
{var iTargetIndex=-1;for(var i=0,iLen=a.length;i<iLen;i++)
{if(a[i]==iTarget)
{iTargetIndex=i;}
else if(a[i]>iTarget)
{a[i]--;}}
if(iTargetIndex!=-1&&splice===undefined)
{a.splice(iTargetIndex,1);}}
function _fnInvalidate(settings,rowIdx,src,colIdx)
{var row=settings.aoData[rowIdx];var i,ien;var cellWrite=function(cell,col){while(cell.childNodes.length){cell.removeChild(cell.firstChild);}
cell.innerHTML=_fnGetCellData(settings,rowIdx,col,'display');};if(src==='dom'||((!src||src==='auto')&&row.src==='dom')){row._aData=_fnGetRowElements(settings,row,colIdx,colIdx===undefined?undefined:row._aData).data;}
else{var cells=row.anCells;if(cells){if(colIdx!==undefined){cellWrite(cells[colIdx],colIdx);}
else{for(i=0,ien=cells.length;i<ien;i++){cellWrite(cells[i],i);}}}}
row._aSortData=null;row._aFilterData=null;var cols=settings.aoColumns;if(colIdx!==undefined){cols[colIdx].sType=null;}
else{for(i=0,ien=cols.length;i<ien;i++){cols[i].sType=null;}
_fnRowAttributes(settings,row);}}
function _fnGetRowElements(settings,row,colIdx,d)
{var
tds=[],td=row.firstChild,name,col,o,i=0,contents,columns=settings.aoColumns,objectRead=settings._rowReadObject;d=d!==undefined?d:objectRead?{}:[];var attr=function(str,td){if(typeof str==='string'){var idx=str.indexOf('@');if(idx!==-1){var attr=str.substring(idx+1);var setter=_fnSetObjectDataFn(str);setter(d,td.getAttribute(attr));}}};var cellProcess=function(cell){if(colIdx===undefined||colIdx===i){col=columns[i];contents=$.trim(cell.innerHTML);if(col&&col._bAttrSrc){var setter=_fnSetObjectDataFn(col.mData._);setter(d,contents);attr(col.mData.sort,cell);attr(col.mData.type,cell);attr(col.mData.filter,cell);}
else{if(objectRead){if(!col._setter){col._setter=_fnSetObjectDataFn(col.mData);}
col._setter(d,contents);}
else{d[i]=contents;}}}
i++;};if(td){while(td){name=td.nodeName.toUpperCase();if(name=="TD"||name=="TH"){cellProcess(td);tds.push(td);}
td=td.nextSibling;}}
else{tds=row.anCells;for(var j=0,jen=tds.length;j<jen;j++){cellProcess(tds[j]);}}
var rowNode=row.firstChild?row:row.nTr;if(rowNode){var id=rowNode.getAttribute('id');if(id){_fnSetObjectDataFn(settings.rowId)(d,id);}}
return{data:d,cells:tds};}
function _fnCreateTr(oSettings,iRow,nTrIn,anTds)
{var
row=oSettings.aoData[iRow],rowData=row._aData,cells=[],nTr,nTd,oCol,i,iLen;if(row.nTr===null)
{nTr=nTrIn||document.createElement('tr');row.nTr=nTr;row.anCells=cells;nTr._DT_RowIndex=iRow;_fnRowAttributes(oSettings,row);for(i=0,iLen=oSettings.aoColumns.length;i<iLen;i++)
{oCol=oSettings.aoColumns[i];nTd=nTrIn?anTds[i]:document.createElement(oCol.sCellType);nTd._DT_CellIndex={row:iRow,column:i};cells.push(nTd);if((!nTrIn||oCol.mRender||oCol.mData!==i)&&(!$.isPlainObject(oCol.mData)||oCol.mData._!==i+'.display')){nTd.innerHTML=_fnGetCellData(oSettings,iRow,i,'display');}
if(oCol.sClass)
{nTd.className+=' '+oCol.sClass;}
if(oCol.bVisible&&!nTrIn)
{nTr.appendChild(nTd);}
else if(!oCol.bVisible&&nTrIn)
{nTd.parentNode.removeChild(nTd);}
if(oCol.fnCreatedCell)
{oCol.fnCreatedCell.call(oSettings.oInstance,nTd,_fnGetCellData(oSettings,iRow,i),rowData,iRow,i);}}
_fnCallbackFire(oSettings,'aoRowCreatedCallback',null,[nTr,rowData,iRow]);}
row.nTr.setAttribute('role','row');}
function _fnRowAttributes(settings,row)
{var tr=row.nTr;var data=row._aData;if(tr){var id=settings.rowIdFn(data);if(id){tr.id=id;}
if(data.DT_RowClass){var a=data.DT_RowClass.split(' ');row.__rowc=row.__rowc?_unique(row.__rowc.concat(a)):a;$(tr).removeClass(row.__rowc.join(' ')).addClass(data.DT_RowClass);}
if(data.DT_RowAttr){$(tr).attr(data.DT_RowAttr);}
if(data.DT_RowData){$(tr).data(data.DT_RowData);}}}
function _fnBuildHead(oSettings)
{var i,ien,cell,row,column;var thead=oSettings.nTHead;var tfoot=oSettings.nTFoot;var createHeader=$('th, td',thead).length===0;var classes=oSettings.oClasses;var columns=oSettings.aoColumns;if(createHeader){row=$('<tr/>').appendTo(thead);}
for(i=0,ien=columns.length;i<ien;i++){column=columns[i];cell=$(column.nTh).addClass(column.sClass);if(createHeader){cell.appendTo(row);}
if(oSettings.oFeatures.bSort){cell.addClass(column.sSortingClass);if(column.bSortable!==false){cell.attr('tabindex',oSettings.iTabIndex).attr('aria-controls',oSettings.sTableId);_fnSortAttachListener(oSettings,column.nTh,i);}}
if(column.sTitle!=cell[0].innerHTML){cell.html(column.sTitle);}
_fnRenderer(oSettings,'header')(oSettings,cell,column,classes);}
if(createHeader){_fnDetectHeader(oSettings.aoHeader,thead);}
$(thead).find('>tr').attr('role','row');$(thead).find('>tr>th, >tr>td').addClass(classes.sHeaderTH);$(tfoot).find('>tr>th, >tr>td').addClass(classes.sFooterTH);if(tfoot!==null){var cells=oSettings.aoFooter[0];for(i=0,ien=cells.length;i<ien;i++){column=columns[i];column.nTf=cells[i].cell;if(column.sClass){$(column.nTf).addClass(column.sClass);}}}}
function _fnDrawHead(oSettings,aoSource,bIncludeHidden)
{var i,iLen,j,jLen,k,kLen,n,nLocalTr;var aoLocal=[];var aApplied=[];var iColumns=oSettings.aoColumns.length;var iRowspan,iColspan;if(!aoSource)
{return;}
if(bIncludeHidden===undefined)
{bIncludeHidden=false;}
for(i=0,iLen=aoSource.length;i<iLen;i++)
{aoLocal[i]=aoSource[i].slice();aoLocal[i].nTr=aoSource[i].nTr;for(j=iColumns-1;j>=0;j--)
{if(!oSettings.aoColumns[j].bVisible&&!bIncludeHidden)
{aoLocal[i].splice(j,1);}}
aApplied.push([]);}
for(i=0,iLen=aoLocal.length;i<iLen;i++)
{nLocalTr=aoLocal[i].nTr;if(nLocalTr)
{while((n=nLocalTr.firstChild))
{nLocalTr.removeChild(n);}}
for(j=0,jLen=aoLocal[i].length;j<jLen;j++)
{iRowspan=1;iColspan=1;if(aApplied[i][j]===undefined)
{nLocalTr.appendChild(aoLocal[i][j].cell);aApplied[i][j]=1;while(aoLocal[i+iRowspan]!==undefined&&aoLocal[i][j].cell==aoLocal[i+iRowspan][j].cell)
{aApplied[i+iRowspan][j]=1;iRowspan++;}
while(aoLocal[i][j+iColspan]!==undefined&&aoLocal[i][j].cell==aoLocal[i][j+iColspan].cell)
{for(k=0;k<iRowspan;k++)
{aApplied[i+k][j+iColspan]=1;}
iColspan++;}
$(aoLocal[i][j].cell).attr('rowspan',iRowspan).attr('colspan',iColspan);}}}}
function _fnDraw(oSettings)
{var aPreDraw=_fnCallbackFire(oSettings,'aoPreDrawCallback','preDraw',[oSettings]);if($.inArray(false,aPreDraw)!==-1)
{_fnProcessingDisplay(oSettings,false);return;}
var i,iLen,n;var anRows=[];var iRowCount=0;var asStripeClasses=oSettings.asStripeClasses;var iStripes=asStripeClasses.length;var iOpenRows=oSettings.aoOpenRows.length;var oLang=oSettings.oLanguage;var iInitDisplayStart=oSettings.iInitDisplayStart;var bServerSide=_fnDataSource(oSettings)=='ssp';var aiDisplay=oSettings.aiDisplay;oSettings.bDrawing=true;if(iInitDisplayStart!==undefined&&iInitDisplayStart!==-1)
{oSettings._iDisplayStart=bServerSide?iInitDisplayStart:iInitDisplayStart>=oSettings.fnRecordsDisplay()?0:iInitDisplayStart;oSettings.iInitDisplayStart=-1;}
var iDisplayStart=oSettings._iDisplayStart;var iDisplayEnd=oSettings.fnDisplayEnd();if(oSettings.bDeferLoading)
{oSettings.bDeferLoading=false;oSettings.iDraw++;_fnProcessingDisplay(oSettings,false);}
else if(!bServerSide)
{oSettings.iDraw++;}
else if(!oSettings.bDestroying&&!_fnAjaxUpdate(oSettings))
{return;}
if(aiDisplay.length!==0)
{var iStart=bServerSide?0:iDisplayStart;var iEnd=bServerSide?oSettings.aoData.length:iDisplayEnd;for(var j=iStart;j<iEnd;j++)
{var iDataIndex=aiDisplay[j];var aoData=oSettings.aoData[iDataIndex];if(aoData.nTr===null)
{_fnCreateTr(oSettings,iDataIndex);}
var nRow=aoData.nTr;if(iStripes!==0)
{var sStripe=asStripeClasses[iRowCount%iStripes];if(aoData._sRowStripe!=sStripe)
{$(nRow).removeClass(aoData._sRowStripe).addClass(sStripe);aoData._sRowStripe=sStripe;}}
_fnCallbackFire(oSettings,'aoRowCallback',null,[nRow,aoData._aData,iRowCount,j]);anRows.push(nRow);iRowCount++;}}
else
{var sZero=oLang.sZeroRecords;if(oSettings.iDraw==1&&_fnDataSource(oSettings)=='ajax')
{sZero=oLang.sLoadingRecords;}
else if(oLang.sEmptyTable&&oSettings.fnRecordsTotal()===0)
{sZero=oLang.sEmptyTable;}
anRows[0]=$('<tr/>',{'class':iStripes?asStripeClasses[0]:''}).append($('<td />',{'valign':'top','colSpan':_fnVisbleColumns(oSettings),'class':oSettings.oClasses.sRowEmpty}).html(sZero))[0];}
_fnCallbackFire(oSettings,'aoHeaderCallback','header',[$(oSettings.nTHead).children('tr')[0],_fnGetDataMaster(oSettings),iDisplayStart,iDisplayEnd,aiDisplay]);_fnCallbackFire(oSettings,'aoFooterCallback','footer',[$(oSettings.nTFoot).children('tr')[0],_fnGetDataMaster(oSettings),iDisplayStart,iDisplayEnd,aiDisplay]);var body=$(oSettings.nTBody);body.children().detach();body.append($(anRows));_fnCallbackFire(oSettings,'aoDrawCallback','draw',[oSettings]);oSettings.bSorted=false;oSettings.bFiltered=false;oSettings.bDrawing=false;}
function _fnReDraw(settings,holdPosition)
{var
features=settings.oFeatures,sort=features.bSort,filter=features.bFilter;if(sort){_fnSort(settings);}
if(filter){_fnFilterComplete(settings,settings.oPreviousSearch);}
else{settings.aiDisplay=settings.aiDisplayMaster.slice();}
if(holdPosition!==true){settings._iDisplayStart=0;}
settings._drawHold=holdPosition;_fnDraw(settings);settings._drawHold=false;}
function _fnAddOptionsHtml(oSettings)
{var classes=oSettings.oClasses;var table=$(oSettings.nTable);var holding=$('<div/>').insertBefore(table);var features=oSettings.oFeatures;var insert=$('<div/>',{id:oSettings.sTableId+'_wrapper','class':classes.sWrapper+(oSettings.nTFoot?'':' '+classes.sNoFooter)});oSettings.nHolding=holding[0];oSettings.nTableWrapper=insert[0];oSettings.nTableReinsertBefore=oSettings.nTable.nextSibling;var aDom=oSettings.sDom.split('');var featureNode,cOption,nNewNode,cNext,sAttr,j;for(var i=0;i<aDom.length;i++)
{featureNode=null;cOption=aDom[i];if(cOption=='<')
{nNewNode=$('<div/>')[0];cNext=aDom[i+1];if(cNext=="'"||cNext=='"')
{sAttr="";j=2;while(aDom[i+j]!=cNext)
{sAttr+=aDom[i+j];j++;}
if(sAttr=="H")
{sAttr=classes.sJUIHeader;}
else if(sAttr=="F")
{sAttr=classes.sJUIFooter;}
if(sAttr.indexOf('.')!=-1)
{var aSplit=sAttr.split('.');nNewNode.id=aSplit[0].substr(1,aSplit[0].length-1);nNewNode.className=aSplit[1];}
else if(sAttr.charAt(0)=="#")
{nNewNode.id=sAttr.substr(1,sAttr.length-1);}
else
{nNewNode.className=sAttr;}
i+=j;}
insert.append(nNewNode);insert=$(nNewNode);}
else if(cOption=='>')
{insert=insert.parent();}
else if(cOption=='l'&&features.bPaginate&&features.bLengthChange)
{featureNode=_fnFeatureHtmlLength(oSettings);}
else if(cOption=='f'&&features.bFilter)
{featureNode=_fnFeatureHtmlFilter(oSettings);}
else if(cOption=='r'&&features.bProcessing)
{featureNode=_fnFeatureHtmlProcessing(oSettings);}
else if(cOption=='t')
{featureNode=_fnFeatureHtmlTable(oSettings);}
else if(cOption=='i'&&features.bInfo)
{featureNode=_fnFeatureHtmlInfo(oSettings);}
else if(cOption=='p'&&features.bPaginate)
{featureNode=_fnFeatureHtmlPaginate(oSettings);}
else if(DataTable.ext.feature.length!==0)
{var aoFeatures=DataTable.ext.feature;for(var k=0,kLen=aoFeatures.length;k<kLen;k++)
{if(cOption==aoFeatures[k].cFeature)
{featureNode=aoFeatures[k].fnInit(oSettings);break;}}}
if(featureNode)
{var aanFeatures=oSettings.aanFeatures;if(!aanFeatures[cOption])
{aanFeatures[cOption]=[];}
aanFeatures[cOption].push(featureNode);insert.append(featureNode);}}
holding.replaceWith(insert);oSettings.nHolding=null;}
function _fnDetectHeader(aLayout,nThead)
{var nTrs=$(nThead).children('tr');var nTr,nCell;var i,k,l,iLen,jLen,iColShifted,iColumn,iColspan,iRowspan;var bUnique;var fnShiftCol=function(a,i,j){var k=a[i];while(k[j]){j++;}
return j;};aLayout.splice(0,aLayout.length);for(i=0,iLen=nTrs.length;i<iLen;i++)
{aLayout.push([]);}
for(i=0,iLen=nTrs.length;i<iLen;i++)
{nTr=nTrs[i];iColumn=0;nCell=nTr.firstChild;while(nCell){if(nCell.nodeName.toUpperCase()=="TD"||nCell.nodeName.toUpperCase()=="TH")
{iColspan=nCell.getAttribute('colspan')*1;iRowspan=nCell.getAttribute('rowspan')*1;iColspan=(!iColspan||iColspan===0||iColspan===1)?1:iColspan;iRowspan=(!iRowspan||iRowspan===0||iRowspan===1)?1:iRowspan;iColShifted=fnShiftCol(aLayout,i,iColumn);bUnique=iColspan===1?true:false;for(l=0;l<iColspan;l++)
{for(k=0;k<iRowspan;k++)
{aLayout[i+k][iColShifted+l]={"cell":nCell,"unique":bUnique};aLayout[i+k].nTr=nTr;}}}
nCell=nCell.nextSibling;}}}
function _fnGetUniqueThs(oSettings,nHeader,aLayout)
{var aReturn=[];if(!aLayout)
{aLayout=oSettings.aoHeader;if(nHeader)
{aLayout=[];_fnDetectHeader(aLayout,nHeader);}}
for(var i=0,iLen=aLayout.length;i<iLen;i++)
{for(var j=0,jLen=aLayout[i].length;j<jLen;j++)
{if(aLayout[i][j].unique&&(!aReturn[j]||!oSettings.bSortCellsTop))
{aReturn[j]=aLayout[i][j].cell;}}}
return aReturn;}
function _fnBuildAjax(oSettings,data,fn)
{_fnCallbackFire(oSettings,'aoServerParams','serverParams',[data]);if(data&&$.isArray(data)){var tmp={};var rbracket=/(.*?)\[\]$/;$.each(data,function(key,val){var match=val.name.match(rbracket);if(match){var name=match[0];if(!tmp[name]){tmp[name]=[];}
tmp[name].push(val.value);}
else{tmp[val.name]=val.value;}});data=tmp;}
var ajaxData;var ajax=oSettings.ajax;var instance=oSettings.oInstance;var callback=function(json){_fnCallbackFire(oSettings,null,'xhr',[oSettings,json,oSettings.jqXHR]);fn(json);};if($.isPlainObject(ajax)&&ajax.data)
{ajaxData=ajax.data;var newData=$.isFunction(ajaxData)?ajaxData(data,oSettings):ajaxData;data=$.isFunction(ajaxData)&&newData?newData:$.extend(true,data,newData);delete ajax.data;}
var baseAjax={"data":data,"success":function(json){var error=json.error||json.sError;if(error){_fnLog(oSettings,0,error);}
oSettings.json=json;callback(json);},"dataType":"json","cache":false,"type":oSettings.sServerMethod,"error":function(xhr,error,thrown){var ret=_fnCallbackFire(oSettings,null,'xhr',[oSettings,null,oSettings.jqXHR]);if($.inArray(true,ret)===-1){if(error=="parsererror"){_fnLog(oSettings,0,'Invalid JSON response',1);}
else if(xhr.readyState===4){_fnLog(oSettings,0,'Ajax error',7);}}
_fnProcessingDisplay(oSettings,false);}};oSettings.oAjaxData=data;_fnCallbackFire(oSettings,null,'preXhr',[oSettings,data]);if(oSettings.fnServerData)
{oSettings.fnServerData.call(instance,oSettings.sAjaxSource,$.map(data,function(val,key){return{name:key,value:val};}),callback,oSettings);}
else if(oSettings.sAjaxSource||typeof ajax==='string')
{oSettings.jqXHR=$.ajax($.extend(baseAjax,{url:ajax||oSettings.sAjaxSource}));}
else if($.isFunction(ajax))
{oSettings.jqXHR=ajax.call(instance,data,callback,oSettings);}
else
{oSettings.jqXHR=$.ajax($.extend(baseAjax,ajax));ajax.data=ajaxData;}}
function _fnAjaxUpdate(settings)
{if(settings.bAjaxDataGet){settings.iDraw++;_fnProcessingDisplay(settings,true);_fnBuildAjax(settings,_fnAjaxParameters(settings),function(json){_fnAjaxUpdateDraw(settings,json);});return false;}
return true;}
function _fnAjaxParameters(settings)
{var
columns=settings.aoColumns,columnCount=columns.length,features=settings.oFeatures,preSearch=settings.oPreviousSearch,preColSearch=settings.aoPreSearchCols,i,data=[],dataProp,column,columnSearch,sort=_fnSortFlatten(settings),displayStart=settings._iDisplayStart,displayLength=features.bPaginate!==false?settings._iDisplayLength:-1;var param=function(name,value){data.push({'name':name,'value':value});};param('sEcho',settings.iDraw);param('iColumns',columnCount);param('sColumns',_pluck(columns,'sName').join(','));param('iDisplayStart',displayStart);param('iDisplayLength',displayLength);var d={draw:settings.iDraw,columns:[],order:[],start:displayStart,length:displayLength,search:{value:preSearch.sSearch,regex:preSearch.bRegex}};for(i=0;i<columnCount;i++){column=columns[i];columnSearch=preColSearch[i];dataProp=typeof column.mData=="function"?'function':column.mData;d.columns.push({data:dataProp,name:column.sName,searchable:column.bSearchable,orderable:column.bSortable,search:{value:columnSearch.sSearch,regex:columnSearch.bRegex}});param("mDataProp_"+i,dataProp);if(features.bFilter){param('sSearch_'+i,columnSearch.sSearch);param('bRegex_'+i,columnSearch.bRegex);param('bSearchable_'+i,column.bSearchable);}
if(features.bSort){param('bSortable_'+i,column.bSortable);}}
if(features.bFilter){param('sSearch',preSearch.sSearch);param('bRegex',preSearch.bRegex);}
if(features.bSort){$.each(sort,function(i,val){d.order.push({column:val.col,dir:val.dir});param('iSortCol_'+i,val.col);param('sSortDir_'+i,val.dir);});param('iSortingCols',sort.length);}
var legacy=DataTable.ext.legacy.ajax;if(legacy===null){return settings.sAjaxSource?data:d;}
return legacy?data:d;}
function _fnAjaxUpdateDraw(settings,json)
{var compat=function(old,modern){return json[old]!==undefined?json[old]:json[modern];};var data=_fnAjaxDataSrc(settings,json);var draw=compat('sEcho','draw');var recordsTotal=compat('iTotalRecords','recordsTotal');var recordsFiltered=compat('iTotalDisplayRecords','recordsFiltered');if(draw){if(draw*1<settings.iDraw){return;}
settings.iDraw=draw*1;}
_fnClearTable(settings);settings._iRecordsTotal=parseInt(recordsTotal,10);settings._iRecordsDisplay=parseInt(recordsFiltered,10);for(var i=0,ien=data.length;i<ien;i++){_fnAddData(settings,data[i]);}
settings.aiDisplay=settings.aiDisplayMaster.slice();settings.bAjaxDataGet=false;_fnDraw(settings);if(!settings._bInitComplete){_fnInitComplete(settings,json);}
settings.bAjaxDataGet=true;_fnProcessingDisplay(settings,false);}
function _fnAjaxDataSrc(oSettings,json)
{var dataSrc=$.isPlainObject(oSettings.ajax)&&oSettings.ajax.dataSrc!==undefined?oSettings.ajax.dataSrc:oSettings.sAjaxDataProp;if(dataSrc==='data'){return json.aaData||json[dataSrc];}
return dataSrc!==""?_fnGetObjectDataFn(dataSrc)(json):json;}
function _fnFeatureHtmlFilter(settings)
{var classes=settings.oClasses;var tableId=settings.sTableId;var language=settings.oLanguage;var previousSearch=settings.oPreviousSearch;var features=settings.aanFeatures;var input='<input type="search" class="'+classes.sFilterInput+'"/>';var str=language.sSearch;str=str.match(/_INPUT_/)?str.replace('_INPUT_',input):str+input;var filter=$('<div/>',{'id':!features.f?tableId+'_filter':null,'class':classes.sFilter}).append($('<label/>').append(str));var searchFn=function(){var n=features.f;var val=!this.value?"":this.value;if(val!=previousSearch.sSearch){_fnFilterComplete(settings,{"sSearch":val,"bRegex":previousSearch.bRegex,"bSmart":previousSearch.bSmart,"bCaseInsensitive":previousSearch.bCaseInsensitive});settings._iDisplayStart=0;_fnDraw(settings);}};var searchDelay=settings.searchDelay!==null?settings.searchDelay:_fnDataSource(settings)==='ssp'?400:0;var jqFilter=$('input',filter).val(previousSearch.sSearch).attr('placeholder',language.sSearchPlaceholder).bind('keyup.DT search.DT input.DT paste.DT cut.DT',searchDelay?_fnThrottle(searchFn,searchDelay):searchFn).bind('keypress.DT',function(e){if(e.keyCode==13){return false;}}).attr('aria-controls',tableId);$(settings.nTable).on('search.dt.DT',function(ev,s){if(settings===s){try{if(jqFilter[0]!==document.activeElement){jqFilter.val(previousSearch.sSearch);}}
catch(e){}}});return filter[0];}
function _fnFilterComplete(oSettings,oInput,iForce)
{var oPrevSearch=oSettings.oPreviousSearch;var aoPrevSearch=oSettings.aoPreSearchCols;var fnSaveFilter=function(oFilter){oPrevSearch.sSearch=oFilter.sSearch;oPrevSearch.bRegex=oFilter.bRegex;oPrevSearch.bSmart=oFilter.bSmart;oPrevSearch.bCaseInsensitive=oFilter.bCaseInsensitive;};var fnRegex=function(o){return o.bEscapeRegex!==undefined?!o.bEscapeRegex:o.bRegex;};_fnColumnTypes(oSettings);if(_fnDataSource(oSettings)!='ssp')
{_fnFilter(oSettings,oInput.sSearch,iForce,fnRegex(oInput),oInput.bSmart,oInput.bCaseInsensitive);fnSaveFilter(oInput);for(var i=0;i<aoPrevSearch.length;i++)
{_fnFilterColumn(oSettings,aoPrevSearch[i].sSearch,i,fnRegex(aoPrevSearch[i]),aoPrevSearch[i].bSmart,aoPrevSearch[i].bCaseInsensitive);}
_fnFilterCustom(oSettings);}
else
{fnSaveFilter(oInput);}
oSettings.bFiltered=true;_fnCallbackFire(oSettings,null,'search',[oSettings]);}
function _fnFilterCustom(settings)
{var filters=DataTable.ext.search;var displayRows=settings.aiDisplay;var row,rowIdx;for(var i=0,ien=filters.length;i<ien;i++){var rows=[];for(var j=0,jen=displayRows.length;j<jen;j++){rowIdx=displayRows[j];row=settings.aoData[rowIdx];if(filters[i](settings,row._aFilterData,rowIdx,row._aData,j)){rows.push(rowIdx);}}
displayRows.length=0;$.merge(displayRows,rows);}}
function _fnFilterColumn(settings,searchStr,colIdx,regex,smart,caseInsensitive)
{if(searchStr===''){return;}
var data;var display=settings.aiDisplay;var rpSearch=_fnFilterCreateSearch(searchStr,regex,smart,caseInsensitive);for(var i=display.length-1;i>=0;i--){data=settings.aoData[display[i]]._aFilterData[colIdx];if(!rpSearch.test(data)){display.splice(i,1);}}}
function _fnFilter(settings,input,force,regex,smart,caseInsensitive)
{var rpSearch=_fnFilterCreateSearch(input,regex,smart,caseInsensitive);var prevSearch=settings.oPreviousSearch.sSearch;var displayMaster=settings.aiDisplayMaster;var display,invalidated,i;if(DataTable.ext.search.length!==0){force=true;}
invalidated=_fnFilterData(settings);if(input.length<=0){settings.aiDisplay=displayMaster.slice();}
else{if(invalidated||force||prevSearch.length>input.length||input.indexOf(prevSearch)!==0||settings.bSorted){settings.aiDisplay=displayMaster.slice();}
display=settings.aiDisplay;for(i=display.length-1;i>=0;i--){if(!rpSearch.test(settings.aoData[display[i]]._sFilterRow)){display.splice(i,1);}}}}
function _fnFilterCreateSearch(search,regex,smart,caseInsensitive)
{search=regex?search:_fnEscapeRegex(search);if(smart){var a=$.map(search.match(/"[^"]+"|[^ ]+/g)||[''],function(word){if(word.charAt(0)==='"'){var m=word.match(/^"(.*)"$/);word=m?m[1]:word;}
return word.replace('"','');});search='^(?=.*?'+a.join(')(?=.*?')+').*$';}
return new RegExp(search,caseInsensitive?'i':'');}
var _fnEscapeRegex=DataTable.util.escapeRegex;var __filter_div=$('<div>')[0];var __filter_div_textContent=__filter_div.textContent!==undefined;function _fnFilterData(settings)
{var columns=settings.aoColumns;var column;var i,j,ien,jen,filterData,cellData,row;var fomatters=DataTable.ext.type.search;var wasInvalidated=false;for(i=0,ien=settings.aoData.length;i<ien;i++){row=settings.aoData[i];if(!row._aFilterData){filterData=[];for(j=0,jen=columns.length;j<jen;j++){column=columns[j];if(column.bSearchable){cellData=_fnGetCellData(settings,i,j,'filter');if(fomatters[column.sType]){cellData=fomatters[column.sType](cellData);}
if(cellData===null){cellData='';}
if(typeof cellData!=='string'&&cellData.toString){cellData=cellData.toString();}}
else{cellData='';}
if(cellData.indexOf&&cellData.indexOf('&')!==-1){__filter_div.innerHTML=cellData;cellData=__filter_div_textContent?__filter_div.textContent:__filter_div.innerText;}
if(cellData.replace){cellData=cellData.replace(/[\r\n]/g,'');}
filterData.push(cellData);}
row._aFilterData=filterData;row._sFilterRow=filterData.join('  ');wasInvalidated=true;}}
return wasInvalidated;}
function _fnSearchToCamel(obj)
{return{search:obj.sSearch,smart:obj.bSmart,regex:obj.bRegex,caseInsensitive:obj.bCaseInsensitive};}
function _fnSearchToHung(obj)
{return{sSearch:obj.search,bSmart:obj.smart,bRegex:obj.regex,bCaseInsensitive:obj.caseInsensitive};}
function _fnFeatureHtmlInfo(settings)
{var
tid=settings.sTableId,nodes=settings.aanFeatures.i,n=$('<div/>',{'class':settings.oClasses.sInfo,'id':!nodes?tid+'_info':null});if(!nodes){settings.aoDrawCallback.push({"fn":_fnUpdateInfo,"sName":"information"});n.attr('role','status').attr('aria-live','polite');$(settings.nTable).attr('aria-describedby',tid+'_info');}
return n[0];}
function _fnUpdateInfo(settings)
{var nodes=settings.aanFeatures.i;if(nodes.length===0){return;}
var
lang=settings.oLanguage,start=settings._iDisplayStart+1,end=settings.fnDisplayEnd(),max=settings.fnRecordsTotal(),total=settings.fnRecordsDisplay(),out=total?lang.sInfo:lang.sInfoEmpty;if(total!==max){out+=' '+lang.sInfoFiltered;}
out+=lang.sInfoPostFix;out=_fnInfoMacros(settings,out);var callback=lang.fnInfoCallback;if(callback!==null){out=callback.call(settings.oInstance,settings,start,end,max,total,out);}
$(nodes).html(out);}
function _fnInfoMacros(settings,str)
{var
formatter=settings.fnFormatNumber,start=settings._iDisplayStart+1,len=settings._iDisplayLength,vis=settings.fnRecordsDisplay(),all=len===-1;return str.replace(/_START_/g,formatter.call(settings,start)).replace(/_END_/g,formatter.call(settings,settings.fnDisplayEnd())).replace(/_MAX_/g,formatter.call(settings,settings.fnRecordsTotal())).replace(/_TOTAL_/g,formatter.call(settings,vis)).replace(/_PAGE_/g,formatter.call(settings,all?1:Math.ceil(start/len))).replace(/_PAGES_/g,formatter.call(settings,all?1:Math.ceil(vis/len)));}
function _fnInitialise(settings)
{var i,iLen,iAjaxStart=settings.iInitDisplayStart;var columns=settings.aoColumns,column;var features=settings.oFeatures;var deferLoading=settings.bDeferLoading;if(!settings.bInitialised){setTimeout(function(){_fnInitialise(settings);},200);return;}
_fnAddOptionsHtml(settings);_fnBuildHead(settings);_fnDrawHead(settings,settings.aoHeader);_fnDrawHead(settings,settings.aoFooter);_fnProcessingDisplay(settings,true);if(features.bAutoWidth){_fnCalculateColumnWidths(settings);}
for(i=0,iLen=columns.length;i<iLen;i++){column=columns[i];if(column.sWidth){column.nTh.style.width=_fnStringToCss(column.sWidth);}}
_fnCallbackFire(settings,null,'preInit',[settings]);_fnReDraw(settings);var dataSrc=_fnDataSource(settings);if(dataSrc!='ssp'||deferLoading){if(dataSrc=='ajax'){_fnBuildAjax(settings,[],function(json){var aData=_fnAjaxDataSrc(settings,json);for(i=0;i<aData.length;i++){_fnAddData(settings,aData[i]);}
settings.iInitDisplayStart=iAjaxStart;_fnReDraw(settings);_fnProcessingDisplay(settings,false);_fnInitComplete(settings,json);},settings);}
else{_fnProcessingDisplay(settings,false);_fnInitComplete(settings);}}}
function _fnInitComplete(settings,json)
{settings._bInitComplete=true;if(json||settings.oInit.aaData){_fnAdjustColumnSizing(settings);}
_fnCallbackFire(settings,null,'plugin-init',[settings,json]);_fnCallbackFire(settings,'aoInitComplete','init',[settings,json]);}
function _fnLengthChange(settings,val)
{var len=parseInt(val,10);settings._iDisplayLength=len;_fnLengthOverflow(settings);_fnCallbackFire(settings,null,'length',[settings,len]);}
function _fnFeatureHtmlLength(settings)
{var
classes=settings.oClasses,tableId=settings.sTableId,menu=settings.aLengthMenu,d2=$.isArray(menu[0]),lengths=d2?menu[0]:menu,language=d2?menu[1]:menu;var select=$('<select/>',{'name':tableId+'_length','aria-controls':tableId,'class':classes.sLengthSelect});for(var i=0,ien=lengths.length;i<ien;i++){select[0][i]=new Option(language[i],lengths[i]);}
var div=$('<div><label/></div>').addClass(classes.sLength);if(!settings.aanFeatures.l){div[0].id=tableId+'_length';}
div.children().append(settings.oLanguage.sLengthMenu.replace('_MENU_',select[0].outerHTML));$('select',div).val(settings._iDisplayLength).bind('change.DT',function(e){_fnLengthChange(settings,$(this).val());_fnDraw(settings);});$(settings.nTable).bind('length.dt.DT',function(e,s,len){if(settings===s){$('select',div).val(len);}});return div[0];}
function _fnFeatureHtmlPaginate(settings)
{var
type=settings.sPaginationType,plugin=DataTable.ext.pager[type],modern=typeof plugin==='function',redraw=function(settings){_fnDraw(settings);},node=$('<div/>').addClass(settings.oClasses.sPaging+type)[0],features=settings.aanFeatures;if(!modern){plugin.fnInit(settings,node,redraw);}
if(!features.p)
{node.id=settings.sTableId+'_paginate';settings.aoDrawCallback.push({"fn":function(settings){if(modern){var
start=settings._iDisplayStart,len=settings._iDisplayLength,visRecords=settings.fnRecordsDisplay(),all=len===-1,page=all?0:Math.ceil(start/len),pages=all?1:Math.ceil(visRecords/len),buttons=plugin(page,pages),i,ien;for(i=0,ien=features.p.length;i<ien;i++){_fnRenderer(settings,'pageButton')(settings,features.p[i],i,buttons,page,pages);}}
else{plugin.fnUpdate(settings,redraw);}},"sName":"pagination"});}
return node;}
function _fnPageChange(settings,action,redraw)
{var
start=settings._iDisplayStart,len=settings._iDisplayLength,records=settings.fnRecordsDisplay();if(records===0||len===-1)
{start=0;}
else if(typeof action==="number")
{start=action*len;if(start>records)
{start=0;}}
else if(action=="first")
{start=0;}
else if(action=="previous")
{start=len>=0?start-len:0;if(start<0)
{start=0;}}
else if(action=="next")
{if(start+len<records)
{start+=len;}}
else if(action=="last")
{start=Math.floor((records-1)/len)*len;}
else
{_fnLog(settings,0,"Unknown paging action: "+action,5);}
var changed=settings._iDisplayStart!==start;settings._iDisplayStart=start;if(changed){_fnCallbackFire(settings,null,'page',[settings]);if(redraw){_fnDraw(settings);}}
return changed;}
function _fnFeatureHtmlProcessing(settings)
{return $('<div/>',{'id':!settings.aanFeatures.r?settings.sTableId+'_processing':null,'class':settings.oClasses.sProcessing}).html(settings.oLanguage.sProcessing).insertBefore(settings.nTable)[0];}
function _fnProcessingDisplay(settings,show)
{if(settings.oFeatures.bProcessing){$(settings.aanFeatures.r).css('display',show?'block':'none');}
_fnCallbackFire(settings,null,'processing',[settings,show]);}
function _fnFeatureHtmlTable(settings)
{var table=$(settings.nTable);table.attr('role','grid');var scroll=settings.oScroll;if(scroll.sX===''&&scroll.sY===''){return settings.nTable;}
var scrollX=scroll.sX;var scrollY=scroll.sY;var classes=settings.oClasses;var caption=table.children('caption');var captionSide=caption.length?caption[0]._captionSide:null;var headerClone=$(table[0].cloneNode(false));var footerClone=$(table[0].cloneNode(false));var footer=table.children('tfoot');var _div='<div/>';var size=function(s){return!s?null:_fnStringToCss(s);};if(!footer.length){footer=null;}
var scroller=$(_div,{'class':classes.sScrollWrapper}).append($(_div,{'class':classes.sScrollHead}).css({overflow:'hidden',position:'relative',border:0,width:scrollX?size(scrollX):'100%'}).append($(_div,{'class':classes.sScrollHeadInner}).css({'box-sizing':'content-box',width:scroll.sXInner||'100%'}).append(headerClone.removeAttr('id').css('margin-left',0).append(captionSide==='top'?caption:null).append(table.children('thead'))))).append($(_div,{'class':classes.sScrollBody}).css({position:'relative',overflow:'auto',width:size(scrollX)}).append(table));if(footer){scroller.append($(_div,{'class':classes.sScrollFoot}).css({overflow:'hidden',border:0,width:scrollX?size(scrollX):'100%'}).append($(_div,{'class':classes.sScrollFootInner}).append(footerClone.removeAttr('id').css('margin-left',0).append(captionSide==='bottom'?caption:null).append(table.children('tfoot')))));}
var children=scroller.children();var scrollHead=children[0];var scrollBody=children[1];var scrollFoot=footer?children[2]:null;if(scrollX){$(scrollBody).on('scroll.DT',function(e){var scrollLeft=this.scrollLeft;scrollHead.scrollLeft=scrollLeft;if(footer){scrollFoot.scrollLeft=scrollLeft;}});}
$(scrollBody).css(scrollY&&scroll.bCollapse?'max-height':'height',scrollY);settings.nScrollHead=scrollHead;settings.nScrollBody=scrollBody;settings.nScrollFoot=scrollFoot;settings.aoDrawCallback.push({"fn":_fnScrollDraw,"sName":"scrolling"});return scroller[0];}
function _fnScrollDraw(settings)
{var
scroll=settings.oScroll,scrollX=scroll.sX,scrollXInner=scroll.sXInner,scrollY=scroll.sY,barWidth=scroll.iBarWidth,divHeader=$(settings.nScrollHead),divHeaderStyle=divHeader[0].style,divHeaderInner=divHeader.children('div'),divHeaderInnerStyle=divHeaderInner[0].style,divHeaderTable=divHeaderInner.children('table'),divBodyEl=settings.nScrollBody,divBody=$(divBodyEl),divBodyStyle=divBodyEl.style,divFooter=$(settings.nScrollFoot),divFooterInner=divFooter.children('div'),divFooterTable=divFooterInner.children('table'),header=$(settings.nTHead),table=$(settings.nTable),tableEl=table[0],tableStyle=tableEl.style,footer=settings.nTFoot?$(settings.nTFoot):null,browser=settings.oBrowser,ie67=browser.bScrollOversize,dtHeaderCells=_pluck(settings.aoColumns,'nTh'),headerTrgEls,footerTrgEls,headerSrcEls,footerSrcEls,headerCopy,footerCopy,headerWidths=[],footerWidths=[],headerContent=[],footerContent=[],idx,correction,sanityWidth,zeroOut=function(nSizer){var style=nSizer.style;style.paddingTop="0";style.paddingBottom="0";style.borderTopWidth="0";style.borderBottomWidth="0";style.height=0;};var scrollBarVis=divBodyEl.scrollHeight>divBodyEl.clientHeight;if(settings.scrollBarVis!==scrollBarVis&&settings.scrollBarVis!==undefined){settings.scrollBarVis=scrollBarVis;_fnAdjustColumnSizing(settings);return;}
else{settings.scrollBarVis=scrollBarVis;}
table.children('thead, tfoot').remove();if(footer){footerCopy=footer.clone().prependTo(table);footerTrgEls=footer.find('tr');footerSrcEls=footerCopy.find('tr');}
headerCopy=header.clone().prependTo(table);headerTrgEls=header.find('tr');headerSrcEls=headerCopy.find('tr');headerCopy.find('th, td').removeAttr('tabindex');if(!scrollX)
{divBodyStyle.width='100%';divHeader[0].style.width='100%';}
$.each(_fnGetUniqueThs(settings,headerCopy),function(i,el){idx=_fnVisibleToColumnIndex(settings,i);el.style.width=settings.aoColumns[idx].sWidth;});if(footer){_fnApplyToChildren(function(n){n.style.width="";},footerSrcEls);}
sanityWidth=table.outerWidth();if(scrollX===""){tableStyle.width="100%";if(ie67&&(table.find('tbody').height()>divBodyEl.offsetHeight||divBody.css('overflow-y')=="scroll")){tableStyle.width=_fnStringToCss(table.outerWidth()-barWidth);}
sanityWidth=table.outerWidth();}
else if(scrollXInner!==""){tableStyle.width=_fnStringToCss(scrollXInner);sanityWidth=table.outerWidth();}
_fnApplyToChildren(zeroOut,headerSrcEls);_fnApplyToChildren(function(nSizer){headerContent.push(nSizer.innerHTML);headerWidths.push(_fnStringToCss($(nSizer).css('width')));},headerSrcEls);_fnApplyToChildren(function(nToSize,i){if($.inArray(nToSize,dtHeaderCells)!==-1){nToSize.style.width=headerWidths[i];}},headerTrgEls);$(headerSrcEls).height(0);if(footer)
{_fnApplyToChildren(zeroOut,footerSrcEls);_fnApplyToChildren(function(nSizer){footerContent.push(nSizer.innerHTML);footerWidths.push(_fnStringToCss($(nSizer).css('width')));},footerSrcEls);_fnApplyToChildren(function(nToSize,i){nToSize.style.width=footerWidths[i];},footerTrgEls);$(footerSrcEls).height(0);}
_fnApplyToChildren(function(nSizer,i){nSizer.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+headerContent[i]+'</div>';nSizer.style.width=headerWidths[i];},headerSrcEls);if(footer)
{_fnApplyToChildren(function(nSizer,i){nSizer.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+footerContent[i]+'</div>';nSizer.style.width=footerWidths[i];},footerSrcEls);}
if(table.outerWidth()<sanityWidth)
{correction=((divBodyEl.scrollHeight>divBodyEl.offsetHeight||divBody.css('overflow-y')=="scroll"))?sanityWidth+barWidth:sanityWidth;if(ie67&&(divBodyEl.scrollHeight>divBodyEl.offsetHeight||divBody.css('overflow-y')=="scroll")){tableStyle.width=_fnStringToCss(correction-barWidth);}
if(scrollX===""||scrollXInner!==""){_fnLog(settings,1,'Possible column misalignment',6);}}
else
{correction='100%';}
divBodyStyle.width=_fnStringToCss(correction);divHeaderStyle.width=_fnStringToCss(correction);if(footer){settings.nScrollFoot.style.width=_fnStringToCss(correction);}
if(!scrollY){if(ie67){divBodyStyle.height=_fnStringToCss(tableEl.offsetHeight+barWidth);}}
var iOuterWidth=table.outerWidth();divHeaderTable[0].style.width=_fnStringToCss(iOuterWidth);divHeaderInnerStyle.width=_fnStringToCss(iOuterWidth);var bScrolling=table.height()>divBodyEl.clientHeight||divBody.css('overflow-y')=="scroll";var padding='padding'+(browser.bScrollbarLeft?'Left':'Right');divHeaderInnerStyle[padding]=bScrolling?barWidth+"px":"0px";if(footer){divFooterTable[0].style.width=_fnStringToCss(iOuterWidth);divFooterInner[0].style.width=_fnStringToCss(iOuterWidth);divFooterInner[0].style[padding]=bScrolling?barWidth+"px":"0px";}
table.children('colgroup').insertBefore(table.children('thead'));divBody.scroll();if((settings.bSorted||settings.bFiltered)&&!settings._drawHold){divBodyEl.scrollTop=0;}}
function _fnApplyToChildren(fn,an1,an2)
{var index=0,i=0,iLen=an1.length;var nNode1,nNode2;while(i<iLen){nNode1=an1[i].firstChild;nNode2=an2?an2[i].firstChild:null;while(nNode1){if(nNode1.nodeType===1){if(an2){fn(nNode1,nNode2,index);}
else{fn(nNode1,index);}
index++;}
nNode1=nNode1.nextSibling;nNode2=an2?nNode2.nextSibling:null;}
i++;}}
var __re_html_remove=/<.*?>/g;function _fnCalculateColumnWidths(oSettings)
{var
table=oSettings.nTable,columns=oSettings.aoColumns,scroll=oSettings.oScroll,scrollY=scroll.sY,scrollX=scroll.sX,scrollXInner=scroll.sXInner,columnCount=columns.length,visibleColumns=_fnGetColumns(oSettings,'bVisible'),headerCells=$('th',oSettings.nTHead),tableWidthAttr=table.getAttribute('width'),tableContainer=table.parentNode,userInputs=false,i,column,columnIdx,width,outerWidth,browser=oSettings.oBrowser,ie67=browser.bScrollOversize;var styleWidth=table.style.width;if(styleWidth&&styleWidth.indexOf('%')!==-1){tableWidthAttr=styleWidth;}
for(i=0;i<visibleColumns.length;i++){column=columns[visibleColumns[i]];if(column.sWidth!==null){column.sWidth=_fnConvertToWidth(column.sWidthOrig,tableContainer);userInputs=true;}}
if(ie67||!userInputs&&!scrollX&&!scrollY&&columnCount==_fnVisbleColumns(oSettings)&&columnCount==headerCells.length){for(i=0;i<columnCount;i++){var colIdx=_fnVisibleToColumnIndex(oSettings,i);if(colIdx!==null){columns[colIdx].sWidth=_fnStringToCss(headerCells.eq(i).width());}}}
else
{var tmpTable=$(table).clone().css('visibility','hidden').removeAttr('id');tmpTable.find('tbody tr').remove();var tr=$('<tr/>').appendTo(tmpTable.find('tbody'));tmpTable.find('thead, tfoot').remove();tmpTable.append($(oSettings.nTHead).clone()).append($(oSettings.nTFoot).clone());tmpTable.find('tfoot th, tfoot td').css('width','');headerCells=_fnGetUniqueThs(oSettings,tmpTable.find('thead')[0]);for(i=0;i<visibleColumns.length;i++){column=columns[visibleColumns[i]];headerCells[i].style.width=column.sWidthOrig!==null&&column.sWidthOrig!==''?_fnStringToCss(column.sWidthOrig):'';if(column.sWidthOrig&&scrollX){$(headerCells[i]).append($('<div/>').css({width:column.sWidthOrig,margin:0,padding:0,border:0,height:1}));}}
if(oSettings.aoData.length){for(i=0;i<visibleColumns.length;i++){columnIdx=visibleColumns[i];column=columns[columnIdx];$(_fnGetWidestNode(oSettings,columnIdx)).clone(false).append(column.sContentPadding).appendTo(tr);}}
$('[name]',tmpTable).removeAttr('name');var holder=$('<div/>').css(scrollX||scrollY?{position:'absolute',top:0,left:0,height:1,right:0,overflow:'hidden'}:{}).append(tmpTable).appendTo(tableContainer);if(scrollX&&scrollXInner){tmpTable.width(scrollXInner);}
else if(scrollX){tmpTable.css('width','auto');tmpTable.removeAttr('width');if(tmpTable.width()<tableContainer.clientWidth&&tableWidthAttr){tmpTable.width(tableContainer.clientWidth);}}
else if(scrollY){tmpTable.width(tableContainer.clientWidth);}
else if(tableWidthAttr){tmpTable.width(tableWidthAttr);}
var total=0;for(i=0;i<visibleColumns.length;i++){var cell=$(headerCells[i]);var border=cell.outerWidth()-cell.width();var bounding=browser.bBounding?Math.ceil(headerCells[i].getBoundingClientRect().width):cell.outerWidth();total+=bounding;columns[visibleColumns[i]].sWidth=_fnStringToCss(bounding-border);}
table.style.width=_fnStringToCss(total);holder.remove();}
if(tableWidthAttr){table.style.width=_fnStringToCss(tableWidthAttr);}
if((tableWidthAttr||scrollX)&&!oSettings._reszEvt){var bindResize=function(){$(window).bind('resize.DT-'+oSettings.sInstance,_fnThrottle(function(){_fnAdjustColumnSizing(oSettings);}));};if(ie67){setTimeout(bindResize,1000);}
else{bindResize();}
oSettings._reszEvt=true;}}
var _fnThrottle=DataTable.util.throttle;function _fnConvertToWidth(width,parent)
{if(!width){return 0;}
var n=$('<div/>').css('width',_fnStringToCss(width)).appendTo(parent||document.body);var val=n[0].offsetWidth;n.remove();return val;}
function _fnGetWidestNode(settings,colIdx)
{var idx=_fnGetMaxLenString(settings,colIdx);if(idx<0){return null;}
var data=settings.aoData[idx];return!data.nTr?$('<td/>').html(_fnGetCellData(settings,idx,colIdx,'display'))[0]:data.anCells[colIdx];}
function _fnGetMaxLenString(settings,colIdx)
{var s,max=-1,maxIdx=-1;for(var i=0,ien=settings.aoData.length;i<ien;i++){s=_fnGetCellData(settings,i,colIdx,'display')+'';s=s.replace(__re_html_remove,'');s=s.replace(/&nbsp;/g,' ');if(s.length>max){max=s.length;maxIdx=i;}}
return maxIdx;}
function _fnStringToCss(s)
{if(s===null){return'0px';}
if(typeof s=='number'){return s<0?'0px':s+'px';}
return s.match(/\d$/)?s+'px':s;}
function _fnSortFlatten(settings)
{var
i,iLen,k,kLen,aSort=[],aiOrig=[],aoColumns=settings.aoColumns,aDataSort,iCol,sType,srcCol,fixed=settings.aaSortingFixed,fixedObj=$.isPlainObject(fixed),nestedSort=[],add=function(a){if(a.length&&!$.isArray(a[0])){nestedSort.push(a);}
else{$.merge(nestedSort,a);}};if($.isArray(fixed)){add(fixed);}
if(fixedObj&&fixed.pre){add(fixed.pre);}
add(settings.aaSorting);if(fixedObj&&fixed.post){add(fixed.post);}
for(i=0;i<nestedSort.length;i++)
{srcCol=nestedSort[i][0];aDataSort=aoColumns[srcCol].aDataSort;for(k=0,kLen=aDataSort.length;k<kLen;k++)
{iCol=aDataSort[k];sType=aoColumns[iCol].sType||'string';if(nestedSort[i]._idx===undefined){nestedSort[i]._idx=$.inArray(nestedSort[i][1],aoColumns[iCol].asSorting);}
aSort.push({src:srcCol,col:iCol,dir:nestedSort[i][1],index:nestedSort[i]._idx,type:sType,formatter:DataTable.ext.type.order[sType+"-pre"]});}}
return aSort;}
function _fnSort(oSettings)
{var
i,ien,iLen,j,jLen,k,kLen,sDataType,nTh,aiOrig=[],oExtSort=DataTable.ext.type.order,aoData=oSettings.aoData,aoColumns=oSettings.aoColumns,aDataSort,data,iCol,sType,oSort,formatters=0,sortCol,displayMaster=oSettings.aiDisplayMaster,aSort;_fnColumnTypes(oSettings);aSort=_fnSortFlatten(oSettings);for(i=0,ien=aSort.length;i<ien;i++){sortCol=aSort[i];if(sortCol.formatter){formatters++;}
_fnSortData(oSettings,sortCol.col);}
if(_fnDataSource(oSettings)!='ssp'&&aSort.length!==0)
{for(i=0,iLen=displayMaster.length;i<iLen;i++){aiOrig[displayMaster[i]]=i;}
if(formatters===aSort.length){displayMaster.sort(function(a,b){var
x,y,k,test,sort,len=aSort.length,dataA=aoData[a]._aSortData,dataB=aoData[b]._aSortData;for(k=0;k<len;k++){sort=aSort[k];x=dataA[sort.col];y=dataB[sort.col];test=x<y?-1:x>y?1:0;if(test!==0){return sort.dir==='asc'?test:-test;}}
x=aiOrig[a];y=aiOrig[b];return x<y?-1:x>y?1:0;});}
else{displayMaster.sort(function(a,b){var
x,y,k,l,test,sort,fn,len=aSort.length,dataA=aoData[a]._aSortData,dataB=aoData[b]._aSortData;for(k=0;k<len;k++){sort=aSort[k];x=dataA[sort.col];y=dataB[sort.col];fn=oExtSort[sort.type+"-"+sort.dir]||oExtSort["string-"+sort.dir];test=fn(x,y);if(test!==0){return test;}}
x=aiOrig[a];y=aiOrig[b];return x<y?-1:x>y?1:0;});}}
oSettings.bSorted=true;}
function _fnSortAria(settings)
{var label;var nextSort;var columns=settings.aoColumns;var aSort=_fnSortFlatten(settings);var oAria=settings.oLanguage.oAria;for(var i=0,iLen=columns.length;i<iLen;i++)
{var col=columns[i];var asSorting=col.asSorting;var sTitle=col.sTitle.replace(/<.*?>/g,"");var th=col.nTh;th.removeAttribute('aria-sort');if(col.bSortable){if(aSort.length>0&&aSort[0].col==i){th.setAttribute('aria-sort',aSort[0].dir=="asc"?"ascending":"descending");nextSort=asSorting[aSort[0].index+1]||asSorting[0];}
else{nextSort=asSorting[0];}
label=sTitle+(nextSort==="asc"?oAria.sSortAscending:oAria.sSortDescending);}
else{label=sTitle;}
th.setAttribute('aria-label',label);}}
function _fnSortListener(settings,colIdx,append,callback)
{var col=settings.aoColumns[colIdx];var sorting=settings.aaSorting;var asSorting=col.asSorting;var nextSortIdx;var next=function(a,overflow){var idx=a._idx;if(idx===undefined){idx=$.inArray(a[1],asSorting);}
return idx+1<asSorting.length?idx+1:overflow?null:0;};if(typeof sorting[0]==='number'){sorting=settings.aaSorting=[sorting];}
if(append&&settings.oFeatures.bSortMulti){var sortIdx=$.inArray(colIdx,_pluck(sorting,'0'));if(sortIdx!==-1){nextSortIdx=next(sorting[sortIdx],true);if(nextSortIdx===null&&sorting.length===1){nextSortIdx=0;}
if(nextSortIdx===null){sorting.splice(sortIdx,1);}
else{sorting[sortIdx][1]=asSorting[nextSortIdx];sorting[sortIdx]._idx=nextSortIdx;}}
else{sorting.push([colIdx,asSorting[0],0]);sorting[sorting.length-1]._idx=0;}}
else if(sorting.length&&sorting[0][0]==colIdx){nextSortIdx=next(sorting[0]);sorting.length=1;sorting[0][1]=asSorting[nextSortIdx];sorting[0]._idx=nextSortIdx;}
else{sorting.length=0;sorting.push([colIdx,asSorting[0]]);sorting[0]._idx=0;}
_fnReDraw(settings);if(typeof callback=='function'){callback(settings);}}
function _fnSortAttachListener(settings,attachTo,colIdx,callback)
{var col=settings.aoColumns[colIdx];_fnBindAction(attachTo,{},function(e){if(col.bSortable===false){return;}
if(settings.oFeatures.bProcessing){_fnProcessingDisplay(settings,true);setTimeout(function(){_fnSortListener(settings,colIdx,e.shiftKey,callback);if(_fnDataSource(settings)!=='ssp'){_fnProcessingDisplay(settings,false);}},0);}
else{_fnSortListener(settings,colIdx,e.shiftKey,callback);}});}
function _fnSortingClasses(settings)
{var oldSort=settings.aLastSort;var sortClass=settings.oClasses.sSortColumn;var sort=_fnSortFlatten(settings);var features=settings.oFeatures;var i,ien,colIdx;if(features.bSort&&features.bSortClasses){for(i=0,ien=oldSort.length;i<ien;i++){colIdx=oldSort[i].src;$(_pluck(settings.aoData,'anCells',colIdx)).removeClass(sortClass+(i<2?i+1:3));}
for(i=0,ien=sort.length;i<ien;i++){colIdx=sort[i].src;$(_pluck(settings.aoData,'anCells',colIdx)).addClass(sortClass+(i<2?i+1:3));}}
settings.aLastSort=sort;}
function _fnSortData(settings,idx)
{var column=settings.aoColumns[idx];var customSort=DataTable.ext.order[column.sSortDataType];var customData;if(customSort){customData=customSort.call(settings.oInstance,settings,idx,_fnColumnIndexToVisible(settings,idx));}
var row,cellData;var formatter=DataTable.ext.type.order[column.sType+"-pre"];for(var i=0,ien=settings.aoData.length;i<ien;i++){row=settings.aoData[i];if(!row._aSortData){row._aSortData=[];}
if(!row._aSortData[idx]||customSort){cellData=customSort?customData[i]:_fnGetCellData(settings,i,idx,'sort');row._aSortData[idx]=formatter?formatter(cellData):cellData;}}}
function _fnSaveState(settings)
{if(!settings.oFeatures.bStateSave||settings.bDestroying)
{return;}
var state={time:+new Date(),start:settings._iDisplayStart,length:settings._iDisplayLength,order:$.extend(true,[],settings.aaSorting),search:_fnSearchToCamel(settings.oPreviousSearch),columns:$.map(settings.aoColumns,function(col,i){return{visible:col.bVisible,search:_fnSearchToCamel(settings.aoPreSearchCols[i])};})};_fnCallbackFire(settings,"aoStateSaveParams",'stateSaveParams',[settings,state]);settings.oSavedState=state;settings.fnStateSaveCallback.call(settings.oInstance,settings,state);}
function _fnLoadState(settings,oInit)
{var i,ien;var columns=settings.aoColumns;if(!settings.oFeatures.bStateSave){return;}
var state=settings.fnStateLoadCallback.call(settings.oInstance,settings);if(!state||!state.time){return;}
var abStateLoad=_fnCallbackFire(settings,'aoStateLoadParams','stateLoadParams',[settings,state]);if($.inArray(false,abStateLoad)!==-1){return;}
var duration=settings.iStateDuration;if(duration>0&&state.time<+new Date()-(duration*1000)){return;}
if(columns.length!==state.columns.length){return;}
settings.oLoadedState=$.extend(true,{},state);if(state.start!==undefined){settings._iDisplayStart=state.start;settings.iInitDisplayStart=state.start;}
if(state.length!==undefined){settings._iDisplayLength=state.length;}
if(state.order!==undefined){settings.aaSorting=[];$.each(state.order,function(i,col){settings.aaSorting.push(col[0]>=columns.length?[0,col[1]]:col);});}
if(state.search!==undefined){$.extend(settings.oPreviousSearch,_fnSearchToHung(state.search));}
for(i=0,ien=state.columns.length;i<ien;i++){var col=state.columns[i];if(col.visible!==undefined){columns[i].bVisible=col.visible;}
if(col.search!==undefined){$.extend(settings.aoPreSearchCols[i],_fnSearchToHung(col.search));}}
_fnCallbackFire(settings,'aoStateLoaded','stateLoaded',[settings,state]);}
function _fnSettingsFromNode(table)
{var settings=DataTable.settings;var idx=$.inArray(table,_pluck(settings,'nTable'));return idx!==-1?settings[idx]:null;}
function _fnLog(settings,level,msg,tn)
{msg='DataTables warning: '+
(settings?'table id='+settings.sTableId+' - ':'')+msg;if(tn){msg+='. For more information about this error, please see '+'http://datatables.net/tn/'+tn;}
if(!level){var ext=DataTable.ext;var type=ext.sErrMode||ext.errMode;if(settings){_fnCallbackFire(settings,null,'error',[settings,tn,msg]);}
if(type=='alert'){alert(msg);}
else if(type=='throw'){throw new Error(msg);}
else if(typeof type=='function'){type(settings,tn,msg);}}
else if(window.console&&console.log){console.log(msg);}}
function _fnMap(ret,src,name,mappedName)
{if($.isArray(name)){$.each(name,function(i,val){if($.isArray(val)){_fnMap(ret,src,val[0],val[1]);}
else{_fnMap(ret,src,val);}});return;}
if(mappedName===undefined){mappedName=name;}
if(src[name]!==undefined){ret[mappedName]=src[name];}}
function _fnExtend(out,extender,breakRefs)
{var val;for(var prop in extender){if(extender.hasOwnProperty(prop)){val=extender[prop];if($.isPlainObject(val)){if(!$.isPlainObject(out[prop])){out[prop]={};}
$.extend(true,out[prop],val);}
else if(breakRefs&&prop!=='data'&&prop!=='aaData'&&$.isArray(val)){out[prop]=val.slice();}
else{out[prop]=val;}}}
return out;}
function _fnBindAction(n,oData,fn)
{$(n).bind('click.DT',oData,function(e){n.blur();fn(e);}).bind('keypress.DT',oData,function(e){if(e.which===13){e.preventDefault();fn(e);}}).bind('selectstart.DT',function(){return false;});}
function _fnCallbackReg(oSettings,sStore,fn,sName)
{if(fn)
{oSettings[sStore].push({"fn":fn,"sName":sName});}}
function _fnCallbackFire(settings,callbackArr,eventName,args)
{var ret=[];if(callbackArr){ret=$.map(settings[callbackArr].slice().reverse(),function(val,i){return val.fn.apply(settings.oInstance,args);});}
if(eventName!==null){var e=$.Event(eventName+'.dt');$(settings.nTable).trigger(e,args);ret.push(e.result);}
return ret;}
function _fnLengthOverflow(settings)
{var
start=settings._iDisplayStart,end=settings.fnDisplayEnd(),len=settings._iDisplayLength;if(start>=end)
{start=end-len;}
start-=(start%len);if(len===-1||start<0)
{start=0;}
settings._iDisplayStart=start;}
function _fnRenderer(settings,type)
{var renderer=settings.renderer;var host=DataTable.ext.renderer[type];if($.isPlainObject(renderer)&&renderer[type]){return host[renderer[type]]||host._;}
else if(typeof renderer==='string'){return host[renderer]||host._;}
return host._;}
function _fnDataSource(settings)
{if(settings.oFeatures.bServerSide){return'ssp';}
else if(settings.ajax||settings.sAjaxSource){return'ajax';}
return'dom';}
var __apiStruct=[];var __arrayProto=Array.prototype;var _toSettings=function(mixed)
{var idx,jq;var settings=DataTable.settings;var tables=$.map(settings,function(el,i){return el.nTable;});if(!mixed){return[];}
else if(mixed.nTable&&mixed.oApi){return[mixed];}
else if(mixed.nodeName&&mixed.nodeName.toLowerCase()==='table'){idx=$.inArray(mixed,tables);return idx!==-1?[settings[idx]]:null;}
else if(mixed&&typeof mixed.settings==='function'){return mixed.settings().toArray();}
else if(typeof mixed==='string'){jq=$(mixed);}
else if(mixed instanceof $){jq=mixed;}
if(jq){return jq.map(function(i){idx=$.inArray(this,tables);return idx!==-1?settings[idx]:null;}).toArray();}};_Api=function(context,data)
{if(!(this instanceof _Api)){return new _Api(context,data);}
var settings=[];var ctxSettings=function(o){var a=_toSettings(o);if(a){settings=settings.concat(a);}};if($.isArray(context)){for(var i=0,ien=context.length;i<ien;i++){ctxSettings(context[i]);}}
else{ctxSettings(context);}
this.context=_unique(settings);if(data){$.merge(this,data);}
this.selector={rows:null,cols:null,opts:null};_Api.extend(this,this,__apiStruct);};DataTable.Api=_Api;$.extend(_Api.prototype,{any:function()
{return this.count()!==0;},concat:__arrayProto.concat,context:[],count:function()
{return this.flatten().length;},each:function(fn)
{for(var i=0,ien=this.length;i<ien;i++){fn.call(this,this[i],i,this);}
return this;},eq:function(idx)
{var ctx=this.context;return ctx.length>idx?new _Api(ctx[idx],this[idx]):null;},filter:function(fn)
{var a=[];if(__arrayProto.filter){a=__arrayProto.filter.call(this,fn,this);}
else{for(var i=0,ien=this.length;i<ien;i++){if(fn.call(this,this[i],i,this)){a.push(this[i]);}}}
return new _Api(this.context,a);},flatten:function()
{var a=[];return new _Api(this.context,a.concat.apply(a,this.toArray()));},join:__arrayProto.join,indexOf:__arrayProto.indexOf||function(obj,start)
{for(var i=(start||0),ien=this.length;i<ien;i++){if(this[i]===obj){return i;}}
return-1;},iterator:function(flatten,type,fn,alwaysNew){var
a=[],ret,i,ien,j,jen,context=this.context,rows,items,item,selector=this.selector;if(typeof flatten==='string'){alwaysNew=fn;fn=type;type=flatten;flatten=false;}
for(i=0,ien=context.length;i<ien;i++){var apiInst=new _Api(context[i]);if(type==='table'){ret=fn.call(apiInst,context[i],i);if(ret!==undefined){a.push(ret);}}
else if(type==='columns'||type==='rows'){ret=fn.call(apiInst,context[i],this[i],i);if(ret!==undefined){a.push(ret);}}
else if(type==='column'||type==='column-rows'||type==='row'||type==='cell'){items=this[i];if(type==='column-rows'){rows=_selector_row_indexes(context[i],selector.opts);}
for(j=0,jen=items.length;j<jen;j++){item=items[j];if(type==='cell'){ret=fn.call(apiInst,context[i],item.row,item.column,i,j);}
else{ret=fn.call(apiInst,context[i],item,i,j,rows);}
if(ret!==undefined){a.push(ret);}}}}
if(a.length||alwaysNew){var api=new _Api(context,flatten?a.concat.apply([],a):a);var apiSelector=api.selector;apiSelector.rows=selector.rows;apiSelector.cols=selector.cols;apiSelector.opts=selector.opts;return api;}
return this;},lastIndexOf:__arrayProto.lastIndexOf||function(obj,start)
{return this.indexOf.apply(this.toArray.reverse(),arguments);},length:0,map:function(fn)
{var a=[];if(__arrayProto.map){a=__arrayProto.map.call(this,fn,this);}
else{for(var i=0,ien=this.length;i<ien;i++){a.push(fn.call(this,this[i],i));}}
return new _Api(this.context,a);},pluck:function(prop)
{return this.map(function(el){return el[prop];});},pop:__arrayProto.pop,push:__arrayProto.push,reduce:__arrayProto.reduce||function(fn,init)
{return _fnReduce(this,fn,init,0,this.length,1);},reduceRight:__arrayProto.reduceRight||function(fn,init)
{return _fnReduce(this,fn,init,this.length-1,-1,-1);},reverse:__arrayProto.reverse,selector:null,shift:__arrayProto.shift,sort:__arrayProto.sort,splice:__arrayProto.splice,toArray:function()
{return __arrayProto.slice.call(this);},to$:function()
{return $(this);},toJQuery:function()
{return $(this);},unique:function()
{return new _Api(this.context,_unique(this));},unshift:__arrayProto.unshift});_Api.extend=function(scope,obj,ext)
{if(!ext.length||!obj||(!(obj instanceof _Api)&&!obj.__dt_wrapper)){return;}
var
i,ien,j,jen,struct,inner,methodScoping=function(scope,fn,struc){return function(){var ret=fn.apply(scope,arguments);_Api.extend(ret,ret,struc.methodExt);return ret;};};for(i=0,ien=ext.length;i<ien;i++){struct=ext[i];obj[struct.name]=typeof struct.val==='function'?methodScoping(scope,struct.val,struct):$.isPlainObject(struct.val)?{}:struct.val;obj[struct.name].__dt_wrapper=true;_Api.extend(scope,obj[struct.name],struct.propExt);}};_Api.register=_api_register=function(name,val)
{if($.isArray(name)){for(var j=0,jen=name.length;j<jen;j++){_Api.register(name[j],val);}
return;}
var
i,ien,heir=name.split('.'),struct=__apiStruct,key,method;var find=function(src,name){for(var i=0,ien=src.length;i<ien;i++){if(src[i].name===name){return src[i];}}
return null;};for(i=0,ien=heir.length;i<ien;i++){method=heir[i].indexOf('()')!==-1;key=method?heir[i].replace('()',''):heir[i];var src=find(struct,key);if(!src){src={name:key,val:{},methodExt:[],propExt:[]};struct.push(src);}
if(i===ien-1){src.val=val;}
else{struct=method?src.methodExt:src.propExt;}}};_Api.registerPlural=_api_registerPlural=function(pluralName,singularName,val){_Api.register(pluralName,val);_Api.register(singularName,function(){var ret=val.apply(this,arguments);if(ret===this){return this;}
else if(ret instanceof _Api){return ret.length?$.isArray(ret[0])?new _Api(ret.context,ret[0]):ret[0]:undefined;}
return ret;});};var __table_selector=function(selector,a)
{if(typeof selector==='number'){return[a[selector]];}
var nodes=$.map(a,function(el,i){return el.nTable;});return $(nodes).filter(selector).map(function(i){var idx=$.inArray(this,nodes);return a[idx];}).toArray();};_api_register('tables()',function(selector){return selector?new _Api(__table_selector(selector,this.context)):this;});_api_register('table()',function(selector){var tables=this.tables(selector);var ctx=tables.context;return ctx.length?new _Api(ctx[0]):tables;});_api_registerPlural('tables().nodes()','table().node()',function(){return this.iterator('table',function(ctx){return ctx.nTable;},1);});_api_registerPlural('tables().body()','table().body()',function(){return this.iterator('table',function(ctx){return ctx.nTBody;},1);});_api_registerPlural('tables().header()','table().header()',function(){return this.iterator('table',function(ctx){return ctx.nTHead;},1);});_api_registerPlural('tables().footer()','table().footer()',function(){return this.iterator('table',function(ctx){return ctx.nTFoot;},1);});_api_registerPlural('tables().containers()','table().container()',function(){return this.iterator('table',function(ctx){return ctx.nTableWrapper;},1);});_api_register('draw()',function(paging){return this.iterator('table',function(settings){if(paging==='page'){_fnDraw(settings);}
else{if(typeof paging==='string'){paging=paging==='full-hold'?false:true;}
_fnReDraw(settings,paging===false);}});});_api_register('page()',function(action){if(action===undefined){return this.page.info().page;}
return this.iterator('table',function(settings){_fnPageChange(settings,action);});});_api_register('page.info()',function(action){if(this.context.length===0){return undefined;}
var
settings=this.context[0],start=settings._iDisplayStart,len=settings.oFeatures.bPaginate?settings._iDisplayLength:-1,visRecords=settings.fnRecordsDisplay(),all=len===-1;return{"page":all?0:Math.floor(start/len),"pages":all?1:Math.ceil(visRecords/len),"start":start,"end":settings.fnDisplayEnd(),"length":len,"recordsTotal":settings.fnRecordsTotal(),"recordsDisplay":visRecords,"serverSide":_fnDataSource(settings)==='ssp'};});_api_register('page.len()',function(len){if(len===undefined){return this.context.length!==0?this.context[0]._iDisplayLength:undefined;}
return this.iterator('table',function(settings){_fnLengthChange(settings,len);});});var __reload=function(settings,holdPosition,callback){if(callback){var api=new _Api(settings);api.one('draw',function(){callback(api.ajax.json());});}
if(_fnDataSource(settings)=='ssp'){_fnReDraw(settings,holdPosition);}
else{_fnProcessingDisplay(settings,true);var xhr=settings.jqXHR;if(xhr&&xhr.readyState!==4){xhr.abort();}
_fnBuildAjax(settings,[],function(json){_fnClearTable(settings);var data=_fnAjaxDataSrc(settings,json);for(var i=0,ien=data.length;i<ien;i++){_fnAddData(settings,data[i]);}
_fnReDraw(settings,holdPosition);_fnProcessingDisplay(settings,false);});}};_api_register('ajax.json()',function(){var ctx=this.context;if(ctx.length>0){return ctx[0].json;}});_api_register('ajax.params()',function(){var ctx=this.context;if(ctx.length>0){return ctx[0].oAjaxData;}});_api_register('ajax.reload()',function(callback,resetPaging){return this.iterator('table',function(settings){__reload(settings,resetPaging===false,callback);});});_api_register('ajax.url()',function(url){var ctx=this.context;if(url===undefined){if(ctx.length===0){return undefined;}
ctx=ctx[0];return ctx.ajax?$.isPlainObject(ctx.ajax)?ctx.ajax.url:ctx.ajax:ctx.sAjaxSource;}
return this.iterator('table',function(settings){if($.isPlainObject(settings.ajax)){settings.ajax.url=url;}
else{settings.ajax=url;}});});_api_register('ajax.url().load()',function(callback,resetPaging){return this.iterator('table',function(ctx){__reload(ctx,resetPaging===false,callback);});});var _selector_run=function(type,selector,selectFn,settings,opts)
{var
out=[],res,a,i,ien,j,jen,selectorType=typeof selector;if(!selector||selectorType==='string'||selectorType==='function'||selector.length===undefined){selector=[selector];}
for(i=0,ien=selector.length;i<ien;i++){a=selector[i]&&selector[i].split?selector[i].split(','):[selector[i]];for(j=0,jen=a.length;j<jen;j++){res=selectFn(typeof a[j]==='string'?$.trim(a[j]):a[j]);if(res&&res.length){out=out.concat(res);}}}
var ext=_ext.selector[type];if(ext.length){for(i=0,ien=ext.length;i<ien;i++){out=ext[i](settings,opts,out);}}
return _unique(out);};var _selector_opts=function(opts)
{if(!opts){opts={};}
if(opts.filter&&opts.search===undefined){opts.search=opts.filter;}
return $.extend({search:'none',order:'current',page:'all'},opts);};var _selector_first=function(inst)
{for(var i=0,ien=inst.length;i<ien;i++){if(inst[i].length>0){inst[0]=inst[i];inst[0].length=1;inst.length=1;inst.context=[inst.context[i]];return inst;}}
inst.length=0;return inst;};var _selector_row_indexes=function(settings,opts)
{var
i,ien,tmp,a=[],displayFiltered=settings.aiDisplay,displayMaster=settings.aiDisplayMaster;var
search=opts.search,order=opts.order,page=opts.page;if(_fnDataSource(settings)=='ssp'){return search==='removed'?[]:_range(0,displayMaster.length);}
else if(page=='current'){for(i=settings._iDisplayStart,ien=settings.fnDisplayEnd();i<ien;i++){a.push(displayFiltered[i]);}}
else if(order=='current'||order=='applied'){a=search=='none'?displayMaster.slice():search=='applied'?displayFiltered.slice():$.map(displayMaster,function(el,i){return $.inArray(el,displayFiltered)===-1?el:null;});}
else if(order=='index'||order=='original'){for(i=0,ien=settings.aoData.length;i<ien;i++){if(search=='none'){a.push(i);}
else{tmp=$.inArray(i,displayFiltered);if((tmp===-1&&search=='removed')||(tmp>=0&&search=='applied'))
{a.push(i);}}}}
return a;};var __row_selector=function(settings,selector,opts)
{var run=function(sel){var selInt=_intVal(sel);var i,ien;if(selInt!==null&&!opts){return[selInt];}
var rows=_selector_row_indexes(settings,opts);if(selInt!==null&&$.inArray(selInt,rows)!==-1){return[selInt];}
else if(!sel){return rows;}
if(typeof sel==='function'){return $.map(rows,function(idx){var row=settings.aoData[idx];return sel(idx,row._aData,row.nTr)?idx:null;});}
var nodes=_removeEmpty(_pluck_order(settings.aoData,rows,'nTr'));if(sel.nodeName){if(sel._DT_RowIndex!==undefined){return[sel._DT_RowIndex];}
else if(sel._DT_CellIndex){return[sel._DT_CellIndex.row];}
else{var host=$(sel).closest('*[data-dt-row]');return host.length?[host.data('dt-row')]:[];}}
if(typeof sel==='string'&&sel.charAt(0)==='#'){var rowObj=settings.aIds[sel.replace(/^#/,'')];if(rowObj!==undefined){return[rowObj.idx];}}
return $(nodes).filter(sel).map(function(){return this._DT_RowIndex;}).toArray();};return _selector_run('row',selector,run,settings,opts);};_api_register('rows()',function(selector,opts){if(selector===undefined){selector='';}
else if($.isPlainObject(selector)){opts=selector;selector='';}
opts=_selector_opts(opts);var inst=this.iterator('table',function(settings){return __row_selector(settings,selector,opts);},1);inst.selector.rows=selector;inst.selector.opts=opts;return inst;});_api_register('rows().nodes()',function(){return this.iterator('row',function(settings,row){return settings.aoData[row].nTr||undefined;},1);});_api_register('rows().data()',function(){return this.iterator(true,'rows',function(settings,rows){return _pluck_order(settings.aoData,rows,'_aData');},1);});_api_registerPlural('rows().cache()','row().cache()',function(type){return this.iterator('row',function(settings,row){var r=settings.aoData[row];return type==='search'?r._aFilterData:r._aSortData;},1);});_api_registerPlural('rows().invalidate()','row().invalidate()',function(src){return this.iterator('row',function(settings,row){_fnInvalidate(settings,row,src);});});_api_registerPlural('rows().indexes()','row().index()',function(){return this.iterator('row',function(settings,row){return row;},1);});_api_registerPlural('rows().ids()','row().id()',function(hash){var a=[];var context=this.context;for(var i=0,ien=context.length;i<ien;i++){for(var j=0,jen=this[i].length;j<jen;j++){var id=context[i].rowIdFn(context[i].aoData[this[i][j]]._aData);a.push((hash===true?'#':'')+id);}}
return new _Api(context,a);});_api_registerPlural('rows().remove()','row().remove()',function(){var that=this;this.iterator('row',function(settings,row,thatIdx){var data=settings.aoData;var rowData=data[row];var i,ien,j,jen;var loopRow,loopCells;data.splice(row,1);for(i=0,ien=data.length;i<ien;i++){loopRow=data[i];loopCells=loopRow.anCells;if(loopRow.nTr!==null){loopRow.nTr._DT_RowIndex=i;}
if(loopCells!==null){for(j=0,jen=loopCells.length;j<jen;j++){loopCells[j]._DT_CellIndex.row=i;}}}
_fnDeleteIndex(settings.aiDisplayMaster,row);_fnDeleteIndex(settings.aiDisplay,row);_fnDeleteIndex(that[thatIdx],row,false);_fnLengthOverflow(settings);var id=settings.rowIdFn(rowData._aData);if(id!==undefined){delete settings.aIds[id];}});this.iterator('table',function(settings){for(var i=0,ien=settings.aoData.length;i<ien;i++){settings.aoData[i].idx=i;}});return this;});_api_register('rows.add()',function(rows){var newRows=this.iterator('table',function(settings){var row,i,ien;var out=[];for(i=0,ien=rows.length;i<ien;i++){row=rows[i];if(row.nodeName&&row.nodeName.toUpperCase()==='TR'){out.push(_fnAddTr(settings,row)[0]);}
else{out.push(_fnAddData(settings,row));}}
return out;},1);var modRows=this.rows(-1);modRows.pop();$.merge(modRows,newRows);return modRows;});_api_register('row()',function(selector,opts){return _selector_first(this.rows(selector,opts));});_api_register('row().data()',function(data){var ctx=this.context;if(data===undefined){return ctx.length&&this.length?ctx[0].aoData[this[0]]._aData:undefined;}
ctx[0].aoData[this[0]]._aData=data;_fnInvalidate(ctx[0],this[0],'data');return this;});_api_register('row().node()',function(){var ctx=this.context;return ctx.length&&this.length?ctx[0].aoData[this[0]].nTr||null:null;});_api_register('row.add()',function(row){if(row instanceof $&&row.length){row=row[0];}
var rows=this.iterator('table',function(settings){if(row.nodeName&&row.nodeName.toUpperCase()==='TR'){return _fnAddTr(settings,row)[0];}
return _fnAddData(settings,row);});return this.row(rows[0]);});var __details_add=function(ctx,row,data,klass)
{var rows=[];var addRow=function(r,k){if($.isArray(r)||r instanceof $){for(var i=0,ien=r.length;i<ien;i++){addRow(r[i],k);}
return;}
if(r.nodeName&&r.nodeName.toLowerCase()==='tr'){rows.push(r);}
else{var created=$('<tr><td/></tr>').addClass(k);$('td',created).addClass(k).html(r)
[0].colSpan=_fnVisbleColumns(ctx);rows.push(created[0]);}};addRow(data,klass);if(row._details){row._details.remove();}
row._details=$(rows);if(row._detailsShow){row._details.insertAfter(row.nTr);}};var __details_remove=function(api,idx)
{var ctx=api.context;if(ctx.length){var row=ctx[0].aoData[idx!==undefined?idx:api[0]];if(row&&row._details){row._details.remove();row._detailsShow=undefined;row._details=undefined;}}};var __details_display=function(api,show){var ctx=api.context;if(ctx.length&&api.length){var row=ctx[0].aoData[api[0]];if(row._details){row._detailsShow=show;if(show){row._details.insertAfter(row.nTr);}
else{row._details.detach();}
__details_events(ctx[0]);}}};var __details_events=function(settings)
{var api=new _Api(settings);var namespace='.dt.DT_details';var drawEvent='draw'+namespace;var colvisEvent='column-visibility'+namespace;var destroyEvent='destroy'+namespace;var data=settings.aoData;api.off(drawEvent+' '+colvisEvent+' '+destroyEvent);if(_pluck(data,'_details').length>0){api.on(drawEvent,function(e,ctx){if(settings!==ctx){return;}
api.rows({page:'current'}).eq(0).each(function(idx){var row=data[idx];if(row._detailsShow){row._details.insertAfter(row.nTr);}});});api.on(colvisEvent,function(e,ctx,idx,vis){if(settings!==ctx){return;}
var row,visible=_fnVisbleColumns(ctx);for(var i=0,ien=data.length;i<ien;i++){row=data[i];if(row._details){row._details.children('td[colspan]').attr('colspan',visible);}}});api.on(destroyEvent,function(e,ctx){if(settings!==ctx){return;}
for(var i=0,ien=data.length;i<ien;i++){if(data[i]._details){__details_remove(api,i);}}});}};var _emp='';var _child_obj=_emp+'row().child';var _child_mth=_child_obj+'()';_api_register(_child_mth,function(data,klass){var ctx=this.context;if(data===undefined){return ctx.length&&this.length?ctx[0].aoData[this[0]]._details:undefined;}
else if(data===true){this.child.show();}
else if(data===false){__details_remove(this);}
else if(ctx.length&&this.length){__details_add(ctx[0],ctx[0].aoData[this[0]],data,klass);}
return this;});_api_register([_child_obj+'.show()',_child_mth+'.show()'],function(show){__details_display(this,true);return this;});_api_register([_child_obj+'.hide()',_child_mth+'.hide()'],function(){__details_display(this,false);return this;});_api_register([_child_obj+'.remove()',_child_mth+'.remove()'],function(){__details_remove(this);return this;});_api_register(_child_obj+'.isShown()',function(){var ctx=this.context;if(ctx.length&&this.length){return ctx[0].aoData[this[0]]._detailsShow||false;}
return false;});var __re_column_selector=/^(.+):(name|visIdx|visible)$/;var __columnData=function(settings,column,r1,r2,rows){var a=[];for(var row=0,ien=rows.length;row<ien;row++){a.push(_fnGetCellData(settings,rows[row],column));}
return a;};var __column_selector=function(settings,selector,opts)
{var
columns=settings.aoColumns,names=_pluck(columns,'sName'),nodes=_pluck(columns,'nTh');var run=function(s){var selInt=_intVal(s);if(s===''){return _range(columns.length);}
if(selInt!==null){return[selInt>=0?selInt:columns.length+selInt];}
if(typeof s==='function'){var rows=_selector_row_indexes(settings,opts);return $.map(columns,function(col,idx){return s(idx,__columnData(settings,idx,0,0,rows),nodes[idx])?idx:null;});}
var match=typeof s==='string'?s.match(__re_column_selector):'';if(match){switch(match[2]){case'visIdx':case'visible':var idx=parseInt(match[1],10);if(idx<0){var visColumns=$.map(columns,function(col,i){return col.bVisible?i:null;});return[visColumns[visColumns.length+idx]];}
return[_fnVisibleToColumnIndex(settings,idx)];case'name':return $.map(names,function(name,i){return name===match[1]?i:null;});default:return[];}}
if(s.nodeName&&s._DT_CellIndex){return[s._DT_CellIndex.column];}
var jqResult=$(nodes).filter(s).map(function(){return $.inArray(this,nodes);}).toArray();if(jqResult.length||!s.nodeName){return jqResult;}
var host=$(s).closest('*[data-dt-column]');return host.length?[host.data('dt-column')]:[];};return _selector_run('column',selector,run,settings,opts);};var __setColumnVis=function(settings,column,vis){var
cols=settings.aoColumns,col=cols[column],data=settings.aoData,row,cells,i,ien,tr;if(vis===undefined){return col.bVisible;}
if(col.bVisible===vis){return;}
if(vis){var insertBefore=$.inArray(true,_pluck(cols,'bVisible'),column+1);for(i=0,ien=data.length;i<ien;i++){tr=data[i].nTr;cells=data[i].anCells;if(tr){tr.insertBefore(cells[column],cells[insertBefore]||null);}}}
else{$(_pluck(settings.aoData,'anCells',column)).detach();}
col.bVisible=vis;_fnDrawHead(settings,settings.aoHeader);_fnDrawHead(settings,settings.aoFooter);_fnSaveState(settings);};_api_register('columns()',function(selector,opts){if(selector===undefined){selector='';}
else if($.isPlainObject(selector)){opts=selector;selector='';}
opts=_selector_opts(opts);var inst=this.iterator('table',function(settings){return __column_selector(settings,selector,opts);},1);inst.selector.cols=selector;inst.selector.opts=opts;return inst;});_api_registerPlural('columns().header()','column().header()',function(selector,opts){return this.iterator('column',function(settings,column){return settings.aoColumns[column].nTh;},1);});_api_registerPlural('columns().footer()','column().footer()',function(selector,opts){return this.iterator('column',function(settings,column){return settings.aoColumns[column].nTf;},1);});_api_registerPlural('columns().data()','column().data()',function(){return this.iterator('column-rows',__columnData,1);});_api_registerPlural('columns().dataSrc()','column().dataSrc()',function(){return this.iterator('column',function(settings,column){return settings.aoColumns[column].mData;},1);});_api_registerPlural('columns().cache()','column().cache()',function(type){return this.iterator('column-rows',function(settings,column,i,j,rows){return _pluck_order(settings.aoData,rows,type==='search'?'_aFilterData':'_aSortData',column);},1);});_api_registerPlural('columns().nodes()','column().nodes()',function(){return this.iterator('column-rows',function(settings,column,i,j,rows){return _pluck_order(settings.aoData,rows,'anCells',column);},1);});_api_registerPlural('columns().visible()','column().visible()',function(vis,calc){var ret=this.iterator('column',function(settings,column){if(vis===undefined){return settings.aoColumns[column].bVisible;}
__setColumnVis(settings,column,vis);});if(vis!==undefined){this.iterator('column',function(settings,column){_fnCallbackFire(settings,null,'column-visibility',[settings,column,vis,calc]);});if(calc===undefined||calc){this.columns.adjust();}}
return ret;});_api_registerPlural('columns().indexes()','column().index()',function(type){return this.iterator('column',function(settings,column){return type==='visible'?_fnColumnIndexToVisible(settings,column):column;},1);});_api_register('columns.adjust()',function(){return this.iterator('table',function(settings){_fnAdjustColumnSizing(settings);},1);});_api_register('column.index()',function(type,idx){if(this.context.length!==0){var ctx=this.context[0];if(type==='fromVisible'||type==='toData'){return _fnVisibleToColumnIndex(ctx,idx);}
else if(type==='fromData'||type==='toVisible'){return _fnColumnIndexToVisible(ctx,idx);}}});_api_register('column()',function(selector,opts){return _selector_first(this.columns(selector,opts));});var __cell_selector=function(settings,selector,opts)
{var data=settings.aoData;var rows=_selector_row_indexes(settings,opts);var cells=_removeEmpty(_pluck_order(data,rows,'anCells'));var allCells=$([].concat.apply([],cells));var row;var columns=settings.aoColumns.length;var a,i,ien,j,o,host;var run=function(s){var fnSelector=typeof s==='function';if(s===null||s===undefined||fnSelector){a=[];for(i=0,ien=rows.length;i<ien;i++){row=rows[i];for(j=0;j<columns;j++){o={row:row,column:j};if(fnSelector){host=data[row];if(s(o,_fnGetCellData(settings,row,j),host.anCells?host.anCells[j]:null)){a.push(o);}}
else{a.push(o);}}}
return a;}
if($.isPlainObject(s)){return[s];}
var jqResult=allCells.filter(s).map(function(i,el){return{row:el._DT_CellIndex.row,column:el._DT_CellIndex.column};}).toArray();if(jqResult.length||!s.nodeName){return jqResult;}
host=$(s).closest('*[data-dt-row]');return host.length?[{row:host.data('dt-row'),column:host.data('dt-column')}]:[];};return _selector_run('cell',selector,run,settings,opts);};_api_register('cells()',function(rowSelector,columnSelector,opts){if($.isPlainObject(rowSelector)){if(rowSelector.row===undefined){opts=rowSelector;rowSelector=null;}
else{opts=columnSelector;columnSelector=null;}}
if($.isPlainObject(columnSelector)){opts=columnSelector;columnSelector=null;}
if(columnSelector===null||columnSelector===undefined){return this.iterator('table',function(settings){return __cell_selector(settings,rowSelector,_selector_opts(opts));});}
var columns=this.columns(columnSelector,opts);var rows=this.rows(rowSelector,opts);var a,i,ien,j,jen;var cells=this.iterator('table',function(settings,idx){a=[];for(i=0,ien=rows[idx].length;i<ien;i++){for(j=0,jen=columns[idx].length;j<jen;j++){a.push({row:rows[idx][i],column:columns[idx][j]});}}
return a;},1);$.extend(cells.selector,{cols:columnSelector,rows:rowSelector,opts:opts});return cells;});_api_registerPlural('cells().nodes()','cell().node()',function(){return this.iterator('cell',function(settings,row,column){var data=settings.aoData[row];return data&&data.anCells?data.anCells[column]:undefined;},1);});_api_register('cells().data()',function(){return this.iterator('cell',function(settings,row,column){return _fnGetCellData(settings,row,column);},1);});_api_registerPlural('cells().cache()','cell().cache()',function(type){type=type==='search'?'_aFilterData':'_aSortData';return this.iterator('cell',function(settings,row,column){return settings.aoData[row][type][column];},1);});_api_registerPlural('cells().render()','cell().render()',function(type){return this.iterator('cell',function(settings,row,column){return _fnGetCellData(settings,row,column,type);},1);});_api_registerPlural('cells().indexes()','cell().index()',function(){return this.iterator('cell',function(settings,row,column){return{row:row,column:column,columnVisible:_fnColumnIndexToVisible(settings,column)};},1);});_api_registerPlural('cells().invalidate()','cell().invalidate()',function(src){return this.iterator('cell',function(settings,row,column){_fnInvalidate(settings,row,src,column);});});_api_register('cell()',function(rowSelector,columnSelector,opts){return _selector_first(this.cells(rowSelector,columnSelector,opts));});_api_register('cell().data()',function(data){var ctx=this.context;var cell=this[0];if(data===undefined){return ctx.length&&cell.length?_fnGetCellData(ctx[0],cell[0].row,cell[0].column):undefined;}
_fnSetCellData(ctx[0],cell[0].row,cell[0].column,data);_fnInvalidate(ctx[0],cell[0].row,'data',cell[0].column);return this;});_api_register('order()',function(order,dir){var ctx=this.context;if(order===undefined){return ctx.length!==0?ctx[0].aaSorting:undefined;}
if(typeof order==='number'){order=[[order,dir]];}
else if(order.length&&!$.isArray(order[0])){order=Array.prototype.slice.call(arguments);}
return this.iterator('table',function(settings){settings.aaSorting=order.slice();});});_api_register('order.listener()',function(node,column,callback){return this.iterator('table',function(settings){_fnSortAttachListener(settings,node,column,callback);});});_api_register('order.fixed()',function(set){if(!set){var ctx=this.context;var fixed=ctx.length?ctx[0].aaSortingFixed:undefined;return $.isArray(fixed)?{pre:fixed}:fixed;}
return this.iterator('table',function(settings){settings.aaSortingFixed=$.extend(true,{},set);});});_api_register(['columns().order()','column().order()'],function(dir){var that=this;return this.iterator('table',function(settings,i){var sort=[];$.each(that[i],function(j,col){sort.push([col,dir]);});settings.aaSorting=sort;});});_api_register('search()',function(input,regex,smart,caseInsen){var ctx=this.context;if(input===undefined){return ctx.length!==0?ctx[0].oPreviousSearch.sSearch:undefined;}
return this.iterator('table',function(settings){if(!settings.oFeatures.bFilter){return;}
_fnFilterComplete(settings,$.extend({},settings.oPreviousSearch,{"sSearch":input+"","bRegex":regex===null?false:regex,"bSmart":smart===null?true:smart,"bCaseInsensitive":caseInsen===null?true:caseInsen}),1);});});_api_registerPlural('columns().search()','column().search()',function(input,regex,smart,caseInsen){return this.iterator('column',function(settings,column){var preSearch=settings.aoPreSearchCols;if(input===undefined){return preSearch[column].sSearch;}
if(!settings.oFeatures.bFilter){return;}
$.extend(preSearch[column],{"sSearch":input+"","bRegex":regex===null?false:regex,"bSmart":smart===null?true:smart,"bCaseInsensitive":caseInsen===null?true:caseInsen});_fnFilterComplete(settings,settings.oPreviousSearch,1);});});_api_register('state()',function(){return this.context.length?this.context[0].oSavedState:null;});_api_register('state.clear()',function(){return this.iterator('table',function(settings){settings.fnStateSaveCallback.call(settings.oInstance,settings,{});});});_api_register('state.loaded()',function(){return this.context.length?this.context[0].oLoadedState:null;});_api_register('state.save()',function(){return this.iterator('table',function(settings){_fnSaveState(settings);});});DataTable.versionCheck=DataTable.fnVersionCheck=function(version)
{var aThis=DataTable.version.split('.');var aThat=version.split('.');var iThis,iThat;for(var i=0,iLen=aThat.length;i<iLen;i++){iThis=parseInt(aThis[i],10)||0;iThat=parseInt(aThat[i],10)||0;if(iThis===iThat){continue;}
return iThis>iThat;}
return true;};DataTable.isDataTable=DataTable.fnIsDataTable=function(table)
{var t=$(table).get(0);var is=false;$.each(DataTable.settings,function(i,o){var head=o.nScrollHead?$('table',o.nScrollHead)[0]:null;var foot=o.nScrollFoot?$('table',o.nScrollFoot)[0]:null;if(o.nTable===t||head===t||foot===t){is=true;}});return is;};DataTable.tables=DataTable.fnTables=function(visible)
{var api=false;if($.isPlainObject(visible)){api=visible.api;visible=visible.visible;}
var a=$.map(DataTable.settings,function(o){if(!visible||(visible&&$(o.nTable).is(':visible'))){return o.nTable;}});return api?new _Api(a):a;};DataTable.camelToHungarian=_fnCamelToHungarian;_api_register('$()',function(selector,opts){var
rows=this.rows(opts).nodes(),jqRows=$(rows);return $([].concat(jqRows.filter(selector).toArray(),jqRows.find(selector).toArray()));});$.each(['on','one','off'],function(i,key){_api_register(key+'()',function(){var args=Array.prototype.slice.call(arguments);if(!args[0].match(/\.dt\b/)){args[0]+='.dt';}
var inst=$(this.tables().nodes());inst[key].apply(inst,args);return this;});});_api_register('clear()',function(){return this.iterator('table',function(settings){_fnClearTable(settings);});});_api_register('settings()',function(){return new _Api(this.context,this.context);});_api_register('init()',function(){var ctx=this.context;return ctx.length?ctx[0].oInit:null;});_api_register('data()',function(){return this.iterator('table',function(settings){return _pluck(settings.aoData,'_aData');}).flatten();});_api_register('destroy()',function(remove){remove=remove||false;return this.iterator('table',function(settings){var orig=settings.nTableWrapper.parentNode;var classes=settings.oClasses;var table=settings.nTable;var tbody=settings.nTBody;var thead=settings.nTHead;var tfoot=settings.nTFoot;var jqTable=$(table);var jqTbody=$(tbody);var jqWrapper=$(settings.nTableWrapper);var rows=$.map(settings.aoData,function(r){return r.nTr;});var i,ien;settings.bDestroying=true;_fnCallbackFire(settings,"aoDestroyCallback","destroy",[settings]);if(!remove){new _Api(settings).columns().visible(true);}
jqWrapper.unbind('.DT').find(':not(tbody *)').unbind('.DT');$(window).unbind('.DT-'+settings.sInstance);if(table!=thead.parentNode){jqTable.children('thead').detach();jqTable.append(thead);}
if(tfoot&&table!=tfoot.parentNode){jqTable.children('tfoot').detach();jqTable.append(tfoot);}
settings.aaSorting=[];settings.aaSortingFixed=[];_fnSortingClasses(settings);$(rows).removeClass(settings.asStripeClasses.join(' '));$('th, td',thead).removeClass(classes.sSortable+' '+
classes.sSortableAsc+' '+classes.sSortableDesc+' '+classes.sSortableNone);if(settings.bJUI){$('th span.'+classes.sSortIcon+', td span.'+classes.sSortIcon,thead).detach();$('th, td',thead).each(function(){var wrapper=$('div.'+classes.sSortJUIWrapper,this);$(this).append(wrapper.contents());wrapper.detach();});}
jqTbody.children().detach();jqTbody.append(rows);var removedMethod=remove?'remove':'detach';jqTable[removedMethod]();jqWrapper[removedMethod]();if(!remove&&orig){orig.insertBefore(table,settings.nTableReinsertBefore);jqTable.css('width',settings.sDestroyWidth).removeClass(classes.sTable);ien=settings.asDestroyStripes.length;if(ien){jqTbody.children().each(function(i){$(this).addClass(settings.asDestroyStripes[i%ien]);});}}
var idx=$.inArray(settings,DataTable.settings);if(idx!==-1){DataTable.settings.splice(idx,1);}});});$.each(['column','row','cell'],function(i,type){_api_register(type+'s().every()',function(fn){var opts=this.selector.opts;var api=this;return this.iterator(type,function(settings,arg1,arg2,arg3,arg4){fn.call(api[type](arg1,type==='cell'?arg2:opts,type==='cell'?opts:undefined),arg1,arg2,arg3,arg4);});});});_api_register('i18n()',function(token,def,plural){var ctx=this.context[0];var resolved=_fnGetObjectDataFn(token)(ctx.oLanguage);if(resolved===undefined){resolved=def;}
if(plural!==undefined&&$.isPlainObject(resolved)){resolved=resolved[plural]!==undefined?resolved[plural]:resolved._;}
return resolved.replace('%d',plural);});DataTable.version="1.10.12";DataTable.settings=[];DataTable.models={};DataTable.models.oSearch={"bCaseInsensitive":true,"sSearch":"","bRegex":false,"bSmart":true};DataTable.models.oRow={"nTr":null,"anCells":null,"_aData":[],"_aSortData":null,"_aFilterData":null,"_sFilterRow":null,"_sRowStripe":"","src":null,"idx":-1};DataTable.models.oColumn={"idx":null,"aDataSort":null,"asSorting":null,"bSearchable":null,"bSortable":null,"bVisible":null,"_sManualType":null,"_bAttrSrc":false,"fnCreatedCell":null,"fnGetData":null,"fnSetData":null,"mData":null,"mRender":null,"nTh":null,"nTf":null,"sClass":null,"sContentPadding":null,"sDefaultContent":null,"sName":null,"sSortDataType":'std',"sSortingClass":null,"sSortingClassJUI":null,"sTitle":null,"sType":null,"sWidth":null,"sWidthOrig":null};DataTable.defaults={"aaData":null,"aaSorting":[[0,'asc']],"aaSortingFixed":[],"ajax":null,"aLengthMenu":[10,25,50,100],"aoColumns":null,"aoColumnDefs":null,"aoSearchCols":[],"asStripeClasses":null,"bAutoWidth":true,"bDeferRender":false,"bDestroy":false,"bFilter":true,"bInfo":true,"bJQueryUI":false,"bLengthChange":true,"bPaginate":true,"bProcessing":false,"bRetrieve":false,"bScrollCollapse":false,"bServerSide":false,"bSort":true,"bSortMulti":true,"bSortCellsTop":false,"bSortClasses":true,"bStateSave":false,"fnCreatedRow":null,"fnDrawCallback":null,"fnFooterCallback":null,"fnFormatNumber":function(toFormat){return toFormat.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands);},"fnHeaderCallback":null,"fnInfoCallback":null,"fnInitComplete":null,"fnPreDrawCallback":null,"fnRowCallback":null,"fnServerData":null,"fnServerParams":null,"fnStateLoadCallback":function(settings){try{return JSON.parse((settings.iStateDuration===-1?sessionStorage:localStorage).getItem('DataTables_'+settings.sInstance+'_'+location.pathname));}catch(e){}},"fnStateLoadParams":null,"fnStateLoaded":null,"fnStateSaveCallback":function(settings,data){try{(settings.iStateDuration===-1?sessionStorage:localStorage).setItem('DataTables_'+settings.sInstance+'_'+location.pathname,JSON.stringify(data));}catch(e){}},"fnStateSaveParams":null,"iStateDuration":7200,"iDeferLoading":null,"iDisplayLength":10,"iDisplayStart":0,"iTabIndex":0,"oClasses":{},"oLanguage":{"oAria":{"sSortAscending":": activate to sort column ascending","sSortDescending":": activate to sort column descending"},"oPaginate":{"sFirst":"First","sLast":"Last","sNext":"Next","sPrevious":"Previous"},"sEmptyTable":"No data available in table","sInfo":"Showing _START_ to _END_ of _TOTAL_ entries","sInfoEmpty":"Showing 0 to 0 of 0 entries","sInfoFiltered":"(filtered from _MAX_ total entries)","sInfoPostFix":"","sDecimal":"","sThousands":",","sLengthMenu":"Show _MENU_ entries","sLoadingRecords":"Loading...","sProcessing":"Processing...","sSearch":"Search:","sSearchPlaceholder":"","sUrl":"","sZeroRecords":"No matching records found"},"oSearch":$.extend({},DataTable.models.oSearch),"sAjaxDataProp":"data","sAjaxSource":null,"sDom":"lfrtip","searchDelay":null,"sPaginationType":"simple_numbers","sScrollX":"","sScrollXInner":"","sScrollY":"","sServerMethod":"GET","renderer":null,"rowId":"DT_RowId"};_fnHungarianMap(DataTable.defaults);DataTable.defaults.column={"aDataSort":null,"iDataSort":-1,"asSorting":['asc','desc'],"bSearchable":true,"bSortable":true,"bVisible":true,"fnCreatedCell":null,"mData":null,"mRender":null,"sCellType":"td","sClass":"","sContentPadding":"","sDefaultContent":null,"sName":"","sSortDataType":"std","sTitle":null,"sType":null,"sWidth":null};_fnHungarianMap(DataTable.defaults.column);DataTable.models.oSettings={"oFeatures":{"bAutoWidth":null,"bDeferRender":null,"bFilter":null,"bInfo":null,"bLengthChange":null,"bPaginate":null,"bProcessing":null,"bServerSide":null,"bSort":null,"bSortMulti":null,"bSortClasses":null,"bStateSave":null},"oScroll":{"bCollapse":null,"iBarWidth":0,"sX":null,"sXInner":null,"sY":null},"oLanguage":{"fnInfoCallback":null},"oBrowser":{"bScrollOversize":false,"bScrollbarLeft":false,"bBounding":false,"barWidth":0},"ajax":null,"aanFeatures":[],"aoData":[],"aiDisplay":[],"aiDisplayMaster":[],"aIds":{},"aoColumns":[],"aoHeader":[],"aoFooter":[],"oPreviousSearch":{},"aoPreSearchCols":[],"aaSorting":null,"aaSortingFixed":[],"asStripeClasses":null,"asDestroyStripes":[],"sDestroyWidth":0,"aoRowCallback":[],"aoHeaderCallback":[],"aoFooterCallback":[],"aoDrawCallback":[],"aoRowCreatedCallback":[],"aoPreDrawCallback":[],"aoInitComplete":[],"aoStateSaveParams":[],"aoStateLoadParams":[],"aoStateLoaded":[],"sTableId":"","nTable":null,"nTHead":null,"nTFoot":null,"nTBody":null,"nTableWrapper":null,"bDeferLoading":false,"bInitialised":false,"aoOpenRows":[],"sDom":null,"searchDelay":null,"sPaginationType":"two_button","iStateDuration":0,"aoStateSave":[],"aoStateLoad":[],"oSavedState":null,"oLoadedState":null,"sAjaxSource":null,"sAjaxDataProp":null,"bAjaxDataGet":true,"jqXHR":null,"json":undefined,"oAjaxData":undefined,"fnServerData":null,"aoServerParams":[],"sServerMethod":null,"fnFormatNumber":null,"aLengthMenu":null,"iDraw":0,"bDrawing":false,"iDrawError":-1,"_iDisplayLength":10,"_iDisplayStart":0,"_iRecordsTotal":0,"_iRecordsDisplay":0,"bJUI":null,"oClasses":{},"bFiltered":false,"bSorted":false,"bSortCellsTop":null,"oInit":null,"aoDestroyCallback":[],"fnRecordsTotal":function()
{return _fnDataSource(this)=='ssp'?this._iRecordsTotal*1:this.aiDisplayMaster.length;},"fnRecordsDisplay":function()
{return _fnDataSource(this)=='ssp'?this._iRecordsDisplay*1:this.aiDisplay.length;},"fnDisplayEnd":function()
{var
len=this._iDisplayLength,start=this._iDisplayStart,calc=start+len,records=this.aiDisplay.length,features=this.oFeatures,paginate=features.bPaginate;if(features.bServerSide){return paginate===false||len===-1?start+records:Math.min(start+len,this._iRecordsDisplay);}
else{return!paginate||calc>records||len===-1?records:calc;}},"oInstance":null,"sInstance":null,"iTabIndex":0,"nScrollHead":null,"nScrollFoot":null,"aLastSort":[],"oPlugins":{},"rowIdFn":null,"rowId":null};DataTable.ext=_ext={buttons:{},classes:{},builder:"-source-",errMode:"alert",feature:[],search:[],selector:{cell:[],column:[],row:[]},internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:DataTable.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:DataTable.version};$.extend(_ext,{afnFiltering:_ext.search,aTypes:_ext.type.detect,ofnSearch:_ext.type.search,oSort:_ext.type.order,afnSortData:_ext.order,aoFeatures:_ext.feature,oApi:_ext.internal,oStdClasses:_ext.classes,oPagination:_ext.pager});$.extend(DataTable.ext.classes,{"sTable":"dataTable","sNoFooter":"no-footer","sPageButton":"paginate_button","sPageButtonActive":"current","sPageButtonDisabled":"disabled","sStripeOdd":"odd","sStripeEven":"even","sRowEmpty":"dataTables_empty","sWrapper":"dataTables_wrapper","sFilter":"dataTables_filter","sInfo":"dataTables_info","sPaging":"dataTables_paginate paging_","sLength":"dataTables_length","sProcessing":"dataTables_processing","sSortAsc":"sorting_asc","sSortDesc":"sorting_desc","sSortable":"sorting","sSortableAsc":"sorting_asc_disabled","sSortableDesc":"sorting_desc_disabled","sSortableNone":"sorting_disabled","sSortColumn":"sorting_","sFilterInput":"","sLengthSelect":"","sScrollWrapper":"dataTables_scroll","sScrollHead":"dataTables_scrollHead","sScrollHeadInner":"dataTables_scrollHeadInner","sScrollBody":"dataTables_scrollBody","sScrollFoot":"dataTables_scrollFoot","sScrollFootInner":"dataTables_scrollFootInner","sHeaderTH":"","sFooterTH":"","sSortJUIAsc":"","sSortJUIDesc":"","sSortJUI":"","sSortJUIAscAllowed":"","sSortJUIDescAllowed":"","sSortJUIWrapper":"","sSortIcon":"","sJUIHeader":"","sJUIFooter":""});(function(){var _empty='';_empty='';var _stateDefault=_empty+'ui-state-default';var _sortIcon=_empty+'css_right ui-icon ui-icon-';var _headerFooter=_empty+'fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix';$.extend(DataTable.ext.oJUIClasses,DataTable.ext.classes,{"sPageButton":"fg-button ui-button "+_stateDefault,"sPageButtonActive":"ui-state-disabled","sPageButtonDisabled":"ui-state-disabled","sPaging":"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi "+"ui-buttonset-multi paging_","sSortAsc":_stateDefault+" sorting_asc","sSortDesc":_stateDefault+" sorting_desc","sSortable":_stateDefault+" sorting","sSortableAsc":_stateDefault+" sorting_asc_disabled","sSortableDesc":_stateDefault+" sorting_desc_disabled","sSortableNone":_stateDefault+" sorting_disabled","sSortJUIAsc":_sortIcon+"triangle-1-n","sSortJUIDesc":_sortIcon+"triangle-1-s","sSortJUI":_sortIcon+"carat-2-n-s","sSortJUIAscAllowed":_sortIcon+"carat-1-n","sSortJUIDescAllowed":_sortIcon+"carat-1-s","sSortJUIWrapper":"DataTables_sort_wrapper","sSortIcon":"DataTables_sort_icon","sScrollHead":"dataTables_scrollHead "+_stateDefault,"sScrollFoot":"dataTables_scrollFoot "+_stateDefault,"sHeaderTH":_stateDefault,"sFooterTH":_stateDefault,"sJUIHeader":_headerFooter+" ui-corner-tl ui-corner-tr","sJUIFooter":_headerFooter+" ui-corner-bl ui-corner-br"});}());var extPagination=DataTable.ext.pager;function _numbers(page,pages){var
numbers=[],buttons=extPagination.numbers_length,half=Math.floor(buttons/2),i=1;if(pages<=buttons){numbers=_range(0,pages);}
else if(page<=half){numbers=_range(0,buttons-2);numbers.push('ellipsis');numbers.push(pages-1);}
else if(page>=pages-1-half){numbers=_range(pages-(buttons-2),pages);numbers.splice(0,0,'ellipsis');numbers.splice(0,0,0);}
else{numbers=_range(page-half+2,page+half-1);numbers.push('ellipsis');numbers.push(pages-1);numbers.splice(0,0,'ellipsis');numbers.splice(0,0,0);}
numbers.DT_el='span';return numbers;}
$.extend(extPagination,{simple:function(page,pages){return['previous','next'];},full:function(page,pages){return['first','previous','next','last'];},numbers:function(page,pages){return[_numbers(page,pages)];},simple_numbers:function(page,pages){return['previous',_numbers(page,pages),'next'];},full_numbers:function(page,pages){return['first','previous',_numbers(page,pages),'next','last'];},_numbers:_numbers,numbers_length:7});$.extend(true,DataTable.ext.renderer,{pageButton:{_:function(settings,host,idx,buttons,page,pages){var classes=settings.oClasses;var lang=settings.oLanguage.oPaginate;var aria=settings.oLanguage.oAria.paginate||{};var btnDisplay,btnClass,counter=0;var attach=function(container,buttons){var i,ien,node,button;var clickHandler=function(e){_fnPageChange(settings,e.data.action,true);};for(i=0,ien=buttons.length;i<ien;i++){button=buttons[i];if($.isArray(button)){var inner=$('<'+(button.DT_el||'div')+'/>').appendTo(container);attach(inner,button);}
else{btnDisplay=null;btnClass='';switch(button){case'ellipsis':container.append('<span class="ellipsis">&#x2026;</span>');break;case'first':btnDisplay=lang.sFirst;btnClass=button+(page>0?'':' '+classes.sPageButtonDisabled);break;case'previous':btnDisplay=lang.sPrevious;btnClass=button+(page>0?'':' '+classes.sPageButtonDisabled);break;case'next':btnDisplay=lang.sNext;btnClass=button+(page<pages-1?'':' '+classes.sPageButtonDisabled);break;case'last':btnDisplay=lang.sLast;btnClass=button+(page<pages-1?'':' '+classes.sPageButtonDisabled);break;default:btnDisplay=button+1;btnClass=page===button?classes.sPageButtonActive:'';break;}
if(btnDisplay!==null){node=$('<a>',{'class':classes.sPageButton+' '+btnClass,'aria-controls':settings.sTableId,'aria-label':aria[button],'data-dt-idx':counter,'tabindex':settings.iTabIndex,'id':idx===0&&typeof button==='string'?settings.sTableId+'_'+button:null}).html(btnDisplay).appendTo(container);_fnBindAction(node,{action:button},clickHandler);counter++;}}}};var activeEl;try{activeEl=$(host).find(document.activeElement).data('dt-idx');}
catch(e){}
attach($(host).empty(),buttons);if(activeEl){$(host).find('[data-dt-idx='+activeEl+']').focus();}}}});$.extend(DataTable.ext.type.detect,[function(d,settings)
{var decimal=settings.oLanguage.sDecimal;return _isNumber(d,decimal)?'num'+decimal:null;},function(d,settings)
{if(d&&!(d instanceof Date)&&(!_re_date_start.test(d)||!_re_date_end.test(d))){return null;}
var parsed=Date.parse(d);return(parsed!==null&&!isNaN(parsed))||_empty(d)?'date':null;},function(d,settings)
{var decimal=settings.oLanguage.sDecimal;return _isNumber(d,decimal,true)?'num-fmt'+decimal:null;},function(d,settings)
{var decimal=settings.oLanguage.sDecimal;return _htmlNumeric(d,decimal)?'html-num'+decimal:null;},function(d,settings)
{var decimal=settings.oLanguage.sDecimal;return _htmlNumeric(d,decimal,true)?'html-num-fmt'+decimal:null;},function(d,settings)
{return _empty(d)||(typeof d==='string'&&d.indexOf('<')!==-1)?'html':null;}]);$.extend(DataTable.ext.type.search,{html:function(data){return _empty(data)?data:typeof data==='string'?data.replace(_re_new_lines," ").replace(_re_html,""):'';},string:function(data){return _empty(data)?data:typeof data==='string'?data.replace(_re_new_lines," "):data;}});var __numericReplace=function(d,decimalPlace,re1,re2){if(d!==0&&(!d||d==='-')){return-Infinity;}
if(decimalPlace){d=_numToDecimal(d,decimalPlace);}
if(d.replace){if(re1){d=d.replace(re1,'');}
if(re2){d=d.replace(re2,'');}}
return d*1;};function _addNumericSort(decimalPlace){$.each({"num":function(d){return __numericReplace(d,decimalPlace);},"num-fmt":function(d){return __numericReplace(d,decimalPlace,_re_formatted_numeric);},"html-num":function(d){return __numericReplace(d,decimalPlace,_re_html);},"html-num-fmt":function(d){return __numericReplace(d,decimalPlace,_re_html,_re_formatted_numeric);}},function(key,fn){_ext.type.order[key+decimalPlace+'-pre']=fn;if(key.match(/^html\-/)){_ext.type.search[key+decimalPlace]=_ext.type.search.html;}});}
$.extend(_ext.type.order,{"date-pre":function(d){return Date.parse(d)||0;},"html-pre":function(a){return _empty(a)?'':a.replace?a.replace(/<.*?>/g,"").toLowerCase():a+'';},"string-pre":function(a){return _empty(a)?'':typeof a==='string'?a.toLowerCase():!a.toString?'':a.toString();},"string-asc":function(x,y){return((x<y)?-1:((x>y)?1:0));},"string-desc":function(x,y){return((x<y)?1:((x>y)?-1:0));}});_addNumericSort('');$.extend(true,DataTable.ext.renderer,{header:{_:function(settings,cell,column,classes){$(settings.nTable).on('order.dt.DT',function(e,ctx,sorting,columns){if(settings!==ctx){return;}
var colIdx=column.idx;cell.removeClass(column.sSortingClass+' '+
classes.sSortAsc+' '+
classes.sSortDesc).addClass(columns[colIdx]=='asc'?classes.sSortAsc:columns[colIdx]=='desc'?classes.sSortDesc:column.sSortingClass);});},jqueryui:function(settings,cell,column,classes){$('<div/>').addClass(classes.sSortJUIWrapper).append(cell.contents()).append($('<span/>').addClass(classes.sSortIcon+' '+column.sSortingClassJUI)).appendTo(cell);$(settings.nTable).on('order.dt.DT',function(e,ctx,sorting,columns){if(settings!==ctx){return;}
var colIdx=column.idx;cell.removeClass(classes.sSortAsc+" "+classes.sSortDesc).addClass(columns[colIdx]=='asc'?classes.sSortAsc:columns[colIdx]=='desc'?classes.sSortDesc:column.sSortingClass);cell.find('span.'+classes.sSortIcon).removeClass(classes.sSortJUIAsc+" "+
classes.sSortJUIDesc+" "+
classes.sSortJUI+" "+
classes.sSortJUIAscAllowed+" "+
classes.sSortJUIDescAllowed).addClass(columns[colIdx]=='asc'?classes.sSortJUIAsc:columns[colIdx]=='desc'?classes.sSortJUIDesc:column.sSortingClassJUI);});}}});var __htmlEscapeEntities=function(d){return typeof d==='string'?d.replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'):d;};DataTable.render={number:function(thousands,decimal,precision,prefix,postfix){return{display:function(d){if(typeof d!=='number'&&typeof d!=='string'){return d;}
var negative=d<0?'-':'';var flo=parseFloat(d);if(isNaN(flo)){return __htmlEscapeEntities(d);}
d=Math.abs(flo);var intPart=parseInt(d,10);var floatPart=precision?decimal+(d-intPart).toFixed(precision).substring(2):'';return negative+(prefix||'')+
intPart.toString().replace(/\B(?=(\d{3})+(?!\d))/g,thousands)+
floatPart+
(postfix||'');}};},text:function(){return{display:__htmlEscapeEntities};}};function _fnExternApiFunc(fn)
{return function(){var args=[_fnSettingsFromNode(this[DataTable.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return DataTable.ext.internal[fn].apply(this,args);};}
$.extend(DataTable.ext.internal,{_fnExternApiFunc:_fnExternApiFunc,_fnBuildAjax:_fnBuildAjax,_fnAjaxUpdate:_fnAjaxUpdate,_fnAjaxParameters:_fnAjaxParameters,_fnAjaxUpdateDraw:_fnAjaxUpdateDraw,_fnAjaxDataSrc:_fnAjaxDataSrc,_fnAddColumn:_fnAddColumn,_fnColumnOptions:_fnColumnOptions,_fnAdjustColumnSizing:_fnAdjustColumnSizing,_fnVisibleToColumnIndex:_fnVisibleToColumnIndex,_fnColumnIndexToVisible:_fnColumnIndexToVisible,_fnVisbleColumns:_fnVisbleColumns,_fnGetColumns:_fnGetColumns,_fnColumnTypes:_fnColumnTypes,_fnApplyColumnDefs:_fnApplyColumnDefs,_fnHungarianMap:_fnHungarianMap,_fnCamelToHungarian:_fnCamelToHungarian,_fnLanguageCompat:_fnLanguageCompat,_fnBrowserDetect:_fnBrowserDetect,_fnAddData:_fnAddData,_fnAddTr:_fnAddTr,_fnNodeToDataIndex:_fnNodeToDataIndex,_fnNodeToColumnIndex:_fnNodeToColumnIndex,_fnGetCellData:_fnGetCellData,_fnSetCellData:_fnSetCellData,_fnSplitObjNotation:_fnSplitObjNotation,_fnGetObjectDataFn:_fnGetObjectDataFn,_fnSetObjectDataFn:_fnSetObjectDataFn,_fnGetDataMaster:_fnGetDataMaster,_fnClearTable:_fnClearTable,_fnDeleteIndex:_fnDeleteIndex,_fnInvalidate:_fnInvalidate,_fnGetRowElements:_fnGetRowElements,_fnCreateTr:_fnCreateTr,_fnBuildHead:_fnBuildHead,_fnDrawHead:_fnDrawHead,_fnDraw:_fnDraw,_fnReDraw:_fnReDraw,_fnAddOptionsHtml:_fnAddOptionsHtml,_fnDetectHeader:_fnDetectHeader,_fnGetUniqueThs:_fnGetUniqueThs,_fnFeatureHtmlFilter:_fnFeatureHtmlFilter,_fnFilterComplete:_fnFilterComplete,_fnFilterCustom:_fnFilterCustom,_fnFilterColumn:_fnFilterColumn,_fnFilter:_fnFilter,_fnFilterCreateSearch:_fnFilterCreateSearch,_fnEscapeRegex:_fnEscapeRegex,_fnFilterData:_fnFilterData,_fnFeatureHtmlInfo:_fnFeatureHtmlInfo,_fnUpdateInfo:_fnUpdateInfo,_fnInfoMacros:_fnInfoMacros,_fnInitialise:_fnInitialise,_fnInitComplete:_fnInitComplete,_fnLengthChange:_fnLengthChange,_fnFeatureHtmlLength:_fnFeatureHtmlLength,_fnFeatureHtmlPaginate:_fnFeatureHtmlPaginate,_fnPageChange:_fnPageChange,_fnFeatureHtmlProcessing:_fnFeatureHtmlProcessing,_fnProcessingDisplay:_fnProcessingDisplay,_fnFeatureHtmlTable:_fnFeatureHtmlTable,_fnScrollDraw:_fnScrollDraw,_fnApplyToChildren:_fnApplyToChildren,_fnCalculateColumnWidths:_fnCalculateColumnWidths,_fnThrottle:_fnThrottle,_fnConvertToWidth:_fnConvertToWidth,_fnGetWidestNode:_fnGetWidestNode,_fnGetMaxLenString:_fnGetMaxLenString,_fnStringToCss:_fnStringToCss,_fnSortFlatten:_fnSortFlatten,_fnSort:_fnSort,_fnSortAria:_fnSortAria,_fnSortListener:_fnSortListener,_fnSortAttachListener:_fnSortAttachListener,_fnSortingClasses:_fnSortingClasses,_fnSortData:_fnSortData,_fnSaveState:_fnSaveState,_fnLoadState:_fnLoadState,_fnSettingsFromNode:_fnSettingsFromNode,_fnLog:_fnLog,_fnMap:_fnMap,_fnBindAction:_fnBindAction,_fnCallbackReg:_fnCallbackReg,_fnCallbackFire:_fnCallbackFire,_fnLengthOverflow:_fnLengthOverflow,_fnRenderer:_fnRenderer,_fnDataSource:_fnDataSource,_fnRowAttributes:_fnRowAttributes,_fnCalculateEnd:function(){}});$.fn.dataTable=DataTable;DataTable.$=$;$.fn.dataTableSettings=DataTable.settings;$.fn.dataTableExt=DataTable.ext;$.fn.DataTable=function(opts){return $(this).dataTable(opts).api();};$.each(DataTable,function(prop,val){$.fn.DataTable[prop]=val;});return $.fn.dataTable;}));
(function($){var pl=/\+/g,searchStrict=/([^&=]+)=+([^&]*)/g,searchTolerant=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "));};$.parseQuery=function(query,options){var match,o={},opts=options||{},search=opts.tolerant?searchTolerant:searchStrict;if('?'===query.substring(0,1)){query=query.substring(1);}
while(match=search.exec(query)){o[decode(match[1])]=decode(match[2]);}
return o;}
$.getQuery=function(options){return $.parseQuery(window.location.search,options);}
$.fn.parseQuery=function(options){return $.parseQuery($(this).serialize(),options);};}(jQuery));
var Base=function(){};Base.extend=function(_instance,_static){var extend=Base.prototype.extend;Base._prototyping=true;var proto=new this;extend.call(proto,_instance);proto.base=function(){};delete Base._prototyping;var constructor=proto.constructor;var klass=proto.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==klass){this._constructing=true;constructor.apply(this,arguments);delete this._constructing;}else if(arguments[0]!=null){return(arguments[0].extend||extend).call(arguments[0],proto);}}};klass.ancestor=this;klass.extend=this.extend;klass.forEach=this.forEach;klass.implement=this.implement;klass.prototype=proto;klass.toString=this.toString;klass.valueOf=function(type){return(type=="object")?klass:constructor.valueOf();};extend.call(klass,_static);if(typeof klass.init=="function")klass.init();return klass;};Base.prototype={extend:function(source,value){if(arguments.length>1){var ancestor=this[source];if(ancestor&&(typeof value=="function")&&(!ancestor.valueOf||ancestor.valueOf()!=value.valueOf())&&/\bbase\b/.test(value)){var method=value.valueOf();value=function(){var previous=this.base||Base.prototype.base;this.base=ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue;};value.valueOf=function(type){return(type=="object")?value:method;};value.toString=Base.toString;}
this[source]=value;}else if(source){var extend=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){extend=this.extend||extend;}
var proto={toSource:null};var hidden=["constructor","toString","valueOf"];var i=Base._prototyping?0:1;while(key=hidden[i++]){if(source[key]!=proto[key]){extend.call(this,key,source[key]);}}
for(var key in source){if(!proto[key])extend.call(this,key,source[key]);}}
return this;}};Base=Base.extend({constructor:function(){this.extend(arguments[0]);}},{ancestor:Object,version:"1.1",forEach:function(object,block,context){for(var key in object){if(this.prototype[key]===undefined){block.call(context,object[key],key,object);}}},implement:function(){for(var i=0;i<arguments.length;i++){if(typeof arguments[i]=="function"){arguments[i](this.prototype);}else{this.prototype.extend(arguments[i]);}}
return this;},toString:function(){return String(this.valueOf());}});
if(!Array.prototype.map)
{Array.prototype.map=function(fun)
{var len=this.length;if(typeof fun!="function")
throw new TypeError();var res=new Array(len);var thisp=arguments[1];for(var i=0;i<len;i++)
{if(i in this)
res[i]=fun.call(thisp,this[i],i,this);}
return res;};}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement){"use strict";if(this==null){throw new TypeError();}
var t=Object(this);var len=t.length>>>0;if(len===0){return-1;}
var n=0;if(arguments.length>0){n=Number(arguments[1]);if(n!=n){n=0;}else if(n!=0&&n!=Infinity&&n!=-Infinity){n=(n>0||-1)*Math.floor(Math.abs(n));}}
if(n>=len){return-1;}
var k=n>=0?n:Math.max(len-Math.abs(n),0);for(;k<len;k++){if(k in t&&t[k]===searchElement){return k;}}
return-1;}}
Function.prototype.method=Function.prototype.method||function(name,func){this.prototype[name]=func;return this;};var wd=wd||{};wd.loglevels=['debug','info','warn','error','exception'];wd.loglevel='debug';wd.log=function(m,type){type=type||"info";if(wd.loglevels.indexOf(type)<wd.loglevels.indexOf(wd.loglevel)){return;}
if(typeof console!=="undefined"){if(type&&console[type]){console[type]("["+type+"] WD: "+m);}else if(type==='exception'&&!console.exception){console.error("["+type+"] WD: "+(m.stack||m));}
else{console.log("WD: "+m);}}}
wd.warn=function(m){return wd.log(m,"warn");}
wd.error=function(m){return wd.log(m,"error");}
wd.info=function(m){return wd.log(m,"info");}
wd.debug=function(m){return wd.log(m,"debug");}
$.ajaxSetup({type:"POST",async:false,traditional:true,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataFilter:function(data,dtype){if(!(typeof Dashboards==='undefined')){Dashboards.lastServerResponse=Date.now?Date.now():new Date().getTime();}
return data;}});var pathArray=window.location.pathname.split('/');var webAppPath;if(!(typeof(CONTEXT_PATH)=='undefined')){webAppPath=CONTEXT_PATH;}
if(webAppPath==undefined){webAppPath="/"+pathArray[1];}
if(webAppPath.endsWith("/")){webAppPath=webAppPath.substr(0,webAppPath.length-1);}
if($.blockUI){$.blockUI.defaults.fadeIn=0;$.blockUI.defaults.message='<div class="blockUIDefaultImg"></div>';$.blockUI.defaults.css.left='50%';$.blockUI.defaults.css.top='40%';$.blockUI.defaults.css.marginLeft='-16px';$.blockUI.defaults.css.width='32px';$.blockUI.defaults.css.background='none';$.blockUI.defaults.overlayCSS={backgroundColor:"#FFFFFF",opacity:0.8,cursor:"wait"};$.blockUI.defaults.css.border="none";}
if($.prompt&&typeof $.prompt.setDefaults=='function'){$.prompt.setDefaults({prefix:'jqi',show:'slideDown'});}
var CDF_PLUGIN_NAME="pentaho-cdf";var SAMPLES_BASE_PATH="/public/plugin-samples/";wd=wd||{};wd.cdf=wd.cdf||{};wd.cdf.helper={getTimestamp:function(){return"ts="+new Date().getTime();},getFullPath:function(path,action){path=path||"";action=action||"";var fullPath=path.indexOf(CDF_PLUGIN_NAME)==0?(SAMPLES_BASE_PATH+path):path;fullPath=fullPath+(action?"/"+action:"").replace(/\/\//g,'/');return fullPath;},composePath:function(options){var clean=function(segment){if(segment.charAt(0)=="/"){segment=segment.substring(1,segment.length);}
if(segment.charAt(segment.length-1)=="/"){segment=segment.substring(0,segment.length-1);}
return segment};var fullPath="/";if(options.solution){fullPath+=clean(options.solution)+"/";}
if(options.path){fullPath+=clean(options.path);}
if(options.action){fullPath+="/"+clean(options.action);}
return fullPath;},httpUrlToWebSocketUrl:function(url){return url.replace(/(http)(s)?\:\/\//i,"ws$2://");}};wd.cdf.endpoints={getWebapp:function(){return webAppPath;},getWebsocketWebapp:function(){return document.location.protocol+"//"+document.location.host+wd.cdf.endpoints.getWebapp();},getPing:function(){return wd.cdf.endpoints.getCdfBase()+"/ping";},getXmla:function(){return wd.cdf.endpoints.getWebapp()+"/Xmla";},getPluginBase:function(plugin){return wd.cdf.endpoints.getWebapp()+"/plugin/"+plugin+"/api";},getPluginWebsocketBase:function(plugin){return wd.cdf.helper.httpUrlToWebSocketUrl(wd.cdf.endpoints.getWebsocketWebapp())+"/"+plugin+"/websocket";},getCdfBase:function(){return wd.cdf.endpoints.getPluginBase(CDF_PLUGIN_NAME);},getCdaBase:function(){return wd.cdf.endpoints.getPluginBase('cda');},getCdaWebsocketBase:function(){return wd.cdf.endpoints.getPluginWebsocketBase('cda');},getPluginEndpoint:function(plugin,endpoint){return wd.cdf.endpoints.getPluginBase(plugin)+"/"+endpoint;},getStorage:function(action){return wd.cdf.endpoints.getCdfBase()+"/storage/"+action;},getSettings:function(action,key){if(key){return wd.cdf.endpoints.getCdfBase()+"/settings/"+action+"?"+$.param({key:key});}else{return wd.cdf.endpoints.getCdfBase()+"/settings/"+action;}},getViewAction:function(){return wd.cdf.endpoints.getCdfBase()+"/viewAction";},getJSONSolution:function(){return wd.cdf.endpoints.getCdfBase()+"/getJSONSolution";},getRenderHTML:function(){return wd.cdf.endpoints.getCdfBase()+"/RenderHtml";},getExport:function(){return wd.cdf.endpoints.getCdfBase()+"/export";},getResource:function(){return wd.cdf.endpoints.getCdfBase()+"/getResource";},getStaticResource:function(resource){return wd.cdf.endpoints.getCdfBase()+"/resources/"+resource;},getSimileStaticResource:function(resource){return wd.cdf.endpoints.getWebapp()+"/api/repos/pentaho-cdf/js-legacy/lib/"+resource;},getXmlaStaticResource:function(){return wd.cdf.endpoints.getResource()+"?path=js/lib/xmla/Xmla.js";},getCdfXaction:function(path,action,solution,params){if(params){var parameters={};for(var key in params){parameters[key]=(typeof params[key]=='function'?params[key]():params[key]);}
return this.getEncoder().encode(wd.cdf.endpoints.getViewAction(),null,$.extend({path:wd.cdf.helper.getFullPath(path,action),ts:new Date().getTime()},parameters));}else{return this.getEncoder().encode(wd.cdf.endpoints.getViewAction(),null,{path:wd.cdf.helper.getFullPath(path,action),ts:new Date().getTime()});}},getServiceAction:function(method,solution,path,action){var arr={};arr.wrapper=false;arr.action=action;arr.url=this.getEncoder().encode(wd.cdf.endpoints.getWebapp()+"/api/repos/{0}/generatedContent",this.getEncoder().encodeRepositoryPath(wd.cdf.helper.getFullPath(path,action)));return arr;},getComments:function(action){var endpoint="";if(action=="LIST_ALL"||action=="LIST_ACTIVE"||action=="GET_LAST"){endpoint="list";}else if(action=="DELETE_COMMENT"){endpoint="delete";}else if(action=="ARCHIVE_COMMENT"){endpoint="archive";}else if(action=="ADD_COMMENT"){endpoint="add";}
return wd.cdf.endpoints.getCdfBase()+"/comments/"+endpoint+"?"+wd.cdf.helper.getTimestamp();},getScheduledJob:function(){return wd.cdf.endpoints.getWebapp()+"/api/scheduler/job";},getEmailConfig:function(){return wd.cdf.endpoints.getWebapp()+"/api/emailconfig";},getPivot:function(solution,path,action){var fullPath=path.indexOf(CDF_PLUGIN_NAME)==0?(SAMPLES_BASE_PATH+path):path;return this.getEncoder().encode(wd.cdf.endpoints.getWebapp()+"/plugin/jpivot/Pivot",null,{solution:(solution||"system"),path:fullPath,action:action});},getAnalyzer:function(path,callvar,parameters){return this.getEncoder().encode(wd.cdf.endpoints.getWebapp()+"/api/repos/{0}/"+callvar,this.getEncoder().encodeRepositoryPath(wd.cdf.helper.composePath(path)),parameters);},getReport:function(path,callvar,parameters){if(typeof path==="string"||path instanceof String){return this.getEncoder().encode(wd.cdf.endpoints.getWebapp()+"/api/repos/{0}/"+callvar,this.getEncoder().encodeRepositoryPath(path),parameters);}else{return this.getEncoder().encode(wd.cdf.endpoints.getWebapp()+"/api/repos/{0}/"+callvar,this.getEncoder().encodeRepositoryPath(wd.cdf.helper.composePath(path)),parameters);}},getCaptifyZoom:function(){return wd.cdf.endpoints.getStaticResource("js-legacy/lib/captify/zoom.html");},getDoQuery:function(){return wd.cdf.endpoints.getCdaBase()+"/doQuery?";},getWebsocketQuery:function(){return wd.cdf.endpoints.getCdaWebsocketBase()+"/query";},getUnwrapQuery:function(parameters){return wd.cdf.endpoints.getCdaBase()+"/unwrapQuery?"+$.param(parameters);},getEncoder:function(){var enc;try{enc=Encoder;}catch(err){}
if(enc===undefined){try{enc=pho.Encoder;}catch(err){}}
return enc;}};
wd=wd||{};wd.helpers=wd.helpers||{};wd.helpers.cccHelper={getCccScriptPath:function(scriptName){return Dashboards.context.path.replace(/[^\/]+$/,"")+scriptName+".js";}}
wd=wd||{};wd.helpers=wd.helpers||{};wd.helpers.cggHelper={getCggDrawUrl:function(){return Dashboards.getWebAppPath()+"/plugin/cgg/api/services/draw";}}
var wd=(typeof wd!=='undefined')?wd:{};wd.helpers=wd.helpers||{};wd.helpers.inputHelper={getCssWrapperClass:function(verticalOrientation){return"pentaho-toggle-button pentaho-toggle-button-up "+
((this.verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");},getSelectedCss:function(verticalOrientation){return"pentaho-toggle-button pentaho-toggle-button-down "+((verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");},getUnselectedCss:function(verticalOrientation){return"pentaho-toggle-button pentaho-toggle-button-up "+((verticalOrientation)?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal");},getExtraCss:function(index,count,verticalOrientation){var css="";if(index==0&&count==1){return" pentaho-toggle-button-single";}
if(index==0){css+=" "+((verticalOrientation)?" pentaho-toggle-button-vertical-first":" pentaho-toggle-button-horizontal-first");}else if(index==count-1){css+=" "+((verticalOrientation)?" pentaho-toggle-button-vertical-last":" pentaho-toggle-button-horizontal-last");}
return css;},getToggleButtonClass:function(){return"pentaho-toggle-button";},getToggleButtonHoveringClass:function(){return"pentaho-toggle-button-up-hovering";}}
var dash,Dashboards=dash={ERROR_CODES:{'QUERY_TIMEOUT':{msg:"Query timeout reached"},"COMPONENT_ERROR":{msg:"Error processing component"}},CDF_BASE_PATH:wd.cdf.endpoints.getCdfBase(),parameterModel:new Backbone.Model(),viewFlags:{UNUSED:"unused",UNBOUND:"unbound",VIEW:"view"},globalContext:true,escapeParameterValues:true,_flatParameters:false,runningCalls:0,components:[],parameters:[],context:{},initCounter:0,legacyPriority:-1000,logLifecycle:true,args:[],monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],lastServerResponse:Date.now?Date.now():new Date().getTime(),serverCheckResponseTimeout:1800000,i18nCurrentLanguageCode:null,i18nSupport:null,isDisposed:false};_.extend(Dashboards,Backbone.Events);Dashboards.log=function(message,type,css){type=type||"log";if(typeof console!="undefined"){if(!console[type]){if(type==="exception"){type="error";message=message.stack||message;}else{type="log";}}
if(css){try{console[type]("%cCDF: "+message,css);return;}catch(e){}}
console[type]("CDF: "+message);}};Dashboards.error=function(m){this.log(m,'error');}
Dashboards.getWebAppPath=function(){return webAppPath;}
Dashboards.setGlobalContext=function(globalContext){this.globalContext=globalContext;};Dashboards._setFlatParameters=function(flatParameters){this._flatParameters=flatParameters;};Dashboards.showProgressIndicator=function(){$.blockUI&&this.blockUIwithDrag();};Dashboards.hideProgressIndicator=function(force){if(force){this.runningCalls=0;}
$.unblockUI&&$.unblockUI();this.showErrorTooltip();};Dashboards.resetRunningCalls=function(){this.runningCalls=0;setTimeout(_.bind(function(){this.hideProgressIndicator();},this),10);};Dashboards.getRunningCalls=function(){return this.runningCalls;};Dashboards.incrementRunningCalls=function(){this.runningCalls++;this.showProgressIndicator();};Dashboards.decrementRunningCalls=function(){this.runningCalls--;setTimeout(_.bind(function(){if(this.runningCalls<=0){this.hideProgressIndicator();this.runningCalls=0;}},this),10);};Dashboards.bindControl=function(control){var Class=this._getControlClass(control);if(!Class){this.log("Object type "+control["type"]+" can't be mapped to a valid class","error");}else{this._castControlToClass(control,Class);}
return this.bindExistingControl(control,Class);};Dashboards.bindExistingControl=function(control,Class){if(!control.dashboard){control.dashboard=this;delete control.initInstance;this._castControlToComponent(control,Class);if(typeof control.off==="function"){control.off("all");}
if(!control.on){$.extend(control,Backbone.Events);};this._addLogLifecycleToControl(control);if(control.priority==null||control.priority===""){control.priority=this.legacyPriority++;}}
return control;};Dashboards._castControlToClass=function(control,Class){if(!(control instanceof Class)){var controlImpl=this._makeInstance(Class);$.extend(control,controlImpl);}};Dashboards._getControlClass=function(control){var typeName=control.type;if(typeof typeName==='function'){typeName=typeName.call(control);}
var TypeName=typeName.substring(0,1).toUpperCase()+typeName.substring(1);var typeNames=[TypeName+'Component',typeName,TypeName];for(var i=0,N=typeNames.length;i<N;i++){var Class=window[typeNames[i]];if(Class&&typeof Class==='function'){return Class;}}};Dashboards._makeInstance=function(Class,args){var o=Object.create(Class.prototype);if(args){Class.apply(o,args);}else{Class.apply(o);}
return o;};Dashboards._castControlToComponent=function(control,Class){if(!(control instanceof BaseComponent)&&(!Class||!(Class.prototype instanceof BaseComponent))){var baseProto=BaseComponent.prototype;for(var p in baseProto){if(baseProto.hasOwnProperty(p)&&(control[p]===undefined)&&(typeof baseProto[p]==='function')){switch(p){case'base':break;default:control[p]=baseProto[p];break;}}}}};Dashboards._addLogLifecycleToControl=function(control){control.on("all",function(e){var dashs=this.dashboard;if(dashs&&dashs.logLifecycle&&e!=="cdf"&&this.name!=="PostInitMarker"&&typeof console!=="undefined"){var eventStr;var eventName=e.substr(4);switch(eventName){case"preExecution":eventStr=">Start";break;case"postExecution":eventStr="<End  ";break;case"error":eventStr="!Error";break;default:eventStr="      ";break;}
var timeInfo=Mustache.render("Timing: {{elapsedSinceStartDesc}} since start, {{elapsedSinceStartDesc}} since last event",this.splitTimer());Dashboards.log("          [Lifecycle "+eventStr+"] "+this.name+" ["+this.type+"]"+" (P: "
+this.priority+" ): "+eventName+" "+timeInfo+" (Running: "+this.dashboard.runningCalls+")","log","color: "+this.getLogColor());}});};Dashboards.restoreDuplicates=function(){var dupes=this.components.filter(function(c){return c.type=='duplicate'}),suffixes={},params=this.getBookmarkState().params||{};Object.keys(params).filter(function(e){return/(_[0-9]+)+$/.test(e);}).map(function(e){var parts=e.match(/(.*?)((_[0-9]+)+)$/),name=parts[1],suffix=parts[2];if(!suffixes[suffix]){suffixes[suffix]={}}
suffixes[suffix][name]=params[e];return e;});var myself=this;for(var s in suffixes)if(suffixes.hasOwnProperty(s)){var params=suffixes[s];$.each(dupes,function(i,e){var p;for(p=0;p<e.parameters.length;p++){if(!params.hasOwnProperty(e.parameters[p])&&myself.isBookmarkable(e.parameters[p])){return;}}
e.duplicate(params);});}}
Dashboards.blockUIwithDrag=function(){if(typeof this.i18nSupport!=="undefined"&&this.i18nSupport!=null){$.blockUI.defaults.message='<div class="img blockUIDefaultImg" style="padding: 0px;"></div>';}
$.blockUI();var handle=$('<div id="blockUIDragHandle"></div>')
$("div.blockUI.blockMsg").prepend(handle);$("div.blockUI.blockMsg").draggable({handle:"#blockUIDragHandle"});};Dashboards.updateLifecycle=function(object){this._throwIfDisposed();var silent=object.lifecycle?!!object.lifecycle.silent:false;if(object.disabled){return;}
if(!silent){this.incrementRunningCalls();}
var handler=_.bind(function(){try{var shouldExecute;if(!(typeof(object.preExecution)=='undefined')){shouldExecute=object.preExecution.apply(object);}
shouldExecute=typeof shouldExecute!="undefined"?!!shouldExecute:true;object.trigger('cdf cdf:preExecution',object,shouldExecute);if(!shouldExecute){return;}
if(object.tooltip!=undefined){object._tooltip=typeof object["tooltip"]=='function'?object.tooltip():object.tooltip;}
if((object.update!=undefined)&&(typeof object['update']=='function')){object.update();this.refreshEngine.processComponent(object);}else{}
if(!(typeof(object.postExecution)=='undefined')){object.postExecution.apply(object);}
if(object._tooltip!=undefined){$("#"+object.htmlObject).attr("title",object._tooltip).tooltip({delay:0,track:true,fade:250});}}catch(e){var ph=(object.htmlObject)?$('#'+object.htmlObject):undefined,msg=Dashboards.getErrorObj('COMPONENT_ERROR').msg
+' ('+object.name.replace('render_','')+')';this.errorNotification({msg:msg},ph);this.log("Error updating "+object.name+":",'error');this.log(e,'exception');}finally{if(!silent){this.decrementRunningCalls();}}
object.trigger('cdf cdf:postExecution',object);},this);setTimeout(handler,1);};Dashboards.update=function(component){if(!this.updateQueue){this.updateQueue=[];}
this.updateQueue.push(component);if(this.updateTimeout){clearTimeout(this.updateTimeout);}
var handler=_.bind(function(){this.updateAll(this.updateQueue);delete this.updateQueue;},this);this.updateTimeout=setTimeout(handler,5);};Dashboards.updateComponent=function(object){this._throwIfDisposed();if((Date.now?Date.now():new Date().getTime())-Dashboards.lastServerResponse>Dashboards.serverCheckResponseTimeout){if(!Dashboards.checkServer()){Dashboards.hideProgressIndicator();Dashboards.loginAlert();throw"not logged in";}}
if(object.isManaged===false&&object.update){object.update();this.refreshEngine.processComponent(object);}else{this.updateLifecycle(object);}};Dashboards.getComponentName=function(component){if(!component){return;}
if(component.name&&(typeof component.name==="string")){return component.name;}
if(typeof component==="string"){return component;}};Dashboards.getComponent=dash.getComp=function(component){var name=this.getComponentName(component);if(name){return this.getComponentByName(name);}};Dashboards.getComponentByName=function(name){if(!name){return;}
if(this.globalContext&&window[name]){return window[name];}
for(var i=0,cs=this.components,L=cs.length;i<L;i++){var comp=cs[i];if(comp&&comp.name===name){return comp;}}};Dashboards.addComponents=function(components){if(!$.isArray(components)){this.log('Dashboards.addComponents: components in a structure other than an array will not be added!','warn');return;}
components.forEach(function(component){this.addComponent(component);},this);return this;};Dashboards.addComponent=function(component,options){var name=this.getComponentName(component);if(!name){this.log('Dashboards.addComponent: failed attempting to add a component that has no name!','warn');return false;}
this.removeComponent(name);this.bindControl(component);if(this.globalContext){window[name]=component;}
if(options&&options.index&&(options.index>-1)&&(options.index<this.components.length)){this.components.splice(options.index,0,component)}else{this.components.push(component);}
return true;};Dashboards.getComponentIndex=function(compOrNameOrIndex){if(compOrNameOrIndex!=null){switch(typeof compOrNameOrIndex){case'string':for(var i=0,cs=this.components,L=cs.length;i<L;i++){if(cs[i].name===compOrNameOrIndex){return i;}}
break;case'number':if(compOrNameOrIndex>=0&&compOrNameOrIndex<this.components.length){return compOrNameOrIndex;}
break;default:return this.components.indexOf(compOrNameOrIndex);}}
return-1;};Dashboards.removeComponent=function(compOrNameOrIndex){var index=this.getComponentIndex(compOrNameOrIndex);if(index===-1){return;}
var name=this.components[index].name;if(!name){this.log('Dashboards.removeComponent: failed attempting to remove a component that has no name!','warn');return;}
if(this.globalContext&&window[name]){window[name]=undefined;}
var comp=null;if(index>=0){var cs=this.components;comp=cs[index];cs.splice(index,1);comp.dashboard=null;comp.off('cdf:postExecution');comp.off('cdf:preExecution');comp.off('cdf:error');comp.off('all');}
return comp;};Dashboards.registerEvent=function(ev,callback){if(typeof this.events=='undefined'){this.events={};}
this.events[ev]=callback;};Dashboards.addArgs=function(url){if(url!=undefined)
this.args=getURLParameters(url);};Dashboards.setI18nSupport=function(lc,i18nRef){if(i18nRef!=="undefined"&&lc!=="undefined"){this.i18nCurrentLanguageCode=lc;this.i18nSupport=i18nRef;}};Dashboards.init=function(components){var myself=this;var initInstance=Dashboards.initCounter++;Dashboards.log("InitInstance "+initInstance);if(initInstance==0){this.syncDebugLevel();if(this.initialStorage){_.extend(this.storage,this.initialStorage);}else{this.loadStorage();}
if(this.context!=null&&this.context.sessionTimeout!=null){Dashboards.serverCheckResponseTimeout=this.context.sessionTimeout*900;}
this.restoreBookmarkables();this.restoreView();this.syncParametersInit();}
if($.isArray(components)){this.addComponents(components);}
_.chain(Dashboards.components).where({initInstance:undefined}).each(function(c){c.initInstance=initInstance});$(function(){myself.initEngine(initInstance);});};Dashboards.syncParameters=function(master,slave){this.setParameter(slave,this.getParameterValue(master));this.parameterModel.on("change:"+master,function(m,v,o){this[o.notify?'fireChange':'setParameter'](slave,v)},this);this.parameterModel.on("change:"+slave,function(m,v,o){this[o.notify?'fireChange':'setParameter'](master,v)},this);}
Dashboards.chains=[];Dashboards.syncedParameters={};Dashboards.syncParametersOnInit=function(master,slave){var parameters=this.syncedParameters,currChain,masterChain,slaveChain,slaveChainIdx,i;if(!parameters[master])parameters[master]=[];parameters[master].push(slave);for(i=0;i<this.chains.length;i++){currChain=this.chains[i];if(currChain.indexOf(master)>-1){masterChain=currChain;}
if(currChain.indexOf(slave)>-1){slaveChain=currChain;slaveChainIdx=i;}}
if(slaveChain&&masterChain){if(masterChain!=slaveChain){args=slaveChain.slice();args.unshift(0);args.unshift(masterChain.length);[].splice.apply(masterChain,args);this.chains.splice(slaveChainIdx,1);}}else if(slaveChain){slaveChain.unshift(master);}else if(masterChain){masterChain.push(slave)}else{this.chains.push([master,slave]);}}
Dashboards.syncParametersInit=function(){var parameters=this.syncedParameters,i,j,k,master,slave;for(i=0;i<this.chains.length;i++){for(j=0;j<this.chains[i].length;j++){var master=this.chains[i][j];if(!parameters[master])continue;for(k=0;k<parameters[master].length;k++){slave=parameters[master][k];this.syncParameters(master,slave);}}}}
Dashboards.initEngine=function(initInstance){if(this.waitingForInit&&this.waitingForInit.length){this.log("Overlapping initEngine!",'warn');}
var myself=this;var components=initInstance!=null?_.where(this.components,{initInstance:initInstance}):this.components;if((!this.waitingForInit||this.waitingForInit.length===0)&&!this.finishedInit){this.incrementRunningCalls();}
if(this.logLifecycle&&typeof console!="undefined"){Dashboards.log("          [Lifecycle >Start] Init["+initInstance+"] (Running: "+this.getRunningCalls()+")","log","color: #ddd");}
this.createAndCleanErrorDiv();if(typeof this.preInit=='function'){this.preInit();}
this.trigger("cdf cdf:preInit",this);$(window).trigger('cdfAboutToLoad');var myself=this;var updating=[],i;for(i=0;i<components.length;i++){if(components[i].executeAtStart){updating.push(components[i]);}}
if(!updating.length){this.handlePostInit();return;}
var postInitComponent={name:"PostInitMarker",type:"unmanaged",lifecycle:{silent:true},executeAtStart:true,priority:999999999};this.bindControl(postInitComponent)
updating.push(postInitComponent);this.waitingForInit=updating.slice();var callback=function(comp,isExecuting){if(arguments.length==2&&isExecuting){return;}
this.waitingForInit=_(this.waitingForInit).without(comp);comp.off('cdf:postExecution',callback);comp.off('cdf:preExecution',callback);comp.off('cdf:error',callback);this.handlePostInit(initInstance);}
for(var i=0,len=updating.length;i<len;i++){var component=updating[i];component.on('cdf:postExecution cdf:preExecution cdf:error',callback,myself);}
Dashboards.updateAll(updating);if(components.length>0){myself.handlePostInit(initInstance);}};Dashboards.handlePostInit=function(initInstance){if((!this.waitingForInit||this.waitingForInit.length===0)&&!this.finishedInit){this.trigger("cdf cdf:postInit",this);$(window).trigger('cdfLoaded');if(typeof this.postInit=="function"){this.postInit();}
this.restoreDuplicates();this.finishedInit=true;this.decrementRunningCalls();if(this.logLifecycle&&typeof console!="undefined"){Dashboards.log("          [Lifecycle <End  ] Init["+initInstance+"] (Running: "+this.getRunningCalls()+")","log","color: #ddd");}}};Dashboards.debug=1;Dashboards.syncDebugLevel=function(){var level=1;try{var urlIfHasDebug=function(url){return url&&(/\bdebug=true\b/).test(url)?url:null;};var url=urlIfHasDebug(window.location.href)||urlIfHasDebug(window.top.location.href);if(url){var m=/\bdebugLevel=(\d+)/.exec(url);level=m?(+m[1]):3;}}catch(ex){}
return this.debug=level;};Dashboards.resetAll=function(){this.createAndCleanErrorDiv();var compCount=this.components.length;for(var i=0,len=this.components.length;i<len;i++){this.components[i].clear();}
var compCount=this.components.length;for(var i=0,len=this.components.length;i<len;i++){if(this.components[i].executeAtStart){this.update(this.components[i]);}}};Dashboards.processChange=function(object_name){var object=this.getComponentByName(object_name);var parameter=object.parameter;var value;if(typeof object['getValue']=='function'){value=object.getValue();}
if(value==null)
return;if(!(typeof(object.preChange)=='undefined')){var preChangeResult=object.preChange(value);value=preChangeResult!=undefined?preChangeResult:value;}
if(parameter){this.fireChange(parameter,value);}
if(!(typeof(object.postChange)=='undefined')){object.postChange(value);}};Dashboards.fireChange=function(parameter,value){var myself=this;this.createAndCleanErrorDiv();this.setParameter(parameter,value,true);var toUpdate=[];var workDone=false;for(var i=0,len=this.components.length;i<len;i++){if($.isArray(this.components[i].listeners)){for(var j=0;j<this.components[i].listeners.length;j++){var comp=this.components[i];if(comp.listeners[j]==parameter&&!comp.disabled){toUpdate.push(comp);break;}}}}
myself.updateAll(toUpdate);};Dashboards.othersAwaitExecution=function(tiers,current){if(!tiers||!current||!current.components){return false;}
tiers[current.priority]=_.difference(tiers[current.priority],current.components);var componentsToUpdate=this.getFirstTier(tiers);if(!componentsToUpdate||!componentsToUpdate.components||componentsToUpdate.components.length==0){return false;}else if(parseInt(componentsToUpdate.priority)>parseInt(current.priority)){return false;}
return true;}
Dashboards.updateAll=function(components){this._throwIfDisposed();if(!this.updating){this.updating={tiers:{},current:null,updatingInFlight:[]};}
if(components&&_.isArray(components)&&!_.isArray(components[0])){var comps={};_.each(components,function(c){if(c){var prio=c.priority||0;if(!comps[prio]){comps[prio]=[];}
comps[prio].push(c);}});components=comps;}
this.mergePriorityLists(this.updating.tiers,components);var updating=this.updating.current;var othersAwaitExecution=false;if(updating===null||updating.components.length==0||(othersAwaitExecution=this.othersAwaitExecution(_.clone(this.updating.tiers),this.updating.current))){var toUpdate=this.getFirstTier(this.updating.tiers);if(!toUpdate)return;if(othersAwaitExecution){var tiers=this.updating.tiers;tiers[updating.priority]=_.difference(tiers[updating.priority],updating.components);toUpdate.components=_.union(tiers[updating.priority],this.getFirstTier(tiers).components);}
this.updating.current=toUpdate;var postExec=function(component,isExecuting){if(arguments.length==2&&typeof isExecuting=="boolean"&&isExecuting){return;}
component.off("cdf:postExecution",postExec);component.off("cdf:preExecution",postExec);component.off("cdf:error",postExec);var current=this.updating.current;current.components=_.without(current.components,component);var tiers=this.updating.tiers;tiers[current.priority]=_.without(tiers[current.priority],component);this.updating.updatingInFlight=_.without(this.updating.updatingInFlight,component);this.updateAll();}
var comps=this.updating.current.components.slice();for(var i=0;i<comps.length;i++){component=comps[i];component.startTimer();component.on("cdf:postExecution cdf:preExecution cdf:error",postExec,this);this.updateComponent(component);if(this.updating.updatingInFlight.indexOf(component)==-1){this.updating.updatingInFlight.push(component);}}}}
Dashboards.getFirstTier=function(tiers){var keys=_.keys(tiers).sort(function(a,b){return parseInt(a,10)-parseInt(b,10);});var tier;for(var i=0;i<keys.length;i++){tier=tiers[keys[i]];if(tier.length>0){return{priority:keys[i],components:tier.slice()};}}
return null;}
Dashboards.mergePriorityLists=function(target,source){if(!source){return;}
for(var key in source)if(source.hasOwnProperty(key)){if(_.isArray(target[key])){target[key]=_.union(target[key],source[key]);}else{target[key]=source[key];}}}
Dashboards.isComponentUpdating=function(component){if(this.updateQueue&&this.updateQueue.indexOf(component)!=-1){return true;}
if(this.updating){if(this.updating.current&&this.updating.current.components){var isRunningCurrent=_.some(this.updating.current.components,function(updatingComp){if(updatingComp===component){return true;}});if(isRunningCurrent){return isRunningCurrent;}}
if(this.updating.tiers){var isRunningTier=_.some(this.updating.tiers,function(tier){return _.some(tier,function(tierComponent){return tierComponent===component;});});if(isRunningTier){return isRunningTier;}}
if(this.updating.updatingInFlight){return _.some(this.updating.updatingInFlight,function(inFlightComponent){return inFlightComponent===component;});}}
return false;};Dashboards.restoreView=function(){var p,params;if(!this.view||!this.view.params){return;}
params=JSON.parse(Base64.decode(this.view.params));if(!params){return;}
if($.isEmptyObject(params)){this.view.params=params;}else{for(p in params){if(params.hasOwnProperty(p)){this.setParameter(p,params[p]);}}}};Dashboards.setParameterViewMode=function(parameter,value){if(!this.viewParameters)this.viewParameters={};if(arguments.length===1)value=this.viewFlags.VIEW;this.viewParameters[parameter]=value;};Dashboards.isViewParameter=function(parameter){if(!this.viewParameters){return false;}
return this.viewParameters[parameter];};Dashboards.getViewParameters=function(){if(!this.viewParameters)return{};var params=this.viewParameters,ret={};for(var p in params)if(params.hasOwnProperty(p)){if(params[p]==this.viewFlags.VIEW||params[p]==this.viewFlags.UNBOUND){ret[p]=this.getParameterValue(p);}}
return ret;};Dashboards.getUnboundParameters=function(){if(!this.viewParameters)return[];var params=this.viewParameters,ret=[]
for(var p in params)if(params.hasOwnProperty(p)){if(params[p]==this.viewFlags.UNBOUND){ret.push(p);}
return ret;}};Dashboards.dispose=function(){if(this.isDisposed){return;}
this.isDisposed=true;this.updateQueue=[];if(this.refreshEngine){this.refreshEngine.dispose();}
if(this.events){this.events={};}
this._disposeComponents();this.args=[];this.storage={};this.chains=[];this.syncedParameters={};this.context={};}
Dashboards._throwIfDisposed=function(){if(this.isDisposed){throw new Error("Invalid operation. The dashboard has been disposed.");}};Dashboards._disposeComponents=function(){if(this.components){var self=this;if(this.components&&this.components.forEach){var componentsToRemove=[];this.components.forEach(function(component){if(component.query&&component.query.dispose){component.query.dispose();}
componentsToRemove.push(component);});componentsToRemove.forEach(function(component){self.removeComponent(component);});}}};Dashboards._getParameterStore=function(){return this.globalContext?window:this.parameters;};Dashboards._isParameterInModel=function(name){return this._getValueFromContext(this._getParameterStore(),name)!==undefined;};Dashboards._getValueFromContext=function(o,path){if(!o)return;if(this._flatParameters){return o[path];}else{if(path!=null){var parts,L;if(path instanceof Array){parts=path;}else{if(path.indexOf('.')<0)return o[path];parts=path.split(".");}
L=parts.length;for(var i=0;i<L;i++){if(!o)return;var part=parts[i],value=o[part];if(value===undefined)return;o=value;}}}
return o;};Dashboards._setValueInContext=function(o,path,v){if(!o||path==null||v===undefined)return;if(this._flatParameters){o[path]=v;}else{var parts,pLast;if(path instanceof Array){parts=path;pLast=parts.pop();}else{if(path.indexOf(".")<0){o[path]=v;return o;}
parts=path.split(".");pLast=parts.pop();}
o=this._getValueFromContext(o,parts);if(o)o[pLast]=v;}
return o;};Dashboards.addParameter=function(name,initValue){if(this._isParameterInModel(name)){initValue=this.getParameterValue(name);}
this.setParameter(name,initValue);return initValue;};Dashboards.getParameterValue=dash.getParam=function(parameterName){return this._getValueFromContext(this._getParameterStore(),parameterName);};Dashboards.setParameter=dash.setParam=function(parameterName,parameterValue,isNotified){if(parameterName==undefined||parameterName=="undefined"||parameterName==""){this.log('Dashboards.setParameter: trying to set undefined or empty string as parameter name!!','warn');return;}
var value;if(!this.globalContext&&this.escapeParameterValues){value=encode_prepare_arr(parameterValue);}else{value=parameterValue;}
if(this._setValueInContext(this._getParameterStore(),parameterName,value)!==undefined){this.parameterModel.set(parameterName,value,{notify:isNotified});this.persistBookmarkables(parameterName);return value;}};Dashboards.post=function(url,obj){var form='<form action="'+url+'" method="post">';for(var o in obj){var v=(typeof obj[o]=='function'?obj[o]():obj[o]);if(typeof v=='string'){v=v.replace(/"/g,"\'")}
form+='"<input type="hidden" name="'+o+'" value="'+v+'"/>';}
form+='</form>';jQuery(form).appendTo('body').submit().remove();};Dashboards.clone=function clone(obj){var c=obj instanceof Array?[]:{};for(var i in obj){var prop=obj[i];if(typeof prop=='object'){if(prop instanceof Array){c[i]=[];for(var j=0;j<prop.length;j++){if(typeof prop[j]!='object'){c[i].push(prop[j]);}else{c[i].push(this.clone(prop[j]));}}}else{c[i]=this.clone(prop);}}else{c[i]=prop;}}
return c;};Dashboards.getArgValue=function(key)
{for(i=0;i<this.args.length;i++){if(this.args[i][0]==key){return this.args[i][1];}}
return undefined;};Dashboards.ev=function(o){return typeof o=='function'?o():o};Dashboards.storage={};Dashboards.loadStorage=function(){var myself=this;if(this.context&&this.context.user==="anonymousUser"){return;}
var args={action:"read",_:Date.now?Date.now():new Date().getTime()};$.ajax({type:'GET',dataType:"json",url:wd.cdf.endpoints.getStorage(args.action),data:args,async:true,xhrFields:{withCredentials:true}}).done(function(json){$.extend(myself.storage,json);});};Dashboards.saveStorage=function(){var myself=this;if(this.context&&this.context.user==="anonymousUser"){return;}
var args={action:"store",storageValue:JSON.stringify(this.storage),_:Date.now?Date.now():new Date().getTime()};$.ajax({type:'GET',dataType:"json",url:wd.cdf.endpoints.getStorage(args.action),data:args,async:true,xhrFields:{withCredentials:true}}).done(function(json){if(json.result!=true){myself.log("Error saving storage",'error');}});};Dashboards.cleanStorage=function(){var myself=this;this.storage={};if(this.context&&this.context.user==="anonymousUser"){return;}
var args={action:"delete"};$.ajax({type:'GET',dataType:"json",url:wd.cdf.endpoints.getStorage(args.action),data:args,async:true,xhrFields:{withCredentials:true}}).done(function(json){if(json.result!=true){myself.log("Error deleting storage",'error');}});};
Dashboards.getErrorObj=function(errorCode){return Dashboards.ERROR_CODES[errorCode]||{};};Dashboards.parseServerError=function(resp,txtStatus,error){var out={};var regexs=[{match:/Query timeout/,msg:Dashboards.getErrorObj('QUERY_TIMEOUT').msg}];out.error=error;out.msg=Dashboards.getErrorObj('COMPONENT_ERROR').msg;var str=$('<div/>').html(resp.responseText).find('h1').text();_.find(regexs,function(el){if(str.match(el.match)){out.msg=el.msg;return true}else{return false}});out.errorStatus=txtStatus;return out};Dashboards.handleServerError=function(){var err=Dashboards.parseServerError.apply(this,arguments);Dashboards.errorNotification(err);Dashboards.trigger('cdf cdf:serverError',this);Dashboards.resetRunningCalls();};Dashboards.errorNotification=function(err,ph){if(ph){wd.cdf.notifications.component.render($(ph),{title:err.msg,desc:""});}else{wd.cdf.notifications.growl.render({title:err.msg,desc:''});}};Dashboards.loginAlert=function(newOpts){var opts={header:"Warning",desc:"You are no longer logged in or the connection to the server timed out",button:"Click to reload this page",callback:function(){window.location.reload(true);}};opts=_.extend({},opts,newOpts);wd.cdf.popups.okPopup.show(opts);this.trigger('cdf cdf:loginError',this);};Dashboards.checkServer=function(){var retVal=false;$.ajax({type:'POST',async:false,dataType:'json',url:wd.cdf.endpoints.getPing(),success:function(result){if(result&&result.ping=='ok'){retVal=true;}else{retVal=false;}},error:function(){retVal=false;}});return retVal;};var wd=wd||{};wd.cdf=wd.cdf||{};wd.cdf.popups=wd.cdf.popups||{};wd.cdf.popups.okPopup={template:"<div class='cdfPopup'>"+"  <div class='cdfPopupHeader'>{{{header}}}</div>"+"  <div class='cdfPopupBody'>"+"    <div class='cdfPopupDesc'>{{{desc}}}</div>"+"    <div class='cdfPopupButton'>{{{button}}}</div>"+"  </div>"+"</div>",defaults:{header:"Title",desc:"Description Text",button:"Button Text",callback:function(){return true;}},$el:undefined,show:function(opts){if(opts||this.firstRender){this.render(opts);}
this.$el.show();},hide:function(){this.$el.hide();},render:function(newOpts){var opts=_.extend({},this.defaults,newOpts);var myself=this;if(this.firstRender){this.$el=$('<div/>').addClass('cdfPopupContainer').hide().appendTo('body');this.firstRender=false;};this.$el.empty().html(Mustache.render(this.template,opts));this.$el.find('.cdfPopupButton').click(function(){opts.callback();myself.hide();});},firstRender:true};wd.cdf.notifications=wd.cdf.notifications||{};wd.cdf.notifications.component={template:"<div class='cdfNotification component {{#isSmallComponent}}small{{/isSmallComponent}}'>"+"  <div class='cdfNotificationBody'>"+"    <div class='cdfNotificationImg'>&nbsp;</div>"+"    <div class='cdfNotificationTitle' title='{{title}}'>{{{title}}}</div>"+"    <div class='cdfNotificationDesc' title='{{desc}}'>{{{desc}}}</div>"+"  </div>"+"</div>",defaults:{title:"Component Error",desc:"Error processing component."},render:function(ph,newOpts){var opts=_.extend({},this.defaults,newOpts);opts.isSmallComponent=($(ph).width()<300);$(ph).empty().html(Mustache.render(this.template,opts));var $nt=$(ph).find('.cdfNotification');$nt.css({'line-height':$nt.height()+'px'});}};wd.cdf.notifications.growl={template:"<div class='cdfNotification growl'>"+"  <div class='cdfNotificationBody'>"+"    <h1 class='cdfNotificationTitle' title='{{title}}'>{{{title}}}</h1>"+"    <h2 class='cdfNotificationDesc' title='{{desc}}'>{{{desc}}}</h2>"+"  </div>"+"</div>",defaults:{title:'Title',desc:'Default CDF notification.',timeout:4000,onUnblock:function(){return true;},css:{position:'absolute',width:'100%',top:'10px'},showOverlay:false,fadeIn:700,fadeOut:1000,centerY:false},render:function(newOpts){var myself=this;if(myself.firstRender){myself.defaults.css=$.extend({},$.blockUI.defaults.growlCSS,myself.defaults.css);}
var opts=_.extend({},myself.defaults,newOpts),$m=$(Mustache.render(myself.template,opts)),outerUnblock=opts.onUnblock;opts.message=$m;opts.onUnblock=function(){myself.$el.hide();outerUnblock.call(this);};if(myself.firstRender){myself.$el=$('<div/>').addClass('cdfNotificationContainer').hide().appendTo('body');myself.firstRender=false;}
myself.$el.show().block(opts);},firstRender:true};
Dashboards.RefreshEngine=function(){var NO_REFRESH=0;var refreshQueue=new Array();var activeTimer=null;var globalRefreshPeriod=NO_REFRESH;var globalTimer=null;Dashboards.RefreshEngine.QueueItem=function(){return{nextRefresh:0,component:null};};var startGlobalRefresh=function(refreshPeriod){if(globalTimer!=null){clearInterval(globalTimer);globalTimer=null;}
globalRefreshPeriod=(refreshPeriod>0)?refreshPeriod:NO_REFRESH;if(globalRefreshPeriod!=NO_REFRESH){globalTimer=setInterval("Dashboards.refreshEngine.fireGlobalRefresh()",globalRefreshPeriod*1000);}};var clearFromQueue=function(component){for(var i=0;i<refreshQueue.length;i++){if(refreshQueue[i].component==component){refreshQueue.splice(i,1);i--;}}};var clearQueue=function(){if(refreshQueue.length>0)refreshQueue.splice(0,refreshQueue.length);};var getSortedInsertPosition=function(coll,elem){var high=coll.length-1;var low=0;var mid;while(low<=high){mid=parseInt((low+high)/2)
if(coll[mid].nextRefresh>elem.nextRefresh){high=mid-1;}else if(coll[mid].nextRefresh<elem.nextRefresh){low=mid+1;}else{return mid;}}
return low;};var sortedInsert=function(rtArray,rtInfo){var pos=getSortedInsertPosition(rtArray,rtInfo);rtArray.splice(pos,0,rtInfo);};var stopTimer=function(){if(activeTimer!=null){clearTimeout(activeTimer);activeTimer=null;}};var restartTimer=function(){stopTimer();Dashboards.refreshEngine.fireRefresh();};var getCurrentTime=function(){var date=new Date();return date.getTime();};var isFirstInQueue=function(component){return refreshQueue.length>0&&refreshQueue[0].component==component;};var refreshComponent=function(component){Dashboards.update(component);};var insertInQueue=function(component){var time=getCurrentTime();if(!(component.refreshPeriod>0)){component.refreshPeriod=NO_REFRESH;}
if(component.refreshPeriod!=NO_REFRESH){var info=new Dashboards.RefreshEngine.QueueItem();info.nextRefresh=time+(component.refreshPeriod*1000);info.component=component;sortedInsert(refreshQueue,info);}};var reinsertInQueue=function(component){clearFromQueue(component);insertInQueue(component);};return{registerComponent:function(component,refreshPeriod){if(!component)return false;component.refreshPeriod=(refreshPeriod>0)?refreshPeriod:NO_REFRESH;var wasFirst=isFirstInQueue(component);clearFromQueue(component);if(wasFirst)restartTimer();return true;},getRefreshPeriod:function(component){if(component&&component.refreshPeriod>0)return component.refreshPeriod;else return NO_REFRESH;},processComponent:function(component){reinsertInQueue(component);if(isFirstInQueue(component))restartTimer();return true;},processComponents:function(){clearQueue();for(var i=0;i<Dashboards.components.length;i++){insertInQueue(Dashboards.components[i]);}
restartTimer();return true;},fireRefresh:function(){activeTimer=null;var currentTime=getCurrentTime();var component=null;while(refreshQueue.length>0&&refreshQueue[0].nextRefresh<=currentTime){var info=refreshQueue.shift();component=info.component;if(!Dashboards.isComponentUpdating(component)){refreshComponent(component);}else{insertInQueue(component);}}
if(refreshQueue.length>0){activeTimer=setTimeout("Dashboards.refreshEngine.fireRefresh()",refreshQueue[0].nextRefresh-currentTime);}},fireGlobalRefresh:function(){for(i=0;i<Dashboards.components.length;i++){var comp=Dashboards.components[i];if(!(comp.refreshPeriod>0)&&comp.type!="select"){refreshComponent(comp);}}},setGlobalRefresh:function(refreshPeriod){startGlobalRefresh(refreshPeriod);},getQueue:function(){return refreshQueue;},dispose:function(){if(activeTimer!=null){clearTimeout(activeTimer);activeTimer=null;}
this.setGlobalRefresh(0);if(refreshQueue.length>0){refreshQueue.splice(0,refreshQueue.length);}},};};Dashboards.refreshEngine=new Dashboards.RefreshEngine();;(function(D){function Container(){this.register=function(type,name,what,scope){if(!type){throw new Error("Argument 'type' is required.");}
if(typeof type!=='string'){throw new Error("Argument 'type' must be a string.");}
if(name!=null){if(typeof name!=='string'){scope=what;what=name;name=null;}else if(!name){name=null;}}
if(!what){throw new Error("Argument 'what' is required.");}
var holder;switch(typeof what){case'function':holder=new FactoryHolder(this,what,scope);break;case'object':holder=new InstanceHolder(this,what,scope);break;default:throw new Error("Argument 'what' is of an invalid type.");}
if(!name){name='';}
var holdersByName=_typesTable[type]||(_typesTable[type]={});var currHolder=holdersByName[name];if(currHolder){currHolder.dispose();}
holdersByName[name]=holder;};this.has=function(type,name){return!!getHolder(type,name,true);};this.canNew=function(type,name){return getHolder(type,name,false)instanceof FactoryHolder;};this.get=function(type,name){return get(type,name,null,false,false);};this.tryGet=function(type,name){return get(type,name,null,false,true);};this.getNew=function(type,name,config){return get(type,name,config,true,false);};this.tryGetNew=function(type,name,config){return get(type,name,config,true,true);};this.getAll=function(type){return getAll(type,false);};this.tryGetAll=function(type){return getAll(type,true);};this.listType=function(type){return getType(type,false);};this.tryListType=function(type){return getType(type,true);};this.dispose=function(){if(_typesTable){for(var type in _typesTable){var holdersByName=_typesTable[type];for(var name in holdersByName){holdersByName[name].dispose();}}
_typesTable=null;}};var _typesTable={};function getType(type,isTry){if(!type){throw new Error("Argument 'type' is required.");}
if(typeof type!=='string'){throw new Error("Argument 'type' must be a string.");}
var holdersByName=_typesTable[type];if(!isTry&&(!holdersByName||isOwnEmpty(holdersByName))){throw new Error("There are no registrations for type '"+type+"'.");}
return holdersByName;}
function getHolder(type,name,isTry){var holder;var holdersByName=getType(type,isTry);if(holdersByName){holder=holdersByName[name||''];if(!holder&&!isTry){throw new Error("There is no registration for type '"+type+"'"+
(name?(" and name '"+name+"'"):"")+".");}}
return holder;}
function get(type,name,config,isNew,isTry){if(typeof name!=='string'){config=name;name='';}
var holder=getHolder(type,name,isTry);if(config){isNew=true;}else
if(!isNew){config={};}
return holder?holder.build(config,isNew):null;}
function getAll(type,isTry){var holdersByName=getType(type,isTry);var instances=[];for(var name in holdersByName){instances.push(holdersByName[name].build({},false));}
return instances;}}
function FactoryHolder(container,factory,scope){var instance;if(!scope){scope='instance';}
this.build=function(config,buildNew){if(instance&&!buildNew){return instance;}
var inst=factory(container,config);if(!buildNew&&scope==='singleton'){instance=inst;}
return inst;};this.dispose=function(){if(instance){doDispose(instance);instance=null;}};}
function InstanceHolder(container,instance,scope){if(!scope){scope='external';}
this.build=function(){return instance;};this.dispose=function(){if(instance){scope==='singleton'&&doDispose(instance);instance=null;}};}
function doDispose(instance){if(typeof instance.dispose==='function'){instance.dispose();}}
var hasOwn=Object.prototype.hasOwnProperty;function isOwnEmpty(o){for(var n in o){if(hasOwn.call(o,n)){return false;}}
return true;}
D.Container=Container;})(Dashboards);;(function(D){function OptionsManager(config){var myself=this;this._options={};this._interfaces={};this._libraries={predicates:{tautology:function(value){return true},isFunction:_.isFunction,isPositive:function(value){return(_.isNumber(value)&&value>0);},isObjectOrPropertiesArray:function(value){return _.isArray(value)||_.isObject(value);},isObject:_.isObject,isArray:_.isArray},mappers:{identity:_.identity,propertiesObject:function(value){return(_.isArray(value))?D.propertiesArrayToObject(value):value;}}};this.mixin=function(instance){instance.getOption=this.getOption;instance.setOption=this.setOption;};this.init=function(defaults,interfaces,libraries){var myself=this;defaults=$.extend(true,{},defaults);interfaces=$.extend(true,{},interfaces);this._libraries=$.extend(true,{},this._libraries,libraries);_.each(interfaces,function(el,key){setInterfaces(key,el);});_.each(defaults,function(el,key){var ifaces=(interfaces&&interfaces[key])||{};setInterfaces(key,ifaces);setValue(key,el);})};this.setOption=function(opt,value,interfaces){setInterfaces(opt,interfaces);var reader=getReader(opt),validator=getValidator(opt);if(validator(value)){value=reader(value);setValue(opt,value);return true}else{throw new Error("Invalid Option "+opt.charAt(0).toUpperCase()+opt.slice(1));}};this.getOption=function(opt){var writer=getWriter(opt),value=getValue(opt);return writer(value);};function setInterfaces(opt,interfaces){interfaces=interfaces||{};setReader(opt,interfaces['reader']);setWriter(opt,interfaces['writer']);setValidator(opt,interfaces['validator']);};function getReader(opt){return get(myself._interfaces,opt,'reader',myself._libraries.mappers['identity'])};function getWriter(opt){return get(myself._interfaces,opt,'writer',myself._libraries.mappers['identity'])};function getValidator(opt){return get(myself._interfaces,opt,'validator',myself._libraries.predicates['tautology'])};function getValue(opt){return get(myself._options,opt,'value')};function setReader(opt,fn){var lib=myself._libraries.mappers;fn=(_.isFunction(fn)&&fn)||(_.isString(fn)&&lib[fn])||getReader(opt)||lib['identity'];return set(myself._interfaces,opt,'reader',fn)};function setWriter(opt,fn){var lib=myself._libraries.mappers;fn=(_.isFunction(fn)&&fn)||(_.isString(fn)&&lib[fn])||getWriter(opt)||lib['identity'];return set(myself._interfaces,opt,'writer',fn)};function setValidator(opt,fn){var lib=myself._libraries.predicates;fn=(_.isFunction(fn)&&fn)||(_.isString(fn)&&lib[fn])||getValidator(opt)||lib['tautology'];return set(myself._interfaces,opt,'validator',fn)};function setValue(opt,value){return set(myself._options,opt,'value',value)};this.init(config.defaults,config.interfaces,config.libraries);}
function get(container,opt,attr,defaultValue){var val=defaultValue||undefined;if(container&&container[opt]&&container[opt].hasOwnProperty(attr)){val=container[opt][attr];}
return val}
function set(container,opt,attr,value){if(container&&opt&&attr){container[opt]=container[opt]||{};container[opt][attr]=value;}}
D.OptionsManager=OptionsManager;})(Dashboards);(function(D){var _BaseQuery=Base;D.getBaseQuery=function(){return _BaseQuery;};D.setBaseQuery=function(QueryClass){if(_.isFunction(QueryClass)&&QueryClass.extend){_BaseQuery=QueryClass;}};D.queryFactories=new D.Container();D.registerQuery=function(type,query){var BaseQuery=this.getBaseQuery();if(!_.isFunction(query)&&_.isObject(query)){var deepProperties={};_.each(BaseQuery.prototype.deepProperties,function(prop){deepProperties[prop]=_.extend({},BaseQuery.prototype[prop],query[prop]);});}
var QueryClass=(_.isFunction(query)&&query)||(_.isObject(query)&&BaseQuery.extend(_.extend({},query,deepProperties)));this.queryFactories.register('Query',type,function(container,config){return new QueryClass(config);});};D.hasQuery=function(type){return Boolean(this.queryFactories&&this.queryFactories.has('Query',type));};D.detectQueryType=function(qd){if(qd){var qt=qd.queryType?qd.queryType:qd.query?'legacy':(qd.path&&qd.dataAccessId)?'cda':undefined;qd.queryType=qt;return this.hasQuery(qt)?qt:undefined;}};D.getQuery=function(type,opts){if(_.isUndefined(type)){type='cda';}else if(_.isObject(type)){opts=type;type=opts.queryType||'cda';}
var query=this.queryFactories.getNew('Query',type,opts);return query;};D.listQueries=function(){return _.keys(this.queryFactories.listType('Query'));};})(Dashboards);Query=function(cd,dataAccessId){var opts,queryType;if(_.isObject(cd)){opts=$.extend(true,{},cd);queryType=(_.isString(cd.queryType)&&cd.queryType)||(!_.isUndefined(cd.query)&&'legacy')||(!_.isUndefined(cd.path)&&!_.isUndefined(cd.dataAccessId)&&'cda')||undefined;}else if(_.isString(cd)&&_.isString(dataAccessId)){queryType='cda';opts={path:cd,dataAccessId:dataAccessId};}
if(!queryType){throw'InvalidQuery'}
return Dashboards.getQuery(queryType,opts);};
Dashboards.escapeHtml=function(input){if(typeof input!=="string"){Dashboards.log("escapeHtml expects string values, returning an empty string","warn");return"";}
return input.replace(/&(?!#([0-9][0-9]?[0-9]?[0-9]?[0-9]?);)(?!([a-zA-Z]{2,8});)(?!#x[A-F0-9][A-F0-9][A-F0-9]?[A-F0-9]?;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&#34;");};Dashboards.sanitizeHtml=function(html){html=html.replace(/<iframe\b[^>]*>/gi,"<script>").replace(/<\/iframe>/gi,"</script>");html=Sanitizer.sanitize(html);return html;};Dashboards.getPathParameter=function(url){url=(url||window.location.pathname);url=decodeURIComponent(url);var pathRegex=url.match("/:(.[^/]+)(.*)/");if(pathRegex.length>1){return(":"+pathRegex[1]).replace(/:/g,"/");}};Dashboards.getLocationSearchString=function(){return window.location.search;};(function(D){var urlParams=undefined;var formProvider=undefined;D.getQueryParameter=function(parameterName){if(urlParams===undefined){var queryString=this.getLocationSearchString();urlParams=$.parseQuery(queryString);}
return urlParams[parameterName]||"";};D.numberFormat=function(value,mask,langCode){if(formProvider===undefined){formProvider=cdo.format.language().createChild();}
if(langCode!=null){var otherFormatP=cdo.format.language(langCode).createChild();otherFormatP.number({mask:mask});return otherFormatP.number()(value);}
formProvider.number({mask:mask});return formProvider.number()(value);};D.configLanguage=function(langCode,config){var dateConfig=config.dateLocale||{};var mLocale=moment.locale();delete config.dateLocale;cdo.format.language(langCode,config);moment.locale(langCode,dateConfig);moment.locale(mLocale);};D.dateFormat=function(date,mask,langCode){var toFormat=moment(date);if(!toFormat.isValid()){return toFormat.toDate();}
if(langCode!=null){if(moment.localeData(langCode)===null){langCode='en-US';}
toFormat.locale(langCode);}
return toFormat.format(mask);};D.dateParse=function(date,mask){return moment(date,mask).toDate();};function _pa2obj(pArray){var obj={};for(var p in pArray)if(pArray.hasOwnProperty(p)){var prop=pArray[p];obj[prop[0]]=prop[1];}
return obj;}
function _obj2pa(obj){var pArray=[];for(var key in obj)if(obj.hasOwnProperty(key)){pArray.push([key,obj[key]]);}
return pArray;}
D.propertiesArrayToObject=function(pArray){return(_.isArray(pArray)&&_pa2obj(pArray))||(_.isObject(pArray)&&pArray)||undefined;};D.objectToPropertiesArray=function(obj){return(_.isArray(obj)&&obj)||(_.isObject(obj)&&_obj2pa(obj))||undefined;};})(Dashboards);Dashboards.eachValuesArray=function(values,opts,f,x){if(typeof opts==='function'){x=f;f=opts;opts=null;}
var valueAsId=!!(opts&&opts.valueAsId);for(var i=0,j=0,L=values.length;i<L;i++){var valSpec=values[i];if(valSpec&&valSpec.length){var v0=valSpec[0];var value,label,id=undefined;if(valSpec.length>1){if(valueAsId){id=v0;}
label=""+valSpec[1];value=(valueAsId||v0==null)?label:(""+v0);}else{value=label=""+v0;}
if(f.call(x,value,label,id,j,i)===false){return false;}
j++;}}
return true;};Dashboards.parseMultipleValues=function(value){if(value!=null&&value!==''){if(this.isArray(value)){return value;}
if(typeof value==="string"){return value.split("|");}}
return null;};Dashboards.normalizeValue=function(value){if(value===''||value==null){return null;}
if(this.isArray(value)&&!value.length)return null;return value;};Dashboards.isArray=function(value){return!!value&&((value instanceof Array)||(typeof value==='object'&&value.join&&value.length!=null));};Dashboards.equalValues=function(a,b){a=this.normalizeValue(a);b=this.normalizeValue(b);if(a===b){return true;}
if(this.isArray(a)&&this.isArray(b)){var L=a.length;if(L!==b.length){return false;}
while(L--){if(!this.equalValues(a[L],b[L])){return false;}}
return true;}
return a==b;};Dashboards.hsvToRgb=function(h,s,v){v=v/100;s=s/100;var h6=(h%360)/60;var chroma=v*s;var m=v-chroma;var h6t=Math.abs((h6%2)-1);var x_m=v*(1-s*h6t);var c_m=v;var rgb;switch(~~h6){case 0:rgb=[c_m,x_m,m];break;case 1:rgb=[x_m,c_m,m];break;case 2:rgb=[m,c_m,x_m];break;case 3:rgb=[m,x_m,c_m];break;case 4:rgb=[x_m,m,c_m];break;case 5:rgb=[c_m,m,x_m];break;}
rgb.forEach(function(val,i){rgb[i]=Math.min(255,Math.round(val*256));});return"rgb("+rgb.join(",")+")";};function encode_prepare_arr(value){if(typeof value=="number"){return value;}else if($.isArray(value)){var a=new Array(value.length);$.each(value,function(i,val){a[i]=encode_prepare(val);});return a;}
else{return encode_prepare(value);}};function encode_prepare(s)
{if(s!=null){s=s.replace(/\+/g," ");if((navigator.userAgent.toLowerCase().indexOf('msie')!=-1)||(navigator.userAgent.toLowerCase().indexOf('opera')!=-1)){return Utf8.decode(s);}}
return s;};var Utf8={encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},decode:function(utftext){var string="";var i=0;var c=0,c2=0,c3=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}}
function getURLParameters(sURL)
{if(sURL.indexOf("?")>0){var arrParams=sURL.split("?");var arrURLParams=arrParams[1].split("&");var arrParam=[];for(var i=0;i<arrURLParams.length;i++){var sParam=arrURLParams[i].split("=");if(sParam[0].indexOf("param",0)==0){var parameter=[sParam[0].substring(5,sParam[0].length),unescape(sParam[1])];arrParam.push(parameter);}}}
return arrParam;}
function toFormatedString(value){value+='';var x=value.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1))
x1=x1.replace(rgx,'$1'+','+'$2');return x1+x2;}
function doCsvQuoting(value,separator,alwaysEscape){var QUOTE_CHAR='"';if(separator==null){return value;}
if(value==null){return null;}
if(value.indexOf(QUOTE_CHAR)>=0){value=value.replace(QUOTE_CHAR,QUOTE_CHAR.concat(QUOTE_CHAR));}
if(alwaysEscape||value.indexOf(separator)>=0){value=QUOTE_CHAR.concat(value,QUOTE_CHAR);}
return value;}
sprintfWrapper={init:function(){if(typeof arguments=='undefined'){return null;}
if(arguments.length<1){return null;}
if(typeof arguments[0]!='string'){return null;}
if(typeof RegExp=='undefined'){return null;}
var string=arguments[0];var exp=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g);var matches=new Array();var strings=new Array();var convCount=0;var stringPosStart=0;var stringPosEnd=0;var matchPosEnd=0;var newString='';var match=null;while((match=exp.exec(string))){if(match[9]){convCount+=1;}
stringPosStart=matchPosEnd;stringPosEnd=exp.lastIndex-match[0].length;strings[strings.length]=string.substring(stringPosStart,stringPosEnd);matchPosEnd=exp.lastIndex;var negative=parseInt(arguments[convCount])<0;if(!negative)negative=parseFloat(arguments[convCount])<0;matches[matches.length]={match:match[0],left:match[3]?true:false,sign:match[4]||'',pad:match[5]||' ',min:match[6]||0,precision:match[8],code:match[9]||'%',negative:negative,argument:String(arguments[convCount])};}
strings[strings.length]=string.substring(matchPosEnd);if(matches.length==0){return string;}
if((arguments.length-1)<convCount){return null;}
match=null;var i=null;for(i=0;i<matches.length;i++){var m=matches[i];var substitution;if(m.code=='%'){substitution='%'}
else if(m.code=='b'){m.argument=String(Math.abs(parseInt(m.argument)).toString(2));substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='c'){m.argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(m.argument)))));substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='d'){m.argument=toFormatedString(String(Math.abs(parseInt(m.argument))));substitution=sprintfWrapper.convert(m);}
else if(m.code=='f'){m.argument=toFormatedString(String(Math.abs(parseFloat(m.argument)).toFixed(m.precision?m.precision:6)));substitution=sprintfWrapper.convert(m);}
else if(m.code=='o'){m.argument=String(Math.abs(parseInt(m.argument)).toString(8));substitution=sprintfWrapper.convert(m);}
else if(m.code=='s'){m.argument=m.argument.substring(0,m.precision?m.precision:m.argument.length)
substitution=sprintfWrapper.convert(m,true);}
else if(m.code=='x'){m.argument=String(Math.abs(parseInt(m.argument)).toString(16));substitution=sprintfWrapper.convert(m);}
else if(m.code=='X'){m.argument=String(Math.abs(parseInt(m.argument)).toString(16));substitution=sprintfWrapper.convert(m).toUpperCase();}
else{substitution=m.match;}
newString+=strings[i];newString+=substitution;}
newString+=strings[i];return newString;},convert:function(match,nosign){if(nosign){match.sign='';}else{match.sign=match.negative?'-':match.sign;}
var l=match.min-match.argument.length+1-match.sign.length;var pad=new Array(l<0?0:l).join(match.pad);if(!match.left){if(match.pad=='0'||nosign){return match.sign+pad+match.argument;}else{return pad+match.sign+match.argument;}}else{if(match.pad=='0'||nosign){return match.sign+match.argument+pad.replace(/0/g,' ');}else{return match.sign+match.argument+pad;}}}}
sprintf=sprintfWrapper.init;(function(){function accessorDescriptor(field,fun)
{var desc={enumerable:true,configurable:true};desc[field]=fun;return desc;}
this.defineGetter=function defineGetter(obj,prop,get)
{if(Object.prototype.__defineGetter__)
return obj.__defineGetter__(prop,get);if(Object.defineProperty)
return Object.defineProperty(obj,prop,accessorDescriptor("get",get));throw new Error("browser does not support getters");}
this.defineSetter=function defineSetter(obj,prop,set)
{if(Object.prototype.__defineSetter__)
return obj.__defineSetter__(prop,set);if(Object.defineProperty)
return Object.defineProperty(obj,prop,accessorDescriptor("set",set));throw new Error("browser does not support setters");}})();
Dashboards.callPentahoAction=function(obj,solution,path,action,parameters,callback){var myself=this;if(typeof callback=='function'){return this.pentahoAction(solution,path,action,parameters,function(json){callback(myself.parseXActionResult(obj,json));});}
else{return this.parseXActionResult(obj,this.pentahoAction(solution,path,action,parameters,callback));}};Dashboards.urlAction=function(url,params,func){return this.executeAjax('xml',url,params,func);};Dashboards.executeAjax=function(returnType,url,params,func){var myself=this;if(typeof func=="function"){return $.ajax({url:url,type:"POST",dataType:returnType,async:true,data:params,complete:function(XMLHttpRequest,textStatus){func(XMLHttpRequest.responseXML);},error:function(XMLHttpRequest,textStatus,errorThrown){myself.log("Found error: "+XMLHttpRequest+" - "+textStatus+", Error: "+errorThrown,"error");}});}
var result=$.ajax({url:url,type:"POST",dataType:returnType,async:false,data:params,error:function(XMLHttpRequest,textStatus,errorThrown){myself.log("Found error: "+XMLHttpRequest+" - "+textStatus+", Error: "+errorThrown,"error");}});if(returnType=='xml'){return result.responseXML;}else{return result.responseText;}};Dashboards.pentahoAction=function(solution,path,action,params,func){return this.pentahoServiceAction('ServiceAction','xml',solution,path,action,params,func);};Dashboards.pentahoServiceAction=function(serviceMethod,returntype,solution,path,action,params,func){var arr=wd.cdf.endpoints.getServiceAction(serviceMethod,solution,path,action);var url=arr.url;delete arr.url;$.each(params,function(i,val){arr[val[0]]=val[1];});return this.executeAjax(returntype,url,arr,func);};Dashboards.CDF_ERROR_DIV='cdfErrorDiv';Dashboards.createAndCleanErrorDiv=function(){if($("#"+Dashboards.CDF_ERROR_DIV).length==0){$("body").append("<div id='"+Dashboards.CDF_ERROR_DIV+"'></div>");}
$("#"+Dashboards.CDF_ERROR_DIV).empty();};Dashboards.showErrorTooltip=function(){$(function(){if($.tooltip){$(".cdf_error").tooltip({delay:0,track:true,fade:250,showBody:" -- "});}});};Dashboards.parseXActionResult=function(obj,html){var jXML=$(html);var error=jXML.find("SOAP-ENV\\:Fault");if(error.length==0){return jXML;}
var errorMessage="Error executing component "+obj.name;var errorDetails=new Array();errorDetails[0]=" Error details for component execution "+obj.name+" -- ";errorDetails[1]=error.find("SOAP-ENV\\:faultstring").find("SOAP-ENV\\:Text:eq(0)").text();error.find("SOAP-ENV\\:Detail").find("message").each(function(){errorDetails.push($(this).text())});if(errorDetails.length>8){errorDetails=errorDetails.slice(0,7);errorDetails.push("...");}
var out="<table class='errorMessageTable' border='0'><tr><td class='errorIcon'></td><td><span class='cdf_error' title=\""+errorDetails.join('<br/>').replace(/"/g,"'")+"\" >"+errorMessage+" </span></td></tr></table/>";if(obj.visible==false){$("#"+Dashboards.CDF_ERROR_DIV).append("<br />"+out);}
else{$('#'+obj.htmlObject).html(out);}
return null;};Dashboards.setSettingsValue=function(name,object){var data={method:"set",key:name,value:JSON.stringify(object)};$.post(wd.cdf.endpoints.getSettings("set",null),data,function(){});};Dashboards.getSettingsValue=function(key,value){var callback=typeof value=='function'?value:function(json){value=json;};$.getJSON(wd.cdf.endpoints.getSettings("get",key),callback);};Dashboards.fetchData=function(cd,params,callback){this.log('Dashboards.fetchData() is deprecated. Use Query objects instead','warn');if(cd!=undefined&&cd.dataAccessId!=undefined){for(var param in params){cd['param'+params[param][0]]=this.getParameterValue(params[param][1]);}
$.post(wd.cdf.endpoints.getDoQuery(),cd,function(json){callback(json);},'json').error(Dashboards.handleServerError);}
else{callback([]);}};;(function(D){D.addIns=new D.Container();D.normalizeAddInKey=function(key,subKey){if(key.indexOf('Component',key.length-'Component'.length)!==-1)
key=key.substring(0,key.length-'Component'.length);key=key.charAt(0).toUpperCase()+key.substring(1);if(subKey){key+="."+subKey;}
return key;}
D.registerAddIn=function(type,subType,addIn){var type=this.normalizeAddInKey(type,subType),name=addIn.getName?addIn.getName():null;this.addIns.register(type,name,addIn);};D.hasAddIn=function(type,subType,addInName){var type=this.normalizeAddInKey(type,subType);return Boolean(this.addIns&&this.addIns.has(type,addInName));};D.getAddIn=function(type,subType,addInName){var type=this.normalizeAddInKey(type,subType);try{var addIn=this.addIns.get(type,addInName);return addIn;}catch(e){return null;}};D.setAddInDefaults=function(type,subType,addInName,defaults){var addIn=this.getAddIn(type,subType,addInName);if(addIn){addIn.setDefaults(defaults);}};D.listAddIns=function(type,subType){var type=this.normalizeAddInKey(type,subType);var addInList=[];try{return this.addIns.listType(type);}catch(e){return[];}};})(Dashboards);Dashboards.safeClone=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2;}
if(typeof target!=="object"&&!jQuery.isFunction(target)){target={};}
for(;i<length;i++){if((options=arguments[i])!=null){for(name in options)if(options.hasOwnProperty(name)){src=target[name];copy=options[name];if(target===copy){continue;}
if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[];}else{clone=src&&jQuery.isPlainObject(src)?src:{};}
target[name]=this.safeClone(deep,clone,copy);}else if(copy!==undefined){target[name]=copy;}}}}
return target;};
Dashboards.getHashValue=function(key){var hash=window.location.hash,obj;try{obj=JSON.parse(hash.slice(1));}catch(e){obj={};}
if(arguments.length===0){return obj;}else{return obj[key];}}
Dashboards.setHashValue=function(key,value){var obj=this.getHashValue(),json;if(arguments.length==1){obj=key;}else{obj[key]=value;}
json=JSON.stringify(obj);if(json!="{}"){window.location.hash=json;}else{if(window.location.hash){window.location.hash='';}}}
Dashboards.deleteHashValue=function(key){var obj=this.getHashValue();if(arguments.length===0){window.location.hash="";}else{delete obj[key];this.setHashValue(obj);}}
Dashboards.setBookmarkable=function(parameter,value){if(!this.bookmarkables)this.bookmarkables={};if(arguments.length===1)value=true;this.bookmarkables[parameter]=value;};Dashboards.isBookmarkable=function(parameter){if(!this.bookmarkables){return false;}
return Boolean(this.bookmarkables[parameter]);};Dashboards.generateBookmarkState=function(){var params={},bookmarkables=this.bookmarkables;for(var k in bookmarkables)if(bookmarkables.hasOwnProperty(k)){if(bookmarkables[k]){params[k]=this.getParameterValue(k);}}
return params;};Dashboards.persistBookmarkables=function(param){var bookmarkables=this.bookmarkables,params={};if(!bookmarkables||!bookmarkables[param]){return;}
if(!this.finishedInit){return;}
params=this.generateBookmarkState();this.setBookmarkState({impl:'client',params:params});}
Dashboards.setBookmarkState=function(state){if(window.history&&window.history.replaceState){var method=window.location.pathname.split('/').pop(),query=window.location.search.slice(1).split('&').map(function(e){var entry=e.split('=');entry[1]=decodeURIComponent(entry[1]);return entry;}),url;query=this.propertiesArrayToObject(query);query.bookmarkState=JSON.stringify(state);url=method+'?'+$.param(query);window.history.replaceState({},'',url);this.deleteHashValue('bookmark');}else{this.setHashValue('bookmark',state);}};Dashboards.getBookmarkState=function(){if(window.location.hash.length>1){try{return this.getHashValue('bookmark')||{};}catch(e){}}
var query=window.location.search.slice(1).split('&').map(function(e){var pair=e.split('=');pair[1]=decodeURIComponent(pair[1]);return pair;}),params=this.propertiesArrayToObject(query);if(params.bookmarkState){return JSON.parse(decodeURIComponent(params.bookmarkState.replace(/\+/g,' ')))||{};}else{return{};}};Dashboards.restoreBookmarkables=function(){var state;this.bookmarkables=this.bookmarkables||{};try{state=this.getBookmarkState().params;for(var k in state)if(state.hasOwnProperty(k)){this.setParameter(k,state[k]);}}catch(e){this.log(e,'error');}};
function AddIn(options){var myself=options;if(typeof options!="object"){throw TypeError;}
if(!options.label||!options.name||(!options.implementation&&!options.value)){throw TypeError;}
var _name=options.name,_label=options.label,_type=options.implementation?"scriptable":"static",_implementation=options.implementation,_defaults=options.defaults,_value=options.options;if(typeof options.init==='function'){options.init.call(myself);}
this.getLabel=function(){return _label;}
this.getName=function(){return _name;}
this.call=function(target,state,options){if(!_implementation){return Dashboards.clone(_value);}
options=typeof options=="function"?options(state):options;var evaluatedDefaults=typeof _defaults=="function"?_defaults(state):_defaults;var compiledOptions=jQuery.extend(true,{},evaluatedDefaults,options);try{return _implementation.call(myself,target,state,compiledOptions);}catch(e){Dashboards.log("Addin Error ["+this.getName()+"]: "+e,"error");}};this.setDefaults=function(defaults){if(typeof defaults=='function'){_defaults=defaults;}
else{_defaults=jQuery.extend(true,{},_defaults,defaults);}};};(function(){var sparkline={name:"sparkline",label:"Sparkline",defaults:{type:'line'},init:function(){var myself=this;$.fn.dataTableExt.oSort[this.name+'-asc']=function(a,b){return myself.sort(a,b)};$.fn.dataTableExt.oSort[this.name+'-desc']=function(a,b){return myself.sort(b,a)};},sort:function(a,b){return this.sumStrArray(a)-this.sumStrArray(b);},sumStrArray:function(arr){return arr.split(',').reduce(function(prev,curr,index,array){Dashboards.log("Current "+curr+"; prev "+prev);return parseFloat(curr)+(typeof(prev)==='number'?prev:parseFloat(prev));});},implementation:function(tgt,st,opt){var t=$(tgt);var data=st.value.split(/,/);if(opt.trim){if(opt.trim.type=="both"||opt.trim.type=="right"){for(var i=data.length-1;i>=0;i--){if($.inArray(data[i].trim(),opt.trim.values)!=-1){data.splice(i,1);}};}
if(opt.trim.type=="both"||opt.trim.type=="left"){for(var i=0;i<data.length;i++){if($.inArray(data[i].trim(),opt.trim.values)!=-1){data.splice(i,1);}};}}
t.sparkline(data,opt);t.removeClass("sparkline");}};Dashboards.registerAddIn("Table","colType",new AddIn(sparkline));var pvSparkline={name:"pvSparkline",label:"Protovis Sparkline",defaults:{height:10,strokeStyle:"#000",lineWidth:1,width:undefined,canvasMargin:2},init:function(){var myself=this;$.fn.dataTableExt.oSort[this.name+'-asc']=function(a,b){return myself.sort(a,b)};$.fn.dataTableExt.oSort[this.name+'-desc']=function(a,b){return myself.sort(b,a)};},sort:function(a,b){return this.sumStrArray(a)-this.sumStrArray(b);},sumStrArray:function(arr){return arr.split(',').reduce(function(prev,curr,index,array){Dashboards.log("Current "+curr+"; prev "+prev);return parseFloat(curr)+(typeof(prev)==='number'?prev:parseFloat(prev));});},implementation:function(tgt,st,opt){var ph=$(tgt),sparklineData=st.value,data=sparklineData.split(",");if(opt.trim){if(opt.trim.type=="both"||opt.trim.type=="right"){for(var i=data.length-1;i>=0;i--){if($.inArray(data[i].trim(),opt.trim.values)!=-1){data.splice(i,1);}};}
if(opt.trim.type=="both"||opt.trim.type=="left"){for(var i=0;i<data.length;i++){if($.inArray(data[i].trim(),opt.trim.values)!=-1){data.splice(i,1);}};}}
n=data.length,w=opt.width||ph.width()-opt.canvasMargin*2,h=opt.height,min=pv.min.index(data),max=pv.max.index(data);ph.empty();var container=$("<div></div>").appendTo(ph);var vis=new pv.Panel().canvas(container.get(0)).width(w).height(h).margin(opt.canvasMargin);vis.add(pv.Line).data(data).left(pv.Scale.linear(0,n-1).range(0,w).by(pv.index)).bottom(pv.Scale.linear(data).range(0,h)).strokeStyle(opt.strokeStyle).lineWidth(opt.lineWidth);vis.render();}};Dashboards.registerAddIn("Table","colType",new AddIn(pvSparkline));var dataBar={name:"dataBar",label:"Data Bar",defaults:{width:undefined,widthRatio:1,height:undefined,align:null,startColor:"#55A4D6",endColor:"#448FC8",backgroundImage:undefined,stroke:null,max:undefined,min:undefined,includeValue:false,absValue:true,valueFormat:function(v,format,st,opt){return""+sprintf(format||"%.1f",v);}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['numeric-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['numeric-desc'];},implementation:function(tgt,st,opt){var tblMax=Math.max.apply(Math,st.tableData.map(function(e){return e[st.colIdx];})),tblMin=Math.min.apply(Math,st.tableData.map(function(e){return e[st.colIdx];}));var optMax=parseFloat(opt.max);var optMin=parseFloat(opt.min);var isValidNumber=function(nr){return _.isNumber(nr)&&isFinite(nr);};var validMaxValue=isValidNumber(optMax);var validMinValue=isValidNumber(optMin);if(opt.absValue){var max=(validMaxValue==true)?optMax:Math.max(Math.abs(tblMax),Math.abs(tblMin)),min=(validMinValue==true)?optMin:0,val=Math.abs(parseFloat(st.value));min=Math.max(min,0);}else{var max=(validMaxValue==true)?optMax:Math.max(0,tblMax),min=(validMinValue==true)?optMin:Math.min(0,tblMin),val=parseFloat(st.value);}
var hasSVG=!!(document.createElementNS&&document.createElementNS('http://www.w3.org/2000/svg','svg').createSVGRect);var cell=$(tgt);cell.empty();var ph=$("<div>&nbsp;</div>").addClass('dataBarContainer').appendTo(cell);var wtmp=opt.width||ph.width();if(typeof wtmp==='string'){if(!hasSVG){wtmp=ph.width()*opt.widthRatio;}else{var parsedWidth=parseFloat(wtmp);parsedWidth=((opt.widthRatio!=1&&parsedWidth>=98)?100:parsedWidth)*opt.widthRatio;wtmp=parsedWidth+"%";}}else{wtmp*=opt.widthRatio;}
var htmp=opt.height||ph.height();var leftVal=Math.min(val,0),rightVal=Math.max(val,0);var options={scale:100,wtmp:wtmp,htmp:htmp,align:opt.align,barHeight:100,r:rightVal,l:leftVal,hasSVG:hasSVG,target:ph.get(0),processVal:function(val){return val+'%'}};var c;if(hasSVG&&typeof wtmp==='string'){c=this.drawPaper(min,max,options);}else{options.processVal=function(val){return val};options.scale=wtmp;options.barHeight=htmp;options.legacy=true;c=this.drawPaper(min,max,options);}
c.attr({fill:opt.backgroundImage?"url('"+opt.backgroundImage+"')":"90-"+opt.startColor+"-"+opt.endColor,stroke:opt.stroke,title:"Value: "+st.value});if(opt.includeValue){var valueStr=opt.valueFormat(st.value,st.colFormat,st,opt);var valph=$("<span></span>").addClass('value');valph.append(valueStr);if(options.legacy){valph.appendTo(ph);}else if(hasSVG&&opt.align=="right"){valph.addClass('alignRight').appendTo(ph);ph.find("svg").css('float','right');}else{valph.prependTo(ph);}}},drawPaper:function(min,max,opts){var xx=pv.Scale.linear(min,max).range(0,opts.scale);var paper=Raphael(opts.target,opts.legacy?xx(Math.min(opts.r,max))-xx(min):opts.wtmp,opts.htmp);if(!opts.legacy&&opts.hasSVG&&opts.align=="right"){return paper.rect(opts.processVal(xx(max)-xx(opts.r)),opts.processVal(0),opts.processVal(xx(opts.r)-xx(opts.l)),opts.processVal(opts.barHeight));}
return paper.rect(opts.processVal(xx(opts.l)),opts.processVal(0),opts.processVal(xx(opts.r)-xx(opts.l)),opts.processVal(opts.barHeight));}};Dashboards.registerAddIn("Table","colType",new AddIn(dataBar));var trendArrow={name:"trendArrow",label:"Trend Arrows",defaults:{good:true,includeValue:false,valueFormat:function(v,format,st,opt){return sprintf(format||"%.1f",v);},thresholds:{up:0,down:0}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['numeric-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['numeric-desc'];},implementation:function(tgt,st,opt){var ph=$(tgt),qualityClass=opt.good?"good":"bad",isNumeric=typeof st.value=="number"||(typeof st.value=="string"&&Number(st.value).toString()!='NaN'),trendClass=!isNumeric?"invalid":(st.value>opt.thresholds.up?"up":st.value<opt.thresholds.down?"down":"neutral");var trend=$("<div>&nbsp;</div>");trend.addClass('trend '+trendClass+' '+qualityClass);ph.empty();if(opt.includeValue){var valph=$("<div class='value'></div>").append(opt.valueFormat(st.value,st.colFormat,st,opt));valph.appendTo(ph);}
ph.append(trend);}};Dashboards.registerAddIn("Table","colType",new AddIn(trendArrow));var link={name:"hyperlink",label:"Hyperlink",defaults:{openInNewTab:true,prependHttpIfNeeded:true,regexp:null,pattern:null,urlReference:2,labelReference:1},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var ph=$(tgt);var link,label;if(opt.pattern){var re=new RegExp(opt.pattern),results=re.exec(st.value);link=results[opt.urlReference];label=results[opt.labelReference];}else{link=st.value;label=st.value;}
if(opt.prependHttpIfNeeded&&!/^https?:\/\//.test(link)){link="http://"+link;}
if(opt.regexp==null||(new RegExp(opt.regexp).test(st.value))){var a=$("<a></a>").attr("href",link).addClass("hyperlinkAddIn");a.text(label);if(opt.openInNewTab){a.attr("target","_blank");}
ph.empty().append(a);}}};Dashboards.registerAddIn("Table","colType",new AddIn(link));var circle={name:"circle",label:"Circle",defaults:{canvasSize:10,radius:4,color:'black',title:function(st,opt){return"Value: "+st.value;}},implementation:function(tgt,st,opt){var p=$(tgt).empty(),v=st.value,op,options={},w,paper;for(key in opt)if(opt.hasOwnProperty(key)){op=opt[key];options[key]=typeof op=='function'?op.call(this,st,opt):op;}
w=options.canvasSize;paper=Raphael(tgt,options.canvasSize,options.canvasSize);var r=paper.circle(w/2,w/2,options.radius);r.attr({fill:options.color,opacity:1,"stroke":"none","title":options.title});}};Dashboards.registerAddIn("Table","colType",new AddIn(circle));var bullet={name:"cccBulletChart",label:"Bullet Chart",defaults:{height:40,animate:false,orientation:"horizontal",bulletSize:16,bulletSpacing:150,bulletMargin:5,bulletRanges:[30,80,100],extensionPoints:{"bulletMarker_shape":"triangle","bulletTitle_textStyle":"green","bulletMeasure_fillStyle":"black","bulletRuleLabel_font":"8px sans-serif","bulletRule_height":5}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},sort:function(){},implementation:function(tgt,st,opt){var chartOptions=$.extend(true,{},opt);var $tgt=$(tgt);var target=$("<span></span>").appendTo($tgt.empty());var values=st.value.split(",");var data=this.getData(values);chartOptions.canvas=target.get(0);chartOptions.width=chartOptions.width||$tgt.width();chartOptions.bulletMeasures=[values[0]];chartOptions.bulletMarkers=[values[1]];var chart=new pvc.BulletChart(chartOptions);chart.setData(data,{});chart.render();},getData:function(values){var dataSet={resultset:[values],metadata:[]},i;for(i=0;i<values.length;i++){dataSet.metadata.push({colIndex:i,colType:"String",colName:""});}
return dataSet;}};Dashboards.registerAddIn("Table","colType",new AddIn(bullet));var formattedText={name:"formattedText",label:"Formatted Text",defaults:{textFormat:function(v,st,opt){return st.colFormat?sprintf(st.colFormat,v):v;}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var text=opt.textFormat.call(this,st.value,st,opt);$(tgt).empty().append(text);}};Dashboards.registerAddIn("Table","colType",new AddIn(formattedText));var localizedText={name:"localizedText",label:"Localized Text",defaults:{localize:function(v,st,opt){return Dashboards.i18nSupport.prop(v);}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){var text=this.defaults.localize(st.value,st,opt);$(tgt).empty().append(text);st.tableData[st.rowIdx][st.colIdx]=text;}}};Dashboards.registerAddIn("Table","colType",new AddIn(localizedText));var groupHeaders={name:"groupHeaders",label:"Group Headers",defaults:{hide:true,columnHeadersInGroups:false,replaceFirstHeader:true,textFormat:function(v,st,opt){return st.colFormat?sprintf(st.colFormat,v):v;}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var dt=$(tgt).parents('table').eq(0).dataTable(),visColIdx=$(tgt).index();if(opt.hide){dt.find('.groupHeaders:nth-child('+(visColIdx+1)+')').addClass('hiddenCol');}
if(opt.columnHeadersInGroups){var header=dt.find("thead").eq(0);header.find("tr").clone}
var $row=$(dt.fnGetNodes(st.rowIdx)),visRowIdx=$row.index(),count=$row.children().length,$group;if(visRowIdx===0||$row.prev().hasClass('groupHeader')||(st.value!=dt.fnGetData($row.prev().get(0))[st.colIdx])){$group=this.buildHeader(tgt,st,opt);$group.insertBefore($row);}},buildHeader:function(tgt,st,opt){var $header,$dt=$(tgt).parents('table').eq(0).dataTable(),$theader,headerText=opt.textFormat.call(this,st.value,st,opt);if(opt.columnHeadersInGroups){$theader=$dt.find("thead").eq(0);$theader.hide();$header=$("<tr>");$theader.find("tr th").each(function(i,e){var $e=$(e),newCell=$("<td>").text($e.text()).width(e.style.width);newCell.addClass($(e).hasClass("hiddenCol")?"hiddenCol":"");$header.append(newCell);});$header.find("td").eq($(tgt).index()+1).empty().append(headerText).addClass("groupName");}else{$header=$("<tr/>");$("<td/>").addClass("groupName").empty().append(headerText).attr("colspan",$(tgt).siblings().length+1).appendTo($header);}
$header.addClass("groupHeader group"+$(tgt).index());var $preSpace=$("<td>").attr("colspan",$(tgt).siblings().length+1).wrap("<tr>").parent().addClass("groupHeader preSpace");var $postSpace=$("<td>").attr("colspan",$(tgt).siblings().length+1).wrap("<tr>").parent().addClass("groupHeader postSpace");var $response=$preSpace.add($header).add($postSpace);return $response;}};Dashboards.registerAddIn("Table","colType",new AddIn(groupHeaders));var clippedText={name:"clippedText",label:"Clipped Text",defaults:{showTooltip:true,useTipsy:false,style:{}},init:function(){$.fn.dataTableExt.oSort[this.name+'-asc']=$.fn.dataTableExt.oSort['string-asc'];$.fn.dataTableExt.oSort[this.name+'-desc']=$.fn.dataTableExt.oSort['string-desc'];},implementation:function(tgt,st,opt){var $tgt=$(tgt),$container=$("<div>");$tgt.empty().append($container);$container.text(st.value).addClass("clippedText").attr("title",opt.showTooltip?st.value:"");$container.css(opt.style);if(opt.useTipsy){$container.tipsy({gravity:'s',html:false});}}};Dashboards.registerAddIn("Table","colType",new AddIn(clippedText));})();;(function(){var BaseQuery=Base.extend({name:"baseQuery",label:"Base Query",deepProperties:['defaults','interfaces'],defaults:{successCallback:function(){Dashboards.log('Query success callback not defined. Override.');},errorCallback:function(jqXHR,textStatus,errorThrown){if(Dashboards&&typeof Dashboards.handleServerError==='function'){Dashboards.handleServerError(jqXHR,textStatus,errorThrown);return;}
Dashboards.log('Query error callback not defined. Override.')},lastResultSet:null,lastProcessedResultSet:null,page:0,pageSize:0,params:{},pushEnabled:false,ajaxOptions:{async:false,type:'POST'},url:''},interfaces:{params:{reader:'propertiesObject',validator:'isObjectOrPropertiesArray'},successCallback:{validator:'isFunction'},errorCallback:{validator:'isFunction'},pageSize:{validator:'isPositive'}},constructor:function(config){if(Dashboards&&Dashboards.OptionsManager){this._optionsManager=new Dashboards.OptionsManager(this);this._optionsManager.mixin(this);}
this.init(config);},getOption:function(prop){return this.defaults[prop];},setOption:function(prop,value){this.defaults[prop]=value;},init:function(opts){},getSuccessHandler:function(callback){var myself=this;return function(json){myself.setOption('lastResultSet',json);var clone=$.extend(true,{},myself.getOption('lastResultSet'));myself.setOption('lastProcessedResultSet',clone);json=callback(clone);if(json!==undefined&&json!==clone){myself.setOption('lastProcessedResultSet',json);}};},getErrorHandler:function(callback){return function(resp,txtStatus,error){if(callback){callback(resp,txtStatus,error);}};},doQuery:function(successCallback,errorCallback){if(typeof this.getOption('successCallback')!='function'){throw'QueryNotInitialized';}
var successHandler=successCallback?successCallback:this.getOption('successCallback');var errorHandler=errorCallback?errorCallback:_.bind(this.getOption('errorCallback'),this);var queryDefinition=this.buildQueryDefinition();var isFirstTime=true;if(this.getOption('pushEnabled')){var myself=this;this.websocket=new WebSocket(this.getOption('websocketUrl'),'JSON-CDA-query');this.websocket.onopen=function(event){myself.websocket.send(JSON.stringify(queryDefinition));};this.websocket.onmessage=function(event){var isDataPush=!isFirstTime;isFirstTime=false;if(JSON){myself.getSuccessHandler(function(data){return successHandler(data,isDataPush);})(JSON.parse(event.data));}else{try{myself.websocket.close(1001);}catch(err){}}};this.websocket.onerror=function(event){var isDataPush=!isFirstTime;isFirstTime=false;myself.getErrorHandler(function(resp,txtStatus,error){errorHandler(resp,txtStatus,error,isDataPush);})(event.data);};this.websocket.onclose=function(event){if(event.code===1011){var isDataPush=!isFirstTime;isFirstTime=false;myself.getErrorHandler(function(resp,txtStatus,error){errorHandler(resp,txtStatus,error,isDataPush);})(event.reason);}}}else{var settings=_.extend({},this.getOption('ajaxOptions'),{data:queryDefinition,url:this.getOption('url'),success:this.getSuccessHandler(successHandler),error:this.getErrorHandler(errorHandler)});var async=settings.async==null?$.ajaxSettings.async:settings.async;if(!async&&settings.xhrFields&&settings.xhrFields.withCredentials){Dashboards.log("Cross-domain requests are deprecated for synchronous operations.");delete settings.xhrFields.withCredentials;}
$.ajax(settings);}},exportData:function(){},setAjaxOptions:function(newOptions){this.setOption('ajaxOptions',_.extend({},this.getOption('ajaxOptions'),newOptions));},setSortBy:function(sortBy){},sortBy:function(sortBy,outsideCallback){},fetchData:function(params,successCallback,errorCallback){switch(arguments.length){case 0:if(this.getOption('params')&&this.getOption('successCallback')){return this.doQuery();}
break;case 1:if(typeof arguments[0]=="function"){return this.doQuery(arguments[0]);}else if(!_.isEmpty(arguments[0])&&(_.isObject(arguments[0])||_.isArray(arguments[0]))){this.setOption('params',arguments[0]||{});return this.doQuery();}
break;case 2:if(typeof arguments[0]=="function"){this.setOption('successCallback',arguments[0]);if(typeof arguments[1]=="function"){this.setOption('errorCallback',arguments[1]);}
return this.doQuery();}else{this.setOption('params',arguments[0]||{});this.setOption('successCallback',arguments[1]);return this.doQuery();}
break;default:if(params){this.setOption('params',params);}
if(typeof arguments[1]=="function"){this.setOption('successCallback',successCallback);}
if(typeof arguments[2]=="function"){this.setOption('errorCallback',errorCallback);}
return this.doQuery();}
throw"InvalidInput";},lastResults:function(){if(this.getOption('lastResultSet')!==null){return $.extend(true,{},this.getOption('lastResultSet'));}else{throw"NoCachedResults";}},lastProcessedResults:function(){if(this.getOption('lastProcessedResultSet')!==null){return $.extend(true,{},this.getOption('lastProcessedResultSet'));}else{throw"NoCachedResults";}},reprocessLastResults:function(outerCallback){if(this.getOption('lastResultSet')!==null){var clone=$.extend(true,{},this.getOption('lastResultSet'));var callback=outerCallback||this.getOption('successCallback');myself.setOption('lastProcessedResultSet',clone);var result=callback(clone);if(result!==undefined&&result!==clone){myself.setOption('lastProcessedResultSet',result);}
return result;}else{throw"NoCachedResults";}},reprocessResults:function(outsideCallback){if(this.getOption('lastResultSet')!==null){var clone=$.extend(true,{},this.getOption('lastResultSet'));var callback=(outsideCallback?outsideCallback:this.getOption('successCallback'));callback(clone);}else{throw"NoCachedResults";}},setParameters:function(params){this.setOption('params',params);},setCallback:function(callback){this.setOption('successCallback',callback);},setErrorCallback:function(callback){this.setOption('errorCallback',callback);},setSearchPattern:function(pattern){this.setOption('searchPattern',pattern);},nextPage:function(outsideCallback){var page=this.getOption('page'),pageSize=this.getOption('pageSize');if(pageSize>0){page+=pageSize;this.setOption('page',page);return this.doQuery(outsideCallback);}else{throw"InvalidPageSize";}},previousPage:function(outsideCallback){var page=this.getOption('page'),pageSize=this.getOption('pageSize');if(page>pageSize){page-=pageSize;this.setOption('page',page);return this.doQuery(outsideCallback);}else if(pageSize>0){this.setOption('page',0);return this.doQuery(outsideCallback);}else{throw"AtBeginning";}},getPage:function(targetPage,outsideCallback){var page=this.getOption('page'),pageSize=this.getOption('pageSize');if(targetPage*pageSize==page){return false;}else if(typeof targetPage=='number'&&targetPage>=0){this.setOption('page',targetPage*pageSize);return this.doQuery(outsideCallback);}else{throw"InvalidPage";}},setPageStartingAt:function(targetPage){if(targetPage==this.getOption('page')){return false;}else if(typeof targetPage=='number'&&targetPage>=0){this.setOption('page',targetPage);}else{throw"InvalidPage";}},pageStartingAt:function(page,outsideCallback){if(this.setPageStartingAt(page)!==false){return this.doQuery(outsideCallback);}else{return false;}},setPageSize:function(pageSize){this.setOption('pageSize',pageSize);},initPage:function(pageSize,outsideCallback){if(pageSize==this.getOption('pageSize')&&this.getOption('page')==0){return false;}else if(typeof pageSize=='number'&&pageSize>0){this.setOption('page',0);this.setOption('pageSize',pageSize);return this.doQuery(outsideCallback);}else{throw"InvalidPageSize";}},dispose:function(){if(this.websocket){this.websocket.close(1000);this.websocket=null;}}});Dashboards.setBaseQuery(BaseQuery);var CpkEndpointsOpts={name:"cpk",label:"CPK",defaults:{url:'',pluginId:'',endpoint:'',systemParams:{},ajaxOptions:{dataType:'json',type:'POST',async:true,xhrFields:{withCredentials:true}}},init:function(opts){if(_.isString(opts.pluginId)&&_.isString(opts.endpoint)){this.setOption('pluginId',opts.pluginId);this.setOption('endpoint',opts.endpoint);this.setOption('url',wd.cdf.endpoints.getPluginEndpoint(opts.pluginId,opts.endpoint));}
this.setOption('kettleOutput',opts.kettleOutput);this.setOption('stepName',opts.stepName);this.setOption('systemParams',opts.systemParams||{});this.setOption('ajaxOptions',$.extend({},this.getOption('ajaxOptions'),opts.ajaxOptions));var ajaxOptions=this.getOption('ajaxOptions');if(ajaxOptions.dataType=='json'){ajaxOptions.mimeType='application/json; charset utf-8';this.setOption('ajaxOptions',ajaxOptions);}},buildQueryDefinition:function(overrides){overrides=(overrides instanceof Array)?Dashboards.propertiesArrayToObject(overrides):(overrides||{});var queryDefinition={kettleOutput:this.getOption('kettleOutput'),stepName:this.getOption('stepName')};queryDefinition=$.extend(true,{},queryDefinition,this.getOption('systemParams'));var cachedParams=this.getOption('params'),params=$.extend({},cachedParams,overrides);_.each(params,function(value,name){var paramValue,printValue;try{paramValue=Dashboards.getParameterValue(value);}catch(e){if(!_.isObject(value)||_.isFunction(value)){printValue=value;}else{printValue=JSON.stringify(value);}
Dashboards.log("BuildQueryDefinition detected static parameter "+name+"="+printValue+". "+"The parameter will be used as value instead its value obtained from getParameterValue");paramValue=value;}
if(paramValue===undefined){paramValue=value;}
if(_.isFunction(paramValue)){paramValue=paramValue();}else if(_.isObject(paramValue)){paramValue=JSON.stringify(paramValue);}
queryDefinition['param'+name]=paramValue;});return queryDefinition;},getSuccessHandler:function(callback){var myself=this;return function(json){myself.setOption('lastResultSet',json);if(json&&json.result==false){var errorCallback=myself.getErrorHandler(myself.getOption('errorCallback'));errorCallback(json);}else{var clone=$.extend(true,{},myself.getOption('lastResultSet'));myself.setOption('lastProcessedResultSet',clone);json=callback(clone);if(json!==undefined&&json!==clone){myself.setOption('lastProcessedResultSet',json);}}};}};Dashboards.registerQuery("cpk",CpkEndpointsOpts);var cdaQueryOpts={name:'cda',label:'CDA Query',defaults:{url:wd.cdf.endpoints.getDoQuery(),websocketUrl:wd.cdf.endpoints.getWebsocketQuery(),file:'',id:'',outputIdx:'1',sortBy:'',pushEnabled:false,ajaxOptions:{async:true,xhrFields:{withCredentials:true}},searchPattern:''},init:function(opts){if(typeof opts.path!='undefined'&&typeof opts.dataAccessId!='undefined'){this.setOption('file',opts.path);this.setOption('id',opts.dataAccessId);if(typeof opts.sortBy=='string'&&opts.sortBy.match("^(?:[0-9]+[adAD]?,?)*$")){this.setOption('sortBy',opts.sortBy);}
if(opts.pageSize!=null){this.setOption('pageSize',opts.pageSize);}
if(opts.outputIndexId!=null){this.setOption('outputIdx',opts.outputIndexId);}
if(opts.pushEnabled!=null){this.setOption('pushEnabled',opts.pushEnabled);}}else{throw'InvalidQuery';}},buildQueryDefinition:function(overrides){overrides=(overrides instanceof Array)?Dashboards.propertiesArrayToObject(overrides):(overrides||{});var queryDefinition={};var cachedParams=this.getOption('params'),params=$.extend({},cachedParams,overrides);_.each(params,function(value,name){var paramValue;try{paramValue=Dashboards.getParameterValue(value);}catch(e){var printValue="";if(!_.isObject(value)||_.isFunction(value)){printValue=value;}else{printValue=JSON.stringify(value);}
Dashboards.log("BuildQueryDefinition detected static parameter "+name+"="+printValue+". "+"The parameter will be used instead the parameter value");paramValue=value;}
if(paramValue===undefined){paramValue=value;}
if($.isArray(paramValue)&&paramValue.length==1&&(''+paramValue[0]).indexOf(';')>=0){paramValue=doCsvQuoting(paramValue[0],';');}
if(typeof paramValue=='function'){paramValue=paramValue();}
queryDefinition['param'+name]=paramValue;});queryDefinition.path=this.getOption('file');queryDefinition.dataAccessId=this.getOption('id');queryDefinition.outputIndexId=this.getOption('outputIdx');queryDefinition.pageSize=this.getOption('pageSize');queryDefinition.pageStart=this.getOption('page');queryDefinition.sortBy=this.getOption('sortBy');queryDefinition.paramsearchBox=this.getOption('searchPattern');return queryDefinition;},exportData:function(outputType,overrides,options){if(!options){options={};}
var queryDefinition=this.buildQueryDefinition(overrides);queryDefinition.outputType=outputType;if(outputType=='csv'&&options.separator){queryDefinition.settingcsvSeparator=options.separator;}
if(options.filename){queryDefinition.settingattachmentName=options.filename;}
if(outputType=='xls'&&options.template){queryDefinition.settingtemplateName=options.template;}
if(options.columnHeaders){queryDefinition.settingcolumnHeaders=options.columnHeaders;}
if(options.exportPage===false){queryDefinition.pageSize=0;queryDefinition.pageStart=0;}
if(options.dtFilter!=null){queryDefinition.settingdtFilter=options.dtFilter;if(options.dtSearchableColumns!=null){queryDefinition.settingdtSearchableColumns=options.dtSearchableColumns;}}
queryDefinition.wrapItUp='true';$.ajax({type:'POST',dataType:'text',async:true,data:queryDefinition,url:this.getOption('url'),xhrFields:{withCredentials:true}}).done(function(uuid){var _exportIframe=$('<iframe style="display:none">');_exportIframe.detach();_exportIframe[0].src=wd.cdf.endpoints.getUnwrapQuery({"path":queryDefinition.path,"uuid":uuid});_exportIframe.appendTo($('body'));}).fail(function(jqXHR,textStatus,errorThrown){Dashboards.log("Request failed: "+jqXHR.responseText+" :: "+textStatus+" ::: "+errorThrown);});},setSortBy:function(sortBy){var newSort,myself=this;if(sortBy===null||sortBy===undefined||sortBy===''){newSort='';}
else if(typeof sortBy=="string"){if(!sortBy.match("^(?:[0-9]+[adAD]?,?)*$")){throw"InvalidSortExpression";}
newSort=sortBy.toUpperCase().split(',').filter(function(e){return e!=="";});}else if(sortBy instanceof Array){newSort=sortBy.map(function(d){return d.toUpperCase();});var invalidEntries=newSort.filter(function(e){return!e.match("^[0-9]+[adAD]?,?$");});if(invalidEntries.length>0){throw"InvalidSortExpression";}}
var same;if(newSort instanceof Array){same=newSort.length!=myself.getOption('sortBy').length;$.each(newSort,function(i,d){same=(same&&d==myself.getOption('sortBy')[i]);if(!same){return false;}});}else{same=(newSort===this.getOption('sortBy'));}
this.setOption('sortBy',newSort);return!same;},sortBy:function(sortBy,outsideCallback){var changed=this.setSortBy(sortBy);if(!changed){return false;}else if(this.getOption('successCallback')!==null){return this.doQuery(outsideCallback);}}};Dashboards.registerQuery("cda",cdaQueryOpts);})();;(function(){SharedXmla=Base.extend({xmla:null,datasource:null,catalogs:null,getDataSources:function(){var datasourceCache=[],rowset_ds=this.xmla.discoverDataSources();if(rowset_ds.hasMoreRows()){datasourceCache=rowset_ds.fetchAllAsObject();this.datasource=datasourceCache[0];var dataSourceName=this.datasource[Xmla.PROP_DATASOURCENAME];if(dataSourceName&&dataSourceName.length>0){this.datasource[Xmla.PROP_DATASOURCEINFO]=dataSourceName;}
rowset_ds.close();return;}},getCatalogs:function(){var properties={};this.catalogs=[],catalog={};properties[Xmla.PROP_DATASOURCEINFO]=this.datasource[Xmla.PROP_DATASOURCEINFO];var rowset_cat=this.xmla.discoverDBCatalogs({properties:properties});if(rowset_cat.hasMoreRows()){while(catalog=rowset_cat.fetchAsObject()){this.catalogs[this.catalogs.length]=catalog;}
rowset_cat.close();}},discover:function(param){var properties={},rows=[],restrictions={},qry=param.query();properties[Xmla.PROP_DATASOURCEINFO]=this.datasource[Xmla.PROP_DATASOURCEINFO];if(param.catalog){properties[Xmla.PROP_CATALOG]=param.catalog;}
var rowset_discover=this.xmla.discover({properties:properties,requestType:qry});return rowset_discover;},execute:function(param){for(var i=0,j=_sharedXmla.catalogs.length;i<j;i++){if(_sharedXmla.catalogs[i]["CATALOG_NAME"]==param.catalog){var properties={};properties[Xmla.PROP_DATASOURCEINFO]=_sharedXmla.datasource[Xmla.PROP_DATASOURCEINFO];properties[Xmla.PROP_CATALOG]=param.catalog;properties[Xmla.PROP_FORMAT]=_sharedXmla.PROP_FORMAT||Xmla.PROP_FORMAT_TABULAR;var result=this.xmla.execute({statement:param.query(),properties:properties});return result;}}
throw new Error("Catalog: "+param.catalog+" was not found on Pentaho server.");}});var _sharedXmla=new SharedXmla();var _isScriptLoaded=false;var _scriptLocation=wd.cdf.endpoints.getXmlaStaticResource();function loadXmlaScript(){if(!_isScriptLoaded){$.ajax({url:_scriptLocation,dataType:"script",success:function(){_isScriptLoaded=true;},async:false});}}
var xmlaOpts={name:"xmla",label:"XMLA",queryDefinition:{},defaults:{url:wd.cdf.endpoints.getXmla()},init:function(queryDefinition){this.queryDefinition=$.extend({},this.getOption('params'),queryDefinition);loadXmlaScript();if(_sharedXmla.xmla==null){_sharedXmla.xmla=new Xmla({async:false,url:this.getOption('url')});}
if(_sharedXmla.datasource==null){_sharedXmla.getDataSources();}
if(_sharedXmla.catalogs==null){_sharedXmla.getCatalogs();}},transformXMLAresults:function(results){var rows,cols,col,res={resultset:[],metadata:[]};if(results instanceof Xmla.Rowset){rows=results.fetchAllAsArray();cols=results.getFields();}
else if(results instanceof Xmla.Dataset){}
for(var i=0,j=cols.length;i<j;i++){col=cols[i];res.metadata[i]={colIndex:col.index,colName:col.label};switch(col.jsType){case"string":res.metadata[i].colType="string";break;case"number":res.metadata[i].colType="numeric";break;default:res.metadata[i].colType="string";}}
res.resultset=rows;results.close();return res;},doQuery:function(outsideCallback){var url=this.getOption('url'),callback=(outsideCallback?outsideCallback:this.getOption('successCallback')),errorCallback=this.getOption('errorCallback');try{var result=this.transformXMLAresults(_sharedXmla.execute(this.queryDefinition));this.setOption('lastResultSet',result);var clone=$.extend(true,{},this.getOption('lastResultSet'));this.setOption('lastProcessedResultSet',clone);result=callback(clone);if(result!==undefined&&result!==clone){this.setOption('lastProcessedResultSet',result);}}catch(e){Dashboards.error('unable to execute xmla addin query: '+e+' :');}}};Dashboards.registerQuery("xmla",xmlaOpts);var xmlaDiscoverOpts={name:"xmlaDiscover",label:"XMLA Discover",queryDefinition:{},defaults:{url:wd.cdf.endpoints.getXmla()},init:function(queryDefinition){this.queryDefinition=$.extend({},this.getOption('params'),queryDefinition);loadXmlaScript();if(_sharedXmla.xmla==null){_sharedXmla.xmla=new Xmla({async:false,url:this.getOption('url')});}
if(_sharedXmla.datasource==null){_sharedXmla.getDataSources();}},transformDiscoverresults:function(results){var cols=results.getFields(),col,res={resultset:[],metadata:[]};for(var i=0,j=cols.length;i<j;i++){col=cols[i];res.metadata[i]={colIndex:col.index,colName:col.label};switch(col.jsType){case"string":res.metadata[i].colType="string";break;case"number":res.metadata[i].colType="numeric";break;default:res.metadata[i].colType="string";}}
res.resultset=results.fetchAllAsArray();results.close();return res;},doQuery:function(outsideCallback){var url=this.getOption('url'),callback=(outsideCallback?outsideCallback:this.getOption('successCallback')),errorCallback=this.getOption('errorCallback');try{var result=this.transformDiscoverresults(_sharedXmla.discover(this.queryDefinition));this.setOption('lastResultSet',result);var clone=$.extend(true,{},this.getOption('lastResultSet'));this.setOption('lastProcessedResultSet',clone);result=callback(clone);if(result!==undefined&&result!==clone){this.setOption('lastProcessedResultSet',result);}}catch(e){Dashboards.error('unable to execute xmla addin query: '+e+' :');}}};Dashboards.registerQuery("xmlaDiscover",xmlaDiscoverOpts);})();
var OlapUtils={};var OlapUtils={mdxGroups:{},evolutionType:"Week"}
OlapUtils.initMdxQueryGroup=function(obj){var mdxQueryGroup=new OlapUtils.mdxQueryGroup(obj.name);for(m in obj.mdxQueries){mdxQueryGroup.addMdxQuery(obj.mdxQueries[m].name,obj.mdxQueries[m].query,obj.mdxQueries[m].dimension,obj.mdxQueries[m].axis,obj.mdxQueries[m].chart);}
OlapUtils.mdxGroups[obj.name]=mdxQueryGroup;if(("#"+obj.htmlObject+"_evolutionType")!=undefined)
$("#"+obj.htmlObject+"_evolutionType").html(mdxQueryGroup.printEvolutionType(obj.htmlObject+"_evolutionType"));return mdxQueryGroup;}
OlapUtils.updateMdxQueryGroup=function(obj){var mdxGroup=OlapUtils.mdxGroups[obj.name];if(mdxGroup==undefined){mdxGroup=OlapUtils.initMdxQueryGroup(obj);}
$("#"+obj.htmlObject).html(mdxGroup.printConditions());}
OlapUtils.buttonsDescription={"Drill Down":'Drill down to the selected value and add the condition to the other charts',"Drill Up":'Drill up and add the condition to the other charts','Focus':"Focus on this value, adding the conditions to the other charts",'Exclude':"Exclude this value from the chart","Expand":'Expand the depth of the chart, showing an extra sublevel',"Collapse":'Collapse all previous expansions to the top most level',"Reset All":'Reset all filters and conditions from this chart group, returning to the original conditions',"Cancel":"Cancel"}
OlapUtils.fireMdxGroupAction=function(mdxQueryGroup,idx,param1,param2,param3){if(param2!=undefined&&param3!=undefined){cType=Dashboards.ev(param1.chartType);if(cType=="AreaChart")
value=encode_prepare(param3);else
value=encode_prepare(param2);}
else
value=encode_prepare(param1);var mdxQueryGroup=OlapUtils.mdxGroups[mdxQueryGroup];if(value=='Others')
return;OlapUtils.lastClickedMdxQueryGroup=mdxQueryGroup;mdxQueryGroup.clickedIdx=idx;mdxQueryGroup.clickedValue=value;var clickedObj=mdxQueryGroup.mdxQueries[idx];var buttonsHash={"Drill Down":'drilldown',"Drill Up":'drillup','Focus':"focus",'Exclude':"filter","Expand":'expand',"Collapse":'collapse',"Reset All":'resetall',"Cancel":"cancel"};if(clickedObj.mdxQuery.axisDepth==0)
delete buttonsHash.Collapse;var rl=clickedObj.mdxQuery.query.rowLevels;var d=typeof rl=="function"?rl():rl;if(clickedObj.mdxQuery.axisPos+clickedObj.mdxQuery.axisDepth>=d.length-1){delete buttonsHash["Drill Down"];delete buttonsHash.Expand;}
else{delete buttonsHash.Focus;}
if(clickedObj.mdxQuery.axisPos==0)
delete buttonsHash["Drill Up"];if(clickedObj.mdxQuery.axisDepth>0){delete buttonsHash["Drill Down"];delete buttonsHash.Focus;delete buttonsHash.Exclude;}
var msg="Available conditions: <br/> <ul>";$.each(buttonsHash,function(key,value){msg+="<li>"+OlapUtils.buttonsDescription[key]+"</li>"});msg+="</ul>";$.prompt(msg,{buttons:buttonsHash,submit:OlapUtils.mdxQueryGroupActionCallback});}
OlapUtils.mdxQuery=function(hash){this.query={};this.originalHash={};this.update(hash);this.axisPos=0;this.axisDepth=0;};OlapUtils.mdxQuery.prototype.reset=function(){this.update(this.originalHash);};OlapUtils.mdxQuery.prototype.resetFilter=function(value){var rf=this.query["filters"]["rows"];var index=rf.indexOf(value);rf.splice(index,1);return index;}
OlapUtils.mdxQuery.prototype.resetFilters=function(){this.query["filters"]=Dashboards.clone((this.originalHash["filters"]||{rows:[],columns:[]}));}
OlapUtils.mdxQuery.prototype.resetCondition=function(key){delete this.query["members"][key];delete this.query["sets"][key];if(this.query["conditions"][key+"InitialValue"]!=undefined)
this.query["where"][key]=this.query["conditions"][key+"InitialValue"];else
delete this.query["where"][key];}
OlapUtils.mdxQuery.prototype.update=function(hash){this.originalHash=Dashboards.clone(hash);this.query["members"]=hash["members"]||[];this.query["sets"]=hash["sets"]||[];this.query["rows"]=hash["rows"]||"";this.query["rowDrill"]=hash["rowDrill"]||false;this.query["rowLevels"]=hash["rowLevels"]||[];this.query["orderBy"]=hash["orderBy"]||"";this.query["from"]=hash["from"]||"";this.query["columns"]=hash["columns"];this.query["columnDrill"]=hash["columnDrill"]||false;this.query["columnLevels"]=hash["columnLevels"]||[];this.query["nonEmptyRows"]=hash["nonEmptyRows"]&&true;this.query["nonEmptyColumns"]=hash["nonEmptyColumns"]&&true;this.query["swapRowsAndColumns"]=hash["swapRowsAndColumns"]||false;this.query["filters"]=hash["filters"]||{rows:[],columns:[]};this.query["where"]=hash["where"]||{};this.query["extra"]=hash["extra"]||{};this.query["conditions"]=[];this.query["drills"]=[];};OlapUtils.mdxQuery.prototype.clone=function(){var c=Dashboards.clone(this);return c;};OlapUtils.mdxQuery.prototype.generateAxisPart=function(axisDrill,axis,axisLevels,orderBy){if(axisDrill==false){return axis;}
var dim=axis.indexOf("].")==-1?axis:axis.substr(0,axis.indexOf("].")+1);var axisLevel=this.axisPos+this.axisDepth;if(axisLevel>axisLevels.length-1){axisLevel=axisLevels.length-1}
var q="Descendants("+axis+", "+dim+".["+axisLevels[axisLevel]+"],SELF)"
if(orderBy=="")
return q;return"Order("+q+", "+orderBy+" , BDESC)";}
OlapUtils.mdxQuery.prototype.getQuery=function(){var query="with ";var _eh=[];for(p in this.query){var key=p;var value=typeof this.query[p]=='function'?this.query[p]():this.query[p];_eh[key]=value;}
if(typeof _eh["sets"]=='object'||typeof _eh["members"]=='object'){for(s in _eh["sets"]){var value=typeof _eh["sets"][s]=='function'?_eh["sets"][s]():_eh["sets"][s];query+=" set "+value+" \n";}
for(m in _eh["members"]){var value=typeof _eh["members"][m]=='function'?_eh["members"][m]():_eh["members"][m];query+=" member "+value+" \n";}}
var columns=_eh["swapRowsAndColumns"]?_eh["rows"]:_eh["columns"];var columnLevels=_eh["swapRowsAndColumns"]?_eh["rowLevels"]:_eh["columnLevels"];var columnDrill=_eh["swapRowsAndColumns"]?_eh["rowDrill"]:_eh["columnDrill"];var rows=_eh["swapRowsAndColumns"]?_eh["columns"]:_eh["rows"];var rowLevels=_eh["swapRowsAndColumns"]?_eh["columnLevels"]:_eh["rowLevels"];var rowDrill=_eh["swapRowsAndColumns"]?_eh["columnDrill"]:_eh["rowDrill"];query+=" set rowSet as {"+this.generateAxisPart(rowDrill,rows,rowLevels,_eh.orderBy)+"} \n";query+=" set colSet as {"+this.generateAxisPart(columnDrill,columns,columnLevels,_eh.orderBy)+"} \n";var colFilter=[];var rowFilter=[];$.each(_eh["filters"]["rows"],function(j,k){rowFilter.push(_eh["rows"]+".Dimension.currentMember.Name <> '"+k+"' ");});if(_eh["swapRowsAndColumns"]){query+=" set rowFilter as "+(colFilter.length>0?"Filter(rowSet,"+colFilter.join(" and ")+" )":"rowSet")+"\n";query+=" set colFilter as "+(rowFilter.length>0?"Filter(colSet,"+rowFilter.join(" and ")+" )":"colSet")+"\n";}
else{query+=" set rowFilter as "+(rowFilter.length>0?"Filter(rowSet,"+rowFilter.join(" and ")+" )":"rowSet")+"\n";query+=" set colFilter as "+(colFilter.length>0?"Filter(colSet,"+colFilter.join(" and ")+" )":"colSet")+"\n";}
query+="select "+(_eh["nonEmptyRows"]?" NON EMPTY ":"")+" rowFilter on rows,\n ";query+=" "+(_eh["nonEmptyColumns"]?" NON EMPTY ":"")+" colFilter on columns\n ";query+=" from "+_eh["from"]+"\n";var whereArray=[];$.each(_eh["where"],function(key,obj){var el=typeof obj=='function'?obj():obj
if(el.length>0)whereArray.push(el);});if(whereArray.length>0){query+=" where ( "+whereArray.join(' , ')+" )";}
return query;}
OlapUtils.mdxQuery.prototype.exclude=function(value){this.query["filters"]["rows"].push(value);}
OlapUtils.mdxQuery.prototype.drillDown=function(value){this.resetFilters();this.query["drills"].push(this.query.rows);this.query.rows=value;this.axisPos++;}
OlapUtils.mdxQuery.prototype.drillUp=function(){this.axisPos--;return(this.query.rows=this.query["drills"].pop());}
OlapUtils.mdxQuery.prototype.addCondition=function(key,value){return this.addConditionAux(key,value,'focus');}
OlapUtils.mdxQuery.prototype.addInitialCondition=function(key,value){this.addConditionAux(key,value);}
OlapUtils.mdxQuery.prototype.removeFilter=function(key,value){this.removeCondition(key,value,'exclude');var lastExclude=true
for(v in this.query["conditions"][key]){lastExclude=false;break;}
if(lastExclude&&this.query["conditions"][key+"previousDrillValue"]!=undefined){this.addCondition(key,this.query["conditions"][key+"previousDrillValue"]);delete this.query["conditions"][key+"previousDrillValue"];}}
OlapUtils.mdxQuery.prototype.removeCondition=function(key,value,op){if(this.query["conditions"][key]!=undefined){if(this.query["conditions"][key][value]!=undefined)
delete this.query["conditions"][key][value];else{delete this.query["conditions"][key];this.resetCondition(key);return true;}}
var condition=value.substr(0,value.indexOf("]")+1)+".[Filter]";this.setCondition(key,condition,op);return false;}
OlapUtils.mdxQuery.prototype.removeConditions=function(key){this.query["conditions"][key]=[];this.resetCondition(key);}
OlapUtils.mdxQuery.prototype.replaceConditionsByDrill=function(key,value){if(this.query["conditions"][key]!=undefined)
this.query["conditions"][key]=[];return this.addConditionAux(key,value,'drill');}
OlapUtils.mdxQuery.prototype.replaceConditionByExclude=function(key,value){return this.addConditionAux(key,value,'exclude');}
OlapUtils.mdxQuery.prototype.addConditionAux=function(key,value,op){if(op==undefined){this.query["where"][key]=value;return;}
var condition=value.substr(0,value.indexOf("]")+1)+".[Filter]";if(this.query["conditions"][key]==undefined){this.query["conditions"][key]=[];if(this.query["where"][key]!=undefined)
this.query["conditions"][key+"InitialValue"]=this.query["where"][key];}
if(this.query["members"][key]==undefined){if(op=='exclude'){}
else
this.addMember(key,condition+" as Aggregate("+key+"Filter)");}
this.query["conditions"][key][value]=op
if(op!='exclude')
delete this.query["conditions"][key+"previousDrillValue"];if(op!='drill'){var aux=[];for(v in this.query["conditions"][key]){if(op=='exclude'&&this.query["conditions"][key+"previousDrillValue"]==undefined&&this.query["conditions"][key][v]=='drill'){this.query["conditions"][key+"previousDrillValue"]=v;}
if(this.query["conditions"][key][v]==op)aux[v]=op;}
this.query["conditions"][key]=aux;}
return this.setCondition(key,condition,op);}
OlapUtils.mdxQuery.prototype.setCondition=function(key,condition,op)
{var set=[];for(v in this.query["conditions"][key])
set.push(v);if(set.length>0){if(op=="focus"||op=="drill")
this.addSet(key,key+"Filter as {"+set.join(",")+"}");else{this.addMember(key,condition+" as ( ( "+set[0]+".parent) - ("+set.join(") - (")+"))");}
if(condition!=undefined)
this.query["where"][key]=condition;}
else
this.resetCondition(key);return set;}
OlapUtils.mdxQuery.prototype.addSet=function(key,set){this.query["sets"][key]=set;}
OlapUtils.mdxQuery.prototype.addMember=function(key,member){this.query["members"][key]=member;}
OlapUtils.lastClickedMdxQueryGroup;OlapUtils.mdxQueryGroup=function(name){this.name=name;this.mdxQueries={};this.clickedIdx=-1;this.clickedValue="";this.activeFilters={};this.activeConditions={};};OlapUtils.mdxQueryGroup.prototype.addMdxQuery=function(idx,mdxQuery,filterDimension,filterAxis,chartObject){this.mdxQueries[idx]={mdxQuery:mdxQuery,filterDimension:filterDimension,filterAxis:filterAxis,chartObject:chartObject};};OlapUtils.mdxQueryGroup.prototype.removeMdxQuery=function(idx){delete this.mdxQueries.idx;};OlapUtils.mdxQueryGroup.prototype.printConditions=function(){var out="";var filters=0;var conds=0;for(i in this.activeFilters){var a=this.activeFilters[i];if(a.length>0&&++filters==1)
out+="<i>Exclusions: </i>";var mdxGroupName=this.name;var o=[];$.each(a,function(j,k){o.push(k[1]+" <a class=\"resetFilterButton\" href='javascript:OlapUtils.mdxGroups[\""+mdxGroupName+"\"].removeFilter(\""+i+"\",\""+k[0]+"\")'>X</a>");++filters;});if(o.length>0)
out+=o.join(" , ")+" ;";}
for(i in this.activeConditions){var a=this.activeConditions[i];if(a.length>0&&++conds==1)
out+=" <i>Focus: </i>";var mdxGroupName=this.name;var o=[];$.each(a,function(j,k){o.push(k+" <a class=\"resetFilterButton\" href='javascript:OlapUtils.mdxGroups[\""+mdxGroupName+"\"].removeCondition(\""+i+"\",\""+k+"\")'>X</a>");++conds;});if(o.length>0)
out+=o.join(" , ")+"; ";}
if((conds+filters)>2)
out+=" <a  style=\"padding-left:15px;\" href='javascript:OlapUtils.mdxGroups[\""+this.name+"\"].resetAll()'>Reset All</a>";return out;}
OlapUtils.mdxQueryGroup.prototype.printEvolutionType=function(object){var out="";var myArray=[["Week","Week"],["Month","Month"],["Year","Year"]];for(var i=0,len=myArray.length;i<len;i++){out+="<input onclick='OlapUtils.changeEvolutionType(\""+object+"radio\")'";if(i==0){out+=" CHECKED ";}
out+="type='radio' id='"+object+"radio' name='"+object+"radio' value="+myArray[i][1]+" /> "+myArray[i][1]+(object.separator==undefined?"":object.separator);}
return out;}
OlapUtils.mdxQueryGroup.prototype.drillDown=function(key,value){Dashboards.incrementRunningCalls();var conditions=[];if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i==key){obj.mdxQuery.drillDown(value);}
else
conditions=obj.mdxQuery.replaceConditionsByDrill(key,value);Dashboards.update(obj.chartObject);}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.drillUp=function(key){Dashboards.incrementRunningCalls();var conditions=[];if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];var keyObj=this.mdxQueries[key];var value=keyObj.mdxQuery.drillUp();for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key){if(keyObj.mdxQuery.axisPos>0)
conditions=obj.mdxQuery.replaceConditionsByDrill(key,value);else
obj.mdxQuery.removeCondition(key,value,'drill');}
Dashboards.update(obj.chartObject);}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.replaceFocus=function(key,values){for(i in this.mdxQueries)
if(i!=key)
this.mdxQueries[i].mdxQuery.removeConditions(key);this.focus(key,values);}
OlapUtils.mdxQueryGroup.prototype.focus=function(key,values){var conditions=[];Dashboards.incrementRunningCalls();if(this.activeFilters!=undefined)delete this.activeFilters[key];if(this.activeConditions!=undefined)delete this.activeConditions[key];for(i in this.mdxQueries){if(i!=key){var obj=this.mdxQueries[i];for(i=0;i<values.length;i++){conditions=obj.mdxQuery.addCondition(key,values[i]);}
Dashboards.update(obj.chartObject);}}
if(conditions.length>0)
this.activeConditions[key]=conditions;Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.exclude=function(key,value){Dashboards.incrementRunningCalls();var members=value.split("].[");var memberValue=members[members.length-1].replace("]","");this.mdxQueries[key].mdxQuery.exclude(memberValue)
Dashboards.update(this.mdxQueries[key].chartObject);var a=this.activeFilters[key]||[];a.push([memberValue,value]);this.activeFilters[key]=a;for(i in this.mdxQueries){var query=this.mdxQueries[i];if(i!=key){query.mdxQuery.replaceConditionByExclude(key,value);Dashboards.update(query.chartObject);}}
if(this.activeConditions[key]!=undefined)
var indexCondition=this.activeConditions[key].indexOf(value);if(indexCondition>=0)
this.activeConditions[key].splice(indexCondition,1);Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.expand=function(key){this.mdxQueries[key].mdxQuery.axisDepth++;Dashboards.update(this.mdxQueries[key].chartObject);}
OlapUtils.mdxQueryGroup.prototype.collapse=function(key){this.mdxQueries[key].mdxQuery.axisDepth--;Dashboards.update(this.mdxQueries[key].chartObject);}
OlapUtils.mdxQueryGroup.prototype.resetAll=function(){Dashboards.incrementRunningCalls();for(i in this.mdxQueries){var obj=this.mdxQueries[i];obj.mdxQuery.reset();obj.mdxQuery.axisPos=0;obj.mdxQuery.axisDepth=0;Dashboards.update(obj.chartObject);}
this.activeFilters={};this.activeConditions={};Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.removeCondition=function(key,value){Dashboards.incrementRunningCalls();for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key){if(obj.mdxQuery.removeCondition(key,value,'focus')&&this.activeFilters[key]!=undefined)
delete this.activeFilters[key];}
else{obj.mdxQuery.query.rows=typeof obj.mdxQuery.originalHash.rows=='function'?obj.mdxQuery.originalHash.rows():obj.mdxQuery.originalHash.rows;obj.mdxQuery.axisPos=0;obj.mdxQuery.resetFilters();}
Dashboards.update(obj.chartObject);}
this.activeConditions[key].splice(this.activeConditions[key].indexOf(value),1);Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroup.prototype.removeFilter=function(key,value){Dashboards.incrementRunningCalls();var index=this.mdxQueries[key].mdxQuery.resetFilter(value);for(i in this.mdxQueries){var obj=this.mdxQueries[i];if(i!=key)
obj.mdxQuery.removeFilter(key,this.activeFilters[key][index][1]);Dashboards.update(obj.chartObject);}
this.activeFilters[key].splice(index,1);if(this.activeFilters[key].length==0)
delete this.activeFilters[key];Dashboards.update(Dashboards.getComponent(this.name));Dashboards.decrementRunningCalls();}
OlapUtils.mdxQueryGroupActionCallback=function(e,value,m){if(value=="cancel")
return;Dashboards.incrementRunningCalls();var mqg=OlapUtils.lastClickedMdxQueryGroup;var clickedObj=mqg.mdxQueries[mqg.clickedIdx];var axis=typeof clickedObj.mdxQuery.query.rows=='function'?clickedObj.mdxQuery.query.rows():clickedObj.mdxQuery.query.rows;if(value=="drilldown"){mqg.drillDown(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="drillup"){mqg.drillUp(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="focus"){mqg.focus(mqg.clickedIdx,[axis+".["+mqg.clickedValue+"]"]);}
else if(value=="filter"){mqg.exclude(mqg.clickedIdx,axis+".["+mqg.clickedValue+"]");}
else if(value=="expand"){mqg.expand(mqg.clickedIdx);}
else if(value=="collapse"){mqg.collapse(mqg.clickedIdx);}
else if(value=="resetall"){mqg.resetAll();}
Dashboards.update(Dashboards.getComponent(mqg.name));Dashboards.decrementRunningCalls();}
OlapUtils.getAxisPathString=function(axis,axisPath){var a=[];$.each(axisPath,function(i,v){a.push("["+v+"]");});return axis+"."+a.join(".");}
OlapUtils.changeEvolutionType=function(object){var value="";var selector=document.getElementsByName(object);for(var i=0,len=selector.length;i<len;i++){if(selector[i].checked){value=selector[i].value;continue;};}
this.fireChange("OlapUtils.evolutionType",value);}
OlapUtils.GenericMdxQuery=Base.extend({mdxQuery:undefined,options:{},tableDefaults:{},chartDefaults:{},genericDefaults:{dateDim:'[Date]',dateLevel:'[Date]',dateLevelMonth:'[Month]',from:'[CubeName]',nonEmptyRows:true,rowDrill:true,measuresDim:'[Measures]',orderBy:undefined,debug:false},constructor:function(options){},getQuery:function(){this.query=this.mdxQuery.getQuery();if(this.options.debug==true){alert(this.query);}
return this.query;},getDataTableOptions:function(options){$.extend(this.tableDefaults,options);return TableComponent.getDataTableOptions(this.tableDefaults);},getChartOptions:function(options){$.extend(this.chartDefaults,options);return this.chartDefaults;}});OlapUtils.EvolutionQuery=OlapUtils.GenericMdxQuery.extend({mdxQuery:undefined,thisMonth:"",lastMonth:"",lastYearMonth:"",specificDefaults:{baseDate:'2008-10-01',rows:'[Locale Codes]',rowLevels:['Code'],measure:'[Total Month Requests]',debug:false},tableDefaults:{colHeaders:["Dimension",'Total','% m/m','% m/m-12','Last 12 months'],colTypes:['string','numeric','numeric','numeric','sparkline'],colFormats:[null,'%.0f','%.2f','%.2f',null],colWidths:['100px','50px','50px','50px','80px'],displayLength:10,sparklineType:"line",sortBy:[[1,'desc']]},constructor:function(options,object){this.options=jQuery.extend({},this.genericDefaults,this.specificDefaults,options);var options=this.options;var thisPeriod=options.dateDim+".[This Period]";var lastPeriod=options.dateDim+".[Previous Period]";var lastYearPeriod=options.dateDim+".[Last Year Period]";var nonEmptyMeasure=".[Not Null Measure]";this.queryBase={from:options.from,rows:options.rows,rowLevels:options.rowLevels,rowDrill:options.rowDrill,nonEmptyRows:options.nonEmptyRows,columns:""+options.measuresDim+nonEmptyMeasure+","+options.measuresDim+".[% m/m],"+options.measuresDim+".[% m/m-12],"+options.measuresDim+".[sparkdatamonths]",swapRowsAndColumns:false,orderBy:options.orderBy,sets:{"now":function(){return"now as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(30.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"]"},"oneMonthAgo":function(){return"oneMonthAgo as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(60.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(30.0)"},"oneYearAgo":function(){return"oneYearAgo as [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(395.0)"+":"+" [Date].[Date].["+Dashboards.ev(options.baseDate)+"].Lag(365.0)"},"last12Months":function(){return"last12Months as LastPeriods(12.0, Ancestor("+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.baseDate)+"],"+options.dateDim+"."+options.dateLevelMonth+")) "}},members:{todaysMonth:function(){return"[Date].[TodaysMonth] as Aggregate( now )"},notNullMeasure:function(){return""+options.measuresDim+nonEmptyMeasure+" as Iif(isEmpty("+options.measuresDim+"."+options.measure+"), 0 , "+options.measuresDim+"."+options.measure+") "},thisPeriodMeasure:function(){return""+options.measuresDim+".[This Period] as Aggregate(now*"+options.measuresDim+nonEmptyMeasure+") "},previousPeriodMeasure:function(){return""+options.measuresDim+".[Previous Period] as Aggregate(oneMonthAgo*"+options.measuresDim+nonEmptyMeasure+") "},lastYearPeriodMeasure:function(){return""+options.measuresDim+".[Last Year Period] as Aggregate(oneYearAgo*"+options.measuresDim+nonEmptyMeasure+") "},mmMeasure:function(){return""+options.measuresDim+".[% m/m] as 100.0*("+options.measuresDim+nonEmptyMeasure+" / "+options.measuresDim+".[Previous Period] - 1.0)  "},mm12Measure:function(){return""+options.measuresDim+".[% m/m-12] as 100.0*("+options.measuresDim+nonEmptyMeasure+" / "+options.measuresDim+".[Last Year Period] - 1.0)  "},sparkdatamonths:function(){return""+options.measuresDim+".[sparkdatamonths] as Generate([last12Months], Cast(("+options.measuresDim+nonEmptyMeasure+") + 0.0 as String), \" , \") "}},where:{dateBase:""+options.dateDim+".[TodaysMonth]"}};this.mdxQuery=new OlapUtils.mdxQuery(this.queryBase);},queryBase:{}});OlapUtils.DimensionAnalysisQuery=OlapUtils.GenericMdxQuery.extend({chartTypesTranslation:{},translationHash:{},mdxQuery:undefined,thisMonth:"",lastMonth:"",lastYearMonth:"",specificDefaults:{startDate:'2008-10-01',endDate:'2008-11-01',rows:'[Product Operating Systems]',rowLevels:["Platform","Version"],measure:'[Total Requests]',defaultChartType:"bar",debug:false,where:{}},tableDefaults:{colHeaders:['Name','Value'],colTypes:['string','numeric'],colFormats:[null,'%.0f'],sortBy:[[1,'desc']],lengthChange:false},chartDefaults:{domainLabelRotationDir:"up",domainLabelRotation:"0",orientation:"horizontal",title:"",isStacked:"true",is3d:false,foregroundAlpha:0.8,showValues:true,chartType:function(){return this.parent.queryBase.extra.translationHash.chartType;},datasetType:function(){return this.parent.queryBase.extra.translationHash.datasetType;},includeLegend:function(){return this.parent.queryBase.extra.translationHash.includeLegend;},topCountAxis:function(){return this.parent.queryBase.extra.translationHash.axis[1];}},constructor:function(options,object){this.options=jQuery.extend({},this.genericDefaults,this.specificDefaults,options);var options=this.options;this.chartTypesTranslation={"pie":{type:"jFreeChartComponent",chartType:"PieChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"bar":{type:"jFreeChartComponent",chartType:"BarChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"table":{type:"tableComponent",chartType:"PieChart",datasetType:"CategoryDataset",axis:["columns","rows"],member:"("+options.dateDim+".[Date Range], "+options.measuresDim+".[Avg])",includeLegend:false},"trend":{type:"jFreeChartComponent",chartType:"AreaChart",datasetType:"TimeSeriesCollection",axis:["rows","columns"],member:"a",includeLegend:true}};this.queryBase={from:options.from,rows:options.rows,rowLevels:options.rowLevels,rowDrill:options.rowDrill,nonEmptyRows:options.nonEmptyRows,columns:function(){return this.extra.translationHash["member"]},swapRowsAndColumns:function(){return this.extra.translationHash["axis"][0]=="rows"},orderBy:"Avg(a,"+options.measuresDim+"."+options.measure+")",sets:{"a":function(){return"a as '("+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.startDate)+"]:"+options.dateDim+"."+options.dateLevel+".["+Dashboards.ev(options.endDate)+"])'"}},members:{daterange:""+options.dateDim+".[Date Range] as Aggregate(a)",average:""+options.measuresDim+".[Avg] as 'Avg(a,"+options.measuresDim+"."+options.measure+")'"},where:options.where,extra:{}};var _chart=Dashboards.clone(this);delete _chart.chartDefaults;this.chartDefaults.parent=_chart;this.setChartType(options.defaultChartType);this.mdxQuery=new OlapUtils.mdxQuery(this.queryBase);},setChartType:function(chartType){this.queryBase.extra.translationHash=this.chartTypesTranslation[chartType];this.chartDefaults.parent.queryBase.extra.translationHash=this.chartTypesTranslation[chartType];},getComponentType:function(){return this.chartDefaults.parent.queryBase.extra.translationHash.type;},queryBase:{}});
if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());
jQuery.fn.extend({captify:function(o,object){var o=$.extend({speedOver:'fast',speedOut:'normal',hideDelay:4000,animation:'slide',prefix:'',opacity:'0.35',className:'caption-bottom',position:'bottom',spanWidth:'100%'},o);$(this).each(function(){var img=this;$(this).on('load',function(){$this=img;if(this.hasInit){return false;}
this.hasInit=true;var close=0;var invoker;var captionLabelSrc=$('#'+$(this).attr('rel'));var captionLabelHTML=!captionLabelSrc.length?$(this).attr('alt'):captionLabelSrc.html();captionLabelSrc.remove();var toWrap=this.parent&&this.parent.tagName=='a'?this.parent:$(this);var wrapper=toWrap.wrap('<div></div>').parent();wrapper.css({overflow:'hidden',padding:0,fontSize:0.1})
wrapper.addClass('caption-wrapper');wrapper.width($(this).width());wrapper.height($(this).height());$.map(['top','right','bottom','left'],function(i){wrapper.css('margin-'+i,$(img).css('margin-'+i));$.map(['style','width','color'],function(j){var key='border-'+i+'-'+j;wrapper.css(key,$(img).css(key));});});$(img).css({border:'0 none'});var button=$('<div></div>').addClass('caption-button');if(o.hasButton){toWrap.parent().parent().prepend(button);}
var caption=$('div:last',wrapper.append('<div></div>')).addClass(o.className);var captionContent=$('div:last',wrapper.append('<div></div>')).addClass(o.className).append(o.prefix).append(captionLabelHTML);$('*',wrapper).css({margin:0}).show();var captionPositioning=(navigator.userAgent.toLowerCase().indexOf('msie')!=-1)?'static':'relative';caption.css({zIndex:1,position:captionPositioning,opacity:o.animation=='fade'?0:o.opacity,width:o.spanWidth});if(o.position=='bottom'){var vLabelOffset=parseInt(caption.css('border-top-width').replace('px',''))+parseInt(captionContent.css('padding-top').replace('px',''))-1;captionContent.css('paddingTop',vLabelOffset);}
captionContent.css({position:captionPositioning,zIndex:2,background:'none',border:'1 none',opacity:o.animation=='fade'?1:1,width:o.spanWidth});caption.width(captionContent.outerWidth());caption.height(captionContent.height());button.width($(img).outerWidth());var topBorderAdj=(o.position=='bottom'&&(navigator.userAgent.toLowerCase().indexOf('msie')!=-1))?-4:0;var captionPosition=(o.position=='top')?{hide:-$(img).height()-caption.outerHeight()-1,show:-$(img).height()}:{hide:0,show:-caption.outerHeight()+topBorderAdj};captionContent.css('marginTop',-caption.outerHeight());caption.css('marginTop',captionPosition[o.animation=='fade'||o.animation=='always-on'?'show':'hide']);var cHide=function(){if(close){var props=o.animation=='fade'?{opacity:0}:{marginTop:captionPosition.hide};caption.animate(props,250,null,function(){close=false});invoker.animate(props,250);if(o.animation=='fade'){captionContent.animate({opacity:0},o.speedOver,null,function(){close=false});}}};if(o.animation!='always-on'){$(this).bind("detailsClick",function(e,obj){if(!close){close=true;invoker=$(obj);var props=o.animation=='fade'?{opacity:o.opacity}:{marginTop:captionPosition.show};caption.animate(props,o.speedOver);invoker.animate(props,o.speedOver);if(o.animation=='fade'){captionContent.animate({opacity:1},o.speedOver/2);}
window.setTimeout(cHide,o.hideDelay);}});}
o.bDetails.trigger('capityFinished',[this]);});});}});
pen.define("cdf-legacy/lib/CCC/pvc-d1.0",["cdf-legacy/lib/CCC/def","cdf-legacy/lib/CCC/protovis","cdf-legacy/lib/CCC/cdo","cdf-legacy/jquery","cdf-legacy/lib/CCC/tipsy"],function(def,pv,cdo,$){function pvc_unwrapExtensionOne(id,prefix){if(id){if(null!=id.abs)return id.abs;if(!prefix)return id;var uid=def.firstUpperCase(id);return null!=prefix.abs?{abs:prefix.abs+uid}:prefix+uid;}
return prefix;}
function pvc_options(specs,context){function resolve(name){return _infos[name].resolve();}
function option(name,noDefault){var info=resolve(name);return noDefault&&!info.isSpecified?void 0:info.value;}
function isSpecified(name){return resolve(name).isSpecified;}
function getSpecified(name,dv){var info=resolve(name);return info.isSpecified?info.value:dv;}
function specified(name){return option(name,!0);}
function isDefined(name){return def.hasOwn(_infos,name);}
function specify(opts){return set(opts,!1);}
function defaults(opts){return set(opts,!0);}
function getDefaultValue(name){return resolve(name)._dv;}
function set(opts,isDefault){var name,info,value;for(name in opts){info=def.hasOwnProp.call(_infos,name)&&_infos[name];info&&void 0!==(value=opts[name])&&info.set(value,isDefault);}
return option;}
specs||def.fail.argumentRequired("specs");var _infos={};def.each(specs,function(spec,name){var info=new pvc_OptionInfo(name,option,context,spec);_infos[info.name]=info;});option.option=option;option.specified=specified;option.defaultValue=getDefaultValue;option.isSpecified=isSpecified;option.isDefined=isDefined;option.getSpecified=getSpecified;option.specify=specify;option.defaults=defaults;return option;}
function options_resolvers(list){return function(optionInfo){var i,m,L;for(i=0,L=list.length;i<L;i++){m=list[i];"string"==typeof m&&(m=this[m]);if(!0===m.call(this,optionInfo))return!0;}};}
function options_constantResolver(value,op){return function(optionInfo){return optionInfo.specify(value),!0;};}
function options_specifyResolver(fun,op){return function(optionInfo){var value=fun.call(this,optionInfo);if(void 0!==value)return optionInfo.specify(value),!0;};}
function options_defaultResolver(fun){return function(optionInfo){var value=fun.call(this,optionInfo);if(void 0!==value)return optionInfo.defaultValue(value),!0;};}
function OptionsMetaType(){def.MetaType.apply(this,arguments);var baseOptsDef=this.baseType&&this.baseType.optionsDef;this.optionsDef=def.create(baseOptsDef);}
function pvc_colorIsGray(color){color=pv.color(color);var r=color.r,g=color.g,b=color.b,avg=(r+g+b)/3;return Math.abs(r-avg)<=2&&Math.abs(g-avg)<=2&&Math.abs(b-avg)<=2;}
function pvc_colorScales(keyArgs){keyArgs||def.fail.argumentRequired("keyArgs");var type=keyArgs.type||def.fail.argumentRequired("keyArgs.type");switch(type){case"linear":return new pvc.color.LinearScalesBuild(keyArgs).buildMap();case"discrete":return new pvc.color.DiscreteScalesBuild(keyArgs).buildMap();case"normal":return new pvc.color.NormalScalesBuild(keyArgs).buildMap();}
throw def.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[type]);}
function pvc_colorScale(keyArgs){keyArgs||def.fail.argumentRequired("keyArgs");var type=keyArgs.type||def.fail.argumentRequired("keyArgs.type");switch(type){case"linear":return new pvc.color.LinearScalesBuild(keyArgs).build();case"discrete":return new pvc.color.DiscreteScalesBuild(keyArgs).build();case"normal":return new pvc.color.NormalScalesBuild(keyArgs).build();}
throw def.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[type]);}
function visualContext_update(pvMark,scene){this.event=pv.event;this.pvMark=pvMark;if(pvMark){var sign=this.sign=pvMark.sign||null;!scene&&sign&&(scene=sign.scene());if(scene)this.index=scene.childIndex();else{this.index=null;scene=new pvc.visual.Scene(null,{panel:this.panel});}}else{this.sign=null;this.index=null;scene=new pvc.visual.Scene(null,{panel:this.panel,source:this.chart.root.data});}
this.scene=scene;}
function pvc_spec_addEvent(oper,spec,eventName,handler){var operStore=def.lazy(spec,oper),eventStore=operStore[eventName];eventStore?def.array.is(eventStore)&&(eventStore=operStore[eventName]=[eventStore]):eventStore=operStore[eventName]=[];eventStore.push(handler);return pvc.spec;}
function slidingWindow_defaultDimensionName(){var baseAxis=this.chart.axes.base,baseGrouping=baseAxis&&(baseAxis.role.grouping||baseAxis.role.preBoundGrouping());return baseGrouping?baseGrouping.singleDimensionName:this.chart.data.type.dimensionsNames()[0];}
function slidingWindow_defaultSelect(datums){var toRemove=[],L=datums.length;if(L>0)for(var dimName=this.dimension,dim=this.chart.data.dimensions(dimName),maxAtom=dim.max(),mostRecent=maxAtom?maxAtom.value:null,maxLength=this.length,i=0;i<L;i++){var datum=datums[i],value=datum.atoms[dimName].value;if(null==value)toRemove.push(datum);else{var distance=+mostRecent-+value;distance>0&&distance>maxLength&&toRemove.push(datum);}}
return toRemove;}
function SceneMetaType(){def.MetaType.apply(this,arguments);this._vars=def.create(this.baseType&&this.baseType._vars);}
function scene_isPointSwitchingToHoverableSign(ev){var pointTo;return!!(ev&&(pointTo=ev.pointTo)&&pointTo.scenes.mark._hasHoverable);}
function scene_renderId(renderId){if(this._renderId!==renderId){this._renderId=renderId;this.renderState={};}}
function rootScene_setActive(scene){var ownerScene;scene&&(ownerScene=scene.ownerScene)&&(scene=ownerScene);var active=this._active;if(active!==scene){active&&scene_setActive.call(active,!1);this._active=active=scene||null;active&&scene_setActive.call(active,!0);return!0;}
return!1;}
function scene_setActive(isActive){this.isActive!==isActive&&(isActive?this.isActive=!0:delete this.isActive);}
function scene_createVarMainMethod(name,nameEval){return function(){var vb=this.vars[name];if(void 0===vb){vb=this[nameEval]();void 0===vb&&(vb=null);this.vars[name]=vb;}
return vb;};}
function visRoleBinder_assertUnboundChartRoleIsOptional(role){if(null===role.plot&&role.isRequired)throw def.error.operationInvalid("The required visual role '{0}' is unbound.",[role.name]);}
function visualRolesBinder_assertState(state,desiredState){if(state!==desiredState)throw def.error.operationInvalid("Invalid state.");}
function datum_notNull(d){return!d.isNull;}
function axis_groupingScaleType(grouping){return grouping.isDiscrete()?"discrete":grouping.singleContinuousValueType===Date?"timeSeries":"numeric";}
function colorAxis_castColorMap(colorMap){var resultMap;if(colorMap){var any;def.eachOwn(colorMap,function(v,k){any=!0;colorMap[k]=pv.fillStyle(v);});any&&(resultMap=colorMap);}
return resultMap;}
function colorAxis_getDefaultColors(){var colors,scaleType=this.scaleType;if(scaleType)if("discrete"===scaleType)if(0===this.index)colors=pvc.createColorScheme();else{var me=this;colors=function(){return me.chart._getRoleColorScale(me.role.grouping);};}else{colorAxis_defContColors||(colorAxis_defContColors=["red","yellow","green"].map(pv.color));colors=colorAxis_defContColors.slice();}else colors=pvc.createColorScheme();return colors;}
function legend_castSize(size){if(!def.object.is(size)){var position=this.option("Position");size=new pvc_Size().setSize(size,{singleProp:pvc.BasePanel.orthogonalLength[position]});}
return size;}
function legend_castAlign(align){var position=this.option("Position");return pvc.parseAlign(position,align);}
function legendItem_castSize(size){return new pvc_Size().setSize(size,{singleProp:"width"});}
function viewSpec_normalizeDims(dims){if(def.string.is(dims))dims=dims.split(",");else if(!def.array.is(dims))throw def.error.argumentInvalid("dims","Must be a string or an array of strings.");return def.query(dims).distinct().sort().array();}
function chart_activeSceneEvent_addFilter(name,handlerInfo){function eventFilter(){if(!inited){inited=!0;this.chart._processViewSpec(handlerInfo);normDimNames=handlerInfo.dimNames;normDimsKey=handlerInfo.dimsKey;}
if(!normDimNames)return!1;var activeFilters=def.lazy(this,"_activeFilters"),value=def.getOwn(activeFilters,normDimsKey);void 0===value&&(activeFilters[normDimsKey]=value=evalEventFilter(this.event));return value;}
function eventHandler(){var ev1=this.event,ev2=Object.create(ev1);ev2.viewKey=normDimsKey;ev2.viewFrom=function(){return getSceneView(ev1.from);};ev2.viewTo=function(){return getSceneView(ev1.to);};this.event=ev2;try{handlerInfo.handler.call(this);}finally{this.event=ev1;}}
function evalEventFilter(ev){var vFrom=getSceneView(ev.from,null),vTo=getSceneView(ev.to,null);if(vFrom===vTo)return!1;if(null==vFrom||null==vTo)return!0;for(var i=normDimNames.length,atomsFrom=vFrom.atoms,atomsTo=vTo.atoms;i--;)if(atomsFrom[normDimNames[i]].value!==atomsTo[normDimNames[i]].value)return!0;return!1;}
function getSceneView(scene,dv){return scene?scene._asView(normDimsKey,normDimNames):dv;}
var normDimsKey,normDimNames,inited=!1;handlerInfo._filter=eventFilter;handlerInfo._handler=eventHandler;}
function sign_createBasic(pvMark){var as=mark_getAncestorSign(pvMark)||def.assert("There must exist an ancestor sign");return new pvc.visual.BasicSign(as.panel,pvMark);}
function mark_getAncestorSign(pvMark){var sign;do{pvMark=pvMark.parent;}while(pvMark&&!(sign=pvMark.sign)&&(!pvMark.proto||!(sign=pvMark.proto.sign)));return sign;}
function discreteBandsLayout(N,B,Bmin,Bmax,E,Emin,Emax,R){if(!N)return null;var m;null==Bmax&&(Bmax=1/0);null==Emax&&(Emax=1/0);null==Bmin&&(Bmin=0);null==Emin&&(Emin=0);Bmin>Bmax&&(Bmax=Bmin);Emin>Emax&&(Emax=Emin);null!=B?B<Bmin?B=Bmin:B>Bmax&&(B=Bmax):pv.floatEqual(Bmin,Bmax)&&(B=Bmin);null!=E?E<Emin?E=Emin:E>Emax&&(E=Emax):pv.floatEqual(Emin,Emax)&&(E=Emin);var hasB=null!=B,hasE=null!=E;if(hasB||hasE){if(hasB&&hasE){if(pv.floatZero(B)&&pv.floatZero(E))return discreteBandsLayout(N,null,0,1/0,null,0,1/0,R);R=B/(B+E);return{mode:"abs",ratio:R,value:N*(B+E),band:B,space:E};}
var Smin,Smax;if(hasB){Smin=B+Emin;Smax=B+Emax;R=pv.floatZero(B)?0:B/Smin;}else{Smin=Bmin+E;Smax=Bmax+E;R=pv.floatZero(E)?1:Bmin/Smin;}
return{mode:"abs",ratio:R,min:N*Smin,max:N*Smax,band:hasB?B:void 0,space:hasE?E:void 0};}
var hasBmin=Bmin>0,hasEmin=Emin>0,hasBmax=isFinite(Bmax)&&Bmax>0,hasEmax=isFinite(Emax)&&Emax>0,hasMin=hasBmin&&hasEmin,hasMax=hasBmax&&hasEmax;if(hasMin||hasMax)if(hasMin){R=Bmin/(Bmin+Emin);if(hasMax)return{mode:"abs",ratio:R,min:N*(Bmin+Emin),max:N*(Bmax+Emax),band:Bmin,space:Emin};m=Emin/Bmin;hasBmax?Emax=m*Bmax:hasEmax&&(Bmax=Emax/m);}else{m=Emax/Bmax;R=Bmax/(Bmax+Emax);hasBmin?Emin=m*Bmin:hasEmin&&(Bmin=Emin/m);}else{if(!(hasBmin||hasBmax||hasEmin||hasEmax))return{mode:"rel",ratio:R,min:0,max:1/0};m=1/R-1;if(hasEmin){Bmin=Emin/m;if(hasBmax&&Bmin>=Bmax)return discreteBandsLayout(N,B,Bmin,Bmax,E,Emin,Emax,R);}else if(hasBmin){Emin=m*Bmin;if(hasEmax&&Emin>=Emax)return discreteBandsLayout(N,B,Bmin,Bmax,E,Emin,Emax,R);}
hasBmax?Emax=m*Bmax:hasEmax&&(Bmax=Emax/m);}
return{mode:"rel",ratio:R,min:N*(Bmin+Emin),max:N*(Bmax+Emax)};}
function pvc_castDomainScope(scope){return pvc.parseDomainScope(scope,this.orientation);}
function pvc_castAxisPosition(side){if(side){if(def.hasOwn(pvc_Sides.namesSet,side)){return pvc.BasePanel["y"===this.orientation?"horizontalAlign":"verticalAlign2"][side];}
def.debug>=2&&def.log(def.format("Invalid axis position value '{0}'.",[side]));}
return"x"===this.orientation?"bottom":"left";}
function cartAxis_castSize(value){var position=this.option("Position");return pvc_Size.toOrtho(value,position);}
function cartAxis_castTitleSize(value){var position=this.option("Position");return pvc_Size.to(value,{singleProp:pvc.BasePanel.orthogonalLength[position]});}
function cartAxis_labelDesiredAngles(value){var angles=[];if(!value)return angles;def.array.is(value)||angles.push(value);for(var i=0,ic=value.length;i!==ic;++i){var angle=def.number.to(value[i]);null!=angle&&angles.push(angle);}
return angles;}
function getExtensionPrefixes(){var extensions=["axis"],st=this.scaleType;if(st){"discrete"!==st&&extensions.push("continuousAxis");extensions.push(st+"Axis");}
this.v1SecondOrientedId&&extensions.push(this.v1SecondOrientedId+"Axis");extensions.push(this.orientedId+"Axis");extensions.push(this.id+"Axis");return extensions;}
function pvc_castTrend(trend){if("trend"===this.name)return null;var type=this.option("TrendType");!type&&trend&&(type=trend.type);if(!type||"none"===type)return null;trend=trend?Object.create(trend):{};var trendInfo=pvc.trends.get(type);trend.info=trendInfo;trend.type=type;var label=this.option("TrendLabel");trend.label=null!=label?String(label):trendInfo.dataPartAtom.f;return trend;}
function cartPlotPanel_axisMayOverflow(axis){return!axis.isDiscrete()&&(null!=axis.option("FixedMin")||null!=axis.option("FixedMax")||null!=axis.option("FixedLength")||null!=axis.option("Ratio")||axis.option("PreserveRatio"));}
function pvcPoint_buildVisibleOption(type,dv){return{resolveV1:function(optionInfo){if(0===this.globalIndex){this._specifyChartOption(optionInfo,"show"+type)||optionInfo.defaultValue(dv);return!0;}}};}
function pvcMetricPoint_buildVisibleOption(type){return{resolveV1:function(optionInfo){return this._specifyChartOption(optionInfo,"show"+type),!0;}};}
function cast_number_zero_to_one(v){return def.number.toBetween(v,0,1);}
function nodes_breadthFirst(root){for(var nodes=[root],i=-1;++i<nodes.length;){var node=nodes[i];nodes.push.apply(nodes,node.childNodes);}
return nodes;}
Array.prototype.every||(Array.prototype.every=function(fun){"use strict";if(null==this)throw new TypeError();var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError();for(var thisArg=arguments.length>=2?arguments[1]:void 0,i=0;i<len;i++)if(i in t&&!fun.call(thisArg,t[i],i,t))return!1;return!0;});var pvc=def.globalSpace("pvc",{});pvc.data=cdo;var pvc_arraySlice=Array.prototype.slice;pvc.invisibleFill="rgba(127,127,127,0.00001)";!function(){var setTipsyDebug=function(level){pv.Behavior.tipsy.setDebug(level);};setTipsyDebug(def.debug);def.addOnDebugChanged(setTipsyDebug);}();pvc.NoDataException=def.global.NoDataException=function(){this.name="no-data";this.message="No data found";};pvc.InvalidDataException=def.global.InvalidDataException=function(msg,name){this.name=name||"invalid-data";this.message=msg||"Invalid Data.";};pvc.defaultCompatVersion=function(compatVersion){var defaults=pvc.BaseChart.prototype.defaults;return null!=compatVersion?defaults.compatVersion=compatVersion:defaults.compatVersion;};pvc.cloneMatrix=function(m){return m.map(function(d){return d.slice();});};pvc.normAngle=pv.Shape.normalizeAngle;pvc.orientation={vertical:"vertical",horizontal:"horizontal"};pvc.removeTipsyLegends=function(){var tipsy=pv.Behavior.tipsy;tipsy&&tipsy.removeAll&&tipsy.removeAll();};pvc.createDateComparer=function(parser,key){key||(key=pv.identity);return function(a,b){return parser.parse(key(a))-parser.parse(key(b));};};pvc.buildIndexedId=def.indexedId;pvc.makeEnumParser=function(enumName,hasKey,dk){if(def.array.is(hasKey)){var keySet={};hasKey.forEach(function(k){k&&(keySet[k.toLowerCase()]=k);});hasKey=function(k){return def.hasOwn(keySet,k);};}
dk&&(dk=dk.toLowerCase());return function(k){k&&(k=(""+k).toLowerCase());if(!hasKey(k)){k&&def.debug>=2&&def.log.warn("Invalid '"+enumName+"' value: '"+k+"'. Assuming '"+dk+"'.");k=dk;}
return k;};};pvc.unionExtents=function(result,range){if(result){if(range){range.min<result.min&&(result.min=range.min);range.max>result.max&&(result.max=range.max);}}else{if(!range)return null;result={min:range.min,max:range.max};}
return result;};pvc.roundPixel={epsilon:.1};null==$.support.svg&&($.support.svg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));pvc.extensionTag="extension";pvc.extendType=function(type,exts,names){if(exts){var exts2,sceneVars=type.meta&&type.meta._vars,addExtension=function(ext,n){if(void 0!==ext){exts2||(exts2={});sceneVars&&sceneVars[n]&&(n="_"+n+"EvalCore");exts2[n]=def.fun.to(ext);}};names?names.forEach(function(n){addExtension(exts[n],n);}):def.each(addExtension);exts2&&type.add(exts2);}};var pvc_oneNullArray=[null];pvc.makeExtensionAbsId=function(id,prefix){if(!id)return prefix;var result=[];prefix=def.array.to(prefix)||pvc_oneNullArray;id=def.array.to(id);for(var i=0,I=prefix.length;i<I;i++)for(var j=0,J=id.length;j<J;j++){var absId=pvc_unwrapExtensionOne(id[j],prefix[i]);absId&&result.push(absId);}
return result;};pvc.uniqueExtensionAbsPrefix=function(){return"_"+(new Date().getTime()+Math.floor(1e5*Math.random()));};pvc.defaultColorScheme=null;pvc.brighterColorTransform=function(color){return null==color?null:(color.rgb?color:pv.color(color)).brighter(.6);};pvc.setDefaultColorScheme=function(colors){return pvc.defaultColorScheme=pvc.colorScheme(colors);};pvc.defaultColor=pv.Colors.category10()("?");pvc.colorScheme=function(colors){if(null==colors)return null;if("function"==typeof colors){if(!colors.hasOwnProperty("range"))return colors;colors=colors.range();}else colors=def.array.as(colors);return colors.length?function(){var scale=pv.colors(colors);scale.domain.apply(scale,arguments);return scale;}:null;};pvc.createColorScheme=function(colors){return pvc.colorScheme(colors)||pvc.defaultColorScheme||pv.Colors.category10;};pvc.toGrayScale=function(color,alpha,maxGrayLevel,minGrayLevel){color=pv.color(color);var avg=.299*color.r+.587*color.g+.114*color.b;void 0===maxGrayLevel?maxGrayLevel=200:null==maxGrayLevel&&(maxGrayLevel=255);void 0===minGrayLevel?minGrayLevel=30:null==minGrayLevel&&(minGrayLevel=0);var delta=maxGrayLevel-minGrayLevel;avg=delta<=0?maxGrayLevel:minGrayLevel+avg/255*delta;null==alpha?alpha=color.opacity:alpha<0&&(alpha=-alpha*color.opacity);avg=Math.round(avg);return pv.rgb(avg,avg,avg,alpha);};pvc.time={intervals:{y:31536e6,m:2592e6,d30:2592e6,w:6048e5,d7:6048e5,d:864e5,h:36e5,M:6e4,s:1e3,ms:1},withoutTime:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate());},weekday:{previousOrSelf:function(t,toWd){var wd=t.getDay(),difDays=wd-toWd;if(difDays){var previousOffset=difDays<0?7+difDays:difDays;t=new Date(t-previousOffset*pvc.time.intervals.d);}
return t;},nextOrSelf:function(t,toWd){var wd=t.getDay(),difDays=wd-toWd;if(difDays){var nextOffset=difDays>0?7-difDays:-difDays;t=new Date(t+nextOffset*pvc.time.intervals.d);}
return t;},closestOrSelf:function(t,toWd){var wd=t.getDay(),difDays=wd-toWd;if(difDays){var D=pvc.time.intervals.d,sign=difDays>0?1:-1;difDays=Math.abs(difDays);t=difDays>=4?new Date(t.getTime()+sign*(7-difDays)*D):new Date(t.getTime()-sign*difDays*D);}
return t;}}};var pv_Mark=pv.Mark,pvc_markZOrder=pv_Mark.prototype.zOrder;pv_Mark.prototype.zOrder=function(zOrder){var borderPanel=this.borderPanel;return borderPanel&&borderPanel!==this?pvc_markZOrder.call(borderPanel,zOrder):pvc_markZOrder.call(this,zOrder);};pv_Mark.prototype.wrapper=function(wrapper){this._wrapper=wrapper;return this;};pv_Mark.prototype.wrap=function(f,m){if(f&&def.fun.is(f)&&this._wrapper&&!f._cccWrapped){f=this._wrapper(f,m);f._cccWrapped=!0;}
return f;};pv.Mark.prototype.call=function(f){f.call(this,this);};pv_Mark.prototype.lock=function(prop,value){void 0!==value&&this[prop](value);(this._locked||(this._locked={}))[prop]=!0;return this;};pv_Mark.prototype.isIntercepted=function(prop){return this._intercepted&&this._intercepted[prop];};pv_Mark.prototype.isLocked=function(prop){return this._locked&&this._locked[prop];};pv_Mark.prototype.ensureEvents=function(defEvs){var events=this.propertyValue("events",!0);events&&"none"!==events||this.events(defEvs||"all");return this;};pv_Mark.prototype.addMargin=function(name,margin){if(0!==margin){var staticValue=def.nullyTo(this.propertyValue(name),0),fMeasure=pv.functor(staticValue);this[name](function(){return margin+fMeasure.apply(this,pvc_arraySlice.call(arguments));});}
return this;};pv_Mark.prototype.addMargins=function(margins){var all=def.get(margins,"all",0);this.addMargin("left",def.get(margins,"left",all));this.addMargin("right",def.get(margins,"right",all));this.addMargin("top",def.get(margins,"top",all));this.addMargin("bottom",def.get(margins,"bottom",all));return this;};pv_Mark.prototype.eachInstanceWithData=function(fun,ctx){this.eachInstance(function(scenes,index,t){scenes.mark.sign&&scenes[index].data&&fun.call(ctx,scenes,index,t);});};pv_Mark.prototype.eachSceneWithDataOnRect=function(rect,fun,ctx,selectionMode){function processShape(shape,instance){if(shape.intersectsRect(rect)){var cccScene=instance.data;cccScene&&cccScene.datum&&fun.call(ctx,cccScene);}}
var me=this,sign=me.sign;if(!sign||sign.selectable()){null==selectionMode&&(selectionMode=me.rubberBandSelectionMode||"partial");var useCenter="center"===selectionMode;me.eachInstanceWithData(function(scenes,index,toScreen){var shape=me.getShape(scenes,index,.15);shape=(useCenter?shape.center():shape).apply(toScreen);processShape(shape,scenes[index]);});}};pv_Mark.prototype.eachDatumOnRect=function(rect,fun,ctx,selectionMode){function processShape(shape,instance){if(shape.intersectsRect(rect)){var cccScene=instance.data;cccScene&&cccScene.datum&&cccScene.datums().each(function(datum){datum.isNull||fun.call(ctx,datum);});}}
var me=this,sign=me.sign;if(!sign||sign.selectable()){null==selectionMode&&(selectionMode=me.rubberBandSelectionMode||"partial");var useCenter="center"===selectionMode;me.eachInstanceWithData(function(scenes,index,toScreen){var shape=me.getShape(scenes,index,.15);shape=(useCenter?shape.center():shape).apply(toScreen);processShape(shape,scenes[index]);});}};pv_Mark.prototype.getOwnerInstance=function(scene,index){var cccScene=scene[index].data;return cccScene instanceof pvc.visual.Scene&&(cccScene=cccScene.ownerScene)?cccScene.childIndex():index;};pv.Mark.prototype._ibits=-1;pv.Mark.prototype._imask=0;pv.Mark.prototype.ibits=function(ibits){if(arguments.length){ibits=pvc.visual.Interactive.parseBits(ibits);this._ibits=null==ibits?0:ibits;return this;}
return this._ibits;};pv.Mark.prototype.imask=function(imask){if(arguments.length){imask=pvc.visual.Interactive.parseBits(imask);this._imask=null==imask?0:imask;return this;}
return this._imask;};pv.Transform.prototype.transformHPosition=function(left){return this.x+this.k*left;};pv.Transform.prototype.transformVPosition=function(top){return this.y+this.k*top;};pv.Transform.prototype.transformLength=function(length){return this.k*length;};pv.Format.createParser=function(pvFormat){function parse(value){return value instanceof Date?value:def.number.is(value)?new Date(value):pvFormat.parse(value);}
return parse;};pv.Format.createFormatter=function(format){function safeFormat(value){return null!=value?format(value):"";}
return safeFormat;};pv.Color.prototype.describe=function(out,remLevels,keyArgs){return def.describeRecursive(out,this.key,remLevels,keyArgs);};pv_Mark.prototype.hasDelegateValue=function(name,tag){var p=this.$propertiesMap[name];return p?!tag||p.tag===tag:!!this.proto&&this.proto.hasDelegateValue(name,tag);};pvc.parseValuesOverflow=pvc.makeEnumParser("valuesOverflow",["show","trim","hide"],"hide");pvc.parseMultiChartOverflow=pvc.makeEnumParser("multiChartOverflow",["grow","fit","clip","page"],"grow");pvc.parseLegendClickMode=pvc.makeEnumParser("legendClickMode",["toggleSelected","toggleVisible","none"],"toggleVisible");pvc.parseTooltipAutoContent=pvc.makeEnumParser("tooltipAutoContent",["summary","value"],"value");pvc.parseSelectionMode=pvc.makeEnumParser("selectionMode",["rubberbandOrClick","click","rubberBand","focusWindow","custom"],"rubberbandOrClick");pvc.parseClearSelectionMode=pvc.makeEnumParser("clearSelectionMode",["emptySpaceClick","manual"],"emptySpaceClick");pvc.parsePointingMode=pvc.makeEnumParser("pointingMode",["over","near"],"near");pvc.parsePointingCollapse=pvc.makeEnumParser("pointingCollapse",["none","x","y"],"none");pvc.parseShape=pvc.makeEnumParser("shape",pv.Scene.hasSymbol,null);pvc.parseDataTypeCheckingMode=pvc.makeEnumParser("typeCheckingMode",["none","minimum","extended"],"minimum");pvc.parseLegendOverflow=pvc.makeEnumParser("legendOverflow",["clip","collapse"],"clip");pvc.parseLabelRotationDirection=pvc.makeEnumParser("labelRotationDirection",["clockwise","counterclockwise"],"clockwise");pvc.parseContinuousColorScaleType=function(scaleType){if(scaleType){scaleType=(""+scaleType).toLowerCase();switch(scaleType){case"linear":case"normal":case"discrete":break;default:def.debug>=2&&def.log("[Warning] Invalid 'ScaleType' option value: '"+scaleType+"'.");scaleType=null;}}
return scaleType;};pvc.parseDomainScope=function(scope,orientation){if(scope){scope=(""+scope).toLowerCase();switch(scope){case"cell":case"global":break;case"section":if(!orientation)throw def.error.argumentRequired("orientation");scope="y"===orientation?"row":"column";break;case"column":case"row":if(orientation&&orientation!==("row"===scope?"y":"x")){scope="section";def.debug>=2&&def.log("[Warning] Invalid 'DomainScope' option value: '"+scope+"' for the orientation: '"+orientation+"'.");}
break;default:def.debug>=2&&def.log("[Warning] Invalid 'DomainScope' option value: '"+scope+"'.");scope=null;}}
return scope;};pvc.parseDomainRoundingMode=function(mode){if(mode){mode=(""+mode).toLowerCase();switch(mode){case"none":case"nice":case"tick":break;default:def.debug>=2&&def.log("[Warning] Invalid 'DomainRoundMode' value: '"+mode+"'.");mode=null;}}
return mode;};pvc.parseOverlappedLabelsMode=function(mode){if(mode){mode=(""+mode).toLowerCase();switch(mode){case"leave":case"hide":case"rotate":case"rotatethenhide":break;default:def.debug>=2&&def.log("[Warning] Invalid 'OverlappedLabelsMode' option value: '"+mode+"'.");mode=null;}}
return mode;};pvc.parseTrendType=function(value){if(value){value=(""+value).toLowerCase();if("none"===value)return value;if(pvc.trends.has(value))return value;def.debug>=2&&def.log("[Warning] Invalid 'TrendType' value: '"+value+"'.");}};pvc.parseNullInterpolationMode=function(value){if(value){value=(""+value).toLowerCase();switch(value){case"none":case"linear":case"zero":return value;}
def.debug>=2&&def.log("[Warning] Invalid 'NullInterpolationMode' value: '"+value+"'.");}};pvc.parseAlign=function(side,align){align&&(align=(""+align).toLowerCase());var align2,isInvalid;if("left"===side||"right"===side){align2=align&&pvc.BasePanel.verticalAlign[align];if(!align2){align2="middle";isInvalid=!!align;}}else{align2=align&&pvc.BasePanel.horizontalAlign[align];if(!align2){align2="center";isInvalid=!!align;}}
isInvalid&&def.debug>=2&&def.log(def.format("Invalid alignment value '{0}'. Assuming '{1}'.",[align,align2]));return align2;};pvc.parseAnchor=function(anchor){if(anchor){anchor=(""+anchor).toLowerCase();switch(anchor){case"top":case"left":case"center":case"bottom":case"right":return anchor;}
def.debug>=2&&def.log(def.format("Invalid anchor value '{0}'.",[anchor]));}};pvc.parseAnchorWedge=function(anchor){if(anchor){anchor=(""+anchor).toLowerCase();switch(anchor){case"outer":case"inner":case"center":case"start":case"end":return anchor;}
def.debug>=2&&def.log(def.format("Invalid wedge anchor value '{0}'.",[anchor]));}};pvc.parsePosition=function(side,defaultSide){if(side){side=(""+side).toLowerCase();if(!def.hasOwn(pvc_Sides.namesSet,side)){var newSide=defaultSide||"left";def.debug>=2&&def.log(def.format("Invalid position value '{0}. Assuming '{1}'.",[side,newSide]));side=newSide;}}
return side||defaultSide||"left";};pvc.parseAxisFixedLength=function(size){var parsedLength;if(size){"string"==typeof size&&(size=pv.parseDatePrecision(size));"number"!=typeof size||size<=0?def.debug>=2&&def.log(def.format("Invalid fixed length value '{0}'.",[size])):parsedLength=size;}
return parsedLength;};pvc.parseAxisRatio=function(ratio){var parsedRatio;if("string"==typeof ratio){/([0-9]\u002F[0-9]|[0-9]\u002F[a-z]|[0-9]\u002F[0-9][a-z])/.test(ratio)&&(ratio=ratio.split("/"));if(2===ratio.length){var rangeSize=parseInt(ratio[0]),domainSize=pv.parseDatePrecision(ratio[1]);isNaN(rangeSize)||isNaN(domainSize)||0==domainSize||(ratio=rangeSize/domainSize);}}"number"!=typeof ratio||ratio<0?def.debug>=2&&def.log(def.format("Invalid ratio value '{0}'.",[ratio])):parsedRatio=ratio;return parsedRatio;};pvc.parseDomainAlign=function(fixValue){var fixValue2;if(fixValue){fixValue=(""+fixValue).toLowerCase();switch(fixValue){case"max":case"min":case"center":return fixValue;}
fixValue2="center";def.debug>=2&&def.log(def.format("Invalid domain align value '{0}'. Assuming '{1}'.",[fixValue,fixValue2]));}
return fixValue2;};pvc.parseDimensionName=function(name,chart){if(name){name=(""+name).toLowerCase();if(chart.data.type.dimensions(name,{assertExists:!1}))return name;def.debug>=2&&def.log(def.format("[Warning] Undefined dimension with name '{0}'.",[name]));}
return null;};var pvc_Offset=def.type("pvc.Offset").init(function(x,y){if(1===arguments.length)null!=x&&this.setOffset(x);else{null!=x&&(this.x=x);null!=y&&(this.y=y);}}).add({describe:function(out,remLevels,keyArgs){return def.describeRecursive(out,def.copyOwn(this),remLevels,keyArgs);},setOffset:function(offset,keyArgs){if("string"==typeof offset){var comps=offset.split(/\s+/).map(function(comp){return pvc_PercentValue.parse(comp);});switch(comps.length){case 1:this.set(def.get(keyArgs,"singleProp","all"),comps[0]);return this;case 2:this.set("x",comps[0]);this.set("y",comps[1]);return this;case 0:return this;}}else{if("number"==typeof offset){this.set(def.get(keyArgs,"singleProp","all"),offset);return this;}
if("object"==typeof offset){this.set("all",offset.all);for(var p in offset)"all"!==p&&this.set(p,offset[p]);return this;}}
def.debug&&def.log("Invalid 'offset' value: "+def.describe(offset));return this;},set:function(prop,value){if(null!=value&&def.hasOwn(pvc_Offset.namesSet,prop)){value=pvc_PercentValue.parse(value);null!=value&&("all"===prop?pvc_Offset.names.forEach(function(p){this[p]=value;},this):this[prop]=value);}},resolve:function(refSize){var offset={};pvc_Size.names.forEach(function(length){var offsetProp=pvc_Offset.namesSizeToOffset[length],offsetValue=this[offsetProp];if(null!=offsetValue)if("number"==typeof offsetValue)offset[offsetProp]=offsetValue;else if(refSize){var refLength=refSize[length];null!=refLength&&(offset[offsetProp]=offsetValue.resolve(refLength));}},this);return offset;}});pvc_Offset.type().add({names:["x","y"],namesSizeToOffset:{width:"x",height:"y"},namesSidesToOffset:{left:"x",right:"x",top:"y",bottom:"y"},as:function(v){null==v||v instanceof pvc_Offset||(v=new pvc_Offset().setOffset(v));return v;}}).add({namesSet:pv.dict(pvc_Offset.names,def.retTrue)});var pvc_PercentValue=pvc.PercentValue=function(pct){this.percent=pct;};pvc_PercentValue.prototype.resolve=function(total){return this.percent*total;};pvc_PercentValue.prototype.divide=function(divisor){return new pvc_PercentValue(this.percent/divisor);};pvc_PercentValue.divide=function(value,divisor){return value instanceof pvc_PercentValue?value.divide(divisor):value/divisor;};pvc_PercentValue.parse=function(value){if(null!=value&&""!==value){switch(typeof value){case"number":return value;case"string":var match=value.match(/^(.+?)\s*(%)?$/);if(match){var n=+match[1];if(!isNaN(n)){if(!match[2])return n;if(n>=0)return new pvc_PercentValue(n/100);}}
break;case"object":if(value instanceof pvc_PercentValue)return value;}
def.debug&&def.log(def.format("Invalid margins component '{0}'",[""+value]));}};pvc_PercentValue.resolve=function(value,total){return value instanceof pvc_PercentValue?value.resolve(total):value;};var pvc_Sides=pvc.Sides=function(sides){null!=sides&&this.setSides(sides);};pvc_Sides.hnames="left right".split(" ");pvc_Sides.vnames="top bottom".split(" ");pvc_Sides.names="left right top bottom".split(" ");pvc_Sides.namesSet=pv.dict(pvc_Sides.names,def.retTrue);pvc_Sides.as=function(v){null==v||v instanceof pvc_Sides||(v=new pvc_Sides().setSides(v));return v;};pvc_Sides.to=function(v){null!=v&&v instanceof pvc_Sides||(v=new pvc_Sides().setSides(v));return v;};pvc_Sides.prototype.describe=function(out,remLevels,keyArgs){return def.describeRecursive(out,def.copyOwn(this),remLevels,keyArgs);};pvc_Sides.prototype.setSides=function(sides){if("string"==typeof sides){var comps=sides.split(/\s+/).map(function(comp){return pvc_PercentValue.parse(comp);});switch(comps.length){case 1:this.set("all",comps[0]);return this;case 2:this.set("top",comps[0]);this.set("left",comps[1]);this.set("right",comps[1]);this.set("bottom",comps[0]);return this;case 3:this.set("top",comps[0]);this.set("left",comps[1]);this.set("right",comps[1]);this.set("bottom",comps[2]);return this;case 4:this.set("top",comps[0]);this.set("right",comps[1]);this.set("bottom",comps[2]);this.set("left",comps[3]);return this;case 0:return this;}}else{if("number"==typeof sides){this.set("all",sides);return this;}
if("object"==typeof sides){if(sides instanceof pvc_PercentValue)this.set("all",sides);else if(sides instanceof pvc_Sides)pvc_Sides.names.forEach(function(p){def.hasOwn(sides,p)&&(this[p]=sides[p]);},this);else{this.set("all",sides.all);this.set("width",sides.width);this.set("height",sides.height);for(var p in sides)pvc_Sides.namesSet.hasOwnProperty(p)&&this.set(p,sides[p]);}
return this;}}
def.debug&&def.log("Invalid 'sides' value: "+def.describe(sides));return this;};pvc_Sides.prototype.set=function(prop,value){value=pvc_PercentValue.parse(value);if(null!=value)switch(prop){case"all":pvc_Sides.names.forEach(function(p){this[p]=value;},this);break;case"width":this.left=this.right=pvc_PercentValue.divide(value,2);break;case"height":this.top=this.bottom=pvc_PercentValue.divide(value,2);break;default:def.hasOwn(pvc_Sides.namesSet,prop)&&(this[prop]=value);}};pvc_Sides.prototype.resolve=function(width,height){if("object"==typeof width){height=width.height;width=width.width;}
var sides={};pvc_Sides.names.forEach(function(side){var value=0,sideValue=this[side];null!=sideValue&&(value="number"==typeof sideValue?sideValue:sideValue.resolve("left"===side||"right"===side?width:height));sides[side]=value;},this);return pvc_Sides.updateSize(sides);};pvc_Sides.updateSize=function(sides){sides.width=(sides.left||0)+(sides.right||0);sides.height=(sides.bottom||0)+(sides.top||0);return sides;};pvc_Sides.prototype.getDirectionPercentage=function(a_length){var me=this;return("width"===a_length?pvc_Sides.hnames:pvc_Sides.vnames).reduce(function(pct,side){return(me.getSidePercentage(side)||0)+pct;},0);};pvc_Sides.prototype.getSidePercentage=function(side){var value=this[side];return null!=value&&"number"!=typeof value?value.percent:null;};pvc_Sides.resolvedMax=function(a,b){var sides={};pvc_Sides.names.forEach(function(side){sides[side]=Math.max(a[side]||0,b[side]||0);});return pvc_Sides.updateSize(sides);};pvc_Sides.inflate=function(sides,by){var sidesOut={};pvc_Sides.names.forEach(function(side){sidesOut[side]=(sides[side]||0)+by;});return pvc_Sides.updateSize(sidesOut);};pvc_Sides.filterAnchor=function(a,sides){var filtered=new pvc_Sides();pvc_Sides.getAnchorSides(a).forEach(function(side){filtered.set(side,sides[side]);});return filtered;};pvc_Sides.getAnchorSides=function(a){switch(a){case"left":case"right":return pvc_Sides.vnames;case"top":case"bottom":return pvc_Sides.hnames;case"fill":return pvc_Sides.names;}};var pvc_Size=def.type("pvc.Size").init(function(width,height){if(1===arguments.length)null!=width&&this.setSize(width);else{null!=width&&(this.width=width);null!=height&&(this.height=height);}}).add({describe:function(out,remLevels,keyArgs){return def.describeRecursive(out,def.copyOwn(this),remLevels,keyArgs);},setSize:function(size,keyArgs){if("string"==typeof size){var comps=size.split(/\s+/).map(function(comp){return pvc_PercentValue.parse(comp);});switch(comps.length){case 1:this.set(def.get(keyArgs,"singleProp","all"),comps[0]);return this;case 2:this.set("width",comps[0]);this.set("height",comps[1]);return this;case 0:return this;}}else{if("number"==typeof size){this.set(def.get(keyArgs,"singleProp","all"),size);return this;}
if("object"==typeof size){if(size instanceof pvc_PercentValue)this.set(def.get(keyArgs,"singleProp","all"),size);else{this.set("all",size.all);for(var p in size)"all"!==p&&this.set(p,size[p]);}
return this;}}
def.debug&&def.log("Invalid 'size' value: "+def.describe(size));return this;},set:function(prop,value){if(null!=value&&("all"===prop||def.hasOwn(pvc_Size.namesSet,prop))){value=pvc_PercentValue.parse(value);null!=value&&("all"===prop?pvc_Size.names.forEach(function(p){this[p]=value;},this):this[prop]=value);}
return this;},clone:function(){return new pvc_Size(this.width,this.height);},intersect:function(size){return new pvc_Size(Math.min(this.width,size.width),Math.min(this.height,size.height));},resolve:function(refSize){var size={};pvc_Size.names.forEach(function(length){var lengthValue=this[length];if(null!=lengthValue)if("number"==typeof lengthValue)size[length]=lengthValue;else if(refSize){var refLength=refSize[length];null!=refLength&&(size[length]=lengthValue.resolve(refLength));}},this);return size;}});pvc_Size.names=["width","height"];pvc_Size.namesSet=pv.dict(pvc_Size.names,def.retTrue);pvc_Size.toOrtho=function(value,anchor){if(null!=value){var a_ol;anchor&&(a_ol=pvc.BasePanel.orthogonalLength[anchor]);value=pvc_Size.to(value,{singleProp:a_ol});anchor&&delete value[pvc.BasePanel.oppositeLength[a_ol]];}
return value;};pvc_Size.to=function(v,keyArgs){null==v||v instanceof pvc_Size||(v=new pvc_Size().setSize(v,keyArgs));return v;};pvc_Size.applyMax=function(size,sizeMax){var v,vMax;null!=(vMax=sizeMax.width)&&null!=(v=size.width)&&v>vMax&&(size.width=vMax);null!=(vMax=sizeMax.height)&&null!=(v=size.height)&&v>vMax&&(size.height=vMax);return size;};pvc_Size.applyMin=function(size,sizeMin){var v,vMin;null!=(vMin=sizeMin.width)&&null!=(v=size.width)&&v<vMin&&(size.width=vMin);null!=(vMin=sizeMin.height)&&null!=(v=size.height)&&v<vMin&&(size.height=vMin);return size;};pvc_Size.applyMinMax=function(size,sizeMin,sizeMax){var v,vLim;null!=(v=size.width)&&(null!=(vLim=sizeMin.width)&&v<vLim?size.width=vLim:null!=(vLim=sizeMax.width)&&v>vLim&&(size.width=vLim));null!=(v=size.height)&&(null!=(vLim=sizeMin.height)&&v<vLim?size.height=vLim:null!=(vLim=sizeMax.height)&&v>vLim&&(size.height=vLim));return size;};pvc_Size.deflate=function(size,byWidth,byHeight){var v;return{width:null!=(v=size.width)?Math.max(v-byWidth,0):null,height:null!=(v=size.height)?Math.max(v-byHeight,0):null};};pvc_Size.inflate=function(size,byWidth,byHeight){var v;return{width:null!=(v=size.width)?v+byWidth:null,height:null!=(v=size.height)?v+byHeight:null};};pvc_Size.clone=function(size){return{width:size.width,height:size.height};};def.type("pvc.Abstract").init(function(){this.log=def.logger(this._getLogId,this);}).add({invisibleLineWidth:.001,defaultLineWidth:1.5,_logId:null,_getLogId:function(){return this._logId||(this._logId=this._processLogId(this._createLogId()));},_createLogId:function(){return String(def.qualNameOf(this.constructor));},_processLogId:function(logInstanceId){var s=logInstanceId.substr(0,30);s.length<30&&(s+=def.array.create(30-s.length," ").join(""));return"["+s+"]";}});pvc_options.resolvers=options_resolvers;pvc_options.constant=options_constantResolver;pvc_options.specify=options_specifyResolver;pvc_options.defaultValue=options_defaultResolver;pvc.options=pvc_options;var pvc_OptionInfo=def.type().init(function(name,option,context,spec){this.name=name;this.option=option;this._dv=this.value=def.get(spec,"value");this._resolve=def.get(spec,"resolve");var resolved=!this._resolve;this.isResolved=resolved;this.isSpecified=!1;this._setCalled=!1;this._context=context;this._cast=def.get(spec,"cast");this._getDefault=resolved?null:def.get(spec,"getDefault");this.data=def.get(spec,"data");}).add({resolve:function(){if(!this.isResolved){this.isResolved=!0;this._setCalled=!1;this._getFunProp("_resolve").call(this._context,this);if(!this._setCalled){this.isSpecified=!1;var value=this._dynDefault();null!=value&&(this.value=this._dv=value);}}
return this;},specify:function(value){return this.set(value,!1);},defaultValue:function(defaultValue){arguments.length&&this.set(defaultValue,!0);return this._dv;},cast:function(value){if(null!=value){var cast=this._getFunProp("_cast");cast&&(value=cast.call(this._context,value));}
return value;},set:function(value,isDefault){this._setCalled=!0;null!=value&&(value=this.cast(value));if(null==value){value=this._dynDefault();if(null==value){if(!this.isSpecified)return this;value=this._dv;}
isDefault=!0;}
if(isDefault){this._dv=value;this.isSpecified||(this.value=value);}else{this.isResolved=this.isSpecified=!0;this.value=value;}
return this;},_dynDefault:function(){var get=this._getFunProp("_getDefault");return get&&this.cast(get.call(this._context,this));},_getFunProp:function(name){var ctx,fun=this[name];fun&&(ctx=this._context)&&def.string.is(fun)&&(fun=ctx[fun]);return fun;}});def.MetaType.subType(OptionsMetaType,{methods:{options:function(optionsDef){return def.mixin(this.optionsDef,optionsDef),this;},_addInitSteps:function(steps){function initOptions(){this.option=pvc.options(type.optionsDef,this);}
this.base(steps);var type=this;steps.push(initOptions);}}});var pvc_OptionBase=OptionsMetaType.Ctor;def("pvc.visual.OptionsBase",pvc_OptionBase.configure({init:function(chart,type,index,keyArgs){this.type=type;this.chart=chart;this.index=null==index?0:index;this.name=def.get(keyArgs,"name");this.id=def.indexedId(this.type,this.index);this.optionId=this._buildOptionId(keyArgs);var rs=this._resolvers=[];this._registerResolversFull(rs,keyArgs);},methods:{_buildOptionId:function(keyArgs){return this.id;},_chartOption:function(name){return this.chart.options[name];},_registerResolversFull:function(rs,keyArgs){var fixed=def.get(keyArgs,"fixed");if(fixed){this._fixed=fixed;rs.push(pvc.options.specify(function(optionInfo){return fixed[optionInfo.name];}));}
this._registerResolversNormal(rs,keyArgs);var defaults=def.get(keyArgs,"defaults");defaults&&(this._defaults=defaults);rs.push(this._resolveDefault);},_registerResolversNormal:function(rs,keyArgs){def.get(keyArgs,"byV1",1)&&this.chart.compatVersion()<=1&&rs.push(this._resolveByV1OnlyLogic);this.name&&def.get(keyArgs,"byName",1)&&rs.push(this._resolveByName);def.get(keyArgs,"byId",1)&&rs.push(this._resolveByOptionId);def.get(keyArgs,"byNaked",!this.index)&&rs.push(this._resolveByNaked);},_resolveFull:function(optionInfo){for(var rs=this._resolvers,i=0,L=rs.length;i<L;i++)if(rs[i].call(this,optionInfo))return!0;return!1;},_resolveFixed:pvc.options.specify(function(optionInfo){if(this._fixed)return this._fixed[optionInfo.name];}),_resolveByV1OnlyLogic:function(optionInfo){var resolverV1,data=optionInfo.data;if(data&&(resolverV1=data.resolveV1))return resolverV1.call(this,optionInfo);},_resolveByName:pvc.options.specify(function(optionInfo){if(this.name)return this._chartOption(this.name+def.firstUpperCase(optionInfo.name));}),_resolveByOptionId:pvc.options.specify(function(optionInfo){return this._chartOption(this.optionId+def.firstUpperCase(optionInfo.name));}),_resolveByNaked:pvc.options.specify(function(optionInfo){return this._chartOption(def.firstLowerCase(optionInfo.name));}),_resolveDefault:function(optionInfo){var resolverDefault,data=optionInfo.data;if(data&&(resolverDefault=data.resolveDefault)&&resolverDefault.call(this,optionInfo))return!0;if(this._defaults){var value=this._defaults[optionInfo.name];if(void 0!==value)return optionInfo.defaultValue(value),!0;}},_specifyChartOption:function(optionInfo,asName){var value=this._chartOption(asName);if(null!=value)return optionInfo.specify(value),!0;}}}));def.scope(function(){function parseBitsCore(ibits){ibits=Math.floor(ibits);return isNaN(ibits)?null:ibits<-1||!isFinite(ibits)?-1:ibits;}
var I=def.makeEnum(["Interactive","ShowsActivity","ShowsSelection","ShowsTooltip","Selectable","Unselectable","Hoverable","Clickable","DoubleClickable","SelectableByClick","SelectableByRubberband","SelectableByFocusWindow","Animatable"]);I.ShowsInteraction=I.ShowsActivity|I.ShowsSelection;I.Actionable=I.Hoverable|I.Clickable|I.DoubleClickable|I.SelectableByClick;I.HandlesEvents=I.Actionable|I.ShowsTooltip;I.HandlesClickEvent=I.Clickable|I.SelectableByClick;def("pvc.visual.Interactive",def.Object.extend({"type.methods":[I,{ShowsAny:I.ShowsInteraction|I.ShowsTooltip,SelectableAny:I.Selectable|I.SelectableByClick|I.SelectableByRubberband|I.SelectableByFocusWindow,parseBits:function(value){if(null==value)return null;if("number"==typeof value)return parseBitsCore(value);"string"!=typeof value&&(value=String(value));var ibits=parseBitsCore(+value);if(null!==ibits)return ibits;value.split(/\s*\|\s*/).forEach(function(sbit){var ibit=def.getOwn(I,sbit);null!=ibit&&(null===ibits?ibits=ibit:ibits|=ibit);});return ibits;}}],methods:[{_ibits:-1,ibits:function(){return this._ibits;}},def.query(def.ownKeys(I)).object({name:def.firstLowerCase,value:function(p){var mask=I[p];return function(){return!!(this.ibits()&mask);};}})]}));});pvc.color={scale:pvc_colorScale,scales:pvc_colorScales,toGray:pvc.toGrayScale,isGray:pvc_colorIsGray};def.type("pvc.color.ScalesBuild").init(function(keyArgs){this.keyArgs=keyArgs;this.data=keyArgs.data||def.fail.argumentRequired("keyArgs.data");this.domainDimName=keyArgs.colorDimension||def.fail.argumentRequired("keyArgs.colorDimension");this.domainDim=this.data.dimensions(this.domainDimName);var dimType=this.domainDim.type;if(dimType.isComparable)this.domainComparer=function(a,b){return dimType.compare(a,b);};else{this.domainComparer=null;def.log("Color value dimension should be comparable. Generated color scale may be invalid.");}
this.nullRangeValue=keyArgs.colorMissing?pv.color(keyArgs.colorMissing):pv.Color.transparent;this.domainRangeCountDif=0;}).add({build:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var domain=this._getDomain();return this._createScale(domain);},buildMap:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var createCategoryScale;if(this.keyArgs.normPerBaseCategory)createCategoryScale=function(leafData){var domain=this._ensureDomain(null,!1,leafData);return this._createScale(domain);};else{var domain=this._getDomain(),scale=this._createScale(domain);createCategoryScale=def.fun.constant(scale);}
return this._createCategoryScalesMap(createCategoryScale);},_createScale:def.abstractMethod,_createCategoryScalesMap:function(createCategoryScale){return this.data.children().object({name:function(leafData){return leafData.absKey;},value:createCategoryScale,context:this});},_getRange:function(){var keyArgs=this.keyArgs,range=keyArgs.colors||["red","yellow","green"];null!=keyArgs.colorMin&&null!=keyArgs.colorMax?range=[keyArgs.colorMin,keyArgs.colorMax]:null!=keyArgs.colorMin?range.unshift(keyArgs.colorMin):null!=keyArgs.colorMax&&range.push(keyArgs.colorMax);return range.map(function(c){return pv.color(c);});},_getDataExtent:function(data){var extent=data.dimensions(this.domainDimName).extent({visible:!0});if(!extent)return null;var min=extent.min.value,max=extent.max.value;max==min&&(max>=1?min=max-1:max=min+1);return{min:min,max:max};},_getDomain:function(){var domain=this.keyArgs.colorDomain;if(null!=domain){domain=domain.slice();this.domainComparer&&domain.sort(this.domainComparer);domain.length>this.desiredDomainCount&&(domain=domain.slice(0,this.desiredDomainCount));}else domain=[];return this._ensureDomain(domain,!0,this.data);},_ensureDomain:function(domain,doDomainPadding,data){var extent;if(domain&&doDomainPadding){var domainPointsMissing=this.desiredDomainCount-domain.length;if(domainPointsMissing>0){extent=this._getDataExtent(data);if(extent)switch(domainPointsMissing){case 1:this.domainComparer?def.array.insert(domain,extent.max,this.domainComparer):domain.push(extent.max);break;case 2:if(this.domainComparer){def.array.insert(domain,extent.min,this.domainComparer);def.array.insert(domain,extent.max,this.domainComparer);}else{domain.unshift(extent.min);domain.push(extent.max);}
break;default:def.debug>=2&&def.log("Ignoring option 'colorDomain' due to unsupported length."+def.format(" Should have '{0}', but instead has '{1}'.",[this.desiredDomainCount,domain.length]));domain=null;}}}
if(!domain){extent||(extent=this._getDataExtent(data));if(extent){var min=extent.min,max=extent.max,step=(max-min)/(this.desiredDomainCount-1);domain=pv.range(min,max+step,step);}}
return domain;}});def.type("pvc.color.LinearScalesBuild",pvc.color.ScalesBuild).add({_createScale:function(domain){var scale=pv.Scale.linear();domain&&scale.domain.apply(scale,domain);scale.range.apply(scale,this.range);return scale;}});def.type("pvc.color.DiscreteScalesBuild",pvc.color.ScalesBuild).init(function(keyArgs){this.base(keyArgs);this.domainRangeCountDif=1;}).add({_createScale:function(domain){function scale(val){if(null==val)return nullRangeValue;for(var i=0;i<Dl;i++)if(val<=domain[i+1])return range[i];return range[Rl];}
var Dl=domain.length-1,range=this.range,nullRangeValue=this.nullRangeValue,Rl=range.length-1;def.copy(scale,pv.Scale.common);scale.domain=function(){return domain;};scale.range=function(){return range;};return scale;}});def.type("pvc.visual.Context").init(function(panel,mark,scene){this.chart=panel.chart;this.panel=panel;visualContext_update.call(this,mark,scene);}).add({get parent(){throw def.error.operationInvalid("The 'this.parent.index' idiom has no equivalent in this version. Please try 'this.pvMark.parent.index'.");},isPinned:!1,pin:function(){this.isPinned=!0;return this;},compatVersion:function(){return this.panel.compatVersion();},getCompatFlag:function(flagName){return this.panel.getCompatFlag(flagName);},finished:function(v){return this.sign.finished(v);},delegate:function(dv){return this.sign.delegate(dv);},getV1Series:function(){var s;return def.nullyTo(this.scene.firstAtoms&&(s=this.scene.firstAtoms[this.panel._getV1DimName("series")])&&s.rawValue,"Series");},getV1Category:function(){var c;return this.scene.firstAtoms&&(c=this.scene.firstAtoms[this.panel._getV1DimName("category")])&&c.rawValue;},getV1Value:function(){var v;return this.scene.firstAtoms&&(v=this.scene.firstAtoms[this.panel._getV1DimName("value")])&&v.value;},getV1Datum:function(){return this.panel._getV1Datum(this.scene);},get:function(name,prop){return this.scene.get(name,prop);},getSeries:function(){return this.scene.get("series");},getCategory:function(){return this.scene.get("category");},getValue:function(){return this.scene.get("value");},getTick:function(){return this.scene.get("tick");},getX:function(){return this.scene.get("x");},getY:function(){return this.scene.get("y");},getColor:function(){return this.scene.get("color");},getSize:function(){return this.scene.get("size");},getSeriesLabel:function(){return this.scene.get("series","label");},getCategoryLabel:function(){return this.scene.get("category","label");},getValueLabel:function(){return this.scene.get("value","label");},getTickLabel:function(){return this.scene.get("tick","label");},getXLabel:function(){return this.scene.get("x","label");},getYLabel:function(){return this.scene.get("y","label");},getColorLabel:function(){return this.scene.get("color","label");},getSizeLabel:function(){return this.scene.get("size","label");},select:function(ka){return this.scene.select(ka);},toggleVisible:function(){return this.scene.toggleVisible();},click:function(){var me=this;me.clickable()&&me.panel._onClick(me);if(me.selectableByClick()){var ev=me.event;me.select({replace:!ev||!(ev.ctrlKey||ev.metaKey)});}},doubleClick:function(){this.doubleClickable()&&this.panel._onDoubleClick(this);},clickable:function(){var me=this;return(me.sign?me.sign.clickable():me.panel.clickable())&&(!me.scene||me.scene.clickable());},selectableByClick:function(){var me=this;return(me.sign?me.sign.selectableByClick():me.panel.selectableByClick())&&(!me.scene||me.scene.selectableByClick());},doubleClickable:function(){var me=this;return(me.sign?me.sign.doubleClickable():me.panel.doubleClickable())&&(!me.scene||me.scene.doubleClickable());},hoverable:function(){var me=this;return(me.sign?me.sign.hoverable():me.panel.hoverable())&&(!me.scene||me.scene.hoverable());}});pvc.text={getFitInfo:function(w,h,text,font,diagMargin){if(""===text)return{h:!0,v:!0,d:!0};var len=pv.Text.measureWidth(text,font);return{h:len<=w,v:len<=h,d:len<=Math.sqrt(w*w+h*h)-diagMargin};},trimToWidthB:function(len,text,font,trimTerminator,before){var terminLen=pv.Text.measureWidth(trimTerminator,font),clipLen=1.5*terminLen;return pvc.text.trimToWidth(len,text,font,trimTerminator,before,clipLen);},trimToWidth:function(len,text,font,trimTerminator,before,clipLen){if(""===text)return text;pv.Text.measureWidth(text,font)>len&&(text=pvc.text.trimToWidthBin(len,text,font,trimTerminator,before,clipLen));return text;},trimToWidthBin:function(len,text,font,trimTerminator,before,clipLen){function slice(text,sBefore,sAfter){return before?text.slice(sBefore):text.slice(0,sAfter);}
var highLen=pv.Text.measureWidth(text,font);if(highLen<=len)return text;for(var mid,lowLen=0,targetLen=Math.max(0,len-pv.Text.measureWidth(trimTerminator,font)),tCount=text.length,high=tCount-1,low=0;low<high&&high>0;){var targetRelativePosition=(targetLen-lowLen)/(highLen-lowLen);mid=Math.ceil(low*(1-targetRelativePosition)+high*targetRelativePosition);var textMid=slice(text,tCount-mid,mid),textLen=pv.Text.measureWidth(textMid,font);if(textLen>targetLen){high=mid-1;highLen=textLen;}else{if(!(pv.Text.measureWidth(slice(text,tCount-mid-1,mid+1),font)<targetLen))return clipLen&&textLen<=clipLen?"":before?trimTerminator+textMid:textMid+trimTerminator;low=mid+1;lowLen=textLen;}}
text=slice(text,tCount-high,high);textLen=pv.Text.measureWidth(text,font);return clipLen&&textLen<=clipLen?"":before?trimTerminator+text:text+trimTerminator;},justify:function(text,lineWidth,font){var lines=[];if(lineWidth<pv.Text.measureWidth("a",font))return lines;for(var words=(text||"").split(/\s+/),line="";words.length;){var word=words.shift();if(word){var nextLine=line?line+" "+word:word;if(pv.Text.measureWidth(nextLine,font)>lineWidth){line&&lines.push(line);line=word;}else line=nextLine;}}
line&&lines.push(line);return lines;},getLabelBBox:function(textWidth,textHeight,align,baseline,angle,margin){var polygon=pv.Label.getPolygon(textWidth,textHeight,align,baseline,angle,margin),bbox=polygon.bbox();bbox.source=polygon;bbox.sourceAngle=angle;bbox.sourceAlign=align;bbox.sourceTextWidth=textWidth;return bbox;}};def.space("pvc.trends",function(trends){var _trends={};def.set(trends,"define",function(type,trendSpec){type||def.fail.argumentRequired("type");trendSpec||def.fail.argumentRequired("trendSpec");def.object.is(trendSpec)||def.fail.argumentInvalid("trendSpec","Must be a trend specification object.");type=(""+type).toLowerCase();def.debug>=2&&def.hasOwn(_trends,type)&&def.log(def.format("[WARNING] A trend type with the name '{0}' is already defined.",[type]));var label=trendSpec.label||def.fail.argumentRequired("trendSpec.label"),model=trendSpec.model||def.fail.argumentRequired("trendSpec.model");def.fun.is(model)||def.fail.argumentInvalid("trendSpec.mode","Must be a function.");var trendInfo={dataPartAtom:{v:"trend",f:label},type:type,label:label,model:model};_trends[type]=trendInfo;},"get",function(type){type||def.fail.argumentRequired("type");return def.getOwn(_trends,type)||def.fail.operationInvalid("Undefined trend type '{0}'.",[type]);},"has",function(type){return def.hasOwn(_trends,type);},"types",function(){return def.ownKeys(_trends);});trends.define("linear",{label:"Linear trend",model:function(options){for(var rows=def.get(options,"rows"),funX=def.get(options,"x"),funY=def.get(options,"y"),i=0,N=0,sumX=0,sumY=0,sumXY=0,sumXX=0,parseNum=function(value){return null!=value?+value:NaN;};rows.next();){var row=rows.item,x=funX?parseNum(funX(row)):i;if(!isNaN(x)){var y=parseNum(funY(row));if(!isNaN(y)){N++;sumX+=x;sumY+=y;sumXY+=x*y;sumXX+=x*x;}}
i++;}
if(N>=2){var avgX=sumX/N,avgY=sumY/N,avgXY=sumXY/N,avgXX=sumXX/N,den=avgXX-avgX*avgX,beta=0===den?0:(avgXY-avgX*avgY)/den,alpha=avgY-beta*avgX;return{alpha:alpha,beta:beta,reset:def.noop,sample:function(x){return alpha+beta*+x;}};}}});trends.define("moving-average",{label:"Moving average",model:function(options){var W=Math.max(+(def.get(options,"periods")||3),2),sum=0,avgValues=[];return{reset:function(){sum=0;avgValues.length=0;},sample:function(x,y,i){var L=W;if(null!=y){avgValues.unshift(y);sum+=y;L=avgValues.length;if(L>W){sum-=avgValues.pop();L=W;}}
return sum/L;}};}});trends.define("weighted-moving-average",{label:"Weighted Moving average",model:function(options){var W=Math.max(+(def.get(options,"periods")||3),2),sum=0,numer=0,avgValues=[],L=0,denom=0;return{reset:function(){sum=numer=denom=L=0;avgValues.length=0;},sample:function(x,y){if(null!=y)if(L<W){avgValues.push(y);L++;denom+=L;numer+=L*y;sum+=y;}else{numer+=L*y-sum;sum+=y-avgValues[0];for(var j=1;j<W;j++)avgValues[j-1]=avgValues[j];avgValues[W-1]=y;}
return numer/denom;}};}});});pvc.spec={on:pvc_spec_addEvent.bind(null,"on"),before:pvc_spec_addEvent.bind(null,"before"),after:pvc_spec_addEvent.bind(null,"after")};def("pvc.visual.SlidingWindow",pvc.visual.OptionsBase.extend({init:function(chart){this.base(chart,"slidingWindow",0,{byNaked:!1});this.length=this.option("Length");},methods:{length:null,dimension:null,select:slidingWindow_defaultSelect,initFromOptions:function(){if(this.length){this.dimension=this.option("Dimension");this.override("select",this.option("Select"));}},setDataFilter:function(data){data.select=this.select.bind(this);},setDimensionsOptions:function(complexType){var chart=this.chart,dimOpts=chart.options.dimensions,dimGroupOpts=chart.options.dimensionGroups;complexType.dimensionsList().forEach(function(mainDimType){if(mainDimType.isDiscrete){var mainDimName=mainDimType.name,dimSpecs=dimOpts&&dimOpts[mainDimName];if(!dimSpecs||!dimSpecs.comparer){var dimGroup=cdo.DimensionType.dimensionGroupName(mainDimName),dimGroupSpecs=dimGroupOpts&&dimGroupOpts[dimGroup];if(!dimGroupSpecs||!dimGroupSpecs.comparer){chart.visualRolesOf(mainDimName,!0)&&mainDimType.setComparer(def.ascending);}}}});},setLayoutPreservation:function(chart){null==chart.options.preserveLayout&&(chart.options.preserveLayout=!0);},setAxesDefaults:function(chart){chart.axesList.forEach(function(axis){var role=axis.role;if(role){if(role.grouping.isSingleDimension&&role.grouping.singleDimensionName===this.dimension){axis.option.defaults({PreserveTickAlignment:!0});this._setAxisFixedRatio(axis);}"color"===axis.type&&axis.option.defaults({PreserveMap:!0});}},this);},_setAxisFixedRatio:function(axis){var axisOption=axis.option;if(axisOption.isDefined("FixedLength")&&axisOption.isDefined("PreserveRatio")){this.option.isSpecified("Length")&&axis.option.defaults({FixedLength:this.length});axis.option.defaults({PreserveRatio:!0});}}},options:{Dimension:{resolve:"_resolveFull",cast:function(name){return pvc.parseDimensionName(name,this.chart);},getDefault:slidingWindow_defaultDimensionName},Length:{resolve:"_resolveFull",cast:function(interval){return pv.parseDatePrecision(interval,null);}},Select:{resolve:"_resolveFull",cast:def.fun.as,getDefault:function(){return slidingWindow_defaultSelect.bind(this);}}}}));def.MetaType.subType(SceneMetaType,{methods:{variable:function(name,impl){var methods;if(this._vars[name])void 0!==impl&&(methods=def.set({},"_"+name+"EvalCore",def.fun.to(impl)));else{this._vars[name]=!0;var instProto=this.Ctor.prototype;methods={};var nameEval="_"+name+"Eval";methods[name]=scene_createVarMainMethod(name,nameEval);var nameEvalCore=nameEval+"Core";def.hasOwn(instProto,nameEval)||(methods[nameEval]=def.methodCaller(nameEvalCore));def.hasOwn(instProto,nameEvalCore)||(methods[nameEvalCore]=def.fun.to(void 0===impl?null:impl));}
methods&&this.methods(methods);return this;}}});var pvc_Scene=SceneMetaType.Ctor;def("pvc.visual.Scene",pvc_Scene.configure({init:function(parent,keyArgs){def.debug>=4&&(this.id=def.nextId("scene"));this._renderId=0;this.renderState={};pv.Dom.Node.call(this,null);this.parent=parent||null;if(parent){this.root=parent.root;var index=def.get(keyArgs,"index",null);parent.insertAt(this,index);}else{this.root=this;this._active=null;this._panel=def.get(keyArgs,"panel")||def.fail.argumentRequired("panel","Argument is required on root scene.");}
var first,group,datum,datums,groups,atoms,firstAtoms,dataSource=def.array.to(def.get(keyArgs,"source"));if(dataSource&&dataSource.length){this.source=dataSource;first=dataSource[0];if(first instanceof cdo.Data){group=first;groups=dataSource;datum=group.firstDatum()||def.query(groups).select(function(group){return group.firstDatum();}).first(def.notNully);}else{first instanceof cdo.Datum||def.assert("not a datum");datum=first;datums=dataSource;}
atoms=first.atoms;firstAtoms=datum&&datum.atoms||atoms;}else atoms=firstAtoms=parent?Object.create(parent.atoms):{};this.atoms=atoms;this.firstAtoms=firstAtoms;groups&&(this.groups=groups);group&&(this.group=group);datums&&(this._datums=datums);datum&&(this.datum=datum);first&&!first.isNull||(this.isNull=!0);this.vars=parent?Object.create(parent.vars):{};},methods:[pv.Dom.Node,pvc.visual.Interactive,{source:null,groups:null,group:null,_datums:null,datum:null,isNull:!1,get:function(name,prop){var avar=this.vars[name];return avar&&avar[prop||"value"];},getSeries:function(){return this.get("series");},getCategory:function(){return this.get("category");},getValue:function(){return this.get("value");},getTick:function(){return this.get("tick");},getX:function(){return this.get("x");},getY:function(){return this.get("y");},getColor:function(){return this.get("color");},getSize:function(){return this.get("size");},getSeriesLabel:function(){return this.get("series","label");},getCategoryLabel:function(){return this.get("category","label");},getValueLabel:function(){return this.get("value","label");},getTickLabel:function(){return this.get("tick","label");},getXLabel:function(){return this.get("x","label");},getYLabel:function(){return this.get("y","label");},getColorLabel:function(){return this.get("color","label");},getSizeLabel:function(){return this.get("size","label");},data:function(){var data=this.group;if(!data){for(var scene=this;!data&&(scene=scene.parent);)data=scene.group;data||(data=this.panel.data);}
return data;},allGroup:function(){return 1===this.groups.length?this.group:this._allGroup||(this._allGroup=this._calcAllGroup());},_calcAllGroup:function(){var groups=this.groups;return groups&&groups.length?new cdo.Data({linkParent:cdo.Data.lca(groups),datums:this.datums(),where:function(d){return!!groups&&groups.some(function(g){return g.contains(d);});}}):new cdo.Data({linkParent:this.data(),datums:this.datums()});},datums:function(){return this.groups?def.query(this.groups).selectMany(function(g){return g.datums();}):this._datums?def.query(this._datums):def.query();},format:function(mask){return def.format(mask,this._formatScope,this);},_formatScope:function(prop){if("#"===prop.charAt(0)){prop=prop.substr(1).split(".");if(prop.length>2)throw def.error.operationInvalid("Scene format mask is invalid.");var atom=this.firstAtoms[prop[0]];if(atom){if(prop.length>1)switch(prop[1]){case"value":return atom.value;case"label":break;default:throw def.error.operationInvalid("Scene format mask is invalid.");}
return atom;}
return null;}
return def.getPath(this.vars,prop);},isRoot:function(){return this.root===this;},panel:function(){return this.root._panel;},chart:function(){return this.root._panel.chart;},compatVersion:function(){return this.root._panel.compatVersion();},children:function(){var cs=this.childNodes;return cs.length?def.query(cs):def.query();},leafs:function(){function getFirstLeafFrom(leaf){for(;leaf.childNodes.length;)leaf=leaf.childNodes[0];return leaf;}
var root=this;return def.query(function(nextIndex){if(!nextIndex){var item=getFirstLeafFrom(root);return item===root?0:(this.item=item,1);}
var next=this.item.nextSibling;if(next)return this.item=next,1;for(var current=this.item;current!==root&&(current=current.parentNode);)if(next=current.nextSibling)return this.item=getFirstLeafFrom(next),1;return 0;});},anyInteraction:function(){return!!this.root._active||this.anySelected();},isActive:!1,getIsActive:function(){return(this.ownerScene||this).isActive;},setActive:function(isActive){isActive=!!isActive;this.getIsActive()===isActive||!isActive&&scene_isPointSwitchingToHoverableSign(pv.event)||this.chart()._setActiveScene(isActive?this:null);},clearActive:function(){return!!this.active()&&this.chart()._setActiveScene(null);},_setActive:function(isActive){this.isActive!==isActive&&rootScene_setActive.call(this.root,this.isActive?null:this);},_clearActive:function(){return rootScene_setActive.call(this.root,null);},anyActive:function(){return!!this.root._active;},active:function(){return this.root._active;},activeSeries:function(){var seriesVar,active=this.active();if(active&&(seriesVar=active.vars.series))return seriesVar.value;},isActiveSeries:function(){if(this.isActive)return!0;var isActiveSeries=this.renderState.isActiveSeries;if(null==isActiveSeries){var activeSeries;isActiveSeries=void 0!==(activeSeries=this.activeSeries())&&activeSeries===this.vars.series.value;this.renderState.isActiveSeries=isActiveSeries;}
return isActiveSeries;},isActiveDatum:function(){return!!this.isActive;},isActiveDescendantOrSelf:function(){return this.isActive||def.lazy(this.renderState,"isActiveDescOrSelf",this._calcIsActiveDescOrSelf,this);},_calcIsActiveDescOrSelf:function(){var scene=this.active();if(scene)for(;scene=scene.parent;)if(scene===this)return!0;return!1;},isVisible:function(){return this._visibleInfo().is;},anyVisible:function(){return this._visibleInfo().any;},_visibleInfo:function(){return def.lazy(this.renderState,"visibleInfo",this._createVisibleInfo,this);},_createVisibleInfo:function(){var any=this.chart().data.owner.visibleCount()>0;return{any:any,is:any&&this.datums().any(def.propGet("isVisible"))};},isSelected:function(){return this._selectedInfo().is;},anySelected:function(){return this._selectedInfo().any;},_selectedInfo:function(){return def.lazy(this.renderState,"selectedInfo",this._createSelectedInfo,this);},_createSelectedInfo:function(){var any=this.chart().data.owner.selectedCount()>0;return{any:any,is:any&&this.datums().any(cdo.Datum.isSelected)};},select:function(ka){var me=this,datums=me.datums().array();if(datums.length){var chart=me.chart();chart._updatingSelections(function(){datums=chart._onUserSelection(datums,me.group||me.datum);datums&&datums.length&&(chart.options.ctrlSelectMode&&def.get(ka,"replace",!0)?chart.data.replaceSelected(datums):cdo.Data.toggleSelected(datums));});}},isSelectedDescendantOrSelf:function(){return this.isSelected()||def.lazy(this.renderState,"isSelectedDescOrSelf",this._calcIsSelectedDescOrSelf,this);},_calcIsSelectedDescOrSelf:function(){var child=this.firstChild;if(child)do{if(child.isSelectedDescendantOrSelf())return!0;}while(child=child.nextSibling);return!1;},toggleVisible:function(){cdo.Data.toggleVisible(this.datums())&&this.chart().render(!0,!0,!1);},asView:function(viewSpec){this.chart()._processViewSpec(viewSpec);return this._asView(viewSpec.dimsKey,viewSpec.dimNames);},_asView:function(dimsKey,dimNames){if(this.ownerScene)return this.ownerScene._asView(dimsKey,dimNames);var views=def.lazy(this,"_viewCache"),view=def.getOwn(views,dimsKey);void 0===view&&(views[dimsKey]=view=this._calcView(dimNames));return view;},_calcView:function(normDimNames){for(var atom,dimName,atoms=null,i=0,L=normDimNames.length;i<L;i++){dimName=normDimNames[i];atom=this.atoms[dimName];if(!atom||null==atom.value)return null;(atoms||(atoms={}))[dimName]=atom;}
return new cdo.Complex(this.data().owner,atoms,normDimNames,null,!0,!1);}}]}));var pvc_ValueLabelVar=pvc.visual.ValueLabelVar=function(value,label,rawValue,absLabel){this.value=value;this.label=label;void 0!==rawValue&&(this.rawValue=rawValue);void 0!==absLabel&&(this.absLabel=absLabel);};def.set(pvc_ValueLabelVar.prototype,"rawValue",void 0,"absLabel",void 0,"setValue",function(v){return this.value=v,this;},"setLabel",function(v){return this.label=v,this;},"clone",function(){return new pvc_ValueLabelVar(this.value,this.label,this.rawValue);},"toString",function(){var label=this.label||this.value;return null==label?"":"string"!=typeof label?""+label:label;});pvc_ValueLabelVar.fromComplex=function(complex){return complex?new pvc_ValueLabelVar(complex.value,complex.label,complex.rawValue,complex.absLabel):new pvc_ValueLabelVar(null,"",null);};pvc_ValueLabelVar.fromAtom=pvc_ValueLabelVar.fromComplex;var visualRole_flatten_select_keyArgs=["extensionDataSetsMap","reverse","visible","selected","isNull","where","whereKey"];def.type("pvc.visual.Role").init(function(chart,name,keyArgs){this.uid="r"+def.nextId("visual-role");this.chart=chart;this.name=name;this.label=def.get(keyArgs,"label")||def.titleFromName(name);this.index=def.get(keyArgs,"index")||0;this.plot=def.get(keyArgs,"plot")||null;this._legend={visible:!0};this.dimensionDefaults=def.get(keyArgs,"dimensionDefaults")||{};this._isReversed=!1;this.isRequired=!!def.get(keyArgs,"isRequired",!1);this.autoCreateDimension=!!def.get(keyArgs,"autoCreateDimension",!1);var defaultSourceRoleName=def.get(keyArgs,"defaultSourceRole");defaultSourceRoleName&&(this.defaultSourceRoleName=this.plot?this.plot.ensureAbsRoleRef(defaultSourceRoleName):defaultSourceRoleName);var defaultDimensionName=def.get(keyArgs,"defaultDimension");if(defaultDimensionName){this.defaultDimensionName=defaultDimensionName;var match=defaultDimensionName.match(/^(.*?)(\*)?$/);this.defaultDimensionGroup=match[1];this.defaultDimensionGreedy=!!match[2];}
this.rootLabel=def.get(keyArgs,"rootLabel");this.flatteningModes=def.get(keyArgs,"flatteningModes");this.flatteningMode=def.get(keyArgs,"flatteningMode");if(!defaultDimensionName&&this.autoCreateDimension)throw def.error.argumentRequired("defaultDimension");var requireSingleDimension=def.get(keyArgs,"requireSingleDimension"),requireIsDiscrete=def.get(keyArgs,"requireIsDiscrete"),requireContinuous=null!=requireIsDiscrete&&!requireIsDiscrete;null==requireSingleDimension&&(requireSingleDimension=requireContinuous);if(!requireIsDiscrete&&def.get(keyArgs,"isMeasure")){this.isMeasure=!0;var isNormalized=def.get(keyArgs,"isNormalized");(isNormalized||def.get(keyArgs,"isPercent"))&&(this.isPercent=!0);isNormalized&&(this.isNormalized=!0);}
this.boundDimensionsDataSetName=this.isMeasure?name+"Role":null;this.discriminatorDimensionFullName=this.isMeasure?this.boundDimensionsDataSetName+".dim":null;var valueType=def.get(keyArgs,"valueType",null);valueType!==this.valueType&&(this.valueType=this.dimensionDefaults.valueType=valueType);requireSingleDimension!==this.requireSingleDimension&&(this.requireSingleDimension=requireSingleDimension);null!=requireIsDiscrete&&(this.requireIsDiscrete=this.dimensionDefaults.isDiscrete=!!requireIsDiscrete);this._sourceRole=null;this.grouping=null;}).add({requireSingleDimension:!1,valueType:null,requireIsDiscrete:null,isMeasure:!1,isNormalized:!1,isPercent:!1,defaultSourceRoleName:null,defaultDimensionName:null,defaultDimensionGroup:null,defaultDimensionGreedy:null,label:null,_rootSourceRole:void 0,_legend:null,prettyId:function(){return(this.plot?this.plot.prettyId+".":"")+this.name;},legend:function(_){if(arguments.length){if(null!=_)switch(typeof _){case"boolean":this._legend.visible=!!_;break;case"object":def.each(_,function(v,p){if(void 0!==v){"visible"===p&&(v=!!v);this[p]=v;}},this._legend);}
return this;}
return this._legend;},firstDimensionType:function(){var g=this.grouping;return g&&g.firstDimensionType();},firstDimensionName:function(){var g=this.grouping;return g&&g.firstDimensionName();},firstDimensionValueType:function(){var g=this.grouping;return g&&g.firstDimensionValueType();},lastDimensionType:function(){var g=this.grouping;return g&&g.lastDimensionType();},lastDimensionName:function(){var g=this.grouping;return g&&g.lastDimensionName();},lastDimensionValueType:function(){var g=this.grouping;return g&&g.lastDimensionValueType();},get isMeasureEffective(){return!!this.isMeasure&&(this.isBound()?!this.isDiscrete():null);},isDiscrete:function(){var g=this.grouping;return g&&g.isDiscrete();},get sourceRole(){return this._sourceRole;},set sourceRole(value){this._sourceRole=value||null;this._rootSourceRole=void 0;},get rootSourceRole(){var r2,r=this._rootSourceRole;if(void 0===r){r=this.sourceRole;if(null!==r)for(;null!==(r2=r.sourceRole);)r=r2;this._rootSourceRole=r;}
return r;},get isReversed(){return this._isReversed;},set isReserved(value){this._isReversed=!!value;},_flatteningModes:cdo.FlatteningMode.AllMask,get flatteningModes(){return this._flatteningModes;},set flatteningModes(value){value=def.nullyTo(value,cdo.FlatteningMode.AllMask);if(this._flatteningModes!==value){value=this._flatteningModes&value;if(!value)throw def.error.argumentInvalid("flatteningModes","Cannot become empty.");this._flatteningModes=value;var flatMode=this.flatteningMode&value;if(!flatMode){flatMode=value&-value;this.flatteningMode=flatMode;}}},_flatteningMode:cdo.FlatteningMode.SingleLevel,get flatteningMode(){return this._flatteningMode;},set flatteningMode(value){if(null!=value&&value!==this._flatteningMode){if(!(value&this.flatteningModes))throw def.error.argumentInvalid("flatteningMode","Value is not currently valid.");this._flatteningMode=value;}},get rootLabel(){return this._rootLabel;},set rootLabel(value){value||(value="");if(value!==this._rootLabel){this._rootLabel=value;this.grouping&&this._setGrouping(this.grouping);}},flatten:function(data,keyArgs){keyArgs=def.whiteList(keyArgs,visualRole_flatten_select_keyArgs)||{};keyArgs.extensionDataSetsMap||(keyArgs.extensionDataSetsMap=(this.plot||this.chart).boundDimensionsDataSetsMap);return data.groupBy(this.flattenedGrouping(keyArgs),keyArgs);},flattenedGrouping:function(){var grouping=this.grouping||def.fail.operationInvalid("Role is unbound.");grouping=grouping.ensure({flatteningMode:this.flatteningMode});return grouping;},select:function(data,keyArgs){var grouping=this.grouping||def.fail.operationInvalid("Role is unbound.");keyArgs=def.whiteList(keyArgs,visualRole_flatten_select_keyArgs);keyArgs.extensionDataSetsMap||(keyArgs.extensionDataSetsMap=(this.plot||this.chart).boundDimensionsDataSetsMap);return data.groupBy(grouping,keyArgs);},view:function(complex){var grouping=this.grouping;if(grouping)return grouping.view(complex);},preBind:function(groupingSpec){this.__grouping=groupingSpec;return this;},isPreBound:function(){return!!this.__grouping;},preBoundGrouping:function(){return this.__grouping;},isBound:function(){return!!this.grouping;},get boundDimensionsDataSet(){var data=this._boundDimsData;if(!data){var baseData=this.chart.getBoundDimensionsDataSetOf(this);this._boundDimsData=data=baseData.where(null,{where:this._isBoundDimensionDatum.bind(this)});}
return data;},_isBoundDimensionDatum:function(datum){var grouping=this.grouping;if(grouping){var boundDimName=datum.atoms.dim.value;return grouping.dimensionNames().indexOf(boundDimName)>=0;}
return!1;},_loadDimensionsDataSet:function(){var data=this.boundDimensionsDataSet,owner=data.owner,mainComplexType=this.grouping.complexType,datums=this.grouping.dimensionNames().map(function(mainDimName){var mainDimType=mainComplexType.dimensions(mainDimName);return new cdo.Datum(owner,{dim:{v:mainDimName,f:mainDimType.label}});});owner.add(datums);},postBind:function(complexType,extensionComplexTypesMap){var grouping=this.__grouping;if(grouping){if(!grouping.isNull){grouping.bind(complexType,extensionComplexTypesMap);this.bind(grouping);}
delete this.__grouping;}
return this;},bind:function(groupingSpec){if(!groupingSpec)throw def.error.argumentRequired("groupingSpec");if(this.grouping)throw def.error.operationInvalid("Visual role is already bound");this._coerceGrouping(groupingSpec);this._setGrouping(groupingSpec);if(this.isMeasureEffective){this._loadDimensionsDataSet();this._setupGetBoundDimensionName();}
return this;},_coerceGrouping:function(groupingSpec){if(!groupingSpec.isBound)throw def.error.operationInvalid("Cannot bind to an unbound grouping.");if(groupingSpec.isNull)throw def.error.operationInvalid("Cannot bind to a null grouping.");if(this.requireSingleDimension&&!groupingSpec.isSingleDimension)throw def.error.operationInvalid("Role '{0}' only accepts a single dimension.",[this.name]);var valueType=this.valueType,requireIsDiscrete=this.requireIsDiscrete;groupingSpec.dimensions().each(function(dimSpec){var dimType=dimSpec.dimensionType;if(valueType&&dimType.valueType!==valueType)throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts dimensions of type '{2}' and not of type '{3}'.",[this.name,dimType.name,cdo.DimensionType.valueTypeName(valueType),dimType.valueTypeName]);if(null!=requireIsDiscrete&&dimType.isDiscrete!==requireIsDiscrete){if(!requireIsDiscrete)throw def.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'.\nIt only accepts continuous dimensions.",[this.name,dimType.name]);dimType._toDiscrete();}},this);},canHaveSource:function(source){var valueType=this.valueType;return null==valueType||valueType===source.valueType;},_setGrouping:function(groupingSpec){groupingSpec=groupingSpec.ensure({rootLabel:this.rootLabel});this.isReversed&&(groupingSpec=groupingSpec.reverse());this.grouping=groupingSpec;},_setupGetBoundDimensionName:function(){var roleDiscrimDimName=this.discriminatorDimensionFullName,roleBoundDimsDataSet=this.boundDimensionsDataSet,singleDimensionName=this.grouping.isSingleDimension?this.grouping.singleDimensionName:null;this.getBoundDimensionName=function(groupData,isOptional){var dimName,discrimAtom=groupData.atoms[roleDiscrimDimName];if(void 0===discrimAtom||null===(dimName=discrimAtom.value)){if(null!==singleDimensionName)return singleDimensionName;if(isOptional)return null;throw this._errorMustBindDiscrimDimension();}
if(!roleBoundDimsDataSet.datumByKey(dimName)){if(isOptional)return null;throw this._errorMustBindDiscrimDimension();}
return dimName;};},_errorMustBindDiscrimDimension:function(){return new def.error.operationInvalid("Must bind the measure discriminator dimension '"+this.discriminatorDimensionFullName+"'.");},getBoundDimensionName:function(groupData,isOptional){throw def.error.operationInvalid("Not a bound measure visual role.");},isBoundDimensionName:function(childData,dimName){return this.getBoundDimensionName(childData,!0)===dimName;},isBoundDimensionCompatible:function(groupData){var roleDiscrimDimName=this.discriminatorDimensionFullName,roleBoundDimsDataSet=this.boundDimensionsDataSet,discrimAtom=groupData.atoms[roleDiscrimDimName];if(void 0===discrimAtom||null===discrimAtom.value)return!0;var dimName=discrimAtom.value;return!!roleBoundDimsDataSet.datumByKey(dimName);},getCompatibleBoundDimensionNames:function(groupData){var roleDiscrimDimName=this.discriminatorDimensionFullName,roleBoundDimsDataSet=this.boundDimensionsDataSet,discrimAtom=groupData.atoms[roleDiscrimDimName];if(void 0===discrimAtom||null===discrimAtom.value)return this.grouping.dimensionNames();var dimName=discrimAtom.value;return null!==roleBoundDimsDataSet.datumByKey(dimName)?[dimName]:[];},numberValueOf:function(data,keyArgs){if(this.grouping.isSingleDimension)return data.dimensionNumberValue(this.grouping.singleDimensionName,keyArgs);keyArgs=this._getDimensionOperKeyArgs(keyArgs);return data.dimensionNumberValue(this.getBoundDimensionName.bind(this),keyArgs);},percentOf:function(childData,keyArgs){if(this.grouping.isSingleDimension)return childData.dimensionPercentValue(this.grouping.singleDimensionName,keyArgs);keyArgs=this._getDimensionOperKeyArgs(keyArgs);return childData.dimensionPercentValue(this.getBoundDimensionName.bind(this),keyArgs);},_getDimensionOperKeyArgs:function(keyArgs){keyArgs=keyArgs?Object.create(keyArgs):{};keyArgs.discrimKey=this.uid;keyArgs.discrimPossibleDims=this.grouping.allDimensionNames;return keyArgs;}}).type().add({readConfig:function(config,name,lookup){var groupSpec,parsed={isReversed:!1,source:null,grouping:null,legend:null};if(def.object.is(config)){config.isReversed&&(parsed.isReversed=!0);parsed.legend=config.legend;var sourceName=config.from;if(sourceName){if(sourceName===name)throw def.error.operationInvalid("Invalid source role.");parsed.source=lookup(sourceName)||def.fail.operationInvalid("Source visual role '{0}' is not defined.",[sourceName]);}else groupSpec=config.dimensions;}else(null===config||def.string.is(config))&&(groupSpec=config);void 0!==groupSpec&&(parsed.grouping=cdo.GroupingSpec.parse(groupSpec));return parsed;},parseDataSetName:function(dataSetName){var m=/^(.+?)Role$/.exec(dataSetName);return m&&m[1];}});pvc.visual.rolesBinder=function(){function phase_init(){visualRolesBinder_assertState(state,NOT_STARTED);if(!context)throw def.error.argumentRequired("context");if(!mainComplexTypeProj)throw def.error.argumentRequired("complexTypeProject");state=INIT_DURING;doLog=!!logger&&logger.level()>=3;context.query().each(function(role){var opts=context.getOptions(role);(void 0===opts||!configureRole(role,opts))&&tryToSourceRoleFromMainRole(role);});unboundSourcedRolesList.forEach(tryPreBindSourcedRole,this);unboundSourcedRolesList=[];applySingleRoleDefaultsToDimensions();state=INIT_AFTER;return this;}
function configureRole(role,opts){var parsed=pvc.visual.Role.readConfig(opts,role.name,context);parsed.isReversed&&(role.isReserved=!0);null!=parsed.legend&&role.legend(parsed.legend);if(parsed.source){role.sourceRole=parsed.source;addUnboundSourcedRole(role);return!0;}
var grouping=parsed.grouping;if(grouping){preBindRoleToGrouping(role,grouping);return!0;}
return!1;}
function tryToSourceRoleFromMainRole(role){var mainRole=context(role.name);if(mainRole!==role&&role.canHaveSource(mainRole)){role.sourceRole=mainRole;addUnboundSourcedRole(role);}}
function addUnboundSourcedRole(role){unboundSourcedRolesList.push(role);}
function preBindRoleToGrouping(role,grouping){role.preBind(grouping);grouping.isNull?visRoleBinder_assertUnboundChartRoleIsOptional(role):grouping.dimensionNames().forEach(function(mainDimName){registerRoleAndMainDimensionBinding(role,mainDimName);});}
function registerRoleAndMainDimensionBinding(role,mainDimName){if(mainDimHasRoleBoundToSet[mainDimName])delete mainDimToSingleRoleMap[mainDimName];else{mainDimHasRoleBoundToSet[mainDimName]=!0;mainDimToSingleRoleMap[mainDimName]=role;mainComplexTypeProj.setDim(mainDimName);}}
function tryPreBindSourcedRole(role){return tryPreBindSourcedRoleRecursive(role,Object.create(null));}
function tryPreBindSourcedRoleRecursive(role,visited){var id=role.uid;if(def.hasOwn(visited,id))throw def.error.argumentInvalid("visualRoles","Cyclic source role definition.");visited[id]=!0;if(role.isPreBound())return role.preBoundGrouping();var source=role.sourceRole;if(source){var sourcePreGrouping=tryPreBindSourcedRoleRecursive(source,visited);if(sourcePreGrouping){source.isReversed&&(role.isReserved=!role.isReversed);role.preBind(sourcePreGrouping);}
return sourcePreGrouping;}
return null;}
function applySingleRoleDefaultsToDimensions(){def.eachOwn(mainDimToSingleRoleMap,function(role,dimName){mainComplexTypeProj.setDimDefaults(dimName,role.dimensionDefaults);});mainDimToSingleRoleMap=Object.create(null);}
function phase_dimensionsFinished(){visualRolesBinder_assertState(state,INIT_AFTER);state=DIMS_FINISHED_DURING;context.query().where(function(role){return!role.isPreBound();}).each(autoPrebindUnboundRole);unboundSourcedRolesList.forEach(function(role){tryPreBindSourcedRole(role)||roleIsUnbound(role);});applySingleRoleDefaultsToDimensions();state=DIMS_FINISHED_AFTER;}
function autoPrebindUnboundRole(role){if(role.sourceRole)return addUnboundSourcedRole(role);var defaultMainDimName=role.defaultDimensionGroup;if(defaultMainDimName){if(role.defaultDimensionGreedy){var groupMainDimNames=mainComplexTypeProj.groupDimensionsNames(defaultMainDimName);if(groupMainDimNames)return preBindRoleToMainDimensions(role,groupMainDimNames);}else if(mainComplexTypeProj.hasDim(defaultMainDimName))return preBindRoleToMainDimensions(role,defaultMainDimName);if(role.autoCreateDimension){mainComplexTypeProj.setDim(defaultMainDimName,{isHidden:!0});return preBindRoleToMainDimensions(role,defaultMainDimName);}}
if(role.defaultSourceRoleName){var source=context(role.defaultSourceRoleName);if(source){role.sourceRole=source;return addUnboundSourcedRole(role);}}
roleIsUnbound(role);}
function preBindRoleToMainDimensions(role,mainDimNames){preBindRoleToGrouping(role,cdo.GroupingSpec.parse(mainDimNames));}
function roleIsUnbound(role){visRoleBinder_assertUnboundChartRoleIsOptional(role);role.sourceRole=null;}
function phase_bindRoles(complexType){visualRolesBinder_assertState(state,DIMS_FINISHED_AFTER);state=BIND_ROLES_DURING;context.query().where(function(role){return role.isMeasure&&role.isPreBound();}).each(function(role){try{role.postBind(complexType);}catch(ex){if("need-extension-map"!==ex.code)throw ex;}});var chartLevelExtensionComplexTypesMap=null;context.query().where(function(role){return role.isPreBound();}).each(function(role){var extensionComplexTypesMap;if("dataPart"===role.name)extensionComplexTypesMap=null;else if(role.plot)extensionComplexTypesMap=role.plot.boundDimensionsComplexTypesMap;else{null===chartLevelExtensionComplexTypesMap&&(chartLevelExtensionComplexTypesMap=context.getExtensionComplexTypesMap());extensionComplexTypesMap=chartLevelExtensionComplexTypesMap;}
try{role.postBind(complexType,extensionComplexTypesMap);}catch(ex){if("need-extension-map"===ex.code&&"dataPart"===role.name)throw def.error.operationInvalid("The data part visual role cannot be bound to measure role discriminator dimensions.");throw ex;}});doLog&&logVisualRoles();state=BIND_ROLES_AFTER;}
function logVisualRoles(){var table=def.textTable(3).rowSep().row("Visual Role","Source Role","Bound to Dimension(s)").rowSep();context.query().each(function(role){table.row(role.prettyId(),role.sourceRole?role.sourceRole.prettyId():"-",String(role.grouping||"-"));});table.rowSep(!0);logger("VISUAL ROLES MAP SUMMARY\n"+table()+"\n");}
var context,mainComplexTypeProj,logger,doLog,NOT_STARTED=0,INIT_DURING=1,INIT_AFTER=2,DIMS_FINISHED_DURING=3,DIMS_FINISHED_AFTER=4,BIND_ROLES_DURING=5,BIND_ROLES_AFTER=6,state=NOT_STARTED,unboundSourcedRolesList=[],mainDimToSingleRoleMap=Object.create(null),mainDimHasRoleBoundToSet=Object.create(null);return{logger:function(_){if(arguments.length){visualRolesBinder_assertState(state,NOT_STARTED);logger=_;return this;}
return logger;},context:function(_){if(arguments.length){visualRolesBinder_assertState(state,NOT_STARTED);context=_;return this;}
return context;},complexTypeProject:function(_){if(arguments.length){visualRolesBinder_assertState(state,NOT_STARTED);mainComplexTypeProj=_;return this;}
return mainComplexTypeProj;},init:phase_init,dimensionsFinished:phase_dimensionsFinished,bind:phase_bindRoles};};def.type("pvc.visual.RoleVarHelper").init(function(rootScene,roleName,role,keyArgs){this.role=role||null;var grouping=role&&role.grouping;this.grouping=grouping;if(!roleName){if(!role)throw def.error.operationInvalid("Role is not defined, so the roleName argument is required.");roleName=role.name;}
this.roleName=roleName;this.sourceRoleName=null;this.hasPercentSubVar=def.get(keyArgs,"hasPercentSubVar",!1);this.allowNestedVars=!!def.get(keyArgs,"allowNestedVars");this.isNumericMode=!1;if(null!==grouping){var rootSourceRole=role.rootSourceRole,sourceRoleName=rootSourceRole&&rootSourceRole.name;sourceRoleName!==role.name&&(this.sourceRoleName=sourceRoleName);grouping.isDiscrete()||grouping.singleContinuousValueType!==Number||(this.isNumericMode=!0);}else{var roleVar=rootScene.vars[roleName]=this._createNullVar();this.hasPercentSubVar&&(roleVar.percent=this._createNullVar());}
rootScene["is"+def.firstUpperCase(roleName)+"Bound"]=!!grouping;}).add({isBound:function(){return!!this.grouping;},onNewScene:function(scene,isLeaf){if(this.grouping){var roleName=this.roleName;if(!(this.allowNestedVars?def.hasOwnProp.call(scene.vars,roleName):roleName in scene.vars)){var sourceVar,sourceRoleName=this.sourceRoleName;null===sourceRoleName||null===(sourceVar=def.getOwn(scene.vars,sourceRoleName,null))?isLeaf&&(scene.vars[roleName]=this._createVar(scene)):scene.vars[roleName]=sourceVar.clone();}}},_createVar:function(scene){if(this.isNumericMode){var group=scene.group,singleDatum=null!==group?group.singleDatum():scene.datum;return null!==singleDatum?this._createVarFromDatumNumber(singleDatum,scene):null!==group?this._createVarFromGroupNumber(group):this._createVarFromDatumNumber(null,scene);}
var firstDatum=scene.datum;null!==firstDatum&&firstDatum.isNull&&(firstDatum=scene.datums().where(datum_notNull).first()||null);return this._createVarFromDatumDiscrete(firstDatum);},_createNullVar:function(){return new pvc_ValueLabelVar(null,"");},_createVarFromDatumDiscrete:function(datum){if(null===datum||datum.isNull)return this._createNullVar();if(this.grouping.isSingleDimension)return pvc_ValueLabelVar.fromAtom(datum.atoms[this.grouping.singleDimensionName]);var view=this.grouping.view(datum);return pvc_ValueLabelVar.fromComplex(view);},_createVarFromDatumNumber:function(datum,scene){var roleVar,valuePctAtom=null;if(null===datum||datum.isNull)roleVar=this._createNullVar();else{var valueAtom,groupData=scene.group,valueDimName=this.role.getBoundDimensionName(groupData||scene.data(),null!=groupData);valueAtom=null!==valueDimName?datum.atoms[valueDimName]:this.role.numberValueOf(groupData);roleVar=pvc_ValueLabelVar.fromAtom(valueAtom);roleVar.dimensionName=valueDimName;null!=roleVar.value&&this.hasPercentSubVar&&null!==scene.group&&(valuePctAtom=this.role.percentOf(scene.group));}
this.hasPercentSubVar&&(roleVar.percent=this._createPercentVar(valuePctAtom));return roleVar;},_createVarFromGroupNumber:function(groupData){var valueAtom=this.role.numberValueOf(groupData),roleVar=pvc_ValueLabelVar.fromAtom(valueAtom);roleVar.dimensionName=null!==valueAtom.dimension?valueAtom.dimension.name:null;if(this.hasPercentSubVar){var valuePctAtom=null!==valueAtom.value?this.role.percentOf(groupData):null;roleVar.percent=this._createPercentVar(valuePctAtom);}
return roleVar;},_createPercentVar:function(valuePctAtom){return null==valuePctAtom?this._createNullVar():new pvc_ValueLabelVar(valuePctAtom.value,valuePctAtom.labelPercent);}});def.type("pvc.visual.DataCell").init(function(plot,axisType,axisIndex,role){this.plot=plot;this.dataPartValue=plot.dataPartValue;this.axisType=axisType;this.axisIndex=axisIndex;this.role=role;this.key=[axisType,axisIndex,role.prettyId(),this.dataPartValue].join("~");}).add({legendVisible:function(){return this.role.legend().visible;},isDataBoundOn:function(baseData){var role=this.role;return!!role.isBound()&&(!role.isMeasureEffective||role.isBoundDimensionCompatible(baseData));}});def.type("pvc.visual.ColorDataCell",pvc.visual.DataCell).init(function(plot,axisType,axisIndex,role){this.base(plot,axisType,axisIndex,role);this._legendGroupScene=null;this._legendSymbolRenderer=null;}).add({legendSymbolRenderer:function(_){if(arguments.length){_&&"object"==typeof _&&(_=pvc.visual.legend.symbolRenderer(_));this._legendSymbolRenderer=_;return this;}
return this._legendSymbolRenderer;}});var pvc_Axis=def("pvc.visual.Axis",pvc.visual.OptionsBase.extend({init:function(chart,type,index,keyArgs){this.base(chart,type,index,keyArgs);this.dataCells=null;this.dataCell=null;this.role=null;this._dataCellsByKey=null;this._dataCellsScaleInfoByKey=null;this._domainData=null;this._domainItems=null;this._domainValues=null;this.scaleType=null;this._state={};keyArgs&&keyArgs.state&&def.copy(this._state,keyArgs.state);chart._addAxis(this);},methods:{_buildOptionId:function(){return this.id+"Axis";},bind:function(dataCells){dataCells||def.fail.argumentRequired("dataCells");!this.dataCells||def.fail.operationInvalid("Axis is already bound.");this.dataCells=def.array.to(dataCells);this._dataCellsByKey=def.query(this.dataCells).uniqueIndex(function(dc){return dc.key;});this.dataCell=this.dataCells[0];this.role=this.dataCell&&this.dataCell.role;this.scaleType=axis_groupingScaleType(this.role.grouping);this._conciliateVisualRoles();return this;},isBound:function(){return!!this.role;},__assertBound:function(){this.isBound()||def.fail.operationInvalid("Axis is not bound.");},isDiscrete:function(){return!!this.role&&this.role.isDiscrete();},_conciliateVisualRoles:function(){var L=this.dataCells.length;if(L>1){var otherRole,otherGrouping,possibleFlatteningModes,flatteningMode,otherFlatteningMode,rootLabel,dimNamesKey,i,grouping=this._getBoundRoleGrouping(this.role),createError=function(msg,args){return def.error.operationInvalid(def.format(msg,args));};if("discrete"===this.scaleType){possibleFlatteningModes=this.role.flatteningModes;rootLabel=this.role.rootLabel;dimNamesKey=String(this.role.grouping.dimensionNames());for(i=1;i<L&&possibleFlatteningModes;i++){otherRole=this.dataCells[i].role;possibleFlatteningModes&=otherRole.flatteningModes;rootLabel||(rootLabel=otherRole.rootLabel);otherGrouping=this._getBoundRoleGrouping(otherRole);if(dimNamesKey!==String(otherGrouping.dimensionNames()))throw createError("The visual roles '{0}', on axis '{1}', assumed discrete, should be bound to the same dimension list.",[[this.role.prettyId(),otherRole.prettyId()].join("', '"),this.id]);}
if(possibleFlatteningModes===cdo.FlatteningMode.None)throw createError("The visual roles on axis '{0}', assumed discrete, do not share a possible flattening mode.",[this.id]);flatteningMode=0;for(i=0;i<L;i++){otherRole=this.dataCells[i].role;otherFlatteningMode=otherRole.flatteningMode;otherFlatteningMode&possibleFlatteningModes&&otherFlatteningMode>flatteningMode&&(flatteningMode=otherFlatteningMode);}
flatteningMode||(flatteningMode=possibleFlatteningModes&-possibleFlatteningModes);for(i=0;i<L;i++){otherRole=this.dataCells[i].role;otherRole.rootLabel=rootLabel;otherRole.flatteningMode=flatteningMode;otherRole.flatteningModes=flatteningMode;}}else{if(!grouping.firstDimension.dimensionType.isComparable)throw createError("The visual roles on axis '{0}', assumed continuous, should have 'comparable' groupings.",[this.id]);for(i=1;i<L;i++){otherRole=this.dataCells[i].role;otherGrouping=this._getBoundRoleGrouping(otherRole);if(this.scaleType!==axis_groupingScaleType(otherGrouping))throw createError("The visual roles on axis '{0}', assumed continuous, should have scales of the same type.",[this.id]);if(this.role.isNormalized!==otherRole.isNormalized)throw createError("The visual roles on axis '{0}', assumed normalized, should be of the same type.",[this.id]);}}}},_getBoundRoleGrouping:function(role){var grouping=role.grouping;if(!grouping||!grouping.isBound)throw def.error.operationInvalid("Axis' role '{0}' is unbound.",[role.name]);return grouping;},getState:function(){return this._buildState();},_buildState:function(){return{};},setDataCellScaleInfo:function(dataCell,scaleInfo){if(this._dataCellsByKey[dataCell.key]!==dataCell)throw def.error.argumentInvalid("dataCell","Not present in this axis.");def.lazy(this,"_dataCellsScaleInfoByKey")[dataCell.key]=scaleInfo;},getDataCellScaleInfo:function(dataCell){return def.getOwn(this._dataCellsScaleInfoByKey,dataCell.key);},domainVisibleOnly:def.retTrue,domainIgnoreNulls:def.retFalse,domainReverse:def.retFalse,domainGroupOperator:def.fun.constant("flatten"),domainItemValueProp:def.fun.constant("value"),domainItemKeyProp:def.fun.constant("key"),_selectDomainItems:function(domainData){return domainData.children();},domainData:function(){this.__assertBound();var domainData=this._domainData;if(!domainData){var dataPartValues=def.query(this.dataCells).select(def.propGet("dataPartValue")).distinct().array(),partsData=this.chart.partData(dataPartValues);this._domainData=domainData=this._createDomainData(partsData);}
return domainData;},domainCellData:function(cellIndex){this.__assertBound();var dataCells=this.dataCells;if(1===dataCells.length)return this.domainData();var dataCell=dataCells[cellIndex],partData=this.chart.partData(dataCell.dataPartValue);return this._createDomainData(partData);},domainCellItems:function(cellDataOrIndex){this.__assertBound();if(1===this.dataCells.length)return this.domainItems();var cellData=def.number.is(cellDataOrIndex)?this.domainCellData(cellDataOrIndex):cellDataOrIndex;return this._selectDomainItems(cellData).array();},domainValues:function(){var domainValues=this._domainValues;domainValues||(domainValues=(this._calcDomainItems(),this._domainValues));return domainValues;},domainItems:function(){var domainItems=this._domainItems;domainItems||(domainItems=(this._calcDomainItems(),this._domainItems));return domainItems;},domainItemCount:function(){return this.domainItems().length;},domainItemValue:function(itemData){return def.nullyTo(itemData[this.domainItemValueProp()],"");},domainItemKey:function(itemData){return def.nullyTo(itemData[this.domainItemKeyProp()],"");},get boundDimensionsDataSetsMap(){var dataSetsMap=null;if(this.isBound()&&this.isDiscrete()){var dataSetNames=this.role.grouping.extensionComplexTypeNames;if(dataSetNames){var chartLevelBoundDimensionsDataSetsMap=this.chart.boundDimensionsDataSetsMap;dataSetsMap=Object.create(null);dataSetNames.forEach(function(dataSetName){dataSetsMap[dataSetName]=chartLevelBoundDimensionsDataSetsMap[dataSetName];});}}
return dataSetsMap;},_createDomainData:function(baseData){this.__assertBound();var keyArgs={visible:!!this.domainVisibleOnly()||null,isNull:!this.chart.options.ignoreNulls&&!this.domainIgnoreNulls()&&null,reverse:this.domainReverse(),extensionDataSetsMap:this.boundDimensionsDataSetsMap};return this.role[this.domainGroupOperator()](baseData,keyArgs);},_calcDomainItems:function(){var domainData=this.domainData(),domainItems=[],domainValues=[],domainKeysSet=Object.create(null),hasOwn=def.hasOwnProp;this._selectDomainItems(domainData).each(function(itemData){var itemKey=this.domainItemKey(itemData);if(!hasOwn.call(domainKeysSet,itemKey)){domainKeysSet[itemKey]=1;domainValues.push(this.domainItemValue(itemData));domainItems.push(itemData);}},this);this._domainItems=domainItems;this._domainValues=domainValues;},scaleTreatsNullAs:def.fun.constant("null"),scaleNullRangeValue:def.fun.constant(null),scaleUsesAbs:def.retFalse,scaleSumNormalized:def.retFalse,setScale:function(scale,noWrap){this.isBound()||def.fail.operationInvalid("Axis is not bound.");this.scale=scale?noWrap?scale:this._wrapScale(scale):null;return this;},_wrapScale:function(scale){scale.type=this.scaleType;var by;if("discrete"!==scale.type){var useAbs=this.scaleUsesAbs(),nullAs=this.scaleTreatsNullAs();if(nullAs&&"null"!==nullAs){var nullIsMin="min"===nullAs;by=useAbs?function(v){return scale(null==v?nullIsMin?scale.domain()[0]:0:v<0?-v:v);}:function(v){return scale(null==v?nullIsMin?scale.domain()[0]:0:v);};}else{var nullRangeValue=this.scaleNullRangeValue();by=useAbs?function(v){return null==v?nullRangeValue:scale(v<0?-v:v);}:function(v){return null==v?nullRangeValue:scale(v);};}}else by=function(v){return scale(null==v?"":v);};return def.copy(by,scale);},sceneScale:function(keyArgs){var varName=def.get(keyArgs,"sceneVarName")||this.role.name,grouping=this.role.grouping,scale=this.scale;if(grouping.singleContinuousValueType===Number){var nullToZero=def.get(keyArgs,"nullToZero",!0),by=function(scene){var value=scene.vars[varName].value;if(null==value){if(!nullToZero)return value;value=0;}
return scale(value);};def.copy(by,scale);return by;}
return scale.by1(function(scene){return scene.vars[varName].value;});}}}));def("pvc.visual.ColorAxis",pvc_Axis.extend({methods:{scaleNullRangeValue:function(){return this.option("Missing")||null;},scaleUsesAbs:function(){return this.option("UseAbs");},domainVisibleOnly:function(){return"discrete"!==this.scaleType;},bind:function(dataCells){this.base(dataCells);this._legendGroupScene=null;this._plotList=def.query(dataCells).select(function(dataCell){return dataCell.plot;}).distinct(function(plot){return plot&&plot.id;}).array();return this;},_buildState:function(){return{preservedMap:this._calcPreservedMap()};},_calcPreservedMap:function(){var scale=this.scale;if(scale&&"discrete"===this.scaleType){var map=this._state.preservedMap||{};scale.domain().forEach(function(key){def.hasOwn(map,key)||(map[key]=scale(key));});return map;}},_wrapScale:function(scale){var optSpecified=this.option.isSpecified;if("discrete"!==this.scaleType||optSpecified("Transform")||!optSpecified("Colors")){var colorTransf=this.option("Transform");colorTransf&&(scale=scale.transform(colorTransf));}
return this.base(scale);},scheme:function(){return def.lazy(this,"_scheme",this._createScheme,this);},_createColorMapFilter:function(colorMap,baseScheme){var fixedColors=def.uniqueIndex(colorMap,function(c){return c.key;});return{domain:function(k){return!def.hasOwn(colorMap,k);},color:function(c){return!def.hasOwn(fixedColors,c.key);}};},_getBaseScheme:function(){return this.option("Colors");},_createScheme:function(){var me=this,baseScheme=me._getBaseScheme();if("discrete"!==me.scaleType)return function(){var scale=baseScheme.apply(null,arguments);return me._wrapScale(scale);};var colorMap=this._getPreservedMap()||me.option("Map");if(!colorMap)return function(){var scale=baseScheme.apply(null,arguments);return me._wrapScale(scale);};var filter=this._createColorMapFilter(colorMap,baseScheme);return function(d){var scale;d instanceof Array||(d=def.array.copy(arguments));d=d.filter(filter.domain);var baseScale=baseScheme(d),r=baseScale.range().filter(filter.color);baseScale.range(r);scale=function(k){return def.getOwn(colorMap,k)||baseScale(k);};def.copy(scale,baseScale);var dx,rx;scale.domain=function(){if(arguments.length)throw def.error.operationInvalid("The scale cannot be modified.");dx||(dx=def.array.append(def.ownKeys(colorMap),d));return dx;};scale.range=function(){if(arguments.length)throw def.error.operationInvalid("The scale cannot be modified.");rx||(rx=def.array.append(def.own(colorMap),r));return rx;};return me._wrapScale(scale);};},_getPreservedMap:function(){return this.option("PreserveMap")?this._state.preservedMap:null;},sceneScale:function(keyArgs){var varName=def.get(keyArgs,"sceneVarName")||this.role.name,fillColorScaleByColKey=this.scalesByCateg;if(fillColorScaleByColKey){var colorMissing=this.option("Missing");return function(scene){var colorValue=scene.vars[varName].value;if(null==colorValue)return colorMissing;var catAbsKey=scene.group.parent.absKey;return fillColorScaleByColKey[catAbsKey](colorValue);};}
return this.scale.by1(function(scene){return scene&&scene.vars[varName].value;});},_registerResolversNormal:function(rs,keyArgs){this.chart.compatVersion()<=1&&rs.push(this._resolveByV1OnlyLogic);rs.push(this._resolveByOptionId,this._resolveByScaleType,this._resolveByCommonId);this.index||rs.push(this._resolveByNaked);},_resolveByScaleType:pvc.options.specify(function(optionInfo){var st=this.scaleType;if(st){var name=optionInfo.name,value=this._chartOption(st+"ColorAxis"+name);void 0===value&&"discrete"!==st&&(value=this._chartOption("continuousColorAxis"+name));return value;}}),_resolveByCommonId:pvc.options.specify(function(optionInfo){return this._chartOption("colorAxes"+optionInfo.name);}),_resolveByNaked:pvc.options.specify(function(optionInfo){return this._chartOption(this.id+def.firstUpperCase(optionInfo.name));}),_specifyV1ChartOption:function(optionInfo,asName){if(!this.index&&this.chart.compatVersion()<=1&&this._specifyChartOption(optionInfo,asName))return!0;}}}));var colorAxis_defContColors,colorAxis_legendDataSpec={resolveDefault:function(optionInfo){if(!this.index&&this._specifyChartOption(optionInfo,def.firstLowerCase(optionInfo.name)))return!0;}};pvc.visual.ColorAxis.options({Colors:{resolve:"_resolveFull",getDefault:colorAxis_getDefaultColors,data:{resolveV1:function(optionInfo){"discrete"===this.scaleType?0===this.index?this._specifyChartOption(optionInfo,"colors"):1===this.index&&this.chart._allowV1SecondAxis&&this._specifyChartOption(optionInfo,"secondAxisColor"):this._specifyChartOption(optionInfo,"colorRange");return!0;},resolveDefault:function(optionInfo){0===this.index&&this._specifyChartOption(optionInfo,"colors");}},cast:pvc.colorScheme},Map:{resolve:"_resolveFull",cast:colorAxis_castColorMap},PreserveMap:{resolve:"_resolveFull",cast:Boolean,value:!1},Transform:{resolve:"_resolveFull",data:{resolveDefault:function(optionInfo){var plotList=this._plotList;if(plotList.length){var notMainAndAnyOfTrendAndPlot2=!1;def.query(plotList).each(function(plot){if(plot.isMain)return notMainAndAnyOfTrendAndPlot2=!1;var name=plot.name;"plot2"!==name&&"trend"!==name||(notMainAndAnyOfTrendAndPlot2=!0);});if(notMainAndAnyOfTrendAndPlot2)return optionInfo.defaultValue(pvc.brighterColorTransform),!0;}}},cast:def.fun.to},NormByCategory:{resolve:function(optionInfo){return this.chart._allowColorPerCategory?this._resolveFull(optionInfo):(optionInfo.specify(!1),!0);},data:{resolveV1:function(optionInfo){return this._specifyV1ChartOption(optionInfo,"normPerBaseCategory"),!0;}},cast:Boolean,value:!1},ScaleType:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){return this._specifyV1ChartOption(optionInfo,"scalingType"),!0;}},cast:pvc.parseContinuousColorScaleType,value:"linear"},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:!1},Domain:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){return this._specifyV1ChartOption(optionInfo,"colorRangeInterval"),!0;}},cast:def.array.to},Min:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){return this._specifyV1ChartOption(optionInfo,"minColor"),!0;}},cast:pv.color},Max:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){return this._specifyV1ChartOption(optionInfo,"maxColor"),!0;}},cast:pv.color},Missing:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){return this._specifyV1ChartOption(optionInfo,"nullColor"),!0;}},cast:pv.color,value:pv.color("lightgray")},Unbound:{resolve:"_resolveFull",getDefault:function(optionInfo){return this.option("Colors")().range()[0]||pvc.defaultColor;},cast:pv.color},LegendVisible:{resolve:"_resolveFull",data:colorAxis_legendDataSpec,cast:Boolean,value:!0},LegendClickMode:{resolve:"_resolveFull",data:colorAxis_legendDataSpec,cast:pvc.parseLegendClickMode,value:"togglevisible"},LegendDrawLine:{resolve:"_resolveFull",data:colorAxis_legendDataSpec,cast:Boolean,value:!1},LegendDrawMarker:{resolve:"_resolveFull",data:colorAxis_legendDataSpec,cast:Boolean,value:!0},LegendShape:{resolve:"_resolveFull",data:colorAxis_legendDataSpec,cast:pvc.parseShape}});def("pvc.visual.SizeAxis",pvc_Axis.extend({init:function(chart,type,index,keyArgs){keyArgs=def.set(keyArgs,"byNaked",!1);this.base(chart,type,index,keyArgs);},methods:{scaleTreatsNullAs:function(){return"min";},scaleUsesAbs:function(){return this.option("UseAbs");},setScaleRange:function(range){var scale=this.scale;scale.min=range.min;scale.max=range.max;scale.size=range.max-range.min;scale.range(scale.min,scale.max);def.debug>=4&&def.log("Scale: "+def.describe(def.copyOwn(scale)));return this;}},options:{OriginIsZero:{resolve:"_resolveFull",cast:Boolean,value:!1},FixedMin:{resolve:"_resolveFull",cast:def.number.to},FixedMax:{resolve:"_resolveFull",cast:def.number.to},FixedLength:{resolve:"_resolveFull",cast:def.number.to},DomainAlign:{resolve:"_resolveFull",cast:pvc.parseDomainAlign,value:"center"},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:!1}}}));def("pvc.visual.NormalizedAxis",pvc_Axis.extend({init:function(chart,type,index,keyArgs){keyArgs=def.set(keyArgs,"byNaked",!1);this.base(chart,type,index,keyArgs);},methods:{scaleTreatsNullAs:function(){return"zero";},scaleUsesAbs:def.retTrue,scaleSumNormalized:def.retTrue,setScaleRange:function(range){var scale=this.scale;scale.min=range.min;scale.max=range.max;scale.size=range.max-range.min;scale.range(scale.min,scale.max);def.debug>=4&&def.log("Scale: "+def.describe(def.copyOwn(scale)));return this;}},options:{OriginIsZero:{value:!0}}}));def.type("pvc.BasePanel",pvc.Abstract).add(pvc.visual.Interactive).init(function(chart,parent,options){this.chart=chart;this.base();this.axes=Object.create(chart.axes);if(options){if(options.scenes){this._sceneTypeExtensions=options.scenes;delete options.scenes;}
var axes=options.axes;if(axes){def.copy(this.axes,axes);delete options.axes;}}
$.extend(this,options);this.axes.color||(this.axes.color=chart.axes.color);this.position={};var margins=options&&options.margins;parent||void 0!==margins||(margins=3);this.margins=new pvc_Sides(margins);this.paddings=new pvc_Sides(options&&options.paddings);this.size=new pvc_Size(options&&options.size);this.sizeMin=new pvc_Size(options&&options.sizeMin);this.sizeMax=new pvc_Size(options&&options.sizeMax);this.parent=parent||null;if(parent){this.isTopRoot=!1;this.isRoot=parent.chart!==chart;this.root=this.isRoot?this:parent.root;this.topRoot=parent.topRoot;if(this.isRoot){this.position.left=chart.left;this.position.top=chart.top;}
parent._addChild(this);}else{this.root=this;this.topRoot=this;this.isRoot=!0;this.isTopRoot=!0;}
var above=parent||chart;this.data=above.data;if(this.isRoot){this.anchor=null;this.align=null;this.alignTo=null;this.offset=null;}else{this.align=pvc.parseAlign(this.anchor,this.align);var alignTo=this.alignTo,side=this.anchor;null==alignTo||""===alignTo||"left"!==side&&"right"!==side?alignTo=this.align:"page-middle"!==alignTo&&(alignTo=isNaN(+alignTo.charAt(0))?pvc.parseAlign(side,alignTo):pvc_PercentValue.parse(alignTo));this.alignTo=alignTo;this.offset=new pvc_Offset(this.offset);}
if(null==this.borderWidth){var borderWidth,extensionId=this._getExtensionId();if(extensionId){if(null!=this._getExtension(extensionId,"strokeStyle")){borderWidth=+this._getConstantExtension(extensionId,"lineWidth");!isNaN(borderWidth)&&isFinite(borderWidth)||(borderWidth=null);}}
this.borderWidth=null==borderWidth?0:1.5;}
var ibits=above.ibits(),I=pvc.visual.Interactive,ibitsChart=chart.ibits();ibits=def.bit.set(ibits,I.Clickable,ibitsChart&I.Clickable&&!!this.clickAction);ibits=def.bit.set(ibits,I.DoubleClickable,ibitsChart&I.DoubleClickable&&!!this.doubleClickAction);ibits=def.bit.set(ibits,I.Animatable,ibitsChart&I.Animatable);this._ibits&=ibits;}).add({_ibits:~pvc.visual.Interactive.Animatable,chart:null,parent:null,_children:null,type:pv.Panel,_extensionPrefix:"",_rubberSelectableMarks:null,height:null,width:null,borderWidth:null,anchor:"top",pvPanel:null,margins:null,paddings:null,isRoot:!1,isTopRoot:!1,root:null,topRoot:null,_layoutInfo:null,_signs:null,data:null,_animating:0,_selectingByRubberband:!1,_v1DimRoleName:{series:"series",category:"category",value:"value"},_sceneTypeExtensions:null,clickAction:null,doubleClickAction:null,compatVersion:function(options){return this.chart.compatVersion(options);},getCompatFlag:function(flagName){return this.chart.getCompatFlag(flagName);},_createLogId:function(){return""+def.qualNameOf(this.constructor)+this.chart._createLogChildSuffix();},_getLegendRootScene:function(){return this.chart._getLegendRootScene();},_addChild:function(child){child.parent===this||def.assert("Child has a != parent.");(this._children||(this._children=[])).push(child);},_addSign:function(sign){def.array.lazy(this,"_signs").push(sign);sign.selectableByRubberband()&&def.array.lazy(this,"_rubberSelectableMarks").push(sign.pvMark);},layout:function(ka){function processSizeDirection(a_len){var addLen=clientSizeNeeds[a_len]-clientSizeAvailableInput[a_len];if(addLen>pv.epsilon){clientSizeIncrease[a_len]=addLen;var pct=this.margins.getDirectionPercentage(a_len)+this.paddings.getDirectionPercentage(a_len);pct=Math.max(0,Math.min(1,pct));pct>0&&(addLen/=1-pct);sizeIncrease[a_len]=addLen;sizeNeeds[a_len]+=addLen;}else addLen<0&&(sizeNeeds[a_len]=clientSizeNeeds[a_len]+li.spacings[a_len]);}
var useLog=def.debug>=10,layoutInfoPrev=this._layoutInfo||null;if(layoutInfoPrev){if(!def.get(ka,"force",!1))return;layoutInfoPrev.previous=null;}
var canChange=def.get(ka,"canChange",!0),sizeAvailable=def.get(ka,"sizeAvailable"),sizeRef=def.get(ka,"sizeRef")||sizeAvailable&&pvc_Size.clone(sizeAvailable),sizeMin=this.chart.parent?{width:0,height:0}:this.sizeMin.resolve(null),sizeMax=this.sizeMax.resolve(sizeRef),sizeFix=def.get(ka,"size")||this.size.resolve(sizeRef);pvc_Size.applyMin(sizeMax,sizeMin);pvc_Size.applyMinMax(sizeFix,sizeMin,sizeMax);if(!sizeAvailable){if(null==sizeFix.width||null==sizeFix.height)throw def.error.operationInvalid("Panel layout without width or height set.");sizeAvailable=pvc_Size.clone(sizeFix);sizeRef||(sizeRef=pvc_Size.clone(sizeAvailable));}
var borderHalf=this.borderWidth/2,marginsArg=def.get(ka,"margins"),paddingsArg=def.get(ka,"paddings"),margins=marginsArg?pvc_Sides.updateSize(marginsArg):pvc_Sides.inflate(this.margins.resolve(sizeRef),borderHalf),paddings=paddingsArg?pvc_Sides.updateSize(paddingsArg):pvc_Sides.inflate(this.paddings.resolve(sizeRef),borderHalf),spaceW=margins.width+paddings.width,spaceH=margins.height+paddings.height,sizeAvailableInput=pvc_Size.clone(sizeAvailable);pvc_Size.applyMinMax(sizeAvailable,sizeMin,sizeMax);var sizeIncrease={width:Math.max(0,sizeAvailable.width-sizeAvailableInput.width),height:Math.max(0,sizeAvailable.height-sizeAvailableInput.height)},clientSizeAvailable=pvc_Size.deflate(sizeAvailable,spaceW,spaceH),clientSizeFix=pvc_Size.deflate(sizeFix,spaceW,spaceH),clientSizeAvailableInput=pvc_Size.clone(clientSizeAvailable);if(useLog){if(sizeAvailable.width-sizeAvailableInput.width||sizeAvailable.height-sizeAvailableInput.height){this.log("Size          -> "+def.describe(sizeAvailableInput));this.log("Size (min/max)-> "+def.describe(sizeAvailable));}else this.log("Size          -> "+def.describe(sizeAvailable));(margins.width||margins.height)&&this.log(" Margins      -> "+def.describe(margins));(paddings.width||paddings.height)&&this.log("  Paddings    -> "+def.describe(paddings));this.log("   ClientSize -> "+def.describe(clientSizeAvailable));}
var liRestrictions={canChange:canChange,sizeMin:sizeMin,sizeMax:sizeMax,size:sizeFix,clientSizeMin:pvc_Size.deflate(sizeMin,spaceW,spaceH),clientSizeMax:pvc_Size.deflate(sizeMax,spaceW,spaceH),clientSize:clientSizeFix},li=this._layoutInfo={sizeRef:sizeRef,referenceSize:sizeRef,desiredClientSize:clientSizeFix,borderWidth:this.borderWidth,margins:margins,paddings:paddings,spacings:{width:spaceW,height:spaceH},size:sizeAvailable,clientSize:clientSizeAvailable,clientSizePage:layoutInfoPrev?layoutInfoPrev.clientSizePage:pvc_Size.clone(clientSizeAvailable),previous:layoutInfoPrev,restrictions:liRestrictions,sizeIncrease:null,clientSizeIncrease:null},clientSizeNeeds=this._calcLayout(li)||clientSizeAvailable;this.isVisible=clientSizeNeeds.width>0&&clientSizeNeeds.height>0;if(this.isVisible){li.clientSize=pvc_Size.applyMinMax(clientSizeNeeds,liRestrictions.clientSizeMin,liRestrictions.clientSizeMax);var clientSizeIncrease={width:0,height:0},sizeNeeds=li.size;processSizeDirection.call(this,"width");processSizeDirection.call(this,"height");(clientSizeIncrease.width||clientSizeIncrease.height)&&(li.clientSizeIncrease=clientSizeIncrease);(sizeIncrease.width||sizeIncrease.height)&&(li.sizeIncrease=sizeIncrease);if(li.sizeIncrease&&(!marginsArg||!paddingsArg)){var sizeRef2=pvc_Size.clone(sizeRef);sizeIncrease.width&&(sizeRef2.width+=sizeIncrease.width);sizeIncrease.height&&(sizeRef2.height+=sizeIncrease.height);marginsArg||(margins=pvc_Sides.inflate(this.margins.resolve(sizeRef2),borderHalf));paddingsArg||(paddings=pvc_Sides.inflate(this.paddings.resolve(sizeRef2),borderHalf));li.margins=margins;li.paddings=paddings;li.spacings.width=margins.width+paddings.width;li.spacings.height=margins.height+paddings.height;}}else li.size={width:0,height:0};li.desiredClientSize=li.restrictions=li.previous=null;this.width=this.isVisible?sizeNeeds.width:0;this.height=this.isVisible?sizeNeeds.height:0;if(useLog){this.log("   ClientSize <- "+def.describe(li.clientSize));li.clientSizeIncrease&&this.log("             (+) "+def.describe(li.clientSizeIncrease));(paddings.width||paddings.height)&&this.log("  Paddings    <- "+def.describe(li.paddings));(margins.width||margins.height)&&this.log(" Margins      <- "+def.describe(li.margins));this.log("Size          <- "+def.describe(li.size));li.sizeIncrease&&this.log("             (+) "+def.describe(li.sizeIncrease));}
this._onLaidOut();},_onLaidOut:function(){this.isRoot&&this.chart._onLaidOut();},_getLayoutState:function(){var li=this._layoutInfo,anchor=this.anchor;"fill"===anchor&&(anchor=null);return{size:anchor?pvc_Size.toOrtho(li.size,anchor).resolve():li.size,margins:li.margins,paddings:li.paddings};},getLayout:function(){return this._layoutInfo||null;},_calcLayout:function(layoutInfo){function doMaxTimes(maxTimes,fun,ctx){for(var remTimes=maxTimes,index=0;remTimes--;){if(!1===fun.call(ctx,remTimes,index,maxTimes))return!0;index++;}
return!1;}
function layoutCycle(remTimes,iteration,maxTimes){useLog&&me.log.group("Iteration #"+(iteration+1)+" / "+maxTimes);try{margins=new pvc_Sides(0);remSize=def.copyOwn(clientSize);for(var child,canResize=remTimes>0,index=0,count=sideChildren.length;index<count;){child=sideChildren[index];useLog&&child.log.group("Layout SIDE child");try{if(layoutChild.call(this,child,canResize))return!0;}finally{useLog&&child.log.groupEnd();}
index++;}
index=0;count=fillChildren.length;for(;index<count;){child=fillChildren[index];useLog&&child.log.group("Layout FILL child");try{if(layoutChild.call(this,child,canResize))return!0;}finally{useLog&&child.log.groupEnd();}
index++;}
return!1;}finally{useLog&&me.log.groupEnd();}}
function layoutChild(child,canResize){var paddings,resized=!1;doMaxTimes(6,function(remTimes,iteration,maxTimes){useLog&&child.log.group("Iteration #"+(iteration+1)+" / "+maxTimes);try{childKeyArgs.sizeAvailable=new pvc_Size(remSize);childKeyArgs.paddings=paddings;childKeyArgs.canChange=canResize&&remTimes>0;child.layout(childKeyArgs);if(child.isVisible){resized=checkChildResize.call(this,child,canResize);if(resized)return!1;var contentOverflow=child._layoutInfo.contentOverflow;if(checkContentOverflowChanged(paddings,contentOverflow)){paddings=contentOverflow;if(remTimes>0){paddings=new pvc_Sides(paddings);useLog&&child.log("Child changed content overflow: "+def.describe(paddings));return!0;}
useLog&&child.log.warn("Child content overflow changed, but iterations limit has been reached.");}
positionChild.call(this,child);"fill"!==child.anchor&&updateSide.call(this,child);}
return!1;}finally{useLog&&child.log.groupEnd();}},this);return resized;}
function checkContentOverflowChanged(paddings,contentOverflow){return!!contentOverflow&&def.query(pvc_Sides.names).each(function(side){var curPad=paddings&&paddings[side]||0,newPad=contentOverflow&&contentOverflow[side]||0;if(Math.abs(newPad-curPad)>=pvc.roundPixel.epsilon)return!1;});}
function checkChildResize(child,canResize){function checkDimension(a_len){var addLen=sizeIncrease[a_len];if(addLen>pvc.roundPixel.epsilon)if(canResize){resized=!0;remSize[a_len]+=addLen;clientSize[a_len]+=addLen;}else useLog&&child.log.warn("Child wanted more "+a_len+", but layout iterations limit has been reached.");}
var resized=!1,sizeIncrease=child.getLayout().sizeIncrease;sizeIncrease&&("fill"===child.anchor?pvc_Size.names.forEach(checkDimension):checkDimension(child.anchorLength()));return resized;}
function positionChild(child){var sidePos,side=child.anchor,align=child.align,alignTo=child.alignTo;if("fill"===side){side="left";sidePos=margins.left+remSize.width/2-child.width/2;align=alignTo="middle";}else sidePos=margins[side];var sideo,sideOPosChildOffset;switch(align){case"top":case"bottom":case"left":case"right":sideo=align;sideOPosChildOffset=0;break;case"center":case"middle":sideo=altMap[aoMap[side]];sideOPosChildOffset=-child[aolMap[sideo]]/2;}
var sideOPosParentOffset,sideOTo;switch(alignTo){case"top":case"bottom":case"left":case"right":sideOTo=alignTo;sideOPosParentOffset=sideOTo!==sideo?remSize[aolMap[sideo]]:0;break;case"center":case"middle":sideOTo=altMap[aoMap[side]];sideOPosParentOffset=remSize[aolMap[sideo]]/2;break;case"page-center":case"page-middle":sideOTo=altMap[aoMap[side]];var lenProp=aolMap[sideo];sideOPosParentOffset=Math.min(remSize[lenProp],layoutInfo.clientSizePage[lenProp])/2;}
var sideOPos=margins[sideOTo]+sideOPosParentOffset+sideOPosChildOffset,resolvedOffset=child.offset.resolve(remSize);if(resolvedOffset){sidePos+=resolvedOffset[aofMap[side]]||0;sideOPos+=resolvedOffset[aofMap[sideo]]||0;}
if(child.keepInBounds){sidePos<0&&(sidePos=0);sideOPos<0&&(sideOPos=0);}
child.setPosition(def.set({},side,sidePos,sideo,sideOPos));}
function updateSide(child){var side=child.anchor,sideol=aolMap[side],olen=child[sideol];margins[side]+=olen;remSize[sideol]-=olen;}
var clientSize,margins,remSize,useLog,me=this;if(me._children){var aolMap=pvc.BasePanel.orthogonalLength,aoMap=pvc.BasePanel.relativeAnchor,altMap=pvc.BasePanel.leftTopAnchor,aofMap=pvc_Offset.namesSidesToOffset,fillChildren=[],sideChildren=[];me._children.forEach(function(child){var a=child.anchor;if(a)if("fill"===a)fillChildren.push(child);else{def.hasOwn(aoMap,a)||def.fail.operationInvalid("Unknown anchor value '{0}'",[a]);sideChildren.push(child);}});useLog=def.debug>=10;clientSize=def.copyOwn(layoutInfo.clientSize);var childKeyArgs={force:!0,sizeRef:clientSize};useLog&&me.log.group("CCC DOCK LAYOUT");try{doMaxTimes(5,layoutCycle,me);}finally{useLog&&me.log.groupEnd();}}
return clientSize;},invalidateLayout:function(){this._layoutInfo=null;this._children&&this._children.forEach(function(c){c.invalidateLayout();});},_create:function(force){if(!this.pvPanel||force){this.pvPanel=null;this.pvRootPanel&&(this.pvRootPanel=null);delete this._signs;if(this.isRoot){this.layout();if(this.isTopRoot&&this.chart._isMultiChartOverflowClip)return;}
if(!this.isVisible)return;this.isRoot&&this._creating();var margins=this._layoutInfo.margins,paddings=this._layoutInfo.paddings;if(this.isTopRoot){this.pvRootPanel=this.pvPanel=new pv.Panel().canvas(this.chart.options.canvas);var scene=new pvc.visual.Scene(null,{panel:this});this.pvRootPanel.lock("data",[scene]);if(margins.width>0||margins.height>0){this.pvPanel.width(this.width).height(this.height);this.pvPanel=this.pvPanel.add(pv.Panel);}}else this.pvPanel=this.parent.pvPanel.add(this.type);this.pvPanel.isPointingBarrier=!0;var pvBorderPanel=this.pvPanel,width=this.width-margins.width,height=this.height-margins.height;pvBorderPanel.width(width).height(height);def.debug>=15&&(margins.width>0||margins.height>0)&&(this.isTopRoot?this.pvRootPanel:this.parent.pvPanel).add(this.type).width(this.width).height(this.height).left(null!=this.position.left?this.position.left:null).right(null!=this.position.right?this.position.right:null).top(null!=this.position.top?this.position.top:null).bottom(null!=this.position.bottom?this.position.bottom:null).strokeStyle("orange").lineWidth(1).strokeDasharray("- .");var hasPositions={};def.eachOwn(this.position,function(v,side){pvBorderPanel[side](v+margins[side]);hasPositions[this.anchorLength(side)]=!0;},this);if(!hasPositions.width){margins.left>0&&pvBorderPanel.left(margins.left);margins.right>0&&pvBorderPanel.right(margins.right);}
if(!hasPositions.height){margins.top>0&&pvBorderPanel.top(margins.top);margins.bottom>0&&pvBorderPanel.bottom(margins.bottom);}
(paddings.width>0||paddings.height>0)&&(this.pvPanel=pvBorderPanel.add(pv.Panel).width(width-paddings.width).height(height-paddings.height).left(paddings.left).top(paddings.top));pvBorderPanel.borderPanel=pvBorderPanel;pvBorderPanel.paddingPanel=this.pvPanel;this.pvPanel.paddingPanel=this.pvPanel;this.pvPanel.borderPanel=pvBorderPanel;if(def.debug>=15){this.pvPanel.strokeStyle("lightgreen").lineWidth(1).strokeDasharray("- ");this.pvPanel!==pvBorderPanel&&pvBorderPanel.strokeStyle("blue").lineWidth(1).strokeDasharray(". ");}
var extensionId=this._getExtensionId();new pvc.visual.Panel(this,null,{panel:pvBorderPanel,extensionId:extensionId});this._createCore(this._layoutInfo);if(this.isTopRoot){var multiInfo=this.chart._multiInfo;multiInfo&&!multiInfo.isLastPage&&"clip"===this.chart.multiOptions.option("Overflow")&&this._addMultichartOverflowClipMarker();this._initSelection();this.interactive()&&"near"===this.chart._pointingOptions.mode&&this._requirePointEvent();}
this.applyExtensions();if(this.isRoot&&def.debug>5){var out=["SCALES SUMMARY",def.logSeparator];this.chart.axesList.forEach(function(axis){var scale=axis.scale;if(scale){var d=scale.domain&&scale.domain(),r=scale.range&&scale.range();out.push(axis.id);out.push("    domain: "+(d?def.describe(d):"?"));out.push("    range : "+(r?def.describe(r):"?"));}},this);this.log(out.join("\n"));}}},_creating:function(){this._children&&this._children.forEach(function(c){c._creating();});},_createCore:function(layoutInfo){this._children&&this._children.forEach(function(c){c._create();});},render:function(ka){if(!this.isTopRoot)return this.topRoot.render(ka);this._create(def.get(ka,"recreate",!1));if((!this.isTopRoot||!this.chart._isMultiChartOverflowClip)&&this.isVisible){var pvPanel=this.pvRootPanel;this._onRender();var prevAnimating=this._animating,animate=this.animatable();this._animating=animate&&!def.get(ka,"bypassAnimation",!1)?1:0;try{pvPanel.render();if(this._animating){this._animating=2;var me=this;pvPanel.transition().duration(2e3).ease("cubic-in-out").start(function(){if(prevAnimating)prevAnimating=0;else{me._animating=0;me._onRenderEnd(!0);}});}else this._onRenderEnd(!1);}finally{this._animating=0;}}},_onRender:function(){var renderCallback=this.chart.options.renderCallback;if(renderCallback)if(this.compatVersion()<=1)renderCallback.call(this.chart);else{var context=this.context();renderCallback.call(context,context.scene);}},_onRenderEnd:function(animated){this._children&&this._children.forEach(function(c){c._onRenderEnd(animated);});if(this.isTopRoot){var renderedCallback=this.chart.options.renderedCallback;if(renderedCallback){var context=this.context();renderedCallback.call(context,context.scene);}}},renderInteractive:function(){if(this.isVisible){var pvMarks=this._getRenderInteractiveMarks();if(pvMarks&&pvMarks.length)pvMarks.forEach(function(pvMark){pvMark.render();});else if(!this._children)return void this.pvPanel.render();this._children&&this._children.forEach(function(c){c.renderInteractive();});}},_getRenderInteractiveMarks:function(){return this._getSelectableMarks();},_getSelectableMarks:function(){return this._rubberSelectableMarks;},animatable:function(){return this.base()||!!this._children&&this._children.some(function(c){return c.animatable();});},animate:function(start,end){return 1===this.topRoot._animating?start:end;},animatingStart:function(){return 1===this.topRoot._animating;},animating:function(){return this.topRoot._animating>0;},setPosition:function(position){for(var side in position)if(def.hasOwn(pvc_Sides.namesSet,side)){var s=position[side];if(null===s)delete this.position[side];else{s=+s;!isNaN(s)&&isFinite(s)&&(this.position[side]=s);}}},createAnchoredSize:function(anchorLength,size){return this.isAnchorTopOrBottom()?{width:size.width,height:Math.min(size.height,anchorLength)}:{width:Math.min(size.width,anchorLength),height:size.height};},applyExtensions:function(){this._signs&&this._signs.forEach(function(s){s.applyExtensions();});},extend:function(mark,id,ka){this.chart.extend(mark,this._makeExtensionAbsId(id),ka);},extendAbs:function(mark,absId,ka){this.chart.extend(mark,absId,ka);},_extendSceneType:function(typeKey,type,names){var typeExts=def.get(this._sceneTypeExtensions,typeKey);typeExts&&pvc.extendType(type,typeExts,names);},_absBaseExtId:{abs:"base"},_absSmallBaseExtId:{abs:"smallBase"},_getExtensionId:function(){if(this.isRoot)return this.chart.parent?this._absSmallBaseExtId:this._absBaseExtId;},_getExtensionPrefix:function(){return this._extensionPrefix;},_makeExtensionAbsId:function(id){return pvc.makeExtensionAbsId(id,this._getExtensionPrefix());},_getExtension:function(id,prop){return this.chart._getExtension(this._makeExtensionAbsId(id),prop);},_getExtensionAbs:function(absId,prop){return this.chart._getExtension(absId,prop);},_getConstantExtension:function(id,prop){return this.chart._getConstantExtension(this._makeExtensionAbsId(id),prop);},getPvPanel:function(layer){var mainPvPanel=this.pvPanel;if(!layer)return mainPvPanel;if(!this.parent)throw def.error.operationInvalid("Layers are not possible in a root panel.");if(!mainPvPanel)throw def.error.operationInvalid("Cannot access layer panels without having created the main panel.");var pvPanel=null;this._layers?pvPanel=this._layers[layer]:this._layers={};if(!pvPanel){pvPanel=this.parent.pvPanel.borderPanel.add(this.type).extend(mainPvPanel.borderPanel);var pvBorderPanel=pvPanel;mainPvPanel!==mainPvPanel.borderPanel&&(pvPanel=pvBorderPanel.add(pv.Panel).extend(mainPvPanel));pvBorderPanel.borderPanel=pvBorderPanel;pvBorderPanel.paddingPanel=pvPanel;pvPanel.paddingPanel=pvPanel;pvPanel.borderPanel=pvBorderPanel;this.initLayerPanel(pvPanel,layer);this._layers[layer]=pvPanel;}
return pvPanel;},initLayerPanel:function(){},_getV1DimName:function(v1Dim){var dimNames=this._v1DimName||(this._v1DimNameCache={}),dimName=dimNames[v1Dim];if(null==dimName){var role=this.visualRoles[this._v1DimRoleName[v1Dim]];dimName=role?role.grouping.firstDimension.name:"";dimNames[v1Dim]=dimName;}
return dimName;},_getV1Datum:function(scene){return scene.datum;},context:function(){var context=this._context;!context||context.isPinned?context=this._context=new pvc.visual.Context(this):visualContext_update.call(context);return context;},visualRolesOf:function(mainDimName,includeChart){return includeChart?this.chart.visualRolesOf(mainDimName):null;},_isTooltipEnabled:function(){return!this.selectingByRubberband()&&!this.animating();},_getTooltipFormatter:function(tipOptions){var isV1Compat=this.compatVersion()<=1,tooltipFormat=tipOptions.format;if(!tooltipFormat){if(!isV1Compat)return this._summaryTooltipFormatter.bind(this);tooltipFormat=this.chart.options.v1StyleTooltipFormat;if(!tooltipFormat)return;}
return isV1Compat?function(context){return tooltipFormat.call(context.panel,context.getV1Series(),context.getV1Category(),context.getV1Value()||"",context.getV1Datum());}:function(context){return tooltipFormat.call(context,context.scene);};},CSS_TT_CLASS:"ccc-tt",_summaryTooltipFormatter:function(context){function renderRows(){var rows=[];firstDatum.isTrend&&rows.push(tag("tr",{class:ttClasses("trendLabel","trend-"+escapeCssClass(firstDatum.trend.type))},tag("td",{colspan:3},tag("span",null,escapeHtml(firstDatum.trend.label)))));if(isSingleGroup){rows.push.apply(rows,renderSingleGroupCommonDims());commonDimNames&&hasManyRealDatums&&rows.push(tag("tr",{class:ttClasses("dimSep")},'<td colspan="3"><hr/></td>'));}
rows.push.apply(rows,renderRemainingDims());hasManyRealDatums&&rows.push(tag("tr",{class:ttClasses("datumCount")},'<td colspan="3"><span>'+realDatums.length+"</span></td>"));return rows;}
function renderSingleGroupCommonDims(){var commonAtoms=group.atoms;return complexType.sortDimensionNames(def.keys(commonAtoms)).map(function(commonDimName){var value,mainDimType,atom=commonAtoms[commonDimName];if(null!=(value=atom.value)){mainDimType=atom.dimension.type;if(!mainDimType.isHidden){(commonDimNames||(commonDimNames={}))[commonDimName]=!0;return renderDim(mainDimType,value,atom.label);}}
return"";});}
function renderRemainingDims(){return complexType.dimensionsList().map(renderRemainingDim);}
function renderRemainingDim(mainDimType){var mainDimName=mainDimType.name;if(mainDimType.isHidden||def.getOwn(commonDimNames,mainDimName))return"";var dim,value,valueLabel,aggregationType,interpolationName;if(isSingleDatum){var atom=firstDatum.atoms[mainDimName];value=atom.value;valueLabel=atom.label;interpolationName=firstDatum.isInterpolated&&firstDatum.interpDimName===mainDimName?firstDatum.interpolation:null;}else{allGroup||(allGroup=scene.allGroup());dim=allGroup.dimensions(mainDimName);if(mainDimType.valueType===Number){hasManyRealDatums&&(aggregationType="sum");value=dim.value(visibleKeyArgs);valueLabel=dim.format(value);null===isChartInterpolatable&&(isChartInterpolatable=chart.interpolatable());isChartInterpolatable&&(interpolationName=Q(datums).where(function(d){return d.isInterpolated&&d.interpDimName===mainDimName;}).select(function(d){return d.interpolation;}).first());}else{hasManyRealDatums&&(aggregationType="list");value=valueLabel=dim.atoms(visibleKeyArgs).filter(function(a){return null!=a.value;}).map(function(a){return a.label||"- ";}).join(", ");value||(value=null);}}
return renderDim(mainDimType,value,valueLabel,aggregationType,interpolationName);}
function renderDim(mainDimType,value,valueLabel,aggregationType,interpolationName){var rowClasses=ttClasses("dim","dimValueType-"+mainDimType.valueTypeName,"dim"+(mainDimType.isDiscrete?"Discrete":"Continuous"),aggregationType?"dimAgg":"",aggregationType?"dimAgg-"+aggregationType:""),percentVar=null,visRoles=getDimActiveVisualRoles(mainDimType.name),dimRolesHtml=visRoles?visRoles.map(function(role){if(role.isPercent&&null===percentVar){var sceneVar=scene.vars[role.name];sceneVar&&null!=sceneVar.percent&&(percentVar=sceneVar.percent);}
return tag("span",{class:ttClasses("role","role-"+role.name)},tag("span",{class:ttClasses("roleIcon")},""),tag("span",{class:ttClasses("roleLabel")},escapeHtml(role.label)));}):"";return tag("tr",{class:rowClasses},tag("td",{class:ttClasses("dimLabel")},tag("span",null,escapeHtml(mainDimType.label))),tag("td",{class:ttClasses("dimRoles")},dimRolesHtml),tag("td",{class:ttClasses("dimValue",null==value?"valueNull":"")},tag("span",{class:ttClasses("value")},escapeHtml(valueLabel)),null!==percentVar?""+tag("span",{class:ttClasses("valuePct")},function(){return escapeHtml(percentVar.label);}):"",interpolationName?" "+tag("span",{class:ttClasses("interp","interp-"+escapeCssClass(interpolationName))},escapeHtml(def.firstUpperCase(interpolationName)+" interp.")):""));}
function getDimActiveVisualRoles(mainDimName){var roles=me.visualRolesOf(mainDimName,!0);roles&&isSingleGroup&&(roles=roles.filter(function(role){return!role.isMeasureEffective||role.isBoundDimensionName(group,mainDimName);}));return roles;}
var datums,scene=context.scene,firstDatum=scene.datum,Q=def.query;if(!firstDatum)return"";datums=scene.datums().array();if(Q(datums).all(function(d){return d.isNull;}))return"";var allGroup,commonDimNames,me=this,ttClass=this.CSS_TT_CLASS,visibleKeyArgs={visible:!0},escapeCssClass=def.css.escapeClass,escapeHtml=def.html.escape,classesHtml=def.html.classes,tag=def.html.tag,ttClasses=classesHtml.bind(null,ttClass),chart=context.chart,isChartInterpolatable=null,group=scene.group,data=scene.data(),complexType=data.type,realDatums=Q(datums).where(function(d){return!d.isVirtual;}).array(),color=context.sign.defaultColor(scene),isSingleGroup=!!group&&1===scene.groups.length,isSingleDatum=1===datums.length,hasManyRealDatums=realDatums.length>1;return tag("div",{class:ttClass},function(){var tableClasses=def.array.appendMany(["ds"],me._getTooltipPanelClasses(),"chartOrient-"+(chart.isOrientationVertical()?"v":"h"));return tag("table",{class:ttClasses.apply(null,tableClasses),"data-ccc-color":color&&"none"!==color.color?color.color:""},tag("tBody",null,renderRows));});},_getTooltipPanelClasses:function(){},_requirePointEvent:function(){if(!this.isTopRoot)return this.topRoot._requirePointEvent();if(!this._attachedPointEvent){this.pvPanel.root.events("all").event("mousemove",pv.Behavior.point(this.chart._pointingOptions));this._attachedPointEvent=!0;}},_requireTipsy:function(){if(!this.isTopRoot)return this.topRoot._requireTipsy();if(!this._tipsy){var chart=this.chart,tipOptions=def.create(chart._tooltipOptions);tipOptions.isEnabled=this._isTooltipEnabled.bind(this);"near"===chart._pointingOptions.mode&&(tipOptions.usesPoint=!0);this._tipsy=pv.Behavior.tipsy(tipOptions);}
return this._tipsy;},_onClick:function(context){var handler=this.clickAction;handler&&(this.compatVersion()<=1?this._onV1Click(context,handler):handler.call(context,context.scene));},_onDoubleClick:function(context){var handler=this.doubleClickAction;handler&&(this.compatVersion()<=1?this._onV1DoubleClick(context,handler):handler.call(context,context.scene));},_onV1Click:function(context,handler){handler.call(context.pvMark,context.getV1Series(),context.getV1Category(),context.getV1Value(),context.event,context.getV1Datum());},_onV1DoubleClick:function(context,handler){handler.call(context.pvMark,context.getV1Series(),context.getV1Category(),context.getV1Value(),context.event,context.getV1Datum());},_addMultichartOverflowClipMarker:function(){function getRadius(mark){var r=mark.shapeRadius();if(null==r){var s=mark.shapeSize();null!=s&&(r=Math.sqrt(s));}
return r||dr;}
var dr=5,pvDot=new pvc.visual.Dot(this,this.pvPanel,{noSelect:!0,noHover:!0,noClick:!0,noDoubleClick:!0,noTooltip:!1,freePosition:!0,extensionId:"multiChartOverflowMarker"}).lock("data").pvMark.shape("triangle").shapeRadius(dr).top(null).left(null).bottom(function(){return getRadius(this)+10;}).right(function(){return getRadius(this)+10;}).shapeAngle(0).lineWidth(1.5).strokeStyle("red").fillStyle("rgba(255, 0, 0, 0.2)");def.fun.is(pvDot.tooltip)&&pvDot.tooltip("Some charts did not fit the available space.");},selectingByRubberband:function(){return this.topRoot._selectingByRubberband;},_initSelection:function(){var me=this,chart=me.chart;if(me.interactive()){var clickClearsSelection=me.unselectable(),useRubberband=me.selectableByRubberband();if(useRubberband||clickClearsSelection){var data=me.data,pvParentPanel=me.pvRootPanel||me.pvPanel.paddingPanel;me._getExtensionAbs("base","fillStyle")||pvParentPanel.fillStyle(pvc.invisibleFill);pvParentPanel.lock("events","all");if(useRubberband){me._selectingByRubberband=!1;var toScreen,rb,selectionEndedDate,selectBar=this.selectBar=new pvc.visual.Bar(me,pvParentPanel,{extensionId:"rubberBand",normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0}).override("defaultStrokeWidth",def.fun.constant(1.5)).override("defaultColor",function(scene,type){return"stroke"===type?"#86fe00":"rgba(203, 239, 163, 0.6)";}).override("interactiveColor",function(scene,color){return color;}).pvMark.lock("visible",function(){return!!rb;}).lock("left",function(){return rb.x;}).lock("right").lock("top",function(){return rb.y;}).lock("bottom").lock("width",function(){return rb.dx;}).lock("height",function(){return rb.dy;}).lock("cursor").lock("events","none");pvParentPanel.intercept("data",function(){var scenes=this.delegate();scenes&&scenes.forEach(function(scene){null==scene.x&&(scene.x=scene.y=scene.dx=scene.dy=0);});return scenes;}).event("mousedown",pv.Behavior.select().autoRender(!1)).event("select",function(scene){if(rb)rb=new pv.Shape.Rect(scene.x,scene.y,scene.dx,scene.dy);else{if(me.animating())return;if(scene.dx*scene.dx+scene.dy*scene.dy<=4)return;rb=new pv.Shape.Rect(scene.x,scene.y,scene.dx,scene.dy);me._selectingByRubberband=!0;toScreen||(toScreen=pvParentPanel.toScreenTransform());me.rubberBand=rb.apply(toScreen);}
selectBar.render();}).event("selectend",function(){if(rb){var ev=arguments[arguments.length-1];toScreen||(toScreen=pvParentPanel.toScreenTransform());var rbs=rb.apply(toScreen);rb=null;me._selectingByRubberband=!1;selectBar.render();try{me._processRubberBand(rbs,ev);}finally{selectionEndedDate=new Date();}}});clickClearsSelection&&pvParentPanel.event("click",function(){if(selectionEndedDate){if(new Date()-selectionEndedDate<300){selectionEndedDate=null;return;}}
data.clearSelected()&&chart.updateSelections();});}else clickClearsSelection&&pvParentPanel.event("click",function(){data.clearSelected()&&chart.updateSelections();});}}},_processRubberBand:function(rb,ev,ka){this.rubberBand=rb;try{this._onRubberBandSelectionEnd(ev,ka);}finally{this.rubberBand=null;}},_onRubberBandSelectionEnd:function(ev,ka){def.debug>=20&&this.log("rubberBand "+def.describe(this.rubberBand));ka=Object.create(ka||{});ka.toggle=!1;var datums=this._getDatumsOnRubberBand(ev,ka);if(datums&&datums.length){var chart=this.chart;chart._updatingSelections(function(){datums=chart._onUserSelection(datums);if(datums&&datums.length){if(!(ev.ctrlKey||ev.metaKey)&&chart.options.ctrlSelectMode){chart.data.owner.clearSelected();cdo.Data.setSelected(datums,!0);}else ka.toggle?cdo.Data.toggleSelected(datums):cdo.Data.setSelected(datums,!0);}});}},_getDatumsOnRubberBand:function(ev,ka){var datumMap=new def.Map();this._getDatumsOnRect(datumMap,this.rubberBand,ka);return datumMap.values();},_getDatumsOnRect:function(datumMap,rect,ka){this._getOwnDatumsOnRect(datumMap,rect,ka);var cs=this._children;cs&&cs.forEach(function(c){c._getDatumsOnRect(datumMap,rect,ka);});},_getOwnDatumsOnRect:function(datumMap,rect,ka){var me=this;if(!me.isVisible)return!1;var pvMarks=me._getSelectableMarks();if(!pvMarks||!pvMarks.length)return!1;var inCount=datumMap.count,selectionMode=def.get(ka,"markSelectionMode"),processDatum=function(datum){datum.isNull||datumMap.set(datum.id,datum);},processScene=function(scene){scene.selectableByRubberband()&&scene.datums().each(processDatum);},processMark=function(pvMark){pvMark.eachSceneWithDataOnRect(rect,processScene,null,selectionMode);};pvMarks.forEach(processMark);return inCount<datumMap.count;},isAnchorTopOrBottom:function(anchor){anchor||(anchor=this.anchor);return"top"===anchor||"bottom"===anchor;},isOrientationVertical:function(o){return this.chart.isOrientationVertical(o);},isOrientationHorizontal:function(o){return this.chart.isOrientationHorizontal(o);}}).type().add({relativeAnchor:{top:"left",bottom:"left",left:"bottom",right:"bottom"},leftBottomAnchor:{top:"bottom",bottom:"bottom",left:"left",right:"left"},leftTopAnchor:{top:"top",bottom:"top",left:"left",right:"left"},horizontalAlign:{top:"right",bottom:"left",middle:"center",right:"right",left:"left",center:"center"},verticalAlign:{top:"top",bottom:"bottom",middle:"middle",right:"bottom",left:"top",center:"middle"},verticalAlign2:{top:"top",bottom:"bottom",middle:"middle",right:"top",left:"bottom",center:"middle"},relativeAnchorMirror:{top:"right",bottom:"right",left:"top",right:"top"},oppositeAnchor:{top:"bottom",bottom:"top",left:"right",right:"left"},parallelLength:{top:"width",bottom:"width",right:"height",left:"height"},orthogonalLength:{top:"height",bottom:"height",right:"width",left:"width"},oppositeLength:{width:"height",height:"width"}});def.scope(function(){var BasePanel=pvc.BasePanel,methods={},anchorDicts={anchorOrtho:"relativeAnchor",anchorOrthoMirror:"relativeAnchorMirror",anchorOpposite:"oppositeAnchor",anchorLength:"parallelLength",anchorOrthoLength:"orthogonalLength"};def.eachOwn(anchorDicts,function(d,am){var dict=BasePanel[d];methods[am]=function(a){return dict[a||this.anchor];};});BasePanel.add(methods);});def.type("pvc.ContentPanel",pvc.BasePanel).add({anchor:"fill",_getExtensionId:function(){return[{abs:this.chart.parent?"smallContent":"content"}];}});var pvc_plotClassByType={};def("pvc.visual.Plot",pvc.visual.OptionsBase.extend({init:function(chart,keyArgs){var typePlots=def.getPath(chart,["plotsByType",this.type]),index=typePlots?typePlots.length:0,globalIndex=chart.plotList.length,isMain=!globalIndex,internalPlot=def.get(keyArgs,"isInternal",!0);keyArgs=def.setDefaults(keyArgs,"byNaked",isMain,"byName",internalPlot,"byV1",internalPlot);internalPlot||(keyArgs.optionId=pvc.uniqueExtensionAbsPrefix());this.base(chart,this.type,index,keyArgs);if(this.name&&("$"===this.name||this.name.indexOf(".")>=0))throw def.error.argumentInvalid("name",def.format("Invalid plot name '{0}'.",[this.name]));this.prettyId=this.name||this.id;this.isInternal=!!internalPlot;this.isMain=isMain;var prefixes=this.extensionPrefixes=[this.optionId];if(internalPlot){isMain&&prefixes.push("");this.name&&prefixes.push(this.name);}
this.visualRoles={};this.visualRoleList=[];this.dataCellList=[];this.dataCellsByRole={};this._isBound=void 0;var plotSpec=def.get(keyArgs,"spec");plotSpec&&this.processSpec(plotSpec);},methods:{get dataPartValue(){return this.option("DataPart");},_buildOptionId:function(keyArgs){return def.get(keyArgs,"optionId",this.id);},processSpec:function(plotSpec){var me=this,options=me.chart.options,extId=(me.isInternal?me.name:null)||me.optionId;me.chart._processExtensionPointsIn(plotSpec,extId,function(optValue,optId,optName){switch(optName){case"name":case"type":break;case"visualRoles":me._visualRolesOptions=optValue;def.object.is(optValue)&&def.each(optValue,function(spec){def.object.is(spec)&&spec.from&&(spec.from=me.ensureAbsRoleRef(spec.from));});break;default:options[optId]=optValue;}});},ensureAbsRoleRef:function(roleName){return roleName&&roleName.indexOf(".")<0?this.prettyId+"."+roleName:roleName;},_getColorRoleSpec:def.fun.constant(null),_addVisualRole:function(name,spec){var roleList=this.visualRoleList;spec=def.set(spec,"index",roleList.length,"plot",this);var role=new pvc.visual.Role(this.chart,name,spec);this.visualRoles[name]=role;roleList.push(role);return role;},_addDataCell:function(dataCell){this.dataCellList.push(dataCell);def.array.lazy(this.dataCellsByRole,dataCell.role.name).push(dataCell);},get boundDimensionsComplexTypesMap(){var complexTypesMap=null;def.eachOwn(this.visualRoles,function(role){if(!1!==role.isMeasureEffective){complexTypesMap||(complexTypesMap={});complexTypesMap[role.boundDimensionsDataSetName]=this.chart.getBoundDimensionsComplexTypeOf(role);}},this);return complexTypesMap;},get boundDimensionsDataSetsMap(){var dataSetsMap=this._boundDimensionsDataSetsMap;if(!dataSetsMap){def.eachOwn(this.visualRoles,function(role){if(!1!==role.isMeasureEffective){dataSetsMap||(dataSetsMap=Object.create(null));dataSetsMap[role.boundDimensionsDataSetName]=role.boundDimensionsDataSet;}},this);this._boundDimensionsDataSetsMap=dataSetsMap;}
return dataSetsMap;},interpolatable:function(){return!1;},visualRole:function(name){return def.getOwn(this.visualRoles,name,null);},initEnd:function(){this._initVisualRoles();this._initDataCells();},_initVisualRoles:function(){var roleSpec=this._getColorRoleSpec();roleSpec&&this._addVisualRole("color",roleSpec);},_initDataCells:function(){if(this.visualRoles.color){var dataCell=this._getColorDataCell();dataCell&&this._addDataCell(dataCell);}},bindEnd:function(){if(void 0!==this._isBound)throw def.error.operationInvalid("Plot binding has already ended.");this._isBound=this.visualRoleList.every(function(role){return!role.isRequired||role.isBound();});},assertBound:function(){this.isBound||this.visualRoleList.forEach(function(role){if(role.isRequired&&!role.isBound())throw def.error.operationInvalid("The required visual role '{0}' is unbound.",[role.name]);});},get isBound(){return this._isBound;},isDataBoundOn:function(baseData){var isBound=this.isBound;if(void 0!==isBound){var isBoundByData=def.lazy(this,"_isBoundByData"),isBound=def.getOwn(isBoundByData,baseData.id,null);if(null===isBound){isBound=def.query(this.dataCellList).all(function(dataCell){return!dataCell.role.isBound()||dataCell.isDataBoundOn(baseData);});isBoundByData[baseData.id]=isBound;}}
return isBound;},createData:function(baseData,ka){return baseData.where(null,ka);},interpolateDataCell:function(dataCell){if(dataCell.plot!==this)throw def.error.operationInvalid("DataCell not of this plot.");},generateTrendsDataCell:function(newDatums,dataCell){if(dataCell.plot!==this)throw def.error.operationInvalid("DataCell not of this plot.");},getContinuousVisibleCellExtent:function(chart,valueAxis,valueDataCell){if(valueDataCell.plot!==this)throw def.error.operationInvalid("Datacell not of this plot.");var valueRole=valueDataCell.role;if("series"===valueRole.name)throw def.error.notImplemented();var data=chart.visiblePlotData(this);if(valueAxis.scaleSumNormalized())return{min:0,max:Math.abs(valueRole.numberValueOf(data).value||0)};var valueDimNames=valueRole.grouping.dimensionNames(),useAbs=valueAxis.scaleUsesAbs();return def.query(valueDimNames).select(function(valueDimName){var extent=data.dimensions(valueDimName).extent({abs:useAbs});if(void 0!==extent){var minValue=extent.min.value,maxValue=extent.max.value;return{min:useAbs?Math.abs(minValue):minValue,max:useAbs?Math.abs(maxValue):maxValue};}}).reduce(pvc.unionExtents,null);},_getColorDataCell:function(){var colorRole=this.visualRoles.color;if(colorRole)return new pvc.visual.ColorDataCell(this,"color",this.option("ColorAxis")-1,colorRole);}},options:{Orientation:{resolve:function(optionInfo){return optionInfo.specify(this._chartOption("orientation")||"vertical"),!0;},cast:String},ValuesVisible:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){if(0===this.globalIndex){var show=this._chartOption("showValues");if(void 0!==show)optionInfo.specify(show);else{show="point"!==this.type;optionInfo.defaultValue(show);}
return!0;}}},cast:Boolean,value:!1},ValuesAnchor:{resolve:"_resolveFull",cast:pvc.parseAnchor},ValuesFont:{resolve:"_resolveFull",cast:String,value:"10px sans-serif"},ValuesMask:{resolve:"_resolveFull",cast:String,value:"{value}"},ValuesOptimizeLegibility:{resolve:"_resolveFull",cast:Boolean,value:!1},ValuesOverflow:{resolve:"_resolveFull",cast:pvc.parseValuesOverflow,value:"hide"},DataPart:{resolve:"_resolveFull",cast:String,value:"0"},ColorAxis:{resolve:pvc.options.resolvers([function(optionInfo){if(0===this.globalIndex)return optionInfo.specify(1),!0;},"_resolveFull"]),cast:function(value){value=def.number.to(value);return null!=value?def.between(value,1,10):1;},value:1}},"type.methods":{registerClass:function(Class){pvc_plotClassByType[Class.prototype.type]=Class;},getClass:function(type){return def.getOwn(pvc_plotClassByType,type);}}}));var pvc_plotPanelClassByType={};def.type("pvc.PlotPanel",pvc.BasePanel).init(function(chart,parent,plot,options){null==options.sizeMin&&(options.sizeMin=this._getOptionSizeMin(chart));null==options.paddings&&(options.paddings=chart._axisOffsetPct);this.base(chart,parent,options);this.plot=plot;this.dataPartValue=plot.dataPartValue;this._extensionPrefix=plot.extensionPrefixes;this.axes.color=chart._getAxis("color",(plot.option("ColorAxis")||0)-1);this.orientation=plot.option("Orientation");this.valuesVisible=plot.option("ValuesVisible");this.valuesAnchor=plot.option("ValuesAnchor");this.valuesMask=plot.option("ValuesMask");this.valuesFont=plot.option("ValuesFont");this.valuesOverflow=plot.option("ValuesOverflow");this.valuesOptimizeLegibility=plot.option("ValuesOptimizeLegibility");this.visualRoles=plot.visualRoles;this.visualRoleList=plot.visualRoleList;}).add({anchor:"fill",visualRoles:null,visibleData:function(ka){return this.chart.visiblePlotData(this.plot,ka);},partData:function(){return this.chart.partData(this.dataPartValue);},_getExtensionId:function(){return["chart","plot"];},_getOptionSizeMin:function(chart){var plotSizeMin=chart.parent?null:chart.options.plotSizeMin;return null!=plotSizeMin?pvc_Size.to(plotSizeMin):null;},visualRolesOf:function(mainDimName,includeChart){var plotVisRoles=def.getOwn(this._visualRolesByDim,mainDimName,null),chartVisRoles=includeChart?this.chart.visualRolesOf(mainDimName):null;return plotVisRoles&&chartVisRoles?plotVisRoles.concat(chartVisRoles):plotVisRoles||chartVisRoles;},get _visualRolesByDim(){var visualRolesByDim=this.__visRolesByDim;if(!visualRolesByDim){visualRolesByDim=this.__visRolesByDim={};this.visualRoleList.forEach(function(role){var grouping=role.grouping;grouping&&grouping.dimensionNames().forEach(function(dimName){def.array.lazy(visualRolesByDim,dimName).push(role);});});}
return visualRolesByDim;},_getTooltipPanelClasses:function(){return["plot","plot-"+this.plot.type];},isOrientationVertical:function(){return this.orientation===pvc.orientation.vertical;},isOrientationHorizontal:function(){return this.orientation===pvc.orientation.horizontal;}}).type().add({registerClass:function(Class,typeName){pvc_plotPanelClassByType[typeName||Class.prototype.plotType]=Class;},getClass:function(typeName){return def.getOwn(pvc_plotPanelClassByType,typeName);}});def.type("pvc.PlotBgPanel",pvc.BasePanel).init(function(chart,parent,options){this.base(chart,parent,options);}).add({anchor:"fill",_getExtensionId:function(){return"plotBg";},_createCore:function(layoutInfo){this.pvPanel.borderPanel.lock("zOrder",-13).antialias(!1);this.base(layoutInfo);}});def("pvc.visual.Legend",pvc.visual.OptionsBase.extend({init:function(chart,type,index,keyArgs){keyArgs=def.set(keyArgs,"byNaked",!1);this.base(chart,type,index,keyArgs);},options:{Position:{resolve:"_resolveFull",cast:pvc.parsePosition,value:"bottom"},Size:{resolve:"_resolveFull",cast:legend_castSize},SizeMax:{resolve:"_resolveFull",cast:legend_castSize},ItemCountMax:{resolve:"_resolveFull",cast:def.number.toPositive},Align:{resolve:"_resolveFull",data:{resolveDefault:function(optionInfo){var align,position=this.option("Position");"top"!==position&&"bottom"!==position?align="top":this.chart.compatVersion()<=1&&(align="left");return optionInfo.defaultValue(align),!0;}},cast:legend_castAlign},Margins:{resolve:"_resolveFull",data:{resolveDefault:function(optionInfo){if(this.chart.compatVersion()>1){var position=this.option("Position"),margins=def.set({},pvc.BasePanel.oppositeAnchor[position],5);optionInfo.defaultValue(margins);}
return!0;}},cast:pvc_Sides.as},Paddings:{resolve:"_resolveFull",cast:pvc_Sides.as,value:5},Font:{resolve:"_resolveFull",cast:String},ItemSize:{resolve:"_resolveFull",cast:legendItem_castSize},Overflow:{resolve:"_resolveFull",cast:pvc.parseLegendOverflow,value:"clip"}}}));def.type("pvc.LegendPanel",pvc.BasePanel).init(function(chart,parent,options){this.base(chart,parent,options);if(void 0===options.font){var extFont=this._getConstantExtension("label","font");extFont&&(this.font=extFont);}
var I=pvc.visual.Interactive;this._ibits&I.Interactive&&(this._ibits|=I.Clickable);}).add({pvRule:null,pvDot:null,pvLabel:null,anchor:"bottom",pvLegendPanel:null,textMargin:6,itemPadding:2.5,itemSize:null,markerSize:15,font:"10px sans-serif",_calcLayout:function(layoutInfo){return this._getRootScene().layout(layoutInfo);},_createCore:function(layoutInfo){var clientSize=layoutInfo.clientSize,rootScene=this._getRootScene(),itemPadding=rootScene.vars.itemPadding,contentSize=rootScene.vars.contentSize,isHorizontal=this.isAnchorTopOrBottom(),a_top=isHorizontal?"top":"left",a_bottom=this.anchorOpposite(a_top),a_width=this.anchorLength(a_top),a_height=this.anchorOrthoLength(a_top),a_center=isHorizontal?"center":"middle",a_left=isHorizontal?"left":"top",a_right=this.anchorOpposite(a_left),leftOffset=0;switch(this.align){case a_right:leftOffset=clientSize[a_width]-contentSize[a_width];break;case a_center:leftOffset=(clientSize[a_width]-contentSize[a_width])/2;}
this.pvPanel.borderPanel.overflow("hidden");var wrapper,pvLegendSectionPanel=this.pvPanel.add(pv.Panel).data(rootScene.vars.sections)[a_left](leftOffset)[a_top](function(){var prevSection=this.sibling();return prevSection?prevSection[a_top]+prevSection[a_height]+itemPadding[a_height]:0;})[a_width](function(section){return section.size[a_width];})[a_height](function(section){return section.size[a_height];});this.compatVersion()<=1&&(wrapper=function(v1f){return function(itemScene){return v1f.call(this,itemScene.vars.value.rawValue);};});var pvLegendItemPanel=this.pvLegendPanel=new pvc.visual.Panel(this,pvLegendSectionPanel,{extensionId:"panel",wrapper:wrapper,noSelect:!1,noHover:!0,noClick:!1,noClickSelect:!0}).pvMark.lock("data",function(section){return section.items;})[a_right](null)[a_bottom](null)[a_left](function(clientScene){for(var prevItem,index=this.index;index>0&&!(prevItem=this.scene[--index]).visible;);return prevItem&&prevItem.visible?prevItem[a_left]+prevItem[a_width]+clientScene.vars.itemPadding[a_width]:0;})[a_top](isHorizontal?function(itemScene){var vars=itemScene.vars;return vars.section.size.height/2-vars.itemClientSize.height/2;}:0).height(function(itemScene){return itemScene.vars.itemClientSize.height;}).width(isHorizontal?function(itemScene){return itemScene.vars.itemClientSize.width;}:function(){return this.parent.width();}),pvLegendMarkerPanel=new pvc.visual.Panel(this,pvLegendItemPanel,{extensionId:"markerPanel"}).pvMark.left(0).top(0).right(null).bottom(null).width(function(itemScene){return itemScene.vars.markerSize;}).height(function(itemScene){return itemScene.vars.itemClientSize.height;});if(def.debug>=20){pvLegendSectionPanel.strokeStyle("red").lineWidth(.5).strokeDasharray(".");pvLegendItemPanel.strokeStyle("green").lineWidth(.5).strokeDasharray(".");pvLegendMarkerPanel.strokeStyle("blue").lineWidth(.5).strokeDasharray(".");}
rootScene.childNodes.forEach(function(groupScene){var pvGroupPanel=new pvc.visual.Panel(this,pvLegendMarkerPanel).pvMark.visible(function(itemScene){return itemScene.parent===groupScene;});groupScene.renderer()(this,pvGroupPanel,wrapper);},this);this.pvLabel=new pvc.visual.Label(this,pvLegendMarkerPanel.anchor("right"),{extensionId:"label",noTooltip:!1,noClick:!1,wrapper:wrapper}).intercept("textStyle",function(itemScene){this._finished=!1;var baseTextStyle=this.delegateExtension()||"black";return this._finished||itemScene.isOn()?baseTextStyle:pvc.toGrayScale(baseTextStyle,null,void 0,150);}).pvMark.textAlign("left").text(function(itemScene){var text=itemScene.labelText(),vars=itemScene.vars;vars.textSize.width>vars.labelWidthMax&&(text=pvc.text.trimToWidthB(vars.labelWidthMax,text,vars.font,"..",!1));return text;}).textMargin(function(itemScene){return itemScene.vars.textMargin;}).font(function(itemScene){return itemScene.vars.font;}).textDecoration(function(itemScene){return itemScene.isOn()?"":"line-through";}).cursor(function(itemScene){return itemScene.executable()?"pointer":"default";});def.debug>=16&&pvLegendMarkerPanel.anchor("right").add(pv.Panel)[this.anchorLength()](0)[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).add(pv.Line).data(function(scene){var vars=scene.vars,labelBBox=pvc.text.getLabelBBox(Math.min(vars.labelWidthMax,vars.textSize.width),2*vars.textSize.height/3,"left","middle",0,vars.textMargin),corners=labelBBox.source.points();corners.length>1&&(corners=corners.concat(corners[0]));return corners;}).left(function(p){return p.x;}).top(function(p){return p.y;}).strokeStyle("red").lineWidth(.5).strokeDasharray("-");},_onClick:function(context){var scene=context.scene;def.fun.is(scene.execute)&&scene.executable()&&scene.execute();},_getExtensionPrefix:function(){return"legend";},_getExtensionId:function(){return"area";},_getRenderInteractiveMarks:function(){return[this.pvLegendPanel.parent];},_getRootScene:function(){var rootScene=this._rootScene;rootScene||(this._rootScene=rootScene=new pvc.visual.legend.LegendRootScene(null,{panel:this,source:this.chart.data,horizontal:this.isAnchorTopOrBottom(),font:this.font,markerSize:this.markerSize,textMargin:this.textMargin,itemPadding:this.itemPadding,itemSize:this.itemSize,itemCountMax:this.itemCountMax,overflow:this.overflow}));return rootScene;},_getTooltipFormatter:function(tipOptions){tipOptions.isLazy=!1;return function(context){var valueVar=context.scene.vars.value,valueText=valueVar.absLabel||valueVar.label;return valueText!==context.pvMark.text()?valueText:"";};}});def.type("pvc.visual.legend.LegendRootScene",pvc.visual.Scene).init(function(parent,keyArgs){this.base(parent,keyArgs);this._unresolvedMarkerDiam=def.get(keyArgs,"markerSize");this._unresolvedItemPadding=new pvc_Sides(def.get(keyArgs,"itemPadding",5));this._unresolvedItemSize=pvc_Size.to(def.get(keyArgs,"itemSize"))||new pvc_Size();this._itemCountMax=def.get(keyArgs,"itemCountMax");this._overflow=def.get(keyArgs,"overflow");def.set(this.vars,"horizontal",def.get(keyArgs,"horizontal",!1),"font",def.get(keyArgs,"font"),"textMargin",def.get(keyArgs,"textMargin",6)-3);}).add({layout:function(layoutInfo){function layoutItem(itemScene){var textSize=itemScene.labelTextSize(),hidden=!textSize||!textSize.width||!textSize.height;itemScene.isHidden=hidden;if(!hidden){var isFirstInSection,itemContentSize={width:textLeft+textSize.width,height:Math.max(textSize.height,markerDiam)},itemSize={width:desiredItemSize.width||itemPadding.width+itemContentSize.width,height:desiredItemSize.height||itemPadding.height+itemContentSize.height},itemClientSize={width:Math.max(0,itemSize.width-itemPadding.width),height:Math.max(0,itemSize.height-itemPadding.height)};if(section)isFirstInSection=!section.items.length;else{section=new pvc.visual.legend.LegendItemSceneSection(0);isFirstInSection=!0;}
var $newSectionWidth=section.size[a_width]+itemClientSize[a_width];isFirstInSection||($newSectionWidth+=itemPadding[a_width]);if(!isFirstInSection&&$newSectionWidth>$sectionWidthMax){commitSection(!1);$newSectionWidth=itemClientSize[a_width];}
var sectionSize=section.size;sectionSize[a_width]=$newSectionWidth;sectionSize[a_height]=Math.max(sectionSize[a_height],itemClientSize[a_height]);var sectionIndex=section.items.length;totalItemCount++;section.items.push(itemScene);def.set(itemScene.vars,"section",section,"sectionIndex",sectionIndex,"textSize",textSize,"itemSize",itemSize,"itemClientSize",itemClientSize,"itemContentSize",itemContentSize);}}
function commitSection(isLast){var sectionSize=section.size;contentSize[a_height]+=sectionSize[a_height];sections.length&&(contentSize[a_height]+=itemPadding[a_height]);contentSize[a_width]=Math.max(contentSize[a_width],sectionSize[a_width]);sections.push(section);isLast||(section=new pvc.visual.legend.LegendItemSceneSection(sections.length));}
var totalItemCount=0,clientSize=layoutInfo.clientSize;if(!(clientSize.width>0&&clientSize.height>0))return new pvc_Size(0,0);var clientSizeFix=layoutInfo.restrictions.clientSize;if(null!=clientSizeFix.width&&0==clientSizeFix.width||null!=clientSizeFix.height&&0==clientSizeFix.height)return new pvc_Size(0,0);var itemPadding=this._unresolvedItemPadding.resolve(clientSize),extClientSize={width:clientSize.width+itemPadding.width,height:clientSize.height+itemPadding.height},desiredItemSize=this._unresolvedItemSize.resolve(extClientSize),desiredItemClientSize={width:desiredItemSize.width&&Math.max(0,desiredItemSize.width-itemPadding.width),height:desiredItemSize.height&&Math.max(0,desiredItemSize.height-itemPadding.height)},markerDiam=this._unresolvedMarkerDiam||desiredItemClientSize.height||15;this.vars.itemPadding=itemPadding;this.vars.desiredItemSize=desiredItemSize;this.vars.desiredItemClientSize=desiredItemClientSize;this.vars.markerSize=markerDiam;var section,textLeft=markerDiam+this.vars.textMargin,labelWidthMax=Math.max(0,Math.min(desiredItemClientSize.width||1/0,clientSizeFix.width||1/0,clientSize.width)-textLeft),a_width=this.vars.horizontal?"width":"height",a_height=pvc.BasePanel.oppositeLength[a_width],sections=[],contentSize={width:0,height:0},sectionWidthFix=clientSizeFix[a_width],$sectionWidthMax=sectionWidthFix;(!$sectionWidthMax||$sectionWidthMax<0)&&($sectionWidthMax=clientSize[a_width]);this.childNodes.forEach(function(groupScene){groupScene.childNodes.forEach(layoutItem,this);},this);if(!section||"collapse"===this._overflow&&function(itemCountMax){return totalItemCount>itemCountMax;}(this._itemCountMax))return new pvc_Size(0,0);commitSection(!0);def.set(this.vars,"sections",sections,"contentSize",contentSize,"labelWidthMax",labelWidthMax);var isV1Compat=this.compatVersion()<=1,$w=isV1Compat?$sectionWidthMax:sectionWidthFix,$h=clientSizeFix[a_height];(!$w||$w<0)&&($w=contentSize[a_width]);(!$h||$h<0)&&($h=contentSize[a_height]);return"collapse"===this._overflow&&function(){var desiredWidth=clientSizeFix.width||1/0,desiredHeight=clientSizeFix.height||1/0;return Math.min(desiredWidth,clientSize.width)<contentSize.width||Math.min(desiredHeight,clientSize.height)<contentSize.height;}()?new pvc_Size(0,0):this.vars.size=def.set({},a_width,Math.min($w,clientSize[a_width]),a_height,Math.min($h,clientSize[a_height]));},defaultGroupSceneType:function(){var GroupType=this._groupType;if(!GroupType){GroupType=def.type(pvc.visual.legend.LegendGroupScene);this._groupType=GroupType;}
return GroupType;},createGroup:function(keyArgs){return new(this.defaultGroupSceneType())(this,keyArgs);}});def.type("pvc.visual.legend.LegendGroupScene",pvc.visual.Scene).init(function(rootScene,keyArgs){this.base(rootScene,keyArgs);this.legendBaseIndex=def.get(keyArgs,"legendBaseIndex")||0;this.colorAxis=def.get(keyArgs,"colorAxis");this.clickMode=def.get(keyArgs,"clickMode");!this.clickMode&&this.colorAxis&&(this.clickMode=this.colorAxis.option("LegendClickMode"));}).add({_rendererCreate:function(legendPanel,pvSymbolPanel,wrapper){var colorAxis=this.colorAxis;if(colorAxis){var dataPartDimName=colorAxis.chart._getDataPartDimName(),legendBaseIndex=this.legendBaseIndex,anyRenderer=!1;colorAxis.dataCells.forEach(function(dataCell,index){var renderer=dataCell.legendSymbolRenderer();if(renderer){anyRenderer=!0;var pvDataCellPanel=this._createDataCellPanel(dataCell,legendPanel,pvSymbolPanel,dataPartDimName);renderer(legendPanel,pvDataCellPanel,wrapper,def.indexedId("",legendBaseIndex+index));}},this);anyRenderer||this._createDefaultRendererPanel(legendPanel,pvSymbolPanel,wrapper,legendBaseIndex);}},_createDataCellPanel:function(dataCell,legendPanel,pvSymbolPanel,dataPartDimName){var pvDataCellPanel=new pvc.visual.Panel(legendPanel,pvSymbolPanel).pvMark,colorRole=dataCell.role,plot=dataCell.plot,isBoundDimensionCompatibleList=null;if(colorRole.grouping.hasExtensionComplexTypes){isBoundDimensionCompatibleList=colorRole.grouping.extensionDimensions().select(function(dimSpec){var measureRole,measureRoleName=pvc.visual.Role.parseDataSetName(dimSpec.dataSetName);if(null!==measureRoleName&&null!==(measureRole=plot.visualRole(measureRoleName)))return measureRole.isBoundDimensionCompatible.bind(measureRole);}).where(def.notNully).array();0===isBoundDimensionCompatibleList.length&&(isBoundDimensionCompatibleList=null);}
if(null!==dataPartDimName||null!==isBoundDimensionCompatibleList){var dataPartValue=dataCell.dataPartValue;pvDataCellPanel.visible(function(itemScene){var groupData=itemScene.group;if(groupData._disposed){def.log.warn("[CCC] FIXME: Code running on disposed scene!");return!1;}
if(null!==dataPartDimName&&null===groupData.dimensions(dataPartDimName).atom(dataPartValue))return!1;if(null!==isBoundDimensionCompatibleList)for(var i=-1,L=isBoundDimensionCompatibleList.length;++i<L;)if(!isBoundDimensionCompatibleList[i](groupData))return!1;return!0;});}
return pvDataCellPanel;},_createDefaultRendererPanel:function(legendPanel,pvSymbolPanel,wrapper,legendBaseIndex){var pvDefaultRendererPanel=new pvc.visual.Panel(legendPanel,pvSymbolPanel).pvMark,colorAxis=this.colorAxis,keyArgs={drawLine:colorAxis.option("LegendDrawLine"),drawMarker:colorAxis.option("LegendDrawMarker"),markerShape:colorAxis.option("LegendShape")};pvc.visual.legend.symbolRenderer(keyArgs)(legendPanel,pvDefaultRendererPanel,wrapper,def.indexedId("",legendBaseIndex));},hasRenderer:function(){return!!this._renderer;},renderer:function(_){if(arguments.length){_&&"object"==typeof _&&(_=pvc.visual.legend.symbolRenderer(_));this._renderer=_;return this;}
return this._renderer||(this._renderer=this._rendererCreate.bind(this));},itemSceneType:function(){var ItemType=this._itemSceneType;if(!ItemType){ItemType=def.type(pvc.visual.legend.LegendItemScene);switch(this.clickMode){case"toggleselected":ItemType.add(pvc.visual.legend.LegendItemSceneSelection);break;case"togglevisible":ItemType.add(pvc.visual.legend.LegendItemSceneVisibility);}
var legendPanel=this.panel();legendPanel._extendSceneType("item",ItemType,["isOn","executable","execute","value","labelText"]);var itemSceneExtIds=pvc.makeExtensionAbsId(pvc.makeExtensionAbsId("ItemScene",[this.extensionPrefix,"$"]),legendPanel._getExtensionPrefix()),impl=legendPanel.chart._getExtension(itemSceneExtIds,"value");void 0!==impl&&ItemType.variable("value",impl);this._itemSceneType=ItemType;}
return ItemType;},createItem:function(keyArgs){return new(this.itemSceneType())(this,keyArgs);}});def.type("pvc.visual.legend.LegendItemSceneSection").init(function(index){this.index=index;this.items=[];this.size={width:0,height:0};});def.type("pvc.visual.legend.LegendItemScene",pvc.visual.Scene).add({_ibits:null,ibits:function(){var ibits=this._ibits;if(null==ibits){if(this.executable())ibits=-1;else{var I=pvc.visual.Interactive;ibits=I.Interactive|I.ShowsInteraction|I.ShowsTooltip|I.Hoverable|I.SelectableAny;}
this._ibits=ibits;}
return ibits;},isOn:def.fun.constant(!0),executable:def.fun.constant(!1),execute:def.fun.constant(),labelText:function(){return this.value().label;},labelTextSize:function(){return pv.Text.measure(this.labelText(),this.vars.font);},_valueEval:function(){var valueVar=this._valueEvalCore();valueVar instanceof pvc_ValueLabelVar||(valueVar=new pvc_ValueLabelVar(valueVar,valueVar));return valueVar;},_valueEvalCore:function(){var value,rawValue,label,absLabel,trendSuffix,source=this.group||this.datum;if(source){value=source.value;rawValue=source.rawValue;trendSuffix=this._getTrendLineSuffix(source);label=source.ensureLabel()+trendSuffix;absLabel=source.absLabel?source.absLabel+trendSuffix:label;}
return new pvc_ValueLabelVar(value||null,label||"",rawValue,absLabel);},_getTrendLineSuffix:function(source){var datum,trendOptions;return(datum=source.firstDatum())&&(trendOptions=datum.trend)?" ("+trendOptions.label+")":"";}}).variable("value");def.type("pvc.visual.legend.LegendItemSceneSelection").add({isOn:function(){return!(this.group||this.datum).owner.selectedCount()||this.isSelected();},executable:function(){return this.chart().selectableByClick();},execute:function(){var datums=this.datums().array();if(datums.length){var me=this,chart=this.chart();chart._updatingSelections(function(){datums=chart._onUserSelection(datums,me.group||me.datum);datums&&datums.length&&cdo.Data.toggleSelected(datums,!0);});}}});def.type("pvc.visual.legend.LegendItemSceneVisibility").add({isOn:function(){var isOn=this._isOn;null==isOn&&(isOn=this._isOn=this.datums().any(function(datum){return!datum.isNull&&datum.isVisible;}));return isOn;},executable:function(){return def.lazy(this,"_execble",this._calcExecutable,this);},_calcExecutable:function(){if(this._executableApriori())for(var groupScene,groupScenes=this.root.childNodes,g=-1,G=groupScenes.length;++g<G;)if("togglevisible"===(groupScene=groupScenes[g]).clickMode)for(var item,items=groupScene.childNodes,i=-1,I=items.length;++i<I;)if((item=items[i])!==this&&item._executableApriori()&&item._hasAnyNonNullVisibleDatumsNotIn(this))return!0;return!1;},_hasAnyNonNullVisibleDatumsNotIn:function(otherScene){var group=otherScene.group;return this.datums().any(function(datum){return!datum.isNull&&datum.isVisible&&!group.contains(datum);});},_executableApriori:function(){return def.lazy(this,"_execApriori",this._calcExecutableApriori,this);},_calcExecutableApriori:function(){return this.datums().any(function(d){return!d.isTrend;});},execute:function(){if(cdo.Data.toggleVisible(this.datums())){this.clearCachedState();this.chart().render(!0,!0,!1);}},clearCachedState:function(){delete this._execble;delete this._isOn;delete this._execApriori;}});def.space("pvc.visual.legend").symbolRenderer=function(config){function createExtIds(id,legacyExtPrefixes){var legacyExtIds=pvc.makeExtensionAbsId(id,legacyExtPrefixes);return extPrefix?legacyExtIds.concat(pvc.makeExtensionAbsId(id,extPrefix)):legacyExtIds;}
function legendSymbolRenderer(legendPanel,pvSymbolPanel,wrapper,legacyLegendExtensionPrefix){var extensionTag=pvc.extensionTag,sceneColorProp=function(scene){return scene.color;},legacyExtPrefixes=["$",legacyLegendExtensionPrefix];if(drawLine){var rulePvBaseProto=new pv_Mark().left(0).top(function(){return this.parent.height()/2;}).width(function(){return this.parent.width();}).lineWidth(1,extensionTag).strokeStyle(sceneColorProp,extensionTag).cursor(function(itemScene){return itemScene.executable()?"pointer":"default";});rulePvProto&&(rulePvBaseProto=rulePvProto.extend(rulePvBaseProto));new pvc.visual.Rule(legendPanel,pvSymbolPanel,{proto:rulePvBaseProto,noSelect:!1,noHover:!1,activeSeriesAware:!1,extensionId:createExtIds("Rule",legacyExtPrefixes),showsInteraction:!0,wrapper:wrapper});}
if(drawMarker){var markerPvBaseProto=new pv_Mark().left(function(){return this.parent.width()/2;}).top(function(){return this.parent.height()/2;}).shapeSize(function(){return this.parent.width();},extensionTag).lineWidth(2,extensionTag).fillStyle(sceneColorProp,extensionTag).strokeStyle(sceneColorProp,extensionTag).shape(markerShape,extensionTag).angle(drawLine?0:Math.PI/2,extensionTag).antialias(function(){var cos=Math.abs(Math.cos(this.angle()));if(0!==cos&&1!==cos)switch(this.shape()){case"square":case"bar":return!1;}
return!0;},extensionTag).cursor(function(itemScene){return itemScene.executable()?"pointer":"default";});markerPvProto&&(markerPvBaseProto=markerPvProto.extend(markerPvBaseProto));new pvc.visual.Dot(legendPanel,pvSymbolPanel,{proto:markerPvBaseProto,freePosition:!0,activeSeriesAware:!1,noTooltip:!0,noClick:!0,extensionId:createExtIds("Dot",legacyExtPrefixes),wrapper:wrapper}).pvMark.pointingRadiusMax(0);}}
var markerShape,markerPvProto,drawLine=def.get(config,"drawLine",!1),drawMarker=!drawLine||def.get(config,"drawMarker",!0),rulePvProto=drawLine?def.get(config,"rulePvProto"):null,extPrefix=def.array.to(def.get(config,"extensionPrefix"));if(drawMarker){markerShape=def.get(config,"markerShape","square");markerPvProto=def.get(config,"markerPvProto");}
return legendSymbolRenderer;};var _mapAlign2TextAlignDirect={top:"left",bottom:"right",left:"left",right:"right",middle:"center",center:"center"},_mapAlign2TextAlignInverse={top:"right",bottom:"left",left:"right",right:"left",middle:"center",center:"center"},_textAngleByAnchor={top:0,right:Math.PI/2,bottom:0,left:-Math.PI/2};def.type("pvc.TitlePanelAbstract",pvc.BasePanel).init(function(chart,parent,options){options||(options={});var anchor=options.anchor||this.anchor;if(null==options.size){var size=options.titleSize;null!=size&&(options.size=new pvc_Size().setSize(size,{singleProp:this.anchorOrthoLength(anchor)}));}
if(null==options.sizeMax){var sizeMax=options.titleSizeMax;null!=sizeMax&&(options.sizeMax=new pvc_Size().setSize(sizeMax,{singleProp:this.anchorOrthoLength(anchor)}));}
null==options.paddings&&(options.paddings=this.defaultPaddings);this.base(chart,parent,options);if(void 0===options.font){var extensionFont=this._getExtension("label","font");"string"==typeof extensionFont&&(this.font=extensionFont);}}).add({pvLabel:null,anchor:"top",title:null,titleSize:void 0,font:"12px sans-serif",defaultPaddings:2,_extensionPrefix:"title",_calcLayout:function(layoutInfo){var clientSizeWant=new pvc_Size(),a=this.anchor,a_width=this.anchorLength(a),a_height=this.anchorOrthoLength(a),title=this.title||"",textWidth=pv.Text.measureWidth(title,this.font)+2,clientWidthAvailable=layoutInfo.clientSize[a_width],clientWidthFix=layoutInfo.restrictions.clientSize[a_width];null==clientWidthFix?clientWidthFix=textWidth>clientWidthAvailable?clientWidthAvailable:textWidth:clientWidthFix>clientWidthAvailable&&(clientWidthFix=clientWidthAvailable);var lines=title?textWidth>clientWidthFix?pvc.text.justify(title,clientWidthFix,this.font):[title]:[],lineHeight=pv.Text.fontHeight(this.font),realHeight=lines.length*lineHeight,clientHeightAvailable=layoutInfo.clientSize[a_height],clientHeightFix=layoutInfo.restrictions.clientSize[a_height];null==clientHeightFix?clientHeightFix=realHeight:clientHeightFix>clientHeightAvailable&&(clientHeightFix=clientHeightAvailable);if(realHeight>clientHeightFix){var lineCountMax=Math.max(1,Math.floor(clientHeightFix/lineHeight));if(lines.length>lineCountMax){var firstCroppedLine=lines[lineCountMax];lines.length=lineCountMax;realHeight=clientHeightFix=lineCountMax*lineHeight;var lastLine=lines[lineCountMax-1]+" "+firstCroppedLine;lines[lineCountMax-1]=pvc.text.trimToWidthB(clientWidthFix,lastLine,this.font,"..");}}
layoutInfo.lines=lines;layoutInfo.topOffset=(clientHeightFix-realHeight)/2;layoutInfo.lineSize={width:clientWidthFix,height:lineHeight};layoutInfo.a_width=a_width;layoutInfo.a_height=a_height;clientSizeWant[a_width]=clientWidthFix;clientSizeWant[a_height]=clientHeightFix;return clientSizeWant;},_createCore:function(layoutInfo){var wrapper,rootScene=this._buildScene(layoutInfo),isTopOrBottom=this.isAnchorTopOrBottom(),panelAlign=this.align,textAnchor=pvc.BasePanel.leftTopAnchor[this.anchor];this.compatVersion()<=1&&(wrapper=function(v1f){return function(itemScene){return v1f.call(this);};});this.pvLabel=new pvc.visual.Label(this,this.pvPanel,{extensionId:"label",wrapper:wrapper}).lock("data",rootScene.lineScenes).pvMark.textAngle(_textAngleByAnchor[this.anchor]).textAlign(function(){var a=this.textAngle();return((isTopOrBottom?Math.cos(a)>=0:Math.sin(a)>=0)?_mapAlign2TextAlignDirect:_mapAlign2TextAlignInverse)[panelAlign];})[textAnchor](function(lineScene){return layoutInfo.topOffset+lineScene.vars.size.height/2+this.index*lineScene.vars.size.height;})[this.anchorOrtho(textAnchor)](function(lineScene){switch(panelAlign){case"middle":case"center":return lineScene.vars.size.width/2;case"bottom":case"left":return 0;case"top":case"right":return lineScene.vars.size.width;}}).text(function(lineScene){return lineScene.vars.textLines[this.index];}).font(this.font).textBaseline("middle");},_buildScene:function(layoutInfo){var rootScene=new pvc.visual.Scene(null,{panel:this,source:this.chart.data}),textLines=layoutInfo.lines;rootScene.vars.size=layoutInfo.lineSize;rootScene.vars.textLines=textLines;rootScene.lineScenes=def.array.create(textLines.length,rootScene);return rootScene;},_getExtensionId:def.fun.constant("")});def.type("pvc.TitlePanel",pvc.TitlePanelAbstract).init(function(chart,parent,options){options||(options={});chart.compatVersion()<=1&&(null==options.titleSize&&(options.titleSize=25));this._extensionPrefix=chart.parent?"smallTitle":"title";this.base(chart,parent,options);}).add({font:"14px sans-serif",defaultPaddings:4});def.type("pvc.GridDockingPanel",pvc.ContentPanel).add({_getFillSizeMin:function(){return null;},_calcLayout:function(_layoutInfo){function phase0_initChild(child){var a=child.anchor;a&&("fill"===a?_fillChildren.push(child):_sideChildren.push(child));}
function phase1(){var layoutChange=0,sideChildrenSizes=new Array(_sideChildren.length),i=0;do{i++;_useLog&&_me.log.group("Iteration #"+i+" / 5");try{layoutChange=phase1_iteration(sideChildrenSizes,5===i);if(layoutChange&&0!=(layoutChange&OwnClientSizeChanged)){_useLog&&_me.log("Restarting due to clientSize increase.");return layoutChange;}}finally{_useLog&&_me.log.groupEnd();}}while(i<5&&0!=(layoutChange&MarginsChanged));for(var i=-1,count=_sideChildren.length,margins=new pvc_Sides(0);++i<count;){var child=_sideChildren[i];if(child.isVisible){var anchor=child.anchor,pos=margins[anchor]||0;child.position[anchor]=pos;positionSide(child,child.align);margins[anchor]=pos+sideChildrenSizes[i];}else{_sideChildren.splice(i,1);sideChildrenSizes.splice(i,1);count--;i--;}}
return 0;}
function phase1_iteration(sideChildrenSizes,isLastIteration){var layoutChange=0,canChangeChild=_canChangeInitial&&!isLastIteration;_contentOverflowOptional=null;_contentOverflow=new pvc_Sides(0);_hasContentOverflow=!1;for(var i=-1,L=_sideChildren.length;++i<L;){var child=_sideChildren[i];_useLog&&child.log.group("Layout");try{var anchor=child.anchor,p_alen=_alMap[anchor],p_aolen=_aolMap[anchor],olenPrev=sideChildrenSizes[i];if(null!=olenPrev){_margins[anchor]-=olenPrev;_fillSize[p_aolen]+=olenPrev;}
var sizeRef={width:null,height:null};sizeRef[p_alen]=_fillSize[p_alen];sizeRef[p_aolen]=_layoutInfo.clientSize[p_aolen];var sizeAvail=new pvc_Size(_fillSize);_fillSizeMin&&sizeAvail[p_alen]<_fillSizeMin[p_alen]&&(sizeAvail[p_alen]=_fillSizeMin[p_alen]);_childLayoutKeyArgs.sizeAvailable=sizeAvail;_childLayoutKeyArgs.sizeRef=sizeRef;_childLayoutKeyArgs.canChange=canChangeChild;child.layout(_childLayoutKeyArgs);var olen;if(child.isVisible){if(checkChildSizeIncreased(child,canChangeChild))return OwnClientSizeChanged;olen=null==olenPrev||Math.abs(child[p_aolen]-olenPrev)>pvc.roundPixel.epsilon?child[p_aolen]:olenPrev;}else olen=0;null!=olenPrev&&olen==olenPrev||(layoutChange|=MarginsChanged);sideChildrenSizes[i]=olen;if(olen){_margins[anchor]+=olen;_fillSize[p_aolen]-=olen;}
child.isVisible&&checkChildOptionalContentOverflowChanged(child,canChangeChild);}finally{_useLog&&child.log.groupEnd();}}
return layoutChange;}
function phase2(){var layoutChange=0,i=0;do{i++;_useLog&&_me.log.group("Iteration #"+i+" / 9");try{layoutChange=phase2_iteration(1===i,9===i);if(layoutChange&&0!=(layoutChange&OwnClientSizeChanged)){_useLog&&_me.log("Restarting due to clientSize increase.");return layoutChange;}}finally{_useLog&&_me.log.groupEnd();}}while(i<9&&0!=(layoutChange&ContentOverflowChanged));return 0;}
function phase2_iteration(isFirstIteration,isLastIteration){var canChangeChild=_canChangeInitial&&!isLastIteration,sideCount=_sideChildren.length,children=_sideChildren.concat(_fillChildren),i=-1,L=children.length;i<0&&(_contentOverflowOptional=null);for(;++i<L;){var child=children[i],isFill=i>=sideCount;_useLog&&child.log.group("Layout");try{phase2_layoutChild(child,canChangeChild,isFill);if(child.isVisible){if(checkChildSizeIncreased(child,canChangeChild))return OwnClientSizeChanged;if(checkChildContentOverflowChanged(child,canChangeChild))return ContentOverflowChanged;isFill||checkChildOptionalContentOverflowChanged(child,canChangeChild);if(isFill){positionSide(child,"center");positionSide(child,"middle");}else positionSide(child,child.align);}}finally{_useLog&&child.log.groupEnd();}}
return 0;}
function phase2_layoutChild(child,canChangeChild,isFill){var sizeAvail,sizeFix,sizeRef,pads;if(isFill){sizeAvail=pvc_Size.clone(_fillSize);sizeRef=_fillSize;pads=def.copyOwn(_contentOverflow);}else{var anchor=child.anchor,al=_alMap[anchor],aol=_aolMap[anchor];sizeFix={width:null,height:null};sizeFix[al]=_fillSize[al];sizeFix[aol]=child[aol];sizeRef={width:null,height:null};sizeRef[al]=_fillSize[al];sizeRef[aol]=_layoutInfo.clientSize[aol];pads=def.copyOwn(pvc_Sides.filterAnchor(anchor,_contentOverflow));}
_childLayoutKeyArgs.sizeAvailable=sizeAvail;_childLayoutKeyArgs.size=sizeFix;_childLayoutKeyArgs.sizeRef=sizeRef;_childLayoutKeyArgs.paddings=pads;_childLayoutKeyArgs.canChange=canChangeChild;child.layout(_childLayoutKeyArgs);}
function positionSide(child,anchorOrAlign){var pos,side;switch(anchorOrAlign){case"top":case"bottom":case"left":case"right":side=anchorOrAlign;pos=_margins[side];break;case"fill":case"middle":side="bottom";pos=_margins.bottom+_fillSize.height/2-child.height/2;break;case"center":side="left";pos=_margins.left+_fillSize.width/2-child.width/2;}
child.position[side]=pos;}
function checkChildSizeIncreased(child,canChangeChild){function checkDimension(a_len){var addLen=sizeIncrease[a_len];if(addLen>pvc.roundPixel.epsilon)if(canChangeChild){layoutChange|=OwnClientSizeChanged;_layoutInfo.clientSize[a_len]+=addLen;ownClientSizeIncrease[a_len]+=addLen;}else _useLog&&child.log.warn("Child wanted more "+a_len+", but layout iterations limit has been reached.");}
var layoutChange=0,sizeIncrease=child.getLayout().sizeIncrease;sizeIncrease&&("fill"===child.anchor?pvc_Size.names.forEach(checkDimension):checkDimension(child.anchorLength()));return layoutChange;}
function checkFillSizeMin(canChange){function checkDimension(a_len){var addLen=_fillSizeMin[a_len]-_fillSize[a_len];addLen-=ownClientSizeIncrease[a_len];if(addLen>pvc.roundPixel.epsilon)if(canChange){layoutChange|=OwnClientSizeChanged;_layoutInfo.clientSize[a_len]+=addLen;_useLog&&_me.log.warn("Increasing client "+a_len+" by "+addLen+" to satisfy minimum fill "+a_len+".");}else _useLog&&_me.log.warn("Wanted more fill "+a_len+", "+addLen+", but layout iterations limit has been reached.");}
var layoutChange=0;if(_fillSizeMin){checkDimension("width");checkDimension("height");}
return layoutChange;}
function checkChildContentOverflowChanged(child,canChangeChild){var layoutChange=0,contentOverflow=child._layoutInfo.contentOverflow;if(contentOverflow){_useLog&&child.log("ContentOverflow="+def.describe(contentOverflow));pvc_Sides.getAnchorSides(child.anchor).forEach(function(side){var value=_contentOverflow[side]||0,valueNew=contentOverflow[side]||0;if(valueNew-value>pvc.roundPixel.epsilon)if(canChangeChild){layoutChange|=ContentOverflowChanged;_contentOverflow[side]=valueNew;_useLog&&child.log("Changed content overflow: "+side+" <- "+valueNew);}else _useLog&&child.log.warn("CANNOT change but child wanted to: "+side+"="+valueNew);});layoutChange&&pvc_Sides.updateSize(_contentOverflow);}
return layoutChange;}
function checkChildOptionalContentOverflowChanged(child,canChangeChild){var contentOverflowOptional,layoutChange=0;if(_me.chart._preserveLayout||!(contentOverflowOptional=child._layoutInfo.contentOverflowOptional))return layoutChange;_useLog&&child.log("<= contentOverflowOptional="+def.describe(contentOverflowOptional));var ownPaddings=_layoutInfo.paddings,a_len=child.anchorLength();pvc_Sides.getAnchorSides(child.anchor).forEach(function(side){if(contentOverflowOptional.hasOwnProperty(side)){var value=ownPaddings[side]||0,childOverflow=contentOverflowOptional[side]||0,childLen=child._layoutInfo.size[a_len],fillOverflow=Math.max(0,childLen+childOverflow-_fillSize[a_len]),valueNew=Math.max(0,fillOverflow-_margins[side]);if(valueNew-value>pvc.roundPixel.epsilon)if(canChangeChild){layoutChange|=OptionalContentOverflowChanged;_contentOverflowOptional||(_contentOverflowOptional=new pvc_Sides(ownPaddings));_contentOverflowOptional[side]=Math.max(_contentOverflowOptional[side]||0,valueNew);_useLog&&child.log("Changed optional content overflow "+side+" <- "+valueNew);}else def.debug>=2&&child.log.warn("CANNOT change optional content overflow but child wanted to: "+side+"="+valueNew);}});return layoutChange;}
var _me=this;if(_me._children){var _contentOverflowOptional,_useLog=def.debug>=10,_canChangeInitial=!1!==_layoutInfo.restrictions.canChange,_aolMap=pvc.BasePanel.orthogonalLength,_alMap=pvc.BasePanel.parallelLength,ContentOverflowChanged=2,OptionalContentOverflowChanged=4,OwnClientSizeChanged=8,MarginsChanged=16,_childLayoutKeyArgs={force:!0},_margins=new pvc_Sides(0),_fillSize=def.copyOwn(_layoutInfo.clientSize),_fillSizeMin=this._getFillSizeMin();_fillSizeMin&&(_fillSizeMin=_fillSizeMin.resolve(null));var ownClientSizeIncrease={width:0,height:0},_contentOverflow=new pvc_Sides(0),_hasContentOverflow=!1,_fillChildren=[],_sideChildren=[];_useLog&&_me.log.group("CCC GRID LAYOUT");try{!function(){var layoutChange=0;try{_me._children.forEach(phase0_initChild);}finally{}
_useLog&&_me.log.group("Phase 1 - Determine MARGINS and FILL SIZE from SIDE panels");try{layoutChange=phase1();}finally{if(_useLog){_me.log("Final FILL margins = "+def.describe(_margins));_me.log("Final FILL border size = "+def.describe(_fillSize));_me.log.groupEnd();}}
layoutChange|=checkFillSizeMin(_canChangeInitial);if(!layoutChange){_useLog&&_me.log.group("Phase 2 - Determine COMMON PADDINGS");try{layoutChange=phase2();}finally{if(_useLog){_me.log("Final COMMON paddings  = "+def.describe(_contentOverflow));_me.log("Final FILL client size = "+def.describe({width:(_fillSize.width||0)-(_contentOverflow.width||0),height:(_fillSize.height||0)-(_contentOverflow.height||0)}));_me.log.groupEnd();}}}
_canChangeInitial&&!layoutChange&&_contentOverflowOptional&&(_layoutInfo.contentOverflow=_contentOverflowOptional);}();}finally{_useLog&&_me.log.groupEnd();}
_layoutInfo.gridMargins=pvc_Sides.updateSize(_margins);_layoutInfo.gridPaddings=pvc_Sides.updateSize(_contentOverflow);_layoutInfo.gridSize=new pvc_Size(_fillSize);return _layoutInfo.clientSize;}}});def.type("pvc.BaseChart",pvc.Abstract).add(pvc.visual.Interactive).add(def.EventSource).init(function(options){var originalOptions=options,parent=this.parent=def.get(options,"parent")||null;if(parent)options||def.fail.argumentRequired("options");else{pvc_initChartClassDefaults&&pvc_initChartClassDefaults();options=def.mixin.copy({},this.defaults,options);}
this.options=options;if(parent){this.root=parent.root;this.smallColIndex=options.smallColIndex;this.smallRowIndex=options.smallRowIndex;}else{this.root=this;this._format=cdo.format.language().createChild();}
this.base();def.debug>=3&&this.log.info("NEW CHART\n"+def.logSeparator.replace(/-/g,"=")+"\n  DebugLevel: "+def.debug);if(def.debug>=3&&!parent&&originalOptions){this.log.info("OPTIONS:\n",originalOptions);def.debug>=5&&this.log.debug(def.describe(originalOptions,{ownOnly:!1,funs:!0}));}
parent&&parent._addChild(this);this._constructData(options);this._constructVisualRoles(options);this._constructPlots(options);}).add({_disposed:!1,parent:null,children:null,root:null,isCreated:!1,_createVersion:0,renderCallback:void 0,left:0,top:0,width:null,height:null,margins:null,paddings:null,_allowV1SecondAxis:!1,_preserveLayout:!1,compatVersion:function(options){return(options||this.options).compatVersion;},getCompatFlag:function(flagName){return this.options.compatFlags[flagName];},_createLogId:function(){return""+def.qualNameOf(this.constructor)+this._createLogChildSuffix();},_createLogChildSuffix:function(){return this.parent?" ("+(this.smallRowIndex+1)+","+(this.smallColIndex+1)+")":"";},_addChild:function(childChart){childChart.parent===this||def.assert("Not a child of this chart.");this.children.push(childChart);},_savePlotsLayout:function(){if(this.options.preserveLayout&&this.plotPanelList&&this.plotPanelList.length){this._preservedPlotsLayoutInfo={};this.plotPanelList.forEach(function(plotPanel){this._preservedPlotsLayoutInfo[plotPanel.plot.id]=plotPanel._getLayoutState();},this);this._preserveLayout=!0;}},_create:function(keyArgs){this._createPhase1(keyArgs);this._createPhase2();},_createPhase1:function(keyArgs){this._createVersion++;this.isCreated=!1;def.debug>=3&&this.log("Creating");var isRoot=!this.parent,isMultiChartOverflowRetry=this._isMultiChartOverflowClipRetry,isRootInit=isRoot&&!isMultiChartOverflowRetry&&!this.data;this._savePlotsLayout();isRoot&&(this.children=[]);this.plotPanels={};this.plotPanelList=[];isRoot&&isMultiChartOverflowRetry||this._processOptions();if(!isMultiChartOverflowRetry){if(isRootInit){this._processDataOptions(this.options);if(!this.allowNoData&&!this.resultset.length)throw new pvc.NoDataException();this._initVisualRoles();this._initPlots();this._createComplexTypeAndBindVisualRoles();this._bindPlotsEnd();}
this._initAxes();if(isRoot){this._initData(keyArgs);if(!this.allowNoData&&!this.data.count())throw new pvc.NoDataException();}
this._initAxesEnd();}
if(isRoot){var hasMultiRole=this.visualRoles.multiChart.isBound();hasMultiRole&&this._initMultiCharts();if(!isMultiChartOverflowRetry){this._interpolate(hasMultiRole);this._generateTrends(hasMultiRole);}}
this._setAxesScales(this._chartLevel());},_createPhase2:function(){this._initChartPanels();this.isCreated=!0;},_setSmallLayout:function(keyArgs){function setProp(p){var v=keyArgs[p];if(null!=v)return me[p]=v,!0;}
if(keyArgs){var me=this,basePanel=me.basePanel;setProp("left")|setProp("top")&&basePanel&&def.set(basePanel.position,"left",this.left,"top",this.top);setProp("width")|setProp("height")&&basePanel&&(basePanel.size=new pvc_Size(this.width,this.height));setProp("margins")&&basePanel&&(basePanel.margins=new pvc_Sides(this.margins));setProp("paddings")&&basePanel&&(basePanel.paddings=new pvc_Sides(this.paddings));}},_processOptions:function(){var plotSpecs,options=this.options;if(!this.parent){this.width=options.width;this.height=options.height;this.margins=options.margins;this.paddings=options.paddings;}
this.compatVersion()<=1?options.plot2=this._allowV1SecondAxis&&!!options.secondAxis:!options.plot2&&(plotSpecs=options.plots)&&(options.plot2=def.array.is(plotSpecs)?def.query(plotSpecs).where(function(plotSpec){return"plot2"===plotSpec.name;}).any():!!plotSpecs.plot2);this._processFormatOptions(options);this._processOptionsCore(options);this._processExtensionPoints();return options;},_processOptionsCore:function(options){var parent=this.parent;if(parent){ibits=parent.ibits();this._tooltipOptions=parent._tooltipOptions;this._pointingOptions=parent._pointingOptions;}else{var interactive="batik"!==pv.renderer();interactive&&null==(interactive=options.interactive)&&(interactive=!0);var ibits=0;if(interactive){var I=pvc.visual.Interactive;ibits=I.Interactive|I.ShowsInteraction;this._processTooltipOptions(options)&&(ibits|=I.ShowsTooltip);options.animate&&$.support.svg&&(ibits|=I.Animatable);var preventUnselect=!1;if(options.selectable){ibits|=I.Selectable;switch(pvc.parseSelectionMode(options.selectionMode)){case"rubberbandorclick":ibits|=I.SelectableByRubberband|I.SelectableByClick;break;case"rubberband":ibits|=I.SelectableByRubberband;break;case"click":ibits|=I.SelectableByClick;break;case"focuswindow":ibits|=I.SelectableByFocusWindow;preventUnselect=!0;}}
preventUnselect||"emptyspaceclick"!==pvc.parseClearSelectionMode(options.clearSelectionMode)||(ibits|=I.Unselectable);options.hoverable&&(ibits|=I.Hoverable);options.clickable&&(ibits|=I.Clickable|I.DoubleClickable);this._processPointingOptions(options);var evs;(evs=options.on)&&this.on(evs);(evs=options.before)&&this.before(evs);(evs=options.after)&&this.after(evs);}}
this._ibits=ibits;},_pointingDefaults:{radius:10,radiusHyst:4,stealClick:!0,collapse:"none"},_tooltipDefaults:{gravity:"s",animate:void 0,delayIn:200,delayOut:80,offset:2,opacity:.9,html:!0,fade:!0,useCorners:!1,arrowVisible:!0,followMouse:!1,format:void 0,className:""},_processTooltipOptions:function(options){var isV1Compat=this.compatVersion()<=1,tipOptions=options.tooltip,tipEnabled=options.tooltipEnabled;if(null==tipEnabled){tipOptions&&(tipEnabled=tipOptions.enabled);if(null==tipEnabled){isV1Compat&&(tipEnabled=options.showTooltips);null==tipEnabled&&(tipEnabled=!0);}}
if(tipEnabled){tipOptions=tipOptions?def.copy(tipOptions):{};isV1Compat&&this._importV1TooltipOptions(tipOptions,options);def.eachOwn(this._tooltipDefaults,function(dv,p){var value=options["tooltip"+def.firstUpperCase(p)];void 0!==value?tipOptions[p]=value:void 0===tipOptions[p]&&(tipOptions[p]=dv);});}
this._tooltipOptions=tipOptions||{};return tipEnabled;},_importV1TooltipOptions:function(tipOptions,options){var v1TipOptions=options.tipsySettings;if(v1TipOptions){this.extend(v1TipOptions,"tooltip");for(var p in v1TipOptions)void 0===tipOptions[p]&&(tipOptions[p]=v1TipOptions[p]);null==tipOptions.html&&(tipOptions.html=!1);}},_processPointingOptions:function(options){var pointingOptions=options.pointing,pointingMode=options.pointingMode;if(null==pointingMode){pointingOptions&&(pointingMode=pointingOptions.mode);pointingMode||(pointingMode="near");}
pointingOptions=pointingOptions?def.copyOwn(pointingOptions):{};pointingOptions.mode=pvc.parsePointingMode(pointingMode);def.eachOwn(this._pointingDefaults,function(dv,p){void 0===pointingOptions[p]&&(pointingOptions[p]=dv);});pointingOptions.collapse=pvc.parsePointingCollapse(pointingOptions.collapse);pointingOptions.painted=!0;this._pointingOptions=pointingOptions||{};},_processFormatOptions:function(options){if(!this.parent){var format=options.format;null!=format&&this.format(format);var fp=this._format;this._processFormatOption(options,fp,"number","valueFormat");this._processFormatOption(options,fp,"percent","percentValueFormat");}},_processFormatOption:function(options,formatProvider,formatName,optionName){var format=formatProvider[formatName]();if(format!==cdo.format.defaults[formatName]())options[optionName]=format;else{var optionFormat=options[optionName];if(optionFormat&&optionFormat!==format){if(!optionFormat._nullWrapped){options[optionName]=optionFormat=pv.Format.createFormatter(optionFormat);optionFormat._nullWrapped=1;}
formatProvider[formatName](optionFormat);}}},_processDataOptions:function(options){function processDataOption(globalName,localName,dv){var v=options[globalName];void 0!==v?dataOptions[localName]=null==v||""===v?dv:v:null!=dv&&void 0===dataOptions[localName]&&(dataOptions[localName]=dv);}
var dataOptions=options.dataOptions||(options.dataOptions={});processDataOption("dataSeparator","separator","~");processDataOption("dataMeasuresInColumns","measuresInColumns");processDataOption("dataCategoriesCount","categoriesCount");processDataOption("dataIgnoreMetadataLabels","ignoreMetadataLabels");processDataOption("dataWhere","where");processDataOption("dataTypeCheckingMode","typeCheckingMode");var plot2Series,plot2SeriesIndexes,plot2=options.plot2;if(plot2){if(this._allowV1SecondAxis&&this.compatVersion()<=1)plot2SeriesIndexes=options.secondAxisIdx;else{plot2Series=options.plot2Series?def.array.as(options.plot2Series):null;if(!plot2Series||!plot2Series.length){plot2Series=null;plot2SeriesIndexes=options.plot2SeriesIndexes;}}
plot2Series||(plot2SeriesIndexes=def.parseDistinctIndexArray(plot2SeriesIndexes,-1/0)||-1);}
options.plot2Series=plot2Series;options.plot2SeriesIndexes=plot2SeriesIndexes;dataOptions.measuresIndex=dataOptions.measuresIndex||dataOptions.measuresIdx;dataOptions.measuresCount=dataOptions.measuresCount||dataOptions.numMeasures;},format:function(_){var r=this.root;if(r!==this)return r.format.apply(r,arguments);var v1=this._format;if(arguments.length){if(!_)throw def.error.argumentRequired("format");if(_!==v1){if(!def.is(_,cdo.format)){if(v1)return def.configure(v1,_),this;_=cdo.format(_);}
this._format=_;}
return this;}
return v1;},_getPerformanceMeasurementPrefix:function(){return this.options.measurePerformance&&"undefined"!=typeof performance?"ccc-chart-render"+("string"!=typeof this.options.canvas?"-"+this.options.canvas:""):null;},_calcPerformanceMeasurementStats:function(measures){var count=measures.length,average=measures.reduce(function(total,measure){return total+measure.duration;},0)/count,deviation=Math.sqrt(measures.reduce(function(total,measure){return total+def.sqr(measure.duration-average);},0)/count);return{last:measures[count-1].duration,count:count,average:average,deviation:deviation};},render:function(keyArgs){var hasError,bypassAnimation,recreate,reloadData,addData,dataOnRecreate,renderError=null,measurePerformancePrefix=this._getPerformanceMeasurementPrefix();if(1===arguments.length&&keyArgs&&"object"==typeof keyArgs){bypassAnimation=!!keyArgs.bypassAnimation;recreate=!!keyArgs.recreate;dataOnRecreate=recreate?keyArgs.dataOnRecreate:null;reloadData="reload"===dataOnRecreate;addData="add"===dataOnRecreate;}else{bypassAnimation=!!arguments[0];recreate=arguments[1];reloadData=arguments[2];addData=!1;}
if(null!==measurePerformancePrefix){performance.clearMarks();performance.mark(measurePerformancePrefix+"-start");}
def.debug>1&&this.log.group("CCC RENDER");this._lastRenderError=null;this._suspendSelectionUpdate();try{this.useTextMeasureCache(function(){try{this._renderCore(recreate,reloadData,addData,bypassAnimation);}catch(e){renderError=e;if(e instanceof pvc.NoDataException)this._addErrorPanelMessage(e.message,"noDataMessage");else if(e instanceof pvc.InvalidDataException)this._addErrorPanelMessage(e.message,"invalidDataMessage");else{hasError=!0;this.log.error(e.message);def.debug>0&&this._addErrorPanelMessage("Error: "+e.message,"errorMessage");}}});}finally{this._lastRenderError=renderError;this._isMultiChartOverflowClipRetry=!1;hasError||this._resumeSelectionUpdate();def.debug>1&&this.log.groupEnd();if(null!==measurePerformancePrefix){performance.mark(measurePerformancePrefix+"-end");performance.measure(measurePerformancePrefix,measurePerformancePrefix+"-start",measurePerformancePrefix+"-end");var stats=this._calcPerformanceMeasurementStats(performance.getEntriesByName(measurePerformancePrefix));console.info("CCC RENDER latest: %s ms / average: %s ms / deviation: %s / count: %d",stats.last.toFixed(2),stats.average.toFixed(2),stats.deviation.toFixed(2),stats.count);}}
return this;},_renderCore:function(recreate,reloadData,addData,bypassAnimation){for(;;){this.parent||pvc.removeTipsyLegends();!recreate&&this.isCreated||this._create({reloadData:reloadData,addData:addData});this.basePanel.render({bypassAnimation:bypassAnimation,recreate:recreate});if(!this._isMultiChartOverflowClip)break;recreate=!0;reloadData=!1;this._isMultiChartOverflowClipRetry=!0;this._isMultiChartOverflowClip=!1;}},renderPages:function(){this.options.interactive=!1;this.options.multiChartOverflow="page";this.render();if(!this.getLastRenderError()){var pvRootPanel=this.basePanel&&this.basePanel.pvRootPanel,canvas=pvRootPanel&&pvRootPanel.canvas();if(canvas){var nextPageStartIndex=this.getNextPageStartIndex();if(!(nextPageStartIndex<0)){this.options.smallWidth=this._multiInfo.smallWidth;this.options.smallHeight=this._multiInfo.smallHeight;var rootElems=[canvas.childNodes[0]];do{this.__disposeRootPanel();pv.removeChildren(canvas);this.options.multiChartStart=nextPageStartIndex;this.render({recreate:!0,dataOnRecreate:null,bypassAnimation:!0});if(this.getLastRenderError())return;rootElems.push(canvas.childNodes[0]);nextPageStartIndex=this.getNextPageStartIndex();}while(nextPageStartIndex>=0);this.__disposeRootPanel();pv.removeChildren(canvas);for(var i=-1,L=rootElems.length;++i<L;)canvas.appendChild(rootElems[i]);}}}},getLastRenderError:function(){return this._lastRenderError;},getNextPageStartIndex:function(){var multiInfo=this._multiInfo;return multiInfo&&!multiInfo.isLastPage?multiInfo.pageStartIndex+multiInfo.pageSmallCount:-1;},renderResize:function(width,height){var canResizeWidth=null!=width,canResizeHeight=null!=height;if(!canResizeWidth&&!canResizeHeight)return this;var basePanel=this.basePanel;if(basePanel){canResizeWidth&&(canResizeWidth=width!==basePanel.width);canResizeHeight&&(canResizeHeight=height!==basePanel.height);var prevLayoutInfo,sizeIncrease;if((prevLayoutInfo=basePanel.getLayout())&&(sizeIncrease=prevLayoutInfo.sizeIncrease)){canResizeWidth&&(canResizeWidth=!sizeIncrease.width||width>basePanel.width);canResizeHeight&&(canResizeHeight=!sizeIncrease.height||height>basePanel.height);if(!canResizeWidth&&!canResizeHeight)return this;}}
canResizeWidth?this.options.width=width:basePanel&&(this.options.width=this.width);canResizeHeight?this.options.height=height:basePanel&&(this.options.height=this.height);return this.render(!0,!0,!1);},_addErrorPanelMessage:function(text,extensionId){def.debug>1&&this.log(text);if(!extensionId||!1!==this._getExtension(extensionId,"visible")){var options=this.options,pvPanel=new pv.Panel().canvas(options.canvas).width(this.width).height(this.height),pvMsg=pvPanel.anchor("center").add(pv.Label).text(text);extensionId&&this.extend(pvMsg,extensionId);pvPanel.render();}},useTextMeasureCache:function(fun,ctx){var root=this.root,textMeasureCache=root._textMeasureCache||(root._textMeasureCache=pv.Text.createCache());return pv.Text.usingCache(textMeasureCache,fun,ctx||this);},animate:function(start,end){return this.basePanel.animate(start,end);},animatingStart:function(){return this.basePanel.animatingStart();},animating:function(){return!!this.basePanel&&this.basePanel.animating();},isOrientationVertical:function(orientation){return(orientation||this.options.orientation)===pvc.orientation.vertical;},isOrientationHorizontal:function(orientation){return(orientation||this.options.orientation)===pvc.orientation.horizontal;},dispose:function(){if(!this._disposed){this._disposed=!0;this.__disposeRootPanel();}},__disposeRootPanel:function(){var pvRootPanel=this.basePanel&&this.basePanel.pvRootPanel,tipsy=pv.Behavior.tipsy;tipsy&&tipsy.disposeAll&&tipsy.disposeAll(pvRootPanel);pvRootPanel&&pvRootPanel.dispose();},defaults:{width:400,height:300,orientation:"vertical",ignoreNulls:!0,crosstabMode:!0,isMultiValued:!1,seriesInRows:!1,groupedLabelSep:void 0,animate:!0,titlePosition:"top",titleAlign:"center",legend:!1,legendPosition:"bottom",slidingWindow:!1,v1StyleTooltipFormat:function(s,c,v,datum){return s+", "+c+":  "+this.chart.options.valueFormat(v)+(datum&&datum.percent?" ("+datum.percent.label+")":"");},clickable:!1,doubleClickMaxDelay:300,hoverable:!1,selectable:!1,selectionMode:"rubberbandOrClick",ctrlSelectMode:!0,clearSelectionMode:"emptySpaceClick",compatVersion:1/0,compatFlags:{discreteTimeSeriesTickFormat:!0}}});var pvc_initChartClassDefaults=function(){var defaults=pvc.BaseChart.prototype.defaults;defaults.valueFormat||(defaults.valueFormat=cdo.format.defaults.number());defaults.percentValueFormat||(defaults.percentValueFormat=cdo.format.defaults.percent());pvc_initChartClassDefaults=null;};pvc.BaseChart.add({visualRoles:null,visualRoleList:null,_measureVisualRoles:null,_constructVisualRoles:function(){var parent=this.parent;if(parent){this.visualRoles=parent.visualRoles;this.visualRoleList=parent.visualRoleList;}},_initVisualRoles:function(){if(!this.parent){this.visualRoles={};this.visualRoleList=[];this._createChartVisualRoles();}},_addVisualRole:function(name,keyArgs){keyArgs=def.set(keyArgs,"index",this.visualRoleList.length);var role=new pvc.visual.Role(this,name,keyArgs),names=[name];role.plot||names.push("$."+name);return this._addVisualRoleCore(role,names);},_addVisualRoleCore:function(role,names){names||(names=role.name);this.visualRoleList.push(role);def.array.is(names)?names.forEach(function(name){this.visualRoles[name]=role;},this):this.visualRoles[names]=role;return role;},_createChartVisualRoles:function(){this._addVisualRole("multiChart",{defaultDimension:"multiChart*",requireIsDiscrete:!0});this._addVisualRole("dataPart",{defaultDimension:"dataPart",requireIsDiscrete:!0,requireSingleDimension:!0,dimensionDefaults:{isHidden:!0,comparer:def.compare}});},visualRole:function(roleName){var role=def.getOwn(this.visualRoles,roleName);if(!role)throw def.error.operationInvalid("roleName","There is no visual role with name '{0}'.",[roleName]);return role;},measureVisualRoles:function(){return this.parent?this.parent.measureVisualRoles():this._measureVisualRoles||(this._measureVisualRoles=this.visualRoleList.filter(function(role){return role.isMeasureEffective;}));},measureDimensionsNames:function(){return def.query(this.measureVisualRoles()).selectMany(function(role){return role.grouping.dimensionNames();}).distinct().array();},visualRolesOf:function(mainDimName,includePlotLevel){var visualRolesByDim=this._visRolesByDim;if(!visualRolesByDim){visualRolesByDim={};!!this._dataType&&(this._visRolesByDim=visualRolesByDim);this.visualRoleList.forEach(function(role){if(includePlotLevel||!role.plot){var grouping=role.grouping||role.preBoundGrouping();grouping&&grouping.dimensionNames().forEach(function(dimName){def.array.lazy(visualRolesByDim,dimName).push(role);});}});}
return def.getOwn(visualRolesByDim,mainDimName,null);},_getDataPartDimName:function(useDefault){var preGrouping,role=this.visualRoles.dataPart;return role.isBound()?role.grouping.singleDimensionName:(preGrouping=role.preBoundGrouping())?preGrouping.firstDimension&&preGrouping.firstDimension.name:useDefault?role.defaultDimensionGroup:null;},_processViewSpec:function(viewSpec){if(!viewSpec.dimsKeys)if(viewSpec.role){var role=this.visualRoles[viewSpec.role],grouping=role&&role.grouping;if(grouping){viewSpec.dimNames=grouping.allDimensionNames.slice().sort();viewSpec.dimsKey=viewSpec.dimNames.join(",");}}else{if(!viewSpec.dims)throw def.error.argumentInvalid("viewSpec","Invalid view spec. No 'role' or 'dims' property.");viewSpec.dimNames=viewSpec_normalizeDims(viewSpec.dims);viewSpec.dimsKey=String(viewSpec.dimNames);}},getBoundDimensionsDataSetOf:function(visualRole){if(!visualRole.isMeasure)throw new Error("Visual role is not isMeasure.");var boundDimsDataSetMap=def.lazy(this.root,"_boundDimsDataSetsMap"),data=boundDimsDataSetMap[visualRole.boundDimensionsDataSetName];if(!data){var complexType=new cdo.ComplexType({dim:{isKey:!0,valueType:String,isHidden:!0}});data=new cdo.Data({type:complexType});boundDimsDataSetMap[visualRole.boundDimensionsDataSetName]=data;}
return data;},getBoundDimensionsComplexTypeOf:function(visualRole){return this.getBoundDimensionsDataSetOf(visualRole).type;},_boundDimsDataSetsMap:null,get boundDimensionsDataSetsMap(){return this.root._boundDimsDataSetsMap||null;},get boundDimensionsComplexTypesMap(){var complexTypesMap=null,boundDimsDataSets=this.boundDimensionsDataSetsMap;boundDimsDataSets&&def.eachOwn(boundDimsDataSets,function(dataSet,dataSetName){complexTypesMap||(complexTypesMap=Object.create(null));complexTypesMap[dataSetName]=dataSet.type;});return complexTypesMap;}});pvc.BaseChart.add({dataEngine:null,data:null,_partsDataCache:null,_visibleDataCache:null,resultset:[],metadata:[],_constructData:function(options){if(this.parent){this.dataEngine=this.data=options.data||def.fail.argumentRequired("options.data");this.slidingWindow=this.parent.slidingWindow;def.debug>=3&&this.log(this.data.getInfo());}},_createComplexTypeAndBindVisualRoles:function(){var options=this.options,commonDimOptions=this._createCommonDimensionsOptions(options),complexTypeProj=this._createNewComplexTypeProject(),binder=pvc.visual.rolesBinder().logger(this._createNewLogger()).context(this._createNewVisualRolesContext()).complexTypeProject(complexTypeProj);binder.init();var dataPartDimName=this._getDataPartDimName(!0);this._maybeAddPlot2SeriesDataPartCalc(complexTypeProj,dataPartDimName)||!this.visualRoles.dataPart.isPreBound()&&this.plots.trend&&complexTypeProj.setDim(dataPartDimName);if(this.metadata.length){this._createTranslation(complexTypeProj,commonDimOptions,dataPartDimName);this._translation.configureType();def.debug>=3&&this.log(this._translation.logLogicalRow());}
complexTypeProj.hasDim(dataPartDimName)&&!complexTypeProj.isReadOrCalc(dataPartDimName)&&this._addDefaultDataPartCalculation(complexTypeProj,dataPartDimName);binder.dimensionsFinished();var complexType=new cdo.ComplexType(null,{formatProto:this._format});complexTypeProj.configureComplexType(complexType,commonDimOptions);this._willBindVisualRoles(complexType);def.debug>=3&&this.log(complexType.describe());binder.bind(complexType);this._dataType=complexType;},_willBindVisualRoles:function(complexType){this._createSlidingWindow(complexType);},_getPreBoundTrendedDimensionNames:function(){return def.query(this.plotList).selectMany(def.propGet("dataCellList")).where(def.propGet("trend")).selectMany(function(dataCell){if(dataCell.role.isPreBound())return dataCell.role.preBoundGrouping().dimensionNames();}).distinct().array();},_createSlidingWindow:function(complexType){var slidingWindow=null;if(this.options.slidingWindow){slidingWindow=new pvc.visual.SlidingWindow(this);if(slidingWindow.length){slidingWindow.setDimensionsOptions(complexType);slidingWindow.setLayoutPreservation(this);}else slidingWindow=null;}
this.slidingWindow=slidingWindow;},_initData:function(ka){var data=this.data;if(data)if(def.get(ka,"reloadData",!0))this._reloadData(!1);else{data.disposeChildren();data.clearVirtuals();def.get(ka,"addData",!1)&&this._reloadData(!0);}else this._createAndLoadData();delete this._partsDataCache;delete this._visibleDataCache;def.debug>=3&&this.log(this.data.getInfo());},_createAndLoadData:function(){var data=new cdo.Data({type:this._dataType,labelSep:this.options.groupedLabelSep,keySep:this.options.dataOptions.separator});this.data=data;this.dataEngine=data;if(this.slidingWindow){this.slidingWindow.initFromOptions();this.slidingWindow.setDataFilter(data);}
this._translation&&this._loadDataCore(!1);},_reloadData:function(isAdditive){if(this._translation){this._translation.setSource(this.resultset);this._loadDataCore(isAdditive);}},_loadDataCore:function(isAdditive){def.debug>=3&&this.log(this._translation.logSource());var readQuery=this._translation.execute(this.data),loadKeyArgs={isAdditive:isAdditive,where:this.options.dataOptions.where,isNull:this._getIsNullDatum()};this.data.load(readQuery,loadKeyArgs);},_createNewVisualRolesContext:function(){var chart=this,options=this.options,chartRolesOptions=options.visualRoles,roles=this.visualRoles,roleList=this.visualRoleList,context=function(rn){return def.getOwn(roles,rn);};context.query=function(){return def.query(roleList);};context.getOptions=function(r){var v,opts,U,plot=r.plot,name=r.name;if(!plot||plot.isMain){if((v=options[name+"Role"])!==U)return v;if(chartRolesOptions&&(v=chartRolesOptions[name])!==U)return v;}
if(plot&&(opts=plot._visualRolesOptions))return opts[name];};context.getExtensionComplexTypesMap=function(){return chart.boundDimensionsComplexTypesMap;};return context;},_createNewLogger:function(){function logger(){me.log.apply(me,arguments);}
var me=this;logger.level=function(){return def.debug;};return logger;},_createNewComplexTypeProject:function(){var options=this.options,complexTypeProj=new cdo.ComplexTypeProject(options.dimensionGroups),userDimsSpec=options.dimensions;for(var dimName in userDimsSpec)complexTypeProj.setDim(dimName,userDimsSpec[dimName]);var calcSpecs=options.calculations;calcSpecs&&calcSpecs.forEach(complexTypeProj.setCalc,complexTypeProj);return complexTypeProj;},_getIsNullDatum:function(){var measureDimNames,M,me=this;return function(datum){if(!measureDimNames){measureDimNames=me.measureDimensionsNames();M=measureDimNames.length;}
if(!M)return!1;for(var atoms=datum.atoms,i=0;i<M;i++)if(null!=atoms[measureDimNames[i]].value)return!1;return!0;};},_createTranslation:function(complexTypeProj,dimsOptions,dataPartDimName){var translOptions=this._createTranslationOptions(dimsOptions,dataPartDimName),TranslationClass=this._getTranslationClass(translOptions),translation=new TranslationClass(complexTypeProj,this.resultset,this.metadata,translOptions);def.debug>=3&&this.log(translation.logTranslatorType());this._translation=translation;},_getTranslationClass:function(translOptions){return translOptions.crosstabMode?cdo.CrosstabTranslationOper:cdo.RelationalTranslationOper;},_createCommonDimensionsOptions:function(options){return{isCategoryTimeSeries:options.timeSeries,formatProto:this._format,timeSeriesFormat:options.timeSeriesFormat};},_createTranslationOptions:function(dimsOptions,dataPartDimName){var options=this.options,dataOptions=options.dataOptions;return def.create(dimsOptions,{compatVersion:this.compatVersion(),plot2DataSeriesIndexes:options.plot2SeriesIndexes,seriesInRows:options.seriesInRows,crosstabMode:options.crosstabMode,isMultiValued:options.isMultiValued,dataPartDimName:dataPartDimName,readers:options.readers,measuresIndexes:options.measuresIndexes,multiChartIndexes:options.multiChartIndexes,ignoreMetadataLabels:dataOptions.ignoreMetadataLabels,typeCheckingMode:pvc.parseDataTypeCheckingMode(dataOptions.typeCheckingMode),separator:dataOptions.separator,measuresInColumns:dataOptions.measuresInColumns,categoriesCount:dataOptions.categoriesCount,measuresIndex:dataOptions.measuresIndex,measuresCount:dataOptions.measuresCount});},_maybeAddPlot2SeriesDataPartCalc:function(complexTypeProj,dataPartDimName){if(this.compatVersion()<=1)return!1;var options=this.options,serRole=this.visualRoles.series,plot2Series=serRole?options.plot2Series:null;if(!plot2Series)return!1;var mainSeriesDimNames,dataPartDim,part1Atom,part2Atom,buildSeriesKey,plot2SeriesSet=def.query(plot2Series).uniqueIndex(),hasOwnProp=def.hasOwnProp,init=function(datum){if(serRole.isBound()){mainSeriesDimNames=serRole.grouping.dimensionNames();dataPartDim=datum.owner.dimensions(dataPartDimName);if(mainSeriesDimNames.length>1)buildSeriesKey=cdo.Complex.compositeKey;else{mainSeriesDimNames=mainSeriesDimNames[0];buildSeriesKey=function(dat,mainSeriesDimName){return dat.atoms[mainSeriesDimName].key;};}}
init=null;};complexTypeProj.setCalc({names:dataPartDimName,calculation:function(datum,atoms){init&&init(datum);if(dataPartDim){var seriesKey=buildSeriesKey(datum,mainSeriesDimNames);atoms[dataPartDimName]=hasOwnProp.call(plot2SeriesSet,seriesKey)?part2Atom||(part2Atom=dataPartDim.intern("1")):part1Atom||(part1Atom=dataPartDim.intern("0"));}}});return!0;},_addDefaultDataPartCalculation:function(complexTypeProj,dataPartDimName){var dataPartDim,part1Atom;complexTypeProj.setCalc({names:dataPartDimName,calculation:function(datum,atoms){dataPartDim||(dataPartDim=datum.owner.dimensions(dataPartDimName));atoms[dataPartDimName]=part1Atom||(part1Atom=dataPartDim.intern("0"));}});},partData:function(dataPartValues,baseData){baseData||(baseData=this.data);if(null==dataPartValues)return baseData;var rootChart=this.root,partRole=rootChart.visualRoles.dataPart;if(!partRole||!partRole.isBound())return baseData;var cacheKey="\0"+baseData.id+":"+def.nullyTo(dataPartValues,""),partitionedDataCache=def.lazy(rootChart,"_partsDataCache"),partData=partitionedDataCache[cacheKey];if(!partData){partData=rootChart._createPartData(baseData,partRole,dataPartValues);partitionedDataCache[cacheKey]=partData;}
return partData;},_createPartData:function(baseData,partRole,dataPartValues){var dataPartDimName=partRole.grouping.singleDimensionName,dataPartAtoms=baseData.dimensions(dataPartDimName).getDistinctAtoms(def.array.to(dataPartValues)),where=cdo.querySpecPredicate([def.set({},dataPartDimName,dataPartAtoms)]);return baseData.where(null,{where:where});},visibleData:function(ka){var mainPlot=this.plots.main||def.fail.operationInvalid("There is no main plot defined.");return this.visiblePlotData(mainPlot,ka);},visiblePlotData:function(plot,ka){var rootChart=this.root,baseData=def.get(ka,"baseData")||this.data,inverted=!!def.get(ka,"inverted",!1),ignoreNulls=!(!rootChart.options.ignoreNulls&&!def.get(ka,"ignoreNulls",!0)),cacheKey=[plot.id,baseData.id,inverted,ignoreNulls].join("|"),cache=def.lazy(rootChart,"_visibleDataCache"),data=cache[cacheKey];if(!data){var partData=rootChart.partData(plot.dataPartValue,baseData),ka2={visible:!0,inverted:inverted,isNull:!ignoreNulls&&null};data=cache[cacheKey]=plot.createData(partData,ka2);}
return data;},_initMultiCharts:function(){var chart=this;chart.multiOptions=new pvc.visual.MultiChart(chart);chart.smallOptions=new pvc.visual.SmallChart(chart);var isLastPage,pageSmallCount,colCount,rowCount,colCountMax,multiOption=chart.multiOptions.option,data=chart.visualRoles.multiChart.flatten(chart.data,{visible:!0,isNull:null}),smallDatas=data.childNodes,pageStartIndex=multiOption("Start");if(chart._isMultiChartOverflowClipRetry){rowCount=chart._clippedMultiChartRowCountMax;colCount=chart._clippedMultiChartColCountMax;colCountMax=colCount;pageSmallCount=rowCount*colCount;isLastPage=!1;}else{isLastPage=!0;var smallChartCountEf=Math.min(smallDatas.length,multiOption("Max")),remainingSmallChartCount=Math.max(0,smallChartCountEf-pageStartIndex);if(0===remainingSmallChartCount)colCount=rowCount=colCountMax=pageSmallCount=0;else{colCountMax=multiOption("ColumnsMax");colCount=Math.min(remainingSmallChartCount,colCountMax);colCount>=1&&isFinite(colCount)||def.assert("Must be at least 1 and finite");rowCount=Math.ceil(remainingSmallChartCount/colCount);rowCount>=1||def.assert("Must be at least 1");pageSmallCount=remainingSmallChartCount;}}
chart._multiInfo={pageStartIndex:pageStartIndex,pageSmallCount:pageSmallCount,isLastPage:isLastPage,smallDatas:smallDatas,rowCount:rowCount,colCount:colCount,colCountMax:colCountMax,smallWidth:null,smallHeight:null};},interpolatable:function(){var plotList=this.plotList;return!!plotList&&plotList.some(function(p){return p.interpolatable();});},_interpolate:function(hasMultiRole){if(this.interpolatable()){var dataCells=def.query(this.axesList).selectMany(def.propGet("dataCells")).where(function(dataCell){var nim=dataCell.nullInterpolationMode;return!!nim&&"none"!==nim;}).distinct(function(dataCell){return[dataCell.nullInterpolationMode,dataCell.role.grouping.key,dataCell.dataPartValue||""].join();}).array();this._eachLeafDatasAndDataCells(hasMultiRole,dataCells,function(dataCell,baseData){dataCell.plot.interpolateDataCell(dataCell,baseData);});}},_generateTrends:function(hasMultiRole){if(this._getDataPartDimName()&&this.plots.trend){var dataCells=def.query(this.axesList).selectMany(def.propGet("dataCells")).where(def.propGet("trend")).distinct(function(dataCell){return dataCell.role.prettyId()+"|"+(dataCell.dataPartValue||"");}).array(),newDatums=[];this._eachLeafDatasAndDataCells(hasMultiRole,dataCells,function(dataCell,baseData){dataCell.plot.generateTrendsDataCell(newDatums,dataCell,baseData);});newDatums.length>0&&this.data.owner.add(newDatums);}},_eachLeafDatasAndDataCells:function(hasMultiRole,dataCells,fun,ctx){var dataCellCount=dataCells.length;if(dataCellCount){var leafDatas,smallCount,startIndex;if(hasMultiRole){var multiInfo=this._multiInfo;leafDatas=multiInfo.smallDatas;smallCount=multiInfo.pageSmallCount;startIndex=multiInfo.pageStartIndex;}else{leafDatas=[this.data];smallCount=1;startIndex=0;}
for(var smallIndex=0;smallIndex<smallCount;smallIndex++)for(var leafData=leafDatas[startIndex+smallIndex],dataCellIndex=0;dataCellIndex<dataCellCount;dataCellIndex++)fun.call(ctx,dataCells[dataCellIndex],leafData);}},_getTrendDataPartAtom:function(){var dataPartDimName=this._getDataPartDimName();if(dataPartDimName)return this.data.owner.dimensions(dataPartDimName).intern("trend");},setData:function(data,options){this.setResultset(data&&data.resultset);this.setMetadata(data&&data.metadata);$.extend(this.options,options);return this;},setResultset:function(resultset){!this.parent||def.fail.operationInvalid("Can only set resultset on root chart.");this.resultset=resultset||[];this.resultset.length||this.log.warn("Resultset is empty");return this;},setMetadata:function(metadata){!this.parent||def.fail.operationInvalid("Can only set metadata on root chart.");this.metadata=metadata||[];this.metadata.length||this.log.warn("Metadata is empty");return this;}});pvc.BaseChart.add({_constructPlots:function(){var parent=this.parent;if(parent){this.plots=parent.plots;this.plotList=parent.plotList;this.plotsByType=parent.plotsByType;this._dataCellsByAxisTypeThenIndex=this.parent._dataCellsByAxisTypeThenIndex;}},_initPlots:function(){this.plots={};this.plotList=[];this.plotsByType={};this._createPlotsInternal();var trendPlotDefExt=this._defPlotsExternal();this._initPlotTrend(trendPlotDefExt);this._initPlotsEnd();},_createPlotsInternal:function(){},_defPlotsExternal:function(){var trendPlotDefExt,plots=this.plots,plotDefs=this.options.plots;plotDefs&&plotDefs.forEach(function(plotDef){if(plotDef){var name=plotDef.name;"trend"===name?trendPlotDefExt=plotDef:("plot2"!==name||plots.plot2)&&this._defPlotExternal(name,plotDef);}},this);return trendPlotDefExt;},_initPlotTrend:function(trendPlotDefExt){if(this.plotList.some(function(p){return p.option.isDefined("Trend")&&!!p.option("Trend");})){this._createPlotTrend();trendPlotDefExt&&this.plots.trend&&this._defPlotExternal("trend",trendPlotDefExt);}},_defPlotExternal:function(name,plotSpec){var plot,type=plotSpec.type;if(name){name=def.firstLowerCase(name);plot=this.plots&&this.plots[name];if(plot&&type&&type!==plot.type)throw def.error.argumentInvalid("plots","Plot named '{0}' is already defined and is of a different type: '{1}'",[name,plot.type]);}
plot?plot.processSpec(plotSpec):this._addPlot(this._createPlotExternal(name,type,plotSpec));},_createPlotExternal:function(name,type,plotSpec){if(!type)throw def.error.argumentInvalid("plots","Plot 'type' option is required.");var PlotClass=pvc.visual.Plot.getClass(type);if(!PlotClass)throw def.error.argumentInvalid("plots","The plot type '{0}' is not defined.",[type]);return new PlotClass(this,{name:name,isInternal:!1,spec:plotSpec});},_createPlotTrend:function(){},_addPlot:function(plot){var plots=this.plots,index=plot.index,name=plot.name,id=plot.id;if(name&&def.hasOwn(plots,name))throw def.error.operationInvalid("Plot name '{0}' already taken.",[name]);if(def.hasOwn(plots,id))throw def.error.operationInvalid("Plot id '{0}' already taken.",[id]);var typePlots=def.array.lazy(this.plotsByType,plot.type);if(def.hasOwn(typePlots,index))throw def.error.operationInvalid("Plot index '{0}' of type '{1}' already taken.",[index,plot.type]);plot.globalIndex=this.plotList.length;var isMain=!plot.globalIndex;typePlots[index]=plot;this.plotList.push(plot);plots[id]=plot;name&&(plots[name]=plot);isMain&&(plots.main=plot);},_initPlotsEnd:function(){this.plotList.forEach(function(plot){plot.initEnd();this._registerPlotVisualRoles(plot);},this);},_registerPlotVisualRoles:function(plot){var plotName=plot.name,plotId=plot.id,isMain=plot.isMain;plot.visualRoleList.forEach(function(role){var roleName=role.name,names=[];if(isMain){roleName in this.visualRoles||names.push(roleName);names.push("main."+roleName);}
names.push(plotId+"."+roleName);plotName&&names.push(plotName+"."+roleName);this._addVisualRoleCore(role,names);},this);},_bindPlotsEnd:function(){if(this.plotList.length>0){var hasBoundPlot=!1;this.plotList.forEach(function(plot){plot.bindEnd();!hasBoundPlot&&plot.isBound&&(hasBoundPlot=!0);});hasBoundPlot||this.plotList[0].assertBound();}}});pvc.BaseChart.add({colors:null,axes:null,axesList:null,axesByType:null,_axisClassByType:{color:pvc.visual.ColorAxis,size:pvc.visual.SizeAxis},_axisCreateChartLevel:{color:1,size:2,base:3,ortho:3},_axisSetScaleChartLevel:{color:1,size:2,base:2,ortho:2},_axisCreationOrder:["color","size","base","ortho"],_axisCreateIfUnbound:{},_chartLevel:function(){var level=0;this.parent||(level|=1);!this.parent&&this.visualRoles.multiChart.isBound()||(level|=2);return level;},_initAxes:function(){var axesState,oldByType=this.axesByType;if(this.axes){axesState={};this.axesList.forEach(function(axis){axesState[axis.id]=axis.getState();});}
var getAxisState=function(type,axisIndex){if(oldByType&&axesState){var axes=oldByType[type];if(axes)return axesState[axes[axisIndex].id];}};this.axes={};this.axesList=[];this.axesByType={};delete this._rolesColorScale;var dataCellsByAxisTypeThenIndex=this._dataCellsByAxisTypeThenIndex;if(!this.parent){dataCellsByAxisTypeThenIndex={};this.plotList.forEach(function(plot){plot.dataCellList.forEach(function(dataCell){if(dataCell.role.isBound()){var dataCellsByAxisIndex=def.array.lazy(dataCellsByAxisTypeThenIndex,dataCell.axisType);def.array.lazy(dataCellsByAxisIndex,dataCell.axisIndex).push(dataCell);}});});this._dataCellsByAxisTypeThenIndex=dataCellsByAxisTypeThenIndex;}
var chartLevel=this._chartLevel();this._axisCreationOrder.forEach(function(axisType){if(0!=(this._axisCreateChartLevel[axisType]&chartLevel)){var AxisClass,dataCellsOfTypeByIndex=dataCellsByAxisTypeThenIndex[axisType];if(dataCellsOfTypeByIndex){AxisClass=this._getAxisClass(axisType);dataCellsOfTypeByIndex.forEach(function(dataCells){dataCells=dataCells.filter(function(dataCell){return!dataCell.plot||(this.parent?dataCell.plot.isDataBoundOn(this.data):dataCell.plot.isBound);},this);if(dataCells.length>0){var axisIndex=dataCells[0].axisIndex;new AxisClass(this,axisType,axisIndex,{state:getAxisState(axisType,axisIndex)});}},this);}
if(!this.axesByType[axisType]&&this._axisCreateIfUnbound[axisType]){AxisClass=this._getAxisClass(axisType);new AxisClass(this,axisType,0);}}},this);this.parent&&this.root.axesList.forEach(function(axis){def.hasOwn(this.axes,axis.id)||this._addAxis(axis);},this);def.eachOwn(dataCellsByAxisTypeThenIndex,function(dataCellsOfTypeByIndex,type){0!=(this._axisCreateChartLevel[type]&chartLevel)&&dataCellsOfTypeByIndex.forEach(function(dataCells){dataCells=dataCells.filter(function(dataCell){return!dataCell.plot||(this.parent?dataCell.plot.isDataBoundOn(this.data):dataCell.plot.isBound);},this);if(dataCells.length>0){var axisIndex=dataCells[0].axisIndex,axis=this.axes[def.indexedId(type,axisIndex)];axis.isBound()||axis.bind(dataCells);}},this);},this);},_getAxisClass:function(axisType){return this._axisClassByType[axisType]||pvc.visual.Axis;},_initAxesEnd:function(){this.slidingWindow&&this.slidingWindow.setAxesDefaults(this);},_addAxis:function(axis){this.axes[axis.id]=axis;this.axesList.push(axis);var typeAxes=def.array.lazy(this.axesByType,axis.type),typeIndex=typeAxes.count||0;axis.typeIndex=typeIndex;typeAxes[axis.index]=axis;typeIndex||(typeAxes.first=axis);typeAxes.count=typeIndex+1;"color"===axis.type&&axis.isBound()&&this._onColorAxisScaleSet(axis);return this;},_getAxis:function(type,index){var typeAxes;if(null!=index&&+index>=0&&(typeAxes=this.axesByType[type]))return typeAxes[index];},_setAxesScales:function(chartLevel){this.axesList.forEach(function(axis){this._axisSetScaleChartLevel[axis.type]&chartLevel&&axis.isBound()&&this._setAxisScale(axis,chartLevel);},this);},_setAxisScale:function(axis,chartLevel){this._setAxisScaleByScaleType(axis);},_setAxisScaleByScaleType:function(axis){switch(axis.scaleType){case"discrete":this._setDiscreteAxisScale(axis);break;case"numeric":this._setNumericAxisScale(axis);break;case"timeSeries":this._setTimeSeriesAxisScale(axis);break;default:throw def.error("Unknown axis scale type.");}},_describeScale:function(axis,scale){scale.isNull&&def.debug>=3&&this.log(def.format("{0} scale for axis '{1}' - no data",[axis.scaleType,axis.id]));},_setDiscreteAxisScale:function(axis){if("color"===axis.type)return this._setDiscreteColorAxisScale(axis);var values=axis.domainValues(),scale=new pv.Scale.ordinal();values.length?scale.domain(values):scale.isNull=!0;this._describeScale(axis,scale);axis.setScale(scale);},_setTimeSeriesAxisScale:function(axis){var extent=this._getContinuousVisibleExtentConstrained(axis),scale=new pv.Scale.linear();if(extent){var dMin=extent.min,dMax=extent.max;!function(){var d=dMax-dMin;if(d&&Math.abs(d)<1){dMax=dMin=new Date(Math.round((dMin+dMax)/2));d=0;}
if(d)d<0&&(!extent.maxLocked||extent.minLocked?dMax=new Date(dMin.getTime()+pvc.time.intervals.h):dMin=new Date(dMax.getTime()-pvc.time.intervals.h));else{extent.minLocked||(dMin=new Date(dMin.getTime()-pvc.time.intervals.h));extent.maxLocked&&!extent.minLocked||(dMax=new Date(dMax.getTime()+pvc.time.intervals.h));}}();scale.domain(dMin,dMax);scale.minLocked=extent.minLocked;scale.maxLocked=extent.maxLocked;}else scale.isNull=!0;this._describeScale(axis,scale);axis.setScale(scale);},_setNumericAxisScale:function(axis){if("color"===axis.type)return this._setNumericColorAxisScale(axis);var extent=this._getContinuousVisibleExtentConstrained(axis),scale=new pv.Scale.linear();if(extent){var dMin=extent.min,dMax=extent.max,normalize=function(){var d=dMax-dMin;if(d&&Math.abs(d)<=1e-10){dMin=(dMin+dMax)/2;dMin=dMax=+dMin.toFixed(10);d=0;}
if(!d){extent.minLocked||(dMin>1e-10?dMin*=.99:dMin<-1e-10?dMin*=1.01:dMin=-.1);extent.maxLocked&&!extent.minLocked||(dMax>1e-10?dMax*=1.01:dMax<-1e-10?dMax*=.99:dMax=.1);}};normalize();if(!extent.lengthLocked&&axis.option.isDefined("OriginIsZero")&&axis.option("OriginIsZero"))if(0===dMin)extent.minLocked=!0;else if(0===dMax)extent.maxLocked=!0;else if(dMin*dMax>0){if(dMin>0){if(!extent.minLocked){extent.minLocked=!0;dMin=0;}}else if(!extent.maxLocked){extent.maxLocked=!0;dMax=0;}
normalize();}
scale.domain(dMin,dMax);scale.minLocked=extent.minLocked;scale.maxLocked=extent.maxLocked;}else scale.isNull=!0;this._describeScale(axis,scale);axis.setScale(scale);},_warnSingleContinuousValueRole:function(valueRole){valueRole.grouping.isSingleDimension||this.log.warn("A linear scale can only be obtained for a single dimension role.");valueRole.grouping.isDiscrete()&&this.log.warn(def.format("The single dimension of role '{0}' should be continuous.",[valueRole.name]));},_getContinuousVisibleExtentConstrained:function(axis){var dim,me=this,opts=axis.option,read=function(v){dim||(dim=me.data.owner.dimensions(axis.role.grouping.firstDimension.name));return dim.read(v).value;},readLimit=function(name){if(!opts.isDefined(name))return null;var v=opts(name);return null!=v?read(v):v;},length=opts.isDefined("FixedLength")?opts("FixedLength"):null,min=null,max=null,minLocked=!1,maxLocked=!1;if(null!=(min=readLimit("FixedMin"))){minLocked=!0;if(length){max=+min+length;maxLocked=!0;}}
if(null==max&&null!=(max=readLimit("FixedMax"))){maxLocked=!0;if(length){min=max-length;minLocked=!0;}}
if(null==min||null==max){var dataExtent=this._getContinuousVisibleExtent(axis);if(!dataExtent)return null;if(length)switch(opts("DomainAlign")){case"min":min=dataExtent.min;max=+min+length;break;case"max":max=dataExtent.max;min=max-length;break;default:var center=dataExtent.max-(dataExtent.max-dataExtent.min)/2;min=center-length/2;max=center+length/2;}else{null==min&&(min=dataExtent.min);null==max&&(max=dataExtent.max);}}
if(axis.scaleUsesAbs()){min<0&&(min=-min);max<0&&(max=-max);}
if(+min>+max){var temp=min;min=max;max=temp;}
return{min:read(min),max:read(max),minLocked:minLocked,maxLocked:maxLocked,lengthLocked:null!=length};},_getContinuousVisibleExtent:function(valueAxis){var dataCells=valueAxis.dataCells;if(1===dataCells.length){var valueDataCell=dataCells[0];return valueDataCell.plot.getContinuousVisibleCellExtent(this,valueAxis,valueDataCell);}
return def.query(dataCells).select(function(dataCell){return dataCell.plot.getContinuousVisibleCellExtent(this,valueAxis,dataCell);},this).reduce(pvc.unionExtents,null);},_setDiscreteColorAxisScale:function(axis){var scale=axis.scheme()(axis.domainValues());this._describeScale(axis,scale);axis.setScale(scale,!0);this._onColorAxisScaleSet(axis);},_setNumericColorAxisScale:function(axis){if(1!==axis.dataCells.length)throw def.error("Can't handle multiple continuous data cells in color axis.");this._warnSingleContinuousValueRole(axis.role);var visibleDomainData=this.visiblePlotData(axis.dataCell.plot),normByCateg=axis.option("NormByCategory"),scaleOptions={type:axis.option("ScaleType"),colors:axis.option("Colors")().range(),colorDomain:axis.option("Domain"),colorMin:axis.option("Min"),colorMax:axis.option("Max"),colorMissing:axis.option("Missing"),data:visibleDomainData,colorDimension:axis.role.grouping.singleDimensionName,normPerBaseCategory:normByCateg};if(normByCateg)axis.scalesByCateg=pvc_colorScales(scaleOptions);else{var scale=pvc_colorScale(scaleOptions);this._describeScale(axis,scale);axis.setScale(scale);}
this._onColorAxisScaleSet(axis);},_onColorAxisScaleSet:function(axis){switch(axis.index){case 0:this.colors=axis.scheme();break;case 1:this._allowV1SecondAxis&&(this.secondAxisColor=axis.scheme());}},_getRoleColorScale:function(grouping){return def.lazy(def.lazy(this,"_rolesColorScale"),grouping.key,this._createRoleColorScale,this);},_createRoleColorScale:function(groupingKey){function addDomainValue(value){var key=""+value;def.hasOwnProp.call(valueToColorMap,key)||(valueToColorMap[key]=scale(value));}
var firstScale,scale,valueToColorMap={};this.axesByType.color.forEach(function(axis){var axisRole=axis.role;if(axisRole&&axis.scale&&"discrete"===axis.scaleType&&axisRole.grouping.key===groupingKey&&0===axis.index||axis.option.isSpecified("Colors")||axis.option.isSpecified("Map")){scale=axis.scale;firstScale||(firstScale=scale);axis.domainValues().forEach(addDomainValue);}},this);if(!firstScale)return pvc.createColorScheme()();scale=function(value){var key=""+value;return def.hasOwnProp.call(valueToColorMap,key)?valueToColorMap[key]:valueToColorMap[key]=firstScale(value);};def.copy(scale,firstScale);return scale;},_onLaidOut:function(){}});pvc.BaseChart.add({basePanel:null,contentPanel:null,titlePanel:null,legendPanel:null,_multiChartPanel:null,_initChartPanels:function(){var hasMultiRole=this.visualRoles.multiChart.isBound(),isRoot=!this.parent;this._initBasePanel();this._initTitlePanel();if(isRoot){var legendPanel=this._initLegendPanel();hasMultiRole&&this._initMultiChartPanel();legendPanel&&this._initLegendScenes(legendPanel);}
if(!(isRoot&&hasMultiRole)){var o=this.options;this.contentPanel=this._createContentPanel(this.basePanel,{margins:hasMultiRole?o.smallContentMargins:o.contentMargins,paddings:hasMultiRole?o.smallContentPaddings:o.contentPaddings});this._createContent(this.contentPanel,{clickAction:o.clickAction,doubleClickAction:o.doubleClickAction});}},_initBasePanel:function(){var p=this.parent;p||this._setActiveScene(null,!0);this.__disposeRootPanel();this.basePanel=new pvc.BasePanel(this,p&&p._multiChartPanel,{margins:this.margins,paddings:this.paddings,size:{width:this.width,height:this.height}});},_initTitlePanel:function(){var o=this.options,title=o.title,titleVisible=o.titleVisible;null==titleVisible&&(titleVisible=!def.empty(title));if(titleVisible){var state,titlePanel=this.titlePanel;titlePanel&&this._preserveLayout&&(state=titlePanel._getLayoutState());this.titlePanel=new pvc.TitlePanel(this,this.basePanel,{title:title,font:o.titleFont,anchor:o.titlePosition,align:o.titleAlign,alignTo:o.titleAlignTo,offset:o.titleOffset,keepInBounds:o.titleKeepInBounds,margins:state?state.margins:o.titleMargins,paddings:state?state.paddings:o.titlePaddings,titleSize:state?state.size:o.titleSize,titleSizeMax:o.titleSizeMax});}},_initLegendPanel:function(){var o=this.options,legendAreaVisible=o.legendAreaVisible;null==legendAreaVisible&&(legendAreaVisible=o.legend);if(legendAreaVisible){var state,legend=new pvc.visual.Legend(this,"legend",0),legendPanel=this.legendPanel;legendPanel&&this._preserveLayout&&(state=legendPanel._getLayoutState());return this.legendPanel=new pvc.LegendPanel(this,this.basePanel,{anchor:legend.option("Position"),align:legend.option("Align"),alignTo:o.legendAlignTo,offset:o.legendOffset,keepInBounds:o.legendKeepInBounds,size:state?state.size:legend.option("Size"),margins:state?state.margins:legend.option("Margins"),paddings:state?state.paddings:legend.option("Paddings"),sizeMax:legend.option("SizeMax"),font:legend.option("Font"),scenes:def.getPath(o,"legend.scenes"),textMargin:o.legendTextMargin,itemPadding:o.legendItemPadding,itemSize:legend.option("ItemSize"),itemCountMax:legend.option("ItemCountMax"),overflow:legend.option("Overflow"),markerSize:o.legendMarkerSize});}},_getLegendRootScene:function(){return this.legendPanel&&this.legendPanel._getRootScene();},_initMultiChartPanel:function(){var basePanel=this.basePanel,options=this.options;this.contentPanel=this._multiChartPanel=new pvc.MultiChartPanel(this,basePanel,{margins:options.contentMargins,paddings:options.contentPaddings});this._multiChartPanel.createSmallCharts();basePanel._children.unshift(basePanel._children.pop());},_coordinateSmallChartsLayout:function(){},_registerInitLegendScenes:function(handler){def.array.lazy(this,"_initLegendScenesHandlers").push(handler);},_initLegendScenes:function(legendPanel){this._initLegendScenesHandlers&&this._initLegendScenesHandlers.forEach(function(f){f(legendPanel);});var colorAxes=this.axesByType.color;if(colorAxes){var rootScene,dataPartDimName=this._getDataPartDimName(),legendGroupBaseIndex=0,getRootScene=function(){return rootScene||(rootScene=legendPanel._getRootScene());};colorAxes.forEach(function(colorAxis){null!==this._maybeCreateLegendGroupScene(colorAxis,getRootScene,legendGroupBaseIndex,dataPartDimName)&&(legendGroupBaseIndex+=colorAxis.dataCells.length);},this);}},_maybeCreateLegendGroupScene:function(colorAxis,getRootScene,legendGroupBaseIndex,dataPartDimName){if(!colorAxis.option("LegendVisible")||!colorAxis.isBound()||!colorAxis.isDiscrete())return null;var visibleDataCells=colorAxis.dataCells.filter(function(dataCell){return dataCell.legendVisible();});if(0===visibleDataCells.length)return null;var colorScale=colorAxis.scale,visibleDataCellsByDataPart=null!==dataPartDimName?def.query(visibleDataCells).uniqueIndex(function(dataCell){return dataCell.dataPartValue;}):null,groupScene=getRootScene().createGroup({source:colorAxis.domainData(),colorAxis:colorAxis,legendBaseIndex:legendGroupBaseIndex}),dataCellsWithExtensionComplexTypesToCheck=null;def.query(visibleDataCells).each(function(dataCell){if(!dataCell.role.grouping.hasExtensionComplexTypes){dataCellsWithExtensionComplexTypesToCheck=null;return!1;}
null===dataCellsWithExtensionComplexTypesToCheck&&(dataCellsWithExtensionComplexTypesToCheck=[]);dataCellsWithExtensionComplexTypesToCheck.push(dataCell);});colorAxis.domainItems().forEach(function(itemData){if(null!==dataPartDimName){if(!itemData.dimensions(dataPartDimName).atoms().some(function(dataPartAtom){return def.hasOwn(visibleDataCellsByDataPart,dataPartAtom.value);}))return;}
if(null!==dataCellsWithExtensionComplexTypesToCheck){if(!def.query(dataCellsWithExtensionComplexTypesToCheck).any(function(dataCell){return dataCell.role.grouping.extensionDimensions().all(function(dimSpec){var measureRole,measureRoleName=pvc.visual.Role.parseDataSetName(dimSpec.dataSetName);return null!==measureRoleName&&null!==(measureRole=dataCell.plot.visualRole(measureRoleName))&&measureRole.isBoundDimensionCompatible(itemData);});}))return;}
var itemScene=groupScene.createItem({source:itemData}),itemValue=colorAxis.domainItemValue(itemData);itemScene.color=colorScale(itemValue);});return groupScene;},_createContentPanel:function(parentPanel,contentOptions){return new pvc.ContentPanel(this,parentPanel,{margins:contentOptions.margins,paddings:contentOptions.paddings});},_createContent:function(parentPanel,contentOptions){this.plotList.forEach(function(plot){(this.parent?plot.isDataBoundOn(this.data):plot.isBound)&&this._createPlotPanel(plot,parentPanel,contentOptions);},this);},_createPlotPanel:function(plot,parentPanel,contentOptions){var PlotPanelClass=pvc.PlotPanel.getClass(plot.type);if(!PlotPanelClass)throw def.error.invalidOperation("There is no registered panel class for plot type '{0}'.",[plot.type]);var options=Object.create(contentOptions);if(this._preserveLayout){var state=this._preservedPlotsLayoutInfo[plot.id];options.size=state.size;options.paddings=state.paddings;options.margins=state.margins;}
var panel=new PlotPanelClass(this,parentPanel,plot,options),name=plot.name,plotPanels=this.plotPanels;plotPanels[plot.id]=panel;name&&(plotPanels[name]=panel);plot.globalIndex||(plotPanels.main=panel);this.plotPanelList.push(panel);}});pvc.BaseChart.add({_updateSelectionSuspendCount:0,_lastSelectedDatums:null,clearSelections:function(){this.data.owner.clearSelected()&&this.updateSelections();return this;},_updatingSelections:function(method,context){this._suspendSelectionUpdate();try{method.call(context||this);}finally{this._resumeSelectionUpdate();}},_suspendSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount++:this.root._suspendSelectionUpdate();},_resumeSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount>0&&!--this._updateSelectionSuspendCount&&this.updateSelections():this.root._resumeSelectionUpdate();},renderInteractive:function(){this.useTextMeasureCache(function(){this.basePanel.renderInteractive();},this);return this;},updateSelections:function(keyArgs){if(this===this.root){if(this._inUpdateSelections||this._updateSelectionSuspendCount)return this;var selectedChangedDatumMap=this._calcSelectedChangedDatums();if(!selectedChangedDatumMap)return this;pvc.removeTipsyLegends();this._inUpdateSelections=!0;try{var action=this.options.selectionChangedAction;if(action){var selectedDatums=this.data.selectedDatums(),selectedChangedDatums=selectedChangedDatumMap.values();action.call(this.basePanel.context(),selectedDatums,selectedChangedDatums);}
def.get(keyArgs,"render",!0)&&this.useTextMeasureCache(function(){this.basePanel.renderInteractive();},this);}finally{this._inUpdateSelections=!1;}}else this.root.updateSelections(keyArgs);return this;},_calcSelectedChangedDatums:function(){if(this.data){var selectedChangedDatums,nowSelectedDatums=this.data.selectedDatumMap(),lastSelectedDatums=this._lastSelectedDatums;if(lastSelectedDatums){selectedChangedDatums=lastSelectedDatums.symmetricDifference(nowSelectedDatums);if(!selectedChangedDatums.count)return;}else{if(!nowSelectedDatums.count)return;selectedChangedDatums=nowSelectedDatums.clone();}
this._lastSelectedDatums=nowSelectedDatums;return selectedChangedDatums;}},_onUserSelection:function(datums,group){if(!datums||!datums.length)return datums;if(this===this.root){var action=this.options.userSelectionAction;return action?action.call(this.basePanel.context(),datums,group)||datums:datums;}
return this.root._onUserSelection(datums,group);}});pvc.BaseChart.add({_processExtensionPoints:function(){if(this.parent)this._components=this.parent._components;else{this._processExtensionPointsIn(this.options);this._processExtensionPointsIn(this.options.extensionPoints);}},_processExtensionPointsIn:function(points,prefix,fNep){var name,id,prop,splitIndex,comps=this._components||(this._components={});for(name in points){splitIndex=name.indexOf("_");if(splitIndex>0){id=name.substring(0,splitIndex);prop=name.substring(splitIndex+1);if(id&&prop){prefix&&(id=pvc_unwrapExtensionOne(id,prefix));(def.getOwn(comps,id)||(comps[id]=new def.OrderedMap())).add(prop,points[name]);}}else if(fNep){id=prefix?pvc_unwrapExtensionOne(name,prefix):name;fNep(points[name],id,name);}}},extend:function(mark,ids,keyArgs){def.array.is(ids)?ids.forEach(function(id){this._extendCore(mark,id,keyArgs);},this):this._extendCore(mark,ids,keyArgs);},_extendCore:function(mark,id,keyArgs){if(mark){var component=def.getOwn(this._components,id);if(component){mark.borderPanel&&(mark=mark.borderPanel);var logOut=def.debug>=3?[]:null,constOnly=def.get(keyArgs,"constOnly",!1),wrap=mark.wrap,keyArgs2={tag:pvc.extensionTag},isRealMark=mark instanceof pv_Mark,isRealMarkAndWrapOrConstOnly=isRealMark&&(wrap||constOnly),processValue=function(v,m){if(null!=v){var type=typeof v;if("object"===type){if("svg"===m||"css"===m){var v2=mark.propertyValue(m);v2&&(v=def.copy(v2,v));}else if(v instanceof Array)return v.map(function(vi){return processValue(vi,m);});}else if(isRealMarkAndWrapOrConstOnly&&"function"===type){if(constOnly)return;"add"!==m&&"call"!==m&&(v=wrap.call(mark,v,m));}}
return v;},callMethod=function(mm,v){return v instanceof Array?mm.apply(mark,v):mm.call(mark,v);};component.forEach(function(v,m){if(mark.isLocked&&mark.isLocked(m))logOut&&logOut.push(m+": locked extension point!");else if(mark.isIntercepted&&mark.isIntercepted(m))logOut&&logOut.push(m+":"+def.describe(v)+" (controlled)");else{logOut&&logOut.push(m+": "+def.describe(v));v=processValue(v,m);if(void 0!==v){var mm=mark[m];"function"==typeof mm?isRealMark&&mark.properties[m]?mark.intercept(m,v,keyArgs2):v instanceof Array?v.forEach(function(vi){callMethod(mm,vi);}):callMethod(mm,v):mark[m]=v;}}});logOut&&(logOut.length?this.log("Applying Extension Points for: '"+id+"'\n\t* "+logOut.join("\n\t* ")):def.debug>=5&&this.log("No Extension Points for: '"+id+"'"));}}else def.debug>=4&&this.log("Applying Extension Points for: '"+id+"' (target mark does not exist)");},_getExtension:function(id,prop){var component;if(def.array.is(id))for(var value,i=id.length-1;i>=0;){component=def.getOwn(this._components,id[i--]);if(component&&void 0!==(value=component.get(prop)))return value;}else{component=def.getOwn(this._components,id);if(component)return component.get(prop);}},_getComponentExtensions:function(id){return def.getOwn(this._components,id);},_getConstantExtension:function(id,prop){var value=this._getExtension(id,prop);if(!def.fun.is(value))return value;}});pvc.BaseChart.add({activeScene:function(){return this._activeScene||null;},_setActiveScene:function(to,noRender){if(this.parent)return this.root._setActiveScene(to,noRender);to?to.ownerScene&&(to=to.ownerScene):to=null;var from=this.activeScene();if(to===from)return!1;var ctx=new pvc.visual.Context(this.basePanel),ev=this._acting("active:change",function(){return this.chart._activeSceneChange(this,noRender);});ev.from=from;ev.to=to;ctx.event=ev;ev.trigger(ctx,[]);return!0;},_activeSceneChange:function(ctx,noRender){this.useTextMeasureCache(function(){var from=ctx.event.from,to=ctx.event.to;from&&from._clearActive();(this._activeScene=to)&&to._setActive(!0);if(!noRender){!from||to&&to.root===from.root||from.panel().renderInteractive();to&&to.panel().renderInteractive();}});},_on:function(name,handlerInfo,before){"active:change"===name&&(handlerInfo.role||handlerInfo.dims)&&chart_activeSceneEvent_addFilter(name,handlerInfo);}});def("pvc.visual.MultiChart",pvc.visual.OptionsBase.extend({init:function(chart){this.base(chart,"multiChart",0,{byV1:!1,byNaked:!1});},options:{Start:{resolve:"_resolveFull",cast:def.number.toNonNegative,value:0},Max:{resolve:"_resolveFull",cast:def.number.toPositive,value:1/0},ColumnsMax:{resolve:"_resolveFull",cast:def.number.toPositive,value:3},SingleRowFillsHeight:{resolve:"_resolveFull",cast:Boolean,value:!0},SingleColFillsHeight:{resolve:"_resolveFull",cast:Boolean,value:!0},Overflow:{resolve:"_resolveFull",cast:pvc.parseMultiChartOverflow,value:"grow"}}}));def.type("pvc.MultiChartPanel",pvc.ContentPanel).add({createSmallCharts:function(){var pageSmallCount,chart=this.chart,multiInfo=chart._multiInfo;if(multiInfo&&(pageSmallCount=multiInfo.pageSmallCount)){var coordScopesByType,addChartToScope,indexChartByScope,coordRootAxesByScopeType=this._getCoordinatedRootAxesByScopeType();if(coordRootAxesByScopeType){coordScopesByType={};addChartToScope=function(childChart,scopeType,scopeIndex){var scopes=def.array.lazy(coordScopesByType,scopeType);def.array.lazy(scopes,scopeIndex).push(childChart);};indexChartByScope=function(childChart){coordRootAxesByScopeType.row&&addChartToScope(childChart,"row",childChart.smallRowIndex);coordRootAxesByScopeType.column&&addChartToScope(childChart,"column",childChart.smallColIndex);coordRootAxesByScopeType.global&&addChartToScope(childChart,"global",0);};}
for(var childOptionsBase=this._buildSmallChartsBaseOptions(),ChildClass=chart.constructor,smallDatas=multiInfo.smallDatas,colCount=multiInfo.colCount,startIndex=multiInfo.pageStartIndex,index=0;index<pageSmallCount;index++){var smallData=smallDatas[startIndex+index],colIndex=index%colCount,rowIndex=Math.floor(index/colCount),childOptions=def.set(Object.create(childOptionsBase),"smallColIndex",colIndex,"smallRowIndex",rowIndex,"title",smallData.absLabel,"titleVisible",!0,"data",smallData),smallChart=new ChildClass(childOptions);if(coordRootAxesByScopeType){smallChart._createPhase1();indexChartByScope(smallChart);}else smallChart._create();}
if(coordRootAxesByScopeType){var me=this;def.eachOwn(coordRootAxesByScopeType,function(axes,scopeType){axes.forEach(function(axis){coordScopesByType[scopeType].forEach(function(scopeCharts){me._coordinateScopeAxes(axis.id,scopeCharts);});});});chart.children.forEach(function(childChart){childChart._createPhase2();});}
multiInfo.coordScopesByType=coordScopesByType;}},_getCoordinatedRootAxesByScopeType:function(){var hasCoordination=!1,rootAxesByScopeType=def.query(this.chart.axesList).multipleIndex(function(axis){if("discrete"!==axis.scaleType&&axis.option.isDefined("DomainScope")){var scopeType=axis.option("DomainScope");if("cell"!==scopeType){hasCoordination=!0;return scopeType;}}});return hasCoordination?rootAxesByScopeType:null;},_coordinateScopeAxes:function(axisId,scopeCharts){var unionExtent=def.query(scopeCharts).select(function(childChart){var scale=childChart.axes[axisId].scale;if(!scale.isNull){var domain=scale.domain();return{min:domain[0],max:domain[1]};}}).reduce(pvc.unionExtents,null);unionExtent&&scopeCharts.forEach(function(childChart){var axis=childChart.axes[axisId],scale=axis.scale;if(!scale.isNull){scale.domain(unionExtent.min,unionExtent.max);axis.setScale(scale);}});},_buildSmallChartsBaseOptions:function(){var chart=this.chart,options=chart.options;return def.set(Object.create(options),"parent",chart,"legendAreaVisible",!1,"titleVisible",options.smallTitleVisible,"titleFont",options.smallTitleFont,"titlePosition",options.smallTitlePosition,"titleAlign",options.smallTitleAlign,"titleAlignTo",options.smallTitleAlignTo,"titleOffset",options.smallTitleOffset,"titleKeepInBounds",options.smallTitleKeepInBounds,"titleMargins",options.smallTitleMargins,"titlePaddings",options.smallTitlePaddings,"titleSize",options.smallTitleSize,"titleSizeMax",options.smallTitleSizeMax);},_calcLayout:function(layoutInfo){var chart=this.chart,multiInfo=chart._multiInfo;if(multiInfo){var multiOption=chart.multiOptions.option,smallOption=chart.smallOptions.option,clientSize=layoutInfo.clientSize,prevLayoutInfo=layoutInfo.previous,initialClientWidth=prevLayoutInfo?prevLayoutInfo.initialClientWidth:clientSize.width,initialClientHeight=prevLayoutInfo?prevLayoutInfo.initialClientHeight:clientSize.height,smallWidth=smallOption("Width");null!=smallWidth&&(smallWidth=pvc_PercentValue.resolve(smallWidth,initialClientWidth));var smallHeight=smallOption("Height");null!=smallHeight&&(smallHeight=pvc_PercentValue.resolve(smallHeight,initialClientHeight));var ar=smallOption("AspectRatio"),rowCount=multiInfo.rowCount,colCount=multiInfo.colCount;if(null==smallWidth)if(isFinite(multiInfo.colCountMax))smallWidth=clientSize.width/colCount;else{null==smallHeight&&(smallHeight=initialClientHeight);smallWidth=ar*smallHeight;}
null==smallHeight&&(smallHeight=1===rowCount&&multiOption("SingleRowFillsHeight")||1===colCount&&multiOption("SingleColFillsHeight")?initialClientHeight:smallWidth/ar);var finalClientWidth=smallWidth*colCount,finalClientHeight=smallHeight*rowCount;if(!chart._isMultiChartOverflowClipRetry){chart._isMultiChartOverflowClip=!1;switch(multiOption("Overflow")){case"fit":if(finalClientWidth>initialClientWidth){finalClientWidth=initialClientWidth;smallWidth=finalClientWidth/colCount;}
if(finalClientHeight>initialClientHeight){finalClientHeight=initialClientHeight;smallHeight=finalClientHeight/rowCount;}
break;case"clip":case"page":var colCountMax=colCount,rowCountMax=rowCount,needClipWidth=finalClientWidth>initialClientWidth;needClipWidth&&(colCountMax=Math.floor(initialClientWidth/smallWidth));var needClipHeight=finalClientHeight>initialClientHeight;needClipHeight&&(rowCountMax=Math.floor(initialClientHeight/smallHeight));if(needClipHeight||needClipWidth){chart._isMultiChartOverflowClip=!0;chart._clippedMultiChartRowCountMax=rowCountMax;chart._clippedMultiChartColCountMax=colCountMax;}}}
multiInfo.smallWidth=smallWidth;multiInfo.smallHeight=smallHeight;def.set(layoutInfo,"initialClientWidth",initialClientWidth,"initialClientHeight",initialClientHeight,"width",smallWidth,"height",smallHeight);return{width:finalClientWidth,height:Math.max(clientSize.height,finalClientHeight)};}},_createCore:function(li){var chart=this.chart;!chart._isMultiChartOverflowClip||def.assert("Overflow & Clip condition should have been resolved.");var multiInfo=chart._multiInfo;if(multiInfo){var smallOption=chart.smallOptions.option,smallMargins=smallOption("Margins"),smallPaddings=smallOption("Paddings");chart.children.forEach(function(childChart){childChart._setSmallLayout({left:childChart.smallColIndex*li.width,top:childChart.smallRowIndex*li.height,width:li.width,height:li.height,margins:this._buildSmallMargins(childChart,smallMargins,multiInfo),paddings:smallPaddings});},this);var coordScopesByType=multiInfo.coordScopesByType;coordScopesByType&&chart._coordinateSmallChartsLayout(coordScopesByType);this.base(li);}},_buildSmallMargins:function(childChart,smallMargins,multiInfo){var C=multiInfo.colCount-1,R=multiInfo.rowCount-1,c=childChart.smallColIndex,r=childChart.smallRowIndex,margins={};c>0&&(margins.left=smallMargins.left);c<C&&(margins.right=smallMargins.right);r>0&&(margins.top=smallMargins.top);r<R&&(margins.bottom=smallMargins.bottom);return margins;}});def("pvc.visual.SmallChart",pvc.visual.OptionsBase.extend({init:function(chart){this.base(chart,"small",0,{byV1:!1,byNaked:!1});},options:{Width:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:null},Height:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:null},AspectRatio:{resolve:"_resolveFull",cast:def.number.toPositive,getDefault:function(){return this.chart instanceof pvc.PieChart?10/7:5/4;}},Margins:{resolve:"_resolveFull",cast:pvc_Sides.as,value:new pvc_Sides(new pvc_PercentValue(.02))},Paddings:{resolve:"_resolveFull",cast:pvc_Sides.as,value:0}}}));pv_Mark.prototype.getSign=function(){return this.sign||sign_createBasic(this);};pv_Mark.prototype.getScene=function(){return this.getSign().scene();};pv_Mark.prototype.getContext=function(){return this.getSign().context();};pv_Mark.prototype.preBuildInstance=function(s){var scene=s.data;scene instanceof pvc.visual.Scene&&scene_renderId.call(scene,this.renderId());};def("pvc.visual.BasicSign",def.Object.extend({init:function(panel,pvMark){this.chart=panel.chart;this.panel=panel;!pvMark.sign||def.assert("Mark already has an attached Sign.");this.pvMark=pvMark;pvMark.sign=this;},methods:{compatVersion:function(){return this.chart.compatVersion();},localProperty:function(name,type){return this.pvMark.localProperty(name,type),this;},lock:function(pvName,value){return this.lockMark(pvName,this._bindWhenFun(value,pvName));},optional:function(pvName,value,tag){return this.optionalMark(pvName,this._bindWhenFun(value,pvName),tag);},lockMark:function(name,value){return this.pvMark.lock(name,value),this;},optionalMark:function(name,value,tag){return this.pvMark[name](value,tag),this;},delegate:function(dv,tag){return this.pvMark.delegate(dv,tag);},delegateExtension:function(dv){return this.pvMark.delegate(dv,pvc.extensionTag);},delegateNotExtension:function(dv){return this.pvMark.delegateExcept(dv,pvc.extensionTag);},hasDelegate:function(tag){return this.pvMark.hasDelegate(tag);},_createPropInterceptor:function(pvName,fun){var me=this;return function(){var sign=this.sign;return sign&&sign===me?fun.apply(me,arguments):me._getPvSceneProp(pvName,this.index);};},_getPvSceneProp:function(prop,defaultIndex){var pvMark=this.pvMark,pvScenes=pvMark.scene;if(pvScenes){var index=pvMark.hasOwnProperty("index")?pvMark.index:Math.min(defaultIndex,pvScenes.length-1);if(null!=index)return pvScenes[index][prop];}
throw def.error.operationInvalid("Cannot evaluate inherited property.");},_bindWhenFun:function(value,pvName){if(def.fun.is(value)){var me=this;return me._createPropInterceptor(pvName,function(scene){return value.call(me,scene);});}
return value;},_lockDynamic:function(pvName,method){var me=this;return me.lockMark(pvName,me._createPropInterceptor(pvName,function(scene){return me[method].call(me,scene);}));},scene:function(){var instance=this.pvMark.instance(),scene=instance&&instance.data;return scene instanceof pvc.visual.Scene?scene:null;},instanceState:function(s){return this.pvMark.instanceState(s);},context:function(scene,createIndep){var state;return createIndep||!(state=this.instanceState())?this._createContext(scene):state.cccContext||(state.cccContext=this._createContext(scene));},_createContext:function(scene){return new pvc.visual.Context(this.panel,this.pvMark,scene);}}}));def("pvc.visual.Sign",pvc.visual.BasicSign.extend([{init:function(panel,pvMark,keyArgs){var me=this;me.base(panel,pvMark,keyArgs);me._ibits=panel.ibits();var extensionIds=def.get(keyArgs,"extensionId");null!=extensionIds&&(me.extensionAbsIds=def.array.to(panel._makeExtensionAbsId(extensionIds)));me.isActiveSeriesAware=def.get(keyArgs,"activeSeriesAware",!0);if(me.isActiveSeriesAware){var roles=panel.visualRoles,seriesRole=roles&&roles.series;seriesRole&&seriesRole.isBound()||(me.isActiveSeriesAware=!1);}
pvMark.wrapper(def.get(keyArgs,"wrapper")||me.createDefaultWrapper());def.get(keyArgs,"freeColor",!0)||me._bindProperty("fillStyle","fillColor","color")._bindProperty("strokeStyle","strokeColor","color");},postInit:function(panel,pvMark,keyArgs){this._addInteractive(keyArgs);panel._addSign(this);},methods:[pvc.visual.Interactive],"type.methods":{properties:function(specs){var spec;for(var n in specs)void 0!==(spec=specs[n])&&(isNaN(+n)?this.property(n):def.string.is(spec)&&this.property(spec));return this;},property:def.configurable(!1,function(name){var upperName=def.firstUpperCase(name),baseName="base"+upperName,defName="default"+upperName,normalName="normal"+upperName,interName="interactive"+upperName,methods={};methods[name]=function(scene,arg){this._finished=!1;this._arg=arg;var value=this[baseName](scene,arg);if(null==value)return null;if(this._finished)return value;value=this[this.showsInteraction()&&scene.anyInteraction()?interName:normalName](scene,value,arg);this._arg=null;return value;};methods[baseName]=function(){return this.delegateExtension();};methods[defName]=function(){};methods[normalName]=function(scene,value){return value;};methods[interName]=function(scene,value){return value;};return this.methods(methods);})}},{properties:["color"]},{methods:{extensionAbsIds:null,_processedIbits:!1,ibits:function(){var ibits=this._ibits,pvMark=this.pvMark;if(!this._processedIbits){this._processedIbits=!0;var extensionAbsIds=this.extensionAbsIds;extensionAbsIds&&extensionAbsIds.forEach(function(extensionAbsId){var v=this.panel._getExtensionAbs(extensionAbsId,"ibits");null!=v&&pvMark.ibits(v);v=this.panel._getExtensionAbs(extensionAbsId,"imask");null!=v&&pvMark.imask(v);},this);}
var imask0=pvMark.imask();if(imask0){var ibitsON=imask0&pvMark.ibits(),ibitsOFF=~imask0|ibitsON;ibits|=ibitsON;ibits&=ibitsOFF;}
return ibits;},createDefaultWrapper:function(){var me=this;return function(f){return function(scene){return f.call(me.context(),scene);};};},anyInteraction:function(scene){return scene.anyInteraction();},finished:function(value){this._finished=!0;return value;},applyExtensions:function(){if(!this._extended){this._extended=!0;var extensionAbsIds=this.extensionAbsIds;extensionAbsIds&&extensionAbsIds.forEach(function(extensionAbsId){this.panel.extendAbs(this.pvMark,extensionAbsId);},this);}
return this;},intercept:function(pvName,fun){var interceptor=this._createPropInterceptor(pvName,fun);return this._intercept(pvName,interceptor);},lockDimensions:function(){this.pvMark.lock("left").lock("right").lock("top").lock("bottom").lock("width").lock("height");return this;},_extensionKeyArgs:{tag:pvc.extensionTag},_bindProperty:function(pvName,prop,realProp){var me=this;realProp||(realProp=prop);var defaultPropName="default"+def.firstUpperCase(realProp);if(def.fun.is(me[defaultPropName])&&!me.pvMark.hasDelegateValue(pvName,pvc.extensionTag)){var defaultPropMethod=function(scene){return me[defaultPropName](scene,me._arg);};me.pvMark.intercept(pvName,defaultPropMethod,me._extensionKeyArgs);}
var mainPropMethod=this._createPropInterceptor(pvName,function(scene){return me[prop](scene);});return me._intercept(pvName,mainPropMethod);},_intercept:function(name,fun){var mark=this.pvMark,extensionAbsIds=this.extensionAbsIds;extensionAbsIds&&def.query(extensionAbsIds).select(function(extensionAbsId){return this.panel._getExtensionAbs(extensionAbsId,name);},this).where(def.notUndef).each(function(extValue){extValue=mark.wrap(extValue,name);mark.intercept(name,extValue,this._extensionKeyArgs);},this);(mark._intercepted||(mark._intercepted={}))[name]=!0;mark.intercept(name,fun);return this;},_addInteractive:function(ka){var me=this,get=def.get;if(me.interactive()){var bits=me.ibits(),I=pvc.visual.Interactive;get(ka,"noTooltip")&&(bits&=~I.ShowsTooltip);get(ka,"noHover")&&(bits&=~I.Hoverable);get(ka,"noClick")&&(bits&=~I.Clickable);get(ka,"noDoubleClick")&&(bits&=~I.DoubleClickable);if(get(ka,"noSelect"))bits&=~I.SelectableAny;else if(this.selectable()){get(ka,"noClickSelect")&&(bits&=~I.SelectableByClick);get(ka,"noRubberSelect")&&(bits&=~I.SelectableByRubberband);}
if(me.showsInteraction()){!1===get(ka,"showsInteraction")&&(bits&=~I.ShowsInteraction);me.showsActivity()&&!1===get(ka,"showsActivity")&&(bits&=~I.ShowsActivity);me.showsSelection()&&!1===get(ka,"showsSelection")&&(bits&=~I.ShowsSelection);}
me._ibits=bits;}
if(me.handlesEvents()){me.showsTooltip()&&me._addPropTooltip(get(ka,"tooltipArgs"));me.hoverable()&&me._addPropHoverable();me.handlesClickEvent()&&me._addPropClick();me.doubleClickable()&&me._addPropDoubleClick();}else me.pvMark.events("none");},fillColor:function(scene){return this.color(scene,"fill");},strokeColor:function(scene){return this.color(scene,"stroke");},defaultColor:function(scene){return this.scaleColor(scene);},scaleColor:function(scene){return this.defaultColorSceneScale()(scene);},dimColor:function(color,type){return"text"===type?pvc.toGrayScale(color,-.75,null,null):pvc.toGrayScale(color,-.3,null,null);},defaultColorSceneScale:function(){return def.lazy(this,"_defaultColorSceneScale",this._initDefColorScale,this);},_initDefColorScale:function(){var colorAxis=this.panel.axes.color;return colorAxis?colorAxis.sceneScale({sceneVarName:"color"}):def.fun.constant(pvc.defaultColor);},mayShowActive:function(scene,noSeries){if(!this.showsActivity())return!1;var owner;return scene.isActive||!(!(owner=scene.ownerScene)||owner===scene)&&owner.isActive||!noSeries&&this.isActiveSeriesAware&&scene.isActiveSeries()||scene.isActiveDatum();},mayShowNotAmongSelected:function(scene){return this.mayShowAnySelected(scene)&&!scene.isSelected();},mayShowSelected:function(scene){return this.showsSelection()&&scene.isSelected();},mayShowAnySelected:function(scene){return this.showsSelection()&&scene.anySelected();},_addPropTooltip:function(ka){if(!this.pvMark.tooltipOptions){var tipsy=this.panel._requireTipsy(),pointingOptions=this.chart._pointingOptions,tipOptions=def.create(this.chart._tooltipOptions,def.get(ka,"options"));tipOptions.isLazy=def.get(ka,"isLazy",!0);var tooltipFormatter=def.get(ka,"buildTooltip")||this._getTooltipFormatter(tipOptions);if(tooltipFormatter){var isNear="near"===pointingOptions.mode,tipsyEvent=def.get(ka,"tipsyEvent")||(isNear?"point":"mouseover");this.pvMark.localProperty("tooltip").tooltip(this._createTooltipProp(tooltipFormatter,tipOptions.isLazy)).title(def.fun.constant("")).ensureEvents().event(tipsyEvent,tipsy).tooltipOptions=tipOptions;}}},_getTooltipFormatter:function(tipOptions){return this.panel._getTooltipFormatter(tipOptions);},_isTooltipEnabled:function(){return this.panel._isTooltipEnabled();},_createTooltipProp:function(tooltipFormatter,isLazy){var formatTooltip,me=this;formatTooltip=isLazy?function(scene){var tooltip,context=me.context(scene,!0);return function(){if(context){tooltip=tooltipFormatter(context);context=null;}
return tooltip;};}:function(scene){var context=me.context(scene);return tooltipFormatter(context);};return function(scene){if(scene&&scene.showsTooltip())return formatTooltip(scene);};},_addPropHoverable:function(){var onEvent,offEvent,pointingOptions=this.chart._pointingOptions,panel=this.panel;if("near"===pointingOptions.mode){onEvent="point";offEvent="unpoint";}else{onEvent="mouseover";offEvent="mouseout";}
this.pvMark.ensureEvents().event(onEvent,function(scene){!scene.hoverable()||panel.selectingByRubberband()||panel.animating()||scene.setActive(!0);}).event(offEvent,function(scene){!scene.hoverable()||panel.selectingByRubberband()||panel.animating()||pv.event&&pv.event.isPointSwitch||scene.clearActive();});this.pvMark._hasHoverable=!0;},_ignoreClicks:0,_propCursorClick:function(s){var ibits=this.ibits()&s.ibits(),I=pvc.visual.Interactive;return ibits&I.HandlesClickEvent||ibits&I.DoubleClickable?"pointer":null;},_addPropClick:function(){var me=this;me.pvMark.cursor(me._propCursorClick.bind(me)).ensureEvents().event("click",me._handleClick.bind(me));},_addPropDoubleClick:function(){var me=this;me.pvMark.cursor(me._propCursorClick.bind(me)).ensureEvents().event("dblclick",me._handleDoubleClick.bind(me));},_handleClick:function(){var me=this,pvMark=me.pvMark,pvInstance=pvMark.instance(),scene=pvInstance.data;if(me.doubleClickable()&&scene.doubleClickable()){var pvScene=pvMark.scene,pvIndex=pvMark.index,pvEvent=pv.event;window.setTimeout(function(){if(me._ignoreClicks)me._ignoreClicks--;else try{pv.event=pvEvent;pvMark.context(pvScene,pvIndex,function(){me._handleClickCore();});}catch(ex){pv.error(ex);}finally{delete pv.event;}},me.chart.options.doubleClickMaxDelay||300);}else me._ignoreClicks?me._ignoreClicks--:me._handleClickCore();},_handleClickCore:function(){this._onClick(this.context());},_handleDoubleClick:function(){var me=this,scene=me.scene();if(scene&&scene.doubleClickable()){me._ignoreClicks=2;me._onDoubleClick(me.context(scene));}},_onClick:function(context){context.click();},_onDoubleClick:function(context){context.doubleClick();}}}]));pvc.finished=function(v){return void 0===v?function(){return this.finished(this.delegate());}:def.fun.is(v)?function(){return(this.finished?this:this.getSign()).finished(v.apply(this,arguments));}:function(){return(this.finished?this:this.getSign()).finished(v);};};def("pvc.visual.Panel",pvc.visual.Sign.extend({init:function(panel,protoMark,keyArgs){var pvPanel=def.get(keyArgs,"panel");if(!pvPanel){var pvPanelType=def.get(keyArgs,"panelType")||pv.Panel;pvPanel=protoMark.add(pvPanelType);}
this.base(panel,pvPanel,keyArgs);},methods:{_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,"noSelect",!0,"noHover",!0,"noTooltip",!0,"noClick",!0,"noDoubleClick",!0);this.base(keyArgs);}}}));def("pvc.visual.Label",pvc.visual.Sign.extend({init:function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Label);this.base(panel,pvMark,keyArgs);},methods:{_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,"noSelect",!0,"noHover",!0,"noTooltip",!0,"noClick",!0,"noDoubleClick",!0,"showsInteraction",!1);this.base(keyArgs);},defaultColor:def.fun.constant(pv.Color.names.black)}}));var DEFAULT_BG_COLOR=pv.Color.names.white;def("pvc.visual.ValueLabel",pvc.visual.Label.extend({init:function(panel,anchorMark,keyArgs){this.valuesFont=def.get(keyArgs,"valuesFont")||panel.valuesFont;this.valuesMask=def.get(keyArgs,"valuesMask")||panel.valuesMask;this.valuesOptimizeLegibility=def.get(keyArgs,"valuesOptimizeLegibility",panel.valuesOptimizeLegibility);this.valuesOverflow=def.get(keyArgs,"valuesOverflow",panel.valuesOverflow);this.hideOverflowed="hide"===this.valuesOverflow;this.trimOverflowed=!this.hideOverflowed&&"trim"===this.valuesOverflow;this.hideOrTrimOverflowed=this.hideOverflowed||this.trimOverflowed;var protoMark=def.get(keyArgs,"noAnchor",!1)?anchorMark:anchorMark.anchor(panel.valuesAnchor);keyArgs&&null==keyArgs.extensionId&&(keyArgs.extensionId="label");this.base(panel,protoMark,keyArgs);this.pvMark.font(this.valuesFont);this._bindProperty("text","text")._bindProperty("textStyle","textColor","color").intercept("visible",this.visible);},properties:["text","textStyle"],type:{methods:{maybeCreate:function(panel,anchorMark,keyArgs){return panel.valuesVisible&&panel.valuesMask?new pvc.visual.ValueLabel(panel,anchorMark,keyArgs):null;},isNeeded:function(panel){return panel.valuesVisible&&!!panel.valuesMask;}}},methods:{_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,"showsInteraction",!0,"noSelect",!0,"noTooltip",!0,"noClick",!0,"noDoubleClick",!0,"noHover",!0);this.base(keyArgs);},visible:function(scene){var anchoredToMark=this.getAnchoredToMark();if(anchoredToMark&&!anchoredToMark.visible())return!1;if(!this.hideOrTrimOverflowed)return this.delegate(!0);var visible;if(this.hasDelegate(pvc.extensionTag)){visible=this.delegateExtension();if(null!=visible)return visible;}
visible=this.delegateNotExtension();if(!1===visible)return!1;if(scene.isActive&&this.showsActivity())return!0;var fitInfo=this.textFitInfo(scene);return!(fitInfo&&fitInfo.hide);},textFitInfo:function(scene){var state=scene.renderState,fitInfo=state.textFitInfo;return void 0!==fitInfo?fitInfo:state.textFitInfo=this.calcTextFitInfo(scene,this._evalBaseText())||null;},calcTextFitInfo:function(scene,text){return null;},_evalBaseText:function(){var pvLabel=this.pvMark,pdelegate=pvLabel.binds.properties.text.proto;return pvLabel.evalInPropertyContext(this.baseText.bind(this),pdelegate);},baseText:function(scene){var state=scene.renderState,text=state.baseText;return void 0!==text?text:this.base(scene);},defaultText:function(scene){return scene.format(this.valuesMask);},normalText:function(scene,text){var fitInfo;return this.trimOverflowed&&(fitInfo=this.textFitInfo(scene))?this.trimText(scene,text,fitInfo):text;},interactiveText:function(scene,text){var fitInfo;return!this.trimOverflowed||scene.isActive&&this.showsActivity()||!(fitInfo=this.textFitInfo(scene))?text:this.trimText(scene,text,fitInfo);},trimText:function(scene,text,fitInfo){var twMax=fitInfo&&fitInfo.widthMax;return null!=twMax?pvc.text.trimToWidthB(twMax,text,this.pvMark.font(),".."):text;},textColor:function(scene){return this.color(scene,"text");},backgroundColor:function(scene,type){var state=this.instanceState();if(!state)return this.calcBackgroundColor(scene,type);var cache=def.lazy(state,"cccBgColorCache");return def.getOwn(cache,type)||(cache[type]=this.calcBackgroundColor(scene,type));},calcBackgroundColor:function(scene,type){var anchoredToMark=this.getAnchoredToMark();if(anchoredToMark){var fillColor=anchoredToMark.fillStyle();if(fillColor&&fillColor!==DEFAULT_BG_COLOR&&this.isAnchoredInside(scene,anchoredToMark))return fillColor;}
return DEFAULT_BG_COLOR;},getAnchoredToMark:function(){return this.pvMark.target||this.pvMark.parent;},isAnchoredInside:function(scene,anchoredToMark){if(!anchoredToMark&&!(anchoredToMark=this.getAnchoredToMark()))return!1;var p,pvLabel=this.pvMark,text=pvLabel.text(),m=pv.Text.measure(text,pvLabel.font()),l=pvLabel.left(),t=pvLabel.top();if(null==l){p=pvLabel.parent;l=p.width()-(pvLabel.right()||0);}
if(null==t){p||(p=pvLabel.parent);t=p.height()-(pvLabel.bottom()||0);}
var anchoredToShape,labelCenter=pv.Label.getPolygon(m.width,m.height,pvLabel.textAlign(),pvLabel.textBaseline(),pvLabel.textAngle(),pvLabel.textMargin()).center().plus(l,t);anchoredToShape=anchoredToMark===pvLabel.parent?new pv.Shape.Rect(0,0,anchoredToMark.width(),anchoredToMark.height()):anchoredToMark.getShape(anchoredToMark.scene,anchoredToMark.index);return anchoredToShape.containsPoint(labelCenter);},maybeOptimizeColorLegibility:function(scene,color,type){if(color&&this.valuesOptimizeLegibility){var bgColor=this.backgroundColor(scene,type);if(bgColor){var color2=color.complementary(),r1=color.contrastRatioTo(bgColor);if(color2.contrastRatioTo(bgColor)>r1)return color2;}}
return color;},normalColor:function(scene,color,type){return this.maybeOptimizeColorLegibility(scene,color,type);},interactiveColor:function(scene,color,type){return!this.mayShowActive(scene)&&this.mayShowNotAmongSelected(scene)?this.dimColor(color,type):this.maybeOptimizeColorLegibility(scene,color,type);}}}));def("pvc.visual.Dot",pvc.visual.Sign.extend({init:function(panel,parentMark,keyArgs){var pvMark=parentMark.add(pv.Dot),protoMark=def.get(keyArgs,"proto");protoMark&&pvMark.extend(protoMark);keyArgs=def.setDefaults(keyArgs,"freeColor",!1);this.base(panel,pvMark,keyArgs);if(!def.get(keyArgs,"freePosition",!1)){var a_left=panel.isOrientationVertical()?"left":"bottom",a_bottom=panel.anchorOrtho(a_left);this._lockDynamic(a_left,"x")._lockDynamic(a_bottom,"y");}
this.pvMark.shapeRadius(function(scene){return Math.sqrt(this.sign.defaultSize(scene));});this._bindProperty("shape","shape")._bindProperty("shapeRadius","radius")._bindProperty("shapeSize","size");this.optional("strokeDasharray",void 0).optional("lineWidth",1.5);},properties:["size","shape"],methods:{y:def.fun.constant(0),x:def.fun.constant(0),radius:function(){var state=this.instanceState();this._finished=!1;state.cccRadius=this.delegateExtension();state.cccRadiusFinished=this._finished;return null;},baseSize:function(scene){this.pvMark.shapeRadius();var state=this.instanceState(),radius=state.cccRadius;if(null!=radius){this._finished=state.cccRadiusFinished;return def.sqr(radius);}
return this.base(scene);},defaultSize:def.fun.constant(12),interactiveSize:function(scene,size){return this.mayShowActive(scene,!0)?2*Math.max(size,5):size;},interactiveColor:function(scene,color,type){if(this.mayShowActive(scene,!0)){if("stroke"===type)return color.brighter(1);}else if(this.mayShowNotAmongSelected(scene)){if(this.mayShowActive(scene))return color.alpha(.8);switch(type){case"fill":return this.dimColor(color,type);case"stroke":return color.alpha(.45);}}
return this.base(scene,color,type);}}}));def("pvc.visual.DotSizeColor",pvc.visual.Dot.extend({init:function(panel,parentMark,keyArgs){this.base(panel,parentMark,keyArgs);this._bindProperty("lineWidth","strokeWidth").intercept("visible",function(scene){if(!this.canShow(scene))return!1;var visible=this.delegateExtension();return null==visible?this.defaultVisible(scene):visible;});this._initColor();this._initSize();if(this.isSizeBound){if(panel.axes.size.scaleUsesAbs()){this.isSizeAbs=!0;var baseSceneDefColor=this._sceneDefColor;this._sceneDefColor=function(scene,type){return"stroke"===type&&scene.vars.size.value<0?pv.Color.names.black:baseSceneDefColor.call(this,scene,type);};this.pvMark.lineCap("round").strokeDasharray(function(scene){return scene.vars.size.value<0?"dash":null;});}}},properties:["strokeWidth"],methods:{isColorBound:!1,isColorDiscrete:!1,isSizeBound:!1,isSizeAbs:!1,canShow:function(scene){return!scene.isIntermediate;},defaultVisible:function(scene){return!scene.isNull&&(!this.isSizeBound&&!this.isColorBound||this.isSizeBound&&null!=scene.vars.size.value||this.isColorBound&&(this.isColorDiscrete||null!=scene.vars.color.value));},_initColor:function(){var colorConstant,sceneColorScale,panel=this.panel,colorRole=panel.visualRoles.color;if(colorRole){this.isColorDiscrete=colorRole.isDiscrete();var colorAxis=panel.axes.color;if(colorRole.isBound()){this.isColorBound=!0;sceneColorScale=colorAxis.sceneScale({sceneVarName:"color"});}else colorAxis&&(colorConstant=colorAxis.option("Unbound"));}
this._sceneDefColor=sceneColorScale||def.fun.constant(colorConstant||pvc.defaultColor);},_initSize:function(){var sceneSizeScale,sceneShapeScale,panel=this.panel,plot=panel.plot,shape=plot.option("Shape"),nullSizeShape=plot.option("NullShape"),sizeRole=panel.visualRoles.size;if(sizeRole){var sizeAxis=panel.axes.size,sizeScale=sizeAxis&&sizeAxis.scale;if(!!sizeScale&&sizeRole.isBound()){this.isSizeBound=!0;var missingSize=sizeScale.min+.05*(sizeScale.max-sizeScale.min);this.nullSizeShapeHasStrokeOnly="cross"===nullSizeShape;sceneShapeScale=function(scene){return null!=scene.vars.size.value?shape:nullSizeShape;};sceneSizeScale=function(scene){var sizeValue=scene.vars.size.value;return null!=sizeValue?sizeScale(sizeValue):nullSizeShape?missingSize:0;};}}
if(!sceneSizeScale){sceneShapeScale=def.fun.constant(shape);sceneSizeScale=function(scene){return this.base(scene);};}
this._sceneDefSize=sceneSizeScale;this._sceneDefShape=sceneShapeScale;},defaultColor:function(scene,type){return this._sceneDefColor(scene,type);},normalColor:function(scene,color,type){return"stroke"===type?color.darker():this.base(scene,color,type);},interactiveColor:function(scene,color,type){if(this.mayShowActive(scene,!0))switch(type){case"fill":return this.isSizeBound?color.alpha(.75):color;case"stroke":return color.darker();}else if(this.showsSelection()){var isSelected=scene.isSelected(),notAmongSelected=!isSelected&&scene.anySelected();if(notAmongSelected){if(this.mayShowActive(scene))return color.alpha(.8);switch(type){case"fill":return this.dimColor(color,type);case"stroke":return color.alpha(.45);}}
if(isSelected&&pvc_colorIsGray(color))return"stroke"===type?color.darker(3):color.darker(2);}
return"stroke"===type?color.darker():color;},defaultSize:function(scene){return this._sceneDefSize(scene);},defaultShape:function(scene){return this._sceneDefShape(scene);},interactiveSize:function(scene,size){if(!this.mayShowActive(scene,!0))return size;var radius=Math.sqrt(size),radiusInc=Math.max(1,Math.min(1.1*radius,2));return def.sqr(radius+radiusInc);},defaultStrokeWidth:function(scene){return this.nullSizeShapeHasStrokeOnly&&null==scene.vars.size.value?1.8:1;},interactiveStrokeWidth:function(scene,width){return this.mayShowActive(scene,!0)?2*width:this.mayShowSelected(scene)?1.5*width:width;}}}));pv.LineInterm=function(){pv.Line.call(this);};pv.LineInterm.prototype=pv.extend(pv.Line);pv.LineInterm.prototype.getNearestInstanceToMouse=function(scene,eventIndex){var mouseIndex=pv.Line.prototype.getNearestInstanceToMouse.call(this,scene,eventIndex),s=scene[mouseIndex];s&&s.data&&s.data.isIntermediate&&mouseIndex+1<scene.length&&mouseIndex++;return mouseIndex;};def("pvc.visual.Line",pvc.visual.Sign.extend({init:function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.LineInterm);this.base(panel,pvMark,keyArgs);this.lock("segmented","smart").lock("antialias",!0);if(!def.get(keyArgs,"freePosition",!1)){var basePosProp=panel.isOrientationVertical()?"left":"bottom",orthoPosProp=panel.anchorOrtho(basePosProp);this._lockDynamic(orthoPosProp,"y")._lockDynamic(basePosProp,"x");}
this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth");},properties:["strokeWidth"],methods:{_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,"noTooltip",!0);this.base(keyArgs);},y:def.fun.constant(0),x:def.fun.constant(0),defaultStrokeWidth:def.fun.constant(1.5),interactiveStrokeWidth:function(scene,strokeWidth){return this.mayShowActive(scene)?2.5*Math.max(1,strokeWidth):strokeWidth;},interactiveColor:function(scene,color,type){return this.mayShowNotAmongSelected(scene)?this.mayShowActive(scene)?pv.Color.names.darkgray.darker().darker():this.dimColor(color,type):this.base(scene,color,type);}}}));pv.AreaInterm=function(){pv.Area.call(this);};pv.AreaInterm.prototype=pv.extend(pv.Area);pv.AreaInterm.prototype.getNearestInstanceToMouse=function(scene,eventIndex){var mouseIndex=pv.Area.prototype.getNearestInstanceToMouse.call(this,scene,eventIndex),s=scene[mouseIndex];s&&s.data&&s.data.isIntermediate&&mouseIndex+1<scene.length&&mouseIndex++;return mouseIndex;};def("pvc.visual.Area",pvc.visual.Sign.extend({init:function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.AreaInterm);keyArgs||(keyArgs={});keyArgs.freeColor=!0;this.base(panel,pvMark,keyArgs);var antialias=def.get(keyArgs,"antialias",!0);this.lock("segmented","smart").lock("antialias",antialias);if(!def.get(keyArgs,"freePosition",!1)){var basePosProp=panel.isOrientationVertical()?"left":"bottom",orthoPosProp=panel.anchorOrtho(basePosProp),orthoLenProp=panel.anchorOrthoLength(orthoPosProp);this._lockDynamic(basePosProp,"x")._lockDynamic(orthoPosProp,"y")._lockDynamic(orthoLenProp,"dy");}
this._bindProperty("fillStyle","fillColor","color");this.lock("strokeStyle",null).lock("lineWidth",0);},methods:{_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,"noTooltip",!0);this.base(keyArgs);},y:def.fun.constant(0),x:def.fun.constant(0),dy:def.fun.constant(0),interactiveColor:function(scene,color,type){return"fill"===type&&this.mayShowNotAmongSelected(scene)?this.dimColor(color,type):this.base(scene,color,type);}}}));def("pvc.visual.Bar",pvc.visual.Sign.extend({init:function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Bar);keyArgs=def.setDefaults(keyArgs,"freeColor",!1);this.base(panel,pvMark,keyArgs);this.normalStroke=def.get(keyArgs,"normalStroke",!1);this._bindProperty("lineWidth","strokeWidth");},properties:["strokeWidth"],methods:{normalColor:function(scene,color,type){return"stroke"!==type||this.normalStroke?color:null;},interactiveColor:function(scene,color,type){if("stroke"===type){if(this.mayShowActive(scene,!0))return color.brighter(1.3).alpha(.7);if(!this.normalStroke)return null;if(this.mayShowNotAmongSelected(scene))return this.mayShowActive(scene)?pv.Color.names.darkgray.darker().darker():this.dimColor(color,type);if(this.mayShowActive(scene))return color.brighter(1).alpha(.7);}else if("fill"===type){if(this.mayShowActive(scene,!0))return color.brighter(.2).alpha(.8);if(this.mayShowNotAmongSelected(scene))return this.mayShowActive(scene)?pv.Color.names.darkgray.darker(2).alpha(.8):this.dimColor(color,type);if(this.mayShowActive(scene))return color.brighter(.2).alpha(.8);}
return this.base(scene,color,type);},defaultStrokeWidth:function(){return.5;},interactiveStrokeWidth:function(scene,strokeWidth){return this.mayShowActive(scene,!0)?1.3*Math.max(1,strokeWidth):strokeWidth;}}}));def("pvc.visual.Rule",pvc.visual.Sign.extend({init:function(panel,parentMark,keyArgs){var pvMark=parentMark.add(pv.Rule);pvMark.pointingRadiusMax(2);var protoMark=def.get(keyArgs,"proto");protoMark&&pvMark.extend(protoMark);this.base(panel,pvMark,keyArgs);def.get(keyArgs,"freeStyle")||this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth");},properties:["strokeWidth"],methods:{_addInteractive:function(keyArgs){keyArgs=def.setDefaults(keyArgs,"noHover",!0,"noSelect",!0,"noTooltip",!0,"noClick",!0,"noDoubleClick",!0,"showsInteraction",!1);this.base(keyArgs);},defaultStrokeWidth:def.fun.constant(1),interactiveStrokeWidth:function(scene,strokeWidth){return this.mayShowActive(scene,!0)?2.2*Math.max(1,strokeWidth):strokeWidth;},interactiveColor:function(scene,color,type){return scene.datum&&!this.mayShowActive(scene,!0)&&this.mayShowNotAmongSelected(scene)?this.dimColor(color,type):this.base(scene,color,type);}}}));def.space("pvc.visual").discreteBandsLayout=discreteBandsLayout;var pvc_CartesianAxis=def("pvc.visual.CartesianAxis",pvc_Axis.extend({init:function(chart,type,index,keyArgs){var options=chart.options;this.orientation=pvc_CartesianAxis.getOrientation(type,options.orientation);this.orientedId=pvc_CartesianAxis.getOrientedId(this.orientation,index);chart._allowV1SecondAxis&&1===index&&(this.v1SecondOrientedId="second"+this.orientation.toUpperCase());this.base(chart,type,index,keyArgs);chart.axes[this.orientedId]=this;this.v1SecondOrientedId&&(chart.axes[this.v1SecondOrientedId]=this);this.extensionPrefixes=getExtensionPrefixes.call(this);},methods:{bind:function(dataCells){this.base(dataCells);this._syncExtensionPrefixes();return this;},_syncExtensionPrefixes:function(){this.extensionPrefixes=getExtensionPrefixes.call(this);},_buildState:function(){return{ratio:this.option("PreserveRatio")?this._getCurrentRatio():null,tickAlignment:this.option("PreserveTickAlignment")?this._getTickAlignment():null};},_getCurrentRatio:function(){var ratio=this._state.ratio||this.option("Ratio");if(null==ratio){var scale=this.scale;if(scale){var rangeLength=scale.size,domain=scale.domain();ratio=rangeLength/(domain[1]-domain[0]);}}
return ratio;},_getTickAlignment:function(){return this.ticks&&"discrete"!==this.scale.type?this.ticks[0]:this._state.tickAlignment;},setScale:function(scale,noWrap){var hadPrevScale=!!this.scale;this.base(scale,noWrap);if(hadPrevScale){delete this.domain;delete this.domainNice;delete this.ticks;delete this._roundingOverflow;}
if(scale&&!scale.isNull&&"discrete"!==this.scaleType){this.domain=scale.domain();this.domain.minLocked=!!scale.minLocked;this.domain.maxLocked=!!scale.maxLocked;var tickFormatter=this.option("TickFormatter");tickFormatter&&scale.tickFormatter(tickFormatter);"nice"===this.option("DomainRoundMode")&&"numeric"===scale.type&&scale.nice();this.domainNice=scale.domain();}
return this;},setTicks:function(ticks){var scale=this.scale;scale&&!scale.isNull||def.fail.operationInvalid("Scale must be set and non-null.");this.ticks=ticks;delete this._roundingOverflow;if("discrete"!==scale.type&&"tick"===this.option("DomainRoundMode")){delete this._roundingOverflow;var tickCount=ticks?ticks.length:0;if(tickCount>=2){this._adjustDomain(scale,ticks[0],ticks[tickCount-1])&&this._removeTicks(ticks);}else this._adjustDomain(scale,null,null,!0);}},_adjustDomain:function(scale,minIfLower,maxIfGreater,force){var domainNice=this.domainNice;if(!domainNice)return!1;var dOrigMin=+domainNice[0],dOrigMax=+domainNice[1];if(null==dOrigMin||null==dOrigMax)return!1;var dmin=null!=minIfLower?Math.min(+minIfLower,dOrigMin):dOrigMin,dmax=null!=maxIfGreater?Math.max(+maxIfGreater,dOrigMax):dOrigMax,wasDomainAligned=!1,axisRangeLength=scale.size;if(axisRangeLength){var ratio=this._state.ratio||this.option("Ratio");if(null!=ratio){wasDomainAligned=!0;var axisDomainLength=axisRangeLength/ratio;switch(this.option("DomainAlign")){case"min":dmax=dmin+axisDomainLength;break;case"max":dmin=dmax-axisDomainLength;break;case"center":var center=dmax-(dmax-dmin)/2;dmax=center+axisDomainLength/2;dmin=center-axisDomainLength/2;}}}
if(!force&&pv.floatEqual(dmin,dOrigMin)&&pv.floatEqual(dmax,dOrigMax))return!1;var readDimName=this.role.grouping.firstDimension.name,dim=this.chart.data.owner.dimensions(readDimName);dmin=dim.read(dmin).value;dmax=dim.read(dmax).value;scale.domain(dmin,dmax);return wasDomainAligned;},_removeTicks:function(ticks){var opts=this.option;if(this._state.ratio||opts("Ratio")){var ti=ticks[0],tf=ticks[ticks.length-1],adjustedDomain=this.scale.domain(),li=this.chart.axesPanels[this.id]._layoutInfo;if(ticks!==li.ticks)throw new Error("Assertion failed.");var removeTick=function(tick){var index=ticks.indexOf(tick);ticks.splice(index,1);li.ticksText.splice(index,1);};switch(opts("DomainAlign")){case"min":tf>adjustedDomain[1]&&removeTick(tf);break;case"max":ti<adjustedDomain[0]&&removeTick(ti);break;default:tf>adjustedDomain[1]&&removeTick(tf);ti<adjustedDomain[0]&&removeTick(ti);}}},setScaleRange:function(size){var rangeInfo=this.getScaleRangeInfo();rangeInfo&&(null!=rangeInfo.value?size=rangeInfo.value:null!=rangeInfo.min&&(size=Math.max(Math.min(size,rangeInfo.max),rangeInfo.min)));var scale=this.scale;scale.min=0;scale.max=size;scale.size=size;delete this._roundingOverflow;if("discrete"===scale.type)rangeInfo&&("abs"===rangeInfo.mode?scale.splitBandedCenterAbs(scale.min,scale.max,rangeInfo.band,rangeInfo.space):scale.splitBandedCenter(scale.min,scale.max,rangeInfo.ratio));else{scale.range(scale.min,scale.max);this._adjustDomain(scale);}
return scale;},getScaleRangeInfo:function(){if(!this.isDiscrete())return null;var layoutInfo=pvc.visual.discreteBandsLayout(this.domainItemCount(),this.option("BandSize"),this.option("BandSizeMin")||0,this.option("BandSizeMax"),this.option("BandSpacing"),this.option("BandSpacingMin")||0,this.option("BandSpacingMax"),this.option("BandSizeRatio"));return layoutInfo&&this.chart.visualRoles.multiChart.isBound()?{mode:"rel",min:0,max:1/0,ratio:layoutInfo.ratio}:layoutInfo;},getRoundingOverflow:function(){var roundingOverflow=this._roundingOverflow;if(!roundingOverflow){roundingOverflow=this._roundingOverflow={begin:0,end:0,beginLocked:!1,endLocked:!1};var scale=this.scale,domainOriginal=this.domain;if(scale&&domainOriginal&&!scale.isNull&&"discrete"!==scale.type){roundingOverflow.beginLocked=domainOriginal.minLocked;roundingOverflow.endLocked=domainOriginal.maxLocked;if(null!=scale.size&&"tick"===this.option("DomainRoundMode")){var domainRounded=scale.domain(),roundingBegin=domainOriginal[0]-domainRounded[0],roundingEnd=domainRounded[1]-domainOriginal[1],eps=pv.epsilon;if(roundingBegin>eps||roundingEnd>eps){var zeroPos=scale(0);roundingBegin>eps&&(roundingOverflow.begin=scale(roundingBegin)-zeroPos);roundingEnd>eps&&(roundingOverflow.end=scale(roundingEnd)-zeroPos);}}}}
return roundingOverflow;},calcContinuousTicks:function(tickCountMax){return this.scale.ticks(this.desiredTickCount(),{roundInside:"tick"!==this.option("DomainRoundMode"),alignmentValue:this._state.tickAlignment,tickCountMax:tickCountMax,precision:this.option("TickUnit"),precisionMin:this.tickUnitMinEf(),precisionMax:this.tickUnitMaxEf()});},desiredTickCount:function(){var desiredTickCount=this.option("DesiredTickCount"),isDate="timeSeries"===this.scaleType;return null==desiredTickCount?isDate?null:1/0:isDate&&isFinite(desiredTickCount)&&desiredTickCount>10?10:desiredTickCount;},tickUnitMinEf:function(){var unitMin=this.option("TickUnitMin"),expoMin=this.option("TickExponentMin");null==unitMin&&(unitMin=0);null!=expoMin&&isFinite(expoMin)&&(unitMin=Math.max(unitMin,Math.pow(10,Math.floor(expoMin))));return unitMin;},tickUnitMaxEf:function(){var unitMax=this.option("TickUnitMax"),expoMax=this.option("TickExponentMax");null==unitMax&&(unitMax=1/0);null!=expoMax&&isFinite(expoMax)&&(unitMax=Math.min(unitMax,9.999*Math.pow(10,Math.floor(expoMax))));return unitMax;},_registerResolversNormal:function(rs,keyArgs){this.chart.compatVersion()<=1&&rs.push(this._resolveByV1OnlyLogic);rs.push(this._resolveByOptionId,this._resolveByOrientedId);1===this.index&&rs.push(this._resolveByV1OptionId);rs.push(this._resolveByScaleType,this._resolveByCommonId);},_resolveByOrientedId:pvc.options.specify(function(optionInfo){return this._chartOption(this.orientedId+"Axis"+optionInfo.name);}),_resolveByV1OptionId:pvc.options.specify(function(optionInfo){return this._chartOption("secondAxis"+optionInfo.name);}),_resolveByScaleType:pvc.options.specify(function(optionInfo){var st=this.scaleType;if(st){var name=optionInfo.name,value=this._chartOption(st+"Axis"+name);void 0===value&&"discrete"!==st&&(value=this._chartOption("continuousAxis"+name));return value;}}),_resolveByCommonId:pvc.options.specify(function(optionInfo){return this._chartOption("axis"+optionInfo.name);})}}));pvc_CartesianAxis.getOrientation=function(type,chartOrientation){return"base"===type==("vertical"===chartOrientation)?"x":"y";};pvc_CartesianAxis.getOrientedId=function(orientation,index){return 0===index?orientation:orientation+(index+1);};var cartAxis_fixedMinMaxSpec={resolve:"_resolveFull",data:{resolveV1:function(optionInfo){this.index||"ortho"!==this.type||this._specifyChartOption(optionInfo,this.id+optionInfo.name);return!0;}}},cartAxis_normalV1Data={resolveV1:function(optionInfo){if(this.index){if(this._resolveByV1OptionId(optionInfo))return!0;}else if(this._resolveByOrientedId(optionInfo))return!0;this._resolveDefault(optionInfo);return!0;}},defaultPosition=pvc.options.defaultValue(function(optionInfo){if(!this.typeIndex)return"x"===this.orientation?"bottom":"left";var firstAxis=this.chart.axesByType[this.type].first,position=firstAxis.option("Position");return pvc.BasePanel.oppositeAnchor[position];});pvc_CartesianAxis.options({Visible:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){if(this.index<=1){var v1OptionId=0===this.index?def.firstUpperCase(this.orientation):"Second";this._specifyChartOption(optionInfo,"show"+v1OptionId+"Scale");}
return!0;}},cast:Boolean,value:!0},Composite:{resolve:function(optionInfo){return this.index>0?(optionInfo.specify(!1),!0):this._resolveFull(optionInfo);},data:{resolveV1:function(optionInfo){return this._specifyChartOption(optionInfo,"useCompositeAxis"),!0;}},cast:Boolean,value:!1},Size:{resolve:"_resolveFull",data:cartAxis_normalV1Data,cast:cartAxis_castSize},SizeMax:{resolve:"_resolveFull",cast:cartAxis_castSize},Position:{resolve:"_resolveFull",data:{resolveV1:cartAxis_normalV1Data.resolveV1,resolveDefault:defaultPosition},cast:pvc_castAxisPosition},FixedMin:cartAxis_fixedMinMaxSpec,FixedMax:cartAxis_fixedMinMaxSpec,FixedLength:{resolve:"_resolveFull",cast:pvc.parseAxisFixedLength},Ratio:{resolve:"_resolveFull",cast:pvc.parseAxisRatio},DomainAlign:{resolve:"_resolveFull",cast:pvc.parseDomainAlign,value:"center"},PreserveRatio:{resolve:"_resolveFull",cast:Boolean,value:!1},OriginIsZero:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){switch(this.index){case 0:this._specifyChartOption(optionInfo,"originIsZero");break;case 1:this.chart._allowV1SecondAxis&&this._specifyChartOption(optionInfo,"secondAxisOriginIsZero");}
return!0;}},cast:Boolean,value:!0},DomainScope:{resolve:"_resolveFull",cast:pvc_castDomainScope,value:"global"},Offset:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){switch(this.index){case 0:this._specifyChartOption(optionInfo,"axisOffset");break;case 1:this.chart._allowV1SecondAxis&&this._specifyChartOption(optionInfo,"secondAxisOffset");}
return!0;}},cast:def.number.to},BandSizeRatio:{resolve:function(optionInfo){return this._resolveFull(optionInfo)||this._specifyChartOption(optionInfo,"panelSizeRatio");},cast:function(v){v=def.number.toNonNegative(v);null!=v&&v>1&&(v=null);return v;},getDefault:function(){return this.chart._defaultAxisBandSizeRatio;}},BandSize:{resolve:"_resolveFull",cast:def.number.toNonNegative},BandSpacing:{resolve:"_resolveFull",cast:def.number.toNonNegative},BandSizeMin:{resolve:"_resolveFull",cast:def.number.toNonNegative},BandSpacingMin:{resolve:"_resolveFull",cast:def.number.toNonNegative},BandSizeMax:{resolve:"_resolveFull",cast:def.number.toNonNegative},BandSpacingMax:{resolve:"_resolveFull",cast:def.number.toNonNegative},LabelSpacingMin:{resolve:"_resolveFull",cast:def.number.to},LabelRotationDirection:{resolve:"_resolveFull",cast:pvc.parseLabelRotationDirection,value:"clockwise"},LabelDesiredAngles:{resolve:"_resolveFull",cast:cartAxis_labelDesiredAngles,value:[]},OverlappedLabelsMode:{resolve:"_resolveFull",cast:pvc.parseOverlappedLabelsMode,value:"hide"},Grid:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){this.index||this._specifyChartOption(optionInfo,this.orientation+"AxisFullGrid");return!0;}},cast:Boolean,value:!1},GridCrossesMargin:{resolve:"_resolveFull",cast:Boolean,value:!0},EndLine:{resolve:"_resolveFull",cast:Boolean},ZeroLine:{resolve:"_resolveFull",cast:Boolean,value:!0},RuleCrossesMargin:{resolve:"_resolveFull",cast:Boolean,value:!0},Ticks:{resolve:"_resolveFull",cast:Boolean},DesiredTickCount:{resolve:"_resolveFull",data:{resolveV1:cartAxis_normalV1Data.resolveV1,resolveDefault:function(optionInfo){if(this.chart.compatVersion()<=1)return optionInfo.defaultValue(5),!0;}},cast:def.number.toPositive},MinorTicks:{resolve:"_resolveFull",data:cartAxis_normalV1Data,cast:Boolean,value:!0},TickFormatter:{resolve:"_resolveFull",cast:def.fun.as},DomainRoundMode:{resolve:"_resolveFull",data:{resolveV1:cartAxis_normalV1Data.resolveV1,resolveDefault:function(optionInfo){if(this.chart.compatVersion()<=1)return optionInfo.defaultValue("none"),!0;}},cast:pvc.parseDomainRoundingMode,value:"tick"},TickExponentMin:{resolve:"_resolveFull",cast:def.number.to},TickExponentMax:{resolve:"_resolveFull",cast:def.number.to},TickUnit:{resolve:"_resolveFull"},TickUnitMin:{resolve:"_resolveFull"},TickUnitMax:{resolve:"_resolveFull"},PreserveTickAlignment:{resolve:"_resolveFull",cast:Boolean},Title:{resolve:"_resolveFull",cast:String},TitleVisible:{resolve:"_resolveFull",cast:Boolean,getDefault:function(){return!def.empty(this.option("Title"));}},TitleSize:{resolve:"_resolveFull",cast:cartAxis_castTitleSize},TitleSizeMax:{resolve:"_resolveFull",cast:cartAxis_castTitleSize},TitleFont:{resolve:"_resolveFull",cast:String},TitleMargins:{resolve:"_resolveFull",cast:pvc_Sides.as},TitlePaddings:{resolve:"_resolveFull",cast:pvc_Sides.as},TitleAlign:{resolve:"_resolveFull",cast:function(align){var position=this.option("Position");return pvc.parseAlign(position,align);}},Font:{resolve:"_resolveFull",cast:String},ClickAction:{resolve:"_resolveFull",data:cartAxis_normalV1Data},DoubleClickAction:{resolve:"_resolveFull",data:cartAxis_normalV1Data},TooltipEnabled:{resolve:"_resolveFull",cast:Boolean,value:!0},TooltipFormat:{resolve:"_resolveFull",cast:def.fun.as,value:null},TooltipAutoContent:{resolve:"_resolveFull",cast:pvc.parseTooltipAutoContent,value:"value"}});def.type("pvc.visual.CartesianAxisRootScene",pvc.visual.Scene);def.type("pvc.visual.CartesianAxisTickScene",pvc.visual.Scene).init(function(parent,keyArgs){this.base(parent,keyArgs);this.vars.tick=new pvc_ValueLabelVar(def.get(keyArgs,"tick"),def.get(keyArgs,"tickLabel"),def.get(keyArgs,"tickRaw"));def.get(keyArgs,"isHidden")&&(this.isHidden=!0);}).add({isHidden:!1});def.type("pvc.AxisPanel",pvc.BasePanel).init(function(chart,parent,axis,options){options=def.create(options,{anchor:axis.option("Position")});var anchor=options.anchor||this.anchor;null==options.paddings&&(options.paddings=pvc_Sides.filterAnchor(anchor,chart._axisOffsetPct));this.axis=axis;this.base(chart,parent,options);this.roleName=axis.role.name;this.isDiscrete=axis.role.isDiscrete();this._extensionPrefix=axis.extensionPrefixes;null==this.labelSpacingMin&&(this.labelSpacingMin=this.isDiscrete?.25:1.1);null==this.showTicks&&(this.showTicks=!this.isDiscrete);if(void 0===options.font){var extFont=this._getConstantExtension("label","font");extFont&&(this.font=extFont);}
if(void 0===options.tickLength){var tickLength=+this._getConstantExtension("ticks",this.anchorOrthoLength(anchor));!isNaN(tickLength)&&isFinite(tickLength)&&(this.tickLength=tickLength);}
var showLabels=this._getConstantExtension("label","visible");null==showLabels||showLabels||(this.showLabels=!1);}).add({pvRule:null,pvTicks:null,pvLabel:null,pvRuleGrid:null,pvScale:null,isDiscrete:!1,roleName:null,axis:null,anchor:"bottom",tickLength:6,scale:null,ruleCrossesMargin:!0,font:"9px sans-serif",labelSpacingMin:null,showMinorTicks:!0,showTicks:null,showLabels:!0,hiddenLabelText:"",_isScaleSetup:!1,_createLogId:function(){return this.base()+" - "+this.axis.id;},getTicks:function(){return this._layoutInfo&&this._layoutInfo.ticks;},_calcLayout:function(layoutInfo){var scale=this.axis.scale,clientSize=layoutInfo.clientSize;if(!this._isScaleSetup){this.pvScale=scale;this.scale=scale;this.extend(scale,"scale");this._isScaleSetup=!0;}
if(scale.isNull)layoutInfo.axisSize=layoutInfo.restrictions.clientSize[this.anchorOrthoLength()]||0;else{var a_length=this.anchorLength(),rangeInfo=this.axis.getScaleRangeInfo();rangeInfo&&(null!=rangeInfo.value?clientSize[a_length]=rangeInfo.value:null!=rangeInfo.min&&(clientSize[a_length]=Math.max(Math.min(clientSize[a_length],rangeInfo.max),rangeInfo.min)));this.axis.setScaleRange(clientSize[a_length]);this._calcLayoutCore(layoutInfo);}
return this.createAnchoredSize(layoutInfo.axisSize,clientSize);},_calcLayoutCore:function(layoutInfo){var axisSize=layoutInfo.restrictions.clientSize[this.anchorOrthoLength()];layoutInfo.axisSize=axisSize;if(this.isDiscrete&&this.useCompositeAxis)null==layoutInfo.axisSize&&(layoutInfo.axisSize=50);else{this._readTextProperties(layoutInfo);this._calcTicks();if("discrete"===this.scale.type){var overlappedLabelsMode=this.axis.option("OverlappedLabelsMode"),labelRotationDirection="counterclockwise"===this.axis.option("LabelRotationDirection")?-1:1,labelDesiredAngles=this.axis.option("LabelDesiredAngles"),distanceBetweenTicks=this.scale.range().step,labelSpacingMin=this.labelSpacingMin,fontPxWidth=pv.Text.measureWidth("x",this.font),anchor=this.anchor;pvc.AxisPanel._calcDiscreteOverlapSettings(overlappedLabelsMode,labelRotationDirection,labelDesiredAngles,distanceBetweenTicks,labelSpacingMin,fontPxWidth,anchor,layoutInfo);}
this._calcAxisSizeFromLabelBBox(layoutInfo);null==layoutInfo.axisSize&&(layoutInfo.axisSize=layoutInfo.requiredAxisSize);this._calcMaxTextLengthThatFits();this._calcContentOverflowOptional();}},_readTextProperties:function(layoutInfo){var textAngle=this._getExtension("label","textAngle");layoutInfo.textAngle=def.number.to(textAngle,0);layoutInfo.textMargin=def.number.to(this._getExtension("label","textMargin"),3);var align=this._getExtension("label","textAlign");"string"!=typeof align&&(align=this.isAnchorTopOrBottom()?"center":"left"==this.anchor?"right":"left");layoutInfo.textAlign=align;var baseline=this._getExtension("label","textBaseline");if("string"!=typeof baseline)switch(this.anchor){case"right":case"left":case"center":baseline="middle";break;case"bottom":baseline="top";break;default:baseline="bottom";}
layoutInfo.textBaseline=baseline;},_calcAxisSizeFromLabelBBox:function(layoutInfo){var maxLabelBBox=this.showLabels?this._calcMaxLabelBBox():null,length=maxLabelBBox?this._getLabelBBoxQuadrantLength(maxLabelBBox,this.anchor):0,axisSize=(this.showTicks||this.showLabels?this.tickLength:0)+length,angle=maxLabelBBox?maxLabelBBox.sourceAngle:0;!this.showLabels||0===angle&&this.isAnchorTopOrBottom()||(axisSize+=this.tickLength);layoutInfo.requiredAxisSize=Math.max(1,axisSize,def.number.as(this._getConstantExtension("rule","linewidth"),1)/2);},_getLabelBBoxQuadrantLength:function(labelBBox,quadrantSide){var length;switch(quadrantSide){case"left":length=-labelBBox.x;break;case"right":length=labelBBox.x2;break;case"top":length=-labelBBox.y;break;case"bottom":length=labelBBox.y2;}
return Math.max(length,0);},_calcContentOverflowOptional:function(){this._layoutInfo.restrictions.canChange?this.showLabels&&this._calcContentOverflowOptionalFromLabelBBox():def.debug>=2&&this.log.warn("Layout cannot change. Skipping calculation of optional content overflow.");},_calcContentOverflowOptionalFromLabelBBox:function(){var contentOverflowOptional=null,me=this,li=me._layoutInfo,ticks=li.ticks;if(ticks.length){var ticksBBoxes=li.ticksBBoxes||this._calcTicksLabelBBoxes(li),isTopOrBottom=me.isAnchorTopOrBottom(),begSide=isTopOrBottom?"left":"bottom",endSide=isTopOrBottom?"right":"top",scale=me.scale,isDiscrete="discrete"===scale.type,includeModulo=isDiscrete?li.tickVisibilityStep:1,clientLength=li.clientSize[me.anchorLength()],evalLabelSideOverflow=function(labelBBox,side,isBegin,index){if(!(includeModulo>1&&index%includeModulo!=0)){var sideLength=me._getLabelBBoxQuadrantLength(labelBBox,side);if(sideLength>1){var anchorPosition=scale(isDiscrete?ticks[index].value:ticks[index]),sidePosition=isBegin?anchorPosition-sideLength:anchorPosition+sideLength,sideOverflow=Math.max(0,isBegin?-sidePosition:sidePosition-clientLength);if(sideOverflow>1){sideOverflow-=li.paddings[side]||0;if(sideOverflow>1){isDiscrete&&(sideOverflow*=1.05);if(contentOverflowOptional){var currrOverflowPadding=contentOverflowOptional[side];(null==currrOverflowPadding||currrOverflowPadding<sideOverflow)&&(contentOverflowOptional[side]=sideOverflow);}else contentOverflowOptional=def.set({},side,sideOverflow);}}}}};ticksBBoxes.forEach(function(labelBBox,index){evalLabelSideOverflow(labelBBox,begSide,!0,index);evalLabelSideOverflow(labelBBox,endSide,!1,index);});def.debug>=6&&contentOverflowOptional&&me.log("ContentOverflowOptional = "+def.describe(contentOverflowOptional));}
li.contentOverflowOptional=contentOverflowOptional;},_calcMaxTextLengthThatFits:function(){var layoutInfo=this._layoutInfo;if(!this.showLabels||this.compatVersion()<=1)layoutInfo.maxTextWidth=null;else{var availableClientLength=layoutInfo.clientSize[this.anchorOrthoLength()],efSize=Math.min(layoutInfo.axisSize,availableClientLength);if(efSize>=layoutInfo.requiredAxisSize-this.tickLength)layoutInfo.maxTextWidth=null;else{var mostOrthoDistantPoint,parallelDirection,maxLabelBBox=layoutInfo.maxLabelBBox,maxOrthoLength=efSize-this.tickLength;switch(this.anchor){case"left":parallelDirection=pv.vector(0,1);mostOrthoDistantPoint=pv.vector(-maxOrthoLength,0);break;case"right":parallelDirection=pv.vector(0,1);mostOrthoDistantPoint=pv.vector(maxOrthoLength,0);break;case"top":parallelDirection=pv.vector(1,0);mostOrthoDistantPoint=pv.vector(0,-maxOrthoLength);break;case"bottom":parallelDirection=pv.vector(1,0);mostOrthoDistantPoint=pv.vector(0,maxOrthoLength);}
var orthoOutwardsDir=mostOrthoDistantPoint.norm(),corners=maxLabelBBox.source.points(),botL=corners[0],botR=corners[1],topR=corners[2],topL=corners[3],topLRSideDir=topR.minus(topL),botLRSideDir=botR.minus(botL),intersect=pv.SvgScene.lineIntersect,botI=intersect(mostOrthoDistantPoint,parallelDirection,botL,botLRSideDir),topI=intersect(mostOrthoDistantPoint,parallelDirection,topL,topLRSideDir),sideLRWidth=maxLabelBBox.sourceTextWidth,maxTextWidth=sideLRWidth,botLI=botI.minus(botL),botLILen=botLI.length();botLILen<=sideLRWidth&&botLI.dot(topLRSideDir)>=0&&(maxTextWidth=botL.dot(orthoOutwardsDir)<botR.dot(orthoOutwardsDir)?botLILen:botI.minus(botR).length());var topLI=topI.minus(topL),topLILen=topLI.length();topLILen<=sideLRWidth&&topLI.dot(topLRSideDir)>=0&&(maxTextWidth=topL.dot(orthoOutwardsDir)<topR.dot(orthoOutwardsDir)?Math.min(maxTextWidth,topLILen):Math.min(maxTextWidth,topI.minus(topR).length()));if("center"===maxLabelBBox.sourceAlign){maxTextWidth-=sideLRWidth-maxTextWidth;}
layoutInfo.maxTextWidth=maxTextWidth;layoutInfo.maxLabelBBox=this._calcLabelBBox(maxTextWidth);def.debug>=3&&this.log("Trimming labels' text at length "+maxTextWidth.toFixed(2)+"px maxOrthoLength="+maxOrthoLength.toFixed(2)+"px");}}},_calcTicks:function(){var layoutInfo=this._layoutInfo;layoutInfo.textHeight=4*pv.Text.fontHeight(this.font)/5;layoutInfo.maxTextWidth=null;this.axis.setTicks(null);switch(this.scale.type){case"discrete":this._calcDiscreteTicks();break;case"timeSeries":case"numeric":this._calcContinuousTicks();break;default:throw def.error.operationInvalid("Undefined axis scale type");}
this.axis.setTicks(this._layoutInfo.ticks);null==layoutInfo.maxTextWidth&&this._calcTicksTextLength(layoutInfo);},_calcDiscreteTicks:function(){var axis=this.axis,layoutInfo=this._layoutInfo;layoutInfo.ticks=axis.domainItems();var format,grouping=axis.role.grouping,tickFormatter=axis.option("TickFormatter");if(this.getCompatFlag("discreteTimeSeriesTickFormat")&&grouping.isSingleDimension&&grouping.singleDimensionType.valueType===Date){var domainValues=axis.domainValues(),extent=def.query(domainValues).range();if(extent&&extent.min!==extent.max){var scale=new pv.Scale.linear(extent.min,extent.max),ticks=scale.ticks();if(tickFormatter){def.copyProps(domainValues,ticks,["step","base","mult","format"]);format=function(child,index){return tickFormatter.call(domainValues,domainValues[index],domainValues.step,index);};}else format=function(child,index){return ticks.format(domainValues[index]);};}else if(tickFormatter){var dimFormatter=grouping.singleDimensionType.formatter();domainValues.step=domainValues.base=pvc.time.intervals.d;domainValues.mult=1;domainValues.format=function(value){return dimFormatter(value);};format=function(child,index){return tickFormatter.call(domainValues,domainValues[index],domainValues.step,index);};}}else if(tickFormatter){var domainValueProp=axis.domainItemValueProp();format=function(child){var value=child[domainValueProp];return tickFormatter(value,child.absLabel);};}
format||(format=function(child){return child.absLabel;});layoutInfo.ticksText=layoutInfo.ticks.map(format);this._clearTicksTextDeps(layoutInfo);},_clearTicksTextDeps:function(ticksInfo){ticksInfo.maxTextWidth=ticksInfo.ticksTextLength=ticksInfo.ticksBBoxes=null;},_calcContinuousTicks:function(){var doLog=def.debug>=7;doLog&&this.log.group("_calcContinuousTicks");var layoutInfo=this._layoutInfo;layoutInfo.ticks=layoutInfo.ticksText=null;var bandSizeMin=this._calcContinuousBandSizeMin(),clientLength=layoutInfo.clientSize[this.anchorLength()],tickCountMax=this._calcContinuousTickCountMax(bandSizeMin,clientLength),ticks=layoutInfo.ticks,roundOutside="tick"===this.axis.option("DomainRoundMode");if(!ticks||ticks.length>(roundOutside?3:1)&&ticks.length>tickCountMax){this._calcContinuousTicksValue(layoutInfo,tickCountMax);this._calcContinuousTicksText(layoutInfo);ticks=layoutInfo.ticks;}
if(roundOutside){var L=ticks.length;if(L>tickCountMax&&tickCountMax<=2&&L<=3&&(L-1)*bandSizeMin>clientLength)if(3===L){layoutInfo.ticksText[0]="";layoutInfo.ticksText[2]="";layoutInfo.maxTextWidth=null;}else if(2===L){layoutInfo.ticksText[ticks[1]?1:0]="";layoutInfo.maxTextWidth=null;}}
def.debug>=5&&this.log.info("RESULT count="+ticks.length+" step="+ticks.step);doLog&&this.log.groupEnd();},_calcContinuousTicksValue:function(ticksInfo,tickCountMax){ticksInfo.ticks=this.axis.calcContinuousTicks(tickCountMax);if(def.debug>4){this.log("DOMAIN: "+def.describe(this.scale.domain()));this.log("TICKS:  "+def.describe(ticksInfo.ticks));}},_calcContinuousTicksText:function(ticksInfo){var ticksText=ticksInfo.ticksText=ticksInfo.ticks.map(function(tick,index){return this.scale.tickFormat(tick,index);},this);this._clearTicksTextDeps(ticksInfo);return ticksText;},_calcContinuousTickCountMax:function(Bmin,TS){if(!Bmin&&this.showLabels)return 1;var li=this._layoutInfo,E=li.textHeight*Math.max(0,this.labelSpacingMin);return 1+Math.floor(TS/(Bmin+E));},_calcContinuousBandSizeMin:function(){var domain=this.scale.domain(),span=Math.abs(domain[1]-domain[0]);if(span<1e-10||!isFinite(span))return 0;var li=this._layoutInfo;if(this.isAnchorTopOrBottom()){this._calcContinuousTicksValue(li);this._calcTicksTextLength(li);return Math.max(li.maxTextWidth,li.textHeight);}
return li.textHeight;},_calcTicksTextLength:function(ticksInfo){var max=0,font=this.font,ticksText=ticksInfo.ticksText||this._calcContinuousTicksText(ticksInfo),ticksTextLength=ticksInfo.ticksTextLength=ticksText.map(function(text){var len=pv.Text.measureWidth(text,font);len>max&&(max=len);return len;});ticksInfo.maxTextWidth=ticksInfo.maxTextWidthReal=max;ticksInfo.ticksBBoxes=null;ticksInfo.maxLabelBBox=null;return ticksTextLength;},_calcTicksLabelBBoxes:function(ticksInfo){var me=this,li=me._layoutInfo,ticksTextLength=ticksInfo.ticksTextLength||me._calcTicksTextLength(ticksInfo),maxLen=li.maxTextWidth||li.maxTextWidthReal,maxBBox=null;ticksInfo.ticksBBoxes=ticksTextLength.map(function(len){var labelBBox=me._calcLabelBBox(Math.min(len,maxLen));maxBBox||len!==maxLen||(maxBBox=labelBBox);return labelBBox;},me);li.maxLabelBBox=maxBBox;return ticksInfo.ticksBBoxes;},_calcMaxLabelBBox:function(){var li=this._layoutInfo;li.ticksTextLength||this._calcTicksTextLength(li);return li.maxLabelBBox=this._calcLabelBBox(li.maxTextWidth);},_calcLabelBBox:function(textWidth){var li=this._layoutInfo;return pvc.text.getLabelBBox(textWidth,li.textHeight,li.textAlign,li.textBaseline,li.textAngle,li.textMargin);},_createCore:function(){if(!this.scale.isNull){var clientSize=this._layoutInfo.clientSize,paddings=this._layoutInfo.paddings,begin_a=this.anchorOrtho(),end_a=this.anchorOpposite(begin_a),size_a=this.anchorOrthoLength(begin_a),rMin=this.ruleCrossesMargin?-paddings[begin_a]:0,rMax=clientSize[size_a]+(this.ruleCrossesMargin?paddings[end_a]:0),rSize=rMax-rMin;this._rSize=rSize;var rootScene=this._getRootScene();this.pvRule=new pvc.visual.Rule(this,this.pvPanel,{extensionId:"rule"}).lock("data",[rootScene]).override("defaultColor",def.fun.constant("#666666")).lock(this.anchorOpposite(),0).lock(begin_a,rMin).lock(size_a,rSize).pvMark.zOrder(30).strokeDasharray(null).lineCap("square");this.isDiscrete?this.useCompositeAxis?this.renderCompositeOrdinalAxis():this.renderOrdinalAxis():this.renderLinearAxis();}},_getExtensionId:function(){return"";},_getRootScene:function(){if(!this._rootScene){var rootScene=this._rootScene=new pvc.visual.CartesianAxisRootScene(null,{panel:this,source:this._getRootData()}),layoutInfo=this._layoutInfo,ticks=layoutInfo.ticks,ticksText=layoutInfo.ticksText;if(this.isDiscrete)if(this.useCompositeAxis)this._buildCompositeScene(rootScene);else{var hiddenDatas,hiddenTexts,createHiddenScene,hiddenIndex,keySep,includeModulo=layoutInfo.tickVisibilityStep,hiddenLabelText=this.hiddenLabelText;rootScene.vars.tickIncludeModulo=includeModulo;rootScene.vars.hiddenLabelText=hiddenLabelText;if(includeModulo>2){def.debug>=3&&this.log.info("Showing only one in every "+includeModulo+" tick labels");keySep=rootScene.group.owner.keySep;createHiddenScene=function(){var k=hiddenDatas.map(function(d){return d.key;}).join(keySep),l=hiddenTexts.slice(0,10).join(", ")+(hiddenTexts.length>10?", ...":"");new pvc.visual.CartesianAxisTickScene(rootScene,{source:hiddenDatas,tick:k,tickRaw:k,tickLabel:l,isHidden:!0}).dataIndex=hiddenIndex;hiddenDatas=hiddenTexts=hiddenIndex=null;};}
ticks.forEach(function(tickData,index){var isHidden=index%includeModulo!=0;if(isHidden&&includeModulo>2){null==hiddenIndex&&(hiddenIndex=index);(hiddenDatas||(hiddenDatas=[])).push(tickData);(hiddenTexts||(hiddenTexts=[])).push(ticksText[index]);}else{hiddenDatas&&createHiddenScene();new pvc.visual.CartesianAxisTickScene(rootScene,{source:tickData,tick:tickData.value,tickRaw:tickData.rawValue,tickLabel:ticksText[index],isHidden:isHidden}).dataIndex=index;}});hiddenDatas&&createHiddenScene();}else ticks.forEach(function(majorTick,index){new pvc.visual.CartesianAxisTickScene(rootScene,{tick:majorTick,tickRaw:majorTick,tickLabel:ticksText[index]}).dataIndex=index;},this);}
return this._rootScene;},_buildCompositeScene:function(rootScene){function recursive(scene){var data=scene.group;if(isV1Compat){var tickVar=scene.vars.tick;scene.nodeValue=scene.value=tickVar.rawValue;scene.nodeLabel=scene.label=tickVar.label;}
data.childCount()&&data.children().each(function(childData){var label=tickFormatter?tickFormatter(childData.value,childData.label):childData.label,childScene=new pvc.visual.CartesianAxisTickScene(scene,{source:childData,tick:childData.value,tickRaw:childData.rawValue,tickLabel:label});childScene.dataIndex=childData.childIndex();recursive(childScene);});}
var isV1Compat=this.compatVersion()<=1,tickFormatter=this.axis.option("TickFormatter");rootScene.vars.tick=new pvc_ValueLabelVar("","");recursive(rootScene);},_getRootData:function(){var data;if(this.isDiscrete&&this.useCompositeAxis){var orient=this.anchor,ka={visible:!!this.axis.domainVisibleOnly()||null,isNull:!this.chart.options.ignoreNulls&&!this.axis.domainIgnoreNulls()&&null,reverse:"bottom"==orient||"left"==orient,extensionDataSetsMap:this.axis.boundDimensionsDataSetsMap};data=this.axis.role.select(this.data,ka);}else data=this.data;return data;},renderOrdinalAxis:function(){var wrapper,scale=this.scale,hiddenLabelText=this.hiddenLabelText,includeModulo=this._layoutInfo.tickVisibilityStep,hiddenStep2=includeModulo*scale.range().step/2,anchorOpposite=this.anchorOpposite(),anchorLength=this.anchorLength(),anchorOrtho=this.anchorOrtho(),anchorOrthoLength=this.anchorOrthoLength(),pvRule=this.pvRule,rootScene=this._getRootScene(),layoutInfo=this._layoutInfo,isV1Compat=this.compatVersion()<=1;if(isV1Compat){var DataElement=function(tickVar){this.value=this.absValue=tickVar.rawValue;this.nodeName=""+(this.value||"");this.path=this.nodeName?[this.nodeName]:[];this.label=this.absLabel=tickVar.label;};DataElement.prototype.toString=function(){return""+this.value;};wrapper=function(v1f){return function(tickScene){var markWrapped=Object.create(this);markWrapped.index=this.parent.index;return v1f.call(markWrapped,new DataElement(tickScene.vars.tick));};};}
var pvTicksPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"}).lock("data",rootScene.childNodes).lock(anchorOpposite,0).lockMark(anchorOrtho,function(tickScene){return tickScene.isHidden?scale(tickScene.previousSibling.vars.tick.value)+hiddenStep2:scale(tickScene.vars.tick.value);}).lock("strokeDasharray",null).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",0).pvMark.zOrder(20);(isV1Compat||this.showTicks)&&(this.pvTicks=new pvc.visual.Rule(this,pvTicksPanel,{extensionId:"ticks",wrapper:wrapper}).lock("data").intercept("visible",function(scene){return!scene.isHidden&&this.delegateExtension(!0);}).optional("lineWidth",1).lock(anchorOpposite,0).lock(anchorOrtho,0).lock(anchorLength,null).optional(anchorOrthoLength,2*this.tickLength/3).override("defaultColor",function(){return isV1Compat?pv.Color.names.transparent:pvRule.scene?pvRule.scene[0].strokeStyle:"#666666";}).pvMark);var font=this.font,maxTextWidth=this._layoutInfo.maxTextWidth;isFinite(maxTextWidth)||(maxTextWidth=0);this.pvLabel=new pvc.visual.Label(this,pvTicksPanel,{extensionId:"label",showsInteraction:!0,noClick:!1,noDoubleClick:!1,noSelect:!1,noTooltip:!1,noHover:!1,wrapper:wrapper}).intercept("visible",function(tickScene){return tickScene.isHidden?!!tickScene.vars.hiddenLabelText:this.delegateExtension(!0);}).intercept("text",function(tickScene){var text;if(tickScene.isHidden)text=hiddenLabelText;else{text=this.delegateExtension();void 0===text&&(text=tickScene.vars.tick.label);!maxTextWidth||this.showsInteraction()&&tickScene.isActive||(text=pvc.text.trimToWidthB(maxTextWidth,text,font,"..",!1));}
return text;}).pvMark.zOrder(40).lock(anchorOpposite,this.tickLength).lock(anchorOrtho,0).font(font).textStyle("#666666");layoutInfo.textAngleLocked?this.pvLabel.lock("textAngle",layoutInfo.textAngle):this.pvLabel.textAngle(layoutInfo.textAngle);layoutInfo.textAlignLocked?this.pvLabel.lock("textAlign",layoutInfo.textAlign):this.pvLabel.textAlign(layoutInfo.textAlign);layoutInfo.textBaselineLocked?this.pvLabel.lock("textBaseline",layoutInfo.textBaseline):this.pvLabel.textBaseline(layoutInfo.textBaseline);this._debugTicksPanel(pvTicksPanel);},_getTooltipFormatter:function(tipOptions){if(this.axis.option("TooltipEnabled")){tipOptions.gravity=this._calcTipsyGravity();var tooltipFormat=this.axis.option("TooltipFormat");if(tooltipFormat)return function(context){return tooltipFormat.call(context,context.scene);};var autoContent=this.axis.option("TooltipAutoContent");if("summary"===autoContent)return this._summaryTooltipFormatter.bind(this);if("value"===autoContent){tipOptions.isLazy=!1;return function(context){var pvMark=context.pvMark,label=context.scene.vars.tick.label;return pvMark.textAngle()||pvMark.text()!==label?def.html.escape(label):"";};}}},_getTooltipPanelClasses:function(){return["cart-axis"];},_debugTicksPanel:function(pvTicksPanel){if(def.debug>=16&&this.showLabels){var li=this._layoutInfo,ticksBBoxes=li.ticksBBoxes||this._calcTicksLabelBBoxes(li);pvTicksPanel.add(pv.Panel)[this.anchorOpposite()](this.tickLength)[this.anchorOrtho()](0)[this.anchorLength()](0)[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).visible(function(tickScene){return!tickScene.isHidden;}).add(pv.Line).data(function(scene){var labelBBox=ticksBBoxes[scene.dataIndex],corners=labelBBox.source.points();corners.length>1&&(corners=corners.concat(corners[0]));return corners;}).left(function(p){return p.x;}).top(function(p){return p.y;}).strokeStyle("red").lineWidth(.5).strokeDasharray("-");}},renderLinearAxis:function(){var wrapper,scale=this.scale,pvRule=this.pvRule,anchorOpposite=this.anchorOpposite(),anchorLength=this.anchorLength(),anchorOrtho=this.anchorOrtho(),anchorOrthoLength=this.anchorOrthoLength(),rootScene=this._getRootScene();this.compatVersion()<=1&&(wrapper=function(v1f){return function(tickScene){var markWrapped=Object.create(this);markWrapped.index=this.parent.index;return v1f.call(markWrapped,tickScene.vars.tick.rawValue);};});var pvTicksPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"}).lock("data",rootScene.childNodes).lock(anchorOpposite,0).lockMark(anchorOrtho,function(tickScene){return scale(tickScene.vars.tick.value);}).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",0).pvMark.zOrder(20);if(this.showTicks){var pvTicks=this.pvTicks=new pvc.visual.Rule(this,pvTicksPanel,{extensionId:"ticks",wrapper:wrapper}).lock("data").override("defaultColor",function(){return pvRule.scene?pvRule.scene[0].strokeStyle:"#666666";}).lock(anchorOpposite,0).lock(anchorOrtho,0).lock(anchorLength,null).optional(anchorOrthoLength,this.tickLength).pvMark;if(this.showMinorTicks){var layoutInfo=this._layoutInfo,ticks=layoutInfo.ticks,tickCount=ticks.length,minorTickOffset=tickCount>1?Math.abs(scale(ticks[1])-scale(ticks[0]))/2:0;this.pvMinorTicks=new pvc.visual.Rule(this,this.pvTicks,{extensionId:"minorTicks",wrapper:wrapper}).lock("data").intercept("visible",function(scene){return scene.childIndex()<tickCount-1&&(!pvTicks.scene||pvTicks.scene[0].visible)&&this.delegateExtension(!0);}).override("defaultColor",function(){return pvTicks.scene?pvTicks.scene[0].strokeStyle:"#666666";}).lock(anchorOpposite,0).lock(anchorLength,null).optional(anchorOrthoLength,this.tickLength/2).lockMark(anchorOrtho,minorTickOffset).pvMark;}}
this.renderLinearAxisLabel(pvTicksPanel,wrapper);this._debugTicksPanel(pvTicksPanel);},renderLinearAxisLabel:function(pvTicksPanel,wrapper){var anchorOpposite=this.anchorOpposite(),anchorOrtho=this.anchorOrtho(),font=this.font,maxTextWidth=this._layoutInfo.maxTextWidth;isFinite(maxTextWidth)||(maxTextWidth=0);var pvLabel=this.pvLabel=new pvc.visual.Label(this,pvTicksPanel,{extensionId:"label",noHover:!1,showsInteraction:!0,wrapper:wrapper}).lock("data").optional("text",function(tickScene){var text=tickScene.vars.tick.label;!maxTextWidth||this.showsInteraction()&&tickScene.isActive||(text=pvc.text.trimToWidthB(maxTextWidth,text,font,"..",!1));return text;}).pvMark.lock(anchorOpposite,this.tickLength).lock(anchorOrtho,0).zOrder(40).font(this.font).textStyle("#666666"),rootPanel=this.pvPanel.root;this.isAnchorTopOrBottom()?pvLabel.textBaseline(anchorOpposite).textAlign(function(tickScene){var absLeft;if(0===this.index){absLeft=pvLabel.toScreenTransform().transformHPosition(pvLabel.left());if(absLeft<=0)return"left";}else if(this.index===tickScene.parent.childNodes.length-1){absLeft=pvLabel.toScreenTransform().transformHPosition(pvLabel.left());if(absLeft>=rootPanel.width())return"right";}
return"center";}):pvLabel.textAlign(anchorOpposite).textBaseline(function(tickScene){var absTop;if(0===this.index){absTop=pvLabel.toScreenTransform().transformVPosition(pvLabel.top());if(absTop>=rootPanel.height())return"bottom";}else if(this.index===tickScene.parent.childNodes.length-1){absTop=pvLabel.toScreenTransform().transformVPosition(pvLabel.top());if(absTop<=0)return"top";}
return"middle";});},_onV1Click:function(context,handler){this.isDiscrete&&this.useCompositeAxis&&handler.call(context.pvMark,context.scene,context.event);},_onV1DoubleClick:function(context,handler){this.isDiscrete&&this.useCompositeAxis&&handler.call(context.pvMark,context.scene,context.event);},_getSelectableMarks:function(){if(this.isDiscrete&&this.isVisible&&this.pvLabel)return this.base();},renderCompositeOrdinalAxis:function(){var wrapper,isTopOrBottom=this.isAnchorTopOrBottom(),axisDirection=isTopOrBottom?"h":"v",diagDepthCutoff=2,vertDepthCutoff=2,font=this.font,diagMargin=pv.Text.fontHeight(font)/2,layout=this._pvLayout=this._getCompositeLayoutSingleCluster(),align=isTopOrBottom?"center":"left"==this.anchor?"right":"left";layout.node.def("fitInfo",null).height(function(tickScene,e,f){var fitInfo=pvc.text.getFitInfo(tickScene.dx,tickScene.dy,tickScene.vars.tick.label,font,diagMargin);fitInfo.h||("v"===axisDirection&&fitInfo.v?vertDepthCutoff=Math.min(diagDepthCutoff,tickScene.depth):diagDepthCutoff=Math.min(diagDepthCutoff,tickScene.depth));this.fitInfo(fitInfo);return tickScene.dy;});layout.node.add(pv.Bar).fillStyle("rgba(127,127,127,.001)").strokeStyle(function(tickScene){return 1!==tickScene.maxDepth&&tickScene.maxDepth?"rgba(127,127,127,0.3)":null;}).lineWidth(function(tickScene){return 1!==tickScene.maxDepth&&tickScene.maxDepth?.5:0;}).text(function(tickScene){return tickScene.vars.tick.label;});this.compatVersion()<=1&&(wrapper=function(v1f){return function(tickScene){return v1f.call(this,tickScene);};});this.pvLabel=new pvc.visual.Label(this,layout.label,{extensionId:"label",noClick:!1,noDoubleClick:!1,noSelect:!1,noTooltip:!1,noHover:!1,showsInteraction:!0,wrapper:wrapper,tooltipArgs:{options:{offset:2*diagMargin}}}).pvMark.def("lblDirection","h").textAngle(function(tickScene){if(tickScene.depth>=vertDepthCutoff&&tickScene.depth<diagDepthCutoff)return this.lblDirection("v"),-Math.PI/2;if(tickScene.depth>=diagDepthCutoff){var tan=tickScene.dy/tickScene.dx,angle=Math.atan(tan);if(angle>1.27)return this.lblDirection("v"),-Math.PI/2;if(angle>.3)return this.lblDirection("d"),-angle;}
return this.lblDirection("h"),0;}).textMargin(1).textAlign(function(tickScene){return"v"!=axisDirection||tickScene.depth>=vertDepthCutoff||tickScene.depth>=diagDepthCutoff?"center":align;}).left(function(tickScene){return"v"!=axisDirection||tickScene.depth>=vertDepthCutoff||tickScene.depth>=diagDepthCutoff?tickScene.x+tickScene.dx/2:"right"==align?tickScene.x+tickScene.dx:tickScene.x;}).font(font).textStyle("#666666").text(function(tickScene){var label=tickScene.vars.tick.label;if(!tickScene.isActive||!this.sign.showsInteraction()){var fitInfo=this.fitInfo();switch(this.lblDirection()){case"h":if(!fitInfo.h)return pvc.text.trimToWidthB(tickScene.dx,label,font,"..");break;case"v":if(!fitInfo.v)return pvc.text.trimToWidthB(tickScene.dy,label,font,"..");break;case"d":if(!fitInfo.d){var diagonalLength=Math.sqrt(def.sqr(tickScene.dy)+def.sqr(tickScene.dx));return pvc.text.trimToWidthB(diagonalLength-diagMargin,label,font,"..");}}}
return label;}).visible(function(tickScene){return tickScene.depth>0;});},_getCompositeLayoutSingleCluster:function(){var rootScene=this._getRootScene(),orientation=this.anchor,maxDepth=rootScene.group.treeHeight+1,depthLength=this._layoutInfo.axisSize,margin=maxDepth>2?1/12*depthLength:0,baseDisplacement=depthLength/maxDepth-margin,scaleFactor=maxDepth/(maxDepth-1),orthoLength=pvc.BasePanel.orthogonalLength[orientation],displacement="width"==orthoLength?"left"===orientation?[-baseDisplacement,0]:[baseDisplacement,0]:"top"===orientation?[0,-baseDisplacement]:[0,baseDisplacement];this.pvRule.sign.override("defaultColor",def.fun.constant(null)).override("defaultStrokeWidth",def.fun.constant(0));var panel=this.pvRule.add(pv.Panel)[orthoLength](depthLength).strokeStyle(null).lineWidth(0).add(pv.Panel)[orthoLength](depthLength*scaleFactor).strokeStyle(null).lineWidth(0);panel.transform(pv.Transform.identity.translate(displacement[0],displacement[1]));return panel.add(pv.Layout.Cluster.Fill).nodes(rootScene.nodes()).orient(orientation);},_calcTipsyGravity:function(){switch(this.anchor){case"bottom":return"s";case"top":return"n";case"left":return"w";case"right":return"e";}
return"s";}});pvc.AxisPanel._calcDiscreteOverlapSettings=function(overlappedLabelsMode,labelRotationDirection,labelDesiredAngles,distanceBetweenTicks,labelSpacingMin,fontPxWidth,axisAnchor,layoutInfo){var FLAT_ANGLE=Math.PI,RIGHT_ANGLE=FLAT_ANGLE/2,FULL_ANGLE=2*FLAT_ANGLE;layoutInfo.tickVisibilityStep=1;var canHide=!1,canRotate=!1;switch(overlappedLabelsMode){case"hide":canHide=!0;break;case"rotate":canRotate=!0;break;case"rotatethenhide":canHide=!0;canRotate=!0;break;default:return;}
null==labelRotationDirection&&(labelRotationDirection=1);labelDesiredAngles=labelDesiredAngles?labelDesiredAngles.slice().sort(function(v1,v2){return Math.abs(v1)-Math.abs(v2);}):[];var h=layoutInfo.textHeight,w=layoutInfo.maxTextWidth,sMin=h*labelSpacingMin,sMinH=sMin,sMinW=fontPxWidth+sMin,onBottom="bottom"===axisAnchor,onLeft="left"===axisAnchor,isHorizontal=onBottom||"top"===axisAnchor,min_angle=0,max_angle=FULL_ANGLE,all_angles_overlap=h+sMinH>distanceBetweenTicks;!all_angles_overlap&&w+sMinW>distanceBetweenTicks&&(isHorizontal?min_angle=pvc.normAngle(Math.asin(h/(distanceBetweenTicks-sMinH))):max_angle=pvc.normAngle(Math.acos(h/(distanceBetweenTicks-sMinH))));var a;if(canRotate){if(labelDesiredAngles.length>0)for(var i=0;i!==labelDesiredAngles.length;++i){a=pvc.normAngle(labelDesiredAngles[i]*labelRotationDirection);var abs_angle=a>FLAT_ANGLE?Math.abs(a-FULL_ANGLE):a,angle_to_axis=abs_angle<RIGHT_ANGLE?abs_angle:abs_angle-FLAT_ANGLE;if(!all_angles_overlap&&angle_to_axis>=min_angle){canHide=canHide&&(all_angles_overlap||angle_to_axis>max_angle);break;}}else if(all_angles_overlap)a=isHorizontal?RIGHT_ANGLE:0;else{a=pvc.normAngle(min_angle*labelRotationDirection);canHide=!1;}
layoutInfo.textAngle=a;layoutInfo.textAngleLocked=!0;var align="center",baseline="middle";if(isHorizontal){a>0&&a<FLAT_ANGLE?align=onBottom?"left":"right":a>FLAT_ANGLE&&a<FULL_ANGLE&&(align=onBottom?"right":"left");a>=0&&a<RIGHT_ANGLE||a>FLAT_ANGLE+RIGHT_ANGLE&&a<FULL_ANGLE?baseline=onBottom?"top":"bottom":a>RIGHT_ANGLE&&a<FULL_ANGLE-RIGHT_ANGLE&&(baseline=onBottom?"bottom":"top");}else{a>=0&&a<RIGHT_ANGLE||a>FLAT_ANGLE+RIGHT_ANGLE&&a<FULL_ANGLE?align=onLeft?"right":"left":a>RIGHT_ANGLE&&a<FULL_ANGLE-RIGHT_ANGLE&&(align=onLeft?"left":"right");a>0&&a<FLAT_ANGLE?baseline=onLeft?"top":"bottom":a>FLAT_ANGLE&&a<FULL_ANGLE&&(baseline=onLeft?"bottom":"top");}
layoutInfo.textAlign=align;layoutInfo.textAlignLocked=!0;layoutInfo.textBaseline=baseline;layoutInfo.textBaselineLocked=!0;}else{a=layoutInfo.textAngle?pvc.normAngle(layoutInfo.textAngle*labelRotationDirection):0;layoutInfo.textAngle=a;layoutInfo.textAngleLocked=!0;}
var tickCount=layoutInfo.ticks.length;if(canHide&&tickCount>2){var projected_size;projected_size=isHorizontal?Math.min(w,Math.abs(h/Math.sin(a)))+(all_angles_overlap||a<min_angle?sMinW:sMinH):Math.min(w,Math.abs(h/Math.cos(a)))+(all_angles_overlap||a>max_angle?sMinW:sMinH);if(projected_size>distanceBetweenTicks){var tim=Math.ceil(projected_size/distanceBetweenTicks);(!isFinite(tim)||tim<1||Math.ceil(tickCount/tim)<2)&&(tim=1);layoutInfo.tickVisibilityStep=tim;}}};def.type("pvc.AxisTitlePanel",pvc.TitlePanelAbstract).init(function(chart,parent,axis,options){this.axis=axis;this.base(chart,parent,options);this._extensionPrefix=axis.extensionPrefixes.map(function(prefix){return prefix+"Title";});}).add({_calcLayout:function(layoutInfo){var scale=this.axis.scale;return!scale||scale.isNull?new pvc_Size(0,0):this.base(layoutInfo);},_createCore:function(layoutInfo){var scale=this.axis.scale;if(scale&&!scale.isNull)return this.base(layoutInfo);}});def("pvc.visual.CartesianFocusWindow",pvc.visual.OptionsBase.extend({init:function(chart){this.base(chart,"focusWindow",0,{byNaked:!1});var baseAxis=chart.axes.base;this.base=new pvc.visual.CartesianFocusWindowAxis(this,baseAxis);},methods:{_exportData:function(){return{base:def.copyProps(this.base,pvc.visual.CartesianFocusWindowAxis.props)};},_importData:function(data){var baseData=data.base;this.base.option.specify({Begin:baseData.begin,End:baseData.end,Length:baseData.length});},_initFromOptions:function(){this.base._initFromOptions();},_onAxisChanged:function(axis){var changed=this.option("Changed");changed&&changed.call(this.chart.basePanel.context());}},options:{Changed:{resolve:"_resolveFull",cast:def.fun.as}}}));def("pvc.visual.CartesianFocusWindowAxis",pvc.visual.OptionsBase.extend({init:function(fw,axis){this.window=fw;this.axis=axis;this.isDiscrete=axis.isDiscrete();this.base(axis.chart,"focusWindow"+def.firstUpperCase(axis.type),0,{byNaked:!1});},type:{methods:{props:["begin","end","length"]}},methods:{_initFromOptions:function(){var o=this.option;this.set({begin:o("Begin"),end:o("End"),length:o("Length")});},set:function(keyArgs){var b,e,l,me=this,render=def.get(keyArgs,"render"),select=def.get(keyArgs,"select",!0);keyArgs=me._readArgs(keyArgs);if(keyArgs){b=keyArgs.begin;e=keyArgs.end;l=keyArgs.length;}else if(null!=this.begin&&null!=this.end&&null!=this.length)return;var a,L,ib,ie,ia,nb,ne,axis=me.axis,scale=axis.scale,isDiscrete=me.isDiscrete,contCast=isDiscrete?null:axis.role.grouping.singleDimensionType.cast,domain=scale.domain();if(isDiscrete){L=domain.length;if(null!=b){nb=+b;if(!isNaN(nb))if(nb===1/0){ib=L-1;b=domain[ib];}else if(nb===-1/0){ib=0;b=domain[ib];}
if(null==ib){ib=domain.indexOf(""+b);if(ib<0){ib=0;b=domain[ib];}}}
if(null!=e){ne=+e;if(!isNaN(ne))if(ne===1/0){ie=L-1;e=domain[ie];}else if(ne===-1/0){ie=0;e=domain[ie];}
if(null==ie){ie=domain.indexOf(""+e);if(ie<0){ie=L-1;e=domain[ie];}}}
if(null!=l){l=+l;if(isNaN(l))l=null;else if(l<0&&(null!=b||null!=e)){a=b;ia=ib;b=e;ib=ie;e=a;ie=ia;l=-l;}}
if(null!=b)if(null!=e){if(ib>ie){a=b;ia=ib;b=e;ib=ie;e=a;ie=ia;}
l=ie-ib+1;}else{null==l&&(l=L-ib);ie=ib+l-1;if(ie>L-1){ie=L-1;l=ie-ib+1;}
e=domain[ie];}else if(null!=e){null==l&&(l=ie);ib=ie-l+1;if(ib<0){ib=0;l=ie-ib+1;}
b=domain[ib];}else{null==l&&(l=Math.max(~~(L/3),1));if(l>L){l=L;ib=0;ie=L-1;}else{ia=~~(L/2);ib=ia-~~(l/2);ie=ib+l-1;}
b=domain[ib];e=domain[ie];}}else{if(null!=l){l=+l;if(isNaN(l))l=null;else if(l<0&&(null!=b||null!=e)){a=b;b=e;e=a;l=-l;}}
var bAux,lAux,min=domain[0],max=domain[1];L=max-min;if(null!=b){b<min&&(b=min);b>max&&(b=max);}
if(null!=e){e<min&&(e=min);e>max&&(e=max);}
if(null!=b)if(null!=e){if(b>e){a=b;b=e;e=a;}
l=e-b;}else{null==l&&(l=max-b);e=b+l;if(e>max){e=max;l=e-b;}}else if(null!=e){null==l&&(l=e-min);b=e-l;if(b<min){b=min;l=e-b;}}else{null==l&&(l=Math.max(~~(L/3),1));if(l>L){l=L;b=min;e=max;}else{a=~~(L/2);b=a-~~(l/2);bAux=+b;lAux=+l;e=bAux+lAux;}}
b=contCast(b);e=contCast(e);l=contCast(l);var constraint=me.option("Constraint");if(constraint){var oper2={type:"new",target:"begin",value:b,length:l,length0:l,min:min,max:max,minView:min,maxView:max};constraint(oper2);b=contCast(oper2.value);l=contCast(oper2.length);bAux=+b;lAux=+l;e=contCast(bAux+lAux);}}
me._set(b,e,l,select,render);},_updatePosition:function(pbeg,pend,select,render){var b,e,l,me=this,axis=me.axis,scale=axis.scale;if(me.isDiscrete){var ib=scale.invertIndex(pbeg),ie=scale.invertIndex(pend)-1,domain=scale.domain();b=domain[ib];e=domain[ie];l=ie-ib+1;}else{b=scale.invert(pbeg);e=scale.invert(pend);l=e-b;}
this._set(b,e,l,select,render);},_constraintPosition:function(oper){var constraint,me=this,axis=me.axis,scale=axis.scale;if(me.isDiscrete){var index=Math.floor(scale.invertIndex(oper.point,!0));if(index>=0){var r=scale.range(),L=scale.domain().length,S=(r.max-r.min)/L;index>=L&&("new"===oper.type||"resize-begin"===oper.type)&&(index=L-1);oper.point=index*S;}}else if(constraint=me.option("Constraint")){var vlength0,pother0,vother0,contCast=axis.role.grouping.singleDimensionType.cast,v=contCast(scale.invert(oper.point)),sign="begin"===oper.target?1:-1,pother=oper.point+sign*oper.length,vother=contCast(scale.invert(pother)),vlength=contCast(sign*(vother-v));if(oper.length===oper.length0)vlength0=vlength;else{pother0=oper.point+sign*oper.length0;vother0=contCast(scale.invert(pother0));vlength0=contCast(sign*(vother0-v));}
var vmin=contCast(scale.invert(oper.min)),vmax=contCast(scale.invert(oper.max)),oper2={type:oper.type,target:oper.target,value:v,length:vlength,length0:vlength0,min:vmin,max:vmax,minView:contCast(scale.invert(oper.minView)),maxView:contCast(scale.invert(oper.maxView))};constraint(oper2);if(+oper2.value!=+v){v=oper2.value;oper.point=scale(v);}
var vlength2=oper2.length;if(+vlength2!=+vlength)if(+vlength2==+vlength0)oper.length=oper.length0;else{var vother2=+v+sign*+vlength2,pother2=scale(vother2);oper.length=pother2-sign*oper.point;}
+oper2.min!=+vmin&&(oper.min=scale(oper2.min));+oper2.max!=+vmax&&(oper.max=scale(oper2.max));}},_compare:function(a,b){return this.isDiscrete?""+a==""+b:+a==+b;},_set:function(b,e,l,select,render){var me=this,changed=!1;me._compare(b,me.begin)||(me.begin=b,changed=!0);me._compare(e,me.end)||(me.end=e,changed=!0);me._compare(l,me.length)||(me.length=l,changed=!0);changed&&me.window._onAxisChanged(me);select&&me._updateSelection({render:render});return changed;},_readArgs:function(keyArgs){if(keyArgs){var out={},any=0,read=function(p){var v=keyArgs[p];null!=v?any=!0:v=this[p];out[p]=v;};pvc.visual.CartesianFocusWindowAxis.props.forEach(read,this);if(any)return out;}},_updateSelection:function(keyArgs){var selectDatums,domainData,me=this,axis=me.axis,isDiscrete=axis.isDiscrete(),chart=axis.chart,dataCell=axis.dataCell,role=dataCell.role,partData=chart.partData(dataCell.dataPartValue);if(isDiscrete){domainData=role.flatten(partData,{extensionDataSetsMap:axis.boundDimensionsDataSetsMap});var dataBegin=domainData.child(me.begin),dataEnd=domainData.child(me.end);if(dataBegin&&dataEnd){var indexBegin=dataBegin.childIndex(),indexEnd=dataEnd.childIndex();selectDatums=def.range(indexBegin,indexEnd-indexBegin+1).select(function(index){return domainData.childNodes[index];}).selectMany(def.propGet("_datums")).where(cdo.Datum.isVisibleT).distinct(def.propGet("key"));}}else{domainData=partData;var dimName=role.grouping.singleDimensionName;selectDatums=def.query(partData._datums).where(cdo.Datum.isVisibleT).where(function(datum){var v=datum.atoms[dimName].value;return null!=v&&v>=me.begin&&v<=me.end;});}
if(selectDatums){chart.data.replaceSelected(selectDatums);chart.root.updateSelections(keyArgs);}}},options:{Resizable:{resolve:"_resolveFull",cast:Boolean,value:!0},Movable:{resolve:"_resolveFull",cast:Boolean,value:!0},Begin:{resolve:"_resolveFull"},End:{resolve:"_resolveFull"},Length:{resolve:"_resolveFull"},Constraint:{resolve:"_resolveFull",cast:def.fun.as}}}));def.type("pvc.visual.CartesianOrthoDataCell",pvc.visual.DataCell).init(function(plot,axisType,axisIndex,roleName,isStacked,nullInterpolationMode,trend){this.base(plot,axisType,axisIndex,roleName);this.isStacked=isStacked;this.nullInterpolationMode=nullInterpolationMode;this.trend=trend;});def("pvc.visual.CartesianPlot",pvc.visual.Plot.extend({init:function(chart,keyArgs){this.base(chart,keyArgs);if(!(chart instanceof pvc.CartesianAbstract))throw def.error(def.format("Plot type '{0}' can only be used from within a cartesian chart.",[this.type]));},methods:{_initVisualRoles:function(){this.base();this._addVisualRole("series",{isRequired:!0,defaultDimension:"series*",autoCreateDimension:!0,requireIsDiscrete:!0});},_getColorRoleSpec:function(){return{isRequired:!0,defaultDimension:"color*",defaultSourceRole:"series",requireIsDiscrete:!0};},_initDataCells:function(){this.base();var baseRole=this._getBaseRole(),orthoRoles=this._getOrthoRoles();baseRole&&this._addDataCell(new pvc.visual.DataCell(this,"base",this.option("BaseAxis")-1,baseRole));if(orthoRoles){var orthoAxisIndex=this.option("OrthoAxis")-1,isStacked=this.option.isDefined("Stacked")?this.option("Stacked"):void 0,nullInterpolationMode=this.option("NullInterpolationMode"),trend=this.option("Trend");orthoRoles.forEach(function(orthoRole){this._addDataCell(new pvc.visual.CartesianOrthoDataCell(this,"ortho",orthoAxisIndex,orthoRole,isStacked,nullInterpolationMode,trend));},this);}},_getBaseRole:function(){},_getOrthoRoles:function(){},createData:function(baseData,ka){return this.visualRoles.series.flatten(baseData,ka);}},options:{BaseAxis:{value:1},OrthoAxis:{resolve:function(optionInfo){return 0===this.globalIndex?(optionInfo.specify(1),!0):this._resolveFull(optionInfo);},data:{resolveV1:function(optionInfo){"plot2"===this.name&&this.chart._allowV1SecondAxis&&this._chartOption("secondAxisIndependentScale")&&optionInfo.specify(2);return!0;}},cast:function(value){value=def.number.to(value);return null!=value?def.between(value,1,10):1;},value:1},Trend:{resolve:"_resolveFull",data:{resolveDefault:function(optionInfo){var type=this.option("TrendType");if(type)return optionInfo.defaultValue({type:type}),!0;}},cast:pvc_castTrend},TrendType:{resolve:"_resolveFull",cast:pvc.parseTrendType},TrendLabel:{resolve:"_resolveFull",cast:String},NullInterpolationMode:{resolve:"_resolveFull",cast:pvc.parseNullInterpolationMode,value:"none"}}}));def.type("pvc.CartesianAbstract",pvc.BaseChart).init(function(options){this.axesPanels={};this.base(options);}).add({_axisClassByType:{base:pvc_CartesianAxis,ortho:pvc_CartesianAxis},contentPanel:null,_defaultAxisBandSizeRatio:.9,axesPanels:null,yAxisPanel:null,xAxisPanel:null,secondXAxisPanel:null,secondYAxisPanel:null,yScale:null,xScale:null,_setAxisScale:function(axis,chartLevel){this.base(axis,chartLevel);var isOrtho="ortho"===axis.type;(isOrtho||"base"===axis.type)&&(isOrtho&&1===axis.index?this.secondScale=axis.scale:axis.index||(this[axis.orientation+"Scale"]=axis.scale));},_initAxesEnd:function(){var p=this.parent;this._axisOffsetPaddings=p?p._axisOffsetPaddings:this._calcAxesOffsetPaddings();this._plotsClientSizeInfo=p?p._plotsClientSizeInfo:this._calcPlotsClientSizeInfo();var axisOffsetPct=this._axisOffsetPct={};def.eachOwn(this._axisOffsetPaddings,function(v,p){null!=v&&(axisOffsetPct[p]=new pvc_PercentValue(v));});this.base();},_eachCartAxis:function(f,x){var axesByType=this.axesByType;["base","ortho"].forEach(function(type){var typeAxes=axesByType[type];typeAxes&&typeAxes.forEach(function(axis){f.call(x,axis);});});},_calcPlotsClientSizeInfo:function(){if(!this.parent){var sizeMin=new pvc_Size(0,0),sizeMax=new pvc_Size(1/0,1/0),size=new pvc_Size();this._eachCartAxis(function(axis){var a_size="x"===axis.orientation?"width":"height",rangeInfo=axis.getScaleRangeInfo();if(rangeInfo)if(null!=rangeInfo.value)size[a_size]=Math.max(size[a_size]||0,rangeInfo.value);else if(null!=rangeInfo.min){sizeMin[a_size]=Math.max(sizeMin[a_size],rangeInfo.min);sizeMax[a_size]=Math.min(sizeMax[a_size],rangeInfo.max);}});sizeMax.width=Math.max(sizeMax.width,sizeMin.width);sizeMax.height=Math.max(sizeMax.height,sizeMin.height);null!=size.width?size.width=Math.max(Math.min(size.width,sizeMax.width),sizeMin.width):pv.floatEqual(sizeMin.width,sizeMax.width)&&(size.width=sizeMin.width);null!=size.height?size.height=Math.max(Math.min(size.height,sizeMax.height),sizeMin.height):pv.floatEqual(sizeMin.height,sizeMax.height)&&(size.height=sizeMin.height);return{value:size,min:sizeMin,max:sizeMax};}},_calcAxesOffsetPaddings:function(){function processAxis(axis){var offset=axis&&axis.option("Offset");if(null!=offset&&offset>=0&&offset<.5)if("x"===axis.orientation){setSide("left",offset);setSide("right",offset);}else{setSide("top",offset);setSide("bottom",offset);}}
function setSide(side,pct){var value=pctPaddings[side];if(null==value||pct>value){hasAny=!0;pctPaddings[side]=pct;}}
var pctPaddings={},hasAny=!1;this._eachCartAxis(processAxis);return hasAny?pctPaddings:null;},_createContentPanel:function(parentPanel,contentOptions){this._createFocusWindow();var contentPanel=new pvc.CartesianGridDockingPanel(this,parentPanel,{margins:contentOptions.margins,paddings:contentOptions.paddings});this._gridDockPanel=contentPanel;return contentPanel;},_createContent:function(contentPanel,contentOptions){["base","ortho"].forEach(function(type){var typeAxes=this.axesByType[type];typeAxes&&def.query(typeAxes).reverse().each(function(axis){this._createAxisPanel(axis);},this);},this);this.base(contentPanel,{clickAction:contentOptions.clickAction,doubleClickAction:contentOptions.doubleClickAction});},_createFocusWindow:function(){if(this.selectableByFocusWindow()){var fwData,fw=this.focusWindow;fw&&(fwData=fw._exportData());fw=this.focusWindow=new pvc.visual.CartesianFocusWindow(this);fwData&&fw._importData(fwData);fw._initFromOptions();}else this.focusWindow&&delete this.focusWindow;},_createAxisPanel:function(axis){var opts=axis.option;if(opts("Visible")){var titlePanel,state,panel=this.axesPanels[axis.id];if(opts("TitleVisible")){var titlePanel=panel&&panel.titlePanel;titlePanel&&this._preserveLayout&&(state=titlePanel._getLayoutState());titlePanel=new pvc.AxisTitlePanel(this,this.contentPanel,axis,{title:opts("Title"),font:opts("TitleFont")||opts("Font"),anchor:opts("Position"),align:opts("TitleAlign"),margins:state?state.margins:opts("TitleMargins"),paddings:state?state.paddings:opts("TitlePaddings"),size:state?state.size:opts("TitleSize"),sizeMax:opts("TitleSizeMax")});}
state=panel&&this._preserveLayout?panel._getLayoutState():void 0;var panel=new pvc.AxisPanel(this,this.contentPanel,axis,{anchor:opts("Position"),size:state?state.size:opts("Size"),margins:state&&state.margins,paddings:state&&state.paddings,sizeMax:opts("SizeMax"),clickAction:opts("ClickAction"),doubleClickAction:opts("DoubleClickAction"),useCompositeAxis:opts("Composite"),font:opts("Font"),labelSpacingMin:opts("LabelSpacingMin"),grid:opts("Grid"),gridCrossesMargin:opts("GridCrossesMargin"),ruleCrossesMargin:opts("RuleCrossesMargin"),zeroLine:opts("ZeroLine"),showTicks:opts("Ticks"),showMinorTicks:opts("MinorTicks")});titlePanel&&(panel.titlePanel=titlePanel);this.axesPanels[axis.id]=panel;this.axesPanels[axis.orientedId]=panel;axis.v1SecondOrientedId&&(this[axis.v1SecondOrientedId+"AxisPanel"]=panel);return panel;}},_onLaidOut:function(){this.plotPanelList&&this.plotPanelList[0]&&this._eachCartAxis(this._setCartAxisScaleRange,this);},_setCartAxisScaleRange:function(axis){var info=this.plotPanelList[0]._layoutInfo,size=info.clientSize,a_size="x"===axis.orientation?size.width:size.height;axis.setScaleRange(a_size);axis.scale&&!axis.scale.isNull&&axis.setTicks(axis.ticks);return axis.scale;},_getAxesRoundingOverflow:function(){function setSide(side,valueNew,locked){var value=axesPaddings[side];if(null==value||valueNew>value){axesPaddings[side]=valueNew;axesPaddings[side+"Locked"]=locked;}else locked&&(axesPaddings[side+"Locked"]=locked);}
var axesPaddings={};this._eachCartAxis(function(axis){var overflow=axis.getRoundingOverflow();if(overflow){var isX="x"===axis.orientation;setSide(isX?"left":"bottom",overflow.begin,overflow.beginLocked);setSide(isX?"right":"top",overflow.end,overflow.endLocked);}});return axesPaddings;},_getContinuousVisibleExtentConstrained:function(axis){return"ortho"===axis.type&&1==axis.role.isNormalized?{min:0,max:100,minLocked:!0,maxLocked:!0,lengthLocked:!0}:this.base(axis);},_coordinateSmallChartsLayout:function(scopesByType){this.base(scopesByType);var titleOrthoLen,titleSizeMax=0,axisIds=null,sizesMaxByAxisId={};this.children.forEach(function(childChart){childChart.basePanel.layout();var size,panel=childChart.titlePanel;if(panel){titleOrthoLen||(titleOrthoLen=panel.anchorOrthoLength());size=panel[titleOrthoLen];size>titleSizeMax&&(titleSizeMax=size);}
var axesPanels=childChart.axesPanels;axisIds||(axisIds=def.query(def.ownKeys(axesPanels)).where(function(alias){return alias===axesPanels[alias].axis.id;}).select(function(id){sizesMaxByAxisId[id]={axis:0,title:0};return id;}).array());axisIds.forEach(function(id){var axisPanel=axesPanels[id],sizes=sizesMaxByAxisId[id],ol="x"===axisPanel.axis.orientation?"height":"width";size=axisPanel[ol];size>sizes.axis&&(sizes.axis=size);var titlePanel=axisPanel.titlePanel;if(titlePanel){size=titlePanel[ol];size>sizes.title&&(sizes.title=size);}});},this);this.children.forEach(function(childChart){if(titleSizeMax>0){var panel=childChart.titlePanel;panel.size=panel.size.clone().set(titleOrthoLen,titleSizeMax);}
var axesPanels=childChart.axesPanels;axisIds.forEach(function(id){var axisPanel=axesPanels[id],sizes=sizesMaxByAxisId[id],ol="x"===axisPanel.axis.orientation?"height":"width";axisPanel.size=axisPanel.size.clone().set(ol,sizes.axis);var titlePanel=axisPanel.titlePanel;titlePanel&&(titlePanel.size=titlePanel.size.clone().set(ol,sizes.title));});childChart.basePanel.invalidateLayout();},this);},markEventDefaults:{strokeStyle:"#5BCBF5",lineWidth:"0.5",textStyle:"#5BCBF5",verticalOffset:10,verticalAnchor:"bottom",horizontalAnchor:"right",forceHorizontalAnchor:!1,horizontalAnchorSwapLimit:80,font:"10px sans-serif"},markEvent:function(sourceValue,label,options){var me=this,baseAxis=me.axes.base,orthoAxis=me.axes.ortho,baseRole=baseAxis.role,baseScale=baseAxis.scale,baseDim=me.data.owner.dimensions(baseRole.grouping.singleDimensionName);if(baseAxis.isDiscrete()){me.log.warn("Can only mark events in charts with a continuous base scale.");return me;}
var o=$.extend({},me.markEventDefaults,options),atom=baseDim.read(sourceValue),basePos=baseScale(atom.value),baseRange=baseScale.range(),baseEndPos=baseRange[1];if(basePos<baseRange[0]||basePos>baseEndPos){me.log.warn("Cannot mark event because it is outside the base scale's domain.");return me;}
label||(label=atom.label);var pvPanel=this.plotPanelList[0].pvPanel,h=orthoAxis.scale.range()[1],ha=o.horizontalAnchor;if(!o.forceHorizontalAnchor){var alignRight="right"===ha;(alignRight?baseEndPos-basePos:basePos)<pv.Text.measureWidth(label,o.font)&&(ha=alignRight?"left":"right");}
var topPos="top"===o.verticalAnchor?o.verticalOffset:h-o.verticalOffset;pvPanel.add(pv.Line).data([0,h]).bottom(def.identity).left(basePos).lineWidth(o.lineWidth).strokeStyle(o.strokeStyle).anchor(ha).visible(function(){return!this.index;}).top(topPos).add(pv.Label).font(o.font).text(label).textStyle(o.textStyle);return me;},defaults:{timeSeries:!1,timeSeriesFormat:"%Y-%m-%d"}});def.type("pvc.CartesianGridDockingPanel",pvc.GridDockingPanel).init(function(chart,parent,options){this.base(chart,parent,options);this._plotBgPanel=new pvc.PlotBgPanel(chart,this);}).add({_getFillSizeMin:function(){var plotSizeMin=this.chart.parent?null:this.chart.options.plotSizeMin;return null!=plotSizeMin?pvc_Size.to(plotSizeMin):null;},_createCore:function(layoutInfo){var chart=this.chart,axes=chart.axes,xAxis=axes.x||axes.x2,yAxis=axes.y||axes.y2;xAxis&&!xAxis.isBound()&&(xAxis=null);yAxis&&!yAxis.isBound()&&(yAxis=null);xAxis&&xAxis.option("Grid")&&(this.xGridRule=this._createGridRule(xAxis));yAxis&&yAxis.option("Grid")&&(this.yGridRule=this._createGridRule(yAxis));this.base(layoutInfo);chart.focusWindow&&this._createFocusWindow(layoutInfo);(chart.compatVersion()>1?def.get(chart.options,"plotFrameVisible",!0):!(!xAxis.option("EndLine")&&!yAxis.option("EndLine")))&&(this.pvFrameBar=this._createFrame(layoutInfo,axes));xAxis&&"numeric"===xAxis.scaleType&&xAxis.option("ZeroLine")&&(this.xZeroLine=this._createZeroLine(xAxis,layoutInfo));yAxis&&"numeric"===yAxis.scaleType&&yAxis.option("ZeroLine")&&(this.yZeroLine=this._createZeroLine(yAxis,layoutInfo));},_createGridRule:function(axis){var scale=axis.scale;if(!scale.isNull){var isDiscrete=axis.role.grouping.isDiscrete(),rootScene=this._getAxisGridRootScene(axis);if(rootScene){var wrapper,margins=this._layoutInfo.gridMargins,paddings=this._layoutInfo.gridPaddings,tick_a="x"===axis.orientation?"left":"bottom",len_a=this.anchorLength(tick_a),obeg_a=this.anchorOrtho(tick_a),oend_a=this.anchorOpposite(obeg_a),mainPlot=this.chart.plotPanelList[0],tick_offset="x"===axis.orientation?(mainPlot.position.left||0)+paddings.left:(mainPlot.position.bottom||0)+paddings.bottom,obeg=margins[obeg_a],oend=margins[oend_a],tickScenes=rootScene.leafs().array(),tickCount=tickScenes.length;isDiscrete&&tickCount&&tickScenes.push(tickScenes[tickCount-1]);this.compatVersion()<=1&&(wrapper=function(v1f){return function(tickScene){return v1f.call(this,tickScene.vars.tick.rawValue);};});var pvGridRule=new pvc.visual.Rule(this,this.pvPanel,{extensionId:axis.extensionPrefixes.map(function(prefix){return prefix+"Grid";}),wrapper:wrapper}).lock("data",tickScenes).lock(len_a,null).override("defaultColor",def.fun.constant(pv.color("#f0f0f0"))).pvMark.antialias(!0)[obeg_a](obeg)[oend_a](oend).zOrder(-12).events("none");if(isDiscrete){var halfStep=scale.range().step/2;pvGridRule[tick_a](function(tickScene){return tick_offset+scale(tickScene.vars.tick.value)+(this.index===tickCount?halfStep:-halfStep);});}else pvGridRule[tick_a](function(tickScene){return tick_offset+scale(tickScene.vars.tick.value);});return pvGridRule;}}},_getAxisGridRootScene:function(axis){var isDiscrete=axis.isDiscrete(),data=isDiscrete?axis.domainData():this.data,rootScene=new pvc.visual.CartesianAxisRootScene(null,{panel:this,source:data});if(isDiscrete)data.childNodes.forEach(function(tickData){new pvc.visual.CartesianAxisTickScene(rootScene,{source:tickData,tick:tickData.value,tickRaw:tickData.rawValue,tickLabel:tickData.label});});else{(axis.ticks||axis.calcContinuousTicks()).forEach(function(majorTick,index){new pvc.visual.CartesianAxisTickScene(rootScene,{tick:majorTick,tickRaw:majorTick,tickLabel:axis.scale.tickFormat(majorTick,index)});},this);}
return rootScene;},_createFrame:function(layoutInfo,axes){if(!axes.base.scale.isNull&&(!axes.ortho.scale.isNull||axes.ortho2&&!axes.ortho2.scale.isNull)){var margins=layoutInfo.gridMargins,left=margins.left,right=margins.right,top=margins.top,bottom=margins.bottom,extensionIds=[];this.compatVersion()<=1&&extensionIds.push("xAxisEndLine","yAxisEndLine");extensionIds.push("plotFrame");return new pvc.visual.Panel(this,this.pvPanel,{extensionId:extensionIds}).pvMark.lock("left",left).lock("right",right).lock("top",top).lock("bottom",bottom).lock("fillStyle",null).events("none").strokeStyle("#666666").lineWidth(1).antialias(!1).zOrder(-8);}},_createZeroLine:function(axis,layoutInfo){var scale=axis.scale;if(!scale.isNull){var domain=scale.domain();if(domain[0]*domain[1]<-1e-12){var a="x"===axis.orientation?"left":"bottom",len_a=this.anchorLength(a),obeg_a=this.anchorOrtho(a),oend_a=this.anchorOpposite(obeg_a),margins=layoutInfo.gridMargins,paddings=layoutInfo.gridPaddings,zeroPosition=margins[a]+paddings[a]+scale(0),obeg=margins[obeg_a],oend=margins[oend_a],rootScene=new pvc.visual.Scene(null,{panel:this});return new pvc.visual.Rule(this,this.pvPanel,{extensionId:axis.extensionPrefixes.map(function(prefix){return prefix+"ZeroLine";})}).lock("data",[rootScene]).lock(len_a,null).lock(obeg_a,obeg).lock(oend_a,oend).lock(a,zeroPosition).override("defaultColor",def.fun.constant(pv.color("#666666"))).pvMark.events("none").lineWidth(1).antialias(!0).zOrder(-9);}}},_createFocusWindow:function(layoutInfo){function resetSceneY(){scene[a_y]=0-paddings[a_top];scene[a_dy]=h+paddings[a_top]+paddings[a_bottom];}
function sceneProp(p){return function(){return scene[p];};}
function boundLeft(){var begin=scene[a_x];return Math.max(0,Math.min(w,begin));}
function boundWidth(){var begin=boundLeft(),end=scene[a_x]+scene[a_dx];end=Math.max(0,Math.min(w,end));return end-begin;}
function addSelBox(panel,id){return new pvc.visual.Bar(me,panel,{extensionId:id,normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).pvMark.lock("data").lock("visible").lock(a_left,boundLeft).lock(a_width,boundWidth).lock(a_top,sceneProp(a_y)).lock(a_height,sceneProp(a_dy)).lock(a_bottom).lock(a_right).sign;}
function onDrag(){var ev=arguments[arguments.length-1],isEnd="end"===ev.drag.phase;topRoot._selectingByRubberband=!isEnd;baseBgPanel.render();baseFgPanel.render();var pbeg=scene[a_x],pend=scene[a_x]+scene[a_dx];if(!isV){var temp=w-pbeg;pbeg=w-pend;pend=temp;}
focusWindow._updatePosition(pbeg,pend,isEnd,!0);}
function positionConstraint(drag,op){var l,target,m=drag.m,p=m[a_p],l0=scene[a_dp];switch(op){case"new":l=0;target="begin";break;case"resize-begin":l=scene[a_p]+l0-p;target="begin";break;case"move":l=l0;target="begin";break;case"resize-end":l=p-scene[a_p];target="end";}
var min=drag.min[a_p],max=drag.max[a_p],oper={type:op,target:target,point:p,length:l,length0:l0,min:min,max:max,minView:0,maxView:w};focusWindow._constraintPosition(oper);m[a_p]=oper.point;switch(op){case"new":oper.length!==l&&(drag[a_dp+"min"]=l=oper.length);break;case"resize-begin":oper.max=Math.min(oper.max,scene[a_p]+scene[a_dp]);break;case"resize-end":oper.min=Math.max(oper.min,scene[a_p]);}
drag.min[a_p]=oper.min;drag.max[a_p]=oper.max;}
var me=this,topRoot=me.topRoot,chart=me.chart,focusWindow=chart.focusWindow.base,axis=focusWindow.axis,scale=axis.scale;if(!scale.isNull){var resizable=focusWindow.option("Resizable"),movable=focusWindow.option("Movable"),isDiscrete=axis.isDiscrete(),isV=chart.isOrientationVertical(),a_left=isV?"left":"top",a_top=isV?"top":"left",a_width=me.anchorOrthoLength(a_left),a_right=me.anchorOpposite(a_left),a_height=me.anchorOrthoLength(a_top),a_bottom=me.anchorOpposite(a_top),a_x=isV?"x":"y",a_dx="d"+a_x,a_y=isV?"y":"x",a_dy="d"+a_y,margins=layoutInfo.gridMargins,paddings=layoutInfo.gridPaddings,space={left:margins.left+paddings.left,right:margins.right+paddings.right,top:margins.top+paddings.top,bottom:margins.bottom+paddings.bottom},clientSize=layoutInfo.clientSize,wf=clientSize[a_width],hf=clientSize[a_height];space.width=space.left+space.right;space.height=space.top+space.bottom;var w=wf-space[a_width],h=hf-space[a_height],padLeft=paddings[a_left],padRight=paddings[a_right],scene=new pvc.visual.Scene(null,{panel:this}),band=isDiscrete?scale.range().step:0,halfBand=band/2;scene[a_x]=scale(focusWindow.begin)-halfBand;scene[a_dx]=band+(scale(focusWindow.end)-halfBand)-scene[a_x];resetSceneY();var baseBgPanel=this._plotBgPanel.pvPanel.borderPanel;baseBgPanel.lock("data",[scene]);movable&&resizable?baseBgPanel.paddingPanel.events("all").cursor("crosshair").event("mousedown",pv.Behavior.select().autoRender(!1).collapse(isV?"y":"x").positionConstraint(function(drag){return positionConstraint(drag,"start"===drag.phase?"new":"resize-end");})).event("selectstart",function(){resetSceneY();onDrag.apply(null,arguments);}).event("select",onDrag).event("selectend",onDrag):baseBgPanel.paddingPanel.events("all");var focusBg=addSelBox(baseBgPanel.paddingPanel,"focusWindowBg").override("defaultColor",def.fun.constant(pvc.invisibleFill)).pvMark;movable?focusBg.events("all").cursor("move").event("mousedown",pv.Behavior.drag().autoRender(!1).collapse(isV?"y":"x").positionConstraint(function(drag){positionConstraint(drag,"move");})).event("drag",onDrag).event("dragend",onDrag):focusBg.events("none");var baseFgPanel=new pvc.visual.Panel(me,me.pvPanel).pvMark.lock("data",[scene]).lock("visible").lock("fillStyle",pvc.invisibleFill).lock("left",space.left).lock("right",space.right).lock("top",space.top).lock("bottom",space.bottom).lock("zOrder",10).events(function(){var drag=scene.drag;return drag&&"end"!==drag.phase?"all":"none";}).cursor(function(){var drag=scene.drag;return drag&&"end"!==drag.phase?"drag"===drag.type||"select"===drag.type&&!resizable?"move":isV?"ew-resize":"ns-resize":null;}).antialias(!1);new pvc.visual.Bar(me,baseFgPanel,{extensionId:"focusWindowBaseCurtain",normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).override("defaultColor",function(scene,type){return"stroke"===type?null:"rgba(20, 20, 20, 0.1)";}).pvMark.lock("data",[scene,scene]).lock("visible").events("none").lock(a_left,function(){return this.index?boundLeft()+boundWidth():-padLeft;}).lock(a_right,function(){return this.index?-padRight:null;}).lock(a_width,function(){return this.index?null:padLeft+boundLeft();}).lock(a_top,sceneProp(a_y)).lock(a_height,sceneProp(a_dy)).lock(a_bottom);var selectBoxFg=addSelBox(baseFgPanel,"focusWindow").override("defaultColor",def.fun.constant(null)).pvMark.events("none"),addResizeSideGrip=function(side){var a_begin="left"===side||"top"===side?"begin":"end",opposite=me.anchorOpposite(side),fillColor="linear-gradient(to "+opposite+", rgba(20, 20, 20, 0.1), #444 90%)",grip=new pvc.visual.Bar(me,selectBoxFg.anchor(side),{extensionId:focusWindow.id+"Grip"+def.firstUpperCase(a_begin),normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).override("defaultColor",function(scene,type){return"stroke"===type?null:fillColor;}).pvMark.lock("data").lock("visible")[a_top](scene[a_y])[a_height](scene[a_dy]);if(resizable){var opId="resize-"+a_begin;grip.events("all")[a_width](5).cursor(isV?"ew-resize":"ns-resize").event("mousedown",pv.Behavior.resize(side).autoRender(!1).positionConstraint(function(drag){positionConstraint(drag,opId);}).preserveOrtho(!0)).event("resize",onDrag).event("resizeend",onDrag);}else grip.events("none")[a_width](1);return grip;};addResizeSideGrip(a_left);addResizeSideGrip(a_right);var a_p=a_x,a_dp=a_dx;}},_getDatumsOnRect:function(datumMap,rect,keyArgs){var xDatumMap,yDatumMap,chart=this.chart,xAxisPanel=chart.axesPanels.x,yAxisPanel=chart.axesPanels.y;if(xAxisPanel){xDatumMap=new def.Map();xAxisPanel._getDatumsOnRect(xDatumMap,rect,keyArgs);xDatumMap.count||(xDatumMap=null);}
if(yAxisPanel){yDatumMap=new def.Map();yAxisPanel._getOwnDatumsOnRect(yDatumMap,rect,keyArgs);yDatumMap.count||(yDatumMap=null);}
if(xDatumMap&&yDatumMap){xDatumMap.intersect(yDatumMap,datumMap);keyArgs.toggle=!0;}else xDatumMap?datumMap.copy(xDatumMap):yDatumMap?datumMap.copy(yDatumMap):chart.plotPanelList.forEach(function(plotPanel){plotPanel._getDatumsOnRect(datumMap,rect,keyArgs);},this);}});def.type("pvc.CartesianAbstractPanel",pvc.PlotPanel).init(function(chart,parent,plot,options){function addAxis(axis){axes[axis.type]=axis;axes[axis.orientedId]=axis;axis.v1SecondOrientedId&&(axes[axis.v1SecondOrientedId]=axis);}
this.base(chart,parent,plot,options);var axes=this.axes;addAxis(chart._getAxis("base",plot.option("BaseAxis")-1));addAxis(chart._getAxis("ortho",plot.option("OrthoAxis")-1));}).add({_getOptionSizeMin:function(chart){return null;},_calcLayout:function(layoutInfo){var clientSize,chart=this.chart,clientSizeInfo=chart._plotsClientSizeInfo;if(clientSizeInfo){clientSize=layoutInfo.clientSize;var clientSizeFix=clientSizeInfo.value,clientSizeMin=clientSizeInfo.min,clientSizeMax=clientSizeInfo.max;null!=clientSizeFix.width?clientSize.width=clientSizeFix.width:clientSize.width=Math.max(Math.min(clientSize.width,clientSizeMax.width),clientSizeMin.width);null!=clientSizeFix.height?clientSize.height=clientSizeFix.height:clientSize.height=Math.max(Math.min(clientSize.height,clientSizeMax.height),clientSizeMin.height);}
chart._preserveLayout||(layoutInfo.contentOverflow=this._calcContentOverflow(layoutInfo));return clientSize;},_calcContentOverflow:function(li){var contentOverflow,offsetPads=this.chart._axisOffsetPaddings;if(offsetPads){var tickRoundPads=this.chart._getAxesRoundingOverflow();pvc_Sides.names.forEach(function(side){if(!tickRoundPads[side+"Locked"]){var len_a=pvc.BasePanel.orthogonalLength[side],offLen=li.size[len_a]*(offsetPads[side]||0),roundLen=tickRoundPads[side]||0;(contentOverflow||(contentOverflow={}))[side]=Math.max(offLen-roundLen,0);}},this);}
return contentOverflow;},_createCore:function(){this.pvPanel.zOrder(-10);var contentOverflow=this.chart.options.leafContentOverflow||"auto";("auto"===contentOverflow?this._guessHideOverflow():"hidden"===contentOverflow)&&this.pvPanel.borderPanel.overflow("hidden");},_guessHideOverflow:function(){return cartPlotPanel_axisMayOverflow(this.axes.ortho)||cartPlotPanel_axisMayOverflow(this.axes.base);}});def("pvc.visual.CategoricalPlot",pvc.visual.CartesianPlot.extend({methods:{createData:function(baseData,ka){var ka2=Object.create(ka);ka2.extensionDataSetsMap=this.boundDimensionsDataSetsMap;return baseData.groupBy([this.visualRoles.category.flattenedGrouping(),this.visualRoles.series.flattenedGrouping()],ka2);},interpolatable:function(){return!0;},_initVisualRoles:function(){this.base();this._addVisualRole("category",this._getCategoryRoleSpec());},_getCategoryRoleSpec:function(){return{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0};},getContinuousVisibleCellExtent:function(chart,valueAxis,valueDataCell){var valueRole=valueDataCell.role;switch(valueRole.name){case"series":case"category":return this.base(chart,valueAxis,valueDataCell);}
if(valueDataCell.plot!==this)throw def.error.operationInvalid("DataCell not of this plot.");var data=chart.visiblePlotData(this),useAbs=valueAxis.scaleUsesAbs();return"ortho"===valueAxis.type&&valueDataCell.isStacked?data.children().select(function(catGroup){var range=this._getStackedCategoryValueExtent(catGroup,valueRole,useAbs);if(range)return{range:range,group:catGroup};},this).where(def.notNully).reduce(function(result,rangeInfo){return this._reduceStackedCategoryValueExtent(chart,result,rangeInfo.range,rangeInfo.group,valueAxis,valueDataCell);}.bind(this),null):data.leafs().select(function(serGroup){var value=valueRole.numberValueOf(serGroup).value;return useAbs&&value<0?-value:value;}).range();},_getStackedCategoryValueExtent:function(catGroup,valueRole,useAbs){var posSum=null,negSum=null;catGroup.children().select(function(serGroup){var value=valueRole.numberValueOf(serGroup).value;return useAbs&&value<0?-value:value;}).each(function(value){null!=value&&(value>=0?posSum+=value:negSum+=value);});return null==posSum&&null==negSum?null:{max:posSum||0,min:negSum||0};},_reduceStackedCategoryValueExtent:function(chart,result,catRange,catGroup,valueAxis,valueDataCell){return pvc.unionExtents(result,catRange);},_getBaseRole:function(){return this.visualRoles.category;},_getOrthoRoles:function(){return[this.visualRoles.value];},interpolateDataCell:function(dataCell,baseData){if(dataCell.plot!==this)throw def.error.operationInvalid("DataCell not of this plot.");var InterpType=this._getNullInterpolationOperType(dataCell.nullInterpolationMode);if(InterpType){var partData=this.chart.partData(this.dataPartValue,baseData),visibleData=this.chart.visiblePlotData(this,{baseData:baseData});if(visibleData.childCount()>0){dataCell.role.getCompatibleBoundDimensionNames(visibleData).forEach(function(valueDimName){new InterpType(baseData,partData,visibleData,this.visualRoles.category,this.visualRoles.series,dataCell.role,valueDimName,!0).interpolate();},this);}}},_getNullInterpolationOperType:function(nim){switch(nim){case"linear":return cdo.LinearInterpolationOper;case"zero":return cdo.ZeroInterpolationOper;case"none":break;default:throw def.error.argumentInvalid("nullInterpolationMode",""+nim);}},generateTrendsDataCell:function(newDatums,dataCell,baseData){function generateSeriesTrend(seriesData,yDimName){var funX=isXDiscrete?null:function(allCatData){return allCatData.atoms[xDimName].value;},funY=function(allCatData){var group=data.child(allCatData.key);group&&(group=group.child(seriesData.key));return group?group.dimensions(yDimName).value(sumKeyArgs):null;},options=def.create(trendOptions,{rows:def.query(allCategDatas),x:funX,y:funY}),trendModel=trendInfo.model(options);trendModel&&allCategDatas.forEach(function(allCategData,categIndex){var trendX=isXDiscrete?categIndex:allCategData.atoms[xDimName].value,trendY=trendModel.sample(trendX,funY(allCategData),categIndex);if(null!=trendY){var atoms,categData=data.child(allCategData.key),categDataEf=categData||allCategData,categAndSeriesData=categData&&categData.child(seriesData.key);if(categAndSeriesData)atoms=Object.create(categAndSeriesData.atoms);else{atoms=Object.create(categDataEf.atoms);def.copyOwn(atoms,seriesData.atoms);}
atoms[yDimName]=trendY;atoms[dataPartDimName]=dataPartAtom;datumDimNames||(datumDimNames=data.type.filterExtensionDimensionNames(def.keys(atoms)));newDatums.push(new cdo.TrendDatum(categDataEf.owner,atoms,datumDimNames,trendOptions));}});}
if(dataCell.plot!==this)throw def.error.operationInvalid("DataCell not of this plot.");var data=this.chart.visiblePlotData(this,{baseData:baseData}),yRole=dataCell.role,yDimNames=yRole.getCompatibleBoundDimensionNames(data);if(0!==yDimNames.length){var xDimName,seriesRole=this.visualRoles.series,xRole=this.visualRoles.category,trendOptions=dataCell.trend,trendInfo=trendOptions.info,isXDiscrete=xRole.isDiscrete();isXDiscrete||(xDimName=xRole.grouping.singleDimensionName);var datumDimNames,sumKeyArgs={zeroIfNone:!1},dataPartAtom=this.chart._getTrendDataPartAtom(),dataPartDimName=dataPartAtom.dimension.name,allCategDatas=xRole.flatten(baseData,{visible:!0}).childNodes.filter(function(allCategData){return isXDiscrete||null!==allCategData.atoms[xDimName].value;}),partData=this.chart.partData(dataCell.dataPartValue,baseData),visibleSeriesDatas=seriesRole.flatten(partData,{visible:!0}).children().array();yDimNames.forEach(function(yDimName){datumDimNames=null;visibleSeriesDatas.forEach(function(seriesData){var yBoundDimName=yRole.getBoundDimensionName(seriesData,!0);null!==yBoundDimName&&yBoundDimName!==yDimName||generateSeriesTrend(seriesData,yDimName);});});}}},options:{Stacked:{resolve:"_resolveFull",cast:Boolean,value:!1}}}));def.type("pvc.CategoricalAbstract",pvc.CartesianAbstract).add({_onWillCreatePlotPanelScene:function(plotPanel,data,axisSeriesDatas,axisCategDatas){}});def.type("pvc.CategoricalAbstractPanel",pvc.CartesianAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.stacked=plot.option("Stacked");}).add({_buildScene:function(data,axisSeriesDatas,axisCategDatas){this.chart._onWillCreatePlotPanelScene(this,data,axisSeriesDatas,axisCategDatas);return this._buildSceneCore(data,axisSeriesDatas,axisCategDatas);}});def("pvc.visual.MetricXYPlot",pvc.visual.CartesianPlot.extend({methods:{_initVisualRoles:function(){this.base();this._addVisualRole("x",{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"x",dimensionDefaults:{valueType:this.chart.options.timeSeries?Date:Number}});this._addVisualRole("y",{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"y",dimensionDefaults:{valueType:Number}});},_getBaseRole:function(){return this.visualRoles.x;},_getOrthoRoles:function(){return[this.visualRoles.y];},generateTrendsDataCell:function(newDatums,dataCell,baseData){function genSeriesTrend(serData,yDimName){var funX=function(datum){return datum.atoms[xDimName].value;},funY=function(datum){return datum.atoms[yDimName].value;},datums=serData.datums().sort(null,funX).array(),options=def.create(trendOptions,{rows:def.query(datums),x:funX,y:funY}),trendModel=trendInfo.model(options);trendModel&&datums.forEach(function(datum,index){var trendY,trendX=funX(datum);if(null!=trendX&&null!=(trendY=trendModel.sample(trendX,funY(datum),index))){var atoms=def.set(Object.create(serData.atoms),xDimName,trendX,yDimName,trendY,dataPartDimName,dataPartAtom);datumDimNames||(datumDimNames=data.type.filterExtensionDimensionNames(def.keys(atoms)));newDatums.push(new cdo.TrendDatum(data.owner,atoms,datumDimNames,trendOptions));}});}
if(dataCell.plot!==this)throw def.error.operationInvalid("DataCell not of this plot.");var data=this.chart.visiblePlotData(this,{baseData:baseData}),yRole=dataCell.role,yDimNames=yRole.getCompatibleBoundDimensionNames(data);if(0!==yDimNames.length){var datumDimNames,serRole=this.visualRoles.series,xRole=this.visualRoles.x,trendOptions=dataCell.trend,trendInfo=trendOptions.info,xDimName=xRole.grouping.singleDimensionName,dataPartAtom=this.chart._getTrendDataPartAtom(),dataPartDimName=dataPartAtom.dimension.name;yDimNames.forEach(function(yDimName){datumDimNames=null;(serRole.isBound()?data.children():def.query([data])).each(function(serData){genSeriesTrend(serData,yDimName);});});}}},options:{OrthoAxis:{resolve:null}}}));def.type("pvc.MetricXYAbstract",pvc.CartesianAbstract).add({_defaultAxisBandSizeRatio:1,_getIsNullDatum:function(){var measureDimNames,M,me=this;return function(datum){if(!measureDimNames){measureDimNames=def.query([me.visualRoles.x,me.visualRoles.y]).selectMany(function(role){return role.grouping.dimensionNames();}).distinct().array();M=measureDimNames.length;}
if(!M)return!1;for(var atoms=datum.atoms,i=0;i<M;i++)if(null==atoms[measureDimNames[i]].value)return!0;return!1;};}});def.type("pvc.BarAbstract",pvc.CategoricalAbstract);def("pvc.visual.BarPlotAbstract",pvc.visual.CategoricalPlot.extend({methods:{_initVisualRoles:function(){this.base();this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:this.option("Stacked"),isNormalized:this.option("ValuesNormalized"),requireSingleDimension:!1,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"});},_getCategoryRoleSpec:function(){return def.set(this.base(),"requireIsDiscrete",!0);}},options:{BarSizeRatio:{resolve:"_resolveFull",cast:function(value){value=def.number.to(value);return null==value?1:value<.05?.05:value>1?1:value;},value:.9},BarSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){return this._specifyChartOption(optionInfo,"maxBarSize"),!0;}},cast:function(value){value=def.number.to(value);return null==value?1/0:value<1?1:value;},value:2e3},BarOrthoSizeMin:{resolve:"_resolveFull",cast:def.number.toNonNegative,value:1.5},BarStackedMargin:{resolve:"_resolveFull",cast:function(value){value=def.number.to(value);return null!=value&&value<0?0:value;},value:0},OverflowMarkersVisible:{resolve:"_resolveFull",cast:Boolean,value:!0},ValuesAnchor:{value:"center"},ValuesNormalized:{resolve:"_resolveFull",cast:"boolean",default:!1}}}));def.type("pvc.BarAbstractPanel",pvc.CategoricalAbstractPanel).add({pvBar:null,pvBarLabel:null,pvCategoryPanel:null,pvSecondLine:null,pvSecondDot:null,_creating:function(){var colorDataCell=this.plot.dataCellsByRole.color[0];if(!colorDataCell.legendSymbolRenderer()&&colorDataCell.legendVisible()){var colorAxis=this.axes.color,drawLine=colorAxis.option("LegendDrawLine");if(!drawLine||colorAxis.option("LegendDrawMarker")){var extAbsPrefix=pvc.uniqueExtensionAbsPrefix();this.chart._processExtensionPointsIn(colorDataCell.role.legend(),extAbsPrefix);var keyArgs={drawMarker:!0,markerShape:colorAxis.option("LegendShape"),drawLine:drawLine,extensionPrefix:{abs:extAbsPrefix},markerPvProto:new pv.Dot()};this.extend(keyArgs.markerPvProto,"bar",{constOnly:!0});colorDataCell.legendSymbolRenderer(keyArgs);}}},_createCore:function(){this.base();var barWidth,seriesCount,me=this,chart=me.chart,plot=me.plot,isStacked=!!me.stacked,isVertical=me.isOrientationVertical(),data=me.visibleData({ignoreNulls:!1}),orthoAxis=me.axes.ortho,baseAxis=me.axes.base,axisCategDatas=baseAxis.domainItems(),axisSeriesDatas=me.visualRoles.series.flatten(me.partData(),{visible:!0,isNull:!chart.options.ignoreNulls&&null,extensionDataSetsMap:plot.boundDimensionsDataSetsMap}).childNodes,rootScene=me._buildScene(data,axisSeriesDatas,axisCategDatas),orthoScale=orthoAxis.scale,orthoZero=orthoScale(0),sceneOrthoScale=orthoAxis.sceneScale({sceneVarName:"value",nullToZero:!1}),sceneBaseScale=baseAxis.sceneScale({sceneVarName:"category"}),barSizeRatio=plot.option("BarSizeRatio"),barSizeMax=plot.option("BarSizeMax"),barStackedMargin=plot.option("BarStackedMargin"),barOrthoSizeMin=plot.option("BarOrthoSizeMin"),baseRange=baseAxis.scale.range(),bandWidth=baseRange.band,barStepWidth=baseRange.step,barMarginWidth=baseRange.margin,reverseSeries=isVertical===isStacked;if(isStacked)barWidth=bandWidth;else{seriesCount=axisSeriesDatas.length;barWidth=seriesCount?1===seriesCount?bandWidth:barSizeRatio*bandWidth/seriesCount:0;}
barWidth>barSizeMax&&(barWidth=barSizeMax);me.barWidth=barWidth;me.barStepWidth=barStepWidth;var wrapper;me.compatVersion()<=1&&(wrapper=function(v1f){return function(scene){var markParent=Object.create(this.parent),mark=Object.create(this);mark.parent=markParent;var serIndex=scene.parent.childIndex(),catIndex=scene.childIndex();if(isStacked){markParent.index=serIndex;mark.index=catIndex;}else{markParent.index=catIndex;mark.index=serIndex;}
return v1f.call(mark,scene.vars.value.rawValue);};});me.pvBarPanel=new pvc.visual.Panel(me,me.pvPanel,{panelType:pv.Layout.Band,extensionId:"panel"}).lock("layers",rootScene.childNodes).lockMark("values",function(seriesScene){return seriesScene.childNodes;}).lockMark("orient",isVertical?"bottom-left":"left-bottom").lockMark("layout",isStacked?"stacked":"grouped").lockMark("verticalMode",me._barVerticalMode()).lockMark("yZero",orthoZero).optionalMark("hZero",barOrthoSizeMin).pvMark.band.x(sceneBaseScale).w(bandWidth).differentialControl(me._barDifferentialControl()).item.order(reverseSeries?"reverse":null).h(function(scene){var y=sceneOrthoScale(scene);return null!=y?chart.animate(0,y-orthoZero):null;}).w(barWidth).horizontalRatio(barSizeRatio).verticalMargin(barStackedMargin).end;var widthNeedsAntialias=barWidth<=4||barMarginWidth<2,pvBar=this.pvBar=new pvc.visual.Bar(me,me.pvBarPanel.item,{extensionId:"bar",freePosition:!0,wrapper:wrapper}).lockDimensions().optional("visible",function(scene){return null!=scene.getValue();}).pvMark.antialias(function(scene){if(widthNeedsAntialias)return!0;var y=sceneOrthoScale(scene);return(null==y?0:Math.abs(y-orthoZero))<1e-8;});plot.option("OverflowMarkersVisible")&&this._addOverflowMarkers(wrapper);var label=pvc.visual.ValueLabel.maybeCreate(me,pvBar,{wrapper:wrapper});if(label){var labelBarOrthoLen;if(label.hideOrTrimOverflowed){labelBarOrthoLen=bandWidth;!isStacked&&seriesCount>1&&(labelBarOrthoLen/=seriesCount);}
me.pvBarLabel=label.override("calcTextFitInfo",function(scene,text){var pvLabel=this.pvMark,tm=pvLabel.textMargin();if(!(tm<-1e-6)){var a=pvLabel.textAngle(),sinAngle=Math.sin(a),isHorizText=Math.abs(sinAngle)<1e-6,isVertiText=!isHorizText&&Math.abs(Math.cos(a))<1e-6;if(isHorizText||isVertiText&&isVertical){var twMax,isInside,isTaCenter,h=pvBar.height(),w=pvBar.width(),ml=isVertical?h:w,al=isVertical?w:h,m=pv.Text.measure(text,pvLabel.font()),th=.75*m.height,tw=m.width,va=pvLabel.name(),tb=pvLabel.textBaseline(),ta=pvLabel.textAlign(),isVaCenter="center"===va,hide=!1;if(isVertical)if(isHorizText){isInside=isVaCenter||va===tb;if(!isInside)return;hide|=isVaCenter&&"middle"!==tb?th+tm>ml/2:th+2*tm>ml;}else{hide|=ml<th;isTaCenter="center"===ta;isInside=isVaCenter;isInside||isTaCenter||(isInside=sinAngle>=1e-6?"left"===ta?"top"===va:"bottom"===va:"left"===ta?"bottom"===va:"top"===va);if(isInside){twMax=!isVaCenter||isTaCenter?ml-2*tm:(ml-tm)/2;hide|=("middle"===tb?th>al:th>al/2)||this.hideOverflowed&&tw>twMax;}else hide|=th>=Math.max(al,labelBarOrthoLen);}else{hide|=ml<th;isInside=isVaCenter||va===ta;if(isInside){twMax=isVaCenter&&"center"!==ta?(ml-tm)/2:ml-2*tm;hide|=("middle"===tb?th>al:th>al/2)||this.hideOverflowed&&tw>twMax;}else hide|=th>=Math.max(al,labelBarOrthoLen);}
return{hide:hide,widthMax:twMax};}}}).pvMark;}},_barVerticalMode:function(){return this.plot.option("ValuesNormalized")?"expand":null;},_barDifferentialControl:function(){return null;},_getV1Datum:function(scene){var datum=scene.datum;if(datum){var datumEx=Object.create(datum);datumEx.percent=scene.vars.value.percent;datum=datumEx;}
return datum;},_guessHideOverflow:function(){return this.base()||!this.stacked&&!this.axes.ortho.option("OriginIsZero");},_addOverflowMarkers:function(wrapper){var orthoAxis=this.axes.ortho,originIsZero=this.stacked||orthoAxis.option("OriginIsZero");originIsZero&&null==orthoAxis.option("FixedMax")||(this.pvOverflowMarker=this._addOverflowMarker(!1,orthoAxis.scale,wrapper));originIsZero&&null==orthoAxis.option("FixedMin")||(this.pvUnderflowMarker=this._addOverflowMarker(!0,orthoAxis.scale,wrapper));},_addOverflowMarker:function(isMin,orthoScale,wrapper){var angle,isVertical=this.isOrientationVertical(),a_bottom=isVertical?"bottom":"left",a_top=this.anchorOpposite(a_bottom),a_height=this.anchorOrthoLength(a_bottom),a_width=this.anchorLength(a_bottom),orthoSizeMinHalf=this.plot.option("BarOrthoSizeMin")/2,paddings=this._layoutInfo.paddings,botBound=orthoScale.min-paddings[a_bottom],topBound=orthoScale.max+paddings[a_top],orthoBound=isMin?botBound:topBound;angle=isMin?isVertical?0:Math.PI/2:isVertical?Math.PI:-Math.PI/2;return new pvc.visual.Dot(this,this.pvBar.anchor("center"),{noSelect:!0,noHover:!0,noClick:!0,noDoubleClick:!0,noTooltip:!1,freePosition:!0,extensionId:isMin?"underflowMarker":"overflowMarker",wrapper:wrapper}).intercept("visible",function(scene){var visible=this.delegateExtension();if(void 0!==visible&&!visible)return!1;var value=scene.vars.value.value;if(null==value)return!1;var targetInstance=this.pvMark.scene.target[this.pvMark.index],botPos=targetInstance[a_bottom],topPos=botPos+targetInstance[a_height],valuePos=value<0?botPos:topPos;return(isMin?topPos<=botBound||valuePos<botBound:botPos>=topBound||valuePos>topBound)&&(0!==value||(isMin?botBound-topPos:topPos-topBound)>orthoSizeMinHalf);}).pvMark.shape("triangle").shapeRadius(function(){return Math.min(Math.sqrt(10),this.scene.target[this.index][a_width]/2);}).shapeAngle(angle).lineWidth(1.5).strokeStyle("red").fillStyle("white")[a_top](null)[a_bottom](function(){return orthoBound+(isMin?1:-1)*(this.shapeRadius()+2);});},renderInteractive:function(){this.pvPanel.render();},_buildSceneCore:function(data,axisSeriesDatas,axisCategDatas){function createSeriesScene(axisSeriesData){var seriesScene=new pvc.visual.Scene(rootScene,{source:axisSeriesData}),seriesKey=axisSeriesData.key;seriesScene.vars.series=pvc_ValueLabelVar.fromComplex(axisSeriesData);colorVarHelper.onNewScene(seriesScene,!1);axisCategDatas.forEach(function(axisCategData){var categData=data.child(axisCategData.key),group=categData&&categData.child(seriesKey),scene=new pvc.visual.Scene(seriesScene,{source:group});(scene.vars.category=pvc_ValueLabelVar.fromComplex(categData)).group=categData;valueVarHelper.onNewScene(scene,!0);colorVarHelper.onNewScene(scene,!0);});}
var rootScene=new pvc.visual.Scene(null,{panel:this,source:data}),valueVarHelper=new pvc.visual.RoleVarHelper(rootScene,"value",this.visualRoles.value,{hasPercentSubVar:this.stacked}),colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,"color",this.visualRoles.color);axisSeriesDatas.forEach(createSeriesScene);return rootScene;}});pv.PieSlice=function(){pv.Wedge.call(this);};pv.PieSlice.prototype=pv.extend(pv.Wedge).property("offsetRadius");var normAngle=pv.Shape.normalizeAngle;pv.PieSlice.prototype.midAngle=function(){var instance=this.instance();return normAngle(instance.startAngle)+normAngle(instance.angle)/2;};pv.PieSlice.prototype.defaults=new pv.PieSlice().extend(pv.Wedge.prototype.defaults).offsetRadius(0);def("pvc.visual.PieSlice",pvc.visual.Sign.extend({init:function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.PieSlice);keyArgs=def.setDefaults(keyArgs,"freeColor",!1);this.base(panel,pvMark,keyArgs);this._activeOffsetRadius=def.get(keyArgs,"activeOffsetRadius",0);this._maxOffsetRadius=def.get(keyArgs,"maxOffsetRadius",0);this._resolvePctRadius=def.get(keyArgs,"resolvePctRadius");this._center=def.get(keyArgs,"center");this.optional("lineWidth",.6)._bindProperty("angle","angle")._bindProperty("offsetRadius","offsetRadius")._lockDynamic("bottom","y")._lockDynamic("left","x").lock("top",null).lock("right",null);},properties:["offsetRadius"],methods:{angle:def.fun.constant(0),x:function(){return this._center.x+this._offsetSlice("cos");},y:function(){return this._center.y-this._offsetSlice("sin");},_offsetSlice:function(fun){var offset=this.pvMark.offsetRadius()||0;offset&&(offset*=Math[fun](this.pvMark.midAngle()));return offset;},defaultColor:function(scene,type){return"stroke"===type?null:this.base(scene,type);},interactiveColor:function(scene,color,type){if(this.mayShowActive(scene,!0))switch(type){case"fill":return color.brighter(.2).alpha(.8);case"stroke":return color.brighter(1.3).alpha(.7);}else if(this.mayShowNotAmongSelected(scene)&&"fill"===type)return this.dimColor(color,type);return this.base(scene,color,type);},offsetRadius:function(scene){var offsetRadius=this.base(scene);return Math.min(Math.max(0,offsetRadius),this._maxOffsetRadius);},baseOffsetRadius:function(scene){var offsetRadius=this.base(scene)||0;return this._resolvePctRadius(pvc_PercentValue.parse(offsetRadius));},interactiveOffsetRadius:function(scene,offsetRadius){return offsetRadius+(this.mayShowActive(scene,!0)?this._activeOffsetRadius:0);}}}));def("pvc.visual.PiePlot",pvc.visual.Plot.extend({init:function(chart,keyArgs){this.base(chart,keyArgs);if(!(chart instanceof pvc.PieChart))throw def.error(def.format("Plot type '{0}' can only be used from within a pie chart.",[this.type]));},methods:{type:"pie",_initVisualRoles:function(){this.base();this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0});this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:!0,requireSingleDimension:!1,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"});},_getColorRoleSpec:function(){return{isRequired:!0,defaultSourceRole:"category",defaultDimension:"color*",requireIsDiscrete:!0};},createData:function(baseData,ka){return this.visualRoles.category.flatten(baseData,ka);},_initDataCells:function(){this.base();this._addDataCell(new pvc.visual.DataCell(this,"category",this.index,this.visualRole("category")));this._addDataCell(new pvc.visual.DataCell(this,"angle",this.index,this.visualRoles.value));}},options:{ActiveSliceRadius:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:new pvc_PercentValue(.05)},ExplodedSliceRadius:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:0},ExplodedSliceIndex:{resolve:"_resolveFull",cast:def.number.to,value:null},ValuesAnchor:{cast:pvc.parseAnchorWedge,value:"outer"},ValuesVisible:{value:!0},ValuesLabelStyle:{resolve:function(optionInfo){return this.chart.compatVersion()>1?this._resolveFull(optionInfo):(optionInfo.specify("inside"),!0);},cast:function(value){switch(value){case"inside":case"linked":return value;}
def.debug>=2&&def.log("[Warning] Invalid 'ValuesLabelStyle' value: '"+value+"'.");return"linked";},value:"linked"},ValuesMask:{resolve:"_resolveFull",data:{resolveDefault:function(optionInfo){optionInfo.defaultValue("linked"===this.option("ValuesLabelStyle")?"{value} ({value.percent})":"{value}");return!0;}}},LinkInsetRadius:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:new pvc_PercentValue(.05)},LinkOutsetRadius:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:new pvc_PercentValue(.025)},LinkMargin:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:new pvc_PercentValue(.025)},LinkHandleWidth:{resolve:"_resolveFull",cast:def.number.to,value:.5},LinkLabelSize:{resolve:"_resolveFull",cast:pvc_PercentValue.parse,value:new pvc_PercentValue(.15)},LinkLabelSpacingMin:{resolve:"_resolveFull",cast:def.number.to,value:.5}}}));pvc.visual.Plot.registerClass(pvc.visual.PiePlot);def.type("pvc.PiePanel",pvc.PlotPanel).init(function(chart,parent,plot,options){var labelStyle=plot.option("ValuesLabelStyle");this.base(chart,parent,plot,options);this.explodedOffsetRadius=plot.option("ExplodedSliceRadius");this.explodedSliceIndex=plot.option("ExplodedSliceIndex");this.activeOffsetRadius=plot.option("ActiveSliceRadius");this.labelStyle=labelStyle;if("linked"===labelStyle){this.linkInsetRadius=plot.option("LinkInsetRadius");this.linkOutsetRadius=plot.option("LinkOutsetRadius");this.linkMargin=plot.option("LinkMargin");this.linkHandleWidth=plot.option("LinkHandleWidth");this.linkLabelSize=plot.option("LinkLabelSize");this.linkLabelSpacingMin=plot.option("LinkLabelSpacingMin");}
chart.pieChartPanel||(chart.pieChartPanel=this);this.axes.category=chart._getAxis("category",plot.index);this.axes.angle=chart._getAxis("angle",plot.index);}).add({plotType:"pie",_ibits:-1,pvPie:null,pvPieLabel:null,valueRoleName:"value",_getV1Datum:function(scene){var datum=scene.datum;if(datum){var datumEx=Object.create(datum);datumEx.percent=scene.vars.value.percent;datum=datumEx;}
return datum;},_calcLayout:function(layoutInfo){function resolvePercentRadius(radius){return def.between(pvc_PercentValue.resolve(radius,clientRadius),0,clientRadius);}
function resolvePercentWidth(width){return def.between(pvc_PercentValue.resolve(width,clientWidth),0,clientWidth);}
var clientSize=layoutInfo.clientSize,clientWidth=clientSize.width,clientRadius=Math.min(clientWidth,clientSize.height)/2;if(!clientRadius)return new pvc_Size(0,0);var center=pv.vector(clientSize.width/2,clientSize.height/2),labelFont=this._getConstantExtension("label","font");def.string.is(labelFont)||(labelFont=this.valuesFont);var maxPieRadius=clientRadius;if(this.valuesVisible&&"linked"===this.labelStyle){var textMargin=def.number.to(this._getConstantExtension("label","textMargin"),3),textHeight=pv.Text.fontHeight(labelFont),linkHandleWidth=this.linkHandleWidth*textHeight,linkInsetRadius=resolvePercentRadius(this.linkInsetRadius),linkOutsetRadius=resolvePercentRadius(this.linkOutsetRadius),linkMargin=resolvePercentWidth(this.linkMargin)+linkHandleWidth,linkLabelSize=resolvePercentWidth(this.linkLabelSize),linkLabelSpacingMin=this.linkLabelSpacingMin*textHeight,freeWidthSpace=Math.max(0,clientWidth/2-clientRadius),spaceH=Math.max(0,linkOutsetRadius+linkMargin+linkLabelSize-freeWidthSpace),spaceV=linkOutsetRadius+textHeight,linkAndLabelRadius=Math.max(0,spaceV,spaceH);if(linkAndLabelRadius>=maxPieRadius){this.valuesVisible=!1;def.debug>=2&&this.log("Hiding linked labels due to insufficient space.");}else{maxPieRadius-=linkAndLabelRadius;layoutInfo.link={insetRadius:linkInsetRadius,outsetRadius:linkOutsetRadius,elbowRadius:maxPieRadius+linkOutsetRadius,linkMargin:linkMargin,handleWidth:linkHandleWidth,labelSize:linkLabelSize,maxTextWidth:linkLabelSize-textMargin,labelSpacingMin:linkLabelSpacingMin,textMargin:textMargin,lineHeight:textHeight};}}
var explodedOffsetRadius=resolvePercentRadius(this.explodedOffsetRadius),activeOffsetRadius=0;this.hoverable()&&(activeOffsetRadius=resolvePercentRadius(this.activeOffsetRadius));var maxOffsetRadius=explodedOffsetRadius+activeOffsetRadius,normalPieRadius=maxPieRadius-maxOffsetRadius;if(normalPieRadius<0)return new pvc_Size(0,0);layoutInfo.resolvePctRadius=resolvePercentRadius;layoutInfo.center=center;layoutInfo.clientRadius=clientRadius;layoutInfo.normalRadius=normalPieRadius;layoutInfo.explodedOffsetRadius=explodedOffsetRadius;layoutInfo.activeOffsetRadius=activeOffsetRadius;layoutInfo.maxOffsetRadius=maxOffsetRadius;layoutInfo.labelFont=labelFont;},_createCore:function(layoutInfo){var wrapper,me=this,chart=me.chart,rootScene=this._buildScene(),center=layoutInfo.center,normalRadius=layoutInfo.normalRadius,extensionIds=["slice"];if(this.compatVersion()<=1){extensionIds.push("");wrapper=function(v1f){return function(pieCatScene){return v1f.call(this,pieCatScene.vars.value.value);};};}
this.pvPie=new pvc.visual.PieSlice(this,this.pvPanel,{extensionId:extensionIds,center:center,activeOffsetRadius:layoutInfo.activeOffsetRadius,maxOffsetRadius:layoutInfo.maxOffsetRadius,resolvePctRadius:layoutInfo.resolvePctRadius,wrapper:wrapper,tooltipArgs:{options:{useCorners:!0,gravity:function(){var ma=this.midAngle(),isRightPlane=Math.cos(ma)>=0,isTopPlane=Math.sin(ma)>=0;return isRightPlane?isTopPlane?"nw":"sw":isTopPlane?"ne":"se";}}}}).lock("data",rootScene.childNodes).override("angle",function(scene){return scene.vars.value.angle;}).override("defaultOffsetRadius",function(){var explodeIndex=me.explodedSliceIndex;return null==explodeIndex||explodeIndex==this.pvMark.index?layoutInfo.explodedOffsetRadius:0;}).optionalMark("outerRadius",function(){return chart.animate(0,normalRadius);}).localProperty("innerRadiusEx",pvc_PercentValue.parse).intercept("innerRadius",function(scene){var innerRadius=this.delegateExtension();if(null==innerRadius){var innerRadiusPct=this.pvMark.innerRadiusEx();innerRadius=null!=innerRadiusPct?pvc_PercentValue.resolve(innerRadiusPct,this.pvMark.outerRadius())||0:0;}
return innerRadius>0?chart.animate(0,innerRadius):0;}).pvMark;if(this.valuesVisible){this.valuesFont=layoutInfo.labelFont;if("inside"===this.labelStyle)this.pvPieLabel=pvc.visual.ValueLabel.maybeCreate(this,this.pvPie,{wrapper:wrapper}).override("defaultText",function(scene){return scene.vars.value.sliceLabel;}).override("calcTextFitInfo",function(scene,text){var pvLabel=this.pvMark,tm=pvLabel.textMargin();if(!(tm<-1e-6)){if("middle"===pvLabel.textBaseline()){var sa=pvc.normAngle(me.pvPie.midAngle()),la=pvc.normAngle(pvLabel.textAngle()),sameAngle=Math.abs(sa-la)<1e-6,oppoAngle=!1;if(!sameAngle){var la2=pvc.normAngle(la+Math.PI);oppoAngle=Math.abs(sa-la2)<1e-6;}
if(sameAngle||oppoAngle){var va=pvLabel.name(),ta=pvLabel.textAlign();if("outer"===va&&ta===(sameAngle?"right":"left")){var hide=!1,m=pv.Text.measure(text,pvLabel.font()),th=.85*m.height,or=me.pvPie.outerRadius(),ir=me.pvPie.innerRadius(),a=scene.vars.value.angle,thEf=th+tm/2,irmin=a<Math.PI?Math.max(ir,thEf/(2*Math.tan(a/2))):ir,twMax=or-tm-irmin;hide|=twMax<=0;twMax-=tm;hide|=this.hideOverflowed&&m.width>twMax;return{hide:hide,widthMax:twMax};}}}}}).pvMark.textMargin(10);else if("linked"===this.labelStyle){var linkLayout=layoutInfo.link;rootScene.layoutLinkLabels(layoutInfo);this.pvLinkPanel=this.pvPanel.add(pv.Panel).data(rootScene.childNodes).localProperty("pieSlice").pieSlice(function(){return me.pvPie.scene[this.index];});var f=!1,t=!0;this.pvLinkLine=new pvc.visual.Line(this,this.pvLinkPanel,{extensionId:"linkLine",freePosition:t,noClick:t,noDoubleClick:t,noSelect:t,noTooltip:t,noHover:t,showsActivity:f}).lockMark("data",function(scene){var pieSlice=this.parent.pieSlice(),midAngle=pieSlice.startAngle+pieSlice.angle/2,outerRadius=pieSlice.outerRadius-linkLayout.insetRadius,x=pieSlice.left+outerRadius*Math.cos(midAngle),y=pieSlice.top+outerRadius*Math.sin(midAngle),firstDotScene=scene.childNodes[0];if(firstDotScene&&firstDotScene._isFirstDynamicScene){firstDotScene.x=x;firstDotScene.y=y;}else{firstDotScene=new pvc.visual.PieLinkLineScene(scene,x,y,0);firstDotScene._isFirstDynamicScene=t;}
return scene.childNodes;}).override("defaultColor",function(scene,type){return"stroke"===type?"black":this.base(scene,type);}).override("defaultStrokeWidth",def.fun.constant(.5)).pvMark.lock("visible").lock("top",function(dot){return dot.y;}).lock("left",function(dot){return dot.x;});this.pvPieLabel=new pvc.visual.Label(this,this.pvLinkPanel,{extensionId:"label",noClick:f,noDoubleClick:f,noSelect:f,noHover:f,showsInteraction:t}).lockMark("data",function(scene){return scene.lineScenes;}).intercept("textStyle",function(scene){this._finished=f;var style=this.delegate();style&&!this._finished&&!this.mayShowActive(scene)&&this.mayShowNotAmongSelected(scene)&&(style=this.dimColor(style,"text"));return style;}).pvMark.lock("visible").left(function(scene){return scene.vars.link.labelX;}).top(function(scene){return scene.vars.link.labelY+(this.index+1)*linkLayout.lineHeight;}).textAlign(function(scene){return scene.vars.link.labelAnchor;}).textMargin(linkLayout.textMargin).textBaseline("bottom").text(function(scene){return scene.vars.link.labelLines[this.index];});if(def.debug>=20){this.pvPanel.add(pv.Panel).zOrder(-10).left(center.x-layoutInfo.clientRadius).top(center.y-layoutInfo.clientRadius).width(2*layoutInfo.clientRadius).height(2*layoutInfo.clientRadius).strokeStyle("red");this.pvPanel.strokeStyle("green");var linkColors=pv.Colors.category10();this.pvLinkLine.segmented(t).strokeStyle(function(){return linkColors(this.index);});}}
this.pvPieLabel.font(layoutInfo.labelFont);}},renderInteractive:function(){this.pvPanel.render();},_buildScene:function(){var rootScene=new pvc.visual.PieRootScene(this);this.sum=rootScene.vars.sumAbs.value;return rootScene;}});pvc.PlotPanel.registerClass(pvc.PiePanel);def.type("pvc.visual.PieRootScene",pvc.visual.Scene).init(function(panel){function formatValue(value,valueDim,categData){if(categData){var datums=categData._datums;if(1===datums.length)return datums[0].atoms[valueDim.name].label;}
return valueDim.format(value);}
var categAxis=panel.axes.category,categRootData=categAxis.domainData();this.base(null,{panel:panel,source:categRootData});var colorVarHelper=new pvc.visual.RoleVarHelper(this,"color",panel.visualRoles.color),valueRole=panel.visualRoles[panel.valueRoleName],formatSumValueDim=categRootData.dimensions(valueRole.firstDimensionName()),angleScale=panel.axes.angle.scale,sumAbs=angleScale.isNull?0:angleScale.domain()[1],rootScene=this;this.vars.sumAbs=new pvc_ValueLabelVar(sumAbs,formatValue(sumAbs,formatSumValueDim));var CategSceneClass=def.type(pvc.visual.PieCategoryScene).init(function(categData,value,valueDim){this.base(rootScene,{source:categData});this.vars.category=pvc_ValueLabelVar.fromComplex(categData);var valueVar=new pvc_ValueLabelVar(value,formatValue(value,valueDim,categData));valueVar.angle=angleScale(value);var percent=Math.abs(value)/sumAbs,pctValueFormat=valueDim.type.format().percent();valueVar.percent=new pvc_ValueLabelVar(percent,pctValueFormat(percent));this.vars.value=valueVar;valueVar.sliceLabel=this.sliceLabel();colorVarHelper.onNewScene(this,!0);});panel._extendSceneType("category",CategSceneClass,["sliceLabel","sliceLabelMask"]);var categDatas=categAxis.domainItems();if(categDatas.length){categDatas.forEach(function(categData){var valueDimName=valueRole.getBoundDimensionName(categData),valueDim=categData.dimensions(valueDimName),value=valueDim.value();0!==value&&new CategSceneClass(categData,value,valueDim);});if(!rootScene.childNodes.length&&!panel.chart.visualRoles.multiChart.isBound())throw new pvc.InvalidDataException("Unable to create a pie chart, please check the data values.","all-zero-data");}}).add({layoutLinkLabels:function(layoutInfo){var startAngle=-Math.PI/2,leftScenes=[],rightScenes=[];this.childNodes.forEach(function(categScene){startAngle=categScene.layoutI(layoutInfo,startAngle);(categScene.vars.link.dir>0?rightScenes:leftScenes).push(categScene);});this._distributeLabels(-1,leftScenes,layoutInfo);this._distributeLabels(1,rightScenes,layoutInfo);},_distributeLabels:function(dir,scenes,layoutInfo){scenes.sort(function(sceneA,sceneB){return def.compare(sceneA.vars.link.targetY,sceneB.vars.link.targetY);});this._distributeLabelsDownwards(scenes,layoutInfo)&&this._distributeLabelsUpwards(scenes,layoutInfo)&&this._distributeLabelsEvenly(scenes,layoutInfo);scenes.forEach(function(categScene){categScene.layoutII(layoutInfo);});},_distributeLabelsDownwards:function(scenes,layoutInfo){for(var linkLayout=layoutInfo.link,labelSpacingMin=linkLayout.labelSpacingMin,yMax=layoutInfo.clientSize.height,overlapping=!1,i=0,J=scenes.length-1;i<J;i++){var linkVar0=scenes[i].vars.link;!i&&linkVar0.labelTop()<0&&(overlapping=!0);var linkVar1=scenes[i+1].vars.link,labelTopMin1=linkVar0.labelBottom()+labelSpacingMin;if(linkVar1.labelTop()<labelTopMin1){var halfLabelHeight1=linkVar1.labelHeight/2,targetY1=labelTopMin1+halfLabelHeight1,targetYMax=yMax-halfLabelHeight1;if(targetY1>targetYMax){overlapping=!0;linkVar1.targetY=targetYMax;}else linkVar1.targetY=targetY1;}}
return overlapping;},_distributeLabelsUpwards:function(scenes,layoutInfo){for(var linkLayout=layoutInfo.link,labelSpacingMin=linkLayout.labelSpacingMin,overlapping=!1,i=scenes.length-1;i>0;i--){var linkVar1=scenes[i-1].vars.link,linkVar0=scenes[i].vars.link;1===i&&linkVar1.labelTop()<0&&(overlapping=!0);var labelBottomMax1=linkVar0.labelTop()-labelSpacingMin;if(linkVar1.labelBottom()>labelBottomMax1){var halfLabelHeight1=linkVar1.labelHeight/2,targetY1=labelBottomMax1-halfLabelHeight1,targetYMin=halfLabelHeight1;if(targetY1<targetYMin){overlapping=!0;linkVar1.targetY=targetYMin;}else linkVar1.targetY=targetY1;}}
return overlapping;},_distributeLabelsEvenly:function(scenes,layoutInfo){var totalHeight=0;scenes.forEach(function(categScene){totalHeight+=categScene.vars.link.labelHeight;});var freeSpace=layoutInfo.clientSize.height-totalHeight,labelSpacing=freeSpace;scenes.length>1&&(labelSpacing/=scenes.length-1);var y=0;scenes.forEach(function(scene){var linkVar=scene.vars.link,halfLabelHeight=linkVar.labelHeight/2;y+=halfLabelHeight;linkVar.targetY=y;y+=halfLabelHeight+labelSpacing;});return!0;}});def.type("pvc.visual.PieLinkLabelVar").add({labelTop:function(){return this.targetY-this.labelHeight/2;},labelBottom:function(){return this.targetY+this.labelHeight/2;}});def.type("pvc.visual.PieCategoryScene",pvc.visual.Scene).add({sliceLabelMask:function(){return this.panel().valuesMask;},sliceLabel:function(){return this.format(this.sliceLabelMask());},layoutI:function(layoutInfo,startAngle){var valueVar=this.vars.value,endAngle=startAngle+valueVar.angle,midAngle=(startAngle+endAngle)/2,linkVar=this.vars.link=new pvc.visual.PieLinkLabelVar(),linkLayout=layoutInfo.link,labelLines=pvc.text.justify(valueVar.sliceLabel,linkLayout.maxTextWidth,layoutInfo.labelFont),lineCount=labelLines.length;linkVar.labelLines=labelLines;linkVar.labelHeight=lineCount*linkLayout.lineHeight;this.lineScenes=def.array.create(lineCount,this);var cosMid=Math.cos(midAngle),sinMid=Math.sin(midAngle),isAtRight=cosMid>=0,dir=isAtRight?1:-1;linkVar.labelAnchor=isAtRight?"left":"right";var center=layoutInfo.center,elbowRadius=linkLayout.elbowRadius,elbowX=center.x+elbowRadius*cosMid,elbowY=center.y+elbowRadius*sinMid,anchorX=center.x+dir*elbowRadius,targetX=anchorX+dir*linkLayout.linkMargin;new pvc.visual.PieLinkLineScene(this,elbowX,elbowY);new pvc.visual.PieLinkLineScene(this,anchorX,elbowY);linkVar.elbowY=elbowY;linkVar.targetY=elbowY+0;linkVar.targetX=targetX;linkVar.dir=dir;return endAngle;},layoutII:function(layoutInfo){var linkVar=this.vars.link,targetY=linkVar.targetY,targetX=linkVar.targetX,handleWidth=layoutInfo.link.handleWidth;handleWidth>0&&new pvc.visual.PieLinkLineScene(this,targetX-linkVar.dir*handleWidth,targetY);new pvc.visual.PieLinkLineScene(this,targetX,targetY);linkVar.labelX=targetX;linkVar.labelY=targetY-linkVar.labelHeight/2;}});def.type("pvc.visual.PieLinkLineScene",pvc.visual.Scene).init(function(catScene,x,y,index){this.base(catScene,{source:catScene.group,index:index});this.x=x;this.y=y;}).add(pv.Vector);def.type("pvc.PieChart",pvc.BaseChart).add({_axisClassByType:{category:pvc.visual.Axis,angle:pvc.visual.NormalizedAxis},_axisCreateChartLevel:{category:2,angle:2},_axisSetScaleChartLevel:{category:2,angle:2},_axisCreationOrder:function(){var a=pvc.BaseChart.prototype._axisCreationOrder.slice();a.push("category","angle");return a;}(),_createPlotsInternal:function(){this._addPlot(new pvc.visual.PiePlot(this));},_setAxisScale:function(axis,chartLevel){this.base(axis,chartLevel);2&chartLevel&&"angle"===axis.type&&axis.setScaleRange({min:0,max:2*Math.PI});},_createContentPanel:function(parentPanel,contentOptions){if(this.compatVersion()<=1){var innerGap=def.number.to(this.options.innerGap)||.95;innerGap=def.between(innerGap,.1,1);contentOptions.paddings=(100*(1-innerGap)/2).toFixed(2)+"%";}else null==contentOptions.paddings&&(contentOptions.paddings=new pvc_PercentValue(.025));return this.base(parentPanel,contentOptions);},_createContent:function(parentPanel,contentOptions){contentOptions.scenes=def.getPath(this.options,"pie.scenes");this.base(parentPanel,contentOptions);}});def("pvc.visual.BarPlot",pvc.visual.BarPlotAbstract.extend({methods:{type:"bar"}}));pvc.visual.Plot.registerClass(pvc.visual.BarPlot);def.type("pvc.BarPanel",pvc.BarAbstractPanel).add({plotType:"bar",_ibits:-1});pvc.PlotPanel.registerClass(pvc.BarPanel);def.type("pvc.BarChart",pvc.BarAbstract).add({_allowV1SecondAxis:!0,_createPlotsInternal:function(){this._createMainPlot();this.options.plot2&&this._addPlot(new pvc.visual.PointPlot(this,{name:"plot2",defaults:{DataPart:"1",ColorAxis:2,LinesVisible:!0,DotsVisible:!0}}));},_createMainPlot:function(){this._addPlot(new pvc.visual.BarPlot(this));},_createPlotTrend:function(){this._addPlot(new pvc.visual.PointPlot(this,{name:"trend",spec:{visualRoles:{color:{from:"series"}}},fixed:{TrendType:"none",NullInterpolatioMode:"none"},defaults:{DataPart:"trend",ColorAxis:2,LinesVisible:!0,DotsVisible:!1}}));},_willBindVisualRoles:function(complexType){this.base(complexType);if(this.plots.trend){var valueDimNames=this._getPreBoundTrendedDimensionNames();this.plots.trend.visualRoles.value.preBind(cdo.GroupingSpec.parse(valueDimNames));}},_createContent:function(parentPanel,contentOptions){this.base(parentPanel,contentOptions);var barPanel=this.plotPanels.bar,plot2Panel=this.plotPanels.plot2;if(plot2Panel&&"point"===plot2Panel.plot.type){if(barPanel){barPanel.pvSecondLine=plot2Panel.pvLine;barPanel.pvSecondDot=plot2Panel.pvDot;}
plot2Panel._applyV1BarSecondExtensions=!0;}}});def.type("pvc.NormalizedBarChart",pvc.BarChart).add({_createMainPlot:function(){this._addPlot(new pvc.visual.BarPlot(this,{fixed:{ValuesNormalized:!0,Stacked:!0}}));}});pvc.parseWaterDirection=function(value){if(value){value=(""+value).toLowerCase();switch(value){case"up":case"down":return value;}
def.debug>=2&&def.log("[Warning] Invalid 'WaterDirection' value: '"+value+"'.");}};def("pvc.visual.WaterfallPlot",pvc.visual.BarPlotAbstract.extend({init:function(chart,keyArgs){this.base(chart,keyArgs);chart._registerInitLegendScenes(this._initLegendScenes.bind(this));},methods:{type:"water",_waterColor:pv.color("#1f77b4").darker(),_initEnd:function(){var extAbsId=pvc.makeExtensionAbsId("line",this.extensionPrefixes),strokeStyle=this.chart._getConstantExtension(extAbsId,"strokeStyle");strokeStyle&&(this._waterColor=pv.color(strokeStyle));this.base();},_getCategoryRoleSpec:function(){var catRoleSpec=this.base(),flatMode=this.isFalling()?"DfsPre":"DfsPost";catRoleSpec.flatteningModes=cdo.FlatteningMode[flatMode];catRoleSpec.rootLabel=this.option("AllCategoryLabel");return catRoleSpec;},isFalling:function(){return"down"===this.option("Direction");},_reduceStackedCategoryValueExtent:function(chart,result,catRange,catGroup,valueAxis,valueDataCell){var offsetNext,offsetPrev=result?result.offset:0,offsetDelta=catRange.min+catRange.max;if(!result){if(catRange){offsetNext=offsetPrev+offsetDelta;valueAxis.setDataCellScaleInfo(valueDataCell,[{offset:offsetNext,group:catGroup,range:catRange}]);return{min:catRange.min,max:catRange.max,offset:offsetNext};}
return null;}
var isFalling=this.isFalling();if(catGroup._isFlattenGroup&&!catGroup._isDegenerateFlattenGroup){var deltaUp=-catRange.min;if(deltaUp>0){var top=offsetPrev+deltaUp;top>result.max&&(result.max=top);}
var deltaDown=-catRange.max;if(deltaDown<0){var bottom=offsetPrev+deltaDown;bottom<result.min&&(result.min=bottom);}}else{var dir=isFalling?-1:1;offsetNext=result.offset=offsetPrev+dir*offsetDelta;offsetNext>result.max?result.max=offsetNext:offsetNext<result.min&&(result.min=offsetNext);}
valueAxis.getDataCellScaleInfo(valueDataCell).push({offset:isFalling?offsetPrev:result.offset,group:catGroup,range:catRange});return result;},_initLegendScenes:function(legendPanel){var rootScene=legendPanel._getLegendRootScene();new pvc.visual.legend.WaterfallLegendGroupScene(rootScene,this,{extensionPrefix:def.indexedId("",1),label:this.option("TotalLineLabel"),color:this._waterColor});}},options:{Stacked:{resolve:null,value:!0},ValuesNormalized:{resolve:null,value:!1},TotalLineLabel:{resolve:"_resolveFull",cast:String,value:"Accumulated"},TotalValuesVisible:{resolve:"_resolveFull",data:{resolveDefault:function(optionInfo){return optionInfo.defaultValue(this.option("ValuesVisible")),!0;}},cast:Boolean},Direction:{resolve:"_resolveFull",cast:pvc.parseWaterDirection,value:"down"},AreasVisible:{resolve:"_resolveFull",cast:Boolean,value:!0},AllCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"}}}));pvc.visual.Plot.registerClass(pvc.visual.WaterfallPlot);def.type("pvc.visual.legend.WaterfallLegendGroupScene",pvc.visual.legend.LegendGroupScene).init(function(rootScene,plot,keyArgs){keyArgs=def.set(keyArgs,"clickMode","none");this.base(rootScene,keyArgs);this.plot=plot;this.createItem(keyArgs);}).add({itemSceneType:function(){return pvc.visual.legend.WaterfallLegendItemScene;}});def.type("pvc.visual.legend.WaterfallLegendItemScene",pvc.visual.legend.LegendItemScene).init(function(groupScene,keyArgs){this.base.apply(this,arguments);var I=pvc.visual.Interactive;this._ibits=I.Interactive|I.ShowsInteraction;this.color=def.get(keyArgs,"color");this.vars.value=new pvc_ValueLabelVar(null,def.get(keyArgs,"label"));});def.type("pvc.WaterfallPanel",pvc.BarAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);chart.wfChartPanel||(chart.wfChartPanel=this);}).add({plotType:"water",_ibits:-1,pvWaterfallLine:null,ruleData:null,_barDifferentialControl:function(){var isFalling=this.plot.isFalling();return function(scene){if(isFalling&&!this.index)return 1;var group=scene.vars.category.group;return group._isFlattenGroup&&!group._isDegenerateFlattenGroup?-2:isFalling?-1:1;};},_creating:function(){var rootScene=this._getLegendRootScene();if(rootScene){var waterfallGroupScene=def.query(rootScene.childNodes).first(function(groupScene){return groupScene.plot===this;},this.plot);if(waterfallGroupScene&&!waterfallGroupScene.hasRenderer()){var keyArgs={drawLine:!0,drawMarker:!1,rulePvProto:new pv.Rule()};this.extend(keyArgs.rulePvProto,"line",{constOnly:!0});waterfallGroupScene.renderer(keyArgs);}}},_createCore:function(){this.base();var chart=this.chart,isVertical=this.isOrientationVertical(),anchor=isVertical?"bottom":"left",ao=this.anchorOrtho(anchor),orthoAxis=this.axes.ortho,baseAxis=this.axes.base,valueDataCell=this.plot.dataCellsByRole.value[0],ris=orthoAxis.getDataCellScaleInfo(valueDataCell),ruleRootScene=this._buildRuleScene(ris),orthoScale=orthoAxis.scale,orthoZero=orthoScale(0),sceneOrthoScale=orthoAxis.sceneScale({sceneVarName:"value"}),sceneBaseScale=baseAxis.sceneScale({sceneVarName:"category"}),baseScale=baseAxis.scale,barWidth2=this.barWidth/2,barWidth=this.barWidth,barStepWidth=this.barStepWidth,isFalling=this.plot.isFalling(),waterColor=this.plot._waterColor;if(this.plot.option("AreasVisible")){var panelColors=pv.Colors.category10(),waterGroupRootScene=this._buildWaterGroupScene(ris),orthoRange=orthoScale.range(),orthoPanelMargin=.04*(orthoRange[1]-orthoRange[0]);this.pvWaterfallGroupPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:"group"}).lock("data",waterGroupRootScene.childNodes).pvMark.zOrder(-1).fillStyle(function(){return panelColors(0).alpha(.15);})[ao](function(scene){var c=scene.vars.category;return baseScale(c.valueLeft)-barStepWidth/2;})[this.anchorLength(anchor)](function(scene){var c=scene.vars.category;return Math.abs(baseScale(c.valueRight)-baseScale(c.valueLeft))+barStepWidth;})[anchor](function(scene){var v=scene.vars.value,b=orthoScale(v.valueBottom)-orthoPanelMargin/2;return chart.animate(orthoZero,b);})[this.anchorOrthoLength(anchor)](function(scene){var v=scene.vars.value,h=orthoScale(v.valueTop)-orthoScale(v.valueBottom)+orthoPanelMargin;return chart.animate(0,h);});}
this.pvBar.sign.override("baseColor",function(scene,type){var color=this.base(scene,type);return"fill"!==type||scene.vars.category.group._isFlattenGroup?color:pv.color(color).alpha(.5);});this.pvWaterfallLine=new pvc.visual.Rule(this,this.pvPanel,{extensionId:"line",noTooltip:!1,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1}).lock("data",ruleRootScene.childNodes).optional("visible",function(scene){return isFalling&&!!scene.previousSibling||!isFalling&&!!scene.nextSibling;}).optional(anchor,function(scene){return orthoZero+chart.animate(0,sceneOrthoScale(scene)-orthoZero);}).optional(this.anchorLength(anchor),barStepWidth+barWidth).optional(ao,isFalling?function(scene){return sceneBaseScale(scene)-barStepWidth-barWidth2;}:function(scene){return sceneBaseScale(scene)-barWidth2;}).override("defaultColor",def.fun.constant(waterColor)).pvMark.antialias(!0).lineCap("butt");this.plot.option("TotalValuesVisible")&&(this.pvWaterfallLabel=new pvc.visual.Label(this,this.pvWaterfallLine,{extensionId:"lineLabel"}).intercept("visible",function(scene){return!scene.vars.category.group._isFlattenGroup&&(isFalling||!!scene.nextSibling);}).pvMark[anchor](function(scene){return orthoZero+chart.animate(0,sceneOrthoScale(scene)-orthoZero);})[this.anchorOrtho(anchor)](sceneBaseScale).textAlign(isVertical?"center":"left").textBaseline(function(categScene){if(!isVertical)return"middle";var direction=categScene.vars.direction;return null==direction?"bottom":!isFalling==("up"===direction)?"bottom":"top";}).textStyle(pv.Color.names.darkgray.darker(2)).textMargin(5).text(function(scene){return scene.vars.value.label;}));},_buildRuleScene:function(ris){function createCategScene(ruleInfo){var valueLabel,categData1=ruleInfo.group,categScene=new pvc.visual.Scene(rootScene,{source:categData1}),categVar=categScene.vars.category=pvc_ValueLabelVar.fromComplex(categData1),value=ruleInfo.offset,valueDimName=valueRole.getBoundDimensionName(categData1,!0);valueLabel=null!==valueDimName?rootData.dimensions(valueDimName).format(value):rootData.type.format.number()(value);categVar.group=categData1;categScene.vars.value=new pvc_ValueLabelVar(value,valueLabel);}
function completeCategScene(categScene,index){var value=categScene.vars.value.value;categScene.vars.direction=index&&prevValue!==value?isClimbing===prevValue<value?"up":"down":null;prevValue=value;}
var prevValue,isClimbing,valueRole,rootData,rootScene=new pvc.visual.Scene(null,{panel:this,source:this.visibleData({ignoreNulls:!1})});if(ris){valueRole=this.visualRoles.value;rootData=this.data.owner;ris.forEach(createCategScene,this);var q=def.query(rootScene.childNodes);isClimbing=!this.plot.isFalling();isClimbing||(q=q.reverse());q.each(completeCategScene,this);}
return rootScene;},_buildWaterGroupScene:function(ris){function createRectangleSceneRecursive(catData,level){var q=catData.children().where(function(c){return""!==c.key;});if(q.next()){level&&createRectangleScene(catData,level);level++;do{createRectangleSceneRecursive(q.item,level);}while(q.next());}}
function createRectangleScene(catData,level){var rectScene=new pvc.visual.Scene(rootScene,{source:catData}),categVar=rectScene.vars.category=pvc_ValueLabelVar.fromComplex(catData);categVar.group=catData;categVar.level=level;var leafData,leafRuleInfo,lc,rc,bv,valueVar=rectScene.vars.value={},ri=ruleInfoByCategKey[catData.absKey],offset=ri.offset,range=ri.range,height=-range.min+range.max;if(isFalling){leafData=lastLeaf(catData);leafRuleInfo=ruleInfoByCategKey[leafData.absKey];lc=ri.group.value;rc=leafRuleInfo.group.value;bv=offset-range.max;}else{leafData=firstLeaf(catData);leafRuleInfo=ruleInfoByCategKey[leafData.absKey];lc=leafRuleInfo.group.value;rc=ri.group.value;bv=offset-range.max;}
categVar.valueLeft=lc;categVar.valueRight=rc;valueVar.valueHeight=height;valueVar.valueBottom=bv;valueVar.valueTop=bv+height;}
function firstLeaf(data){var children=data.childNodes,first=children&&children[0];return first?firstLeaf(first):data;}
function lastLeaf(data){var children=data.childNodes,last=children&&children[children.length-1];return last?lastLeaf(last):data;}
var ruleInfoByCategKey,isFalling,chart=this.chart,rootCatData=this.visualRoles.category.select(chart.partData(this.dataPartValue),{visible:!0}),rootScene=new pvc.visual.Scene(null,{panel:this,source:rootCatData});if(ris){ruleInfoByCategKey=def.query(ris).object({name:function(ri){return ri.group.absKey;}});isFalling=this.plot.isFalling();createRectangleSceneRecursive(rootCatData,0);}
return rootScene;}});pvc.PlotPanel.registerClass(pvc.WaterfallPanel);def.type("pvc.WaterfallChart",pvc.BarAbstract).add({_processOptionsCore:function(options){options.baseAxisComposite=!1;this.base(options);},_createPlotsInternal:function(){this._addPlot(new pvc.visual.WaterfallPlot(this));}});def("pvc.visual.PointPlot",pvc.visual.CategoricalPlot.extend({methods:{type:"point",_initVisualRoles:function(){this.base();this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:this.option("Stacked"),requireSingleDimension:!1,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"});}},options:{DotsVisible:{resolve:"_resolveFull",data:pvcPoint_buildVisibleOption("Dots",!0),cast:Boolean,value:!1},LinesVisible:{resolve:"_resolveFull",data:pvcPoint_buildVisibleOption("Lines",!0),cast:Boolean,value:!1},AreasVisible:{resolve:"_resolveFull",data:pvcPoint_buildVisibleOption("Areas",!1),cast:Boolean,value:!1},AreasFillOpacity:{resolve:"_resolveFull",cast:def.number.toNonNegative,value:null},ValuesAnchor:{value:"right"}}}));pvc.visual.Plot.registerClass(pvc.visual.PointPlot);def.type("pvc.PointPanel",pvc.CategoricalAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.linesVisible=plot.option("LinesVisible");this.dotsVisible=plot.option("DotsVisible");this.areasVisible=plot.option("AreasVisible");if(!this.linesVisible&&!this.dotsVisible&&!this.areasVisible){this.linesVisible=!0;plot.option.specify({LinesVisible:!0});}
if(this.areasVisible&&!this.stacked){this.areasFillOpacity=plot.option("AreasFillOpacity");null==this.areasFillOpacity&&(this.areasFillOpacity=.5);}
chart.scatterChartPanel||(chart.scatterChartPanel=this);}).add({plotType:"point",_ibits:-1,pvLine:null,pvArea:null,pvDot:null,pvLabel:null,pvScatterPanel:null,_creating:function(){var colorDataCell=this.plot.dataCellsByRole.color[0];if(!colorDataCell.legendSymbolRenderer()&&colorDataCell.legendVisible()){var colorAxis=this.axes.color,drawMarker=def.nullyTo(colorAxis.option("LegendDrawMarker",!0),this.dotsVisible||this.areasVisible),drawLine=!drawMarker||def.nullyTo(colorAxis.option("LegendDrawLine",!0),this.linesVisible&&!this.areasVisible),extAbsPrefix=pvc.uniqueExtensionAbsPrefix(),keyArgs={drawMarker:drawMarker,drawLine:drawLine,extensionPrefix:{abs:extAbsPrefix}};this.chart._processExtensionPointsIn(colorDataCell.role.legend(),extAbsPrefix);if(drawMarker){var markerShape=colorAxis.option("LegendShape",!0);keyArgs.markerPvProto=new pv.Dot();if(this.dotsVisible){markerShape||(markerShape="circle");keyArgs.markerPvProto.lineWidth(1.5,pvc.extensionTag).shapeSize(12,pvc.extensionTag);}
keyArgs.markerShape=markerShape;this._applyV1BarSecondExtensions&&this.chart.extend(keyArgs.markerPvProto,"barSecondDot",{constOnly:!0});this.extend(keyArgs.markerPvProto,"dot",{constOnly:!0});}
if(drawLine){keyArgs.rulePvProto=new pv.Rule().lineWidth(1.5,pvc.extensionTag);this._applyV1BarSecondExtensions&&this.chart.extend(keyArgs.rulePvProto,"barSecondLine",{constOnly:!0});this.extend(keyArgs.rulePvProto,"line",{constOnly:!0});}
colorDataCell.legendSymbolRenderer(keyArgs);}},_createCore:function(){this.base();var wrapper,chart=this.chart,isStacked=this.stacked,dotsVisible=this.dotsVisible,areasVisible=this.areasVisible,linesVisible=this.linesVisible,anchor=this.isOrientationVertical()?"bottom":"left",baseAxis=this.axes.base,axisCategDatas=baseAxis.domainItems(),isBaseDiscrete=baseAxis.role.grouping.isDiscrete(),data=this.visibleData({ignoreNulls:!1}),axisSeriesDatas=this.visualRoles.series.flatten(this.partData(),{visible:!0,isNull:!chart.options.ignoreNulls&&null,extensionDataSetsMap:this.plot.boundDimensionsDataSetsMap}).childNodes,rootScene=this._buildScene(data,axisSeriesDatas,axisCategDatas);this.pvPanel.zOrder(areasVisible?-7:1);this.pvScatterPanel=new pvc.visual.Panel(this,this.pvPanel,{extensionId:"panel"}).lock("data",rootScene.childNodes).pvMark;var areasFillOpacity=this.areasFillOpacity;this.compatVersion()<=1&&(wrapper=isStacked?function(v1f){return function(dotScene){return v1f.call(this,dotScene.vars.value.rawValue);};}:function(v1f){return function(dotScene){var d={category:dotScene.vars.category.rawValue,value:dotScene.vars.value.rawValue},pseudo=Object.create(this);pseudo.index=dotScene.dataIndex;return v1f.call(pseudo,d);};});var sceneNotNullProp=function(scene){return!scene.isNull;},sceneNotNullOrIntermProp=function(scene){return!scene.isNull||scene.isIntermediate;},areaVisibleProp=isBaseDiscrete&&isStacked?sceneNotNullOrIntermProp:sceneNotNullProp,isLineAreaNoSelect=chart.selectableByFocusWindow();this.pvArea=new pvc.visual.Area(this,this.pvScatterPanel,{extensionId:"area",noTooltip:!1,wrapper:wrapper,noSelect:isLineAreaNoSelect,noRubberSelect:!0,showsSelection:!isLineAreaNoSelect}).lockMark("data",function(seriesScene){return seriesScene.childNodes;}).lockMark("visible",areaVisibleProp).override("x",function(scene){return scene.basePosition;}).override("y",function(scene){return scene.orthoPosition;}).override("dy",function(scene){return chart.animate(0,scene.orthoLength);}).override("color",function(scene,type){return areasVisible?this.base(scene,type):null;}).override("baseColor",function(scene,type){var color=this.base(scene,type);return!this._finished&&color&&null!=areasFillOpacity?color.alpha(def.between(color.opacity*areasFillOpacity,0,1)):color;}).override("dimColor",function(color,type){return isStacked?pvc.toGrayScale(color,1,null,null).brighter():this.base(color,type);}).lock("events",areasVisible?"painted":"none").pvMark;var dotsVisibleOnly=dotsVisible&&!linesVisible&&!areasVisible,darkerLineAndDotColor=isStacked&&areasVisible,extensionIds=["line"];this._applyV1BarSecondExtensions&&extensionIds.push({abs:"barSecondLine"});var lineVisibleProp=!dotsVisibleOnly&&(isBaseDiscrete&&isStacked&&areasVisible?sceneNotNullOrIntermProp:sceneNotNullProp),noLineInteraction=areasVisible&&!linesVisible,pvLine=this.pvLine=new pvc.visual.Line(this,this.pvArea.anchor(this.anchorOpposite(anchor)),{extensionId:extensionIds,freePosition:!0,wrapper:wrapper,noTooltip:noLineInteraction,noDoubleClick:noLineInteraction,noClick:noLineInteraction,noHover:noLineInteraction,noSelect:noLineInteraction||isLineAreaNoSelect,showsSelection:!isLineAreaNoSelect}).lockMark("visible",lineVisibleProp).override("defaultColor",function(scene,type){var color=this.base(scene,type);return!this._finished&&darkerLineAndDotColor&&color?color.darker(.6):color;}).override("normalColor",function(scene,color){return linesVisible?color:null;}).override("interactiveColor",function(scene,color,type){return linesVisible||this.mayShowAnySelected(scene)||this.mayShowActive(scene)?this.base(scene,color,type):null;}).override("baseStrokeWidth",function(scene){var strokeWidth;linesVisible&&(strokeWidth=this.base(scene));return null==strokeWidth?1.5:strokeWidth;}).intercept("strokeDasharray",function(scene){var dashArray=this.delegateExtension();if(void 0===dashArray){var useDash=scene.isInterpolated;if(!useDash){var next=scene.nextSibling;useDash=next&&next.isIntermediate&&next.isInterpolated;if(!useDash){var previous=scene.previousSibling;useDash=previous&&scene.isIntermediate&&previous.isInterpolated;}}
dashArray=useDash?". ":null;}
return dashArray;}).pvMark,showAloneDots=!(areasVisible&&isBaseDiscrete&&isStacked);extensionIds=["dot"];this._applyV1BarSecondExtensions&&extensionIds.push({abs:"barSecondDot"});this.pvDot=new pvc.visual.Dot(this,this.pvLine,{extensionId:extensionIds,freePosition:!0,wrapper:wrapper,tooltipArgs:{options:{ignoreRadius:linesVisible}}}).intercept("visible",function(scene){return!scene.isNull&&!scene.isIntermediate&&this.delegateExtension(!0);}).override("color",function(scene,type){if(!dotsVisible){if(!((showAloneDots?scene.isAlone:scene.isSingle)||scene.isActive&&this.showsActivity()))return pvc.invisibleFill;}
return this.base(scene,type);}).override("defaultColor",function(scene,type){var color=this.base(scene,type);if(color&&!this._finished){darkerLineAndDotColor&&(color=color.darker(.6));scene.isInterpolated&&"fill"===type&&(color=color.brighter(.5));}
return color;}).override("interactiveColor",function(scene,color,type){return!dotsVisible&&(scene.isSingle||scene.isAlone)&&!scene.isActive&&this.mayShowNotAmongSelected(scene)&&this.mayShowActive(scene)?pv.Color.names.darkgray.darker().darker():this.base(scene,color,type);}).optional("lineWidth",function(scene){return dotsVisible||!scene.isSingle&&!scene.isAlone||scene.isActive&&this.showsActivity()?1.5:0;}).override("size",function(scene){if(!dotsVisible&&!(scene.isActive&&this.showsActivity())&&(!showAloneDots&&scene.isSingle||showAloneDots&&scene.isAlone)){var lineWidth=Math.max(pvLine.visible()?pvLine.lineWidth():0,1),radius=lineWidth/2+1;return def.sqr(radius);}
return this.base(scene);}).override("baseSize",function(scene){var v=this.base(scene);return!this._finished&&scene.isInterpolated?.8*v:v;}).pvMark;var label=pvc.visual.ValueLabel.maybeCreate(this,this.pvDot,{wrapper:wrapper});label&&(this.pvLabel=label.pvMark);},renderInteractive:function(){this.pvScatterPanel.render();},_buildSceneCore:function(data,axisSeriesDatas,axisCategDatas){function completeSeriesScenes(seriesScene){for(var fromScene,seriesScenes2=[],seriesScenes=seriesScene.childNodes,notNullCount=0,firstAloneScene=null,c=0,toChildIndex=0,categCount=seriesScenes.length;c<categCount;c++,toChildIndex++){var toScene=seriesScenes[toChildIndex],c2=2*c;seriesScenes2[c2]=toScene;completeMainScene.call(this,fromScene,toScene,belowSeriesScenes2&&belowSeriesScenes2[c2]);toScene.isAlone&&!firstAloneScene&&(firstAloneScene=toScene);toScene.isNull||notNullCount++;if(fromScene){var interScene=createIntermediateScene.call(this,seriesScene,fromScene,toScene,toChildIndex,belowSeriesScenes2&&belowSeriesScenes2[c2-1]);if(interScene){seriesScenes2[c2-1]=interScene;toChildIndex++;}}
fromScene=toScene;}
1===notNullCount&&firstAloneScene&&1===categCount&&(firstAloneScene.isSingle=!0);isStacked&&(belowSeriesScenes2=seriesScenes2);}
function completeMainScene(fromScene,toScene,belowScene){var toAccValue=toScene.vars.value.accValue;if(belowScene){toAccValue+=belowScene.vars.value.accValue;toScene.vars.value.accValue=toAccValue;}
toScene.basePosition=sceneBaseScale(toScene);toScene.orthoPosition=orthoZero;toScene.orthoLength=orthoScale(toAccValue)-orthoZero;var isNullFrom=!fromScene||fromScene.isNull,isAlone=isNullFrom&&!toScene.isNull;if(isAlone){var nextScene=toScene.nextSibling;isAlone=!nextScene||nextScene.isNull;}
toScene.isAlone=isAlone;toScene.isSingle=!1;}
function createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex,belowScene){var interValue,interAccValue,interBasePosition,interValueLabel,interIsNull=fromScene.isNull||toScene.isNull,areasVisible=this.areasVisible;if(interIsNull){if(areasVisible&&belowScene&&isBaseDiscrete){var belowValueVar=belowScene.vars.value;interAccValue=belowValueVar.accValue;interValue=belowValueVar.value;}else interValue=interAccValue=orthoNullValue;interValueLabel=formatNullInterValueDim.format(interValue);interBasePosition=areasVisible?isStacked&&isBaseDiscrete?toScene.basePosition-sceneBaseScale.range().step/2:fromScene.isNull?toScene.basePosition:fromScene.basePosition:(toScene.basePosition+fromScene.basePosition)/2;}else{var fromValueVar=fromScene.vars.value,toValueVar=toScene.vars.value;interValue=(toValueVar.value+fromValueVar.value)/2;interAccValue=(toValueVar.accValue+fromValueVar.accValue)/2;interBasePosition=(toScene.basePosition+fromScene.basePosition)/2;var interValueDimName=toValueVar.dimensionName;interValueLabel=interValueDimName?rootData.dimensions(interValueDimName).format(interValue):defaultNumberFormatter(interValue);}
var interScene=new pvc.visual.Scene(seriesScene,{index:toChildIndex,source:toScene.source});interScene.dataIndex=toScene.dataIndex;interScene.vars.category=toScene.vars.category;var interValueVar=new pvc_ValueLabelVar(interValue,interValueLabel,interValue);interValueVar.accValue=interAccValue;interScene.vars.value=interValueVar;interScene.ownerScene=toScene;interScene.isInterpolated=toScene.isInterpolated;interScene.isIntermediate=!0;interScene.isSingle=!1;interScene.isNull=interIsNull;interScene.isAlone=interIsNull&&toScene.isNull&&fromScene.isNull;interScene.basePosition=interBasePosition;interScene.orthoPosition=orthoZero;interScene.orthoLength=orthoScale(interAccValue)-orthoZero;colorVarHelper.onNewScene(interScene,!0);return interScene;}
var rootScene=new pvc.visual.Scene(null,{panel:this,source:data}),valueRole=this.visualRoles.value,isBaseDiscrete=this.axes.base.role.grouping.isDiscrete(),isStacked=this.stacked,valueVarHelper=new pvc.visual.RoleVarHelper(rootScene,"value",valueRole,{hasPercentSubVar:isStacked}),colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,"color",this.visualRoles.color),rootData=data.owner,formatNullInterValueDim=rootData.dimensions(valueRole.firstDimensionName()),defaultNumberFormatter=data.type.format.number(),orthoScale=this.axes.ortho.scale,orthoNullValue=def.scope(function(){var domain=orthoScale.domain(),dmin=domain[0],dmax=domain[1];return dmin*dmax>=0?dmin>=0?dmin:dmax:0;}),orthoZero=orthoScale(orthoNullValue),sceneBaseScale=this.axes.base.sceneScale({sceneVarName:"category"});axisSeriesDatas.forEach(function(axisSeriesData){var seriesScene=new pvc.visual.Scene(rootScene,{source:axisSeriesData||data});seriesScene.vars.series=pvc_ValueLabelVar.fromComplex(axisSeriesData);colorVarHelper.onNewScene(seriesScene,!1);axisCategDatas.forEach(function(axisCategData,categIndex){if(isBaseDiscrete||null!==axisCategData.value){var categData=data.child(axisCategData.key),group=categData;group&&axisSeriesData&&(group=group.child(axisSeriesData.key));var serCatScene=new pvc.visual.Scene(seriesScene,{source:group});serCatScene.dataIndex=categIndex;serCatScene.vars.category=pvc_ValueLabelVar.fromComplex(axisCategData);valueVarHelper.onNewScene(serCatScene,!0);var valueVar=serCatScene.vars.value,value=valueVar.value,valueDimName=valueVar.dimensionName;valueVar.accValue=null!=value?value:orthoNullValue;colorVarHelper.onNewScene(serCatScene,!0);var isInterpolated=!1;if(null!=group){var valueDimNames=null;null===valueDimName&&(valueDimNames=valueRole.getCompatibleBoundDimensionNames(group));isInterpolated=group.datums().any(function(datum){return datum.isInterpolated&&(null!==valueDimName?datum.interpDimName===valueDimName:valueDimNames.indexOf(datum.interpDimName)>=0);});}
serCatScene.isInterpolated=isInterpolated;serCatScene.isNull=null==value;serCatScene.isIntermediate=!1;}},this);},this);var belowSeriesScenes2;rootScene.children().reverse().each(completeSeriesScenes,this);return rootScene;}});pvc.PlotPanel.registerClass(pvc.PointPanel);def.type("pvc.PointAbstract",pvc.CategoricalAbstract).add({_defaultAxisBandSizeRatio:1,_createPlotsInternal:function(){this._addPlot(this._createPointPlot());this.options.plot2&&this._addPlot(new pvc.visual.PointPlot(this,{name:"plot2",defaults:{DataPart:"1",ColorAxis:2,LinesVisible:!0,DotsVisible:!0}}));},_createPlotTrend:function(){this._addPlot(new pvc.visual.PointPlot(this,{name:"trend",spec:{visualRoles:{color:{from:"series"}}},fixed:{TrendType:"none",NullInterpolatioMode:"none"},defaults:{DataPart:"trend",ColorAxis:2,LinesVisible:!0,DotsVisible:!1}}));},_willBindVisualRoles:function(complexType){this.base(complexType);if(this.plots.trend){var valueDimNames=this._getPreBoundTrendedDimensionNames();this.plots.trend.visualRoles.value.preBind(cdo.GroupingSpec.parse(valueDimNames));}},_initAxesEnd:function(){var typeAxes=this.axesByType.base;typeAxes&&typeAxes.forEach(function(axis){"discrete"!==axis.scaleType&&axis.option.defaults({Offset:.01});});typeAxes=this.axesByType.ortho;typeAxes&&typeAxes.forEach(function(axis){axis.option.defaults({Offset:.04});});this.base();},_getIsNullDatum:function(){var measureDimNames,M,me=this;return function(datum){if(!measureDimNames){measureDimNames=me.visualRoles.value.grouping.dimensionNames().slice();var categRole=me.visualRoles.category;categRole.isDiscrete()||measureDimNames.push(categRole.grouping.singleDimensionName);M=measureDimNames.length;}
for(var atoms=datum.atoms,i=0;i<M;i++)if(null==atoms[measureDimNames[i]].value)return!0;return!1;};},defaults:{tooltipOffset:10}});def.type("pvc.DotChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{DotsVisible:!0}});}});def.type("pvc.LineChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{LinesVisible:!0}});}});def.type("pvc.AreaChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{AreasVisible:!0}});}});pvc.mStackedLineChart=def.type("pvc.StackedLineChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{LinesVisible:!0,Stacked:!0}});}});def.type("pvc.StackedDotChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{DotsVisible:!0,Stacked:!0}});}});pvc.mStackedAreaChart=def.type("pvc.StackedAreaChart",pvc.PointAbstract).add({_createPointPlot:function(){return new pvc.visual.PointPlot(this,{fixed:{AreasVisible:!0,Stacked:!0},defaults:{LinesVisible:!0}});}});def("pvc.visual.MetricPointPlot",pvc.visual.MetricXYPlot.extend({methods:{type:"scatter",_initVisualRoles:function(){this.base();this._addVisualRole("size",{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"size",dimensionDefaults:{valueType:Number}});},_getColorRoleSpec:function(){return{isMeasure:!0,defaultSourceRole:"series",defaultDimension:"color*",dimensionDefaults:{valueType:Number}};},_initDataCells:function(){this.base();this.option("DotsVisible")&&this._addDataCell(new pvc.visual.DataCell(this,"size",this.option("SizeAxis")-1,this.visualRoles.size));}},options:{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},Shape:{resolve:"_resolveFull",cast:pvc.parseShape,value:"circle"},NullShape:{resolve:"_resolveFull",cast:pvc.parseShape,value:"cross"},DotsVisible:{resolve:"_resolveFull",data:pvcMetricPoint_buildVisibleOption("Dots"),cast:Boolean,value:!1},LinesVisible:{resolve:"_resolveFull",data:pvcMetricPoint_buildVisibleOption("Lines"),cast:Boolean,value:!1},ValuesAnchor:{value:"right"},ValuesMask:{value:"{x},{y}"},AutoPaddingByDotSize:{resolve:"_resolveFull",cast:Boolean,value:!0}}}));pvc.visual.Plot.registerClass(pvc.visual.MetricPointPlot);pvc.parseMetricPointSizeAxisRatioTo=pvc.makeEnumParser("ratioTo",["minWidthHeight","height","width"],"minWidthHeight");def("pvc.visual.MetricPointSizeAxis",pvc.visual.SizeAxis.extend({options:{Ratio:{resolve:"_resolveFull",cast:def.number.toNonNegative,value:.2},RatioTo:{resolve:"_resolveFull",cast:pvc.parseMetricPointSizeAxisRatioTo,value:"minwidthheight"}}}));def.type("pvc.MetricPointPanel",pvc.CartesianAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);var sizeAxis=this.axes.size=chart._getAxis("size",(plot.option("SizeAxis")||0)-1);if(sizeAxis){this.sizeAxisRatio=sizeAxis.option("Ratio");this.sizeAxisRatioTo=sizeAxis.option("RatioTo");this.autoPaddingByDotSize=plot.option("AutoPaddingByDotSize");}
this.linesVisible=plot.option("LinesVisible");this.dotsVisible=plot.option("DotsVisible");if(!this.linesVisible&&!this.dotsVisible){this.linesVisible=!0;plot.option.specify({LinesVisible:!0});}
chart.scatterChartPanel||(chart.scatterChartPanel=this);}).add({plotType:"scatter",_v1DimRoleName:{category:"x",value:"y"},_creating:function(){var colorDataCell=this.plot.dataCellsByRole.color[0];if(!colorDataCell.legendSymbolRenderer()&&colorDataCell.legendVisible()){var colorAxis=this.axes.color,drawMarker=def.nullyTo(colorAxis.option("LegendDrawMarker",!0),this.dotsVisible),drawLine=def.nullyTo(colorAxis.option("LegendDrawLine",!0),this.linesVisible);if(drawMarker||drawLine){var extAbsPrefix=pvc.uniqueExtensionAbsPrefix(),keyArgs={drawMarker:drawMarker,drawLine:drawLine,extensionPrefix:{abs:extAbsPrefix}};this.chart._processExtensionPointsIn(colorDataCell.role.legend(),extAbsPrefix);if(drawMarker){keyArgs.markerShape=colorAxis.option("LegendShape",!0)||"circle";keyArgs.markerPvProto=new pv.Dot().lineWidth(1.5,pvc.extensionTag).shapeSize(12,pvc.extensionTag);this.extend(keyArgs.markerPvProto,"dot",{constOnly:!0});}
if(drawLine){keyArgs.rulePvProto=new pv.Rule().lineWidth(1.5,pvc.extensionTag);this.extend(keyArgs.rulePvProto,"line",{constOnly:!0});}
colorDataCell.legendSymbolRenderer(keyArgs);}}},_getRootScene:function(){return def.lazy(this,"_rootScene",this._buildScene,this);},_calcLayout:function(layoutInfo){var result=this.base(layoutInfo),rootScene=this._getRootScene();rootScene.isSizeBound&&this.axes.size.setScaleRange(this._calcDotAreaRange(layoutInfo));this._calcAxesPadding(layoutInfo,rootScene);return result;},_getDotDiameterRefLength:function(layoutInfo){var size=layoutInfo.size;switch(this.sizeAxisRatioTo){case"minwidthheight":return Math.min(size.width,size.height);case"width":return size.width;case"height":return size.height;}
def.debug>=2&&this.log(def.format("Invalid option 'sizeAxisRatioTo' value. Assuming 'minWidthHeight'.",[this.sizeAxisRatioTo]));this.sizeRatioTo="minwidthheight";return this._getDotDiameterRefLength(layoutInfo);},_calcDotRadiusRange:function(layoutInfo){return{min:Math.sqrt(12),max:this.sizeAxisRatio/2*this._getDotDiameterRefLength(layoutInfo)};},_calcDotAreaRange:function(layoutInfo){var radiusRange=this._calcDotRadiusRange(layoutInfo);if("diamond"===this.shape){radiusRange.max/=Math.SQRT2;radiusRange.min/=Math.SQRT2;}
var maxArea=def.sqr(radiusRange.max),minArea=def.sqr(radiusRange.min),areaSpan=maxArea-minArea;if(areaSpan<=1){maxArea=Math.max(maxArea,2);minArea=1;areaSpan=maxArea-minArea;def.debug>=3&&this.log("Using rescue mode dot area calculation due to insufficient space.");}
return{min:minArea,max:maxArea,span:areaSpan};},_calcAxesPadding:function(layoutInfo,rootScene){var contentOverflow;if(this.autoPaddingByDotSize){var axes=this.axes,clientSize=layoutInfo.clientSize,paddings=layoutInfo.paddings;contentOverflow={};axes.x.setScaleRange(clientSize.width);axes.y.setScaleRange(clientSize.height);var isV=this.isOrientationVertical(),sceneXScale=axes.x.sceneScale({sceneVarName:isV?"x":"y"}),sceneYScale=axes.y.sceneScale({sceneVarName:isV?"y":"x"}),xMax=axes.x.scale.max,yMax=axes.y.scale.max,hasSizeRole=rootScene.isSizeBound,sizeScale=hasSizeRole?axes.size.scale:null;if(!sizeScale){var defaultSize=def.number.to(this._getExtension("dot","shapeRadius"),0);if(defaultSize<=0){defaultSize=def.number.to(this._getExtension("dot","shapeSize"),0);defaultSize<=0&&(defaultSize=12);}else defaultSize=def.sqr(defaultSize);sizeScale=def.fun.constant(defaultSize);}
contentOverflow={};var op,axisOffsetPaddings=this.chart._axisOffsetPaddings;if(axisOffsetPaddings){op={};pvc_Sides.names.forEach(function(side){var len_a=pvc.BasePanel.orthogonalLength[side];op[side]=(axisOffsetPaddings[side]||0)*(clientSize[len_a]+paddings[len_a]);});}
var setSide=function(side,padding){op&&(padding+=op[side]||0);padding<0&&(padding=0);var value=contentOverflow[side];(null==value||padding>value)&&(contentOverflow[side]=padding);},processScene=function(scene){var x=sceneXScale(scene),y=sceneYScale(scene),r=Math.sqrt(sizeScale(hasSizeRole?scene.vars.size.value:0));setSide("left",r-x);setSide("bottom",r-y);setSide("right",x+r-xMax);setSide("top",y+r-yMax);};rootScene.children().selectMany(function(seriesScene){return seriesScene.childNodes;}).each(processScene);}else contentOverflow=this._calcContentOverflow(layoutInfo);layoutInfo.contentOverflow=contentOverflow;},_createCore:function(){var me=this;me.base();var chart=me.chart,rootScene=me._getRootScene(),wrapper=me._buildSignsWrapper(),isV1Compat=me.compatVersion()<=1;this._finalizeScene(rootScene);me.pvPanel.zOrder(1);this.pvScatterPanel=new pvc.visual.Panel(me,me.pvPanel,{extensionId:"panel"}).lock("data",rootScene.childNodes).pvMark;var isLineNoSelect=chart.selectableByFocusWindow(),isColorDiscrete=rootScene.isColorBound&&this.visualRoles.color.isDiscrete(),line=new pvc.visual.Line(me,me.pvScatterPanel,{extensionId:"line",wrapper:wrapper,noTooltip:!1,noSelect:isLineNoSelect,showsSelection:!isLineNoSelect}).lockMark("data",function(seriesScene){return seriesScene.childNodes;}).intercept("visible",function(scene){if(!me.linesVisible)return!1;var visible=this.delegateExtension();null==visible&&(visible=!scene.isNull&&(!rootScene.isSizeBound&&!rootScene.isColorBound||rootScene.isSizeBound&&null!=scene.vars.size.value||rootScene.isColorBound&&(isColorDiscrete||null!=scene.vars.color.value)));return visible;}).override("x",function(scene){return scene.basePosition;}).override("y",function(scene){return scene.orthoPosition;});me.pvLine=line.pvMark;var dot=new pvc.visual.DotSizeColor(me,me.pvLine,{extensionId:"dot",wrapper:wrapper,activeSeriesAware:me.linesVisible,tooltipArgs:{options:{ignoreRadius:!rootScene.isSizeBound&&me.linesVisible}}}).override("x",function(scene){return scene.basePosition;}).override("y",function(scene){return scene.orthoPosition;}).override("color",function(scene,type){return me.dotsVisible||scene.isActive||scene.isSingle?this.base(scene,type):pvc.invisibleFill;});rootScene.isSizeBound?me.autoPaddingByDotSize&&"minwidthheight"===me.sizeAxisRatioTo||me.pvPanel.borderPanel.overflow("hidden"):dot.override("size",function(scene){if(!me.dotsVisible&&scene.isSingle&&!(scene.isActive&&this.showsActivity())){var lineWidth=Math.max(me.pvLine.visible()?me.pvLine.lineWidth():0,1),radius=lineWidth/2+1;return def.sqr(radius);}
return this.base(scene);});me.pvDot=dot.pvMark;me.pvDot.rubberBandSelectionMode="center";if(pvc.visual.ValueLabel.isNeeded(me)){var extensionIds=["label"];isV1Compat&&extensionIds.push("lineLabel");var label=pvc.visual.ValueLabel.maybeCreate(me,me.pvDot,{extensionId:extensionIds,wrapper:wrapper});label&&(me.pvHeatGridLabel=label.pvMark);}},_buildSignsWrapper:function(){return this.compatVersion()>1?null:function(v1f){return function(scene){var d={category:scene.vars.x.rawValue,value:scene.vars.y.rawValue},pseudo=Object.create(this);pseudo.index=scene.dataIndex;return v1f.call(pseudo,d);};};},renderInteractive:function(){this.pvScatterPanel.render();},_buildScene:function(){function createSeriesScene(seriesGroup){var seriesScene=new pvc.visual.Scene(rootScene,{source:seriesGroup});seriesScene.vars.series=pvc_ValueLabelVar.fromComplex(seriesGroup);colorVarHelper.onNewScene(seriesScene,!1);seriesGroup.datums().each(function(datum,dataIndex){var xAtom=datum.atoms[xDim.name];if(null!=xAtom.value){var yAtom=datum.atoms[yDim.name];if(null!=yAtom.value){var scene=new pvc.visual.Scene(seriesScene,{source:datum});scene.dataIndex=dataIndex;scene.vars.x=pvc_ValueLabelVar.fromAtom(xAtom);scene.vars.y=pvc_ValueLabelVar.fromAtom(yAtom);sizeVarHelper.onNewScene(scene,!0);colorVarHelper.onNewScene(scene,!0);scene.isIntermediate=!1;}}});}
function completeSeriesScenes(seriesScene){for(var fromScene,seriesScenes=seriesScene.childNodes,c=0,toChildIndex=0,pointCount=seriesScenes.length;c<pointCount;c++,toChildIndex++){var toScene=seriesScenes[toChildIndex];toScene.isSingle=!fromScene&&!toScene.nextSibling;if(fromScene){createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex)&&toChildIndex++;}
fromScene=toScene;}}
function createIntermediateScene(seriesScene,fromScene,toScene,toChildIndex){var yToSceneAux=+toScene.vars.y.value,yFromSceneAux=+fromScene.vars.y.value,xToSceneAux=+toScene.vars.x.value,xFromSceneAux=+fromScene.vars.x.value,interYValue=yDim.type.cast.call(null,(yToSceneAux+yFromSceneAux)/2),interXValue=xDim.type.cast.call(null,(xToSceneAux+xFromSceneAux)/2),interScene=new pvc.visual.Scene(seriesScene,{index:toChildIndex,source:toScene.datum});interScene.dataIndex=toScene.dataIndex;interScene.vars.x=new pvc_ValueLabelVar(interXValue,xDim.format(interXValue),interXValue);interScene.vars.y=new pvc_ValueLabelVar(interYValue,yDim.format(interYValue),interYValue);sizeVarHelper.onNewScene(interScene,!0);colorVarHelper.onNewScene(interScene,!0);interScene.ownerScene=toScene;interScene.isIntermediate=!0;interScene.isSingle=!1;return interScene;}
var data=this.visibleData({ignoreNulls:!1}),rootScene=new pvc.visual.Scene(null,{panel:this,source:data}),roles=this.visualRoles,colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,"color",roles.color),sizeVarHelper=new pvc.visual.RoleVarHelper(rootScene,"size",roles.size),xDim=data.owner.dimensions(roles.x.grouping.singleDimensionName),yDim=data.owner.dimensions(roles.y.grouping.singleDimensionName);data.children().each(createSeriesScene,this);rootScene.children().each(completeSeriesScenes,this);return rootScene;},_finalizeScene:function(rootScene){var axes=this.axes,sceneBaseScale=axes.base.sceneScale({sceneVarName:"x"}),sceneOrthoScale=axes.ortho.sceneScale({sceneVarName:"y"});rootScene.children().selectMany(function(seriesScene){return seriesScene.childNodes;}).each(function(leafScene){leafScene.basePosition=sceneBaseScale(leafScene);leafScene.orthoPosition=sceneOrthoScale(leafScene);});return rootScene;}});pvc.PlotPanel.registerClass(pvc.MetricPointPanel);def.type("pvc.MetricPointAbstract",pvc.MetricXYAbstract).add({_axisClassByType:{size:pvc.visual.MetricPointSizeAxis},_createPlotsInternal:function(){this._addPlot(this._createPointPlot());},_createPointPlot:function(){},_createPlotTrend:function(){this._addPlot(new pvc.visual.MetricPointPlot(this,{name:"trend",spec:{visualRoles:{color:{from:"series"},size:null}},fixed:{TrendType:"none",NullInterpolatioMode:"none",SizeRole:null,SizeAxis:null,OrthoAxis:1},defaults:{DataPart:"trend",ColorAxis:2,LinesVisible:!0,DotsVisible:!1}}));},_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).methods({_configureTypeCore:function(){this._configureTypeByOrgLevel(["series"],["x","y","color","size"]);}});},_calcAxesOffsetPaddings:function(){return this.base()||new pvc_Sides(.01);},defaults:{axisOriginIsZero:!1,tooltipOffset:10}});def.type("pvc.MetricDotChart",pvc.MetricPointAbstract).add({_createPointPlot:function(){return new pvc.visual.MetricPointPlot(this,{fixed:{DotsVisible:!0}});}});def.type("pvc.MetricLineChart",pvc.MetricPointAbstract).add({_createPointPlot:function(){return new pvc.visual.MetricPointPlot(this,{fixed:{LinesVisible:!0}});}});def("pvc.visual.HeatGridPlot",pvc.visual.CategoricalPlot.extend({methods:{type:"heatGrid",interpolatable:function(){return!1;},_initVisualRoles:function(){this.base();var chart=this.chart,sizeDimName=chart.compatVersion()>1||1===chart.options.sizeValIdx?"value2":"value";this._addVisualRole("size",{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:sizeDimName});},_getColorRoleSpec:function(){var chart=this.chart,colorDimName=chart.compatVersion()<=1&&1===chart.options.colorValIdx?"value2":"value";return{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:colorDimName};},_getCategoryRoleSpec:function(){var catRoleSpec=this.base();catRoleSpec.requireIsDiscrete=!0;return catRoleSpec;},_initDataCells:function(){this.base();this.option("UseShapes")&&this._addDataCell(new pvc.visual.DataCell(this,"size",this.option("SizeAxis")-1,this.visualRoles.size));},_getOrthoRoles:function(){return[this.visualRole("series")];}},options:{SizeRole:{value:"size"},SizeAxis:{value:1},UseShapes:{resolve:"_resolveFull",cast:Boolean,value:!1},Shape:{resolve:"_resolveFull",cast:pvc.parseShape,value:"square"},NullShape:{resolve:"_resolveFull",cast:pvc.parseShape,value:"cross"},ValuesVisible:{getDefault:function(){return!this.option("UseShapes");},value:null},ValuesMask:{value:null},ValuesAnchor:{value:"center"},OrthoAxis:{resolve:null},NullInterpolationMode:{resolve:null,value:"none"},Stacked:{resolve:null,value:!1}}}));pvc.visual.Plot.registerClass(pvc.visual.HeatGridPlot);def.type("pvc.HeatGridPanel",pvc.CategoricalAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.axes.size=chart._getAxis("size",plot.option("SizeAxis")-1);this.visualRoles.size=chart.visualRole(plot.option("SizeRole"));this.useShapes=plot.option("UseShapes");this.shape=plot.option("Shape");this.nullShape=plot.option("NullShape");chart.heatGridChartPanel||(chart.heatGridChartPanel=this);}).add({plotType:"heatGrid",defaultBorder:1,nullBorder:2,selectedBorder:2,_createCore:function(){var me=this;me.base();var cellSize=me._calcCellSize(),a_bottom=me.isOrientationVertical()?"bottom":"left",a_left=pvc.BasePanel.relativeAnchor[a_bottom],a_width=pvc.BasePanel.parallelLength[a_bottom],a_height=pvc.BasePanel.orthogonalLength[a_bottom],axisSeriesDatas=me.visualRoles.series.flatten(me.partData(),{visible:!0,isNull:!me.chart.options.ignoreNulls&&null,extensionDataSetsMap:this.plot.boundDimensionsDataSetsMap}).childNodes,data=me.visibleData({ignoreNulls:!1}),rootScene=me._buildScene(data,axisSeriesDatas,data.childNodes);rootScene.cellSize=cellSize;var hasColor=rootScene.isColorBound,hasSize=rootScene.isSizeBound,wrapper=me._buildSignsWrapper(rootScene),isV1Compat=me.compatVersion()<=1,rowScale=this.axes.base.scale,colScale=this.axes.ortho.scale,rowBand=rowScale.range().band,colBand=colScale.range().band,rowBand2=rowBand/2,colBand2=colBand/2,pvRowPanel=new pvc.visual.Panel(me,me.pvPanel).pvMark.data(rootScene.childNodes)[a_bottom](function(scene){return colScale(scene.vars.series.value)-colBand2;})[a_height](colBand),extensionIds=["panel"];isV1Compat&&extensionIds.push("");var keyArgs={extensionId:extensionIds,wrapper:wrapper};if(!me.useShapes){def.copy(keyArgs,{noSelect:!1,noHover:!1,noClick:!1,noDoubleClick:!1,freeColor:!1,noTooltip:isV1Compat});}
me.pvHeatGrid=new pvc.visual.Panel(me,pvRowPanel,keyArgs).pvMark.lock("data",function(serScene){return serScene.childNodes;}).lock(a_left,function(scene){return rowScale(scene.vars.category.value)-rowBand2;}).lock(a_width,rowBand).antialias(!1);me.shapes=me.useShapes?me._createShapesHeatMap(cellSize,wrapper,hasColor,hasSize):me._createNoShapesHeatMap(hasColor);me.valuesVisible&&!me.valuesMask&&(me.valuesMask=me._getDefaultValuesMask(hasColor,hasSize));var label=pvc.visual.ValueLabel.maybeCreate(me,me.pvHeatGrid,{wrapper:wrapper});if(label){me.pvHeatGridLabel=label.pvMark;me.useShapes&&label.override("getAnchoredToMark",def.fun.constant(me.shapes));}},_calcCellSize:function(){var xScale=this.axes.x.scale,yScale=this.axes.y.scale,w=(xScale.max-xScale.min)/xScale.domain().length,h=(yScale.max-yScale.min)/yScale.domain().length;if(!this.isOrientationVertical()){var tmp=w;w=h;h=tmp;}
return{width:w,height:h};},_buildSignsWrapper:function(rootScene){if(this.compatVersion()>1)return null;var colorValuesBySerAndCat=def.query(rootScene.childNodes).object({name:function(serScene){return""+serScene.vars.series.value;},value:function(serScene){return def.query(serScene.childNodes).object({name:function(leafScene){return""+leafScene.vars.category.value;},value:function(leafScene){var colorVar=leafScene.vars.color;return colorVar?""+colorVar.value:null;}});}});return function(v1f){return function(leafScene){var colorValuesByCat=colorValuesBySerAndCat[leafScene.vars.series.value],cat=leafScene.vars.category.rawValue,wrapperParent=Object.create(this.parent),wrapper=Object.create(this),catIndex=leafScene.childIndex(),serIndex=leafScene.parent.childIndex();wrapper.parent=wrapperParent;wrapperParent.index=catIndex;wrapper.index=serIndex;return v1f.call(wrapper,colorValuesByCat,cat);};};},_getDefaultValuesMask:function(hasColor,hasSize){var roleName=hasColor?"color":hasSize?"size":null;if(roleName)return"{"+roleName+"}";},_createNoShapesHeatMap:function(hasColor){var getBaseColor=this._buildGetBaseFillColor(hasColor);return this.pvHeatGrid.sign.override("defaultColor",function(scene,type){return"stroke"===type?null:getBaseColor.call(this.pvMark,scene);}).override("interactiveColor",function(scene,color,type){return scene.isActive?color.alpha(.6):scene.anySelected()&&!scene.isSelected()?this.dimColor(color,type):this.base(scene,color,type);}).override("dimColor",function(color){return pvc.toGrayScale(color,.6);}).pvMark.lineWidth(1.5);},_buildGetBaseFillColor:function(hasColor){var colorAxis=this.axes.color;return hasColor?colorAxis.sceneScale({sceneVarName:"color"}):def.fun.constant(colorAxis.option("Unbound"));},_createShapesHeatMap:function(cellSize,wrapper,hasColor,hasSize){var me=this,areaRange=me._calcDotAreaRange(cellSize);hasSize&&me.axes.size.setScaleRange(areaRange);var keyArgs={extensionId:"dot",freePosition:!0,activeSeriesAware:!1,wrapper:wrapper,tooltipArgs:me._buildShapesTooltipArgs(hasColor,hasSize)},pvDot=new pvc.visual.DotSizeColor(me,me.pvHeatGrid,keyArgs).override("dimColor",function(color){return pvc.toGrayScale(color,.6);}).pvMark;hasSize||pvDot.sign.override("defaultSize",def.fun.constant(areaRange.max));return pvDot;},_calcDotAreaRange:function(cellSize){var w=cellSize.width,h=cellSize.height,maxRadius=Math.min(w,h)/2;"diamond"===this.shape&&(maxRadius/=Math.SQRT2);maxRadius-=2;var maxArea=def.sqr(maxRadius),minArea=12,areaSpan=maxArea-minArea;if(areaSpan<=1){maxArea=Math.max(maxArea,2);minArea=1;areaSpan=maxArea-minArea;def.debug>=2&&this.log.warn("Using rescue mode dot area calculation due to insufficient space.");}
return{min:minArea,max:maxArea,span:areaSpan};},_buildShapesTooltipArgs:function(hasColor,hasSize){var chart=this.chart;if(this.compatVersion()<=1&&this.showsTooltip()){var options=chart.options,customTooltip=options.customTooltip;customTooltip||(customTooltip=function(s,c,d){return null!=d&&void 0!==d[0]?d.join(", "):d;});var roles=this.visualRoles,seriesMainDimsNames=roles.series.grouping.dimensionNames(),categMainDimsNames=roles.category.grouping.dimensionNames();return{buildTooltip:options.isMultiValued?function(context){var group=context.scene.group;if(!group)return"";var s=cdo.Complex.values(group,seriesMainDimsNames),c=cdo.Complex.values(group,categMainDimsNames),d=[],vars=context.scene.vars;hasSize&&(d[options.sizeValIdx||0]=vars.size.value);hasColor&&(d[options.colorValIdx||0]=vars.color.value);return customTooltip.call(options,s,c,d);}:function(context){var vars=context.scene.vars,s=vars.series.rawValue,c=vars.category.rawValue,valueVar=vars[hasColor?"color":"size"],d=valueVar?valueVar.value:null;return customTooltip.call(options,s,c,d);}};}},renderInteractive:function(){this.pvPanel.render();},_buildSceneCore:function(data,axisSeriesDatas,axisCategDatas){function createSeriesScene(serData1){var serScene=new pvc.visual.Scene(rootScene,{source:serData1});serScene.vars.series=pvc_ValueLabelVar.fromComplex(serData1);axisCategDatas.forEach(function(catData1){createSeriesCategoryScene.call(me,serScene,catData1,serData1);});}
function createSeriesCategoryScene(serScene,catData1,serData1){var group=data.child(catData1.key).child(serData1.key),serCatScene=new pvc.visual.Scene(serScene,{source:group});serCatScene.vars.category=pvc_ValueLabelVar.fromComplex(catData1);colorVarHelper.onNewScene(serCatScene,!0);sizeVarHelper.onNewScene(serCatScene,!0);}
var me=this,rootScene=new pvc.visual.Scene(null,{panel:me,source:data}),roles=me.visualRoles,colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,"color",roles.color),sizeVarHelper=new pvc.visual.RoleVarHelper(rootScene,"size",roles.size);axisSeriesDatas.forEach(createSeriesScene);return rootScene;}});pvc.PlotPanel.registerClass(pvc.HeatGridPanel);def.type("pvc.HeatGridChart",pvc.CategoricalAbstract).add({_allowColorPerCategory:!0,_defaultAxisBandSizeRatio:1,_axisCreateIfUnbound:{color:!0},_processOptionsCore:function(options){this.base(options);options.legend=!1;},_createPlotsInternal:function(){this._addPlot(new pvc.visual.HeatGridPlot(this));},defaults:{colorValIdx:0,sizeValIdx:1,measuresIndexes:[2],axisOffset:0,plotFrameVisible:!1,colorNormByCategory:!0,numSD:2}});pvc.parseBoxLayoutMode=pvc.makeEnumParser("layoutMode",["overlapped","grouped"],"grouped");def("pvc.visual.BoxPlot",pvc.visual.CategoricalPlot.extend({methods:{type:"box",_initVisualRoles:function(){this.base();var roleSpecBase={isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number};[{name:"median",label:"Median",defaultDimension:"median"},{name:"lowerQuartil",label:"Lower Quartil",defaultDimension:"lowerQuartil"},{name:"upperQuartil",label:"Upper Quartil",defaultDimension:"upperQuartil"},{name:"minimum",label:"Minimum",defaultDimension:"minimum"},{name:"maximum",label:"Maximum",defaultDimension:"maximum"}].forEach(function(info){this._addVisualRole(info.name,def.create(roleSpecBase,info));},this);},_getOrthoRoles:function(){return pvc.visual.BoxPlot.measureRolesNames.map(this.visualRole,this);},_getCategoryRoleSpec:function(){return def.set(this.base(),"requireIsDiscrete",!0);}},type:{methods:{measureRolesNames:["median","lowerQuartil","upperQuartil","minimum","maximum"]}},options:{Stacked:{resolve:null,value:!1},LayoutMode:{resolve:"_resolveFull",cast:pvc.parseBoxLayoutMode,value:"grouped"},BoxSizeRatio:{resolve:"_resolveFull",cast:function(value){value=def.number.to(value);return null==value?1:value<.05?.05:value>1?1:value;},value:.9},BoxSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(optionInfo){return this._specifyChartOption(optionInfo,"maxBoxSize"),!0;}},cast:function(value){value=def.number.to(value);return null==value?1/0:value<1?1:value;},value:1/0}}}));pvc.visual.Plot.registerClass(pvc.visual.BoxPlot);def.type("pvc.BoxplotPanel",pvc.CategoricalAbstractPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.boxSizeRatio=plot.option("BoxSizeRatio");this.boxSizeMax=plot.option("BoxSizeMax");chart.bpChartPanel||(chart.bpChartPanel=this);}).add({plotType:"box",_v1DimRoleName:{value:"median"},_createCore:function(){function defaultColor(scene,type){var color=this.base(scene,type);return"stroke"===type?color.darker(1):color;}
function setupHCateg(sign){sign.optionalMark(a_width,function(){return this.parent[a_width]();}).optionalMark(a_left,function(){return this.parent[a_width]()/2-this[a_width]()/2;});return sign;}
function setupRule(rule){return rule.override("defaultColor",defaultColor).override("interactiveStrokeWidth",function(scene,strokeWidth){return strokeWidth;}).override("interactiveColor",function(scene,color,type){return"stroke"===type?color:this.base(scene,color,type);});}
function setupRuleWhisker(rule){return setupRule(rule).optionalMark(a_left,function(){return this.parent[a_width]()/2-this[a_width]()/2;});}
function setupHRule(rule){return setupRule(setupHCateg(rule));}
this.base();var data=this.visibleData({ignoreNulls:!1}),baseAxis=this.axes.base,axisCategDatas=baseAxis.domainItems(),axisSeriesDatas=this.visualRoles.series.flatten(this.partData(),{visible:!0,isNull:!this.chart.options.ignoreNulls&&null,extensionDataSetsMap:this.plot.boundDimensionsDataSetsMap}).childNodes,rootScene=this._buildScene(data,axisSeriesDatas,axisCategDatas),a_bottom=this.isOrientationVertical()?"bottom":"left",a_left=this.anchorOrtho(a_bottom),a_width=this.anchorLength(a_bottom),a_height=this.anchorOrthoLength(a_bottom),pvSeriesPanel=new pvc.visual.Panel(this,this.pvPanel).lock("data",rootScene.childNodes).pvMark,extensionIds=["panel"];this.compatVersion()<=1&&extensionIds.push("");this.pvBoxPanel=new pvc.visual.Panel(this,pvSeriesPanel,{extensionId:extensionIds}).lock("data",function(seriesScene){return seriesScene.childNodes;}).pvMark[a_width](function(scene){return scene.vars.category.boxWidth;})[a_left](function(scene){var catVar=scene.vars.category;return catVar.boxLeft+catVar.boxWidth/2-this[a_width]()/2;});this.pvBar=setupHCateg(new pvc.visual.Bar(this,this.pvBoxPanel,{extensionId:"boxBar",freePosition:!0,normalStroke:!0})).intercept("visible",function(scene){return scene.vars.category.showBox&&this.delegateExtension(!0);}).lockMark(a_bottom,function(scene){return scene.vars.category.boxBottom;}).lockMark(a_height,function(scene){return scene.vars.category.boxHeight;}).override("defaultColor",defaultColor).override("interactiveColor",function(scene,color,type){return"stroke"===type?color:this.base(scene,color,type);}).override("defaultStrokeWidth",def.fun.constant(1)).override("interactiveStrokeWidth",function(scene,strokeWidth){return strokeWidth;}).pvMark;this.pvRuleWhiskerUpper=setupRuleWhisker(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,noTooltip:!1,showsInteraction:!0})).intercept("visible",function(scene){return scene.vars.category.showRuleWhiskerUpper&&this.delegateExtension(!0);}).pvMark.lock(a_bottom,function(scene){return scene.vars.category.ruleWhiskerUpperBottom;}).lock(a_height,function(scene){return scene.vars.category.ruleWhiskerUpperHeight;});this.pvRuleWhiskerLower=setupRuleWhisker(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,noTooltip:!1,showsInteraction:!0})).intercept("visible",function(scene){return scene.vars.category.showRuleWhiskerBelow&&this.delegateExtension(!0);}).pvMark.lock(a_bottom,function(scene){return scene.vars.category.ruleWhiskerLowerBottom;}).lock(a_height,function(scene){return scene.vars.category.ruleWhiskerLowerHeight;});this.pvRuleMin=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMin",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,noTooltip:!1,showsInteraction:!0})).intercept("visible",function(scene){return null!=scene.vars.minimum.value&&this.delegateExtension(!0);}).pvMark.lock(a_bottom,function(scene){return scene.vars.minimum.position;});this.pvRuleMax=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMax",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,noTooltip:!1,showsInteraction:!0})).intercept("visible",function(scene){return null!=scene.vars.maximum.value&&this.delegateExtension(!0);}).pvMark.lock(a_bottom,function(scene){return scene.vars.maximum.position;});this.pvRuleMedian=setupHRule(new pvc.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMedian",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,noTooltip:!1,showsInteraction:!0})).intercept("visible",function(scene){return null!=scene.vars.median.value&&this.delegateExtension(!0);}).lockMark(a_bottom,function(scene){return scene.vars.median.position;}).override("defaultStrokeWidth",def.fun.constant(2)).pvMark;},renderInteractive:function(){this.pvBoxPanel.render();},_buildSceneCore:function(data,axisSeriesDatas,axisCategDatas){function createSeriesScene(axisSeriesData,seriesIndex){var seriesScene=new pvc.visual.Scene(rootScene,{source:axisSeriesData}),seriesKey=axisSeriesData.key;seriesScene.vars.series=pvc_ValueLabelVar.fromComplex(axisSeriesData);colorVarHelper.onNewScene(seriesScene,!1);axisCategDatas.forEach(function(axisCategData){createCategScene(seriesScene,seriesKey,axisCategData,seriesIndex);});}
function createCategScene(seriesScene,seriesKey,axisCategData,seriesIndex){var categData=data.child(axisCategData.key),group=categData&&categData.child(seriesKey),categScene=new pvc.visual.Scene(seriesScene,{source:group}),vars=categScene.vars,catVar=vars.category=pvc_ValueLabelVar.fromComplex(categData),x=baseScale(categData.value),boxLeft=x+(isGrouped?boxesOffsetLeft+seriesIndex*boxStep:-boxWidth/2);def.set(catVar,"group",categData,"x",x,"width",bandWidth,"boxWidth",boxWidth,"boxLeft",boxLeft);measureVisualRoleInfos.forEach(function(roleInfo){var dimName,svar;if(group&&(dimName=roleInfo.dimName)){var dim=group.dimensions(dimName),value=dim.value(visibleKeyArgs);svar=new pvc_ValueLabelVar(value,dim.format(value));svar.position=orthoScale(value);}else{svar=new pvc_ValueLabelVar(null,"");svar.position=null;}
vars[roleInfo.roleName]=svar;});colorVarHelper.onNewScene(categScene,!0);var bottom,top,hasMin=null!=vars.minimum.value,hasLower=null!=vars.lowerQuartil.value,hasMedian=null!=vars.median.value,hasUpper=null!=vars.upperQuartil.value,show=hasLower||hasUpper;if(show){bottom=hasLower?vars.lowerQuartil.position:hasMedian?vars.median.position:vars.upperQuartil.position;top=hasUpper?vars.upperQuartil.position:hasMedian?vars.median.position:vars.lowerQuartil.position;show=top!==bottom;if(show){catVar.boxBottom=bottom;catVar.boxHeight=top-bottom;}}
catVar.showBox=show;show=null!=vars.maximum.value;if(show){bottom=hasUpper?vars.upperQuartil.position:hasMedian?vars.median.position:hasLower?vars.lowerQuartil.position:hasMin?vars.minimum.position:null;show=null!=bottom;if(show){catVar.ruleWhiskerUpperBottom=bottom;catVar.ruleWhiskerUpperHeight=vars.maximum.position-bottom;}}
catVar.showRuleWhiskerUpper=show;show=hasMin;if(show){top=hasLower?vars.lowerQuartil.position:hasMedian?vars.median.position:hasUpper?vars.upperQuartil.position:null;show=null!=top;if(show){bottom=vars.minimum.position;catVar.ruleWhiskerLowerHeight=top-bottom;catVar.ruleWhiskerLowerBottom=bottom;}}
catVar.showRuleWhiskerBelow=show;}
var boxWidth,boxStep,boxesOffsetLeft,measureVisualRoleInfos=def.query(this.visualRoleList).where(function(r){return!r.isDiscrete()&&r.isMeasure;}).select(function(r){return{roleName:r.name,dimName:r.grouping&&r.grouping.singleDimensionName};}).array(),visibleKeyArgs={visible:!0,zeroIfNone:!1},rootScene=new pvc.visual.Scene(null,{panel:this,source:data}),baseScale=this.axes.base.scale,bandWidth=baseScale.range().band,boxSizeMax=this.boxSizeMax,orthoScale=this.axes.ortho.scale,colorVarHelper=new pvc.visual.RoleVarHelper(rootScene,"color",this.visualRoles.color),isGrouped="overlapped"!==this.plot.option("LayoutMode");if(isGrouped){var clip,boxesWidth,boxesWidthWithMargin,seriesCount=axisSeriesDatas.length,boxSizeRatio=this.boxSizeRatio;boxWidth=seriesCount?1===seriesCount?bandWidth:boxSizeRatio*bandWidth/seriesCount:0;clip=boxWidth>boxSizeMax;clip&&(boxWidth=boxSizeMax);boxesWidth=seriesCount*boxWidth;if(clip){boxesWidthWithMargin=boxesWidth/boxSizeRatio;boxesOffsetLeft=-boxesWidthWithMargin/2;}else{boxesWidthWithMargin=bandWidth;boxesOffsetLeft=-bandWidth/2;}
if(seriesCount>1){boxStep=boxWidth+(boxesWidthWithMargin-boxesWidth)/(seriesCount-1);}else boxStep=0;}else boxWidth=Math.min(bandWidth,boxSizeMax);axisSeriesDatas.forEach(createSeriesScene);return rootScene;}});pvc.PlotPanel.registerClass(pvc.BoxplotPanel);def.type("pvc.BoxplotChart",pvc.CategoricalAbstract).add({_defaultAxisBandSizeRatio:1/3,_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).methods({_configureTypeCore:function(){this._configureTypeByPhysicalGroup("series");this._configureTypeByPhysicalGroup("category");pvc.visual.BoxPlot.measureRolesNames.forEach(function(roleName){this._configureTypeByPhysicalGroup("value",roleName,1,1);},this);}});},_createPlotsInternal:function(){this._addPlot(new pvc.visual.BoxPlot(this));this.options.plot2&&this._addPlot(new pvc.visual.PointPlot(this,{name:"plot2",spec:{visualRoles:{value:{from:"main.median"}}},defaults:{LinesVisible:!0,DotsVisible:!0,ColorAxis:2,OrthoAxis:1}}));},_initAxesEnd:function(){var typeAxes=this.axesByType.ortho;typeAxes&&typeAxes.forEach(function(axis){axis.option.defaults({Offset:.02});});this.base();},defaults:{crosstabMode:!1}});pvc.parseTreemapLayoutMode=pvc.makeEnumParser("layoutMode",["squarify","slice-and-dice","slice","dice"],"squarify");pvc.parseTreemapColorMode=pvc.makeEnumParser("colorMode",["byParent","bySelf"],"byParent");def("pvc.visual.TreemapPlot",pvc.visual.Plot.extend({init:function(chart,keyArgs){this.base(chart,keyArgs);if(!(chart instanceof pvc.TreemapChart))throw def.error(def.format("Plot type '{0}' can only be used from within a treemap chart.",[this.type]));},methods:{type:"treemap",_initVisualRoles:function(){this.base();this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0,rootLabel:this.option("RootCategoryLabel")});this._addVisualRole("size",{isMeasure:!0,isRequired:!1,isPercent:!0,requireSingleDimension:!1,requireIsDiscrete:!1,valueType:Number,defaultDimension:"size"});},_getColorRoleSpec:function(){return{defaultSourceRole:"category",defaultDimension:"color*",rootLabel:this.option("RootCategoryLabel"),requireIsDiscrete:!0};},createData:function(baseData,ka){return this.visualRoles.category.select(baseData,ka);},_initDataCells:function(){this.base();this._addDataCell(new pvc.visual.DataCell(this,"size",this.option("SizeAxis")-1,this.visualRole("size")));}},options:{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},ValuesAnchor:{cast:pvc.parseAnchor,value:"center"},ValuesVisible:{value:!0},ValuesMask:{resolve:"_resolveFull",value:"{category}"},ValuesOptimizeLegibility:{value:!0},LayoutMode:{resolve:"_resolveFull",cast:pvc.parseTreemapLayoutMode,value:"squarify"},ColorMode:{resolve:"_resolveFull",cast:pvc.parseTreemapColorMode,value:"byparent"},RootCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"}}}));pvc.visual.Plot.registerClass(pvc.visual.TreemapPlot);def.type("pvc.visual.TreemapDiscreteColorAxis",pvc.visual.ColorAxis).init(function(chart,type,index,keyArgs){this.base(chart,type,index,keyArgs);this.isByParent="byparent"===chart.plots.treemap.option("ColorMode");}).add({domainItemValueProp:function(){return this.role&&this.role.grouping.isSingleDimension?"value":"absKey";},domainItemKeyProp:function(){return this.role&&this.role.grouping.isSingleDimension?"key":"absKey";},domainGroupOperator:function(){return"select";},_calcAvgColor:function(colors){var L=colors.length;if(L>1){var r=0,g=0,b=0,a=0;colors.forEach(function(c){var rgb=c.rgb();r+=rgb.r;g+=rgb.g;b+=rgb.b;a+=rgb.a;});var f=Math.floor;return pv.rgb(f(r/L),f(g/L),f(b/L),f(a/L));}
var color=colors[0];return L?color.darker(.7):color;},_getBaseScheme:function(){var me=this,isNotDegenerate=function(data){return null!=data.value;},children=function(data){return data.children().where(isNotDegenerate);},hasChildren=function(data){return children(data).any();},hasDerivedColor=function(data){return children(data).any(hasChildren);},derivedColorDatas=def.query(this.domainData().nodes()).where(hasDerivedColor).array(),baseScheme=me.option("Colors");return function(d){var domainKeys=d instanceof Array?d:def.array.copy(arguments),derivedDatasByKey=def.query(derivedColorDatas).object({name:function(itemData){return me.domainItemValue(itemData);}});def.array.removeIf(domainKeys,function(k){return def.hasOwnProp.call(derivedDatasByKey,k);});var baseScale=baseScheme(domainKeys),derivedColorMap={},getColor=function(itemData){var c,k=me.domainItemValue(itemData);if(def.hasOwnProp.call(derivedDatasByKey,k)){c=def.getOwn(derivedColorMap,k);if(!c){var colors=children(itemData).select(getColor).array();if(!colors.length)throw def.assert("Should have at least one child that is also a parent.");c=derivedColorMap[k]=me._calcAvgColor(colors);}}else{var map=me.option.isSpecified("Map")&&me.option("Map");c=map&&map[k]?map[k]:me.option("PreserveMap")&&me._state.preservedMap&&me._state.preservedMap[k]?me._state.preservedMap[k]:baseScale(k);}
return c;};derivedColorDatas.forEach(getColor);var scale=function(k){return def.getOwn(derivedColorMap,k)||baseScale(k);};def.copy(scale,baseScale);var d2,r2;scale.domain=function(){if(arguments.length)throw def.error.operationInvalid("The scale cannot be modified.");return d2||(d2=def.array.append(def.ownKeys(derivedColorMap),domainKeys));};scale.range=function(newR){if(arguments.length){var derivedRangeKeys=def.own(derivedColorMap).map(function(c){return c.key;}),newRange=newR;def.array.removeIf(newRange,function(c){return derivedRangeKeys.indexOf(c.key)>-1;});newRange.length&&baseScale.range(newRange);derivedColorMap={};derivedColorDatas.forEach(getColor);}
return r2||(r2=def.array.append(def.own(derivedColorMap),baseScale.range()));};return scale;};},_selectDomainItems:function(domainData){var candidates=def.query(domainData.nodes()),isNotDegenerate=function(data){return null!=data.value;},children=function(data){return data.children().where(isNotDegenerate);},hasChildren=function(data){return children(data).any();},isLeaf=function(data){return!hasChildren(data);};return this.isByParent?candidates.where(function(itemData){return itemData.parent?isNotDegenerate(itemData)&&hasChildren(itemData):isLeaf(itemData)||children(itemData).any(isLeaf);}):candidates.where(function(itemData){return(!itemData.parent||isNotDegenerate(itemData))&&isLeaf(itemData);});}});def.type("pvc.TreemapPanel",pvc.PlotPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.axes.size=chart._getAxis("size",(plot.option("SizeAxis")||0)-1);this.layoutMode=plot.option("LayoutMode");}).add({plotType:"treemap",_createCore:function(layoutInfo){var me=this,cs=layoutInfo.clientSize,rootScene=me._buildScene();if(rootScene){if(!rootScene.childNodes.length&&!this.chart.visualRoles.multiChart.isBound())throw new pvc.InvalidDataException("Unable to create a treemap chart, please check the data values.","all-zero-data");var lw0=def.number.to(me._getConstantExtension("leaf","lineWidth"),1),lw=lw0,lw2=lw/2,sizeProp=me.visualRoles.size.isBound()?me.axes.size.scale.by1(function(scene){return scene.vars.size.value;}):100,panel=me.pvTreemapPanel=new pvc.visual.Panel(me,me.pvPanel,{panelType:pv.Layout.Treemap,extensionId:"panel"}).pvMark.lock("visible",!0).lock("nodes",rootScene.nodes()).lock("left",lw2).lock("top",lw2).lock("width",cs.width-lw).lock("height",cs.height-lw).lock("size",sizeProp).lock("mode",me.layoutMode).lock("order",null).lock("round",!1);panel.node.left(function(n){return n.x+lw2;}).top(function(n){return n.y+lw2;}).width(function(n){return n.dx-lw;}).height(function(n){return n.dy-lw;});var colorAxis=me.axes.color,colorScale=me.visualRoles.color.isBound()?colorAxis.sceneScale({sceneVarName:"color"}):def.fun.constant(colorAxis.option("Unbound")),pvLeafMark=new pvc.visual.Bar(me,panel.leaf,{extensionId:"leaf"}).lockMark("visible").override("defaultColor",function(scene){return colorScale(scene);}).override("defaultStrokeWidth",function(){return lw0;}).pvMark.antialias(!1).lineCap("round").strokeDasharray(function(scene){return scene.vars.size.value<0?"dash":null;});new pvc.visual.Bar(me,panel.node,{extensionId:"ascendant",noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0}).intercept("visible",function(scene){return!!scene.parent&&!!scene.firstChild&&this.delegateExtension(!0);}).override("anyInteraction",function(scene){return scene.anyInteraction()||scene.isActiveDescendantOrSelf();}).override("defaultStrokeWidth",function(){return 1.5*lw;}).override("interactiveStrokeWidth",function(scene,w){return this.showsActivity()&&scene.isActiveDescendantOrSelf()?1.5*Math.max(1,w):w;}).override("defaultColor",function(scene){return colorScale(scene);}).override("normalColor",def.fun.constant(null)).override("interactiveColor",function(scene,color,type){if("stroke"===type){if(this.showsActivity()){if(scene.isActiveDescendantOrSelf())return pv.color(color).brighter(.5);if(scene.anyActive())return null;}
if(this.showsSelection()&&scene.isSelectedDescendantOrSelf())return pv.color(color).brighter(.5);}
return null;}).pvMark.antialias(!1);var label=pvc.visual.ValueLabel.maybeCreate(me,panel.label,{noAnchor:!0});label&&label.pvMark.textMargin(3).sign.optional("textAngle",function(scene){var text=this.defaultText(scene),pvLabel=this.pvMark;return scene.dx-2*pvLabel.textMargin()>pv.Text.measureWidth(text,pvLabel.font())?0:scene.dx>=scene.dy?0:-Math.PI/2;}).override("calcTextFitInfo",function(scene,text){var pvLabel=this.pvMark,tm=pvLabel.textMargin();if(!(tm<-1e-6)){var ta=pvLabel.textAngle(),isHorizText=Math.abs(Math.sin(ta))<1e-6,isVertiText=!isHorizText&&Math.abs(Math.cos(ta))<1e-6;if(isHorizText||isVertiText){var hide=!1,m=pv.Text.measure(text,pvLabel.font()),th=.75*m.height,thMax=scene[isVertiText?"dx":"dy"];"middle"!==pvLabel.textBaseline()&&(thMax/=2);thMax-=2*tm;hide|=th>thMax;var twMax=scene[isVertiText?"dy":"dx"];"center"!==pvLabel.textAlign()&&(twMax/=2);twMax-=2*tm;hide|=twMax<=0||this.hideOverflowed&&m.width>twMax;return{hide:hide,widthMax:twMax};}}}).override("getAnchoredToMark",function(){return pvLeafMark;});}},renderInteractive:function(){this.pvTreemapPanel.render();},_buildScene:function(){function recursive(scene){var group=scene.group;scene.vars.category=pvc_ValueLabelVar.fromComplex(group);sizeVarHelper.onNewScene(scene,!0);if(sizeIsBound&&!scene.vars.size.value){scene.parentNode&&scene.parentNode.removeChild(scene);return scene;}
var children=group.children().where(function(childData){return null!=childData.value;}).array();if(colorGrouping){var colorGroup=colorByParent&&!children.length?group.parent:group;if(colorGroup){var colorView=colorGrouping.view(colorGroup);scene.vars.color=new pvc_ValueLabelVar(colorView.keyTrimmed(),colorView.label);}else scene.vars.color=new pvc_ValueLabelVar(null,"");}else scene.parent||(scene.vars.color=new pvc_ValueLabelVar(null,""));children.forEach(function(childData){recursive(new pvc.visual.Scene(scene,{source:childData}));});return scene;}
var data=this.visibleData({ignoreNulls:!1});if(!data.childCount())return null;var roles=this.visualRoles,rootScene=new pvc.visual.Scene(null,{panel:this,source:data}),sizeVarHelper=new pvc.visual.RoleVarHelper(rootScene,"size",roles.size,{allowNestedVars:!0,hasPercentSubVar:!0}),sizeIsBound=roles.size.isBound(),colorGrouping=roles.color&&roles.color.grouping,colorByParent=colorGrouping&&"byparent"===this.plot.option("ColorMode");return recursive(rootScene);}});pvc.PlotPanel.registerClass(pvc.TreemapPanel);def.type("pvc.TreemapChart",pvc.BaseChart).add({_axisClassByType:{size:pvc.visual.NormalizedAxis},_axisCreateIfUnbound:{color:!0},_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).methods({_configureTypeCore:function(){this._configureTypeByOrgLevel(["category"],["size"]);}});},_getIsNullDatum:def.fun.constant(),_createPlotsInternal:function(){this._addPlot(new pvc.visual.TreemapPlot(this));},_initPlotsEnd:function(){this.base();null==this.options.legend&&(this.options.legend="byparent"===this.plots.treemap.option("ColorMode"));},_initAxes:function(){if(this.visualRoles.color.isDiscrete()){def.hasOwnProp.call(this,"_axisClassByType")||(this._axisClassByType=Object.create(this._axisClassByType));this._axisClassByType.color=pvc.visual.TreemapDiscreteColorAxis;}else delete this._axisClassByType;return this.base();},defaults:{legend:null}});pvc.parseSunburstSliceOrder=pvc.makeEnumParser("sliceOrder",["bySizeAscending","bySizeDescending","none"],"bySizeDescending");pvc.parseSunburstColorMode=pvc.makeEnumParser("colorMode",["fan","slice","level"],"fan");def("pvc.visual.SunburstPlot",pvc.visual.Plot.extend({init:function(chart,keyArgs){this.base(chart,keyArgs);if(!(chart instanceof pvc.SunburstChart))throw def.error(def.format("Plot type '{0}' can only be used from within a sunburst chart.",[this.type]));},methods:{type:"sunburst",_initVisualRoles:function(){this.base();this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0,rootLabel:this.option("RootCategoryLabel")});this._addVisualRole("size",{isMeasure:!0,isRequired:!1,isPercent:!0,requireSingleDimension:!1,requireIsDiscrete:!1,valueType:Number,defaultDimension:"size"});},_getColorRoleSpec:function(){return{defaultSourceRole:"category",defaultDimension:"color*",requireIsDiscrete:!0,rootLabel:this.option("RootCategoryLabel")};},createData:function(baseData,ka){return this.visualRoles.category.select(baseData,ka);},_initDataCells:function(){this.base();this._addDataCell(new pvc.visual.DataCell(this,"size",this.option("SizeAxis")-1,this.visualRoles.size));}},options:{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},ValuesAnchor:{cast:pvc.parseAnchor,value:"center"},ValuesVisible:{value:!0},ValuesMask:{resolve:"_resolveFull",value:"{category}"},ValuesOptimizeLegibility:{value:!0},ColorMode:{resolve:"_resolveFull",cast:pvc.parseSunburstColorMode,value:"fan"},RootCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"},SliceOrder:{resolve:"_resolveFull",cast:pvc.parseSunburstSliceOrder,value:"bySizeDescending"},EmptySlicesVisible:{resolve:"_resolveFull",cast:Boolean,value:!1},EmptySlicesLabel:{resolve:"_resolveFull",cast:String,value:""}}}));pvc.visual.Plot.registerClass(pvc.visual.SunburstPlot);def("pvc.visual.SunburstDiscreteColorAxis",pvc.visual.ColorAxis.extend({methods:{domainItemValueProp:function(){return this.role&&this.role.grouping.isSingleDimension?"value":"absKey";},domainItemKeyProp:function(){return this.role&&this.role.grouping.isSingleDimension?"key":"absKey";},domainGroupOperator:function(){return"select";},_selectDomainItems:function(domainData){var isNotDegenerate=function(data){return null!=data.value;};if("slice"!==this.chart.plots.sunburst.option("ColorMode")){var colorAvailable=this.option("Colors")().available;if(!colorAvailable)return def.query(domainData.childNodes).where(isNotDegenerate);var valueProp=this.domainItemValueProp();return def.query(domainData.nodes()).where(function(itemData){return!!itemData.parent&&isNotDegenerate(itemData)&&(!itemData.parent.parent||colorAvailable(itemData[valueProp]));});}
return def.query(nodes_breadthFirst(domainData)).where(function(itemData){return!!itemData.parent&&isNotDegenerate(itemData);});}},options:{SliceBrightnessFactor:{resolve:"_resolveFull",cast:def.number.toNonNegative,value:1},SliceLevelAlphaRatio:{resolve:"_resolveFull",cast:cast_number_zero_to_one,value:.15},SliceLevelAlphaMin:{resolve:"_resolveFull",cast:cast_number_zero_to_one,value:.1}}}));def.type("pvc.SunburstPanel",pvc.PlotPanel).init(function(chart,parent,plot,options){this.base(chart,parent,plot,options);this.axes.size=chart._getAxis("size",(plot.option("SizeAxis")||0)-1);this.sliceOrder=plot.option("SliceOrder");this.emptySlicesVisible=plot.option("EmptySlicesVisible");this.emptySlicesLabel=this.emptySlicesVisible?plot.option("EmptySlicesLabel"):"";}).add({plotType:"sunburst",_createCore:function(){var labelFont=this._getConstantExtension("label","font");def.string.is(labelFont)&&(this.valuesFont=labelFont);var me=this,rootScene=me._buildScene();if(rootScene){if(!rootScene.childNodes.length&&!this.chart.visualRoles.multiChart.isBound())throw new pvc.InvalidDataException("Unable to create a sunburst chart, please check the data values.","all-zero-data");var sizeProp=me.visualRoles.size.isBound()?me.axes.size.scale.by1(function(scene){return scene.vars.size.value;}):def.fun.constant(100),panel=me.pvSunburstPanel=new pvc.visual.Panel(me,me.pvPanel,{panelType:pv.Layout.Partition.Fill,extensionId:"panel"}).pvMark.lock("visible",!0).lock("nodes",rootScene.nodes()).lock("size",sizeProp).lock("orient","radial"),slice=new pvc.visual.SunburstSlice(this,panel.node,{extensionId:"slice",tooltipArgs:{options:{useCorners:!0,gravity:function(){var ma=this.midAngle(),isRightPlane=Math.cos(ma)>=0,isTopPlane=Math.sin(ma)>=0;return isRightPlane?isTopPlane?"nw":"sw":isTopPlane?"ne":"se";}}}}),label=pvc.visual.ValueLabel.maybeCreate(me,panel.label,{noAnchor:!0});label&&label.override("defaultText",function(scene){return scene.isRoot()?"":this.base(scene);}).override("calcTextFitInfo",function(scene,text){var pvLabel=this.pvMark,tm=pvLabel.textMargin();if(!(tm<-1e-6)&&"center"===pvLabel.textAlign()&&text){var ma=pvc.normAngle(scene.midAngle),la=pvc.normAngle(pvLabel.textAngle()),sameAngle=Math.abs(ma-la)<1e-6,oppoAngle=!1;if(!sameAngle){var la2=pvc.normAngle(la+Math.PI);oppoAngle=Math.abs(ma-la2)<1e-6;}
if(sameAngle||oppoAngle){var twMax,ir=scene.innerRadius,irmin=ir,or=scene.outerRadius,a=scene.angle,m=pv.Text.measure(text,pvLabel.font()),hide=!1;if(a<Math.PI){var th=.85*m.height,tb=pvLabel.textBaseline(),thEf="middle"===tb?th+tm/2:2*(th+3*tm/2);irmin=Math.max(irmin,thEf/(2*Math.tan(a/2)));}
twMax=or-tm-irmin;hide|=twMax<=0;twMax-=tm;hide|=this.hideOverflowed&&m.width>twMax;return{hide:hide,widthMax:twMax};}}}).override("getAnchoredToMark",function(){return slice.pvMark;});}},renderInteractive:function(){this.pvSunburstPanel.render();},_buildScene:function(){function recursive(scene,level){level>levels&&(levels=level);var group=scene.group,catVar=scene.vars.category=pvc_ValueLabelVar.fromComplex(group);emptySlicesLabel&&null==catVar.value&&(catVar.value=emptySlicesLabel);sizeVarHelper.onNewScene(scene,!0);if(sizeIsBound&&!scene.vars.size.value){scene.parentNode&&scene.parentNode.removeChild(scene);return scene;}
var children=group.children();emptySlicesVisible||(children=children.where(function(childData){return null!=childData.value;}));if(colorGrouping){var colorView=colorGrouping.view(group);scene.vars.color=new pvc_ValueLabelVar(colorView.keyTrimmed(),colorView.label);}else scene.vars.color=new pvc_ValueLabelVar(null,"");children.each(function(childData){recursive(new pvc.visual.SunburstScene(scene,{source:childData}),level+1);});return scene;}
function calculateColor(scene,index,siblingsSize,level){var baseColor=null,parent=scene.parent;if(parent){baseColor=isColorModeSlice||parent.isRoot()||colorAvailable(scene.vars.color.value)?colorScale(scene):null;if(!baseColor&&(baseColor=parent.color))if(isColorModeFan)index&&colorBrightnessFactor&&(baseColor=baseColor.brighter(colorBrightnessFactor*index/(siblingsSize-1)));else if(isColorModeLevel){baseColor=baseColor.rgb();var r=sliceLevelAlphaRatio*(level-1),a=Math.max(sliceLevelAlphaMin,(1-r)*baseColor.a);baseColor=baseColor.alpha(a);}}
scene.color=baseColor;var children=scene.childNodes,childrenSize=children.length;children.forEach(function(childScene,index){calculateColor(childScene,index,childrenSize,level+1);});}
var data=this.visibleData({ignoreNulls:!1}),emptySlicesVisible=this.emptySlicesVisible,emptySlicesLabel=this.emptySlicesLabel;if(!data.childCount())return null;var colorBrightnessFactor,sliceLevelAlphaRatio,sliceLevelAlphaMin,roles=this.visualRoles,rootScene=new pvc.visual.SunburstScene(null,{panel:this,source:data}),sizeIsBound=roles.size.isBound(),sizeVarHelper=new pvc.visual.RoleVarHelper(rootScene,"size",roles.size,{allowNestedVars:!0,hasPercentSubVar:!0}),colorGrouping=roles.color&&roles.color.grouping,colorAxis=this.axes.color,colorMode=this.plot.option("ColorMode"),isColorModeFan="fan"===colorMode,isColorModeLevel="level"===colorMode,isColorModeSlice="slice"===colorMode,colorScale=roles.color.isBound()?colorAxis.sceneScale({sceneVarName:"color"}):def.fun.constant(colorAxis.option("Unbound")),colorAvailable=colorScale.available||def.retFalse,levels=0;if(isColorModeFan)colorBrightnessFactor=colorAxis.option("SliceBrightnessFactor");else if(isColorModeLevel){sliceLevelAlphaRatio=colorAxis.option("SliceLevelAlphaRatio");sliceLevelAlphaMin=colorAxis.option("SliceLevelAlphaMin");}
recursive(rootScene,0);if(this.sliceOrder&&sizeIsBound&&"none"!==this.sliceOrder){var compare="bysizeascending"===this.sliceOrder?def.ascending:def.descending;rootScene.sort(function(sceneA,sceneB){return compare(Math.abs(sceneA.vars.size.value),Math.abs(sceneB.vars.size.value))||def.ascending(sceneA.childIndex(),sceneB.childIndex());});}
calculateColor(rootScene,0,0,0);return rootScene;}});pvc.PlotPanel.registerClass(pvc.SunburstPanel);def.type("pvc.visual.SunburstScene",pvc.visual.Scene).add({_createSelectedInfo:function(){var any=this.chart().data.owner.selectedCount()>0;return{any:any,is:any&&this.datums().all(cdo.Datum.isSelected)};}});def.type("pvc.SunburstChart",pvc.BaseChart).add({_axisClassByType:{size:pvc.visual.NormalizedAxis,color:pvc.visual.SunburstDiscreteColorAxis},_axisCreateIfUnbound:{color:!0},_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).methods({_configureTypeCore:function(){this._configureTypeByOrgLevel(["category"],["size"]);}});},_getIsNullDatum:def.fun.constant(),_createPlotsInternal:function(){var sunburstPlot=new pvc.visual.SunburstPlot(this);this._addPlot(sunburstPlot);this.options.legend=!1;}});def("pvc.visual.SunburstSlice",pvc.visual.Sign.extend({init:function(panel,protoMark,keyArgs){var pvMark=protoMark.add(pv.Wedge);keyArgs=def.setDefaults(keyArgs,"freeColor",!1);this.base(panel,pvMark,keyArgs);this._bindProperty("lineWidth","strokeWidth");},properties:["strokeWidth"],methods:{defaultStrokeWidth:def.fun.constant(.5),interactiveStrokeWidth:function(scene,strokeWidth){return this.showsActivity()&&scene.isActiveDescendantOrSelf()?2*Math.max(1,strokeWidth):strokeWidth;},defaultColor:function(scene,type){return scene.color;},normalColor:function(scene,color,type){return color&&"stroke"===type?color.darker():color;},interactiveColor:function(scene,color,type){if(this.showsActivity())if("stroke"===type){if(scene.isActiveDescendantOrSelf())return color.brighter(2).alpha(.7);}else if(scene.isActive)return color.brighter(.2).alpha(.8);return this.mayShowNotAmongSelected(scene)?this.dimColor(color,type):this.normalColor(scene,color,type);}}}));def.type("pvc.visual.BulletPlot",pvc.visual.Plot.extend({methods:{type:"bullet",_initVisualRoles:function(){this.base();this._addVisualRole("title",{defaultDimension:"title*"});this._addVisualRole("subTitle",{defaultDimension:"subTitle*"});this._addVisualRole("value",{isMeasure:!0,requireIsDiscrete:!1,requireSingleDimension:!1,valueType:Number,defaultDimension:"value*"});this._addVisualRole("marker",{isMeasure:!0,requireIsDiscrete:!1,requireSingleDimension:!1,valueType:Number,defaultDimension:"marker*"});this._addVisualRole("range",{isMeasure:!0,requireIsDiscrete:!1,requireSingleDimension:!1,valueType:Number,defaultDimension:"range*"});}},options:{ValuesVisible:{value:!0}}}));pvc.visual.Plot.registerClass(pvc.visual.BulletPlot);def.type("pvc.BulletChart",pvc.BaseChart).add({bulletChartPanel:null,allowNoData:!0,_processOptionsCore:function(options){options.legend=!1;options.selectable=!1;this.base(options);},_getTranslationClass:function(translOptions){return def.type(this.base(translOptions)).methods({_configureTypeCore:function(){this._configureTypeByOrgLevel([{name:"title",greedy:!1,maxCount:1},{name:"subTitle",greedy:!1,maxCount:1}],["value","marker",{name:"range",greedy:!0,maxCount:1/0}]);}});},_createPlotsInternal:function(){this._addPlot(new pvc.visual.BulletPlot(this));},defaults:{compatVersion:1,orientation:"horizontal",bulletSize:30,bulletSpacing:50,bulletMargin:100,bulletTitle:"Title",bulletSubtitle:"",bulletTitlePosition:"left",tooltipFormat:function(s,c,v){return this.chart.options.valueFormat(v);},crosstabMode:!1,seriesInRows:!1,dataTypeCheckingMode:"extended"}});def.type("pvc.BulletChartPanel",pvc.PlotPanel).add({plotType:"bullet",pvBullets:null,pvBullet:null,data:null,onSelectionChange:null,_createCore:function(layoutInfo){var size,angle,align,titleLeftOffset,titleTopOffset,ruleAnchor,leftPos,topPos,titleSpace,chart=this.chart,options=chart.options,data=this.buildData(),me=this,anchor="horizontal"==options.orientation?"left":"bottom";if("horizontal"==options.orientation){size=layoutInfo.clientSize.width-this.chart.options.bulletMargin-20;angle=0;switch(options.bulletTitlePosition){case"top":leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align="left";titleTopOffset=-12;titleSpace=parseInt(options.titleSize/2,10);break;case"bottom":leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align="left";titleTopOffset=options.bulletSize+32;titleSpace=0;break;case"right":leftPos=5;titleLeftOffset=size+5;align="left";titleTopOffset=parseInt(options.bulletSize/2,10);titleSpace=0;break;case"left":default:leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;titleTopOffset=parseInt(options.bulletSize/2,10);align="right";titleSpace=0;}
ruleAnchor="bottom";topPos=function(){return this.index*(options.bulletSize+options.bulletSpacing)+titleSpace;};}else{size=layoutInfo.clientSize.height-this.chart.options.bulletMargin-20;switch(options.bulletTitlePosition){case"top":leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align="left";titleTopOffset=-20;angle=0;topPos=void 0;break;case"bottom":leftPos=this.chart.options.bulletMargin;titleLeftOffset=0;align="left";titleTopOffset=size+20;angle=0;topPos=20;break;case"right":leftPos=5;titleLeftOffset=this.chart.options.bulletSize+40;align="left";titleTopOffset=size;angle=-Math.PI/2;topPos=void 0;break;case"left":default:leftPos=this.chart.options.bulletMargin;titleLeftOffset=-12;titleTopOffset=this.height-this.chart.options.bulletMargin-20;align="left";angle=-Math.PI/2;topPos=void 0;}
ruleAnchor="right";leftPos=function(){return options.bulletMargin+this.index*(options.bulletSize+options.bulletSpacing);};}
this.pvBullets=this.pvPanel.add(pv.Panel).data(data)[pvc.BasePanel.orthogonalLength[anchor]](size)[pvc.BasePanel.parallelLength[anchor]](this.chart.options.bulletSize).margin(20).left(leftPos).top(topPos);this.pvBullet=this.pvBullets.add(pv.Layout.Bullet).orient(anchor).ranges(function(d){return d.ranges;}).measures(function(d){return d.measures;}).markers(function(d){return d.markers;});if(chart.clickable()&&this.clickAction){var me=this;this.pvBullet.cursor("pointer").event("click",function(d){var s=d.title,c=d.subtitle,ev=pv.event;return me.clickAction(s,c,d.measures,ev);});}
this.pvBulletRange=this.pvBullet.range.add(pv.Bar);this.pvBulletMeasure=this.pvBullet.measure.add(pv.Bar).text(function(v,d){return d.formattedMeasures[this.index];});this.pvBulletMarker=this.pvBullet.marker.add(pv.Dot).shape("square").fillStyle("white").text(function(v,d){return d.formattedMarkers[this.index];});if(this.showsTooltip()){var myself=this;this.pvBulletMeasure.localProperty("tooltip").tooltip(function(v,d){var s=d.title,c=d.subtitle;return chart.options.tooltipFormat.call(myself,s,c,v);});this.pvBulletMarker.localProperty("tooltip").tooltip(function(v,d){var s=d.title,c=d.subtitle;return chart.options.tooltipFormat.call(myself,s,c,v);});this.pvBulletMeasure.event("mouseover",pv.Behavior.tipsy(this.chart._tooltipOptions));this.pvBulletMarker.event("mouseover",pv.Behavior.tipsy(this.chart._tooltipOptions));}
this.pvBulletRule=this.pvBullet.tick.add(pv.Rule);this.pvBulletRuleLabel=this.pvBulletRule.anchor(ruleAnchor).add(pv.Label).text(function(v){return me.pvBullet.x.tickFormat(v,this.index);});this.pvBulletTitle=this.pvBullet.anchor(anchor).add(pv.Label).font("bold 12px sans-serif").textAngle(angle).left(-10).textAlign(align).textBaseline("bottom").left(titleLeftOffset).top(titleTopOffset).text(function(d){return d.formattedTitle;});this.pvBulletSubtitle=this.pvBullet.anchor(anchor).add(pv.Label).textStyle("#666").textAngle(angle).textAlign(align).textBaseline("top").left(titleLeftOffset).top(titleTopOffset).text(function(d){return d.formattedSubtitle;});var doubleClickAction="function"==typeof options.axisDoubleClickAction?function(d,e){options.axisDoubleClickAction(d,e);}:null;if(chart.doubleClickable()&&doubleClickAction){this.pvBulletTitle.cursor("pointer").events("all").event("dblclick",function(d){doubleClickAction(d,arguments[arguments.length-1]);});this.pvBulletSubtitle.cursor("pointer").events("all").event("dblclick",function(d){doubleClickAction(d,arguments[arguments.length-1]);});}},applyExtensions:function(){this.base();this.extend(this.pvBullets,"bulletsPanel");this.extend(this.pvBullet,"bulletPanel");this.extend(this.pvBulletRange,"bulletRange");this.extend(this.pvBulletMeasure,"bulletMeasure");this.extend(this.pvBulletMarker,"bulletMarker");this.extend(this.pvBulletRule,"bulletRule");this.extend(this.pvBulletRuleLabel,"bulletRuleLabel");this.extend(this.pvBulletTitle,"bulletTitle");this.extend(this.pvBulletSubtitle,"bulletSubtitle");},_getExtensionId:function(){return[{abs:"content"}].concat(this.base());},buildData:function(){var data,chart=this.chart,options=chart.options,titleRole=chart.visualRoles.title,titleGrouping=titleRole.grouping,subTitleRole=chart.visualRoles.subTitle,subTitleGrouping=subTitleRole.grouping,valueRole=chart.visualRoles.value,valueGrouping=valueRole.grouping,markerRole=chart.visualRoles.marker,markerGrouping=markerRole.grouping,rangeRole=chart.visualRoles.range,rangeGrouping=rangeRole.grouping,defaultData={title:options.bulletTitle,formattedTitle:options.bulletTitle,subtitle:options.bulletSubtitle,formattedSubtitle:options.bulletSubtitle,ranges:def.array.to(options.bulletRanges)||[],measures:def.array.to(options.bulletMeasures)||[],markers:def.array.to(options.bulletMarkers)||[]};def.set(defaultData,"formattedRanges",defaultData.ranges.map(String),"formattedMeasures",defaultData.measures.map(String),"formattedMarkers",defaultData.markers.map(String));data=valueGrouping||titleGrouping||markerGrouping||subTitleGrouping||rangeGrouping?chart.data.datums().select(function(datum){var view,d=Object.create(defaultData);if(valueGrouping){view=valueGrouping.view(datum);d.measures=view.values();d.formattedMeasures=view.labels();}
if(titleGrouping){view=titleGrouping.view(datum);d.title=view.value;d.formattedTitle=view.label;}
if(subTitleGrouping){view=subTitleGrouping.view(datum);d.subtitle=view.value;d.formattedSubtitle=view.label;}
if(markerGrouping){view=markerGrouping.view(datum);d.markers=view.values();d.formattedMarkers=view.labels();}
if(rangeGrouping){view=rangeGrouping.view(datum);d.ranges=view.values();d.formattedRanges=view.labels();}
return d;},this).array():[defaultData];return data;}});pvc.PlotPanel.registerClass(pvc.BulletChartPanel);def.type("pvc.ParallelCoordinates",pvc.BaseChart).init(function(options){options=options||{};options.dimensions=options.dimensions||{};options.dimensions.value||(options.dimensions.value={valueType:null});this.base(options);}).add({parCoordPanel:null,_createContent:function(parentPanel,contentOptions){this.parCoordPanel=new pvc.ParCoordPanel(this,parentPanel,def.create(contentOptions,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,sortCategorical:this.options.sortCategorical,mapAllDimensions:this.options.mapAllDimensions,numDigits:this.options.numDigits}));},defaults:def.create(pvc.BaseChart.prototype.defaults,{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,sortCategorical:!0,mapAllDimensions:!0,numDigits:0})});def.type("pvc.ParCoordPanel",pvc.BasePanel).add({anchor:"fill",pvParCoord:null,dimensions:null,dimensionDescr:null,data:null,retrieveData:function(){var data=this.chart.data,numDigit=this.chart.options.numDigits;this.dimensions=data.getVisibleCategories();var values=data.getValues(),dataRowIndex=data.getVisibleSeriesIndexes(),pCoordIndex=data.getVisibleCategoriesIndexes(),pCoordKeys=data.getCategories(),pCoordMapping=this.chart.options.mapAllDimensions?pCoordIndex.map(function(d){return isNaN(values[d][0])?{categorical:!0,len:0,map:[]}:{categorical:!1,len:0,map:[],displayValue:[]};}):pCoordIndex.map(function(d){return isNaN(values[d][0])?{categorical:!0,len:0,map:[]}:null;}),coordMapUpdate=function(i,val){var cMap=pCoordMapping[i],k=null;if(cMap.categorical){k=cMap.map[val];if(null==k){k=cMap.len;cMap.len++;cMap.map[val]=k;}}else{var keyVal=val.toFixed(numDigit);k=cMap.map[keyVal];if(null==k){k=cMap.len;cMap.len++;cMap.map[keyVal]=k;cMap.displayValue[keyVal]=val;}}
return k;};for(var d in pCoordMapping)pCoordMapping.hasOwnProperty(d)&&pCoordMapping[d]&&pCoordMapping[d].categorical&&(pCoordMapping[d].displayValue=pCoordMapping[d].map);var i,item,k;if(this.chart.options.sortCategorical||this.chart.options.mapAllDimensions)for(i=0;i<pCoordMapping.length;i++)if(pCoordMapping[i]){for(var col=0;col<values[i].length;col++)coordMapUpdate(i,values[i][col]);var cMap=pCoordMapping[i].map,sorted=[];for(item in cMap)cMap.hasOwnProperty(item)&&sorted.push(item);sorted.sort();if(pCoordMapping[i].categorical)for(k=0;k<sorted.length;k++)cMap[sorted[k]]=k;else for(k=0;k<sorted.length;k++)cMap[sorted[k]].index=k;}
var generateHashMap=function(col){var record={};for(var j in pCoordIndex)pCoordIndex.hasOwnProperty(j)&&(record[pCoordKeys[j]]=pCoordMapping[j]?coordMapUpdate(j,values[j][col]):values[j][col]);return record;};this.data=dataRowIndex.map(function(col){return generateHashMap(col);});var descrVals=this.dimensions.map(function(cat){var item2={},elements=cat.split("__");item2.id=cat;item2.name=elements[0];item2.unit=elements.length>1?elements[1]:"";return item2;});for(i=0;i<descrVals.length;i++){item=descrVals[i];var index=pCoordIndex[i];item.orgRowIndex=index;var theMin,theMax,theMin2,theMax2,v,len=values[index].length;if(pCoordMapping[index]){theMin=theMax=theMin2=theMax2=pCoordMapping[index].displayValue[values[index][0]];for(k=1;k<len;k++){v=pCoordMapping[index].displayValue[values[index][k]];if(v<theMin){theMin2=theMin;theMin=v;}
if(v>theMax){theMax2=theMax;theMax=v;}}}else{theMin=theMax=theMin2=theMax2=values[index][0];for(k=1;k<len;k++){v=values[index][k];if(v<theMin){theMin2=theMin;theMin=v;}
if(v>theMax){theMax2=theMax;theMax=v;}}}
var theStep=(theMax-theMax2+(theMin2-theMin))/2;item.min=theMin;item.max=theMax;item.step=theStep;item.categorical=!1;if(pCoordMapping[index]){item.map=pCoordMapping[index].map;item.mapLength=pCoordMapping[index].len;item.categorical=pCoordMapping[index].categorical;if(!item.categorical){item.orgValue=[];var theMap=pCoordMapping[index].map;for(var key in theMap)theMap.hasOwnProperty(key)&&(item.orgValue[theMap[key]]=0+key);}}}
this.dimensionDescr=function(keys,vals){for(var record={},i=0;i<keys.length;i++)record[keys[i]]=vals[i];return record;}(this.dimensions,descrVals);},_createCore:function(){function update(d){var t=d.dim;filter[t].min=Math.max(y[t].domain()[0],y[t].invert(height-d.y-d.dy));filter[t].max=Math.min(y[t].domain()[1],y[t].invert(height-d.y));active=t;change.render();return!1;}
function selectAll(d){if(d.dy<3){var t=d.dim;filter[t].min=Math.max(y[t].domain()[0],y[t].invert(0));filter[t].max=Math.min(y[t].domain()[1],y[t].invert(height));d.y=botRuleOffs;d.dy=ruleHeight;active=t;change.render();}
return!1;}
var myself=this;this.retrieveData();var height=this.height,numDigits=this.chart.options.numDigits,topRuleOffs=this.chart.options.topRuleOffset,botRuleOffs=this.chart.options.botRuleOffset,leftRuleOffs=this.chart.options.leftRuleOffset,rightRulePos=this.width-this.chart.options.rightRuleOffset,topRulePos=this.height-topRuleOffs,ruleHeight=topRulePos-botRuleOffs,labelTopOffs=topRuleOffs-12,dims=this.dimensions,dimDescr=this.dimensionDescr,getDimSc=function(t,addMargin){var theMin=dimDescr[t].min,theMax=dimDescr[t].max,theStep=dimDescr[t].step;if(addMargin){theMin-=theStep;theMax+=theStep;}
return pv.Scale.linear(theMin,theMax).range(botRuleOffs,topRulePos);},getDimensionScale=function(t){var scale=getDimSc(t,!0).range(botRuleOffs,topRulePos),dd=dimDescr[t];if(dd.orgValue&&!dd.categorical){var func=function(x){return scale(dd.orgValue[x]);};func.domain=function(){return scale.domain();};func.invert=function(d){return scale.invert(d);};return func;}
return scale;},getDimColorScale=function(t){return getDimSc(t,!1).range("steelblue","brown");},x=pv.Scale.ordinal(dims).splitFlush(leftRuleOffs,rightRulePos),y=pv.dict(dims,getDimensionScale),colors=pv.dict(dims,getDimColorScale),filter=pv.dict(dims,function(t){return{min:y[t].domain()[0],max:y[t].domain()[1]};}),active=dims[0],selectVisible=this.chart.options.mapAllDimensions?function(d){return dims.every(function(t){var dd=dimDescr[t],val=dd.orgValue&&!dd.categorical?dd.orgValue[d[t]]:d[t];return val>=filter[t].min&&val<=filter[t].max;});}:function(d){return dims.every(function(t){return d[t]>=filter[t].min&&d[t]<=filter[t].max;});};this.pvParCoord=this.pvPanel.add(pv.Panel).data(myself.data).visible(selectVisible).add(pv.Line).data(dims).left(function(t,d){return x(t);}).bottom(function(t,d){return y[t](d[t]);}).strokeStyle("#ddd").lineWidth(1).antialias(!1);this.pvPanel.add(pv.Rule).data(dims).left(x).top(topRuleOffs).bottom(botRuleOffs).anchor("top").add(pv.Label).top(labelTopOffs).font("bold 10px sans-serif").text(function(d){return dimDescr[d].name;});var labels=[];for(var d in dimDescr)if(dimDescr.hasOwnProperty(d)){var dim=dimDescr[d];if(dim.categorical){var xVal=x(dim.id)+6;for(var l in dim.map)dim.map.hasOwnProperty(l)&&(labels[labels.length]={x:xVal,y:y[dim.id](dim.map[l])+3,label:l});}}
this.pvPanel.add(pv.Panel).data(labels).add(pv.Label).left(function(d){return d.x;}).bottom(function(d){return d.y;}).text(function(d){return d.label;}).textAlign("left");var change=this.pvPanel.add(pv.Panel);change.add(pv.Panel).data(myself.data).visible(selectVisible).add(pv.Line).data(dims).left(function(t,d){return x(t);}).bottom(function(t,d){return y[t](d[t]);}).strokeStyle(function(t,d){var dd=dimDescr[active],val=dd.orgValue&&!dd.categorical?dd.orgValue[d[active]]:d[active];return colors[active](val);}).lineWidth(1);var handle=change.add(pv.Panel).data(dims.map(function(dim){return{y:botRuleOffs,dy:ruleHeight,dim:dim};})).left(function(t){return x(t.dim)-30;}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",pv.Behavior.select()).event("select",update).event("selectend",selectAll).add(pv.Bar).left(25).top(function(d){return d.y;}).width(10).height(function(d){return d.dy;}).fillStyle(function(t){return t.dim==active?colors[t.dim]((filter[t.dim].max+filter[t.dim].min)/2):"hsla(0,0,50%,.5)";}).strokeStyle("white").cursor("move").event("mousedown",pv.Behavior.drag()).event("dragstart",update).event("drag",update);handle.anchor("bottom").add(pv.Label).textBaseline("top").text(function(d){return dimDescr[d.dim].categorical?"":filter[d.dim].min.toFixed(numDigits)+dimDescr[d.dim].unit;});handle.anchor("top").add(pv.Label).textBaseline("bottom").text(function(d){return dimDescr[d.dim].categorical?"":filter[d.dim].max.toFixed(numDigits)+dimDescr[d.dim].unit;});this.extend(this.pvParCoord,"parCoord");this.extend(this.pvPanel,"chart");}});def.type("pvc.DataTree",pvc.BaseChart).init(function(options){options=options||{};options.dimensionGroups=options.dimensionGroups||{};options.dimensionGroups.value||(options.dimensionGroups.value={valueType:null});this.base(options);}).add({structEngine:null,structMetadata:null,structDataset:null,DataTreePanel:null,_getColorRoleSpec:function(){return{isRequired:!0,defaultSourceRole:"category",requireIsDiscrete:!0};},setStructData:function(data){this.structDataset=data.resultset;this.structDataset.length||this.log("Warning: Structure-dataset is empty");this.structMetadata=data.metadata;this.structMetadata.length||this.log("Warning: Structure-Metadata is empty");},_createContent:function(parentPanel,contentOptions){var structEngine=this.structEngine,structType=structEngine?structEngine.type:new cdo.ComplexType();structType.addDimension("value",{});var translOptions={seriesInRows:!0,crosstabMode:!0},translation=new cdo.CrosstabTranslationOper(structType,this.structDataset,this.structMetadata,translOptions);translation.configureType();structEngine||(structEngine=this.structEngine=new cdo.Data({type:structType}));structEngine.load(translation.execute(structEngine));def.debug>=3&&this.log(this.structEngine.getInfo());this.dataTreePanel=new pvc.DataTreePanel(this,parentPanel,def.create(contentOptions,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,boxplotColor:this.options.boxplotColor,valueFontsize:this.options.valueFontsize,headerFontsize:this.options.headerFontsize,border:this.options.border,perpConnector:this.options.perpConnector,numDigits:this.options.numDigits,minVerticalSpace:this.options.minVerticalSpace,connectorSpace:this.options.connectorSpace,minAspectRatio:this.options.minAspectRatio}));},defaults:{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,boxplotColor:"grey",headerFontsize:16,valueFontsize:20,border:2,perpConnector:!1,numDigits:0,connectorSpace:.15,minVerticalSpace:.05,minAspectRatio:2}});def.type("pvc.DataTreePanel",pvc.PlotPanel).add({pvDataTree:null,treeElements:null,structMap:null,structArr:null,hRules:null,vRules:null,rules:null,generatePerpConnectors:function(leftLength){this.hRules=[];this.vRules=[];this.rules=[];for(var e in this.structMap){var elem=this.structMap[e];if(null!=elem.children){var min=1e4,max=-1e4,theLeft=elem.left+elem.width;this.hRules.push({left:theLeft,width:leftLength,bottom:elem.bottom+elem.height/2});theLeft+=leftLength;for(var i in elem.children){var child=this.structMap[elem.children[i]],theBottom=child.bottom+child.height/2;theBottom>max&&(max=theBottom);theBottom<min&&(min=theBottom);this.hRules.push({left:theLeft,width:child.left-theLeft,bottom:theBottom});}
max>min&&this.vRules.push({left:theLeft,bottom:min,height:max-min});}}},generateLineSegment:function(x1,y1,x2,y2){var line=[];line.push({x:x1,y:y1});line.push({x:x2,y:y2});this.rules.push(line);},generateConnectors:function(leftLength){this.hRules=[];this.vRules=[];if(this.chart.options.perpConnector)this.generatePerpConnectors(leftLength);else{this.rules=[];for(var e in this.structMap){var elem=this.structMap[e];if(null!=elem.children){var theCenter,child,i,min=1e4,max=-1e4;for(i in elem.children){child=this.structMap[elem.children[i]];theCenter=child.bottom+child.height/2;theCenter>max&&(max=theCenter);theCenter<min&&(min=theCenter);}
var mid=(max+min)/2,theLeft1=elem.left+elem.width,theLeft2=theLeft1+leftLength;this.generateLineSegment(theLeft1,elem.bottom+elem.height/2,theLeft2,mid);for(i in elem.children){child=this.structMap[elem.children[i]];theCenter=child.bottom+child.height/2;this.generateLineSegment(theLeft2,mid,child.left,theCenter);}}}}},retrieveStructure:function(){var data=this.chart.structEngine,options=this.chart.options,colLabels=data.getVisibleCategories();this.treeElements=data.getVisibleSeries();var e,values=data.getValues(),bottomHeightSpecified=colLabels.length>4;for(e in this.treeElements)this.treeElements[e]=$.trim(this.treeElements[e]);var bounds=[];bounds.getElement=function(label){null==bounds[label]&&(bounds[label]={min:1e4,max:-1e4});return bounds[label];};bounds.addValue=function(label,value){var bnd=bounds.getElement(label);value<bnd.min&&(bnd.min=value);value>bnd.max&&(bnd.max=value);return bnd;};var col,colnr,elem,row;for(e in this.treeElements){elem=this.treeElements[e];col=elem[0];colnr=col.charCodeAt(0);row=parseInt(elem.slice(1),10);bounds.addValue("__cols",colnr);bounds.addValue(col,row);}
var bnds=bounds.getElement("__cols"),gridWidth=this.innerWidth/(bnds.max-bnds.min+1),connectorWidth=options.connectorSpace*gridWidth,cellWidth=gridWidth-connectorWidth,maxCellHeight=cellWidth/options.minAspectRatio,colBase=bnds.min;delete bounds.__cols;for(e in bounds){bnds=bounds[e];if("function"!=typeof bnds){var numRows=bnds.max-bnds.min+1;bnds.gridHeight=this.innerHeight/numRows;bnds.cellHeight=bnds.gridHeight*(1-options.minVerticalSpace);bnds.cellHeight>maxCellHeight&&(bnds.cellHeight=maxCellHeight);bnds.relBottom=(bnds.gridHeight-bnds.cellHeight)/2;bnds.numRows=numRows;}}
var whitespaceQuote=new RegExp("[\\s\"']+","g");this.structMap={};for(e in this.treeElements){var box={};elem=this.treeElements[e];box.box_id=elem;this.structMap[elem]=box;col=elem[0];colnr=col.charCodeAt(0);row=parseInt(elem.slice(1),10);bnds=bounds.getElement(col);box.colIndex=colnr-colBase;box.rowIndex=bnds.numRows-(row-bnds.min)-1;box.left=this.leftOffs+box.colIndex*gridWidth;box.width=cellWidth;if(bottomHeightSpecified){box.bottom=values[4][e];box.height=values[5][e];}else{box.bottom=this.botOffs+box.rowIndex*bnds.gridHeight+bnds.relBottom;box.height=bnds.cellHeight;}
box.label=values[0][e];box.selector=values[1][e];box.aggregation=values[2][e];var children=(values[3][e]||"").replace(whitespaceQuote," ");box.children=" "===children||""===children?null:children.split(" ");}
this.generateConnectors((gridWidth-cellWidth)/2);this.structArr=[];for(e in this.structMap){elem=this.structMap[e];this.structArr.push(elem);}},findDataValue:function(key,data){for(var i=0;i<data[0].length;i++)if(data[0][i]==key)return data[1][i];this.log("Error: value with key : "+key+" not found.");},generateBoxPlots:function(){var options=this.chart.options;for(var e in this.structArr){var elem=this.structArr[e];if(elem.values.length){elem.subplot={};var sp=elem.subplot,dat=[],rlMargin=elem.width/6;sp.hRules=[];sp.vRules=[];sp.marks=[];sp.labels=[];dat.push(this.findDataValue("_p5",elem.values));dat.push(this.findDataValue("_p25",elem.values));dat.push(this.findDataValue("_p50",elem.values));dat.push(this.findDataValue("_p75",elem.values));dat.push(this.findDataValue("_p95",elem.values));var noBox=!1;if(void 0!==dat[2]){if(dat[4]<dat[0]){dat=dat.reverse();this.log(" dataset "+elem.box_id+" repaired (_p95 was smaller than _p5)");}
if(dat[4]>dat[0])sp.hScale=pv.Scale.linear(dat[0],dat[4]);else{noBox=!0;sp.hScale=pv.Scale.linear(dat[0]-1e-10,dat[0]+1e-10);}
sp.hScale.range(elem.left+rlMargin,elem.left+elem.width-rlMargin);var i,avLabel=""+dat[2];for(i=0;i<dat.length;i++)dat[i]=sp.hScale(dat[i]);sp.bot=elem.bottom+elem.height/3;sp.top=elem.bottom+2*elem.height/3;sp.mid=(sp.top+sp.bot)/2;sp.textBottom=elem.bottom+15;sp.textBottom=sp.bot-options.valueFontsize-1;if(noBox)sp.vRules.push({left:dat[0],bottom:sp.bot,lWidth:3,height:sp.top-sp.bot});else{sp.hRules.push({left:dat[0],width:dat[1]-dat[0],lWidth:1,bottom:sp.mid});sp.hRules.push({left:dat[1],width:dat[3]-dat[1],lWidth:1,bottom:sp.bot});sp.hRules.push({left:dat[1],width:dat[3]-dat[1],lWidth:1,bottom:sp.top});sp.hRules.push({left:dat[3],width:dat[4]-dat[3],lWidth:1,bottom:sp.mid});for(i=0;i<dat.length;i++)sp.vRules.push({left:dat[i],bottom:sp.bot,lWidth:2==i?3:1,height:sp.top-sp.bot});}
sp.labels.push({left:dat[2],bottom:sp.textBottom,text:this.labelFixedDigits(avLabel),size:options.smValueFont,color:options.boxplotColor});}}}},labelFixedDigits:function(value){"string"==typeof value&&(value=parseFloat(value));if("number"==typeof value){var nd=this.chart.options.numDigits;value=value.toFixed(nd);}
return""+value;},addDataPoint:function(key){var options=this.chart.options;for(var e in this.structArr){var elem=this.structArr[e];if(elem.values.length){var value=this.findDataValue(key,elem.values);if(void 0!==value){var sp=elem.subplot,theLeft=sp.hScale(value);sp.marks.push({left:theLeft,bottom:sp.mid,color:"green"});sp.labels.push({left:theLeft,bottom:sp.textBottom,text:this.labelFixedDigits(value),size:options.valueFont,color:"green"});}}}},retrieveData:function(){var i,data=this.chart.data,options=this.chart.options,selectors=data.getVisibleSeries(),values=data.getValues(),selMap={},numCols=values.length;for(var e in this.structArr){var elem=this.structArr[e];elem.values=[];for(i=0;i<numCols;i++)elem.values.push([]);selMap[elem.selector]=elem;}
var boxNotFound={};for(i in selectors){var box=selMap[selectors[i]];if(void 0!==box)for(var j in values)box.values[j].push(values[j][i]);else boxNotFound[selectors[i]]=!0;}
for(var sel in boxNotFound)this.log("Could'nt find box for selector: "+sel);this.generateBoxPlots();var whitespaceQuote=new RegExp("[\\s\"']+","g");if(options.selectParam){var selPar=options.selectParam.replace(whitespaceQuote,"");if("undefined"!=selPar&&selPar.length>0&&void 0!==window[selPar]){selPar=window[selPar];this.addDataPoint(selPar);}}},_createCore:function(){var myself=this,options=this.chart.options;options.smValueFontsize=Math.round(.6*options.valueFontsize);options.smValueFont=options.smValueFontsize+"px sans-serif";options.valueFont=options.valueFontsize+"px sans-serif";var topRuleOffs=options.topRuleOffset,botRuleOffs=options.botRuleOffset,leftRuleOffs=options.leftRuleOffset;this.innerWidth=this.width-leftRuleOffs-options.rightRuleOffset;this.innerHeight=this.height-topRuleOffs-botRuleOffs;this.botOffs=botRuleOffs;this.leftOffs=leftRuleOffs;this.retrieveStructure();this.retrieveData();var i,topMargin=options.headerFontsize+3,rules=this.rules;for(i=0;i<rules.length;i++)this.pvPanel.add(pv.Line).data(rules[i]).left(function(d){return d.x;}).bottom(function(d){return d.y;}).lineWidth(1).strokeStyle("black");this.pvDataTree=this.pvPanel.add(pv.Bar).data(myself.structArr).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).height(function(d){return d.height;}).width(function(d){return d.width;}).fillStyle("green").add(pv.Bar).left(function(d){return d.left+options.border;}).bottom(function(d){return d.bottom+options.border;}).height(function(d){return d.height-options.border-topMargin;}).width(function(d){return d.width-2*options.border;}).fillStyle("white").add(pv.Label).text(function(d){return d.label;}).textAlign("center").left(function(d){return d.left+d.width/2;}).bottom(function(d){return d.bottom+d.height-options.headerFontsize-5+options.headerFontsize/5;}).font(options.headerFontsize+"px sans-serif").textStyle("white").fillStyle("blue");for(i=0;i<this.structArr.length;i++){var box=this.structArr[i];this.pvPanel.add(pv.Rule).data(box.subplot.hRules).left(function(d){return d.left;}).width(function(d){return d.width;}).bottom(function(d){return d.bottom;}).lineWidth(function(d){return d.lWidth;}).strokeStyle(myself.chart.options.boxplotColor);this.pvPanel.add(pv.Rule).data(box.subplot.vRules).left(function(d){return d.left;}).height(function(d){return d.height;}).bottom(function(d){return d.bottom;}).lineWidth(function(d){return d.lWidth;}).strokeStyle(myself.chart.options.boxplotColor);this.pvPanel.add(pv.Dot).data(box.subplot.marks).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).fillStyle(function(d){return d.color;});this.pvPanel.add(pv.Label).data(box.subplot.labels).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).font(function(d){return d.size;}).text(function(d){return d.text;}).textAlign("center").textStyle(function(d){return d.color;});}
if(options.perpConnector){this.pvPanel.add(pv.Rule).data(myself.vRules).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).height(function(d){return d.height;}).strokeStyle("black");this.pvPanel.add(pv.Rule).data(myself.hRules).left(function(d){return d.left;}).bottom(function(d){return d.bottom;}).width(function(d){return d.width;}).strokeStyle("black");}},applyExtensions:function(){this.extend(this.pvDataTree,"dataTree");}});return pvc;});
BaseComponent=Base.extend(Backbone.Events).extend({visible:true,isManaged:true,timerStart:0,timerSplit:0,elapsedSinceSplit:-1,elapsedSinceStart:-1,logColor:undefined,placeholder:function(selector){var ho=this.htmlObject;return ho?$("#"+ho+(selector?(" "+selector):"")):$();},focus:function(){try{this.placeholder("*:first").focus();}catch(ex){}},_doAutoFocus:function(){if(this.autoFocus){delete this.autoFocus;this.focus();}},clear:function(){this.placeholder().empty();},copyEvents:function(target,events){_.each(events,function(evt,evtName){var e=evt,tail=evt.tail;while((e=e.next)!==tail){target.on(evtName,e.callback,e.context);}})},clone:function(parameterRemap,componentRemap,htmlRemap){var that,dashboard,callbacks;dashboard=this.dashboard;callbacks=this._events;delete this.dashboard;delete this._events;that=$.extend(true,{},this);that.dashboard=this.dashboard=dashboard;this._events=callbacks;this.copyEvents(that,callbacks);if(that.parameters){that.parameters=that.parameters.map(function(param){if(param[1]in parameterRemap){return[param[0],parameterRemap[param[1]]];}else{return param;}});}
if(that.components){that.components=that.components.map(function(comp){if(comp in componentRemap){return componentRemap[comp];}else{return comp;}});}
that.htmlObject=!that.htmlObject?undefined:htmlRemap[that.htmlObject];if(that.listeners){that.listeners=that.listeners.map(function(param){if(param in parameterRemap){return parameterRemap[param];}else{return param;}});}
if(that.parameter&&that.parameter in parameterRemap){that.parameter=parameterRemap[that.parameter];}
return that;},getAddIn:function(slot,addIn){var type=typeof this.type=="function"?this.type():this.type;return Dashboards.getAddIn(type,slot,addIn);},hasAddIn:function(slot,addIn){var type=typeof this.type=="function"?this.type():this.type;return Dashboards.hasAddIn(type,slot,addIn);},getValuesArray:function(){var jXML;if(typeof(this.valuesArray)=='undefined'||this.valuesArray.length==0){if(typeof(this.queryDefinition)!='undefined'){var vid=(this.queryDefinition.queryType=="sql")?"sql":"none";if((this.queryDefinition.queryType=="mdx")&&(!this.valueAsId)){vid="mdx";}else if(this.queryDefinition.dataAccessId!==undefined&&!this.valueAsId){vid='cda';}
QueryComponent.makeQuery(this);var myArray=new Array();for(p in this.result)if(this.result.hasOwnProperty(p)){switch(vid){case"sql":myArray.push([this.result[p][0],this.result[p][1]]);break;case"mdx":myArray.push([this.result[p][1],this.result[p][0]]);break;case'cda':myArray.push([this.result[p][0],this.result[p][1]]);break;default:myArray.push([this.result[p][0],this.result[p][0]]);break;}}
return myArray;}else{var p=new Array(this.parameters?this.parameters.length:0);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=this.parameters[i][1]==""||this.parameters[i][1]=="NIL"?this.parameters[i][2]:Dashboards.getParameterValue(this.parameters[i][1]);p[i]=[key,value];}
var myself=this;if(this.url){var arr={};$.each(p,function(i,val){arr[val[0]]=val[1];});jXML=Dashboards.parseXActionResult(myself,Dashboards.urlAction(this.url,arr));}else{jXML=Dashboards.callPentahoAction(myself,this.solution,this.path,this.action,p,null);}
var myArray=this.parseArray(jXML,false);return myArray;}}else{return this.valuesArray;}},parseArray:function(jData,includeHeader){if(jData===null){return[];}
if($(jData).find("CdaExport").length>0){return this.parseArrayCda(jData,includeHeader);}
var myArray=new Array();var jHeaders=$(jData).find("COLUMN-HDR-ITEM");if(includeHeader&&jHeaders.length>0){var _a=new Array();jHeaders.each(function(){_a.push($(this).text());});myArray.push(_a);}
var jDetails=$(jData).find("DATA-ROW");jDetails.each(function(){var _a=new Array();$(this).children("DATA-ITEM").each(function(){_a.push($(this).text());});myArray.push(_a);});return myArray;},parseArrayCda:function(jData,includeHeader){var myArray=new Array();var jHeaders=$(jData).find("ColumnMetaData");if(jHeaders.length>0){if(includeHeader){var _a=new Array();jHeaders.each(function(){_a.push($(this).attr("name"));});myArray.push(_a);}}
var jDetails=$(jData).find("Row");jDetails.each(function(){var _a=new Array();$(this).children("Col").each(function(){_a.push($(this).text());});myArray.push(_a);});return myArray;},setAddInDefaults:function(slot,addIn,defaults){Dashboards.log("BaseComponent.setAddInDefaults was removed. You should call setAddInOptions or Dashboards.setAddInDefaults");},setAddInOptions:function(slot,addIn,options){if(!this.addInOptions){this.addInOptions={};}
if(!this.addInOptions[slot]){this.addInOptions[slot]={};}
this.addInOptions[slot][addIn]=options},getAddInOptions:function(slot,addIn){var opts=null;try{opts=this.addInOptions[slot][addIn];}catch(e){}
return opts||{};},startTimer:function(){this.timerStart=new Date();this.timerSplit=new Date();},splitTimer:function(){if(this.elapsedSinceStart===-1||this.elapsedSinceSplit===-1){this.startTimer();}
var now=new Date();this.elapsedSinceStart=now.getTime()-this.timerStart.getTime();this.elapsedSinceSplit=now.getTime()-this.timerSplit.getTime();this.timerSplit=now;return this.getTimerInfo();},formatTimeDisplay:function(t){return Math.log(t)/Math.log(10)>=3?Math.round(t/100)/10+"s":t+"ms";},getTimerInfo:function(){return{timerStart:this.timerStart,timerSplit:this.timerSplit,elapsedSinceStart:this.elapsedSinceStart,elapsedSinceStartDesc:this.formatTimeDisplay(this.elapsedSinceStart),elapsedSinceSplit:this.elapsedSinceSplit,elapsedSinceSplitDesc:this.formatTimeDisplay(this.elapsedSinceSplit)}},getLogColor:function(){if(this.logColor){return this.logColor;}
else{var hashCode=function(str){var hash=0;if(str.length==0)return hash;for(i=0;i<str.length;i++){var chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash=hash&hash;}
return hash;}
var hash=hashCode(this.name).toString();var hueSeed=hash.substr(hash.length-6,2)||0;var saturationSeed=hash.substr(hash.length-2,2)||0;var valueSeed=hash.substr(hash.length-4,2)||0;this.logColor=Dashboards.hsvToRgb(360/100*hueSeed,75/100*saturationSeed,45+(80-45)/100*valueSeed);return this.logColor;}}});var TextComponent=BaseComponent.extend({update:function(){this.placeholder().html(this.expression());}});var CommentsComponent=BaseComponent.extend({processing:function(){var myself={};myself.defaults={dataTemplates:{comments:'<div class="commentsDetails">'+' {{#user}} {{{user}}}, {{/user}} {{{createdOn}}}'+'</div>'+'<div class="commentsBody">'+' <div class="comment">'+'   {{{comment}}}'+' </div>'+' {{#user}}'+' <div class="operation">'+' {{#permissions.deletePermission}}'+'   <div class="delete">X</div>'+' {{/permissions.deletePermission}}'+' {{#permissions.archive}}'+'  <div class="archive">X</div>'+' {{/permissions.archive}}'+' </div>'+' {{/user}}'+'</div>',addComments:'<div class="commentsAdd">'+'{{#add}}'+' <div class="addComment">Add Comment</div>'+' <div class="addCommentWrapper">'+'   <textarea class=addCommentText></textarea>'+'   <div class="commentsButtons">'+'   <div class="saveComment disabled">Save</div>'+'   <div class="cancelComment">Cancel</div>'+'   </div>'+' </div>'+'{{/add}}'+'</div>',paginateComments:'<div class="paginate commentPaginate"> '+'{{#active}}'+' <div class="navigateRefresh"> Refresh </div>'+' <div class="navigatePrevious"> Newest Comments </div>'+' <div class="navigateNext"> Oldest Comments </div>'+'{{/active}}'+'</div>'}};myself.operations={processOperation:function(operation,comment,collection,callback,defaults){var options={};switch(operation){case'LIST_ALL':options={data:{action:'list',page:defaults.page,firstResult:defaults.paginate.firstResult,maxResults:defaults.paginate.maxResults,where:false}};break;case'LIST_ACTIVE':options={data:{action:'list',page:defaults.page,firstResult:defaults.paginate.firstResult,maxResults:defaults.paginate.maxResults}};break;case'GET_LAST':options={data:{action:'list',page:defaults.page,firstResult:0,maxResults:1}};break;case'DELETE_COMMENT':options={data:{action:'delete',page:defaults.page,commentId:comment}};break;case'ARCHIVE_COMMENT':options={data:{action:'archive',page:defaults.page,commentId:comment}};break;case'ADD_COMMENT':options={data:{action:'add',page:defaults.page,comment:comment}};break;}
this.requestProcessing(options,operation,collection,callback);},requestProcessing:function(options,operation,collection,callback){var myself=this;options=options||{};var ajaxOpts={type:'GET',url:wd.cdf.endpoints.getComments(operation),success:function(data){myself.requestResponse(data,operation,collection,callback)},dataType:'json'};ajaxOpts=_.extend({},ajaxOpts,options);$.ajax(ajaxOpts);},resetCollection:function(result){var paginate=myself.options.paginate;var start=paginate.activePageNumber*paginate.pageCommentsSize;var end=((start+paginate.pageCommentsSize)<result.length)?(start+paginate.pageCommentsSize):result.length;var commentsArray=[];for(var idx=start;idx<end;idx++){var singleComment=new myself.CommentModel(result[idx]);commentsArray.push(singleComment)}
return commentsArray;},requestResponse:function(json,operation,collection,callback){if((operation=='LIST_ALL')||(operation=='LIST_ACTIVE')){var paginate=myself.options.paginate;if(paginate.activePageNumber>0){if((paginate.activePageNumber+1)>Math.ceil(json.result.length/paginate.pageCommentsSize))
paginate.activePageNumber--;}
myself.options.queryResult=json.result;collection.reset(this.resetCollection(json.result));if((paginate.activePageNumber==0)&&((json)&&(typeof json.result!='undefined'))&&(json.result.length==0)){json.result=[{id:0,comment:'No Comments to show!',createdOn:'',elapsedMinutes:'',isArchived:false,isDeleted:false,isMe:true,page:'',user:'',permissions:{add:false,archive:false,remove:false}}];if((collection)&&(typeof collection!='undefined')){collection.reset(this.resetCollection(json.result));}}}
if((callback)&&(typeof callback!='undefined')){callback.apply(this,[json,collection]);}}};myself.CommentModel=Backbone.Model.extend({defaults:{id:0,comment:'Guest User',createdOn:'',elapsedMinutes:'',isArchived:false,isDeleted:false,isMe:true,page:'comments',user:'comments',permissions:{}},initialize:function(){this.set('permissions',myself.options.permissions);}});myself.CommentView=Backbone.View.extend({tagName:'div',className:'commentView',events:{"click .delete":"deleteComment","click .archive":"archiveComment"},initialize:function(model){_.bindAll(this,'render','deleteComment','archiveComment');this.model=model;},render:function(){this.$el.append(Mustache.render(myself.defaults.dataTemplates.comments,this.attributes));return this.$el;},deleteComment:function(){var callback=function(data,collection){myself.operations.processOperation('LIST_ACTIVE',null,collection,null,myself.options);};myself.operations.processOperation('DELETE_COMMENT',this.model.get('id'),this.model.collection,callback,myself.options);},archiveComment:function(){var callback=function(data,collection){myself.operations.processOperation('LIST_ACTIVE',null,collection,null,myself.options);};myself.operations.processOperation('ARCHIVE_COMMENT',this.model.get('id'),this.model.collection,callback,myself.options);}});myself.CommentsCollection=Backbone.Collection.extend({model:myself.CommentModel});myself.CommentsView=Backbone.View.extend({tagName:'div',className:'commentComponent',events:{"click .addComment":"addComment","click .saveComment.enabled":"saveComment","click .cancelComment":"cancelComment","click .navigatePrevious.enabled":"navigatePrevious","click .navigateNext.enabled":"navigateNext","click .navigateRefresh":"navigateRefresh"},initialize:function(collection){_.bindAll(this,'render','addComment','saveComment','cancelComment','renderSingeComment','addComment','saveComment','cancelComment','navigateNext','navigatePrevious','commentsUpdateNotification');this.collection=collection;this.collection.on('reset',this.renderComments,this);this.collection.on('commentsUpdateNotification',this.commentsUpdateNotification);this.render();},renderComments:function(){var $commentsElem=$('#'+myself.options.htmlObject+' > div .commentsGroup');$commentsElem.empty();_(this.collection.models).each(function(comment){$commentsElem.append(this.renderSingeComment(comment));},this);},render:function(){var $renderElem=$('#'+myself.options.htmlObject);var $commentsElem=$('<div/>').addClass('commentsGroup');_(this.collection.models).each(function(comment){$commentsElem.append(this.renderSingeComment(comment));},this);var $add=$(Mustache.render(myself.defaults.dataTemplates.addComments,myself.options.permissions));this.bindSaveToTextArea($add);var $paginate=$(Mustache.render(myself.defaults.dataTemplates.paginateComments,myself.options.paginate));this.$el.empty().append($commentsElem,$add,$paginate);$renderElem.html(this.$el);this.updateNavigateButtons();},bindSaveToTextArea:function($elem){var $area=$elem.find(".addCommentText");var $save=$elem.find(".saveComment");var myself=this;$area.keyup(function(event){if($area.val().length!=0){myself.toggleElement($save,true);}else{myself.toggleElement($save,false);}});},renderSingeComment:function(comment){var singleCommentView=new myself.CommentView(comment);return singleCommentView.render();},addComment:function(){this.showAddComment();},saveComment:function(){var self=this;var text=this.$el.find('.addCommentText').val();var callback=function(data,collection){self.hideAddComment();var paginate=myself.options.paginate;paginate.activePageNumber=0;myself.operations.processOperation('LIST_ACTIVE',null,collection,null,myself.options);};myself.operations.processOperation('ADD_COMMENT',text,this.collection,callback,myself.options);},cancelComment:function(){this.hideAddComment();},navigateNext:function(){var paginate=myself.options.paginate;var start=paginate.activePageNumber*paginate.pageCommentsSize;if((start+paginate.pageCommentsSize)<myself.options.queryResult.length){paginate.activePageNumber++;this.collection.reset(myself.operations.resetCollection(myself.options.queryResult));}
this.commentsUpdateNotification();this.updateNavigateButtons();},navigatePrevious:function(){var paginate=myself.options.paginate;var start=paginate.activePageNumber;if(paginate.activePageNumber>0){paginate.activePageNumber--;this.collection.reset(myself.operations.resetCollection(myself.options.queryResult));}
this.commentsUpdateNotification();this.updateNavigateButtons();},navigateRefresh:function(){var paginate=myself.options.paginate;myself.options.paginate.activePageNumber=0;myself.operations.processOperation('LIST_ACTIVE',null,this.collection,null,myself.options);this.$el.find('div.navigateRefreshPopup:first').remove();this.$el.find('div.navigateRefresh:first').stop();},updateNavigateButtons:function(){var paginate=myself.options.paginate;this.toggleElement(this.$el.find('.navigatePrevious'),false);this.toggleElement(this.$el.find('.navigateNext'),false);if(paginate.activePageNumber>0){this.toggleElement(this.$el.find('.navigatePrevious'),true);}
if((paginate.activePageNumber+1)<Math.ceil(myself.options.queryResult.length/paginate.pageCommentsSize)){this.toggleElement(this.$el.find('.navigateNext'),true);}},toggleElement:function($elem,val){$elem.toggleClass("disabled",!val);$elem.toggleClass("enabled",!!val);},commentsUpdateNotification:function(){if(myself.options.queryResult.length>0){var lastCommentDate=myself.options.queryResult[0].createdOn;var callback=function(data){if(data.result.length>0){if(!!(data.result[0].createdOn==lastCommentDate)){}else{var refreshBtn=this.$el.find('div.navigateRefresh:first');if(!(this.$el.find('div.navigateRefreshPopup:first').length)){var popup=$("<div>").attr('class','navigateRefreshPopup').css('position','absolute').html('New comments, please refresh!').hide();refreshBtn.prepend(popup);var refreshBtnPos=refreshBtn.position();popup.offset({top:refreshBtnPos.top-(popup.height()+refreshBtn.height()/2),left:refreshBtnPos.left+refreshBtn.width()/2-popup.width()/2}).toggle("bounce",{times:3},"slow");var btnHighlighter=setInterval(function(){refreshBtn.effect('highlight',{color:'#c0c0c0'},2000);},4000);refreshBtn.on('click',function(){clearInterval(btnHighlighter);});}}}}
myself.operations.processOperation('GET_LAST',null,null,_.bind(callback,this),myself.options);}},showAddComment:function(){this.$el.find('.addCommentWrapper').show();this.$el.find('.paginate').hide();this.$el.find('.addCommentText').val('');this.toggleElement(this.$el.find('.saveComment'),false);},hideAddComment:function(){this.$el.find('.addCommentWrapper').hide();this.$el.find('.paginate').show();this.$el.find('.addCommentText').val('');this.toggleElement(this.$el.find('.saveComment'),false);}});myself.start=function(options){myself.options=options;myself.defaults=_.extend({},myself.defaults,options.defaults);myself.commentsCollection=new myself.CommentsCollection();myself.operations.processOperation('LIST_ACTIVE',null,myself.commentsCollection,null,myself.options);myself.commentsView=new myself.CommentsView(myself.commentsCollection);if(myself.options.intervalActive){var refresh=function(){myself.operations.processOperation('LIST_ACTIVE',null,myself.commentsCollection,null,myself.options);}
setInterval(function(){myself.commentsCollection.trigger('commentsUpdateNotification');},myself.options.interval);}};return myself;},update:function(){this.paginateActive=(typeof this.paginate=='undefined')?true:this.paginate;this.pageCommentsSize=(typeof this.pageCommentsSize=='undefined')?10:this.pageCommentsSize;this.firstResult=(typeof this.firstResult=='undefined')?0:this.firstResult;this.maxResults=(typeof this.maxResults=='undefined')?100:this.maxResults;this.interval=(typeof this.interval=='undefined')?60000:this.interval;this.intervalActive=(typeof this.intervalActive=='undefined')?true:this.intervalActive;this.addPermission=(typeof this.addPermission=='undefined')?true:this.addPermission;this.deletePermission=(typeof this.deletePermission=='undefined')?false:this.deletePermission;this.archivePermission=(typeof this.archivePermission=='undefined')?true:this.archivePermission;this.options=(typeof this.options=='undefined')?{}:this.options;if(this.page==undefined){Dashboards.log("Fatal - no page definition passed","error");return;}
options={htmlObject:this.htmlObject,page:this.page,intervalActive:this.intervalActive,interval:this.interval,paginate:{active:this.paginateActive,activePageNumber:0,pageCommentsSize:this.pageCommentsSize,firstResult:this.firstResult,maxResults:this.maxResults},permissions:{add:this.addPermission,deletePermission:this.deletePermission,archive:this.archivePermission},defaults:this.options}
this.processing().start(options);}});var MdxQueryGroupComponent=BaseComponent.extend({visible:false,update:function(){OlapUtils.updateMdxQueryGroup(this);}});var ManagedFreeformComponent=BaseComponent.extend({update:function(){this.customfunction(this.parameters||[]);}});var UnmanagedComponent=BaseComponent.extend({isManaged:false,isRunning:false,isDataPush:false,preExec:function(isDataPush){if(isDataPush){this.isDataPush=true;}
if(typeof this.runCounter=="undefined"){this.runCounter=0;}
var ret;if(typeof this.preExecution=="function"){try{ret=this.preExecution();ret=typeof ret=="undefined"||ret;}catch(e){this.error(Dashboards.getErrorObj('COMPONENT_ERROR').msg,e);this.dashboard.log(e,"error");ret=false;}}else{ret=true;}
this.trigger('cdf cdf:preExecution',this,ret);if(!ret){this.isDataPush=false;}
return ret;},postExec:function(){if(typeof this.postExecution=="function"){this.postExecution();}
this.trigger('cdf cdf:postExecution',this);this.isDataPush=false;},drawTooltip:function(){if(this.tooltip){this._tooltip=typeof this.tooltip=="function"?this.tooltip():this.tooltip;}},showTooltip:function(){if(typeof this._tooltip!="undefined"){this.placeholder().attr("title",this._tooltip).tooltip({delay:0,track:true,fade:250,content:this._tooltip});}},synchronous:function(callback,args){if(!this.preExec()){return;}
var silent=this.isSilent();if(!silent){this.block();}
setTimeout(_.bind(function(){try{callback.call(this,args||[]);this.drawTooltip();this.postExec();this.showTooltip();}catch(e){this.error(Dashboards.getErrorObj('COMPONENT_ERROR').msg,e);this.dashboard.log(e,"error");}finally{if(!silent){this.unblock();}}},this),10);},triggerQuery:function(queryDef,callback,userQueryOptions){if(!this.preExec()){return;}
var silent=this.isSilent();if(!silent){this.block();};userQueryOptions=userQueryOptions||{};var success=_.bind(function(data){callback(data);this.postExec();},this);var always=_.bind(function(){if(!silent){this.unblock();}},this);var handler=this.getSuccessHandler(success,always),errorHandler=this.getErrorHandler();var query=this.queryState=this.query=Dashboards.getQuery(this._resolveQueryDefinition(queryDef));var ajaxOptions={async:true}
if(userQueryOptions.ajax){_.extend(ajaxOptions,userQueryOptions.ajax);}
query.setAjaxOptions(ajaxOptions);if(userQueryOptions.pageSize){query.setPageSize(userQueryOptions.pageSize);}
query.fetchData(this.parameters,handler,errorHandler);},_resolveQueryDefinition:function(queryDef){var queryDefinition;if(_.isFunction(this.getQueryDefinition)){queryDefinition=this.getQueryDefinition();}
return this._isValidQueryDefinition(queryDefinition)?queryDefinition:(_.isFunction(queryDef)?queryDef():queryDef);},_isValidQueryDefinition:function(queryDef){return _.isObject(queryDef)&&!_.isArray(queryDef)&&!_.isEmpty(queryDef)&&!_.isString(queryDef);},getQueryDefinition:function(){return this.queryDefinition||this.chartDefinition||this.trafficDefinition;},triggerAjax:function(url,params,callback,_ajaxParameters){if(!this.preExec()){return;}
var silent=this.isSilent();if(!silent){this.block();};var ajaxParameters=$.extend({async:true},_ajaxParameters);if(typeof callback!="function"){callback=params;_.extend(ajaxParameters,url);}else{_.extend(ajaxParameters,{url:url,data:params});}
var success=_.bind(function(data){callback(data);this.trigger('cdf cdf:render',this,data);this.postExec();},this);var always=_.bind(function(){if(!silent){this.unblock();}},this);ajaxParameters.success=this.getSuccessHandler(success,always);ajaxParameters.error=this.getErrorHandler();jQuery.ajax(ajaxParameters);},callCounter:function(){return++this.runCounter;},error:function(msg,cause){msg=msg||Dashboards.getErrorObj('COMPONENT_ERROR').msg;if(!this.isSilent()){this.unblock();};this.errorNotification({error:cause,msg:msg});this.trigger("cdf cdf:error",this,msg,cause||null);this.isDataPush=false;},getSuccessHandler:function(counter,success,always){if(arguments.length===1){success=counter;counter=this.callCounter();}else if(typeof counter=='function'){always=success;success=counter;counter=this.callCounter();}
return _.bind(function(data,isDataPush){if(isDataPush){if(!this.preExec(true)){return;}}
var newData;if(counter>=this.runCounter){try{if(typeof this.postFetch=="function"){newData=this.postFetch(data);this.trigger('cdf cdf:postFetch',this,data);data=typeof newData=="undefined"?data:newData;}
success(data);}catch(e){this.error(Dashboards.getErrorObj('COMPONENT_ERROR').msg,e);this.dashboard.log(e,"error");}}
if(typeof always=="function"){always();}
return data;},this);},getErrorHandler:function(){function fetchDataErrorHandler(resp,txtStatus,error,isDataPush){if(isDataPush){if(!this.preExec(true)){return;}}
var err=Dashboards.parseServerError.call(this,resp,txtStatus,error);this.error(err.msg,err.error);}
return _.bind(fetchDataErrorHandler,this);},errorNotification:function(err,ph){ph=ph||(this.htmlObject?this.placeholder():undefined);var name=this.name.replace('render_','');err.msg=err.msg+' ('+name+')';Dashboards.errorNotification(err,ph);},block:function(){if(!this.isRunning){this.dashboard.incrementRunningCalls();this.isRunning=true;}},unblock:function(){if(this.isRunning){this.dashboard.decrementRunningCalls();this.isRunning=false;}},isSilent:function(){return this.lifecycle?!!this.lifecycle.silent:false;}});var QueryComponent=UnmanagedComponent.extend({visible:false,update:function(){var myself=this;if(myself.warnOnce){myself.warnOnce();}
var cd=myself.queryDefinition;var asyncMode=myself.asynchronousMode||false;var redraw=_.bind(myself.render,myself);if(cd==null){Dashboards.log("Fatal - No query definition passed","error");return;}
if(asyncMode){this.triggerQuery(cd,redraw);}else{QueryComponent.makeQuery(myself,function(values){var changedValues;if((typeof(myself.postFetch)=='function')){changedValues=myself.postFetch(values);}
if(changedValues!=null){values=changedValues;}
myself.result=values.resultset!=undefined?values.resultset:values;if(typeof values.resultset!="undefined"){myself.metadata=values.metadata;myself.queryInfo=values.queryInfo;}
myself.synchronous(redraw,values);});}},render:function(data){if(this.resultvar!=null){Dashboards.setParameter(this.resultvar,data.resultset);}},warnOnce:function(){Dashboards.log("Warning: QueryComponent behaviour is due to change. See "+"http://www.webdetails.org/redmine/projects/cdf/wiki/QueryComponent"+" for more information");delete(this.warnOnce);}},{makeQuery:function(object,successCallback){if(this.warnOnce){this.warnOnce();}
var cd=object.queryDefinition;if(cd==undefined){Dashboards.log("Fatal - No query definition passed","error");return;}
var query=Dashboards.getQuery(cd);object.queryState=query;query.setAjaxOptions({async:false});if(!successCallback){successCallback=function(values){var changedValues=undefined;if((typeof(object.postFetch)=='function')){changedValues=object.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
if(object.resultvar!=undefined){Dashboards.setParameter(object.resultvar,object.result);}
object.result=values.resultset!=undefined?values.resultset:values;if(typeof values.resultset!="undefined"){object.metadata=values.metadata;object.queryInfo=values.queryInfo;}}}
query.fetchData(object.parameters,successCallback);}});var FreeformComponent=UnmanagedComponent.extend({update:function(){var render=_.bind(this.render,this);if(typeof this.manageCallee=="undefined"||this.manageCallee){this.synchronous(render);}else{render();}},render:function(){var parameters=this.parameters||[];this.customfunction(parameters);}});var ActionComponent=UnmanagedComponent.extend({_docstring:function(){return"Abstract class for components calling a query/endpoint";},update:function(){var render=_.bind(this.render,this);if(_.isUndefined(this.manageCallee)||this.manageCallee){this.synchronous(render);}else{render();}},triggerAction:function(){var params=Dashboards.propertiesArrayToObject(this.actionParameters),failureCallback=(this.failureCallback)?this.failureCallback:function(){},successCallback=this.successCallback?this.successCallback:function(){};var success=_.bind(function(){this.unblock();successCallback.apply(this,arguments);},this);var failure=_.bind(function(){this.unblock();failureCallback.apply(this,arguments);},this);this.block();return Dashboards.getQuery(this.actionDefinition).fetchData(params,success,failure);},hasAction:function(){if(!this.actionDefinition){return false;}
if(Dashboards.detectQueryType){return!!Dashboards.detectQueryType(this.actionDefinition);}else{return!!this.actionDefinition.queryType&&Dashboards.hasQuery(this.actionDefinition.queryType);}}});
var DashboardsMap={markers:null,data:new Array(),dataIdx:0,messageElementId:null,selectedPointDetails:null,mapExpression:null,useMercator:'true',showToolTip:'false',search:function(object,idx){var record=this.data[idx];var place=record[1];var lat=place[0];var log=place[1];var placeDesc=place[2];if(!(lat==''||log=='')){return DashboardsMap.getLocation({totalResultsCount:1,geonames:[{lat:lat,lng:log}]});}
var url='http://nominatim.openstreetmap.org/search';var data={format:'json',limit:'1',q:placeDesc};var success=function(result){var jData;if(result&&result.length>0){jData={totalResultsCount:result.length,geonames:[{lng:result[0].lon,lat:result[0].lat}]};}else{jData={totalResultsCount:0,geonames:[]};}
DashboardsMap.getLocation(jData);};$.getJSON(url,data,success);},resetSearch:function(){map.removeLayer(markers);markers.destroy();markers=new OpenLayers.Layer.Markers("Markers");map.addLayer(markers);this.cleanMessages();dataIdx=0;this.data=new Array();},getLocation:function(jData){var record=this.data[dataIdx++];if(jData==null||jData.totalResultsCount==0){var placeNotFound=record[0];this.addMessage(placeNotFound);}
else{var geoname=jData.geonames[0];var marker=record[4];var icon=record[5];record[6]=geoname.lng;record[7]=geoname.lat;var marker=this.showMarker(marker,record);record[4]=marker;}
if(dataIdx>=this.data.length&&dataIdx>1){var extent=markers.getDataExtent();map.zoomToExtent(extent);}
if(dataIdx>=this.data.length&&dataIdx==1){map.setCenter(markers.markers[0].lonlat,4,false,false);}},showMarker:function(oldMarker,record){var icon;var size;var lon=record[6];var lat=record[7];if(record[5]instanceof Array){var icon_array=record[5];icon=icon_array[0];size=new OpenLayers.Size(icon_array[1],icon_array[2])}
else{icon=record[5];size=new OpenLayers.Size(21,25);}
var offset=new OpenLayers.Pixel(-(size.w/2),-size.h);var iconObj=new OpenLayers.Icon(icon,size,offset);if(this.useMercator=='true'){marker=new OpenLayers.Marker(lonLatToMercator(new OpenLayers.LonLat(lon,lat)),iconObj);feature=new OpenLayers.Feature(markers,lonLatToMercator(new OpenLayers.LonLat(lon,lat)),record);}else{marker=new OpenLayers.Marker(new OpenLayers.LonLat(lon,lat),iconObj);feature=new OpenLayers.Feature(markers,new OpenLayers.LonLat(lon,lat),record);}
feature.marker=marker;marker.events.register('mousedown',feature,DashboardsMap.marker_click);if(this.showToolTip=='true'){marker.events.register('mouseover',feature,DashboardsMap.marker_over);marker.events.register('mouseout',feature,DashboardsMap.marker_out);ttips=new OpenLayers.Control.ToolTips({bgColor:"black",textColor:"white",bold:true,opacity:0.50});map.addControl(ttips);}
markers.addMarker(marker);return marker;},marker_click:function(evt){click_lonlat=this.lonlat;var record=this.data;if(DashboardsMap.showToolTip=='true'){ttips.hide();}
Dashboards.fireChange("selectedPoint",record[0]);},marker_over:function(evt){record=this.data;ttips.show({html:record[0]+': '+record[2]});},marker_out:function(evt){ttips.hide();},updateInfoWindow:function(content){if(content!=null){var html=$(content).text();show_bubble(click_lonlat,html);}},updateMap:function(){var n=this.data.length;for(idx=0;idx<n;idx++){var value=this.data[idx][2];var markers=this.mapMarkers;var icon=eval(this.mapExpression);var marker=this.data[idx][4];this.data[idx][5]=icon;this.data[idx][4]=this.showMarker(marker,this.data[idx]);}},addMessage:function(msg){if(this.messageElementId!=undefined)
document.getElementById(this.messageElementId).innerHTML=document.getElementById(this.messageElementId).innerHTML+msg+"\n <br />";},cleanMessages:function(msg){if(this.messageElementId!=undefined)
document.getElementById(this.messageElementId).innerHTML="";}};var MapComponent=BaseComponent.extend({initMap:true,update:function(){var div='map';if(this.mapDiv!=null){div=this.mapDiv;}
var b_layer_control=true;var b_custom_map=false;var b_use_mercator=true;var str_custom_map="";if(this.showLayerSelector==false){b_layer_control=this.showLayerSelector}
if(this.showCustomMap){b_custom_map='true';str_custom_map=this.customMapCode}
if(this.useMercator==false){b_use_mercator='false'
DashboardsMap.useMercator='false';}
if(this.showToolTip==true){DashboardsMap.showToolTip='true';}else{DashboardsMap.showToolTip='false';}
if(this.initMap){init_map(div,this.initPosLon,this.initPosLat,this.initZoom,b_use_mercator,b_layer_control,b_custom_map,str_custom_map);DashboardsMap.messageElementId=this.messageElementId;this.initMap=false;}
DashboardsMap.resetSearch();var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);p[i]=[key,value];}
html=Dashboards.pentahoAction(this.solution,this.path,this.action,p,null);var myArray=this.parseArray(html,true);var len=myArray.length;if(len>1){var cols=myArray[0];var colslength=cols.length;for(var i=1;i<len;i++){var details;if(colslength>4){details=new Array(colslength-4);for(var j=4;j<colslength;j++){details[j-4]=[cols[j],myArray[i][j]];}}
var value=myArray[i][4];var markers=this.markers;DashboardsMap.mapExpression=this.expression();DashboardsMap.mapMarkers=markers;var icon=eval(this.expression());DashboardsMap.data.push(new Array(myArray[i][0],new Array(myArray[i][1],myArray[i][2],myArray[i][3]),value,details,null,icon,null,null));DashboardsMap.search(this,DashboardsMap.data.length-1);}}}});var MapBubbleComponent=BaseComponent.extend({update:function(){DashboardsMap.selectedPointDetails=null;for(var i=0;i<DashboardsMap.data.length;i++){if(Dashboards.getParameterValue("selectedPoint")==DashboardsMap.data[i][0]){DashboardsMap.selectedPointDetails=DashboardsMap.data[i][3];break;}}
var parameters=Dashboards.clone(DashboardsMap.selectedPointDetails);if(this.parameters!=undefined){var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);parameters.push([key,value]);}}
DashboardsMap.updateInfoWindow(Dashboards.pentahoAction(this.solution,this.path,this.action,parameters,null));}});
var SimpleAutoCompleteComponent=BaseComponent.extend({ph:undefined,completionCallback:undefined,update:function(){var myself=this;if(myself.ph==undefined){myself.ph=$("#"+myself.htmlObject).empty();myself.input=$("<input type='text'>").appendTo(myself.ph);myself.query=Dashboards.getQuery(myself.queryDefinition);myself.input.autocomplete({source:function(obj,callback){return myself.triggerQuery(obj.term,callback);}});myself.input.change(function(){Dashboards.processChange(myself.name);}).keyup(function(event){if(event.keyCode==13){Dashboards.processChange(myself.name);}});}},getList:function(values){if(typeof this.postFetch=="function"){var changedValues=this.postFetch(values);values=changedValues||values;}
return values.resultset.map(function(e){return e[0];});},handleQuery:function(callback){var myself=this;return function(values){var list=myself.getList(values);callback(list);};},triggerQuery:function(term,callback){var params=$.extend([],this.parameters);var searchParam=this.searchParam||"searchBox";if(searchParam=="searchBox"){this.query.setSearchPattern(term);}else{params.push([this.searchParam,term]);}
if(term.length>=this.minTextLength){this.query.fetchData(params,this.handleQuery(callback));}else{callback([]);}},getValue:function(){return this.input.val();}});
(function(){var $,Chosen,get_side_border_padding,root;var __bind=function(fn,me){return function(){return fn.apply(me,arguments);};};root=this;$=jQuery;$.fn.extend({chosen:function(data,options){if($.browser==="msie"&&($.browser.version==="6.0"||$.browser.version==="7.0")){return this;}
return $(this).each(function(input_field){if(!($(this)).hasClass("chzn-done")){return new Chosen(this,data,options);}});}});Chosen=(function(){function Chosen(elmn){this.set_default_values();this.form_field=elmn;this.form_field_jq=$(this.form_field);this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?"Select Some Options":"Select an Option";this.set_up_html();this.register_observers();this.form_field_jq.addClass("chzn-done");}
Chosen.prototype.set_default_values=function(){this.click_test_action=__bind(function(evt){return this.test_active_click(evt);},this);this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;return this.choices=0;};Chosen.prototype.set_up_html=function(){var container_div,dd_top,dd_width,sf_width;this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,'_'):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.width();this.default_text=this.form_field_jq.data('placeholder')?this.form_field_jq.data('placeholder'):this.default_text_default;container_div=$("<div />",{id:this.container_id,"class":"chzn-container "+(this.is_rtl?'chzn-rtl':''),style:'width: '+this.f_width+'px;'});if(this.is_multiple){container_div.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>');}else{container_div.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>');}
this.form_field_jq.hide().after(container_div);this.container=$('#'+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));this.dropdown=this.container.find('div.chzn-drop').first();dd_top=this.container.height();dd_width=this.f_width-get_side_border_padding(this.dropdown);this.dropdown.css({"width":dd_width+"px","top":dd_top+"px"});this.search_field=this.container.find('input').first();this.search_results=this.container.find('ul.chzn-results').first();this.search_field_scale();this.search_no_results=this.container.find('li.no-results').first();if(this.is_multiple){this.search_choices=this.container.find('ul.chzn-choices').first();this.search_container=this.container.find('li.search-field').first();}else{this.search_container=this.container.find('div.chzn-search').first();this.selected_item=this.container.find('.chzn-single').first();sf_width=dd_width-get_side_border_padding(this.search_container)-get_side_border_padding(this.search_field);this.search_field.css({"width":sf_width+"px"});}
this.results_build();return this.set_tab_index();};Chosen.prototype.register_observers=function(){this.container.mousedown(__bind(function(evt){return this.container_mousedown(evt);},this));this.container.mouseenter(__bind(function(evt){return this.mouse_enter(evt);},this));this.container.mouseleave(__bind(function(evt){return this.mouse_leave(evt);},this));this.search_results.mouseup(__bind(function(evt){return this.search_results_mouseup(evt);},this));this.search_results.mouseover(__bind(function(evt){return this.search_results_mouseover(evt);},this));this.search_results.mouseout(__bind(function(evt){return this.search_results_mouseout(evt);},this));this.form_field_jq.bind("liszt:updated",__bind(function(evt){return this.results_update_field(evt);},this));this.search_field.blur(__bind(function(evt){return this.input_blur(evt);},this));this.search_field.keyup(__bind(function(evt){return this.keyup_checker(evt);},this));this.search_field.keydown(__bind(function(evt){return this.keydown_checker(evt);},this));if(this.is_multiple){this.search_choices.click(__bind(function(evt){return this.choices_click(evt);},this));return this.search_field.focus(__bind(function(evt){return this.input_focus(evt);},this));}else{return this.selected_item.focus(__bind(function(evt){return this.activate_field(evt);},this));}};Chosen.prototype.container_mousedown=function(evt){if(evt&&evt.type==="mousedown"){evt.stopPropagation();}
if(!this.pending_destroy_click){if(!this.active_field){if(this.is_multiple){this.search_field.val("");}
$(document).click(this.click_test_action);this.results_show();}else if(!this.is_multiple&&evt&&($(evt.target)===this.selected_item||$(evt.target).parents("a.chzn-single").length)){evt.preventDefault();this.results_toggle();}
return this.activate_field();}else{return this.pending_destroy_click=false;}};Chosen.prototype.mouse_enter=function(){return this.mouse_on_container=true;};Chosen.prototype.mouse_leave=function(){return this.mouse_on_container=false;};Chosen.prototype.input_focus=function(evt){if(!this.active_field){return setTimeout((__bind(function(){return this.container_mousedown();},this)),50);}};Chosen.prototype.input_blur=function(evt){if(!this.mouse_on_container){this.active_field=false;return setTimeout((__bind(function(){return this.blur_test();},this)),100);}};Chosen.prototype.blur_test=function(evt){if(!this.active_field&&this.container.hasClass("chzn-container-active")){return this.close_field();}};Chosen.prototype.close_field=function(){$(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1);}
this.active_field=false;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale();};Chosen.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1);}
this.container.addClass("chzn-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus();};Chosen.prototype.test_active_click=function(evt){if($(evt.target).parents('#'+this.container_id).length){return this.active_field=true;}else{return this.close_field();}};Chosen.prototype.results_build=function(){var content,data,startTime,_i,_len,_ref;startTime=new Date();this.parsing=true;this.results_data=root.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0;}else if(!this.is_multiple){this.selected_item.find("span").text(this.default_text);}
content='';_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){data=_ref[_i];if(data.group){content+=this.result_add_group(data);}else if(!data.empty){content+=this.result_add_option(data);if(data.selected&&this.is_multiple){this.choice_build(data);}else if(data.selected&&!this.is_multiple){this.selected_item.find("span").text(data.text);}}}
this.show_search_field_default();this.search_field_scale();this.search_results.html(content);return this.parsing=false;};Chosen.prototype.result_add_group=function(group){if(!group.disabled){group.dom_id=this.container_id+"_g_"+group.array_index;return'<li id="'+group.dom_id+'" class="group-result">'+$("<div />").text(group.label).html()+'</li>';}else{return"";}};Chosen.prototype.result_add_option=function(option){var classes;if(!option.disabled){option.dom_id=this.container_id+"_o_"+option.array_index;classes=option.selected&&this.is_multiple?[]:["active-result"];if(option.selected){classes.push("result-selected");}
if(option.group_array_index!=null){classes.push("group-option");}
return'<li id="'+option.dom_id+'" class="'+classes.join(' ')+'">'+option.html+'</li>';}else{return"";}};Chosen.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build();};Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){this.result_clear_highlight();this.result_highlight=el;this.result_highlight.addClass("highlighted");maxHeight=parseInt(this.search_results.css("maxHeight"),10);visible_top=this.search_results.scrollTop();visible_bottom=maxHeight+visible_top;high_top=this.result_highlight.position().top+this.search_results.scrollTop();high_bottom=high_top+this.result_highlight.outerHeight();if(high_bottom>=visible_bottom){return this.search_results.scrollTop((high_bottom-maxHeight)>0?high_bottom-maxHeight:0);}else if(high_top<visible_top){return this.search_results.scrollTop(high_top);}}};Chosen.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted");}
return this.result_highlight=null;};Chosen.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide();}else{return this.results_show();}};Chosen.prototype.results_show=function(){var dd_top;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");if(this.result_single_selected){this.result_do_highlight(this.result_single_selected);}}
dd_top=this.is_multiple?this.container.height():this.container.height()-1;this.dropdown.css({"top":dd_top+"px","left":0});this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results();};Chosen.prototype.results_hide=function(){if(!this.is_multiple){this.selected_item.removeClass("chzn-single-with-drop");}
this.result_clear_highlight();this.dropdown.css({"left":"-9000px"});return this.results_showing=false;};Chosen.prototype.set_tab_index=function(el){var ti;if(this.form_field_jq.attr("tabindex")){ti=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple){return this.search_field.attr("tabindex",ti);}else{this.selected_item.attr("tabindex",ti);return this.search_field.attr("tabindex",-1);}}};Chosen.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default");}else{this.search_field.val("");return this.search_field.removeClass("default");}};Chosen.prototype.search_results_mouseup=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target.length){this.result_highlight=target;return this.result_select(evt);}};Chosen.prototype.search_results_mouseover=function(evt){var target;target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first();if(target){return this.result_do_highlight(target);}};Chosen.prototype.search_results_mouseout=function(evt){if($(evt.target).hasClass("active-result"||$(evt.target).parents('.active-result').first())){return this.result_clear_highlight();}};Chosen.prototype.choices_click=function(evt){evt.preventDefault();var tgt=$(evt.target);if(this.active_field&&!(tgt.hasClass("search-choice"||tgt.parents('.search-choice').first))&&!this.results_showing&&!(tgt.siblings("a").first().hasClass("search-choice-close"))){return this.results_show();}};Chosen.prototype.choice_build=function(item){var choice_id,link;choice_id=this.container_id+"_c_"+item.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+choice_id+'"><span>'+item.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+item.array_index+'"></a></li>');link=$('#'+choice_id);return link.click(__bind(function(evt){return this.choice_destroy_link_click(evt);},this));};Chosen.prototype.choice_destroy_link_click=function(evt){evt.preventDefault();this.pending_destroy_click=true;return this.choice_destroy($(evt.target));};Chosen.prototype.choice_destroy=function(link){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&this.choices>0&&this.search_field.val().length<1){this.results_hide();}
var tmp=link.attr("rel");if(typeof tmp==="undefined"){link=link.siblings("a").first();}
this.result_deselect(link.attr("rel"));return link.parents('li').first().remove();};Chosen.prototype.result_select=function(evt){var high,high_id,item,position;if(this.result_highlight){high=this.result_highlight;high_id=high.attr("id");this.result_clear_highlight();high.addClass("result-selected");if(this.is_multiple){this.result_deactivate(high);}else{this.result_single_selected=high;}
position=high_id.substr(high_id.lastIndexOf("_")+1);item=this.results_data[position];item.selected=true;this.form_field.options[item.options_index].selected=true;if(this.is_multiple){this.choice_build(item);}else{this.selected_item.find("span").first().text(item.text);}
if(!(evt.metaKey&&this.is_multiple)){this.results_hide();}
this.search_field.val("");this.form_field_jq.trigger("change");return this.search_field_scale();}};Chosen.prototype.result_activate=function(el){return el.addClass("active-result").show();};Chosen.prototype.result_deactivate=function(el){return el.removeClass("active-result").hide();};Chosen.prototype.result_deselect=function(pos){var result,result_data;result_data=this.results_data[pos];result_data.selected=false;this.form_field.options[result_data.options_index].selected=false;result=$("#"+this.container_id+"_o_"+pos);result.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale();};Chosen.prototype.results_search=function(evt){if(this.results_showing){return this.winnow_results();}else{return this.results_show();}};Chosen.prototype.winnow_results=function(){var found,option,part,parts,regex,result_id,results,searchText,startTime,startpos,text,zregex,_i,_j,_len,_len2,_ref;startTime=new Date();this.no_results_clear();results=0;searchText=this.search_field.val()===this.default_text?"":$('<div/>').text($.trim(this.search_field.val())).html();regex=new RegExp('^'+searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');zregex=new RegExp(searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),'i');_ref=this.results_data;for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];if(!option.disabled&&!option.empty){if(option.group){$('#'+option.dom_id).hide();}else if(!(this.is_multiple&&option.selected)){found=false;result_id=option.dom_id;if(regex.test(option.html)){found=true;results+=1;}else if(option.html.indexOf(" ")>=0||option.html.indexOf("[")===0){parts=option.html.replace(/\[|\]/g,"").split(" ");if(parts.length){for(_j=0,_len2=parts.length;_j<_len2;_j++){part=parts[_j];if(regex.test(part)){found=true;results+=1;}}}}
if(found){if(searchText.length){startpos=option.html.search(zregex);text=option.html.substr(0,startpos+searchText.length)+'</em>'+option.html.substr(startpos+searchText.length);text=text.substr(0,startpos)+'<em>'+text.substr(startpos);}else{text=option.html;}
if($("#"+result_id).html!==text){$("#"+result_id).html(text);}
this.result_activate($("#"+result_id));if(option.group_array_index!=null){$("#"+this.results_data[option.group_array_index].dom_id).show();}}else{if(this.result_highlight&&result_id===this.result_highlight.attr('id')){this.result_clear_highlight();}
this.result_deactivate($("#"+result_id));}}}}
if(results<1&&searchText.length){return this.no_results(searchText);}else{return this.winnow_results_set_highlight();}};Chosen.prototype.winnow_results_clear=function(){var li,lis,_i,_len,_results;this.search_field.val("");lis=this.search_results.find("li");_results=[];for(_i=0,_len=lis.length;_i<_len;_i++){li=lis[_i];li=$(li);_results.push(li.hasClass("group-result")?li.show():!this.is_multiple||!li.hasClass("result-selected")?this.result_activate(li):void 0);}
return _results;};Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;if(!this.result_highlight){selected_results=!this.is_multiple?this.search_results.find(".result-selected"):[];do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first();if(do_high!=null){return this.result_do_highlight(do_high);}}};Chosen.prototype.no_results=function(terms){var no_results_html;no_results_html=$('<li class="no-results">No results match "<span></span>"</li>');no_results_html.find("span").first().html(terms);return this.search_results.append(no_results_html);};Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove();};Chosen.prototype.keydown_arrow=function(){var first_active,next_sib;if(!this.result_highlight){first_active=this.search_results.find("li.active-result").first();if(first_active){this.result_do_highlight($(first_active));}}else if(this.results_showing){next_sib=this.result_highlight.nextAll("li.active-result").first();if(next_sib){this.result_do_highlight(next_sib);}}
if(!this.results_showing){return this.results_show();}};Chosen.prototype.keyup_arrow=function(){var prev_sibs;if(!this.results_showing&&!this.is_multiple){return this.results_show();}else if(this.result_highlight){prev_sibs=this.result_highlight.prevAll("li.active-result");if(prev_sibs.length){return this.result_do_highlight(prev_sibs.first());}else{if(this.choices>0){this.results_hide();}
return this.result_clear_highlight();}}};Chosen.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke();}else{this.pending_backstroke=this.search_container.siblings("li.search-choice").last();return this.pending_backstroke.addClass("search-choice-focus");}};Chosen.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus");}
return this.pending_backstroke=null;};Chosen.prototype.keyup_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();switch(stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0){return this.keydown_backstroke();}else if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search();}
break;case 13:evt.preventDefault();if(this.results_showing){return this.result_select(evt);}
break;case 27:if(this.results_showing){return this.results_hide();}
break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search();}};Chosen.prototype.keydown_checker=function(evt){var stroke,_ref;stroke=(_ref=evt.which)!=null?_ref:evt.keyCode;this.search_field_scale();if(stroke!==8&&this.pending_backstroke){this.clear_backstroke();}
switch(stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=false;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow();break;}};Chosen.prototype.search_field_scale=function(){var dd_top,div,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){h=0;w=0;style_block="position:absolute; left: -1000px; top: -1000px; display:none;";styles=['font-size','font-style','font-weight','font-family','line-height','text-transform','letter-spacing'];for(_i=0,_len=styles.length;_i<_len;_i++){style=styles[_i];style_block+=style+":"+this.search_field.css(style)+";";}
div=$('<div />',{'style':style_block});div.text(this.search_field.val());$('body').append(div);w=div.width()+25;div.remove();if(w>this.f_width-10){w=this.f_width-10;}
this.search_field.css({'width':w+'px'});dd_top=this.container.height();return this.dropdown.css({"top":dd_top+"px"});}};Chosen.prototype.generate_field_id=function(){var new_id;new_id=this.generate_random_id();this.form_field.id=new_id;return new_id;};Chosen.prototype.generate_random_id=function(){var string;string="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while($("#"+string).length>0){string+=this.generate_random_char();}
return string;};Chosen.prototype.generate_random_char=function(){var chars,newchar,rand;chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";rand=Math.floor(Math.random()*chars.length);return newchar=chars.substring(rand,rand+1);};return Chosen;})();get_side_border_padding=function(elmt){var side_border_padding;return side_border_padding=elmt.outerWidth()-elmt.width();};root.get_side_border_padding=get_side_border_padding;}).call(this);(function(){var SelectParser;SelectParser=(function(){function SelectParser(){this.options_index=0;this.parsed=[];}
SelectParser.prototype.add_node=function(child){if(child.nodeName==="OPTGROUP"){return this.add_group(child);}else{return this.add_option(child);}};SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;group_position=this.parsed.length;this.parsed.push({array_index:group_position,group:true,label:group.label,children:0,disabled:group.disabled});_ref=group.childNodes;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){option=_ref[_i];_results.push(this.add_option(option,group_position,group.disabled));}
return _results;};SelectParser.prototype.add_option=function(option,group_position,group_disabled){if(option.nodeName==="OPTION"){if(option.text!==""){if(group_position!=null){this.parsed[group_position].children+=1;}
this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===true?group_disabled:option.disabled,group_array_index:group_position});}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true});}
return this.options_index+=1;}};return SelectParser;})();SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;parser=new SelectParser();_ref=select.childNodes;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];parser.add_node(child);}
return parser.parsed;};this.SelectParser=SelectParser;}).call(this);
(function($){if(typeof $.fn.each2=="undefined"){$.extend($.fn,{each2:function(c){var j=$([0]),i=-1,l=this.length;while(++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==false);return this;}});}})(jQuery);(function($,undefined){"use strict";if(window.Select2!==undefined){return;}
var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,lastMousePosition={x:0,y:0},$document,scrollBarDimensions,KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){k=k.which?k.which:k;switch(k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return true;}
return false;},isControl:function(e){var k=e.which;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return true;}
if(e.metaKey)return true;return false;},isFunctionKey:function(k){k=k.which?k.which:k;return k>=112&&k<=123;}},MEASURE_SCROLLBAR_TEMPLATE="<div class='select2-measure-scrollbar'></div>",DIACRITICS={"\u24B6":"A","\uFF21":"A","\u00C0":"A","\u00C1":"A","\u00C2":"A","\u1EA6":"A","\u1EA4":"A","\u1EAA":"A","\u1EA8":"A","\u00C3":"A","\u0100":"A","\u0102":"A","\u1EB0":"A","\u1EAE":"A","\u1EB4":"A","\u1EB2":"A","\u0226":"A","\u01E0":"A","\u00C4":"A","\u01DE":"A","\u1EA2":"A","\u00C5":"A","\u01FA":"A","\u01CD":"A","\u0200":"A","\u0202":"A","\u1EA0":"A","\u1EAC":"A","\u1EB6":"A","\u1E00":"A","\u0104":"A","\u023A":"A","\u2C6F":"A","\uA732":"AA","\u00C6":"AE","\u01FC":"AE","\u01E2":"AE","\uA734":"AO","\uA736":"AU","\uA738":"AV","\uA73A":"AV","\uA73C":"AY","\u24B7":"B","\uFF22":"B","\u1E02":"B","\u1E04":"B","\u1E06":"B","\u0243":"B","\u0182":"B","\u0181":"B","\u24B8":"C","\uFF23":"C","\u0106":"C","\u0108":"C","\u010A":"C","\u010C":"C","\u00C7":"C","\u1E08":"C","\u0187":"C","\u023B":"C","\uA73E":"C","\u24B9":"D","\uFF24":"D","\u1E0A":"D","\u010E":"D","\u1E0C":"D","\u1E10":"D","\u1E12":"D","\u1E0E":"D","\u0110":"D","\u018B":"D","\u018A":"D","\u0189":"D","\uA779":"D","\u01F1":"DZ","\u01C4":"DZ","\u01F2":"Dz","\u01C5":"Dz","\u24BA":"E","\uFF25":"E","\u00C8":"E","\u00C9":"E","\u00CA":"E","\u1EC0":"E","\u1EBE":"E","\u1EC4":"E","\u1EC2":"E","\u1EBC":"E","\u0112":"E","\u1E14":"E","\u1E16":"E","\u0114":"E","\u0116":"E","\u00CB":"E","\u1EBA":"E","\u011A":"E","\u0204":"E","\u0206":"E","\u1EB8":"E","\u1EC6":"E","\u0228":"E","\u1E1C":"E","\u0118":"E","\u1E18":"E","\u1E1A":"E","\u0190":"E","\u018E":"E","\u24BB":"F","\uFF26":"F","\u1E1E":"F","\u0191":"F","\uA77B":"F","\u24BC":"G","\uFF27":"G","\u01F4":"G","\u011C":"G","\u1E20":"G","\u011E":"G","\u0120":"G","\u01E6":"G","\u0122":"G","\u01E4":"G","\u0193":"G","\uA7A0":"G","\uA77D":"G","\uA77E":"G","\u24BD":"H","\uFF28":"H","\u0124":"H","\u1E22":"H","\u1E26":"H","\u021E":"H","\u1E24":"H","\u1E28":"H","\u1E2A":"H","\u0126":"H","\u2C67":"H","\u2C75":"H","\uA78D":"H","\u24BE":"I","\uFF29":"I","\u00CC":"I","\u00CD":"I","\u00CE":"I","\u0128":"I","\u012A":"I","\u012C":"I","\u0130":"I","\u00CF":"I","\u1E2E":"I","\u1EC8":"I","\u01CF":"I","\u0208":"I","\u020A":"I","\u1ECA":"I","\u012E":"I","\u1E2C":"I","\u0197":"I","\u24BF":"J","\uFF2A":"J","\u0134":"J","\u0248":"J","\u24C0":"K","\uFF2B":"K","\u1E30":"K","\u01E8":"K","\u1E32":"K","\u0136":"K","\u1E34":"K","\u0198":"K","\u2C69":"K","\uA740":"K","\uA742":"K","\uA744":"K","\uA7A2":"K","\u24C1":"L","\uFF2C":"L","\u013F":"L","\u0139":"L","\u013D":"L","\u1E36":"L","\u1E38":"L","\u013B":"L","\u1E3C":"L","\u1E3A":"L","\u0141":"L","\u023D":"L","\u2C62":"L","\u2C60":"L","\uA748":"L","\uA746":"L","\uA780":"L","\u01C7":"LJ","\u01C8":"Lj","\u24C2":"M","\uFF2D":"M","\u1E3E":"M","\u1E40":"M","\u1E42":"M","\u2C6E":"M","\u019C":"M","\u24C3":"N","\uFF2E":"N","\u01F8":"N","\u0143":"N","\u00D1":"N","\u1E44":"N","\u0147":"N","\u1E46":"N","\u0145":"N","\u1E4A":"N","\u1E48":"N","\u0220":"N","\u019D":"N","\uA790":"N","\uA7A4":"N","\u01CA":"NJ","\u01CB":"Nj","\u24C4":"O","\uFF2F":"O","\u00D2":"O","\u00D3":"O","\u00D4":"O","\u1ED2":"O","\u1ED0":"O","\u1ED6":"O","\u1ED4":"O","\u00D5":"O","\u1E4C":"O","\u022C":"O","\u1E4E":"O","\u014C":"O","\u1E50":"O","\u1E52":"O","\u014E":"O","\u022E":"O","\u0230":"O","\u00D6":"O","\u022A":"O","\u1ECE":"O","\u0150":"O","\u01D1":"O","\u020C":"O","\u020E":"O","\u01A0":"O","\u1EDC":"O","\u1EDA":"O","\u1EE0":"O","\u1EDE":"O","\u1EE2":"O","\u1ECC":"O","\u1ED8":"O","\u01EA":"O","\u01EC":"O","\u00D8":"O","\u01FE":"O","\u0186":"O","\u019F":"O","\uA74A":"O","\uA74C":"O","\u01A2":"OI","\uA74E":"OO","\u0222":"OU","\u24C5":"P","\uFF30":"P","\u1E54":"P","\u1E56":"P","\u01A4":"P","\u2C63":"P","\uA750":"P","\uA752":"P","\uA754":"P","\u24C6":"Q","\uFF31":"Q","\uA756":"Q","\uA758":"Q","\u024A":"Q","\u24C7":"R","\uFF32":"R","\u0154":"R","\u1E58":"R","\u0158":"R","\u0210":"R","\u0212":"R","\u1E5A":"R","\u1E5C":"R","\u0156":"R","\u1E5E":"R","\u024C":"R","\u2C64":"R","\uA75A":"R","\uA7A6":"R","\uA782":"R","\u24C8":"S","\uFF33":"S","\u1E9E":"S","\u015A":"S","\u1E64":"S","\u015C":"S","\u1E60":"S","\u0160":"S","\u1E66":"S","\u1E62":"S","\u1E68":"S","\u0218":"S","\u015E":"S","\u2C7E":"S","\uA7A8":"S","\uA784":"S","\u24C9":"T","\uFF34":"T","\u1E6A":"T","\u0164":"T","\u1E6C":"T","\u021A":"T","\u0162":"T","\u1E70":"T","\u1E6E":"T","\u0166":"T","\u01AC":"T","\u01AE":"T","\u023E":"T","\uA786":"T","\uA728":"TZ","\u24CA":"U","\uFF35":"U","\u00D9":"U","\u00DA":"U","\u00DB":"U","\u0168":"U","\u1E78":"U","\u016A":"U","\u1E7A":"U","\u016C":"U","\u00DC":"U","\u01DB":"U","\u01D7":"U","\u01D5":"U","\u01D9":"U","\u1EE6":"U","\u016E":"U","\u0170":"U","\u01D3":"U","\u0214":"U","\u0216":"U","\u01AF":"U","\u1EEA":"U","\u1EE8":"U","\u1EEE":"U","\u1EEC":"U","\u1EF0":"U","\u1EE4":"U","\u1E72":"U","\u0172":"U","\u1E76":"U","\u1E74":"U","\u0244":"U","\u24CB":"V","\uFF36":"V","\u1E7C":"V","\u1E7E":"V","\u01B2":"V","\uA75E":"V","\u0245":"V","\uA760":"VY","\u24CC":"W","\uFF37":"W","\u1E80":"W","\u1E82":"W","\u0174":"W","\u1E86":"W","\u1E84":"W","\u1E88":"W","\u2C72":"W","\u24CD":"X","\uFF38":"X","\u1E8A":"X","\u1E8C":"X","\u24CE":"Y","\uFF39":"Y","\u1EF2":"Y","\u00DD":"Y","\u0176":"Y","\u1EF8":"Y","\u0232":"Y","\u1E8E":"Y","\u0178":"Y","\u1EF6":"Y","\u1EF4":"Y","\u01B3":"Y","\u024E":"Y","\u1EFE":"Y","\u24CF":"Z","\uFF3A":"Z","\u0179":"Z","\u1E90":"Z","\u017B":"Z","\u017D":"Z","\u1E92":"Z","\u1E94":"Z","\u01B5":"Z","\u0224":"Z","\u2C7F":"Z","\u2C6B":"Z","\uA762":"Z","\u24D0":"a","\uFF41":"a","\u1E9A":"a","\u00E0":"a","\u00E1":"a","\u00E2":"a","\u1EA7":"a","\u1EA5":"a","\u1EAB":"a","\u1EA9":"a","\u00E3":"a","\u0101":"a","\u0103":"a","\u1EB1":"a","\u1EAF":"a","\u1EB5":"a","\u1EB3":"a","\u0227":"a","\u01E1":"a","\u00E4":"a","\u01DF":"a","\u1EA3":"a","\u00E5":"a","\u01FB":"a","\u01CE":"a","\u0201":"a","\u0203":"a","\u1EA1":"a","\u1EAD":"a","\u1EB7":"a","\u1E01":"a","\u0105":"a","\u2C65":"a","\u0250":"a","\uA733":"aa","\u00E6":"ae","\u01FD":"ae","\u01E3":"ae","\uA735":"ao","\uA737":"au","\uA739":"av","\uA73B":"av","\uA73D":"ay","\u24D1":"b","\uFF42":"b","\u1E03":"b","\u1E05":"b","\u1E07":"b","\u0180":"b","\u0183":"b","\u0253":"b","\u24D2":"c","\uFF43":"c","\u0107":"c","\u0109":"c","\u010B":"c","\u010D":"c","\u00E7":"c","\u1E09":"c","\u0188":"c","\u023C":"c","\uA73F":"c","\u2184":"c","\u24D3":"d","\uFF44":"d","\u1E0B":"d","\u010F":"d","\u1E0D":"d","\u1E11":"d","\u1E13":"d","\u1E0F":"d","\u0111":"d","\u018C":"d","\u0256":"d","\u0257":"d","\uA77A":"d","\u01F3":"dz","\u01C6":"dz","\u24D4":"e","\uFF45":"e","\u00E8":"e","\u00E9":"e","\u00EA":"e","\u1EC1":"e","\u1EBF":"e","\u1EC5":"e","\u1EC3":"e","\u1EBD":"e","\u0113":"e","\u1E15":"e","\u1E17":"e","\u0115":"e","\u0117":"e","\u00EB":"e","\u1EBB":"e","\u011B":"e","\u0205":"e","\u0207":"e","\u1EB9":"e","\u1EC7":"e","\u0229":"e","\u1E1D":"e","\u0119":"e","\u1E19":"e","\u1E1B":"e","\u0247":"e","\u025B":"e","\u01DD":"e","\u24D5":"f","\uFF46":"f","\u1E1F":"f","\u0192":"f","\uA77C":"f","\u24D6":"g","\uFF47":"g","\u01F5":"g","\u011D":"g","\u1E21":"g","\u011F":"g","\u0121":"g","\u01E7":"g","\u0123":"g","\u01E5":"g","\u0260":"g","\uA7A1":"g","\u1D79":"g","\uA77F":"g","\u24D7":"h","\uFF48":"h","\u0125":"h","\u1E23":"h","\u1E27":"h","\u021F":"h","\u1E25":"h","\u1E29":"h","\u1E2B":"h","\u1E96":"h","\u0127":"h","\u2C68":"h","\u2C76":"h","\u0265":"h","\u0195":"hv","\u24D8":"i","\uFF49":"i","\u00EC":"i","\u00ED":"i","\u00EE":"i","\u0129":"i","\u012B":"i","\u012D":"i","\u00EF":"i","\u1E2F":"i","\u1EC9":"i","\u01D0":"i","\u0209":"i","\u020B":"i","\u1ECB":"i","\u012F":"i","\u1E2D":"i","\u0268":"i","\u0131":"i","\u24D9":"j","\uFF4A":"j","\u0135":"j","\u01F0":"j","\u0249":"j","\u24DA":"k","\uFF4B":"k","\u1E31":"k","\u01E9":"k","\u1E33":"k","\u0137":"k","\u1E35":"k","\u0199":"k","\u2C6A":"k","\uA741":"k","\uA743":"k","\uA745":"k","\uA7A3":"k","\u24DB":"l","\uFF4C":"l","\u0140":"l","\u013A":"l","\u013E":"l","\u1E37":"l","\u1E39":"l","\u013C":"l","\u1E3D":"l","\u1E3B":"l","\u017F":"l","\u0142":"l","\u019A":"l","\u026B":"l","\u2C61":"l","\uA749":"l","\uA781":"l","\uA747":"l","\u01C9":"lj","\u24DC":"m","\uFF4D":"m","\u1E3F":"m","\u1E41":"m","\u1E43":"m","\u0271":"m","\u026F":"m","\u24DD":"n","\uFF4E":"n","\u01F9":"n","\u0144":"n","\u00F1":"n","\u1E45":"n","\u0148":"n","\u1E47":"n","\u0146":"n","\u1E4B":"n","\u1E49":"n","\u019E":"n","\u0272":"n","\u0149":"n","\uA791":"n","\uA7A5":"n","\u01CC":"nj","\u24DE":"o","\uFF4F":"o","\u00F2":"o","\u00F3":"o","\u00F4":"o","\u1ED3":"o","\u1ED1":"o","\u1ED7":"o","\u1ED5":"o","\u00F5":"o","\u1E4D":"o","\u022D":"o","\u1E4F":"o","\u014D":"o","\u1E51":"o","\u1E53":"o","\u014F":"o","\u022F":"o","\u0231":"o","\u00F6":"o","\u022B":"o","\u1ECF":"o","\u0151":"o","\u01D2":"o","\u020D":"o","\u020F":"o","\u01A1":"o","\u1EDD":"o","\u1EDB":"o","\u1EE1":"o","\u1EDF":"o","\u1EE3":"o","\u1ECD":"o","\u1ED9":"o","\u01EB":"o","\u01ED":"o","\u00F8":"o","\u01FF":"o","\u0254":"o","\uA74B":"o","\uA74D":"o","\u0275":"o","\u01A3":"oi","\u0223":"ou","\uA74F":"oo","\u24DF":"p","\uFF50":"p","\u1E55":"p","\u1E57":"p","\u01A5":"p","\u1D7D":"p","\uA751":"p","\uA753":"p","\uA755":"p","\u24E0":"q","\uFF51":"q","\u024B":"q","\uA757":"q","\uA759":"q","\u24E1":"r","\uFF52":"r","\u0155":"r","\u1E59":"r","\u0159":"r","\u0211":"r","\u0213":"r","\u1E5B":"r","\u1E5D":"r","\u0157":"r","\u1E5F":"r","\u024D":"r","\u027D":"r","\uA75B":"r","\uA7A7":"r","\uA783":"r","\u24E2":"s","\uFF53":"s","\u00DF":"s","\u015B":"s","\u1E65":"s","\u015D":"s","\u1E61":"s","\u0161":"s","\u1E67":"s","\u1E63":"s","\u1E69":"s","\u0219":"s","\u015F":"s","\u023F":"s","\uA7A9":"s","\uA785":"s","\u1E9B":"s","\u24E3":"t","\uFF54":"t","\u1E6B":"t","\u1E97":"t","\u0165":"t","\u1E6D":"t","\u021B":"t","\u0163":"t","\u1E71":"t","\u1E6F":"t","\u0167":"t","\u01AD":"t","\u0288":"t","\u2C66":"t","\uA787":"t","\uA729":"tz","\u24E4":"u","\uFF55":"u","\u00F9":"u","\u00FA":"u","\u00FB":"u","\u0169":"u","\u1E79":"u","\u016B":"u","\u1E7B":"u","\u016D":"u","\u00FC":"u","\u01DC":"u","\u01D8":"u","\u01D6":"u","\u01DA":"u","\u1EE7":"u","\u016F":"u","\u0171":"u","\u01D4":"u","\u0215":"u","\u0217":"u","\u01B0":"u","\u1EEB":"u","\u1EE9":"u","\u1EEF":"u","\u1EED":"u","\u1EF1":"u","\u1EE5":"u","\u1E73":"u","\u0173":"u","\u1E77":"u","\u1E75":"u","\u0289":"u","\u24E5":"v","\uFF56":"v","\u1E7D":"v","\u1E7F":"v","\u028B":"v","\uA75F":"v","\u028C":"v","\uA761":"vy","\u24E6":"w","\uFF57":"w","\u1E81":"w","\u1E83":"w","\u0175":"w","\u1E87":"w","\u1E85":"w","\u1E98":"w","\u1E89":"w","\u2C73":"w","\u24E7":"x","\uFF58":"x","\u1E8B":"x","\u1E8D":"x","\u24E8":"y","\uFF59":"y","\u1EF3":"y","\u00FD":"y","\u0177":"y","\u1EF9":"y","\u0233":"y","\u1E8F":"y","\u00FF":"y","\u1EF7":"y","\u1E99":"y","\u1EF5":"y","\u01B4":"y","\u024F":"y","\u1EFF":"y","\u24E9":"z","\uFF5A":"z","\u017A":"z","\u1E91":"z","\u017C":"z","\u017E":"z","\u1E93":"z","\u1E95":"z","\u01B6":"z","\u0225":"z","\u0240":"z","\u2C6C":"z","\uA763":"z","\u0386":"\u0391","\u0388":"\u0395","\u0389":"\u0397","\u038A":"\u0399","\u03AA":"\u0399","\u038C":"\u039F","\u038E":"\u03A5","\u03AB":"\u03A5","\u038F":"\u03A9","\u03AC":"\u03B1","\u03AD":"\u03B5","\u03AE":"\u03B7","\u03AF":"\u03B9","\u03CA":"\u03B9","\u0390":"\u03B9","\u03CC":"\u03BF","\u03CD":"\u03C5","\u03CB":"\u03C5","\u03B0":"\u03C5","\u03C9":"\u03C9","\u03C2":"\u03C3"};$document=$(document);nextUid=(function(){var counter=1;return function(){return counter++;};}());function reinsertElement(element){var placeholder=$(document.createTextNode(''));element.before(placeholder);placeholder.before(element);placeholder.remove();}
function stripDiacritics(str){function match(a){return DIACRITICS[a]||a;}
return str.replace(/[^\u0000-\u007E]/g,match);}
function indexOf(value,array){var i=0,l=array.length;for(;i<l;i=i+1){if(equal(value,array[i]))return i;}
return-1;}
function measureScrollbar(){var $template=$(MEASURE_SCROLLBAR_TEMPLATE);$template.appendTo('body');var dim={width:$template.width()-$template[0].clientWidth,height:$template.height()-$template[0].clientHeight};$template.remove();return dim;}
function equal(a,b){if(a===b)return true;if(a===undefined||b===undefined)return false;if(a===null||b===null)return false;if(a.constructor===String)return a+''===b+'';if(b.constructor===String)return b+''===a+'';return false;}
function splitVal(string,separator){var val,i,l;if(string===null||string.length<1)return[];val=string.split(separator);for(i=0,l=val.length;i<l;i=i+1)val[i]=$.trim(val[i]);return val;}
function getSideBorderPadding(element){return element.outerWidth(false)-element.width();}
function installKeyUpChangeEvent(element){var key="keyup-change-value";element.on("keydown",function(){if($.data(element,key)===undefined){$.data(element,key,element.val());}});element.on("keyup",function(){var val=$.data(element,key);if(val!==undefined&&element.val()!==val){$.removeData(element,key);element.trigger("keyup-change");}});}
function installFilteredMouseMove(element){element.on("mousemove",function(e){var lastpos=lastMousePosition;if(lastpos===undefined||lastpos.x!==e.pageX||lastpos.y!==e.pageY){$(e.target).trigger("mousemove-filtered",e);}});}
function debounce(quietMillis,fn,ctx){ctx=ctx||undefined;var timeout;return function(){var args=arguments;window.clearTimeout(timeout);timeout=window.setTimeout(function(){fn.apply(ctx,args);},quietMillis);};}
function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e);});element.on("scroll",function(e){if(indexOf(e.target,element.get())>=0)notify(e);});}
function focus($el){if($el[0]===document.activeElement)return;window.setTimeout(function(){var el=$el[0],pos=$el.val().length,range;$el.focus();var isVisible=(el.offsetWidth>0||el.offsetHeight>0);if(isVisible&&el===document.activeElement){if(el.setSelectionRange)
{el.setSelectionRange(pos,pos);}
else if(el.createTextRange){range=el.createTextRange();range.collapse(false);range.select();}}},0);}
function getCursorInfo(el){el=$(el)[0];var offset=0;var length=0;if('selectionStart'in el){offset=el.selectionStart;length=el.selectionEnd-offset;}else if('selection'in document){el.focus();var sel=document.selection.createRange();length=document.selection.createRange().text.length;sel.moveStart('character',-el.value.length);offset=sel.text.length-length;}
return{offset:offset,length:length};}
function killEvent(event){event.preventDefault();event.stopPropagation();}
function killEventImmediately(event){event.preventDefault();event.stopImmediatePropagation();}
function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"});sizer.attr("class","select2-sizer");$("body").append(sizer);}
sizer.text(e.val());return sizer.width();}
function syncCssClasses(dest,src,adapter){var classes,replacements=[],adapted;classes=$.trim(dest.attr("class"));if(classes){classes=''+classes;$(classes.split(/\s+/)).each2(function(){if(this.indexOf("select2-")===0){replacements.push(this);}});}
classes=$.trim(src.attr("class"));if(classes){classes=''+classes;$(classes.split(/\s+/)).each2(function(){if(this.indexOf("select2-")!==0){adapted=adapter(this);if(adapted){replacements.push(adapted);}}});}
dest.attr("class",replacements.join(" "));}
function markMatch(text,term,markup,escapeMarkup){var match=stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())),tl=term.length;if(match<0){markup.push(escapeMarkup(text));return;}
markup.push(escapeMarkup(text.substring(0,match)));markup.push("<span class='select2-match'>");markup.push(escapeMarkup(text.substring(match,match+tl)));markup.push("</span>");markup.push(escapeMarkup(text.substring(match+tl,text.length)));}
function defaultEscapeMarkup(markup){var replace_map={'\\':'&#92;','&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;',"/":'&#47;'};return String(markup).replace(/[&<>"'\/\\]/g,function(match){return replace_map[match];});}
function ajax(options){var timeout,handler=null,quietMillis=options.quietMillis||100,ajaxUrl=options.url,self=this;return function(query){window.clearTimeout(timeout);timeout=window.setTimeout(function(){var data=options.data,url=ajaxUrl,transport=options.transport||$.fn.select2.ajaxDefaults.transport,deprecated={type:options.type||'GET',cache:options.cache||false,jsonpCallback:options.jsonpCallback||undefined,dataType:options.dataType||"json"},params=$.extend({},$.fn.select2.ajaxDefaults.params,deprecated);data=data?data.call(self,query.term,query.page,query.context):null;url=(typeof url==='function')?url.call(self,query.term,query.page,query.context):url;if(handler&&typeof handler.abort==="function"){handler.abort();}
if(options.params){if($.isFunction(options.params)){$.extend(params,options.params.call(self));}else{$.extend(params,options.params);}}
$.extend(params,{url:url,dataType:options.dataType,data:data,success:function(data){var results=options.results(data,query.page,query);query.callback(results);}});handler=transport.call(self,params);},quietMillis);};}
function local(options){var data=options,dataText,tmp,text=function(item){return""+item.text;};if($.isArray(data)){tmp=data;data={results:tmp};}
if($.isFunction(data)===false){tmp=data;data=function(){return tmp;};}
var dataItem=data();if(dataItem.text){text=dataItem.text;if(!$.isFunction(text)){dataText=dataItem.text;text=function(item){return item[dataText];};}}
return function(query){var t=query.term,filtered={results:[]},process;if(t===""){query.callback(data());return;}
process=function(datum,collection){var group,attr;datum=datum[0];if(datum.children){group={};for(attr in datum){if(datum.hasOwnProperty(attr))group[attr]=datum[attr];}
group.children=[];$(datum.children).each2(function(i,childDatum){process(childDatum,group.children);});if(group.children.length||query.matcher(t,text(group),datum)){collection.push(group);}}else{if(query.matcher(t,text(datum),datum)){collection.push(datum);}}};$(data().results).each2(function(i,datum){process(datum,filtered.results);});query.callback(filtered);};}
function tags(data){var isFunc=$.isFunction(data);return function(query){var t=query.term,filtered={results:[]};var result=isFunc?data(query):data;if($.isArray(result)){$(result).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;if(t===""||query.matcher(t,text)){filtered.results.push(isObject?this:{id:this,text:this});}});query.callback(filtered);}};}
function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return true;if(!formatter)return false;if(typeof(formatter)==='string')return true;throw new Error(formatterName+" must be a string, function, or falsy value");}
function evaluate(val,context){if($.isFunction(val)){var args=Array.prototype.slice.call(arguments,2);return val.apply(context,args);}
return val;}
function countResults(results){var count=0;$.each(results,function(i,item){if(item.children){count+=countResults(item.children);}else{count++;}});return count;}
function defaultTokenizer(input,selection,selectCallback,opts){var original=input,dupe=false,token,index,i,l,separator;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;while(true){index=-1;for(i=0,l=opts.tokenSeparators.length;i<l;i++){separator=opts.tokenSeparators[i];index=input.indexOf(separator);if(index>=0)break;}
if(index<0)break;token=input.substring(0,index);input=input.substring(index+separator.length);if(token.length>0){token=opts.createSearchChoice.call(this,token,selection);if(token!==undefined&&token!==null&&opts.id(token)!==undefined&&opts.id(token)!==null){dupe=false;for(i=0,l=selection.length;i<l;i++){if(equal(opts.id(token),opts.id(selection[i]))){dupe=true;break;}}
if(!dupe)selectCallback(token);}}}
if(original!==input)return input;}
function cleanupJQueryElements(){var self=this;$.each(arguments,function(i,element){self[element].remove();self[element]=null;});}
function clazz(SuperClass,methods){var constructor=function(){};constructor.prototype=new SuperClass;constructor.prototype.constructor=constructor;constructor.prototype.parent=SuperClass.prototype;constructor.prototype=$.extend(constructor.prototype,methods);return constructor;}
AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments);};},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts);this.id=opts.id;if(opts.element.data("select2")!==undefined&&opts.element.data("select2")!==null){opts.element.data("select2").destroy();}
this.container=this.createContainer();this.liveRegion=$("<span>",{role:"status","aria-live":"polite"}).addClass("select2-hidden-accessible").appendTo(document.body);this.containerId="s2id_"+(opts.element.attr("id")||"autogen"+nextUid());this.containerEventName=this.containerId.replace(/([.])/g,'_').replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,'\\$1');this.container.attr("id",this.containerId);this.container.attr("title",opts.element.attr("title"));this.body=$("body");syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.attr("style",opts.element.attr("style"));this.container.css(evaluate(opts.containerCss,this.opts.element));this.container.addClass(evaluate(opts.containerCssClass,this.opts.element));this.elementTabIndex=this.opts.element.attr("tabindex");this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",killEvent);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(evaluate(opts.dropdownCssClass,this.opts.element));this.dropdown.data("select2",this);this.dropdown.on("click",killEvent);this.results=results=this.container.find(resultsSelector);this.search=search=this.container.find("input.select2-input");this.queryCount=0;this.resultsPage=0;this.context=null;this.initContainer();this.container.on("click",killEvent);installFilteredMouseMove(this.results);this.dropdown.on("mousemove-filtered",resultsSelector,this.bind(this.highlightUnderEvent));this.dropdown.on("touchstart touchmove touchend",resultsSelector,this.bind(function(event){this._touchEvent=true;this.highlightUnderEvent(event);}));this.dropdown.on("touchmove",resultsSelector,this.bind(this.touchMoved));this.dropdown.on("touchstart touchend",resultsSelector,this.bind(this.clearTouchMoved));this.dropdown.on('click',this.bind(function(event){if(this._touchEvent){this._touchEvent=false;this.selectHighlighted();}}));installDebouncedScroll(80,this.results);this.dropdown.on("scroll-debounced",resultsSelector,this.bind(this.loadMoreIfNeeded));$(this.container).on("change",".select2-input",function(e){e.stopPropagation();});$(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation();});if($.fn.mousewheel){results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop();if(deltaY>0&&top-deltaY<=0){results.scrollTop(0);killEvent(e);}else if(deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()){results.scrollTop(results.get(0).scrollHeight-results.height());killEvent(e);}});}
installKeyUpChangeEvent(search);search.on("keyup-change input paste",this.bind(this.updateResults));search.on("focus",function(){search.addClass("select2-focused");});search.on("blur",function(){search.removeClass("select2-focused");});this.dropdown.on("mouseup",resultsSelector,this.bind(function(e){if($(e.target).closest(".select2-result-selectable").length>0){this.highlightUnderEvent(e);this.selectHighlighted(e);}}));this.dropdown.on("click mouseup mousedown touchstart touchend focusin",function(e){e.stopPropagation();});this.nextSearchTerm=undefined;if($.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource();}
if(opts.maximumInputLength!==null){this.search.attr("maxlength",opts.maximumInputLength);}
var disabled=opts.element.prop("disabled");if(disabled===undefined)disabled=false;this.enable(!disabled);var readonly=opts.element.prop("readonly");if(readonly===undefined)readonly=false;this.readonly(readonly);scrollBarDimensions=scrollBarDimensions||measureScrollbar();this.autofocus=opts.element.prop("autofocus");opts.element.prop("autofocus",false);if(this.autofocus)this.focus();this.search.attr("placeholder",opts.searchInputPlaceholder);},destroy:function(){var element=this.opts.element,select2=element.data("select2");this.close();if(element.length&&element[0].detachEvent){element.each(function(){this.detachEvent("onpropertychange",this._sync);});}
if(this.propertyObserver){this.propertyObserver.disconnect();this.propertyObserver=null;}
this._sync=null;if(select2!==undefined){select2.container.remove();select2.liveRegion.remove();select2.dropdown.remove();element.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||false);if(this.elementTabIndex){element.attr({tabindex:this.elementTabIndex});}else{element.removeAttr("tabindex");}
element.show();}
cleanupJQueryElements.call(this,"container","liveRegion","dropdown","results","search");},optionToData:function(element){if(element.is("option")){return{id:element.prop("value"),text:element.text(),element:element.get(),css:element.attr("class"),disabled:element.prop("disabled"),locked:equal(element.attr("locked"),"locked")||equal(element.data("locked"),true)};}else if(element.is("optgroup")){return{text:element.attr("label"),children:[],element:element.get(),css:element.attr("class")};}},prepareOpts:function(opts){var element,select,idKey,ajaxUrl,self=this;element=opts.element;if(element.get(0).tagName.toLowerCase()==="select"){this.select=select=opts.element;}
if(select){$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.");}});}
opts=$.extend({},{populateResults:function(container,results,query){var populate,id=this.opts.id,liveRegion=this.liveRegion;populate=function(results,container,depth){var i,l,result,selectable,disabled,compound,node,label,innerContainer,formatted;results=opts.sortResults(results,container,query);var nodes=[];for(i=0,l=results.length;i<l;i=i+1){result=results[i];disabled=(result.disabled===true);selectable=(!disabled)&&(id(result)!==undefined);compound=result.children&&result.children.length>0;node=$("<li></li>");node.addClass("select2-results-dept-"+depth);node.addClass("select2-result");node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable");if(disabled){node.addClass("select2-disabled");}
if(compound){node.addClass("select2-result-with-children");}
node.addClass(self.opts.formatResultCssClass(result));node.attr("role","presentation");label=$(document.createElement("div"));label.addClass("select2-result-label");label.attr("id","select2-result-label-"+nextUid());label.attr("role","option");formatted=opts.formatResult(result,label,query,self.opts.escapeMarkup);if(formatted!==undefined){label.html(formatted);node.append(label);}
if(compound){innerContainer=$("<ul></ul>");innerContainer.addClass("select2-result-sub");populate(result.children,innerContainer,depth+1);node.append(innerContainer);}
node.data("select2-data",result);nodes.push(node[0]);}
container.append(nodes);liveRegion.text(opts.formatMatches(results.length));};populate(results,container,0);}},$.fn.select2.defaults,opts);if(typeof(opts.id)!=="function"){idKey=opts.id;opts.id=function(e){return e[idKey];};}
if($.isArray(opts.element.data("select2Tags"))){if("tags"in opts){throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+opts.element.attr("id");}
opts.tags=opts.element.data("select2Tags");}
if(select){opts.query=this.bind(function(query){var data={results:[],more:false},term=query.term,children,placeholderOption,process;process=function(element,collection){var group;if(element.is("option")){if(query.matcher(term,element.text(),element)){collection.push(self.optionToData(element));}}else if(element.is("optgroup")){group=self.optionToData(element);element.children().each2(function(i,elm){process(elm,group.children);});if(group.children.length>0){collection.push(group);}}};children=element.children();if(this.getPlaceholder()!==undefined&&children.length>0){placeholderOption=this.getPlaceholderOption();if(placeholderOption){children=children.not(placeholderOption);}}
children.each2(function(i,elm){process(elm,data.results);});query.callback(data);});opts.id=function(e){return e.id;};}else{if(!("query"in opts)){if("ajax"in opts){ajaxUrl=opts.element.data("ajax-url");if(ajaxUrl&&ajaxUrl.length>0){opts.ajax.url=ajaxUrl;}
opts.query=ajax.call(opts.element,opts.ajax);}else if("data"in opts){opts.query=local(opts.data);}else if("tags"in opts){opts.query=tags(opts.tags);if(opts.createSearchChoice===undefined){opts.createSearchChoice=function(term){return{id:$.trim(term),text:$.trim(term)};};}
if(opts.initSelection===undefined){opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator)).each(function(){var obj={id:this,text:this},tags=opts.tags;if($.isFunction(tags))tags=tags();$(tags).each(function(){if(equal(this.id,obj.id)){obj=this;return false;}});data.push(obj);});callback(data);};}}}}
if(typeof(opts.query)!=="function"){throw"query function not defined for Select2 "+opts.element.attr("id");}
if(opts.createSearchChoicePosition==='top'){opts.createSearchChoicePosition=function(list,item){list.unshift(item);};}
else if(opts.createSearchChoicePosition==='bottom'){opts.createSearchChoicePosition=function(list,item){list.push(item);};}
else if(typeof(opts.createSearchChoicePosition)!=="function"){throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";}
return opts;},monitorSource:function(){var el=this.opts.element,observer,self=this;el.on("change.select2",this.bind(function(e){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection();}}));this._sync=this.bind(function(){var disabled=el.prop("disabled");if(disabled===undefined)disabled=false;this.enable(!disabled);var readonly=el.prop("readonly");if(readonly===undefined)readonly=false;this.readonly(readonly);syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.addClass(evaluate(this.opts.containerCssClass,this.opts.element));syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(evaluate(this.opts.dropdownCssClass,this.opts.element));});if(el.length&&el[0].attachEvent){el.each(function(){this.attachEvent("onpropertychange",self._sync);});}
observer=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(observer!==undefined){if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null;}
this.propertyObserver=new observer(function(mutations){$.each(mutations,self._sync);});this.propertyObserver.observe(el.get(0),{attributes:true,subtree:false});}},triggerSelect:function(data){var evt=$.Event("select2-selecting",{val:this.id(data),object:data,choice:data});this.opts.element.trigger(evt);return!evt.isDefaultPrevented();},triggerChange:function(details){details=details||{};details=$.extend({},details,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(details);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();if(this.opts.blurOnChange)
this.opts.element.blur();},isInterfaceEnabled:function()
{return this.enabledInterface===true;},enableInterface:function(){var enabled=this._enabled&&!this._readonly,disabled=!enabled;if(enabled===this.enabledInterface)return false;this.container.toggleClass("select2-container-disabled",disabled);this.close();this.enabledInterface=enabled;return true;},enable:function(enabled){if(enabled===undefined)enabled=true;if(this._enabled===enabled)return;this._enabled=enabled;this.opts.element.prop("disabled",!enabled);this.enableInterface();},disable:function(){this.enable(false);},readonly:function(enabled){if(enabled===undefined)enabled=false;if(this._readonly===enabled)return;this._readonly=enabled;this.opts.element.prop("readonly",enabled);this.enableInterface();},opened:function(){return(this.container)?this.container.hasClass("select2-dropdown-open"):false;},positionDropdown:function(){var $dropdown=this.dropdown,offset=this.container.offset(),height=this.container.outerHeight(false),width=this.container.outerWidth(false),dropHeight=$dropdown.outerHeight(false),$window=$(window),windowWidth=$window.width(),windowHeight=$window.height(),viewPortRight=$window.scrollLeft()+windowWidth,viewportBottom=$window.scrollTop()+windowHeight,dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=(offset.top-dropHeight)>=$window.scrollTop(),dropWidth=$dropdown.outerWidth(false),enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight,aboveNow=$dropdown.hasClass("select2-drop-above"),bodyOffset,above,changeDirection,css,resultsListNode;if(aboveNow){above=true;if(!enoughRoomAbove&&enoughRoomBelow){changeDirection=true;above=false;}}else{above=false;if(!enoughRoomBelow&&enoughRoomAbove){changeDirection=true;above=true;}}
if(changeDirection){$dropdown.hide();offset=this.container.offset();height=this.container.outerHeight(false);width=this.container.outerWidth(false);dropHeight=$dropdown.outerHeight(false);viewPortRight=$window.scrollLeft()+windowWidth;viewportBottom=$window.scrollTop()+windowHeight;dropTop=offset.top+height;dropLeft=offset.left;dropWidth=$dropdown.outerWidth(false);enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight;$dropdown.show();this.focusSearch();}
if(this.opts.dropdownAutoWidth){resultsListNode=$('.select2-results',$dropdown)[0];$dropdown.addClass('select2-drop-auto-width');$dropdown.css('width','');dropWidth=$dropdown.outerWidth(false)+(resultsListNode.scrollHeight===resultsListNode.clientHeight?0:scrollBarDimensions.width);dropWidth>width?width=dropWidth:dropWidth=width;dropHeight=$dropdown.outerHeight(false);enoughRoomOnRight=dropLeft+dropWidth<=viewPortRight;}
else{this.container.removeClass('select2-drop-auto-width');}
if(this.body.css('position')!=='static'){bodyOffset=this.body.offset();dropTop-=bodyOffset.top;dropLeft-=bodyOffset.left;}
if(!enoughRoomOnRight){dropLeft=offset.left+this.container.outerWidth(false)-dropWidth;}
css={left:dropLeft,width:width};if(above){css.top=offset.top-dropHeight;css.bottom='auto';this.container.addClass("select2-drop-above");$dropdown.addClass("select2-drop-above");}
else{css.top=dropTop;css.bottom='auto';this.container.removeClass("select2-drop-above");$dropdown.removeClass("select2-drop-above");}
css=$.extend(css,evaluate(this.opts.dropdownCss,this.opts.element));$dropdown.css(css);},shouldOpen:function(){var event;if(this.opened())return false;if(this._enabled===false||this._readonly===true)return false;event=$.Event("select2-opening");this.opts.element.trigger(event);return!event.isDefaultPrevented();},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above");},open:function(){if(!this.shouldOpen())return false;this.opening();$document.on("mousemove.select2Event",function(e){lastMousePosition.x=e.pageX;lastMousePosition.y=e.pageY;});return true;},opening:function(){var cid=this.containerEventName,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid,mask;this.container.addClass("select2-dropdown-open").addClass("select2-container-active");this.clearDropdownAlignmentPreference();if(this.dropdown[0]!==this.body.children().last()[0]){this.dropdown.detach().appendTo(this.body);}
mask=$("#select2-drop-mask");if(mask.length==0){mask=$(document.createElement("div"));mask.attr("id","select2-drop-mask").attr("class","select2-drop-mask");mask.hide();mask.appendTo(this.body);mask.on("mousedown touchstart click",function(e){reinsertElement(mask);var dropdown=$("#select2-drop"),self;if(dropdown.length>0){self=dropdown.data("select2");if(self.opts.selectOnBlur){self.selectHighlighted({noFocus:true});}
self.close();e.preventDefault();e.stopPropagation();}});}
if(this.dropdown.prev()[0]!==mask[0]){this.dropdown.before(mask);}
$("#select2-drop").removeAttr("id");this.dropdown.attr("id","select2-drop");mask.show();this.positionDropdown();this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");var that=this;this.container.parents().add(window).each(function(){$(this).on(resize+" "+scroll+" "+orient,function(e){if(that.opened())that.positionDropdown();});});},close:function(){if(!this.opened())return;var cid=this.containerEventName,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid;this.container.parents().add(window).each(function(){$(this).off(scroll).off(resize).off(orient);});this.clearDropdownAlignmentPreference();$("#select2-drop-mask").hide();this.dropdown.removeAttr("id");this.dropdown.hide();this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");this.results.empty();$document.off("mousemove.select2Event");this.clearSearch();this.search.removeClass("select2-active");this.opts.element.trigger($.Event("select2-close"));},externalSearch:function(term){this.open();this.search.val(term);this.updateResults(false);},clearSearch:function(){},getMaximumSelectionSize:function(){return evaluate(this.opts.maximumSelectionSize,this.opts.element);},ensureHighlightVisible:function(){var results=this.results,children,index,child,hb,rb,y,more,topOffset;index=this.highlight();if(index<0)return;if(index==0){results.scrollTop(0);return;}
children=this.findHighlightableChoices().find('.select2-result-label');child=$(children[index]);topOffset=(child.offset()||{}).top||0;hb=topOffset+child.outerHeight(true);if(index===children.length-1){more=results.find("li.select2-more-results");if(more.length>0){hb=more.offset().top+more.outerHeight(true);}}
rb=results.offset().top+results.outerHeight(true);if(hb>rb){results.scrollTop(results.scrollTop()+(hb-rb));}
y=topOffset-results.offset().top;if(y<0&&child.css('display')!='none'){results.scrollTop(results.scrollTop()+y);}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)");},moveHighlight:function(delta){var choices=this.findHighlightableChoices(),index=this.highlight();while(index>-1&&index<choices.length){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")&&!choice.hasClass("select2-selected")){this.highlight(index);break;}}},highlight:function(index){var choices=this.findHighlightableChoices(),choice,data;if(arguments.length===0){return indexOf(choices.filter(".select2-highlighted")[0],choices.get());}
if(index>=choices.length)index=choices.length-1;if(index<0)index=0;this.removeHighlight();choice=$(choices[index]);choice.addClass("select2-highlighted");this.search.attr("aria-activedescendant",choice.find(".select2-result-label").attr("id"));this.ensureHighlightVisible();this.liveRegion.text(choice.text());data=choice.data("select2-data");if(data){this.opts.element.trigger({type:"select2-highlight",val:this.id(data),choice:data});}},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted");},touchMoved:function(){this._touchMoved=true;},clearTouchMoved:function(){this._touchMoved=false;},countSelectableResults:function(){return this.findHighlightableChoices().length;},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.findHighlightableChoices();this.highlight(choices.index(el));}else if(el.length==0){this.removeHighlight();}},loadMoreIfNeeded:function(){var results=this.results,more=results.find("li.select2-more-results"),below,page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;if(more.length===0)return;below=more.offset().top-results.offset().top-results.height();if(below<=this.opts.loadMorePadding){more.addClass("select2-active");this.opts.query({element:this.opts.element,term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){if(!self.opened())return;self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context});self.postprocessResults(data,false,false);if(data.more===true){more.detach().appendTo(results).text(evaluate(self.opts.formatLoadMore,self.opts.element,page+1));window.setTimeout(function(){self.loadMoreIfNeeded();},10);}else{more.remove();}
self.positionDropdown();self.resultsPage=page;self.context=data.context;this.opts.element.trigger({type:"select2-loaded",items:data});})});}},tokenize:function(){},updateResults:function(initial){var search=this.search,results=this.results,opts=this.opts,data,self=this,input,term=search.val(),lastTerm=$.data(this.container,"select2-last-term"),queryNumber;if(initial!==true&&lastTerm&&equal(term,lastTerm))return;$.data(this.container,"select2-last-term",term);if(initial!==true&&(this.showSearchInput===false||!this.opened())){return;}
function postRender(){search.removeClass("select2-active");self.positionDropdown();if(results.find('.select2-no-results,.select2-selection-limit,.select2-searching').length){self.liveRegion.text(results.text());}
else{self.liveRegion.text(self.opts.formatMatches(results.find('.select2-result-selectable').length));}}
function render(html){results.html(html);postRender();}
queryNumber=++this.queryCount;var maxSelSize=this.getMaximumSelectionSize();if(maxSelSize>=1){data=this.data();if($.isArray(data)&&data.length>=maxSelSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")){render("<li class='select2-selection-limit'>"+evaluate(opts.formatSelectionTooBig,opts.element,maxSelSize)+"</li>");return;}}
if(search.val().length<opts.minimumInputLength){if(checkFormatter(opts.formatInputTooShort,"formatInputTooShort")){render("<li class='select2-no-results'>"+evaluate(opts.formatInputTooShort,opts.element,search.val(),opts.minimumInputLength)+"</li>");}else{render("");}
if(initial&&this.showSearch)this.showSearch(true);return;}
if(opts.maximumInputLength&&search.val().length>opts.maximumInputLength){if(checkFormatter(opts.formatInputTooLong,"formatInputTooLong")){render("<li class='select2-no-results'>"+evaluate(opts.formatInputTooLong,opts.element,search.val(),opts.maximumInputLength)+"</li>");}else{render("");}
return;}
if(opts.formatSearching&&this.findHighlightableChoices().length===0){render("<li class='select2-searching'>"+evaluate(opts.formatSearching,opts.element)+"</li>");}
search.addClass("select2-active");this.removeHighlight();input=this.tokenize();if(input!=undefined&&input!=null){search.val(input);}
this.resultsPage=1;opts.query({element:opts.element,term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;if(queryNumber!=this.queryCount){return;}
if(!this.opened()){this.search.removeClass("select2-active");return;}
this.context=(data.context===undefined)?null:data.context;if(this.opts.createSearchChoice&&search.val()!==""){def=this.opts.createSearchChoice.call(self,search.val(),data.results);if(def!==undefined&&def!==null&&self.id(def)!==undefined&&self.id(def)!==null){if($(data.results).filter(function(){return equal(self.id(this),self.id(def));}).length===0){this.opts.createSearchChoicePosition(data.results,def);}}}
if(data.results.length===0&&checkFormatter(opts.formatNoMatches,"formatNoMatches")){render("<li class='select2-no-results'>"+evaluate(opts.formatNoMatches,opts.element,search.val())+"</li>");return;}
results.empty();self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null});if(data.more===true&&checkFormatter(opts.formatLoadMore,"formatLoadMore")){results.append("<li class='select2-more-results'>"+opts.escapeMarkup(evaluate(opts.formatLoadMore,opts.element,this.resultsPage))+"</li>");window.setTimeout(function(){self.loadMoreIfNeeded();},10);}
this.postprocessResults(data,initial);postRender();this.opts.element.trigger({type:"select2-loaded",items:data});})});},cancel:function(){this.close();},blur:function(){if(this.opts.selectOnBlur)
this.selectHighlighted({noFocus:true});this.close();this.container.removeClass("select2-container-active");if(this.search[0]===document.activeElement){this.search.blur();}
this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");},focusSearch:function(){focus(this.search);},selectHighlighted:function(options){if(this._touchMoved){this.clearTouchMoved();return;}
var index=this.highlight(),highlighted=this.results.find(".select2-highlighted"),data=highlighted.closest('.select2-result').data("select2-data");if(data){this.highlight(index);this.onSelect(data,options);}else if(options&&options.noFocus){this.close();}},getPlaceholder:function(){var placeholderOption;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((placeholderOption=this.getPlaceholderOption())!==undefined?placeholderOption.text():undefined);},getPlaceholderOption:function(){if(this.select){var firstOption=this.select.children('option').first();if(this.opts.placeholderOption!==undefined){return(this.opts.placeholderOption==="first"&&firstOption)||(typeof this.opts.placeholderOption==="function"&&this.opts.placeholderOption(this.select));}else if($.trim(firstOption.text())===""&&firstOption.val()===""){return firstOption;}}},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l,attr;if(this.opts.width==="off"){return null;}else if(this.opts.width==="element"){return this.opts.element.outerWidth(false)===0?'auto':this.opts.element.outerWidth(false)+'px';}else if(this.opts.width==="copy"||this.opts.width==="resolve"){style=this.opts.element.attr('style');if(style!==undefined){attrs=style.split(';');for(i=0,l=attrs.length;i<l;i=i+1){attr=attrs[i].replace(/\s/g,'');matches=attr.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i);if(matches!==null&&matches.length>=1)
return matches[1];}}
if(this.opts.width==="resolve"){style=this.opts.element.css('width');if(style.indexOf("%")>0)return style;return(this.opts.element.outerWidth(false)===0?'auto':this.opts.element.outerWidth(false)+'px');}
return null;}else if($.isFunction(this.opts.width)){return this.opts.width();}else{return this.opts.width;}};var width=resolveContainerWidth.call(this);if(width!==null){this.container.css("width",width);}}});SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='select2-offscreen'></label>","<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <label for='' class='select2-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='select2-results' role='listbox'>","   </ul>","</div>"].join(""));return container;},enableInterface:function(){if(this.parent.enableInterface.apply(this,arguments)){this.focusser.prop("disabled",!this.isInterfaceEnabled());}},opening:function(){var el,range,len;if(this.opts.minimumResultsForSearch>=0){this.showSearch(true);}
this.parent.opening.apply(this,arguments);if(this.showSearchInput!==false){this.search.val(this.focusser.val());}
if(this.opts.shouldFocusInput(this)){this.search.focus();el=this.search.get(0);if(el.createTextRange){range=el.createTextRange();range.collapse(false);range.select();}else if(el.setSelectionRange){len=this.search.val().length;el.setSelectionRange(len,len);}}
if(this.search.val()===""){if(this.nextSearchTerm!=undefined){this.search.val(this.nextSearchTerm);this.search.select();}}
this.focusser.prop("disabled",true).val("");this.updateResults(true);this.opts.element.trigger($.Event("select2-open"));},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);this.focusser.prop("disabled",false);if(this.opts.shouldFocusInput(this)){this.focusser.focus();}},focus:function(){if(this.opened()){this.close();}else{this.focusser.prop("disabled",false);if(this.opts.shouldFocusInput(this)){this.focusser.focus();}}},isFocused:function(){return this.container.hasClass("select2-container-active");},cancel:function(){this.parent.cancel.apply(this,arguments);this.focusser.prop("disabled",false);if(this.opts.shouldFocusInput(this)){this.focusser.focus();}},destroy:function(){$("label[for='"+this.focusser.attr('id')+"']").attr('for',this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments);cleanupJQueryElements.call(this,"selection","focusser");},initContainer:function(){var selection,container=this.container,dropdown=this.dropdown,idSuffix=nextUid(),elementLabel;if(this.opts.minimumResultsForSearch<0){this.showSearch(false);}else{this.showSearch(true);}
this.selection=selection=container.find(".select2-choice");this.focusser=container.find(".select2-focusser");selection.find(".select2-chosen").attr("id","select2-chosen-"+idSuffix);this.focusser.attr("aria-labelledby","select2-chosen-"+idSuffix);this.results.attr("id","select2-results-"+idSuffix);this.search.attr("aria-owns","select2-results-"+idSuffix);this.focusser.attr("id","s2id_autogen"+idSuffix);elementLabel=$("label[for='"+this.opts.element.attr("id")+"']");this.focusser.prev().text(elementLabel.text()).attr('for',this.focusser.attr('id'));var originalTitle=this.opts.element.attr("title");this.opts.element.attr("title",(originalTitle||elementLabel.text()));this.focusser.attr("tabindex",this.elementTabIndex);this.search.attr("id",this.focusser.attr('id')+'_search');this.search.prev().text($("label[for='"+this.focusser.attr('id')+"']").text()).attr('for',this.search.attr('id'));this.search.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);return;}
switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.TAB:this.selectHighlighted({noFocus:true});return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}));this.search.on("blur",this.bind(function(e){if(document.activeElement===this.body.get(0)){window.setTimeout(this.bind(function(){if(this.opened()){this.search.focus();}}),0);}}));this.focusser.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.ESC){return;}
if(this.opts.openOnEnter===false&&e.which===KEY.ENTER){killEvent(e);return;}
if(e.which==KEY.DOWN||e.which==KEY.UP||(e.which==KEY.ENTER&&this.opts.openOnEnter)){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;this.open();killEvent(e);return;}
if(e.which==KEY.DELETE||e.which==KEY.BACKSPACE){if(this.opts.allowClear){this.clear();}
killEvent(e);return;}}));installKeyUpChangeEvent(this.focusser);this.focusser.on("keyup-change input",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){e.stopPropagation();if(this.opened())return;this.open();}}));selection.on("mousedown touchstart","abbr",this.bind(function(e){if(!this.isInterfaceEnabled())return;this.clear();killEventImmediately(e);this.close();this.selection.focus();}));selection.on("mousedown touchstart",this.bind(function(e){reinsertElement(selection);if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
if(this.opened()){this.close();}else if(this.isInterfaceEnabled()){this.open();}
killEvent(e);}));dropdown.on("mousedown touchstart",this.bind(function(){if(this.opts.shouldFocusInput(this)){this.search.focus();}}));selection.on("focus",this.bind(function(e){killEvent(e);}));this.focusser.on("focus",this.bind(function(){if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.container.addClass("select2-container-active");})).on("blur",this.bind(function(){if(!this.opened()){this.container.removeClass("select2-container-active");this.opts.element.trigger($.Event("select2-blur"));}}));this.search.on("focus",this.bind(function(){if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.container.addClass("select2-container-active");}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.setPlaceholder();},clear:function(triggerChange){var data=this.selection.data("select2-data");if(data){var evt=$.Event("select2-clearing");this.opts.element.trigger(evt);if(evt.isDefaultPrevented()){return;}
var placeholderOption=this.getPlaceholderOption();this.opts.element.val(placeholderOption?placeholderOption.val():"");this.selection.find(".select2-chosen").empty();this.selection.removeData("select2-data");this.setPlaceholder();if(triggerChange!==false){this.opts.element.trigger({type:"select2-removed",val:this.id(data),choice:data});this.triggerChange({removed:data});}}},initSelection:function(){var selected;if(this.isPlaceholderOptionSelected()){this.updateSelection(null);this.close();this.setPlaceholder();}else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){if(selected!==undefined&&selected!==null){self.updateSelection(selected);self.close();self.setPlaceholder();self.nextSearchTerm=self.opts.nextSearchTerm(selected,self.search.val());}});}},isPlaceholderOptionSelected:function(){var placeholderOption;if(this.getPlaceholder()===undefined)return false;return((placeholderOption=this.getPlaceholderOption())!==undefined&&placeholderOption.prop("selected"))||(this.opts.element.val()==="")||(this.opts.element.val()===undefined)||(this.opts.element.val()===null);},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var selected=element.find("option").filter(function(){return this.selected&&!this.disabled});callback(self.optionToData(selected));};}else if("data"in opts){opts.initSelection=opts.initSelection||function(element,callback){var id=element.val();var match=null;opts.query({matcher:function(term,text,el){var is_match=equal(id,opts.id(el));if(is_match){match=el;}
return is_match;},callback:!$.isFunction(callback)?$.noop:function(){callback(match);}});};}
return opts;},getPlaceholder:function(){if(this.select){if(this.getPlaceholderOption()===undefined){return undefined;}}
return this.parent.getPlaceholder.apply(this,arguments);},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&placeholder!==undefined){if(this.select&&this.getPlaceholderOption()===undefined)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(placeholder));this.selection.addClass("select2-default");this.container.removeClass("select2-allowclear");}},postprocessResults:function(data,initial,noHighlightUpdate){var selected=0,self=this,showSearchInput=true;this.findHighlightableChoices().each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val())){selected=i;return false;}});if(noHighlightUpdate!==false){if(initial===true&&selected>=0){this.highlight(selected);}else{this.highlight(0);}}
if(initial===true){var min=this.opts.minimumResultsForSearch;if(min>=0){this.showSearch(countResults(data.results)>=min);}}},showSearch:function(showSearchInput){if(this.showSearchInput===showSearchInput)return;this.showSearchInput=showSearchInput;this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!showSearchInput);this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!showSearchInput);$(this.dropdown,this.container).toggleClass("select2-with-searchbox",showSearchInput);},onSelect:function(data,options){if(!this.triggerSelect(data)){return;}
var old=this.opts.element.val(),oldData=this.data();this.opts.element.val(this.id(data));this.updateSelection(data);this.opts.element.trigger({type:"select2-selected",val:this.id(data),choice:data});this.nextSearchTerm=this.opts.nextSearchTerm(data,this.search.val());this.close();if((!options||!options.noFocus)&&this.opts.shouldFocusInput(this)){this.focusser.focus();}
if(!equal(old,this.id(data))){this.triggerChange({added:data,removed:oldData});}},updateSelection:function(data){var container=this.selection.find(".select2-chosen"),formatted,cssClass;this.selection.data("select2-data",data);container.empty();if(data!==null){formatted=this.opts.formatSelection(data,container,this.opts.escapeMarkup);}
if(formatted!==undefined){container.append(formatted);}
cssClass=this.opts.formatSelectionCssClass(data,container);if(cssClass!==undefined){container.addClass(cssClass);}
this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==undefined){this.container.addClass("select2-allowclear");}},val:function(){var val,triggerChange=false,data=null,self=this,oldData=this.data();if(arguments.length===0){return this.opts.element.val();}
val=arguments[0];if(arguments.length>1){triggerChange=arguments[1];}
if(this.select){this.select.val(val).find("option").filter(function(){return this.selected}).each2(function(i,elm){data=self.optionToData(elm);return false;});this.updateSelection(data);this.setPlaceholder();if(triggerChange){this.triggerChange({added:data,removed:oldData});}}else{if(!val&&val!==0){this.clear(triggerChange);return;}
if(this.opts.initSelection===undefined){throw new Error("cannot call val() if initSelection() is not defined");}
this.opts.element.val(val);this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(!data?"":self.id(data));self.updateSelection(data);self.setPlaceholder();if(triggerChange){self.triggerChange({added:data,removed:oldData});}});}},clearSearch:function(){this.search.val("");this.focusser.val("");},data:function(value){var data,triggerChange=false;if(arguments.length===0){data=this.selection.data("select2-data");if(data==undefined)data=null;return data;}else{if(arguments.length>1){triggerChange=arguments[1];}
if(!value){this.clear(triggerChange);}else{data=this.data();this.opts.element.val(!value?"":this.id(value));this.updateSelection(value);if(triggerChange){this.triggerChange({added:value,removed:data});}}}}});MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <label for='' class='select2-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container;},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;if(opts.element.get(0).tagName.toLowerCase()==="select"){opts.initSelection=function(element,callback){var data=[];element.find("option").filter(function(){return this.selected&&!this.disabled}).each2(function(i,elm){data.push(self.optionToData(elm));});callback(data);};}else if("data"in opts){opts.initSelection=opts.initSelection||function(element,callback){var ids=splitVal(element.val(),opts.separator);var matches=[];opts.query({matcher:function(term,text,el){var is_match=$.grep(ids,function(id){return equal(id,opts.id(el));}).length;if(is_match){matches.push(el);}
return is_match;},callback:!$.isFunction(callback)?$.noop:function(){var ordered=[];for(var i=0;i<ids.length;i++){var id=ids[i];for(var j=0;j<matches.length;j++){var match=matches[j];if(equal(id,opts.id(match))){ordered.push(match);matches.splice(j,1);break;}}}
callback(ordered);}});};}
return opts;},selectChoice:function(choice){var selected=this.container.find(".select2-search-choice-focus");if(selected.length&&choice&&choice[0]==selected[0]){}else{if(selected.length){this.opts.element.trigger("choice-deselected",selected);}
selected.removeClass("select2-search-choice-focus");if(choice&&choice.length){this.close();choice.addClass("select2-search-choice-focus");this.opts.element.trigger("choice-selected",choice);}}},destroy:function(){$("label[for='"+this.search.attr('id')+"']").attr('for',this.opts.element.attr("id"));this.parent.destroy.apply(this,arguments);cleanupJQueryElements.call(this,"searchContainer","selection");},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field");this.selection=selection=this.container.find(selector);var _this=this;this.selection.on("click",".select2-search-choice:not(.select2-locked)",function(e){_this.search[0].focus();_this.selectChoice($(this));});this.search.attr("id","s2id_autogen"+nextUid());this.search.prev().text($("label[for='"+this.opts.element.attr("id")+"']").text()).attr('for',this.search.attr('id'));this.search.on("input paste",this.bind(function(){if(this.search.attr('placeholder')&&this.search.val().length==0)return;if(!this.isInterfaceEnabled())return;if(!this.opened()){this.open();}}));this.search.attr("tabindex",this.elementTabIndex);this.keydowns=0;this.search.on("keydown",this.bind(function(e){if(!this.isInterfaceEnabled())return;++this.keydowns;var selected=selection.find(".select2-search-choice-focus");var prev=selected.prev(".select2-search-choice:not(.select2-locked)");var next=selected.next(".select2-search-choice:not(.select2-locked)");var pos=getCursorInfo(this.search);if(selected.length&&(e.which==KEY.LEFT||e.which==KEY.RIGHT||e.which==KEY.BACKSPACE||e.which==KEY.DELETE||e.which==KEY.ENTER)){var selectedChoice=selected;if(e.which==KEY.LEFT&&prev.length){selectedChoice=prev;}
else if(e.which==KEY.RIGHT){selectedChoice=next.length?next:null;}
else if(e.which===KEY.BACKSPACE){if(this.unselect(selected.first())){this.search.width(10);selectedChoice=prev.length?prev:next;}}else if(e.which==KEY.DELETE){if(this.unselect(selected.first())){this.search.width(10);selectedChoice=next.length?next:null;}}else if(e.which==KEY.ENTER){selectedChoice=null;}
this.selectChoice(selectedChoice);killEvent(e);if(!selectedChoice||!selectedChoice.length){this.open();}
return;}else if(((e.which===KEY.BACKSPACE&&this.keydowns==1)||e.which==KEY.LEFT)&&(pos.offset==0&&!pos.length)){this.selectChoice(selection.find(".select2-search-choice:not(.select2-locked)").last());killEvent(e);return;}else{this.selectChoice(null);}
if(this.opened()){switch(e.which){case KEY.UP:case KEY.DOWN:this.moveHighlight((e.which===KEY.UP)?-1:1);killEvent(e);return;case KEY.ENTER:this.selectHighlighted();killEvent(e);return;case KEY.TAB:this.selectHighlighted({noFocus:true});this.close();return;case KEY.ESC:this.cancel(e);killEvent(e);return;}}
if(e.which===KEY.TAB||KEY.isControl(e)||KEY.isFunctionKey(e)||e.which===KEY.BACKSPACE||e.which===KEY.ESC){return;}
if(e.which===KEY.ENTER){if(this.opts.openOnEnter===false){return;}else if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return;}}
this.open();if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN){killEvent(e);}
if(e.which===KEY.ENTER){killEvent(e);}}));this.search.on("keyup",this.bind(function(e){this.keydowns=0;this.resizeSearch();}));this.search.on("blur",this.bind(function(e){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");this.selectChoice(null);if(!this.opened())this.clearSearch();e.stopImmediatePropagation();this.opts.element.trigger($.Event("select2-blur"));}));this.container.on("click",selector,this.bind(function(e){if(!this.isInterfaceEnabled())return;if($(e.target).closest(".select2-search-choice").length>0){return;}
this.selectChoice(null);this.clearPlaceholder();if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.open();this.focusSearch();e.preventDefault();}));this.container.on("focus",selector,this.bind(function(){if(!this.isInterfaceEnabled())return;if(!this.container.hasClass("select2-container-active")){this.opts.element.trigger($.Event("select2-focus"));}
this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder();}));this.initContainerWidth();this.opts.element.addClass("select2-offscreen");this.clearSearch();},enableInterface:function(){if(this.parent.enableInterface.apply(this,arguments)){this.search.prop("disabled",!this.isInterfaceEnabled());}},initSelection:function(){var data;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.updateSelection([]);this.close();this.clearSearch();}
if(this.select||this.opts.element.val()!==""){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){if(data!==undefined&&data!==null){self.updateSelection(data);self.close();self.clearSearch();}});}},clearSearch:function(){var placeholder=this.getPlaceholder(),maxWidth=this.getMaxSearchWidth();if(placeholder!==undefined&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(placeholder).addClass("select2-default");this.search.width(maxWidth>0?maxWidth:this.container.css("width"));}else{this.search.val("").width(10);}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default");}},opening:function(){this.clearPlaceholder();this.resizeSearch();this.parent.opening.apply(this,arguments);this.focusSearch();if(this.search.val()===""){if(this.nextSearchTerm!=undefined){this.search.val(this.nextSearchTerm);this.search.select();}}
this.updateResults(true);if(this.opts.shouldFocusInput(this)){this.search.focus();}
this.opts.element.trigger($.Event("select2-open"));},close:function(){if(!this.opened())return;this.parent.close.apply(this,arguments);},focus:function(){this.close();this.search.focus();},isFocused:function(){return this.search.hasClass("select2-focused");},updateSelection:function(data){var ids=[],filtered=[],self=this;$(data).each(function(){if(indexOf(self.id(this),ids)<0){ids.push(self.id(this));filtered.push(this);}});data=filtered;this.selection.find(".select2-search-choice").remove();$(data).each(function(){self.addSelectedChoice(this);});self.postprocessResults();},tokenize:function(){var input=this.search.val();input=this.opts.tokenizer.call(this,input,this.data(),this.bind(this.onSelect),this.opts);if(input!=null&&input!=undefined){this.search.val(input);if(input.length>0){this.open();}}},onSelect:function(data,options){if(!this.triggerSelect(data)){return;}
this.addSelectedChoice(data);this.opts.element.trigger({type:"selected",val:this.id(data),choice:data});this.nextSearchTerm=this.opts.nextSearchTerm(data,this.search.val());this.clearSearch();this.updateResults();if(this.select||!this.opts.closeOnSelect)this.postprocessResults(data,false,this.opts.closeOnSelect===true);if(this.opts.closeOnSelect){this.close();this.search.width(10);}else{if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();if(this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()){this.updateResults(true);}else{if(this.nextSearchTerm!=undefined){this.search.val(this.nextSearchTerm);this.updateResults();this.search.select();}}
this.positionDropdown();}else{this.close();this.search.width(10);}}
this.triggerChange({added:data});if(!options||!options.noFocus)
this.focusSearch();},cancel:function(){this.close();this.focusSearch();},addSelectedChoice:function(data){var enableChoice=!data.locked,enabledItem=$("<li class='select2-search-choice'>"+"    <div></div>"+"    <a href='#' class='select2-search-choice-close' tabindex='-1'></a>"+"</li>"),disabledItem=$("<li class='select2-search-choice select2-locked'>"+"<div></div>"+"</li>");var choice=enableChoice?enabledItem:disabledItem,id=this.id(data),val=this.getVal(),formatted,cssClass;formatted=this.opts.formatSelection(data,choice.find("div"),this.opts.escapeMarkup);if(formatted!=undefined){choice.find("div").replaceWith("<div>"+formatted+"</div>");}
cssClass=this.opts.formatSelectionCssClass(data,choice.find("div"));if(cssClass!=undefined){choice.addClass(cssClass);}
if(enableChoice){choice.find(".select2-search-choice-close").on("mousedown",killEvent).on("click dblclick",this.bind(function(e){if(!this.isInterfaceEnabled())return;this.unselect($(e.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");killEvent(e);this.close();this.focusSearch();})).on("focus",this.bind(function(){if(!this.isInterfaceEnabled())return;this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");}));}
choice.data("select2-data",data);choice.insertBefore(this.searchContainer);val.push(id);this.setVal(val);},unselect:function(selected){var val=this.getVal(),data,index;selected=selected.closest(".select2-search-choice");if(selected.length===0){throw"Invalid argument: "+selected+". Must be .select2-search-choice";}
data=selected.data("select2-data");if(!data){return;}
var evt=$.Event("select2-removing");evt.val=this.id(data);evt.choice=data;this.opts.element.trigger(evt);if(evt.isDefaultPrevented()){return false;}
while((index=indexOf(this.id(data),val))>=0){val.splice(index,1);this.setVal(val);if(this.select)this.postprocessResults();}
selected.remove();this.opts.element.trigger({type:"select2-removed",val:this.id(data),choice:data});this.triggerChange({removed:data});return true;},postprocessResults:function(data,initial,noHighlightUpdate){var val=this.getVal(),choices=this.results.find(".select2-result"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));if(indexOf(id,val)>=0){choice.addClass("select2-selected");choice.find(".select2-result-selectable").addClass("select2-selected");}});compound.each2(function(i,choice){if(!choice.is('.select2-result-selectable')&&choice.find(".select2-result-selectable:not(.select2-selected)").length===0){choice.addClass("select2-selected");}});if(this.highlight()==-1&&noHighlightUpdate!==false){self.highlight(0);}
if(!this.opts.createSearchChoice&&!choices.filter('.select2-result:not(.select2-selected)').length>0){if(!data||data&&!data.more&&this.results.find(".select2-no-results").length===0){if(checkFormatter(self.opts.formatNoMatches,"formatNoMatches")){this.results.append("<li class='select2-no-results'>"+evaluate(self.opts.formatNoMatches,self.opts.element,self.search.val())+"</li>");}}}},getMaxSearchWidth:function(){return this.selection.width()-getSideBorderPadding(this.search);},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10;left=this.search.offset().left;maxWidth=this.selection.width();containerLeft=this.selection.offset().left;searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding;if(searchWidth<minimumWidth){searchWidth=maxWidth-sideBorderPadding;}
if(searchWidth<40){searchWidth=maxWidth-sideBorderPadding;}
if(searchWidth<=0){searchWidth=minimumWidth;}
this.search.width(Math.floor(searchWidth));},getVal:function(){var val;if(this.select){val=this.select.val();return val===null?[]:val;}else{val=this.opts.element.val();return splitVal(val,this.opts.separator);}},setVal:function(val){var unique;if(this.select){this.select.val(val);}else{unique=[];$(val).each(function(){if(indexOf(this,unique)<0)unique.push(this);});this.opts.element.val(unique.length===0?"":unique.join(this.opts.separator));}},buildChangeDetails:function(old,current){var current=current.slice(0),old=old.slice(0);for(var i=0;i<current.length;i++){for(var j=0;j<old.length;j++){if(equal(this.opts.id(current[i]),this.opts.id(old[j]))){current.splice(i,1);if(i>0){i--;}
old.splice(j,1);j--;}}}
return{added:current,removed:old};},val:function(val,triggerChange){var oldData,self=this;if(arguments.length===0){return this.getVal();}
oldData=this.data();if(!oldData.length)oldData=[];if(!val&&val!==0){this.opts.element.val("");this.updateSelection([]);this.clearSearch();if(triggerChange){this.triggerChange({added:this.data(),removed:oldData});}
return;}
this.setVal(val);if(this.select){this.opts.initSelection(this.select,this.bind(this.updateSelection));if(triggerChange){this.triggerChange(this.buildChangeDetails(oldData,this.data()));}}else{if(this.opts.initSelection===undefined){throw new Error("val() cannot be called if initSelection() is not defined");}
this.opts.initSelection(this.opts.element,function(data){var ids=$.map(data,self.id);self.setVal(ids);self.updateSelection(data);self.clearSearch();if(triggerChange){self.triggerChange(self.buildChangeDetails(oldData,self.data()));}});}
this.clearSearch();},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");}
this.search.width(0);this.searchContainer.hide();},onSortEnd:function(){var val=[],self=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")));});this.setVal(val);this.triggerChange();},data:function(values,triggerChange){var self=this,ids,old;if(arguments.length===0){return this.selection.children(".select2-search-choice").map(function(){return $(this).data("select2-data");}).get();}else{old=this.data();if(!values){values=[];}
ids=$.map(values,function(e){return self.opts.id(e);});this.setVal(ids);this.updateSelection(values);this.clearSearch();if(triggerChange){this.triggerChange(this.buildChangeDetails(old,this.data()));}}}});$.fn.select2=function(){var args=Array.prototype.slice.call(arguments,0),opts,select2,method,value,multiple,allowedMethods=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],valueMethods=["opened","isFocused","container","dropdown"],propertyMethods=["val","data"],methodsMap={search:"externalSearch"};this.each(function(){if(args.length===0||typeof(args[0])==="object"){opts=args.length===0?{}:$.extend({},args[0]);opts.element=$(this);if(opts.element.get(0).tagName.toLowerCase()==="select"){multiple=opts.element.prop("multiple");}else{multiple=opts.multiple||false;if("tags"in opts){opts.multiple=multiple=true;}}
select2=multiple?new window.Select2["class"].multi():new window.Select2["class"].single();select2.init(opts);}else if(typeof(args[0])==="string"){if(indexOf(args[0],allowedMethods)<0){throw"Unknown method: "+args[0];}
value=undefined;select2=$(this).data("select2");if(select2===undefined)return;method=args[0];if(method==="container"){value=select2.container;}else if(method==="dropdown"){value=select2.dropdown;}else{if(methodsMap[method])method=methodsMap[method];value=select2[method].apply(select2,args.slice(1));}
if(indexOf(args[0],valueMethods)>=0||(indexOf(args[0],propertyMethods)>=0&&args.length==1)){return false;}}else{throw"Invalid arguments to select2 plugin: "+args;}});return(value===undefined)?this:value;};$.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:true,openOnEnter:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query,escapeMarkup){var markup=[];markMatch(result.text,query.term,markup,escapeMarkup);return markup.join("");},formatSelection:function(data,container,escapeMarkup){return data?escapeMarkup(data.text):undefined;},sortResults:function(results,container,query){return results;},formatResultCssClass:function(data){return data.css;},formatSelectionCssClass:function(data,container){return undefined;},formatMatches:function(matches){if(matches===1){return"One result is available, press enter to select it.";}return matches+" results are available, use up and down arrow keys to navigate.";},formatNoMatches:function(){return"No matches found";},formatInputTooShort:function(input,min){var n=min-input.length;return"Please enter "+n+" or more character"+(n==1?"":"s");},formatInputTooLong:function(input,max){var n=input.length-max;return"Please delete "+n+" character"+(n==1?"":"s");},formatSelectionTooBig:function(limit){return"You can only select "+limit+" item"+(limit==1?"":"s");},formatLoadMore:function(pageNumber){return"Loading more results";},formatSearching:function(){return"Searching";},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e==undefined?null:e.id;},matcher:function(term,text){return stripDiacritics(''+text).toUpperCase().indexOf(stripDiacritics(''+term).toUpperCase())>=0;},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:defaultEscapeMarkup,blurOnChange:false,selectOnBlur:false,adaptContainerCssClass:function(c){return c;},adaptDropdownCssClass:function(c){return null;},nextSearchTerm:function(selectedObject,currentSearchTerm){return undefined;},searchInputPlaceholder:'',createSearchChoicePosition:'top',shouldFocusInput:function(instance){var supportsTouchEvents=(('ontouchstart'in window)||(navigator.msMaxTouchPoints>0));if(!supportsTouchEvents){return true;}
if(instance.opts.minimumResultsForSearch<0){return false;}
return true;}};$.fn.select2.ajaxDefaults={transport:$.ajax,params:{type:"GET",cache:false,dataType:"json"}};window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch,escapeMarkup:defaultEscapeMarkup,stripDiacritics:stripDiacritics},"class":{"abstract":AbstractSelect2,"single":SingleSelect2,"multi":MultiSelect2}};}(jQuery));
(function($,undefined){var multiselectID=0;$.widget("ech.multiselect",{options:{header:true,height:175,minWidth:225,classes:'',checkAllText:'Marcar tudo',uncheckAllText:'Desmarcar tudo',noneSelectedText:'Selecione',selectedText:'# Selecionado(s)',selectedList:0,show:'',hide:'',autoOpen:false,multiple:true,position:{}},_create:function(){var el=this.element.hide(),o=this.options;this.speed=$.fx.speeds._default;this._isOpen=false;var
button=(this.button=$('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass('ui-multiselect ui-widget ui-state-default ui-corner-all').addClass(o.classes).attr({'title':el.attr('title'),'aria-haspopup':true,'tabIndex':el.attr('tabIndex')}).insertAfter(el),buttonlabel=(this.buttonlabel=$('<span />')).html(o.noneSelectedText).appendTo(button),menu=(this.menu=$('<div />')).addClass('ui-multiselect-menu ui-widget ui-widget-content ui-corner-all').addClass(o.classes).appendTo(document.body),header=(this.header=$('<div />')).addClass('ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix').appendTo(menu),headerLinkContainer=(this.headerLinkContainer=$('<ul />')).addClass('ui-helper-reset').html(function(){if(o.header===true){return'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+o.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+o.uncheckAllText+'</span></a></li>';}else if(typeof o.header==="string"){return'<li>'+o.header+'</li>';}else{return'';}}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(header),checkboxContainer=(this.checkboxContainer=$('<ul />')).addClass('ui-multiselect-checkboxes ui-helper-reset').appendTo(menu);this._bindEvents();this.refresh(true);if(!o.multiple){menu.addClass('ui-multiselect-single');}},_init:function(){if(this.options.header===false){this.header.hide();}
if(!this.options.multiple){this.headerLinkContainer.find('.ui-multiselect-all, .ui-multiselect-none').hide();}
if(this.options.autoOpen){this.open();}
if(this.element.is(':disabled')){this.disable();}},refresh:function(init){var el=this.element,o=this.options,menu=this.menu,checkboxContainer=this.checkboxContainer,optgroups=[],html=[],id=el.attr('id')||multiselectID++;el.find('option').each(function(i){var $this=$(this),parent=this.parentNode,title=this.innerHTML,description=this.title,value=this.value,inputID=this.id||'ui-multiselect-'+id+'-option-'+i,isDisabled=this.disabled,isSelected=this.selected,labelClasses=['ui-corner-all'],optLabel;if(parent.tagName.toLowerCase()==='optgroup'){optLabel=parent.getAttribute('label');if($.inArray(optLabel,optgroups)===-1){html.push('<li class="ui-multiselect-optgroup-label"><a href="#">'+optLabel+'</a></li>');optgroups.push(optLabel);}}
if(isDisabled){labelClasses.push('ui-state-disabled');}
if(isSelected&&!o.multiple){labelClasses.push('ui-state-active');}
html.push('<li class="'+(isDisabled?'ui-multiselect-disabled':'')+'">');html.push('<label for="'+inputID+'" title="'+description+'" class="'+labelClasses.join(' ')+'">');html.push('<input id="'+inputID+'" name="multiselect_'+id+'" type="'+(o.multiple?"checkbox":"radio")+'" value="'+value+'" title="'+title+'"');if(isSelected){html.push(' checked="checked"');html.push(' aria-selected="true"');}
if(isDisabled){html.push(' disabled="disabled"');html.push(' aria-disabled="true"');}
html.push(' /><span>'+title+'</span></label></li>');});checkboxContainer.html(html.join(''));this.labels=menu.find('label');this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();if(!init){this._trigger('refresh');}},update:function(){var o=this.options,$inputs=this.labels.find('input'),$checked=$inputs.filter('[checked]'),numChecked=$checked.length,value;if(numChecked===0){value=o.noneSelectedText;}else{if($.isFunction(o.selectedText)){value=o.selectedText.call(this,numChecked,$inputs.length,$checked.get());}else if(/\d/.test(o.selectedList)&&o.selectedList>0&&numChecked<=o.selectedList){value=$checked.map(function(){return $(this).next().text();}).get().join(', ');}else{value=o.selectedText.replace('#',numChecked).replace('#',$inputs.length);}}
this.buttonlabel.html(value);return value;},_bindEvents:function(){var self=this,button=this.button;function clickHandler(){self[self._isOpen?'close':'open']();return false;}
button.find('span').bind('click.multiselect',clickHandler);button.bind({click:clickHandler,keypress:function(e){switch(e.which){case 27:case 38:case 37:self.close();break;case 39:case 40:self.open();break;}},mouseenter:function(){if(!button.hasClass('ui-state-disabled')){$(this).addClass('ui-state-hover');}},mouseleave:function(){$(this).removeClass('ui-state-hover');},focus:function(){if(!button.hasClass('ui-state-disabled')){$(this).addClass('ui-state-focus');}},blur:function(){$(this).removeClass('ui-state-focus');}});this.header.delegate('a','click.multiselect',function(e){if($(this).hasClass('ui-multiselect-close')){self.close();}else{self[$(this).hasClass('ui-multiselect-all')?'checkAll':'uncheckAll']();}
e.preventDefault();});this.menu.delegate('li.ui-multiselect-optgroup-label a','click.multiselect',function(e){e.preventDefault();var $this=$(this),$inputs=$this.parent().nextUntil('li.ui-multiselect-optgroup-label').find('input:visible:not(:disabled)'),nodes=$inputs.get(),label=$this.parent().text();if(self._trigger('beforeoptgrouptoggle',e,{inputs:nodes,label:label})===false){return;}
self._toggleChecked($inputs.filter('[checked]').length!==$inputs.length,$inputs);self._trigger('optgrouptoggle',e,{inputs:nodes,label:label,checked:nodes[0].checked});}).delegate('label','mouseenter.multiselect',function(){if(!$(this).hasClass('ui-state-disabled')){self.labels.removeClass('ui-state-hover');$(this).addClass('ui-state-hover').find('input').focus();}}).delegate('label','keydown.multiselect',function(e){e.preventDefault();switch(e.which){case 9:case 27:self.close();break;case 38:case 40:case 37:case 39:self._traverse(e.which,this);break;case 13:$(this).find('input')[0].click();break;}}).delegate('input[type="checkbox"], input[type="radio"]','click.multiselect',function(e){var $this=$(this),val=this.value,checked=this.checked,tags=self.element.find('option');if(this.disabled||self._trigger('click',e,{value:val,text:this.title,checked:checked})===false){e.preventDefault();return;}
$this.focus();$this.attr('aria-selected',checked);tags.each(function(){if(this.value===val){this.selected=checked;}else if(!self.options.multiple){this.selected=false;}});if(!self.options.multiple){self.labels.removeClass('ui-state-active');$this.closest('label').toggleClass('ui-state-active',checked);self.close();}
self.element.trigger("change");setTimeout($.proxy(self.update,self),10);});$(document).bind('mousedown.multiselect',function(e){if(self._isOpen&&!$.contains(self.menu[0],e.target)&&!$.contains(self.button[0],e.target)&&e.target!==self.button[0]){self.close();}});$(this.element[0].form).bind('reset.multiselect',function(){setTimeout($.proxy(self.refresh,self),10);});},_setButtonWidth:function(){var width=this.element.outerWidth(),o=this.options;if(/\d/.test(o.minWidth)&&width<o.minWidth){width=o.minWidth;}
this.button.width(width);},_setMenuWidth:function(){var m=this.menu,width=this.button.outerWidth()-
parseInt(m.css('padding-left'),10)-
parseInt(m.css('padding-right'),10)-
parseInt(m.css('border-right-width'),10)-
parseInt(m.css('border-left-width'),10);m.width(width||this.button.outerWidth());},_traverse:function(which,start){var $start=$(start),moveToLast=which===38||which===37,$next=$start.parent()[moveToLast?'prevAll':'nextAll']('li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)')[moveToLast?'last':'first']();if(!$next.length){var $container=this.menu.find('ul').last();this.menu.find('label')[moveToLast?'last':'first']().trigger('mouseover');$container.scrollTop(moveToLast?$container.height():0);}else{$next.find('label').trigger('mouseover');}},_toggleState:function(prop,flag){return function(){if(!this.disabled){this[prop]=flag;}
if(flag){this.setAttribute('aria-selected',true);}else{this.removeAttribute('aria-selected');}};},_toggleChecked:function(flag,group){var $inputs=(group&&group.length)?group:this.labels.find('input'),self=this;$inputs.each(this._toggleState('checked',flag));$inputs.eq(0).focus();this.update();var values=$inputs.map(function(){return this.value;}).get();this.element.find('option').each(function(){if(!this.disabled&&$.inArray(this.value,values)>-1){self._toggleState('selected',flag).call(this);}});if($inputs.length){this.element.trigger("change");}},_toggleDisabled:function(flag){this.button.attr({'disabled':flag,'aria-disabled':flag})[flag?'addClass':'removeClass']('ui-state-disabled');this.menu.find('input').attr({'disabled':flag,'aria-disabled':flag}).parent()[flag?'addClass':'removeClass']('ui-state-disabled');this.element.attr({'disabled':flag,'aria-disabled':flag});},open:function(e){var self=this,button=this.button,menu=this.menu,speed=this.speed,o=this.options;if(this._trigger('beforeopen')===false||button.hasClass('ui-state-disabled')||this._isOpen){return;}
var $container=menu.find('ul').last(),effect=o.show,pos=button.offset();if($.isArray(o.show)){effect=o.show[0];speed=o.show[1]||self.speed;}
$container.scrollTop(0).height(o.height);if($.ui.position&&!$.isEmptyObject(o.position)){o.position.of=o.position.of||button;menu.show().position(o.position).hide().show(effect,speed);}else{menu.css({top:pos.top+button.outerHeight(),left:pos.left}).show(effect,speed);}
this.labels.eq(0).trigger('mouseover').trigger('mouseenter').find('input').trigger('focus');button.addClass('ui-state-active');this._isOpen=true;this._trigger('open');},close:function(){if(this._trigger('beforeclose')===false){return;}
var o=this.options,effect=o.hide,speed=this.speed;if($.isArray(o.hide)){effect=o.hide[0];speed=o.hide[1]||this.speed;}
this.menu.hide(effect,speed);this.button.removeClass('ui-state-active').trigger('blur').trigger('mouseleave');this._isOpen=false;this._trigger('close');},enable:function(){this._toggleDisabled(false);},disable:function(){this._toggleDisabled(true);},checkAll:function(e){this._toggleChecked(true);this._trigger('checkAll');},uncheckAll:function(){this._toggleChecked(false);this._trigger('uncheckAll');},getChecked:function(){return this.menu.find('input').filter('[checked]');},destroy:function(){$.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this;},isOpen:function(){return this._isOpen;},widget:function(){return this.menu;},_setOption:function(key,value){var menu=this.menu;switch(key){case'header':menu.find('div.ui-multiselect-header')[value?'show':'hide']();break;case'checkAllText':menu.find('a.ui-multiselect-all span').eq(-1).text(value);break;case'uncheckAllText':menu.find('a.ui-multiselect-none span').eq(-1).text(value);break;case'height':menu.find('ul').last().height(parseInt(value,10));break;case'minWidth':this.options[key]=parseInt(value,10);this._setButtonWidth();this._setMenuWidth();break;case'selectedText':case'selectedList':case'noneSelectedText':this.options[key]=value;this.update();break;case'classes':menu.add(this.button).removeClass(this.options.classes).addClass(value);break;}
$.Widget.prototype._setOption.apply(this,arguments);}});})(jQuery);
(function(){var ArrMethods={where:function(attrs){var nodes=[];_.each(this,function(model){nodes=nodes.concat(model.where(attrs));});return wrapArray(_.uniq(nodes));}};var wrapArray=function(array){return _.extend(array,ArrMethods);};var TreeModel=Backbone.TreeModel=Backbone.Model.extend({nodesAttribute:'nodes',constructor:function tree(node){Backbone.Model.prototype.constructor.apply(this,arguments);this._nodes=new TreeCollection(undefined,{model:this.constructor});this._nodes.parent=this;if(node&&node[this.nodesAttribute]){this.add(node[this.nodesAttribute]);this.unset(this.nodesAttribute);}
this._nodes.on("all",function(event,model,collection,options){this.root().trigger.apply(this.root(),arguments);},this);},toJSON:function(){var jsonObj=Backbone.Model.prototype.toJSON.apply(this,arguments);var children=this._nodes.toJSON();if(children.length)jsonObj[this.nodesAttribute]=children;return jsonObj;},find:function(id){return this.findWhere({id:id});},findWhere:function(attrs){return this.where(attrs,true);},where:function(attrs,first,excludeCurrentNode){var nodes=[],matchedNode;if(!excludeCurrentNode&&_.where([this.toJSON()],attrs)[0])nodes.push(this);if(first){if(nodes[0])return nodes[0];matchedNode=this._nodes.where(attrs,true);if(_.isArray(matchedNode))matchedNode=matchedNode[0];if(matchedNode instanceof Backbone.Model)return matchedNode;for(var i=0,len=this._nodes.length;i<len;i++){matchedNode=this._nodes.at(i).where(attrs,true,true);if(matchedNode)return matchedNode;}}else{nodes=nodes.concat(this._nodes.where(attrs));this._nodes.each(function(node){nodes=nodes.concat(node.where(attrs,false,true));});return wrapArray(nodes);}},isRoot:function(){return this.parent()===null;},root:function(){return this.parent()&&this.parent().root()||this;},contains:function(node){if(!node||!(node.isRoot&&node.parent)||node.isRoot())return false;var parent=node.parent();return(parent===this)||this.contains(parent);},parent:function(){return this.collection&&this.collection.parent||null;},nodes:function(){return this._nodes.length&&this._nodes||null;},index:function(){if(this.isRoot())return null;return this.collection.indexOf(this);},next:function(){if(this.isRoot())return null;var currentIndex=this.index();if(currentIndex<this.collection.length-1){return this.collection.at(currentIndex+1);}else{return null;}},prev:function(){if(this.isRoot())return null;var currentIndex=this.index();if(currentIndex>0){return this.collection.at(currentIndex-1);}else{return null;}},remove:function(attrs,first){if(!attrs){if(this.isRoot())return false;this.collection.remove(this);return true;}else{if(first){this.where(attrs,true).remove();}else{_.each(this.where(attrs),function(node){if(node.collection)node.remove();});}
return this;}},empty:function(){this._nodes.reset();return this;},add:function(node){if(node instanceof Backbone.Model&&node.collection)node.collection.remove(node);this._nodes.add.apply(this._nodes,arguments);return this;},insertBefore:function(node){if(!this.isRoot()){if(node instanceof Backbone.Model&&node.collection)node.collection.remove(node);this.parent().add(node,{at:this.index()});}
return this;},insertAfter:function(node){if(!this.isRoot()){if(node instanceof Backbone.Model&&node.collection)node.collection.remove(node);this.parent().add(node,{at:this.index()+1});}
return this;},before:function(nodes){if(nodes)return this.insertBefore(nodes);return this.prev();},after:function(nodes){if(nodes)return this.insertAfter(nodes);return this.next();}});var TreeCollection=Backbone.TreeCollection=Backbone.Collection.extend({where:function(attrs,opts){if(opts&&opts.deep){var nodes=[];this.each(function(model){nodes=nodes.concat(model.where(attrs));});return wrapArray(nodes);}else{return Backbone.Collection.prototype.where.apply(this,arguments);}}});}).call(this);!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});!function(e){"undefined"!=typeof module&&module.exports?module.exports=e:e(jQuery,window,document)}(function(e){!function(t){var o="function"==typeof define&&define.amd,a="undefined"!=typeof module&&module.exports,n="https:"==document.location.protocol?"https:":"http:",i="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.12/jquery.mousewheel.min.js";o||(a?require("jquery-mousewheel")(e):e.event.special.mousewheel||e("head").append(decodeURI("%3Cscript src="+n+"//"+i+"%3E%3C/script%3E"))),t()}(function(){var t,o="mCustomScrollbar",a="mCS",n=".mCustomScrollbar",i={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:!0},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},r=0,l={},s=window.attachEvent&&!window.addEventListener?1:0,c=!1,d=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],u={init:function(t){var t=e.extend(!0,{},i,t),o=f.call(this);if(t.live){var s=t.liveFilter||this.filter||n,c=e(s);if("off"===t.live)return void m(s);l[s]=setTimeout(function(){c.mCustomScrollbar(t),"once"===t.live&&c.length&&m(s)},500)}else m(s);return t.setWidth=t.set_width?t.set_width:t.setWidth,t.setHeight=t.set_height?t.set_height:t.setHeight,t.axis=t.horizontalScroll?"x":p(t.axis),t.scrollInertia=t.scrollInertia>0&&t.scrollInertia<17?17:t.scrollInertia,"object"!=typeof t.mouseWheel&&1==t.mouseWheel&&(t.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),t.mouseWheel.scrollAmount=t.mouseWheelPixels?t.mouseWheelPixels:t.mouseWheel.scrollAmount,t.mouseWheel.normalizeDelta=t.advanced.normalizeMouseWheelDelta?t.advanced.normalizeMouseWheelDelta:t.mouseWheel.normalizeDelta,t.scrollButtons.scrollType=g(t.scrollButtons.scrollType),h(t),e(o).each(function(){var o=e(this);if(!o.data(a)){o.data(a,{idx:++r,opt:t,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:o.css("direction"),cbOffsets:null,trigger:null});var n=o.data(a),i=n.opt,l=o.data("mcs-axis"),s=o.data("mcs-scrollbar-position"),c=o.data("mcs-theme");l&&(i.axis=l),s&&(i.scrollbarPosition=s),c&&(i.theme=c,h(i)),v.call(this),e("#mCSB_"+n.idx+"_container img:not(."+d[2]+")").addClass(d[2]),u.update.call(null,o)}})},update:function(t,o){var n=t||f.call(this);return e(n).each(function(){var t=e(this);if(t.data(a)){var n=t.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container"),l=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];if(!r.length)return;n.tweenRunning&&V(t),t.hasClass(d[3])&&t.removeClass(d[3]),t.hasClass(d[4])&&t.removeClass(d[4]),S.call(this),_.call(this),"y"===i.axis||i.advanced.autoExpandHorizontalScroll||r.css("width",x(r.children())),n.overflowed=B.call(this),O.call(this),i.autoDraggerLength&&b.call(this),C.call(this),k.call(this);var s=[Math.abs(r[0].offsetTop),Math.abs(r[0].offsetLeft)];"x"!==i.axis&&(n.overflowed[0]?l[0].height()>l[0].parent().height()?T.call(this):(Q(t,s[0].toString(),{dir:"y",dur:0,overwrite:"none"}),n.contentReset.y=null):(T.call(this),"y"===i.axis?M.call(this):"yx"===i.axis&&n.overflowed[1]&&Q(t,s[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==i.axis&&(n.overflowed[1]?l[1].width()>l[1].parent().width()?T.call(this):(Q(t,s[1].toString(),{dir:"x",dur:0,overwrite:"none"}),n.contentReset.x=null):(T.call(this),"x"===i.axis?M.call(this):"yx"===i.axis&&n.overflowed[0]&&Q(t,s[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),o&&n&&(2===o&&i.callbacks.onImageLoad&&"function"==typeof i.callbacks.onImageLoad?i.callbacks.onImageLoad.call(this):3===o&&i.callbacks.onFilterChange&&"function"==typeof i.callbacks.onFilterChange?i.callbacks.onFilterChange.call(this):i.callbacks.onUpdate&&"function"==typeof i.callbacks.onUpdate&&i.callbacks.onUpdate.call(this)),X.call(this)}})},scrollTo:function(t,o){if("undefined"!=typeof t&&null!=t){var n=f.call(this);return e(n).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l={trigger:"external",scrollInertia:r.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},s=e.extend(!0,{},l,o),c=Y.call(this,t),d=s.scrollInertia>0&&s.scrollInertia<17?17:s.scrollInertia;c[0]=j.call(this,c[0],"y"),c[1]=j.call(this,c[1],"x"),s.moveDragger&&(c[0]*=i.scrollRatio.y,c[1]*=i.scrollRatio.x),s.dur=d,setTimeout(function(){null!==c[0]&&"undefined"!=typeof c[0]&&"x"!==r.axis&&i.overflowed[0]&&(s.dir="y",s.overwrite="all",Q(n,c[0].toString(),s)),null!==c[1]&&"undefined"!=typeof c[1]&&"y"!==r.axis&&i.overflowed[1]&&(s.dir="x",s.overwrite="none",Q(n,c[1].toString(),s))},s.timeout)}})}},stop:function(){var t=f.call(this);return e(t).each(function(){var t=e(this);t.data(a)&&V(t)})},disable:function(t){var o=f.call(this);return e(o).each(function(){var o=e(this);if(o.data(a)){{o.data(a)}X.call(this,"remove"),M.call(this),t&&T.call(this),O.call(this,!0),o.addClass(d[3])}})},destroy:function(){var t=f.call(this);return e(t).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx),s=e("#mCSB_"+i.idx+"_container"),c=e(".mCSB_"+i.idx+"_scrollbar");r.live&&m(r.liveFilter||e(t).filter),X.call(this,"remove"),M.call(this),T.call(this),n.removeData(a),Z(this,"mcs"),c.remove(),s.find("img."+d[2]).removeClass(d[2]),l.replaceWith(s.contents()),n.removeClass(o+" _"+a+"_"+i.idx+" "+d[6]+" "+d[7]+" "+d[5]+" "+d[3]).addClass(d[4])}})}},f=function(){return"object"!=typeof e(this)||e(this).length<1?n:this},h=function(t){var o=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],a=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],n=["minimal","minimal-dark"],i=["minimal","minimal-dark"],r=["minimal","minimal-dark"];t.autoDraggerLength=e.inArray(t.theme,o)>-1?!1:t.autoDraggerLength,t.autoExpandScrollbar=e.inArray(t.theme,a)>-1?!1:t.autoExpandScrollbar,t.scrollButtons.enable=e.inArray(t.theme,n)>-1?!1:t.scrollButtons.enable,t.autoHideScrollbar=e.inArray(t.theme,i)>-1?!0:t.autoHideScrollbar,t.scrollbarPosition=e.inArray(t.theme,r)>-1?"outside":t.scrollbarPosition},m=function(e){l[e]&&(clearTimeout(l[e]),Z(l,e))},p=function(e){return"yx"===e||"xy"===e||"auto"===e?"yx":"x"===e||"horizontal"===e?"x":"y"},g=function(e){return"stepped"===e||"pixels"===e||"step"===e||"click"===e?"stepped":"stepless"},v=function(){var t=e(this),n=t.data(a),i=n.opt,r=i.autoExpandScrollbar?" "+d[1]+"_expand":"",l=["<div id='mCSB_"+n.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_vertical"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+n.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_horizontal"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],s="yx"===i.axis?"mCSB_vertical_horizontal":"x"===i.axis?"mCSB_horizontal":"mCSB_vertical",c="yx"===i.axis?l[0]+l[1]:"x"===i.axis?l[1]:l[0],u="yx"===i.axis?"<div id='mCSB_"+n.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",f=i.autoHideScrollbar?" "+d[6]:"",h="x"!==i.axis&&"rtl"===n.langDir?" "+d[7]:"";i.setWidth&&t.css("width",i.setWidth),i.setHeight&&t.css("height",i.setHeight),i.setLeft="y"!==i.axis&&"rtl"===n.langDir?"989999px":i.setLeft,t.addClass(o+" _"+a+"_"+n.idx+f+h).wrapInner("<div id='mCSB_"+n.idx+"' class='mCustomScrollBox mCS-"+i.theme+" "+s+"'><div id='mCSB_"+n.idx+"_container' class='mCSB_container' style='position:relative; top:"+i.setTop+"; left:"+i.setLeft+";' dir="+n.langDir+" /></div>");var m=e("#mCSB_"+n.idx),p=e("#mCSB_"+n.idx+"_container");"y"===i.axis||i.advanced.autoExpandHorizontalScroll||p.css("width",x(p.children())),"outside"===i.scrollbarPosition?("static"===t.css("position")&&t.css("position","relative"),t.css("overflow","visible"),m.addClass("mCSB_outside").after(c)):(m.addClass("mCSB_inside").append(c),p.wrap(u)),w.call(this);var g=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width())},x=function(t){return Math.max.apply(Math,t.map(function(){return e(this).outerWidth(!0)}).get())},_=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx+"_container");n.advanced.autoExpandHorizontalScroll&&"y"!==n.axis&&i.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(i[0].getBoundingClientRect().right+.4)-Math.floor(i[0].getBoundingClientRect().left),position:"relative"}).unwrap()},w=function(){var t=e(this),o=t.data(a),n=o.opt,i=e(".mCSB_"+o.idx+"_scrollbar:first"),r=tt(n.scrollButtons.tabindex)?"tabindex='"+n.scrollButtons.tabindex+"'":"",l=["<a href='#' class='"+d[13]+"' oncontextmenu='return false;' "+r+" />","<a href='#' class='"+d[14]+"' oncontextmenu='return false;' "+r+" />","<a href='#' class='"+d[15]+"' oncontextmenu='return false;' "+r+" />","<a href='#' class='"+d[16]+"' oncontextmenu='return false;' "+r+" />"],s=["x"===n.axis?l[2]:l[0],"x"===n.axis?l[3]:l[1],l[2],l[3]];n.scrollButtons.enable&&i.prepend(s[0]).append(s[1]).next(".mCSB_scrollTools").prepend(s[2]).append(s[3])},S=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=t.css("max-height")||"none",r=-1!==i.indexOf("%"),l=t.css("box-sizing");if("none"!==i){var s=r?t.parent().height()*parseInt(i)/100:parseInt(i);"border-box"===l&&(s-=t.innerHeight()-t.height()+(t.outerHeight()-t.innerHeight())),n.css("max-height",Math.round(s))}},b=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[n.height()/i.outerHeight(!1),n.width()/i.outerWidth(!1)],c=[parseInt(r[0].css("min-height")),Math.round(l[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(l[1]*r[1].parent().width())],d=s&&c[1]<c[0]?c[0]:c[1],u=s&&c[3]<c[2]?c[2]:c[3];r[0].css({height:d,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":c[0]+"px"}),r[1].css({width:u,"max-width":r[1].parent().width()-10})},C=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[i.outerHeight(!1)-n.height(),i.outerWidth(!1)-n.width()],s=[l[0]/(r[0].parent().height()-r[0].height()),l[1]/(r[1].parent().width()-r[1].width())];o.scrollRatio={y:s[0],x:s[1]}},y=function(e,t,o){var a=o?d[0]+"_expanded":"",n=e.closest(".mCSB_scrollTools");"active"===t?(e.toggleClass(d[0]+" "+a),n.toggleClass(d[1]),e[0]._draggable=e[0]._draggable?0:1):e[0]._draggable||("hide"===t?(e.removeClass(d[0]),n.removeClass(d[1])):(e.addClass(d[0]),n.addClass(d[1])))},B=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=null==o.overflowed?i.height():i.outerHeight(!1),l=null==o.overflowed?i.width():i.outerWidth(!1);return[r>n.height(),l>n.width()]},T=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx),r=e("#mCSB_"+o.idx+"_container"),l=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")];if(V(t),("x"!==n.axis&&!o.overflowed[0]||"y"===n.axis&&o.overflowed[0])&&(l[0].add(r).css("top",0),Q(t,"_resetY")),"y"!==n.axis&&!o.overflowed[1]||"x"===n.axis&&o.overflowed[1]){var s=dx=0;"rtl"===o.langDir&&(s=i.width()-r.outerWidth(!1),dx=Math.abs(s/o.scrollRatio.x)),r.css("left",s),l[1].css("left",dx),Q(t,"_resetX")}},k=function(){function t(){r=setTimeout(function(){e.event.special.mousewheel?(clearTimeout(r),W.call(o[0])):t()},100)}var o=e(this),n=o.data(a),i=n.opt;if(!n.bindEvents){if(R.call(this),i.contentTouchScroll&&E.call(this),D.call(this),i.mouseWheel.enable){var r;t()}P.call(this),H.call(this),i.advanced.autoScrollOnFocus&&z.call(this),i.scrollButtons.enable&&U.call(this),i.keyboard.enable&&q.call(this),n.bindEvents=!0}},M=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=".mCSB_"+o.idx+"_scrollbar",l=e("#mCSB_"+o.idx+",#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,"+r+" ."+d[12]+",#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal,"+r+">a"),s=e("#mCSB_"+o.idx+"_container");n.advanced.releaseDraggableFilters&&l.add(e(n.advanced.releaseDraggableFilters)),o.bindEvents&&(e(document).unbind("."+i),l.each(function(){e(this).unbind("."+i)}),clearTimeout(t[0]._focusTimeout),Z(t[0],"_focusTimeout"),clearTimeout(o.sequential.step),Z(o.sequential,"step"),clearTimeout(s[0].onCompleteTimeout),Z(s[0],"onCompleteTimeout"),o.bindEvents=!1)},O=function(t){var o=e(this),n=o.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container_wrapper"),l=r.length?r:e("#mCSB_"+n.idx+"_container"),s=[e("#mCSB_"+n.idx+"_scrollbar_vertical"),e("#mCSB_"+n.idx+"_scrollbar_horizontal")],c=[s[0].find(".mCSB_dragger"),s[1].find(".mCSB_dragger")];"x"!==i.axis&&(n.overflowed[0]&&!t?(s[0].add(c[0]).add(s[0].children("a")).css("display","block"),l.removeClass(d[8]+" "+d[10])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[0].css("display","none"),l.removeClass(d[10])):(s[0].css("display","none"),l.addClass(d[10])),l.addClass(d[8]))),"y"!==i.axis&&(n.overflowed[1]&&!t?(s[1].add(c[1]).add(s[1].children("a")).css("display","block"),l.removeClass(d[9]+" "+d[11])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[1].css("display","none"),l.removeClass(d[11])):(s[1].css("display","none"),l.addClass(d[11])),l.addClass(d[9]))),n.overflowed[0]||n.overflowed[1]?o.removeClass(d[5]):o.addClass(d[5])},I=function(e){var t=e.type;switch(t){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return e.target.ownerDocument!==document?[e.originalEvent.screenY,e.originalEvent.screenX,!1]:[e.originalEvent.pageY,e.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var o=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],a=e.originalEvent.touches.length||e.originalEvent.changedTouches.length;return e.target.ownerDocument!==document?[o.screenY,o.screenX,a>1]:[o.pageY,o.pageX,a>1];default:return[e.pageY,e.pageX,!1]}},R=function(){function t(e){var t=m.find("iframe");if(t.length){var o=e?"auto":"none";t.css("pointer-events",o)}}function o(e,t,o,a){if(m[0].idleTimer=u.scrollInertia<233?250:0,n.attr("id")===h[1])var i="x",r=(n[0].offsetLeft-t+a)*d.scrollRatio.x;else var i="y",r=(n[0].offsetTop-e+o)*d.scrollRatio.y;Q(l,r.toString(),{dir:i,drag:!0})}var n,i,r,l=e(this),d=l.data(a),u=d.opt,f=a+"_"+d.idx,h=["mCSB_"+d.idx+"_dragger_vertical","mCSB_"+d.idx+"_dragger_horizontal"],m=e("#mCSB_"+d.idx+"_container"),p=e("#"+h[0]+",#"+h[1]),g=u.advanced.releaseDraggableFilters?p.add(e(u.advanced.releaseDraggableFilters)):p;p.bind("mousedown."+f+" touchstart."+f+" pointerdown."+f+" MSPointerDown."+f,function(o){if(o.stopImmediatePropagation(),o.preventDefault(),$(o)){c=!0,s&&(document.onselectstart=function(){return!1}),t(!1),V(l),n=e(this);var a=n.offset(),d=I(o)[0]-a.top,f=I(o)[1]-a.left,h=n.height()+a.top,m=n.width()+a.left;h>d&&d>0&&m>f&&f>0&&(i=d,r=f),y(n,"active",u.autoExpandScrollbar)}}).bind("touchmove."+f,function(e){e.stopImmediatePropagation(),e.preventDefault();var t=n.offset(),a=I(e)[0]-t.top,l=I(e)[1]-t.left;o(i,r,a,l)}),e(document).bind("mousemove."+f+" pointermove."+f+" MSPointerMove."+f,function(e){if(n){var t=n.offset(),a=I(e)[0]-t.top,l=I(e)[1]-t.left;if(i===a)return;o(i,r,a,l)}}).add(g).bind("mouseup."+f+" touchend."+f+" pointerup."+f+" MSPointerUp."+f,function(){n&&(y(n,"active",u.autoExpandScrollbar),n=null),c=!1,s&&(document.onselectstart=null),t(!0)})},E=function(){function o(e){if(!et(e)||c||I(e)[2])return void(t=0);t=1,S=0,b=0;var o=M.offset();d=I(e)[0]-o.top,u=I(e)[1]-o.left,A=[I(e)[0],I(e)[1]]}function n(e){if(et(e)&&!c&&!I(e)[2]&&(e.stopImmediatePropagation(),!b||S)){p=J();var t=k.offset(),o=I(e)[0]-t.top,a=I(e)[1]-t.left,n="mcsLinearOut";if(R.push(o),E.push(a),A[2]=Math.abs(I(e)[0]-A[0]),A[3]=Math.abs(I(e)[1]-A[1]),y.overflowed[0])var i=O[0].parent().height()-O[0].height(),r=d-o>0&&o-d>-(i*y.scrollRatio.y)&&(2*A[3]<A[2]||"yx"===B.axis);if(y.overflowed[1])var l=O[1].parent().width()-O[1].width(),f=u-a>0&&a-u>-(l*y.scrollRatio.x)&&(2*A[2]<A[3]||"yx"===B.axis);r||f?(e.preventDefault(),S=1):b=1,_="yx"===B.axis?[d-o,u-a]:"x"===B.axis?[null,u-a]:[d-o,null],M[0].idleTimer=250,y.overflowed[0]&&s(_[0],D,n,"y","all",!0),y.overflowed[1]&&s(_[1],D,n,"x",W,!0)}}function i(e){if(!et(e)||c||I(e)[2])return void(t=0);t=1,e.stopImmediatePropagation(),V(C),m=J();var o=k.offset();f=I(e)[0]-o.top,h=I(e)[1]-o.left,R=[],E=[]}function r(e){if(et(e)&&!c&&!I(e)[2]){e.stopImmediatePropagation(),S=0,b=0,g=J();var t=k.offset(),o=I(e)[0]-t.top,a=I(e)[1]-t.left;if(!(g-p>30)){x=1e3/(g-m);var n="mcsEaseOut",i=2.5>x,r=i?[R[R.length-2],E[E.length-2]]:[0,0];v=i?[o-r[0],a-r[1]]:[o-f,a-h];var d=[Math.abs(v[0]),Math.abs(v[1])];x=i?[Math.abs(v[0]/4),Math.abs(v[1]/4)]:[x,x];var u=[Math.abs(M[0].offsetTop)-v[0]*l(d[0]/x[0],x[0]),Math.abs(M[0].offsetLeft)-v[1]*l(d[1]/x[1],x[1])];_="yx"===B.axis?[u[0],u[1]]:"x"===B.axis?[null,u[1]]:[u[0],null],w=[4*d[0]+B.scrollInertia,4*d[1]+B.scrollInertia];var C=parseInt(B.contentTouchScroll)||0;_[0]=d[0]>C?_[0]:0,_[1]=d[1]>C?_[1]:0,y.overflowed[0]&&s(_[0],w[0],n,"y",W,!1),y.overflowed[1]&&s(_[1],w[1],n,"x",W,!1)}}}function l(e,t){var o=[1.5*t,2*t,t/1.5,t/2];return e>90?t>4?o[0]:o[3]:e>60?t>3?o[3]:o[2]:e>30?t>8?o[1]:t>6?o[0]:t>4?t:o[2]:t>8?t:o[3]}function s(e,t,o,a,n,i){e&&Q(C,e.toString(),{dur:t,scrollEasing:o,dir:a,overwrite:n,drag:i})}var d,u,f,h,m,p,g,v,x,_,w,S,b,C=e(this),y=C.data(a),B=y.opt,T=a+"_"+y.idx,k=e("#mCSB_"+y.idx),M=e("#mCSB_"+y.idx+"_container"),O=[e("#mCSB_"+y.idx+"_dragger_vertical"),e("#mCSB_"+y.idx+"_dragger_horizontal")],R=[],E=[],D=0,W="yx"===B.axis?"none":"all",A=[],P=M.find("iframe"),z=["touchstart."+T+" pointerdown."+T+" MSPointerDown."+T,"touchmove."+T+" pointermove."+T+" MSPointerMove."+T,"touchend."+T+" pointerup."+T+" MSPointerUp."+T];M.bind(z[0],function(e){o(e)}).bind(z[1],function(e){n(e)}),k.bind(z[0],function(e){i(e)}).bind(z[2],function(e){r(e)}),P.length&&P.each(function(){e(this).on('load',function(){L(this)&&e(this.contentDocument||this.contentWindow.document).bind(z[0],function(e){o(e),i(e)}).bind(z[1],function(e){n(e)}).bind(z[2],function(e){r(e)})})})},D=function(){function o(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().text:0}function n(e,t,o){d.type=o&&i?"stepped":"stepless",d.scrollAmount=10,F(r,e,t,"mcsLinearOut",o?60:null)}var i,r=e(this),l=r.data(a),s=l.opt,d=l.sequential,u=a+"_"+l.idx,f=e("#mCSB_"+l.idx+"_container"),h=f.parent();f.bind("mousedown."+u,function(){t||i||(i=1,c=!0)}).add(document).bind("mousemove."+u,function(e){if(!t&&i&&o()){var a=f.offset(),r=I(e)[0]-a.top+f[0].offsetTop,c=I(e)[1]-a.left+f[0].offsetLeft;r>0&&r<h.height()&&c>0&&c<h.width()?d.step&&n("off",null,"stepped"):("x"!==s.axis&&l.overflowed[0]&&(0>r?n("on",38):r>h.height()&&n("on",40)),"y"!==s.axis&&l.overflowed[1]&&(0>c?n("on",37):c>h.width()&&n("on",39)))}}).bind("mouseup."+u,function(){t||(i&&(i=0,n("off",null)),c=!1)})},W=function(){function t(t,a){if(V(o),!A(o,t.target)){var r="auto"!==i.mouseWheel.deltaFactor?parseInt(i.mouseWheel.deltaFactor):s&&t.deltaFactor<100?100:t.deltaFactor||100;if("x"===i.axis||"x"===i.mouseWheel.axis)var d="x",u=[Math.round(r*n.scrollRatio.x),parseInt(i.mouseWheel.scrollAmount)],f="auto"!==i.mouseWheel.scrollAmount?u[1]:u[0]>=l.width()?.9*l.width():u[0],h=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetLeft),m=c[1][0].offsetLeft,p=c[1].parent().width()-c[1].width(),g=t.deltaX||t.deltaY||a;else var d="y",u=[Math.round(r*n.scrollRatio.y),parseInt(i.mouseWheel.scrollAmount)],f="auto"!==i.mouseWheel.scrollAmount?u[1]:u[0]>=l.height()?.9*l.height():u[0],h=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetTop),m=c[0][0].offsetTop,p=c[0].parent().height()-c[0].height(),g=t.deltaY||a;"y"===d&&!n.overflowed[0]||"x"===d&&!n.overflowed[1]||(i.mouseWheel.invert&&(g=-g),i.mouseWheel.normalizeDelta&&(g=0>g?-1:1),(g>0&&0!==m||0>g&&m!==p||i.mouseWheel.preventDefault)&&(t.stopImmediatePropagation(),t.preventDefault()),Q(o,(h-g*f).toString(),{dir:d}))}}var o=e(this),n=o.data(a),i=n.opt,r=a+"_"+n.idx,l=e("#mCSB_"+n.idx),c=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")],d=e("#mCSB_"+n.idx+"_container").find("iframe");n&&(d.length&&d.each(function(){e(this).on('load',function(){L(this)&&e(this.contentDocument||this.contentWindow.document).bind("mousewheel."+r,function(e,o){t(e,o)})})}),l.bind("mousewheel."+r,function(e,o){t(e,o)}))},L=function(e){var t=null;try{var o=e.contentDocument||e.contentWindow.document;t=o.body.innerHTML}catch(a){}return null!==t},A=function(t,o){var n=o.nodeName.toLowerCase(),i=t.data(a).opt.mouseWheel.disableOver,r=["select","textarea"];return e.inArray(n,i)>-1&&!(e.inArray(n,r)>-1&&!e(o).is(":focus"))},P=function(){var t=e(this),o=t.data(a),n=a+"_"+o.idx,i=e("#mCSB_"+o.idx+"_container"),r=i.parent(),l=e(".mCSB_"+o.idx+"_scrollbar ."+d[12]);l.bind("touchstart."+n+" pointerdown."+n+" MSPointerDown."+n,function(){c=!0}).bind("touchend."+n+" pointerup."+n+" MSPointerUp."+n,function(){c=!1}).bind("click."+n,function(a){if(e(a.target).hasClass(d[12])||e(a.target).hasClass("mCSB_draggerRail")){V(t);var n=e(this),l=n.find(".mCSB_dragger");if(n.parent(".mCSB_scrollTools_horizontal").length>0){if(!o.overflowed[1])return;var s="x",c=a.pageX>l.offset().left?-1:1,u=Math.abs(i[0].offsetLeft)-.9*c*r.width()}else{if(!o.overflowed[0])return;var s="y",c=a.pageY>l.offset().top?-1:1,u=Math.abs(i[0].offsetTop)-.9*c*r.height()}Q(t,u.toString(),{dir:s,scrollEasing:"mcsEaseInOut"})}})},z=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=e("#mCSB_"+o.idx+"_container"),l=r.parent();r.bind("focusin."+i,function(){var o=e(document.activeElement),a=r.find(".mCustomScrollBox").length,i=0;o.is(n.advanced.autoScrollOnFocus)&&(V(t),clearTimeout(t[0]._focusTimeout),t[0]._focusTimer=a?(i+17)*a:0,t[0]._focusTimeout=setTimeout(function(){var e=[ot(o)[0],ot(o)[1]],a=[r[0].offsetTop,r[0].offsetLeft],s=[a[0]+e[0]>=0&&a[0]+e[0]<l.height()-o.outerHeight(!1),a[1]+e[1]>=0&&a[0]+e[1]<l.width()-o.outerWidth(!1)],c="yx"!==n.axis||s[0]||s[1]?"all":"none";"x"===n.axis||s[0]||Q(t,e[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i}),"y"===n.axis||s[1]||Q(t,e[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:c,dur:i})},t[0]._focusTimer))})},H=function(){var t=e(this),o=t.data(a),n=a+"_"+o.idx,i=e("#mCSB_"+o.idx+"_container").parent();i.bind("scroll."+n,function(){(0!==i.scrollTop()||0!==i.scrollLeft())&&e(".mCSB_"+o.idx+"_scrollbar").css("visibility","hidden")})},U=function(){var t=e(this),o=t.data(a),n=o.opt,i=o.sequential,r=a+"_"+o.idx,l=".mCSB_"+o.idx+"_scrollbar",s=e(l+">a");s.bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(a){function r(e,o){i.scrollAmount=n.snapAmount||n.scrollButtons.scrollAmount,F(t,e,o)}if(a.preventDefault(),$(a)){var l=e(this).attr("class");switch(i.type=n.scrollButtons.scrollType,a.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===i.type)return;c=!0,o.tweenRunning=!1,r("on",l);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===i.type)return;c=!1,i.dir&&r("off",l);break;case"click":if("stepped"!==i.type||o.tweenRunning)return;r("on",l)}}})},q=function(){function t(t){function a(e,t){r.type=i.keyboard.scrollType,r.scrollAmount=i.snapAmount||i.keyboard.scrollAmount,"stepped"===r.type&&n.tweenRunning||F(o,e,t)}switch(t.type){case"blur":n.tweenRunning&&r.dir&&a("off",null);break;case"keydown":case"keyup":var l=t.keyCode?t.keyCode:t.which,s="on";if("x"!==i.axis&&(38===l||40===l)||"y"!==i.axis&&(37===l||39===l)){if((38===l||40===l)&&!n.overflowed[0]||(37===l||39===l)&&!n.overflowed[1])return;"keyup"===t.type&&(s="off"),e(document.activeElement).is(u)||(t.preventDefault(),t.stopImmediatePropagation(),a(s,l))}else if(33===l||34===l){if((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type){V(o);var f=34===l?-1:1;if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=Math.abs(c[0].offsetLeft)-.9*f*d.width();else var h="y",m=Math.abs(c[0].offsetTop)-.9*f*d.height();Q(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}else if((35===l||36===l)&&!e(document.activeElement).is(u)&&((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type)){if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=35===l?Math.abs(d.width()-c.outerWidth(!1)):0;else var h="y",m=35===l?Math.abs(d.height()-c.outerHeight(!1)):0;Q(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}}var o=e(this),n=o.data(a),i=n.opt,r=n.sequential,l=a+"_"+n.idx,s=e("#mCSB_"+n.idx),c=e("#mCSB_"+n.idx+"_container"),d=c.parent(),u="input,textarea,select,datalist,keygen,[contenteditable='true']",f=c.find("iframe"),h=["blur."+l+" keydown."+l+" keyup."+l];f.length&&f.each(function(){e(this).on('load',function(){L(this)&&e(this.contentDocument||this.contentWindow.document).bind(h[0],function(e){t(e)})})}),s.attr("tabindex","0").bind(h[0],function(e){t(e)})},F=function(t,o,n,i,r){function l(e){var o="stepped"!==f.type,a=r?r:e?o?p/1.5:g:1e3/60,n=e?o?7.5:40:2.5,s=[Math.abs(h[0].offsetTop),Math.abs(h[0].offsetLeft)],d=[c.scrollRatio.y>10?10:c.scrollRatio.y,c.scrollRatio.x>10?10:c.scrollRatio.x],u="x"===f.dir[0]?s[1]+f.dir[1]*d[1]*n:s[0]+f.dir[1]*d[0]*n,m="x"===f.dir[0]?s[1]+f.dir[1]*parseInt(f.scrollAmount):s[0]+f.dir[1]*parseInt(f.scrollAmount),v="auto"!==f.scrollAmount?m:u,x=i?i:e?o?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",_=e?!0:!1;return e&&17>a&&(v="x"===f.dir[0]?s[1]:s[0]),Q(t,v.toString(),{dir:f.dir[0],scrollEasing:x,dur:a,onComplete:_}),e?void(f.dir=!1):(clearTimeout(f.step),void(f.step=setTimeout(function(){l()},a)))}function s(){clearTimeout(f.step),Z(f,"step"),V(t)}var c=t.data(a),u=c.opt,f=c.sequential,h=e("#mCSB_"+c.idx+"_container"),m="stepped"===f.type?!0:!1,p=u.scrollInertia<26?26:u.scrollInertia,g=u.scrollInertia<1?17:u.scrollInertia;switch(o){case"on":if(f.dir=[n===d[16]||n===d[15]||39===n||37===n?"x":"y",n===d[13]||n===d[15]||38===n||37===n?-1:1],V(t),tt(n)&&"stepped"===f.type)return;l(m);break;case"off":s(),(m||c.tweenRunning&&f.dir)&&l(!0)}},Y=function(t){var o=e(this).data(a).opt,n=[];return"function"==typeof t&&(t=t()),t instanceof Array?n=t.length>1?[t[0],t[1]]:"x"===o.axis?[null,t[0]]:[t[0],null]:(n[0]=t.y?t.y:t.x||"x"===o.axis?null:t,n[1]=t.x?t.x:t.y||"y"===o.axis?null:t),"function"==typeof n[0]&&(n[0]=n[0]()),"function"==typeof n[1]&&(n[1]=n[1]()),n},j=function(t,o){if(null!=t&&"undefined"!=typeof t){var n=e(this),i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx+"_container"),s=l.parent(),c=typeof t;o||(o="x"===r.axis?"x":"y");var d="x"===o?l.outerWidth(!1):l.outerHeight(!1),f="x"===o?l[0].offsetLeft:l[0].offsetTop,h="x"===o?"left":"top";switch(c){case"function":return t();case"object":var m=t.jquery?t:e(t);if(!m.length)return;return"x"===o?ot(m)[1]:ot(m)[0];case"string":case"number":if(tt(t))return Math.abs(t);if(-1!==t.indexOf("%"))return Math.abs(d*parseInt(t)/100);if(-1!==t.indexOf("-="))return Math.abs(f-parseInt(t.split("-=")[1]));if(-1!==t.indexOf("+=")){var p=f+parseInt(t.split("+=")[1]);return p>=0?0:Math.abs(p)}if(-1!==t.indexOf("px")&&tt(t.split("px")[0]))return Math.abs(t.split("px")[0]);if("top"===t||"left"===t)return 0;if("bottom"===t)return Math.abs(s.height()-l.outerHeight(!1));if("right"===t)return Math.abs(s.width()-l.outerWidth(!1));if("first"===t||"last"===t){var m=l.find(":"+t);return"x"===o?ot(m)[1]:ot(m)[0]}return e(t).length?"x"===o?ot(e(t))[1]:ot(e(t))[0]:(l.css(h,t),void u.update.call(null,n[0]))}}},X=function(t){function o(){clearTimeout(h[0].autoUpdate),h[0].autoUpdate=setTimeout(function(){return f.advanced.updateOnFilterChange&&(m=r(),m!==w)?(l(3),void(w=m)):(f.advanced.updateOnContentResize&&(p=[h.outerHeight(!1),h.outerWidth(!1),v.height(),v.width(),_()[0],_()[1]],(p[0]!==S[0]||p[1]!==S[1]||p[2]!==S[2]||p[3]!==S[3]||p[4]!==S[4]||p[5]!==S[5])&&(l(p[0]!==S[0]||p[1]!==S[1]),S=p)),f.advanced.updateOnImageLoad&&(g=n(),g!==b&&(h.find("img").each(function(){i(this)}),b=g)),void((f.advanced.updateOnFilterChange||f.advanced.updateOnContentResize||f.advanced.updateOnImageLoad)&&o()))},60)}function n(){var e=0;return f.advanced.updateOnImageLoad&&(e=h.find("img").length),e}function i(t){function o(e,t){return function(){return t.apply(e,arguments)}}function a(){this.onload=null,e(t).addClass(d[2]),l(2)}if(e(t).hasClass(d[2]))return void l();var n=new Image;n.onload=o(n,a),n.src=t.src}function r(){f.advanced.updateOnFilterChange===!0&&(f.advanced.updateOnFilterChange="*");var t=0,o=h.find(f.advanced.updateOnFilterChange);return f.advanced.updateOnFilterChange&&o.length>0&&o.each(function(){t+=e(this).height()+e(this).width()}),t}function l(e){clearTimeout(h[0].autoUpdate),u.update.call(null,s[0],e)}var s=e(this),c=s.data(a),f=c.opt,h=e("#mCSB_"+c.idx+"_container");if(t)return clearTimeout(h[0].autoUpdate),void Z(h[0],"autoUpdate");var m,p,g,v=h.parent(),x=[e("#mCSB_"+c.idx+"_scrollbar_vertical"),e("#mCSB_"+c.idx+"_scrollbar_horizontal")],_=function(){return[x[0].is(":visible")?x[0].outerHeight(!0):0,x[1].is(":visible")?x[1].outerWidth(!0):0]},w=r(),S=[h.outerHeight(!1),h.outerWidth(!1),v.height(),v.width(),_()[0],_()[1]],b=n();o()},N=function(e,t,o){return Math.round(e/t)*t-o},V=function(t){var o=t.data(a),n=e("#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal");n.each(function(){K.call(this)})},Q=function(t,o,n){function i(e){return s&&c.callbacks[e]&&"function"==typeof c.callbacks[e]}function r(){return[c.callbacks.alwaysTriggerOffsets||_>=w[0]+b,c.callbacks.alwaysTriggerOffsets||-C>=_]}function l(){var e=[h[0].offsetTop,h[0].offsetLeft],o=[v[0].offsetTop,v[0].offsetLeft],a=[h.outerHeight(!1),h.outerWidth(!1)],i=[f.height(),f.width()];t[0].mcs={content:h,top:e[0],left:e[1],draggerTop:o[0],draggerLeft:o[1],topPct:Math.round(100*Math.abs(e[0])/(Math.abs(a[0])-i[0])),leftPct:Math.round(100*Math.abs(e[1])/(Math.abs(a[1])-i[1])),direction:n.dir}}var s=t.data(a),c=s.opt,d={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:c.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},n=e.extend(d,n),u=[n.dur,n.drag?0:n.dur],f=e("#mCSB_"+s.idx),h=e("#mCSB_"+s.idx+"_container"),m=h.parent(),p=c.callbacks.onTotalScrollOffset?Y.call(t,c.callbacks.onTotalScrollOffset):[0,0],g=c.callbacks.onTotalScrollBackOffset?Y.call(t,c.callbacks.onTotalScrollBackOffset):[0,0];if(s.trigger=n.trigger,(0!==m.scrollTop()||0!==m.scrollLeft())&&(e(".mCSB_"+s.idx+"_scrollbar").css("visibility","visible"),m.scrollTop(0).scrollLeft(0)),"_resetY"!==o||s.contentReset.y||(i("onOverflowYNone")&&c.callbacks.onOverflowYNone.call(t[0]),s.contentReset.y=1),"_resetX"!==o||s.contentReset.x||(i("onOverflowXNone")&&c.callbacks.onOverflowXNone.call(t[0]),s.contentReset.x=1),"_resetY"!==o&&"_resetX"!==o){switch(!s.contentReset.y&&t[0].mcs||!s.overflowed[0]||(i("onOverflowY")&&c.callbacks.onOverflowY.call(t[0]),s.contentReset.x=null),!s.contentReset.x&&t[0].mcs||!s.overflowed[1]||(i("onOverflowX")&&c.callbacks.onOverflowX.call(t[0]),s.contentReset.x=null),c.snapAmount&&(o=N(o,c.snapAmount,c.snapOffset)),n.dir){case"x":var v=e("#mCSB_"+s.idx+"_dragger_horizontal"),x="left",_=h[0].offsetLeft,w=[f.width()-h.outerWidth(!1),v.parent().width()-v.width()],S=[o,0===o?0:o/s.scrollRatio.x],b=p[1],C=g[1],B=b>0?b/s.scrollRatio.x:0,T=C>0?C/s.scrollRatio.x:0;break;case"y":var v=e("#mCSB_"+s.idx+"_dragger_vertical"),x="top",_=h[0].offsetTop,w=[f.height()-h.outerHeight(!1),v.parent().height()-v.height()],S=[o,0===o?0:o/s.scrollRatio.y],b=p[0],C=g[0],B=b>0?b/s.scrollRatio.y:0,T=C>0?C/s.scrollRatio.y:0}S[1]<0||0===S[0]&&0===S[1]?S=[0,0]:S[1]>=w[1]?S=[w[0],w[1]]:S[0]=-S[0],t[0].mcs||(l(),i("onInit")&&c.callbacks.onInit.call(t[0])),clearTimeout(h[0].onCompleteTimeout),(s.tweenRunning||!(0===_&&S[0]>=0||_===w[0]&&S[0]<=w[0]))&&(G(v[0],x,Math.round(S[1]),u[1],n.scrollEasing),G(h[0],x,Math.round(S[0]),u[0],n.scrollEasing,n.overwrite,{onStart:function(){n.callbacks&&n.onStart&&!s.tweenRunning&&(i("onScrollStart")&&(l(),c.callbacks.onScrollStart.call(t[0])),s.tweenRunning=!0,y(v),s.cbOffsets=r())},onUpdate:function(){n.callbacks&&n.onUpdate&&i("whileScrolling")&&(l(),c.callbacks.whileScrolling.call(t[0]))},onComplete:function(){if(n.callbacks&&n.onComplete){"yx"===c.axis&&clearTimeout(h[0].onCompleteTimeout);var e=h[0].idleTimer||0;h[0].onCompleteTimeout=setTimeout(function(){i("onScroll")&&(l(),c.callbacks.onScroll.call(t[0])),i("onTotalScroll")&&S[1]>=w[1]-B&&s.cbOffsets[0]&&(l(),c.callbacks.onTotalScroll.call(t[0])),i("onTotalScrollBack")&&S[1]<=T&&s.cbOffsets[1]&&(l(),c.callbacks.onTotalScrollBack.call(t[0])),s.tweenRunning=!1,h[0].idleTimer=0,y(v,"hide")},e)}}}))}},G=function(e,t,o,a,n,i,r){function l(){S.stop||(x||m.call(),x=J()-v,s(),x>=S.time&&(S.time=x>S.time?x+f-(x-S.time):x+f-1,S.time<x+1&&(S.time=x+1)),S.time<a?S.id=h(l):g.call())}function s(){a>0?(S.currVal=u(S.time,_,b,a,n),w[t]=Math.round(S.currVal)+"px"):w[t]=o+"px",p.call()}function c(){f=1e3/60,S.time=x+f,h=window.requestAnimationFrame?window.requestAnimationFrame:function(e){return s(),setTimeout(e,.01)},S.id=h(l)}function d(){null!=S.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(S.id):clearTimeout(S.id),S.id=null)}function u(e,t,o,a,n){switch(n){case"linear":case"mcsLinear":return o*e/a+t;case"mcsLinearOut":return e/=a,e--,o*Math.sqrt(1-e*e)+t;case"easeInOutSmooth":return e/=a/2,1>e?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t);case"easeInOutStrong":return e/=a/2,1>e?o/2*Math.pow(2,10*(e-1))+t:(e--,o/2*(-Math.pow(2,-10*e)+2)+t);case"easeInOut":case"mcsEaseInOut":return e/=a/2,1>e?o/2*e*e*e+t:(e-=2,o/2*(e*e*e+2)+t);case"easeOutSmooth":return e/=a,e--,-o*(e*e*e*e-1)+t;case"easeOutStrong":return o*(-Math.pow(2,-10*e/a)+1)+t;case"easeOut":case"mcsEaseOut":default:var i=(e/=a)*e,r=i*e;return t+o*(.499999999999997*r*i+-2.5*i*i+5.5*r+-6.5*i+4*e)}}e._mTween||(e._mTween={top:{},left:{}});var f,h,r=r||{},m=r.onStart||function(){},p=r.onUpdate||function(){},g=r.onComplete||function(){},v=J(),x=0,_=e.offsetTop,w=e.style,S=e._mTween[t];"left"===t&&(_=e.offsetLeft);var b=o-_;S.stop=0,"none"!==i&&d(),c()},J=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},K=function(){var e=this;e._mTween||(e._mTween={top:{},left:{}});for(var t=["top","left"],o=0;o<t.length;o++){var a=t[o];e._mTween[a].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(e._mTween[a].id):clearTimeout(e._mTween[a].id),e._mTween[a].id=null,e._mTween[a].stop=1)}},Z=function(e,t){try{delete e[t]}catch(o){e[t]=null}},$=function(e){return!(e.which&&1!==e.which)},et=function(e){var t=e.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t)},tt=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},ot=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left]};e.fn[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o].defaults=i,window[o]=!0,e(window).on('load',function(){e(n)[o](),e.extend(e.expr[":"],{mcsInView:e.expr[":"].mcsInView||function(t){var o,a,n=e(t),i=n.parents(".mCSB_container");if(i.length)return o=i.parent(),a=[i[0].offsetTop,i[0].offsetLeft],a[0]+ot(n)[0]>=0&&a[0]+ot(n)[0]<o.height()-n.outerHeight(!1)&&a[1]+ot(n)[1]>=0&&a[1]+ot(n)[1]<o.width()-n.outerWidth(!1)},mcsOverflow:e.expr[":"].mcsOverflow||function(t){var o=e(t).data(a);if(o)return o.overflowed[0]||o.overflowed[1]}})})})});
var html4={};html4.atype={'NONE':0,'URI':1,'URI_FRAGMENT':11,'SCRIPT':2,'STYLE':3,'ID':4,'IDREF':5,'IDREFS':6,'GLOBAL_NAME':7,'LOCAL_NAME':8,'CLASSES':9,'FRAME_TARGET':10};html4.ATTRIBS={'*::class':9,'*::dir':0,'*::id':4,'*::lang':0,'*::onclick':2,'*::ondblclick':2,'*::onkeydown':2,'*::onkeypress':2,'*::onkeyup':2,'*::onload':2,'*::onmousedown':2,'*::onmousemove':2,'*::onmouseout':2,'*::onmouseover':2,'*::onmouseup':2,'*::style':3,'*::title':0,'a::accesskey':0,'a::coords':0,'a::href':1,'a::hreflang':0,'a::name':7,'a::onblur':2,'a::onfocus':2,'a::rel':0,'a::rev':0,'a::shape':0,'a::tabindex':0,'a::target':10,'a::type':0,'area::accesskey':0,'area::alt':0,'area::coords':0,'area::href':1,'area::nohref':0,'area::onblur':2,'area::onfocus':2,'area::shape':0,'area::tabindex':0,'area::target':10,'bdo::dir':0,'blockquote::cite':1,'br::clear':0,'button::accesskey':0,'button::disabled':0,'button::name':8,'button::onblur':2,'button::onfocus':2,'button::tabindex':0,'button::type':0,'button::value':0,'caption::align':0,'col::align':0,'col::char':0,'col::charoff':0,'col::span':0,'col::valign':0,'col::width':0,'colgroup::align':0,'colgroup::char':0,'colgroup::charoff':0,'colgroup::span':0,'colgroup::valign':0,'colgroup::width':0,'del::cite':1,'del::datetime':0,'dir::compact':0,'div::align':0,'dl::compact':0,'font::color':0,'font::face':0,'font::size':0,'form::accept':0,'form::action':1,'form::autocomplete':0,'form::enctype':0,'form::method':0,'form::name':7,'form::onreset':2,'form::onsubmit':2,'form::target':10,'h1::align':0,'h2::align':0,'h3::align':0,'h4::align':0,'h5::align':0,'h6::align':0,'hr::align':0,'hr::noshade':0,'hr::size':0,'hr::width':0,'iframe::align':0,'iframe::frameborder':0,'iframe::height':0,'iframe::marginheight':0,'iframe::marginwidth':0,'iframe::width':0,'img::align':0,'img::alt':0,'img::border':0,'img::height':0,'img::hspace':0,'img::ismap':0,'img::name':7,'img::src':1,'img::usemap':11,'img::vspace':0,'img::width':0,'input::accept':0,'input::accesskey':0,'input::align':0,'input::alt':0,'input::autocomplete':0,'input::checked':0,'input::disabled':0,'input::ismap':0,'input::maxlength':0,'input::name':8,'input::onblur':2,'input::onchange':2,'input::onfocus':2,'input::onselect':2,'input::readonly':0,'input::size':0,'input::src':1,'input::tabindex':0,'input::type':0,'input::usemap':11,'input::value':0,'ins::cite':1,'ins::datetime':0,'label::accesskey':0,'label::for':5,'label::onblur':2,'label::onfocus':2,'legend::accesskey':0,'legend::align':0,'li::type':0,'li::value':0,'map::name':7,'menu::compact':0,'ol::compact':0,'ol::start':0,'ol::type':0,'optgroup::disabled':0,'optgroup::label':0,'option::disabled':0,'option::label':0,'option::selected':0,'option::value':0,'p::align':0,'pre::width':0,'q::cite':1,'select::disabled':0,'select::multiple':0,'select::name':8,'select::onblur':2,'select::onchange':2,'select::onfocus':2,'select::size':0,'select::tabindex':0,'table::align':0,'table::bgcolor':0,'table::border':0,'table::cellpadding':0,'table::cellspacing':0,'table::frame':0,'table::rules':0,'table::summary':0,'table::width':0,'tbody::align':0,'tbody::char':0,'tbody::charoff':0,'tbody::valign':0,'td::abbr':0,'td::align':0,'td::axis':0,'td::bgcolor':0,'td::char':0,'td::charoff':0,'td::colspan':0,'td::headers':6,'td::height':0,'td::nowrap':0,'td::rowspan':0,'td::scope':0,'td::valign':0,'td::width':0,'textarea::accesskey':0,'textarea::cols':0,'textarea::disabled':0,'textarea::name':8,'textarea::onblur':2,'textarea::onchange':2,'textarea::onfocus':2,'textarea::onselect':2,'textarea::readonly':0,'textarea::rows':0,'textarea::tabindex':0,'tfoot::align':0,'tfoot::char':0,'tfoot::charoff':0,'tfoot::valign':0,'th::abbr':0,'th::align':0,'th::axis':0,'th::bgcolor':0,'th::char':0,'th::charoff':0,'th::colspan':0,'th::headers':6,'th::height':0,'th::nowrap':0,'th::rowspan':0,'th::scope':0,'th::valign':0,'th::width':0,'thead::align':0,'thead::char':0,'thead::charoff':0,'thead::valign':0,'tr::align':0,'tr::bgcolor':0,'tr::char':0,'tr::charoff':0,'tr::valign':0,'ul::compact':0,'ul::type':0};html4.eflags={'OPTIONAL_ENDTAG':1,'EMPTY':2,'CDATA':4,'RCDATA':8,'UNSAFE':16,'FOLDABLE':32,'SCRIPT':64,'STYLE':128};html4.ELEMENTS={'a':0,'abbr':0,'acronym':0,'address':0,'applet':16,'area':2,'b':0,'base':18,'basefont':18,'bdo':0,'big':0,'blockquote':0,'body':49,'br':2,'button':0,'caption':0,'center':0,'cite':0,'code':0,'col':2,'colgroup':1,'dd':1,'del':0,'dfn':0,'dir':0,'div':0,'dl':0,'dt':1,'em':0,'fieldset':0,'font':0,'form':0,'frame':18,'frameset':16,'h1':0,'h2':0,'h3':0,'h4':0,'h5':0,'h6':0,'head':49,'hr':2,'html':49,'i':0,'iframe':4,'img':2,'input':2,'ins':0,'isindex':18,'kbd':0,'label':0,'legend':0,'li':1,'link':18,'map':0,'menu':0,'meta':18,'noframes':20,'noscript':20,'object':16,'ol':0,'optgroup':0,'option':1,'p':1,'param':18,'pre':0,'q':0,'s':0,'samp':0,'script':84,'select':0,'small':0,'span':0,'strike':0,'strong':0,'style':148,'sub':0,'sup':0,'table':0,'tbody':1,'td':1,'textarea':8,'tfoot':1,'th':1,'thead':1,'title':24,'tr':1,'tt':0,'u':0,'ul':0,'var':0};html4.URIEFFECTS={};html4.LOADERTYPES={}
if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=html4;}
exports.URI=html4;}else{if(typeof window!=='undefined'){window['html4']=html4;}}
var URI=(function(){function parse(uriStr){var m=(''+uriStr).match(URI_RE_);if(!m){return null;}
return new URI(nullIfAbsent(m[1]),nullIfAbsent(m[2]),nullIfAbsent(m[3]),nullIfAbsent(m[4]),nullIfAbsent(m[5]),nullIfAbsent(m[6]),nullIfAbsent(m[7]));}
function create(scheme,credentials,domain,port,path,query,fragment){var uri=new URI(encodeIfExists2(scheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists2(credentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists(domain),port>0?port.toString():null,encodeIfExists2(path,URI_DISALLOWED_IN_PATH_),null,encodeIfExists(fragment));if(query){if('string'===typeof query){uri.setRawQuery(query.replace(/[^?&=0-9A-Za-z_\-~.%]/g,encodeOne));}else{uri.setAllParameters(query);}}
return uri;}
function encodeIfExists(unescapedPart){if('string'==typeof unescapedPart){return encodeURIComponent(unescapedPart);}
return null;};function encodeIfExists2(unescapedPart,extra){if('string'==typeof unescapedPart){return encodeURI(unescapedPart).replace(extra,encodeOne);}
return null;};function encodeOne(ch){var n=ch.charCodeAt(0);return'%'+'0123456789ABCDEF'.charAt((n>>4)&0xf)+'0123456789ABCDEF'.charAt(n&0xf);}
function normPath(path){return path.replace(/(^|\/)\.(?:\/|$)/g,'$1').replace(/\/{2,}/g,'/');}
var PARENT_DIRECTORY_HANDLER=new RegExp(''
+'(/|^)'
+'(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)'
+'/\\.\\.(?:/|$)');var PARENT_DIRECTORY_HANDLER_RE=new RegExp(PARENT_DIRECTORY_HANDLER);var EXTRA_PARENT_PATHS_RE=/^(?:\.\.\/)*(?:\.\.$)?/;function collapse_dots(path){if(path===null){return null;}
var p=normPath(path);var r=PARENT_DIRECTORY_HANDLER_RE;for(var q;(q=p.replace(r,'$1'))!=p;p=q){};return p;}
function resolve(baseUri,relativeUri){var absoluteUri=baseUri.clone();var overridden=relativeUri.hasScheme();if(overridden){absoluteUri.setRawScheme(relativeUri.getRawScheme());}else{overridden=relativeUri.hasCredentials();}
if(overridden){absoluteUri.setRawCredentials(relativeUri.getRawCredentials());}else{overridden=relativeUri.hasDomain();}
if(overridden){absoluteUri.setRawDomain(relativeUri.getRawDomain());}else{overridden=relativeUri.hasPort();}
var rawPath=relativeUri.getRawPath();var simplifiedPath=collapse_dots(rawPath);if(overridden){absoluteUri.setPort(relativeUri.getPort());simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,'');}else{overridden=!!rawPath;if(overridden){if(simplifiedPath.charCodeAt(0)!==0x2f){var absRawPath=collapse_dots(absoluteUri.getRawPath()||'').replace(EXTRA_PARENT_PATHS_RE,'');var slash=absRawPath.lastIndexOf('/')+1;simplifiedPath=collapse_dots((slash?absRawPath.substring(0,slash):'')
+collapse_dots(rawPath)).replace(EXTRA_PARENT_PATHS_RE,'');}}else{simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,'');if(simplifiedPath!==rawPath){absoluteUri.setRawPath(simplifiedPath);}}}
if(overridden){absoluteUri.setRawPath(simplifiedPath);}else{overridden=relativeUri.hasQuery();}
if(overridden){absoluteUri.setRawQuery(relativeUri.getRawQuery());}else{overridden=relativeUri.hasFragment();}
if(overridden){absoluteUri.setRawFragment(relativeUri.getRawFragment());}
return absoluteUri;}
function URI(rawScheme,rawCredentials,rawDomain,port,rawPath,rawQuery,rawFragment){this.scheme_=rawScheme;this.credentials_=rawCredentials;this.domain_=rawDomain;this.port_=port;this.path_=rawPath;this.query_=rawQuery;this.fragment_=rawFragment;this.paramCache_=null;}
URI.prototype.toString=function(){var out=[];if(null!==this.scheme_){out.push(this.scheme_,':');}
if(null!==this.domain_){out.push('//');if(null!==this.credentials_){out.push(this.credentials_,'@');}
out.push(this.domain_);if(null!==this.port_){out.push(':',this.port_.toString());}}
if(null!==this.path_){out.push(this.path_);}
if(null!==this.query_){out.push('?',this.query_);}
if(null!==this.fragment_){out.push('#',this.fragment_);}
return out.join('');};URI.prototype.clone=function(){return new URI(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_);};URI.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase();};URI.prototype.getRawScheme=function(){return this.scheme_;};URI.prototype.setScheme=function(newScheme){this.scheme_=encodeIfExists2(newScheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this;};URI.prototype.setRawScheme=function(newScheme){this.scheme_=newScheme?newScheme:null;return this;};URI.prototype.hasScheme=function(){return null!==this.scheme_;};URI.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_);};URI.prototype.getRawCredentials=function(){return this.credentials_;};URI.prototype.setCredentials=function(newCredentials){this.credentials_=encodeIfExists2(newCredentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_);return this;};URI.prototype.setRawCredentials=function(newCredentials){this.credentials_=newCredentials?newCredentials:null;return this;};URI.prototype.hasCredentials=function(){return null!==this.credentials_;};URI.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_);};URI.prototype.getRawDomain=function(){return this.domain_;};URI.prototype.setDomain=function(newDomain){return this.setRawDomain(newDomain&&encodeURIComponent(newDomain));};URI.prototype.setRawDomain=function(newDomain){this.domain_=newDomain?newDomain:null;return this.setRawPath(this.path_);};URI.prototype.hasDomain=function(){return null!==this.domain_;};URI.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_);};URI.prototype.setPort=function(newPort){if(newPort){newPort=Number(newPort);if(newPort!==(newPort&0xffff)){throw new Error('Bad port number '+newPort);}
this.port_=''+newPort;}else{this.port_=null;}
return this;};URI.prototype.hasPort=function(){return null!==this.port_;};URI.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_);};URI.prototype.getRawPath=function(){return this.path_;};URI.prototype.setPath=function(newPath){return this.setRawPath(encodeIfExists2(newPath,URI_DISALLOWED_IN_PATH_));};URI.prototype.setRawPath=function(newPath){if(newPath){newPath=String(newPath);this.path_=(!this.domain_||/^\//.test(newPath))?newPath:'/'+newPath;}else{this.path_=null;}
return this;};URI.prototype.hasPath=function(){return null!==this.path_;};URI.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g,' ');};URI.prototype.getRawQuery=function(){return this.query_;};URI.prototype.setQuery=function(newQuery){this.paramCache_=null;this.query_=encodeIfExists(newQuery);return this;};URI.prototype.setRawQuery=function(newQuery){this.paramCache_=null;this.query_=newQuery?newQuery:null;return this;};URI.prototype.hasQuery=function(){return null!==this.query_;};URI.prototype.setAllParameters=function(params){if(typeof params==='object'){if(!(params instanceof Array)&&(params instanceof Object||Object.prototype.toString.call(params)!=='[object Array]')){var newParams=[];var i=-1;for(var k in params){var v=params[k];if('string'===typeof v){newParams[++i]=k;newParams[++i]=v;}}
params=newParams;}}
this.paramCache_=null;var queryBuf=[];var separator='';for(var j=0;j<params.length;){var k=params[j++];var v=params[j++];queryBuf.push(separator,encodeURIComponent(k.toString()));separator='&';if(v){queryBuf.push('=',encodeURIComponent(v.toString()));}}
this.query_=queryBuf.join('');return this;};URI.prototype.checkParameterCache_=function(){if(!this.paramCache_){var q=this.query_;if(!q){this.paramCache_=[];}else{var cgiParams=q.split(/[&\?]/);var out=[];var k=-1;for(var i=0;i<cgiParams.length;++i){var m=cgiParams[i].match(/^([^=]*)(?:=(.*))?$/);out[++k]=decodeURIComponent(m[1]).replace(/\+/g,' ');out[++k]=decodeURIComponent(m[2]||'').replace(/\+/g,' ');}
this.paramCache_=out;}}};URI.prototype.setParameterValues=function(key,values){if(typeof values==='string'){values=[values];}
this.checkParameterCache_();var newValueIndex=0;var pc=this.paramCache_;var params=[];for(var i=0,k=0;i<pc.length;i+=2){if(key===pc[i]){if(newValueIndex<values.length){params.push(key,values[newValueIndex++]);}}else{params.push(pc[i],pc[i+1]);}}
while(newValueIndex<values.length){params.push(key,values[newValueIndex++]);}
this.setAllParameters(params);return this;};URI.prototype.removeParameter=function(key){return this.setParameterValues(key,[]);};URI.prototype.getAllParameters=function(){this.checkParameterCache_();return this.paramCache_.slice(0,this.paramCache_.length);};URI.prototype.getParameterValues=function(paramNameUnescaped){this.checkParameterCache_();var values=[];for(var i=0;i<this.paramCache_.length;i+=2){if(paramNameUnescaped===this.paramCache_[i]){values.push(this.paramCache_[i+1]);}}
return values;};URI.prototype.getParameterMap=function(paramNameUnescaped){this.checkParameterCache_();var paramMap={};for(var i=0;i<this.paramCache_.length;i+=2){var key=this.paramCache_[i++],value=this.paramCache_[i++];if(!(key in paramMap)){paramMap[key]=[value];}else{paramMap[key].push(value);}}
return paramMap;};URI.prototype.getParameterValue=function(paramNameUnescaped){this.checkParameterCache_();for(var i=0;i<this.paramCache_.length;i+=2){if(paramNameUnescaped===this.paramCache_[i]){return this.paramCache_[i+1];}}
return null;};URI.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_);};URI.prototype.getRawFragment=function(){return this.fragment_;};URI.prototype.setFragment=function(newFragment){this.fragment_=newFragment?encodeURIComponent(newFragment):null;return this;};URI.prototype.setRawFragment=function(newFragment){this.fragment_=newFragment?newFragment:null;return this;};URI.prototype.hasFragment=function(){return null!==this.fragment_;};function nullIfAbsent(matchPart){return('string'==typeof matchPart)&&(matchPart.length>0)?matchPart:null;}
var URI_RE_=new RegExp("^"+"(?:"+"([^:/?#]+)"+":)?"+"(?://"+"(?:([^/?#]*)@)?"+"([^/?#:@]*)"+"(?::([0-9]+))?"+")?"+"([^?#]+)?"+"(?:\\?([^#]*))?"+"(?:#(.*))?"+"$");var URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_=/[#\/\?@]/g;var URI_DISALLOWED_IN_PATH_=/[\#\?]/g;URI.parse=parse;URI.create=create;URI.resolve=resolve;URI.collapse_dots=collapse_dots;URI.utils={mimeTypeOf:function(uri){var uriObj=parse(uri);if(/\.html$/.test(uriObj.getPath())){return'text/html';}else{return'application/javascript';}},resolve:function(base,uri){if(base){return resolve(parse(base),parse(uri)).toString();}else{return''+uri;}}};return URI;})();if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=URI;}
exports.URI=URI;}else{if(typeof window!=='undefined'){window['URI']=URI;}}
if('I'.toLowerCase()!=='i'){throw'I/i problem';}
var html=(function(html4){var parseCssDeclarations,sanitizeCssProperty,cssSchema;if('undefined'!==typeof window){parseCssDeclarations=window['parseCssDeclarations'];sanitizeCssProperty=window['sanitizeCssProperty'];cssSchema=window['cssSchema'];}
var ENTITIES={'lt':'<','LT':'<','gt':'>','GT':'>','amp':'&','AMP':'&','quot':'"','apos':'\'','nbsp':'\u00a0'};var decimalEscapeRe=/^#(\d+)$/;var hexEscapeRe=/^#x([0-9A-Fa-f]+)$/;var safeEntityNameRe=/^[A-Za-z][A-za-z0-9]+$/;var entityLookupElement=('undefined'!==typeof window&&window['document'])?window['document'].createElement('textarea'):null;function lookupEntity(name){if(ENTITIES.hasOwnProperty(name)){return ENTITIES[name];}
var m=name.match(decimalEscapeRe);if(m){return String.fromCharCode(parseInt(m[1],10));}else if(!!(m=name.match(hexEscapeRe))){return String.fromCharCode(parseInt(m[1],16));}else if(entityLookupElement&&safeEntityNameRe.test(name)){entityLookupElement.innerHTML='&'+name+';';var text=entityLookupElement.textContent;ENTITIES[name]=text;return text;}else{return'&'+name+';';}}
function decodeOneEntity(_,name){return lookupEntity(name);}
var nulRe=/\0/g;function stripNULs(s){return s.replace(nulRe,'');}
var ENTITY_RE_1=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g;var ENTITY_RE_2=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/;function unescapeEntities(s){if(s){return s.replace(ENTITY_RE_1,decodeOneEntity);}
else{return s;}}
var ampRe=/&/g;var looseAmpRe=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;var ltRe=/[<]/g;var gtRe=/>/g;var quotRe=/\"/g;function escapeAttrib(s){if(s){return(''+s).replace(ampRe,'&amp;').replace(ltRe,'&lt;').replace(gtRe,'&gt;').replace(quotRe,'&#34;');}
else{return s;}}
function normalizeRCData(rcdata){if(rcdata){return rcdata.replace(looseAmpRe,'&amp;$1').replace(ltRe,'&lt;').replace(gtRe,'&gt;');}
else{return rcdata;}}
var ATTR_RE=new RegExp('^\\s*'+'([-.:\\w]+)'+'(?:'+('\\s*(=)\\s*'+'('+('(\")[^\"]*(\"|$)'+'|'+'(\')[^\']*(\'|$)'+'|'+'(?=[a-z][-\\w]*\\s*=)'+'|'+'[^\"\'\\s]*')+')')+')?','i');var splitWillCapture=('a,b'.split(/(,)/).length===3);var EFLAGS_TEXT=html4.eflags['CDATA']|html4.eflags['RCDATA'];function makeSaxParser(handler){var hcopy={cdata:handler.cdata||handler['cdata'],comment:handler.comment||handler['comment'],endDoc:handler.endDoc||handler['endDoc'],endTag:handler.endTag||handler['endTag'],pcdata:handler.pcdata||handler['pcdata'],rcdata:handler.rcdata||handler['rcdata'],startDoc:handler.startDoc||handler['startDoc'],startTag:handler.startTag||handler['startTag']};return function(htmlText,param){return parse(htmlText,hcopy,param);};}
var continuationMarker={};function parse(htmlText,handler,param){var m,p,tagName;var parts=htmlSplit(htmlText);var state={noMoreGT:false,noMoreEndComments:false};parseCPS(handler,parts,0,state,param);}
function continuationMaker(h,parts,initial,state,param){return function(){parseCPS(h,parts,initial,state,param);};}
function parseCPS(h,parts,initial,state,param){try{if(h.startDoc&&initial==0){h.startDoc(param);}
var m,p,tagName;for(var pos=initial,end=parts.length;pos<end;){var current=parts[pos++];var next=parts[pos];switch(current){case'&':if(ENTITY_RE_2.test(next)){if(h.pcdata){h.pcdata('&'+next,param,continuationMarker,continuationMaker(h,parts,pos,state,param));}
pos++;}else{if(h.pcdata){h.pcdata("&amp;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}
break;case'<\/':if((m=/^([-\w:]+)[^\'\"]*/.exec(next))){if(m[0].length===next.length&&parts[pos+1]==='>'){pos+=2;tagName=m[1].toLowerCase();if(h.endTag){h.endTag(tagName,param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}else{pos=parseEndTag(parts,pos,h,param,continuationMarker,state);}}else{if(h.pcdata){h.pcdata('&lt;/',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}
break;case'<':if(m=/^([-\w:]+)\s*\/?/.exec(next)){if(m[0].length===next.length&&parts[pos+1]==='>'){pos+=2;tagName=m[1].toLowerCase();if(h.startTag){h.startTag(tagName,[],param,continuationMarker,continuationMaker(h,parts,pos,state,param));}
var eflags=html4.ELEMENTS[tagName];if(eflags&EFLAGS_TEXT){var tag={name:tagName,next:pos,eflags:eflags};pos=parseText(parts,tag,h,param,continuationMarker,state);}}else{pos=parseStartTag(parts,pos,h,param,continuationMarker,state);}}else{if(h.pcdata){h.pcdata('&lt;',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}
break;case'<\!--':if(!state.noMoreEndComments){for(p=pos+1;p<end;p++){if(parts[p]==='>'&&/--$/.test(parts[p-1])){break;}}
if(p<end){if(h.comment){var comment=parts.slice(pos,p).join('');h.comment(comment.substr(0,comment.length-2),param,continuationMarker,continuationMaker(h,parts,p+1,state,param));}
pos=p+1;}else{state.noMoreEndComments=true;}}
if(state.noMoreEndComments){if(h.pcdata){h.pcdata('&lt;!--',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}
break;case'<\!':if(!/^\w/.test(next)){if(h.pcdata){h.pcdata('&lt;!',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}else{if(!state.noMoreGT){for(p=pos+1;p<end;p++){if(parts[p]==='>'){break;}}
if(p<end){pos=p+1;}else{state.noMoreGT=true;}}
if(state.noMoreGT){if(h.pcdata){h.pcdata('&lt;!',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}}
break;case'<?':if(!state.noMoreGT){for(p=pos+1;p<end;p++){if(parts[p]==='>'){break;}}
if(p<end){pos=p+1;}else{state.noMoreGT=true;}}
if(state.noMoreGT){if(h.pcdata){h.pcdata('&lt;?',param,continuationMarker,continuationMaker(h,parts,pos,state,param));}}
break;case'>':if(h.pcdata){h.pcdata("&gt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));}
break;case'':break;default:if(h.pcdata){h.pcdata(current,param,continuationMarker,continuationMaker(h,parts,pos,state,param));}
break;}}
if(h.endDoc){h.endDoc(param);}}catch(e){if(e!==continuationMarker){throw e;}}}
function htmlSplit(str){var re=/(<\/|<\!--|<[!?]|[&<>])/g;str+='';if(splitWillCapture){return str.split(re);}else{var parts=[];var lastPos=0;var m;while((m=re.exec(str))!==null){parts.push(str.substring(lastPos,m.index));parts.push(m[0]);lastPos=m.index+m[0].length;}
parts.push(str.substring(lastPos));return parts;}}
function parseEndTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);if(!tag){return parts.length;}
if(h.endTag){h.endTag(tag.name,param,continuationMarker,continuationMaker(h,parts,pos,state,param));}
return tag.next;}
function parseStartTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);if(!tag){return parts.length;}
if(h.startTag){h.startTag(tag.name,tag.attrs,param,continuationMarker,continuationMaker(h,parts,tag.next,state,param));}
if(tag.eflags&EFLAGS_TEXT){return parseText(parts,tag,h,param,continuationMarker,state);}else{return tag.next;}}
var endTagRe={};function parseText(parts,tag,h,param,continuationMarker,state){var end=parts.length;if(!endTagRe.hasOwnProperty(tag.name)){endTagRe[tag.name]=new RegExp('^'+tag.name+'(?:[\\s\\/]|$)','i');}
var re=endTagRe[tag.name];var first=tag.next;var p=tag.next+1;for(;p<end;p++){if(parts[p-1]==='<\/'&&re.test(parts[p])){break;}}
if(p<end){p-=1;}
var buf=parts.slice(first,p).join('');if(tag.eflags&html4.eflags['CDATA']){if(h.cdata){h.cdata(buf,param,continuationMarker,continuationMaker(h,parts,p,state,param));}}else if(tag.eflags&html4.eflags['RCDATA']){if(h.rcdata){h.rcdata(normalizeRCData(buf),param,continuationMarker,continuationMaker(h,parts,p,state,param));}}else{throw new Error('bug');}
return p;}
function parseTagAndAttrs(parts,pos){var m=/^([-\w:]+)/.exec(parts[pos]);var tag={};tag.name=m[1].toLowerCase();tag.eflags=html4.ELEMENTS[tag.name];var buf=parts[pos].substr(m[0].length);var p=pos+1;var end=parts.length;for(;p<end;p++){if(parts[p]==='>'){break;}
buf+=parts[p];}
if(end<=p){return void 0;}
var attrs=[];while(buf!==''){m=ATTR_RE.exec(buf);if(!m){buf=buf.replace(/^[\s\S][^a-z\s]*/,'');}else if((m[4]&&!m[5])||(m[6]&&!m[7])){var quote=m[4]||m[6];var sawQuote=false;var abuf=[buf,parts[p++]];for(;p<end;p++){if(sawQuote){if(parts[p]==='>'){break;}}else if(0<=parts[p].indexOf(quote)){sawQuote=true;}
abuf.push(parts[p]);}
if(end<=p){break;}
buf=abuf.join('');continue;}else{var aName=m[1].toLowerCase();var aValue=m[2]?decodeValue(m[3]):'';attrs.push(aName,aValue);buf=buf.substr(m[0].length);}}
tag.attrs=attrs;tag.next=p+1;return tag;}
function decodeValue(v){var q=v.charCodeAt(0);if(q===0x22||q===0x27){v=v.substr(1,v.length-2);}
return unescapeEntities(stripNULs(v));}
function makeHtmlSanitizer(tagPolicy){var stack;var ignoring;var emit=function(text,out){if(!ignoring){out.push(text);}};return makeSaxParser({'startDoc':function(_){stack=[];ignoring=false;},'startTag':function(tagNameOrig,attribs,out){if(ignoring){return;}
if(!html4.ELEMENTS.hasOwnProperty(tagNameOrig)){return;}
var eflagsOrig=html4.ELEMENTS[tagNameOrig];if(eflagsOrig&html4.eflags['FOLDABLE']){return;}
var decision=tagPolicy(tagNameOrig,attribs);if(!decision){ignoring=!(eflagsOrig&html4.eflags['EMPTY']);return;}else if(typeof decision!=='object'){throw new Error('tagPolicy did not return object (old API?)');}
if('attribs'in decision){attribs=decision['attribs'];}else{throw new Error('tagPolicy gave no attribs');}
var eflagsRep;var tagNameRep;if('tagName'in decision){tagNameRep=decision['tagName'];eflagsRep=html4.ELEMENTS[tagNameRep];}else{tagNameRep=tagNameOrig;eflagsRep=eflagsOrig;}
if(eflagsOrig&html4.eflags['OPTIONAL_ENDTAG']){var onStack=stack[stack.length-1];if(onStack&&onStack.orig===tagNameOrig&&(onStack.rep!==tagNameRep||tagNameOrig!==tagNameRep)){out.push('<\/',onStack.rep,'>');}}
if(!(eflagsOrig&html4.eflags['EMPTY'])){stack.push({orig:tagNameOrig,rep:tagNameRep});}
out.push('<',tagNameRep);for(var i=0,n=attribs.length;i<n;i+=2){var attribName=attribs[i],value=attribs[i+1];if(value!==null&&value!==void 0){out.push(' ',attribName,'="',escapeAttrib(value),'"');}}
out.push('>');if((eflagsOrig&html4.eflags['EMPTY'])&&!(eflagsRep&html4.eflags['EMPTY'])){out.push('<\/',tagNameRep,'>');}},'endTag':function(tagName,out){if(ignoring){ignoring=false;return;}
if(!html4.ELEMENTS.hasOwnProperty(tagName)){return;}
var eflags=html4.ELEMENTS[tagName];if(!(eflags&(html4.eflags['EMPTY']|html4.eflags['FOLDABLE']))){var index;if(eflags&html4.eflags['OPTIONAL_ENDTAG']){for(index=stack.length;--index>=0;){var stackElOrigTag=stack[index].orig;if(stackElOrigTag===tagName){break;}
if(!(html4.ELEMENTS[stackElOrigTag]&html4.eflags['OPTIONAL_ENDTAG'])){return;}}}else{for(index=stack.length;--index>=0;){if(stack[index].orig===tagName){break;}}}
if(index<0){return;}
for(var i=stack.length;--i>index;){var stackElRepTag=stack[i].rep;if(!(html4.ELEMENTS[stackElRepTag]&html4.eflags['OPTIONAL_ENDTAG'])){out.push('<\/',stackElRepTag,'>');}}
if(index<stack.length){tagName=stack[index].rep;}
stack.length=index;out.push('<\/',tagName,'>');}},'pcdata':emit,'rcdata':emit,'cdata':emit,'endDoc':function(out){for(;stack.length;stack.length--){out.push('<\/',stack[stack.length-1].rep,'>');}}});}
var ALLOWED_URI_SCHEMES=/^(?:https?|mailto)$/i;function safeUri(uri,effect,ltype,hints,naiveUriRewriter){if(!naiveUriRewriter){return null;}
try{var parsed=URI.parse(''+uri);if(parsed){if(!parsed.hasScheme()||ALLOWED_URI_SCHEMES.test(parsed.getScheme())){var safe=naiveUriRewriter(parsed,effect,ltype,hints);return safe?safe.toString():null;}}}catch(e){return null;}
return null;}
function log(logger,tagName,attribName,oldValue,newValue){if(!attribName){logger(tagName+" removed",{change:"removed",tagName:tagName});}
if(oldValue!==newValue){var changed="changed";if(oldValue&&!newValue){changed="removed";}else if(!oldValue&&newValue){changed="added";}
logger(tagName+"."+attribName+" "+changed,{change:changed,tagName:tagName,attribName:attribName,oldValue:oldValue,newValue:newValue});}}
function lookupAttribute(map,tagName,attribName){var attribKey;attribKey=tagName+'::'+attribName;if(map.hasOwnProperty(attribKey)){return map[attribKey];}
attribKey='*::'+attribName;if(map.hasOwnProperty(attribKey)){return map[attribKey];}
return void 0;}
function getAttributeType(tagName,attribName){return lookupAttribute(html4.ATTRIBS,tagName,attribName);}
function getLoaderType(tagName,attribName){return lookupAttribute(html4.LOADERTYPES,tagName,attribName);}
function getUriEffect(tagName,attribName){return lookupAttribute(html4.URIEFFECTS,tagName,attribName);}
function sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){for(var i=0;i<attribs.length;i+=2){var attribName=attribs[i];var value=attribs[i+1];var oldValue=value;var atype=null,attribKey;if((attribKey=tagName+'::'+attribName,html4.ATTRIBS.hasOwnProperty(attribKey))||(attribKey='*::'+attribName,html4.ATTRIBS.hasOwnProperty(attribKey))){atype=html4.ATTRIBS[attribKey];}
if(atype!==null){switch(atype){case html4.atype['NONE']:break;case html4.atype['SCRIPT']:value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}
break;case html4.atype['STYLE']:if('undefined'===typeof parseCssDeclarations){value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}
break;}
var sanitizedDeclarations=[];parseCssDeclarations(value,{'declaration':function(property,tokens){var normProp=property.toLowerCase();sanitizeCssProperty(normProp,tokens,opt_naiveUriRewriter?function(url){return safeUri(url,html4.ueffects.SAME_DOCUMENT,html4.ltypes.SANDBOXED,{"TYPE":"CSS","CSS_PROP":normProp},opt_naiveUriRewriter);}:null);if(tokens.length){sanitizedDeclarations.push(normProp+': '+tokens.join(' '));}}});value=sanitizedDeclarations.length>0?sanitizedDeclarations.join(' ; '):null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}
break;case html4.atype['ID']:case html4.atype['IDREF']:case html4.atype['IDREFS']:case html4.atype['GLOBAL_NAME']:case html4.atype['LOCAL_NAME']:case html4.atype['CLASSES']:value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}
break;case html4.atype['URI']:value=safeUri(value,getUriEffect(tagName,attribName),getLoaderType(tagName,attribName),{"TYPE":"MARKUP","XML_ATTR":attribName,"XML_TAG":tagName},opt_naiveUriRewriter);if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}
break;case html4.atype['URI_FRAGMENT']:if(value&&'#'===value.charAt(0)){value=value.substring(1);value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value;if(value!==null&&value!==void 0){value='#'+value;}}else{value=null;}
if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}
break;default:value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}
break;}}else{value=null;if(opt_logger){log(opt_logger,tagName,attribName,oldValue,value);}}
attribs[i+1]=value;}
return attribs;}
function makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){return function(tagName,attribs){if(!(html4.ELEMENTS[tagName]&html4.eflags['UNSAFE'])){return{'attribs':sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger)};}else{if(opt_logger){log(opt_logger,tagName,undefined,undefined,undefined);}}};}
function sanitizeWithPolicy(inputHtml,tagPolicy){var outputArray=[];makeHtmlSanitizer(tagPolicy)(inputHtml,outputArray);return outputArray.join('');}
function sanitize(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){var tagPolicy=makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger);return sanitizeWithPolicy(inputHtml,tagPolicy);}
var html={};html.escapeAttrib=html['escapeAttrib']=escapeAttrib;html.makeHtmlSanitizer=html['makeHtmlSanitizer']=makeHtmlSanitizer;html.makeSaxParser=html['makeSaxParser']=makeSaxParser;html.makeTagPolicy=html['makeTagPolicy']=makeTagPolicy;html.normalizeRCData=html['normalizeRCData']=normalizeRCData;html.sanitize=html['sanitize']=sanitize;html.sanitizeAttribs=html['sanitizeAttribs']=sanitizeAttribs;html.sanitizeWithPolicy=html['sanitizeWithPolicy']=sanitizeWithPolicy;html.unescapeEntities=html['unescapeEntities']=unescapeEntities;return html;})(html4);var html_sanitize=html['sanitize'];if(typeof window!=='undefined'){window['html']=html;window['html_sanitize']=html_sanitize;}
var Sanitizer={};Sanitizer.escapeAttrib=html.escapeAttrib;Sanitizer.makeHtmlSanitizer=html.makeHtmlSanitizer;Sanitizer.makeSaxParser=html.makeSaxParser;Sanitizer.makeTagPolicy=html.makeTagPolicy;Sanitizer.normalizeRCData=html.normalizeRCData
Sanitizer.sanitizeAttribs=html.sanitizeAttribs
Sanitizer.sanitizeWithPolicy=html.sanitizeWithPolicy
Sanitizer.unescapeEntities=html.unescapeEntities
Sanitizer.escape=html.escapeAttrib;Sanitizer.sanitize=function(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){if(typeof(inputHtml)==="string"){inputHtml=inputHtml.replace(/<([a-zA-Z]+)([^>]*)\/>/g,'<$1$2></$1>');}
if(inputHtml){return html.sanitize(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger);}
else{return inputHtml;}}
if(typeof exports!=='undefined'){if(typeof module!=='undefined'&&module.exports){exports=module.exports=Sanitizer;}
exports.Sanitizer=Sanitizer;}else{this.Sanitizer=Sanitizer;}
var BaseEvents=(function(_,Base,Backbone){var rest=_.rest;function extendClass(TargetClass){return Base.extend.apply(TargetClass,rest(arguments));}
function addSelfExtend(TargetClass){return extendClass(TargetClass,{},{extend:Base.extend});}
function addEvents(TargetClass){return extendClass(TargetClass,Backbone.Events);}
function convertClass(TargetClass){return extendClass(addEvents(addSelfExtend(TargetClass)),arguments[1],arguments[2]);}
var exports=convertClass(Base);exports.extendClass=extendClass;exports.convertClass=convertClass;exports.extendWithEvents=convertClass;return exports;})(_,Base,Backbone);var BaseCollection=(function(BaseEvents){var Collection=BaseEvents.convertClass(Array,{push:function(){var ret=this.base.apply(this,arguments),args=[].slice.call(arguments);for(var i=0,len=args.length;i<len;i++){this.trigger('add',args[i],ret-len+i);}
this.trigger('change');return ret;},pop:function(){var ret=this.base.apply(this,arguments);this.trigger('remove',ret,this.length);this.trigger('change');return ret;}});return Collection;})(BaseEvents);var BaseView=(function(_,$,Mustache,BaseEvents,Backbone){var View=BaseEvents.convertClass(Backbone.View,{initialize:function(config){this.setModel(config.model);this.setElement($(config.target));},getModel:function(){return this.model;},setModel:function(model){this.stopListening();this.model=model;this.bindToModel();},bindToModel:function(){this.listenTo(this.getModel(),'change',this.render);},render:function(){return this.$el.html(Mustache.render(this.template,this.model.toJSON()));}});return View;})(_,$,Mustache,BaseEvents,Backbone);var BaseModel=(function(_,BaseEvents,Backbone){var Model=BaseEvents.convertClass(Backbone.Model);return Model;})(_,BaseEvents,Backbone);var BaseController=(function(_,BaseEvents,BaseCollection){function SeedController(views,models){this.views=new BaseCollection(views);this.models=new BaseCollection(models);}
var Controller=BaseEvents.convertClass(SeedController,{addView:function(){var ret=this.views.push.apply(this.views,arguments);return ret;},removeView:function(){var ret=this.views.pop.apply(this.views,arguments);return ret;},addModel:function(){var ret=this.models.push.apply(this.models,arguments);return ret;},removeModel:function(){var ret=this.models.pop.apply(this.models,arguments);return ret;}});return Controller;})(_,BaseEvents,BaseCollection);var BaseElement=(function(Base,_){var isFunction=_.isFunction,isArray=_.isArray,reduce=_.reduce;var Element=Base.extend({initialize:function(opts){this.base(opts);this._normalizeInputHandlers(opts.inputHandlers);},_normalizeInputHandlers:function(){this._inputHandlers=isArray(this.inputHandlers)?this.inputHandlers:isFunction(this.inputHandlers)?[this.inputHandlers]:[];},_bindOutputHandlers:function(){},_inputController:function(newData){var model=this.model,transformedData=reduce(this._inputHandlers,function(acc,handler){return handler(acc,model);},newData);model.set(transformedData);},_getViewElement:function(){return this.view.$el;},update:function(newData){this._inputController(newData);return this._getViewElement();}});return Element;})(Base,_);'use strict';var TreeFilter;TreeFilter=(function(){return TreeFilter={Models:{},Views:{},Controllers:{},SelectionStrategies:{},DataHandlers:{},Extensions:{Sorters:{},Renderers:{}},defaults:{},templates:{},count:0,Enum:{select:{SOME:null,NONE:false,ALL:true},selectionStrategy:{'LimitedSelect':{Root:{options:{className:'multi-select',showCommitButtons:true,showSelectedItems:false,showNumberOfSelectedItems:true,showGroupSelection:true,label:'All'}},Item:{options:{showButtonOnlyThis:true}},selectionStrategy:{type:'LimitedSelect',limit:500},output:{trigger:'apply'}},'MultiSelect':{Root:{options:{className:'multi-select',showCommitButtons:true,showSelectedItems:false,showNumberOfSelectedItems:true,showGroupSelection:true,label:'All'}},Item:{options:{showButtonOnlyThis:true}},selectionStrategy:{type:'MultiSelect'},output:{trigger:'apply'}},'SingleSelect':{Root:{options:{className:'single-select',showCommitButtons:false,showSelectedItems:true,showNumberOfSelectedItems:false,showGroupSelection:false}},Item:{options:{showButtonOnlyThis:false}},selectionStrategy:{type:'SingleSelect'},output:{trigger:'apply'}}}}};})();'use strict';(function(TreeFilter){return TreeFilter.defaults=function(){var defaults,privateDefaults;privateDefaults={logLevel:"log",pagination:{throttleTimeMilliseconds:500},Root:{renderers:void 0,sorter:void 0,view:{styles:[],throttleTimeMilliseconds:10,templates:{},slots:{selection:'.filter-root-control',header:'.filter-root-header',footer:'.filter-root-footer',children:'.filter-root-items',overlay:'.filter-overlay'},childConfig:{withChildrenPrototype:'Group',withoutChildrenPrototype:'Item',className:'filter-root-child',appendTo:'.filter-root-items'},overlaySimulateClick:true}},Group:{renderers:void 0,sorter:void 0,view:{throttleTimeMilliseconds:10,templates:{},slots:{selection:'.filter-group-header:eq(0)',children:'.filter-group-items'},childConfig:{withChildrenPrototype:'Group',withoutChildrenPrototype:'Item',className:'filter-group-child'}}},Item:{renderers:void 0,sorter:void 0,view:{styles:[],throttleTimeMilliseconds:10,templates:{},slots:{selection:'.filter-item-container'}}}};return defaults=$.extend(true,{},privateDefaults,{pagination:{pageSize:Infinity},search:{serverSide:false,matcher:undefined},selectionStrategy:{type:'LimitedSelect',limit:500},Root:{options:{className:'multi-select',styles:void 0,showCommitButtons:true,showFilter:false,showGroupSelection:true,showButtonOnlyThis:false,showSelectedItems:false,showNumberOfSelectedItems:true,showValue:false,showIcons:true,scrollThreshold:12,isResizable:true,useOverlay:true,expandMode:'absolute'},strings:{isDisabled:'Unavailable',allItems:'All',noItems:'None',groupSelection:'All',btnApply:'Apply',btnCancel:'Cancel'},view:{scrollbar:{engine:'mCustomScrollbar',options:{theme:'dark',alwaysTriggerOffsets:false,onTotalScrollOffset:100}}}},Group:{options:{showFilter:false,showCommitButtons:false,showGroupSelection:false,showButtonOnlyThis:false,showButtonCollapse:false,showValue:false,showIcons:true,scrollThreshold:Infinity,isResizable:false},strings:{allItems:'All',noItems:'None',groupSelection:'All',btnApply:'Apply',btnCancel:'Cancel'}},Item:{options:{showButtonOnlyThis:false,showValue:false,showIcons:true},strings:{btnOnlyThis:'Only'}}});};})(TreeFilter);'use strict';(function(TreeFilter){return TreeFilter.Logger={logLevel:0,ID:'',log:function(msg){if(this.logLevel>=1){if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log(this.ID!=null?this.ID+" : "+msg:msg);}}}
return this;},debug:function(msg){if(this.logLevel>=2){if(typeof console!=="undefined"&&console!==null){if(typeof console.debug==="function"){console.debug(this.ID!=null?this.ID+" : "+msg:msg);}}}
return this;},warn:function(msg){if(typeof console!=="undefined"&&console!==null){if(typeof console.warn==="function"){console.warn(this.ID!=null?this.ID+" : "+msg:msg);}}
return this;},info:function(msg){if(typeof console!=="undefined"&&console!==null){if(typeof console.info==="function"){console.info(this.ID!=null?this.ID+" : "+msg:msg);}}
return this;},error:function(msg){if(typeof console!=="undefined"&&console!==null){if(typeof console.error==="function"){console.error(this.ID!=null?this.ID+" : "+msg:msg);}}
return this;}};})(TreeFilter);'use strict';(function(_,TreeModel,BaseEvents,Logger,Models){return Models.Tree=BaseEvents.extendWithEvents(TreeModel).extend(Logger).extend({url:'',loglevel:'log',children:function(){return this.nodes.apply(this,arguments);},parse:function(response,options){return response;},walkDown:function(itemCallback,combineCallback,alwaysCallback){var result;if(!combineCallback){combineCallback=function(x){return x;};}
if(this.children()){result=combineCallback(this.children().map(function(child){return child.walkDown(itemCallback,combineCallback,alwaysCallback);}));}else{result=itemCallback(this);}
if(_.isFunction(alwaysCallback)){result=alwaysCallback(this,result);}
return result;},flatten:function(){var list;list=[this];if(this.children()){this.children().each(function(node){return node.flatten().each(function(el){return list.push(el);});});}
return _.chain(list);},leafs:function(){return this.flatten().filter(function(m){return m.children()===null;});}});})(_,Backbone.TreeModel,BaseEvents,TreeFilter.Logger,TreeFilter.Models);'use strict';(function(_,TreeFilter,Models,Tree){'use strict';var SelectionStates={SOME:null,NONE:false,ALL:true};return Models.SelectionTree=Tree.extend({defaults:{id:void 0,label:"",isSelected:false,isVisible:true,isCollapsed:true,numberOfSelectedItems:0,numberOfItems:0,page:0},constructor:function(attributes,options){if((attributes!=null?attributes.label:void 0)!=null){if((attributes.id==null)||((options!=null?options.useValueAsId:void 0)===true)){attributes.id=attributes.label;}}
return this.base(attributes,options);},initialize:function(){this.base.apply(this,arguments);if(this.parent()){this._inheritSelectionFromParent();}
var filterText=this.root().get('searchPattern');this._filterBy(filterText);return this.on('add remove',this.update);},_inheritSelectionFromParent:function(){var parentSelectionState=this.parent().getSelection();if(parentSelectionState===SelectionStates.ALL){this.setSelection(SelectionStates.ALL);}else if(parentSelectionState===SelectionStates.NONE){this.setSelection(SelectionStates.NONE);}},setSelection:function(newState){if(this.getSelection()===newState){return this;}
this.set('isSelected',newState);if(newState!==TreeFilter.Enum.select.SOME){if(this.children()){this.children().each(function(child){return child.setSelection(newState);});}}
if(this.parent()){this.parent().updateSelection();}
return this;},getSelection:function(){return this.get('isSelected');},setAndUpdateSelection:function(newState){this.setSelection(newState);this.update();return this.trigger('selection',this);},setVisibility:function(newState){var isVisible;isVisible=this.get('isVisible');if(isVisible!==newState){return this.set('isVisible',newState);}},getVisibility:function(){return this.get('isVisible');},getSelectedItems:function(field){var getMyself,isSelected;getMyself=(function(_this){return function(){var value;value=_this.get(field||'id');return value;};})(this);isSelected=this.getSelection();switch(isSelected){case TreeFilter.Enum.select.SOME:case void 0:if(this.children()){return _.flatten(this.children().map(function(child){return child.getSelectedItems(field)||[];}));}else{return getMyself();}
break;case TreeFilter.Enum.select.ALL:return getMyself();case TreeFilter.Enum.select.NONE:return[];default:return[];}},setSelectedItems:function(idList){var flatTree;flatTree=this.flatten();flatTree.filter(function(m){return m.children()==null;}).each(function(m){var id;id=m.get('id');if(_.contains(idList,id)){return m.setSelection(TreeFilter.Enum.select.ALL);}else{return m.setSelection(TreeFilter.Enum.select.NONE);}});flatTree.filter(function(m){return m.children()!=null;}).each(function(m){var id;id=m.get('id');if(_.contains(idList,id)){return m.setSelection(TreeFilter.Enum.select.ALL);}});this.update();return this.root().updateSelectedItems({silent:true});},updateSelectedItems:function(options){return this.root().set('selectedItems',this._getSelectionSnapshot(),options);},restoreSelectedItems:function(){var selectedItems;selectedItems=this.root().get('selectedItems');if(selectedItems==null){selectedItems={none:this.flatten()};}
selectedItems.none.each(function(m){return m.setSelection(TreeFilter.Enum.select.NONE);});if(selectedItems.all!=null){selectedItems.all.each(function(m){return m.setSelection(TreeFilter.Enum.select.ALL);});}
return this.update();},_getSelectionSnapshot:function(){var flatTree,selectionSnapshot;flatTree=this.flatten();selectionSnapshot={none:flatTree.filter(function(m){return m.getSelection()===TreeFilter.Enum.select.NONE;}),some:flatTree.filter(function(m){return m.getSelection()===TreeFilter.Enum.select.SOME;}),all:flatTree.filter(function(m){return m.getSelection()===TreeFilter.Enum.select.ALL;})};return selectionSnapshot;},update:function(){var numberOfServerItems;this.root().updateSelection();numberOfServerItems=this.root().get('numberOfItemsAtServer');if(numberOfServerItems!=null){this.root().set('numberOfItems',numberOfServerItems);}else{this.root().updateCountOfItems('numberOfItems',function(model){return 1;});}
this.root().updateCountOfItems('numberOfSelectedItems',function(model){if(model.getSelection()===TreeFilter.Enum.select.ALL){return 1;}else{return 0;}});return this;},updateSelection:function(){var inferParentSelectionStateFromChildren;inferParentSelectionStateFromChildren=function(childrenStates){var all,none;all=_.every(childrenStates,function(el){return el===TreeFilter.Enum.select.ALL;});none=_.every(childrenStates,function(el){return el===TreeFilter.Enum.select.NONE;});if(all){return TreeFilter.Enum.select.ALL;}else if(none){return TreeFilter.Enum.select.NONE;}else{return TreeFilter.Enum.select.SOME;}};return this.inferSelection(inferParentSelectionStateFromChildren,function(model,isSelected){if(model.children()){if(model.getSelection()!==isSelected){return model.setSelection(isSelected);}}});},inferSelection:function(logic,callback){var bothCallback,itemCallback;itemCallback=function(node){return node.getSelection();};bothCallback=function(node,result){if(_.isFunction(callback)){callback(node,result);}
return result;};return this.walkDown(itemCallback,logic,bothCallback);},countItems:function(callback){var count;if(this.children()){count=this.children().reduce(function(memo,child){return memo+child.countItems(callback);},0);}else{count=callback(this);}
return count;},updateCountOfItems:function(property,callback){var countItem,setCountOfItems,sumItems;countItem=function(model){return callback(model);};sumItems=function(list){return _.reduce(list,(function(memo,n){return memo+n;}),0);};setCountOfItems=function(model,count){if(model.children()){model.set(property,count);}
return count;};return this.walkDown(countItem,sumItems,setCountOfItems);},countSelectedItems:function(){return this.countItems(function(model){if(model.getSelection()===TreeFilter.Enum.select.ALL){return 1;}else{return 0;}});},updateCountOfSelectedItems:function(){var countSelectedItem,setSelectedItems,sumSelectedItems;countSelectedItem=function(model){if(model.getSelection()===TreeFilter.Enum.select.ALL){return 1;}else{return 0;}};sumSelectedItems=function(list){return _.reduce(list,(function(memo,n){return memo+n;}),0);};setSelectedItems=function(model,count){if(model.children()){model.set('numberOfSelectedItems',count);}
return count;};return this.walkDown(countSelectedItem,sumSelectedItems,setSelectedItems);},hasChanged:function(){var hasChanged,previousSelection;previousSelection=this.get('selectedItems');if(previousSelection!=null){hasChanged=_.any(_.map(this._getSelectionSnapshot(),function(current,state){var intersection,previous;previous=previousSelection[state];intersection=current.intersection(previous.value()).value();return!(current.isEqual(intersection).value()&&previous.isEqual(intersection).value());}));}else{hasChanged=false;}
return hasChanged;},filterBy:function(text){this.root().set('searchPattern',text);this._filterBy(text);return this;},_filterBy:function(text){this._filter(text,"",this.get("matcher"));this.root().setVisibility(true);},_filter:function(text,prefix,customMatcher){var isMatch,that=this;var fullString=_.chain(['label']).map(function(property){return that.get(property);}).compact().value().join(' ');if(prefix){fullString=prefix+fullString;}
if(this.children()){isMatch=_.any(this.children().map(function(m){var childIsMatch;childIsMatch=m._filter(text,fullString,customMatcher);m.setVisibility(childIsMatch);return childIsMatch;}));}else if(_.isEmpty(text)){isMatch=true;}else{if(_.isFunction(customMatcher)){isMatch=customMatcher(fullString,text);}else{isMatch=fullString.toLowerCase().indexOf(text.toLowerCase())>-1;}
this.debug("fullstring  "+fullString+" match to "+text+": "+isMatch);}
this.setVisibility(isMatch);return isMatch;},setBusy:function(isBusy){this.root().set('isBusy',isBusy);return this;},isBusy:function(){return this.root().get('isBusy');}},{SelectionStates:SelectionStates});})(_,TreeFilter,TreeFilter.Models,TreeFilter.Models.Tree);
(function(templates){$.extend(true,templates,{"Group-skeleton":['<div class="filter-group-container {{className}}">','','<div class="filter-group-header"/>','','<div class="filter-group-body">','<div class="filter-group-items-container">','<div class="filter-group-items"></div>','</div>','</div>','','<div class="filter-group-footer">','{{#showPagination}}','<button class="filter-btn-more-data">More...</button>','{{/showPagination}}','{{{footer}}}','</div>','','</div>',''].join(""),"Group-template":['<div class="filter-group-header','{{#isPartiallySelected}} some-selected{{/isPartiallySelected}}','{{^isPartiallySelected}}','{{#isSelected}} all-selected{{/isSelected}}','{{^isSelected}} none-selected{{/isSelected}}','{{/isPartiallySelected}}','">','','{{#showButtonCollapse}}','<div class="filter-collapse-icon','{{#isCollapsed}} expanded{{/isCollapsed}}','{{^isCollapsed}} collapsed{{/isCollapsed}}','" />','{{/showButtonCollapse}}','','<div class="filter-group-title">','{{{label}}}','</div>','','<div class="filter-controls">','{{#showFilter}}','<div class="filter-filter">','<input type="text" class="filter-filter-input" value="{{searchPattern}}">','<div class="filter-filter-icon" />','<div class="filter-filter-clear" />','</div>','{{/showFilter}}','{{#showCommitButtons}}','<div class="filter-control-buttons clearfix">','<div class="filter-control-button">','<button class="filter-btn-cancel">{{strings.btnCancel}}</button>','</div>','<div class="filter-control-button">','<button class="filter-btn-apply">{{strings.btnApply}}</button>','</div>','</div>','{{/showCommitButtons}}','</div>','','','{{#showGroupSelection}}','<div class="filter-group-selection">','','<div class="filter-group-selection-icon','{{#isPartiallySelected}} some-selected{{/isPartiallySelected}}','{{^isPartiallySelected}}','{{#isSelected}} all-selected{{/isSelected}}','{{^isSelected}} none-selected{{/isSelected}}','{{/isPartiallySelected}}','" />','','<div class="filter-group-label">','{{strings.groupSelection}}','</div>','','','</div>','{{/showGroupSelection}}','{{#showValue}}','<div class="filter-group-selection-value">','{{{value}}}','</div>','{{/showValue}}','','','</div>',''].join(""),"Item-template":['<div class="filter-item-container','{{#isPartiallySelected}} some-selected{{/isPartiallySelected}}','{{^isPartiallySelected}}','{{#isSelected}} all-selected{{/isSelected}}','{{^isSelected}} none-selected{{/isSelected}}','{{/isPartiallySelected}}','">','','{{#header}}','<div class="filter-item-header"> {{{header}}} </div>','{{/header}}','','<div class="filter-item-body">','<!-- <label class="filter-item-label"> -->','<!-- <input type="checkbox" {{#isSelected}}checked="true"{{/isSelected}} /> -->','<!-- {{{label}}} -->','<!-- </label> -->','{{{item}}}','','<div class="filter-item-selection-icon">','<div />','</div>','','{{#showButtonOnlyThis}}','<span class="filter-item-only-this">','{{strings.btnOnlyThis}}','</span>','{{/showButtonOnlyThis}}','','<div class="filter-item-label"','title="{{{label}}}"','>','{{{label}}}','</div>','','{{#showValue}}','<div class="filter-item-value">','{{{value}}}','</div>','{{/showValue}}','</div>','','{{#footer}}','<div class="filter-item-footer"> {{{footer}}} </div>','{{/footer}}','','</div>',''].join(""),"Root-footer":['<div class="filter-root-footer">','','{{#isBusy}}','<div class="filter-busy clearfix">','<div class="floatingBarsG">','<div class="blockG rotateG_01"></div>','<div class="blockG rotateG_02"></div>','<div class="blockG rotateG_03"></div>','<div class="blockG rotateG_04"></div>','<div class="blockG rotateG_05"></div>','<div class="blockG rotateG_06"></div>','<div class="blockG rotateG_07"></div>','<div class="blockG rotateG_08"></div>','</div>','<div class="filter-busy-info">Fetching data...</div>','</div>','{{/isBusy}}','{{#reachedSelectionLimit}}','<div class="filter-root-notification">','The selection limit (','<span class="filter-notification-highlight">{{selectionStrategy.limit}}</span>',') for specific items has been reached.','</div>','{{/reachedSelectionLimit}}','</div>',''].join(""),"Root-header":['<div class="filter-root-header','{{#isPartiallySelected}} some-selected{{/isPartiallySelected}}','{{^isPartiallySelected}}','{{#isSelected}} all-selected{{/isSelected}}','{{^isSelected}} none-selected{{/isSelected}}','{{/isPartiallySelected}}','">','<div class="filter-root-header-label"','{{#showTooltip}}','title="{{#header}}{{{header}}}{{/header}}{{^header}}{{#selectedItems}}{{{.}}}{{/selectedItems}}{{/header}}"','{{/showTooltip}}','>','','{{#isDisabled}}','{{strings.isDisabled}}','{{/isDisabled}}','','{{^isDisabled}}','{{#showSelectedItems}}','<span class="filter-root-info-selected-items">','{{#allItemsSelected}}','<span class="filter-root-info-selected-item">','{{strings.allItems}}','</span>','{{/allItemsSelected}}','{{^allItemsSelected}}','{{^noItemsSelected}}','<span class="filter-root-info-selected-item"','title="{{#selectedItems}}{{{.}}} {{/selectedItems}}"','>','{{#selectedItems}}','{{{.}}}','{{/selectedItems}}','</span>','{{/noItemsSelected}}','{{/allItemsSelected}}','{{#noItemsSelected}}','<span class="filter-root-info-selected-item">','{{strings.noItems}}','</span>','{{/noItemsSelected}}','</span>','{{/showSelectedItems}}','','','{{#showNumberOfSelectedItems}}','{{#allItemsSelected}}','<span class="filter-root-info-selected-items">','{{strings.allItems}}','</span>','{{/allItemsSelected}}','','{{#noItemsSelected}}','<span class="filter-root-info-selected-items">','{{strings.noItems}}','</span>','{{/noItemsSelected}}','','{{^allItemsSelected}}','{{^noItemsSelected}}','<span class="filter-root-info-selected-items">','<span class="filter-root-info-number-selected-items">','{{numberOfSelectedItems}}','</span>','<span class="filter-root-info-number-items">','&nbsp;/&nbsp;{{numberOfItems}}','</span>','</span>','{{/noItemsSelected}}','{{/allItemsSelected}}','{{/showNumberOfSelectedItems}}','{{/isDisabled}}','</div>','<div class="filter-collapse-icon','{{^isDisabled}}','{{^alwaysExpanded}}','{{#isCollapsed}} collapsed{{/isCollapsed}}','{{^isCollapsed}} expanded {{/isCollapsed}}','{{/alwaysExpanded}}','{{#alwaysExpanded}} always-expanded{{/alwaysExpanded}}','{{/isDisabled}}','','{{#isDisabled}} disabled{{/isDisabled}}','','" />','</div>',''].join(""),"Root-overlay":['{{#useOverlay}}','<div class="filter-overlay','{{^alwaysExpanded}}','{{#isCollapsed}} collapsed{{/isCollapsed}}','{{^isCollapsed}} expanded {{/isCollapsed}}','{{/alwaysExpanded}}','{{#alwaysExpanded}} always-expanded{{/alwaysExpanded}}','" />','{{/useOverlay}}',''].join(""),"Root-skeleton":['<div class="filter-title">{{strings.title}}</div>','<div class="filter-root-container','{{#className}} {{className}}{{/className}}','{{#styles}} {{.}} {{/styles}}','{{#isDisabled}} disabled{{/isDisabled}}','">','{{#useOverlay}}','<div class="filter-overlay','{{^alwaysExpanded}}','{{#isCollapsed}} collapsed{{/isCollapsed}}','{{^isCollapsed}} expanded {{/isCollapsed}}','{{/alwaysExpanded}}','{{#alwaysExpanded}} always-expanded{{/alwaysExpanded}}','" />','{{/useOverlay}}','<div class="filter-root-header','{{#isPartiallySelected}} some-selected{{/isPartiallySelected}}','{{^isPartiallySelected}}','{{#isSelected}} all-selected{{/isSelected}}','{{^isSelected}} none-selected{{/isSelected}}','{{/isPartiallySelected}}','','{{^alwaysExpanded}}','{{#isCollapsed}} collapsed{{/isCollapsed}}','{{^isCollapsed}} expanded {{/isCollapsed}}','{{/alwaysExpanded}}','{{#alwaysExpanded}} always-expanded{{/alwaysExpanded}}','">','<div class="filter-root-header-label">','{{{header}}}','</div>','<div class="filter-root-collapse-icon" />','</div>','','<div class="filter-root-body filter-expand-{{expandMode}}" >','<div class="filter-root-control" />','<div class="filter-root-items-container">','<div class="filter-root-items" />','</div>','<div class="filter-root-footer"> {{{footer}}} </div>','</div>','','</div>',''].join(""),"Root-template":['<div class="filter-root-control','{{#isPartiallySelected}} some-selected{{/isPartiallySelected}}','{{^isPartiallySelected}}','{{#isSelected}} all-selected{{/isSelected}}','{{^isSelected}} none-selected{{/isSelected}}','{{/isPartiallySelected}}','','{{^alwaysExpanded}}','{{#isCollapsed}} collapsed{{/isCollapsed}}','{{^isCollapsed}} expanded {{/isCollapsed}}','{{/alwaysExpanded}}','{{#alwaysExpanded}} always-expanded{{/alwaysExpanded}}','">','<div class="filter-controls">','','{{#showCommitButtons}}','<div class="filter-control-buttons clearfix">','<div class="filter-control-button">','<button class="filter-btn-cancel','{{#hasChanged}} dirty{{/hasChanged}}','{{^hasChanged}} pristine{{/hasChanged}}','"','>','{{strings.btnCancel}}','</button>','</div>','<div class="filter-control-button">','<button class="filter-btn-apply','{{#hasChanged}} dirty{{/hasChanged}}','{{^hasChanged}} pristine{{/hasChanged}}','"','{{^hasChanged}} disabled="disabled"{{/hasChanged}}','>','{{strings.btnApply}}','</button>','</div>','</div>','{{/showCommitButtons}}','','{{#showFilter}}','<div class="filter-filter">','<input type="text" class="filter-filter-input" value="{{searchPattern}}">','<div class="filter-filter-icon" />','<div class="filter-filter-clear" />','</div>','{{/showFilter}}','','</div>','','','','<div class="filter-root-selection">','','{{#showGroupSelection}}','<div class="filter-root-selection-icon','{{#isPartiallySelected}} some-selected{{/isPartiallySelected}}','{{^isPartiallySelected}}','{{#isSelected}} all-selected{{/isSelected}}','{{^isSelected}} none-selected{{/isSelected}}','{{/isPartiallySelected}}','" />','<div class="filter-root-selection-label">','{{{label}}}','</div>','','{{#showValue}}','<div class="filter-root-selection-value">','{{{value}}}','</div>','{{/showValue}}','','{{/showGroupSelection}}','','{{#showSelectedItems0}}','<div class="filter-selected-items">','{{#selectedItems}}','<span class="filter-selected-item">{{.}}</span>','{{/selectedItems}}','</div>','{{/showSelectedItems0}}','','</div>','','','</div>',''].join(""),undefined:"No template"});})(TreeFilter.templates);
var AbstractScrollBarHandler=Base.extend({scrollToPosition:function(position){}});
var OptiScrollBarEngine;(function(AbstractScrollBarHandler,$){OptiScrollBarEngine=AbstractScrollBarHandler.extend({scrollbar:null,constructor:function(view){this.scrollbar=view.$(view.config.view.slots.children).addClass('optiscroll-content').parent().addClass('optiscroll').optiscroll().off('scrollreachbottom').on('scrollreachbottom',function(event){return view.trigger('scroll:reached:bottom',view.model,event);}).off('scrollreachtop').on('scrollreachtop',function(event){return view.trigger('scroll:reached:top',view.model,event);}).data('optiscroll');},scrollToPosition:function(position){this.scrollbar.scrollIntoView(position);}});})(AbstractScrollBarHandler,$);
var MCustomScrollBarEngine;(function(AbstractScrollBarHandler,$){MCustomScrollBarEngine=AbstractScrollBarHandler.extend({scrollbar:null,constructor:function(view){var options=$.extend(true,{},view.config.view.scrollbar.options,{callbacks:{onTotalScroll:function(){return view.trigger('scroll:reached:bottom',view.model);},onTotalScrollBack:function(){return view.trigger('scroll:reached:top',view.model);}}});this.scrollbar=view.$(view.config.view.slots.children).parent().mCustomScrollbar(options);},scrollToPosition:function(position){this.scrollbar.mCustomScrollbar("scrollTo",position,{callbacks:false});}});})(AbstractScrollBarHandler,$);
var ScrollBarFactory;(function(OptiScrollBarEngine,MCustomScrollBarEngine){ScrollBarFactory={createScrollBar:function(engine,view){switch(engine){case'optiscroll':return new OptiScrollBarEngine(view);case'mCustomScrollbar':return new MCustomScrollBarEngine(view);}}}})(OptiScrollBarEngine,MCustomScrollBarEngine);'use strict';(function($,_,BaseView,Mustache,LoggerMixin,Views,ScrollBarFactory){Views.AbstractView=BaseView.extend(LoggerMixin).extend({initialize:function(options){this.configuration=options.configuration;this.loglevel=this.configuration.loglevel;this.config=this.configuration[this.type];if(this.config.view.templates!=null){$.extend(true,this.template,this.config.view.templates);}
if(this.model){this.bindToModel(this.model);}
this.setElement(options.target);this.render();return this;},bindToModel:function(model){this.onChange(model,'isVisible',this.updateVisibility);return this;},onChange:function(model,properties,callback){var events,props;props=properties.split(' ');events=_.map(props,function(prop){return'change:'+prop;}).join(' ');if(this.config.view.throttleTimeMilliseconds>=0){this.listenTo(model,events,_.throttle(callback,this.config.view.throttleTime,{leading:false}));}else{this.listenTo(model,events,callback);}
return this;},updateSlot:function(slot){return _.bind(function(){var renderer,viewModel;viewModel=this.getViewModel();renderer=this.renderSlot('slot');return renderer.call(this,viewModel);},this);},renderSlot:function(slot){return _.bind(function(viewModel){var html;if(this.template[slot]){html=Mustache.render(this.template[slot],viewModel);this.$(this.config.view.slots[slot]).replaceWith(html);}
this.injectContent(slot);return TreeFilter.count++;},this);},getViewModel:function(){var viewOptions;viewOptions=_.result(this.config,'options');return $.extend(true,this.model.toJSON(),viewOptions,{strings:_.result(this.config,'strings'),selectionStrategy:_.omit(this.configuration.selectionStrategy,'strategy'),isPartiallySelected:this.model.getSelection()===TreeFilter.Enum.select.SOME,numberOfChildren:this.model.children()?this.model.children().length:0});},injectContent:function(slot){var ref,ref1,renderers,that;renderers=(ref=this.config)!=null?(ref1=ref.renderers)!=null?ref1[slot]:void 0:void 0;if(renderers==null){return;}
if(!_.isArray(renderers)){renderers=[renderers];}
that=this;_.each(renderers,function(renderer){if(_.isFunction(renderer)){return renderer.call(that,that.$el,that.model,that.configuration);}});return this;},render:function(){var viewModel;viewModel=this.getViewModel();this.renderSkeleton(viewModel);this.renderSelection(viewModel);this.updateVisibility(viewModel);return this;},renderSkeleton:function(viewModel){this.$el.html(Mustache.render(this.template.skeleton,viewModel));TreeFilter.count++;return this;},updateSelection:function(model,options){var viewModel;if(model===this.model){viewModel=this.getViewModel();this.renderSelection(viewModel);}
return this;},renderSelection:function(viewModel){var html;html=Mustache.render(this.template.selection,viewModel);this.$(this.config.view.slots.selection).replaceWith(html);this.injectContent('selection');return TreeFilter.count++;},updateVisibility:function(){if(this.model.getVisibility()){return this.$el.show();}else{return this.$el.hide();}},getChildrenContainer:function(){return this.$(this.config.view.slots.children);},createChildNode:function(){var $child,$target;$child=$('<div/>').addClass(this.config.view.childConfig.className);$target=this.$(this.config.view.slots.children);$child.appendTo($target);return $child;},appendChildNode:function($child){var $target;$target=this.$(this.config.view.slots.children);$child.appendTo($target);return $child;},updateScrollBar:function(){var nItems,needsScrollBar;nItems=this.config.options.scrollThreshold;needsScrollBar=_.isFinite(this.configuration.pagination.pageSize)&&this.configuration.pagination.pageSize>0;needsScrollBar=needsScrollBar||this.type!=='Item'&&this.model.flatten().size().value()>nItems;if(needsScrollBar){this.debug("There are more than "+nItems+" items, adding scroll bar");return this.addScrollBar();}},addScrollBar:function(){var $container,options;if(this._scrollBar!=null){return this;}
this.debug("Adding a scrollbar to "+(this.model.get('label')));this._scrollBar=ScrollBarFactory.createScrollBar(this.config.view.scrollbar.engine,this);if(this.config.options.isResizable){$container=this.$(this.config.view.slots.children).parent();if(_.isFunction($container.resizable)){$container.resizable({handles:'s'});}}
return this;},setScrollBarAt:function($tgt){if(this._scrollBar!=null){this._scrollBar.scrollToPosition($tgt);}
return this;},onMouseOver:function(event){var $node;$node=this.$(this.config.view.slots.selection);$node=this.$('div:eq(0)');this.trigger('mouseover',this.model);return this;},onMouseOut:function(event){var $node;$node=this.$(this.config.view.slots.selection);$node=this.$('div:eq(0)');this.trigger('mouseout',this.model);return this;},onSelection:function(){this.trigger('selected',this.model);return this;},onApply:function(event){this.trigger('control:apply',this.model);return this;},onCancel:function(event){this.debug("triggered Cancel");this.trigger('control:cancel',this.model);return this;},onFilterChange:function(event){var text;text=$(event.target).val();this.trigger('filter',text,this.model);return this;},onFilterClear:function(event){var text;text='';this.$('.filter-filter-input:eq(0)').val(text);this.trigger('filter',text,this.model);return this;},onToggleCollapse:function(event){this.debug("triggered collapse");this.trigger("toggleCollapse",this.model,event);return this;},close:function(){this.remove();return this.unbind();}});})($,_,BaseView,Mustache,TreeFilter.Logger,TreeFilter.Views,ScrollBarFactory);'use strict';(function($,_,Mustache,Views,TreeFilterTemplates){Views.Root=Views.AbstractView.extend({type:'Root',ID:'TreeFilter.Views.Root',template:{skeleton:TreeFilterTemplates['Root-skeleton'],overlay:TreeFilterTemplates['Root-overlay'],header:TreeFilterTemplates['Root-header'],selection:TreeFilterTemplates['Root-template'],footer:TreeFilterTemplates['Root-footer']},events:{'click     .filter-root-header:eq(0)':'onToggleCollapse','click     .filter-root-selection:eq(0)':'onSelection','click     .filter-btn-apply:eq(0)':'onApply','click     .filter-btn-cancel:eq(0)':'onCancel','mouseover .filter-root-header':'onMouseOver','mouseout  .filter-root-header':'onMouseOut','keyup   .filter-filter:eq(0)':'onFilterChange','change  .filter-filter:eq(0)':'onFilterChange','click  .filter-filter-clear:eq(0)':'onFilterClear','click  .filter-overlay':'onOverlayClick'},initialize:function(options){this.renderOverlay=this.renderSlot('overlay');this.renderHeader=this.renderSlot('header');this.renderFooter=this.renderSlot('footer');return this.base(options);},bindToModel:function(model){this.base(model);this.onChange(model,'isCollapsed',this.updateCollapse);this.onChange(model,'isSelected numberOfSelectedItems numberOfItems reachedSelectionLimit',this.updateHeader);this.onChange(model,'isSelected numberOfSelectedItems numberOfItems selectedItems',this.updateSelection);this.onChange(model,'reachedSelectionLimit isBusy',this.updateFooter);return this.onChange(model,'isDisabled',_.bind(this.updateAvailability,this));},getViewModel:function(){var viewModel;viewModel=this.base();$.extend(viewModel,{selectedItems:_.map(this.configuration.selectionStrategy.strategy.getSelectedItems(this.model,'label'),function(label){return label+" ";}),allItemsSelected:this.model.getSelection()===true,noItemsSelected:this.model.getSelection()===false,hasChanged:this.model.hasChanged()});return viewModel;},render:function(){var viewModel;viewModel=this.getViewModel();this.renderSkeleton(viewModel);this.renderOverlay(viewModel);this.renderHeader(viewModel);this.renderCollapse(viewModel);this.renderSelection(viewModel);this.renderFooter(viewModel);this.renderAvailability(viewModel);return this;},updateHeader:function(){var viewModel;viewModel=this.getViewModel();this.renderHeader(viewModel);return this;},updateFooter:function(){var viewModel;viewModel=this.getViewModel();this.renderFooter(viewModel);return this;},updateCollapse:function(){var viewModel;viewModel=this.getViewModel();this.renderHeader(viewModel);this.renderOverlay(viewModel);this.renderCollapse(viewModel);return this;},renderCollapse:function(viewModel){if(viewModel.isDisabled===true){var expand=(viewModel.alwaysExpanded===true);this.$('.filter-root-container').toggleClass('expanded',expand).toggleClass('collapsed',!expand).toggleClass('always-expanded',expand);}else if(viewModel.alwaysExpanded===true){this.$('.filter-root-container').toggleClass('expanded',false).toggleClass('collapsed',false).toggleClass('always-expanded',true);}else if(viewModel.isCollapsed===true){this.$('.filter-root-container').toggleClass('expanded',false).toggleClass('collapsed',true).toggleClass('always-expanded',false);}else{this.$('.filter-root-container').toggleClass('expanded',true).toggleClass('collapsed',false).toggleClass('always-expanded',false);}
return this;},updateAvailability:function(){var viewModel;viewModel=this.getViewModel();this.renderAvailability(viewModel);return this;},renderAvailability:function(viewModel){this.$('.filter-root-container').toggleClass('disabled',viewModel.isDisabled===true);return this;},onOverlayClick:function(event){this.trigger("click:outside",this.model);if(this.config.view.overlaySimulateClick===true){this.$('.filter-overlay').toggleClass('expanded',false).toggleClass('collapsed',true);_.delay(function(){var $element,item;$element=$(document.elementFromPoint(event.clientX,event.clientY));item=_.chain($element.parents()).filter(function(m){return $(m).hasClass('filter-root-header');}).first().value();if(item!=null){return $(item).click();}},0);}
return this;}});})($,_,Mustache,TreeFilter.Views,TreeFilter.templates);'use strict';(function(Views,Templates){'use strict';return Views.Group=Views.AbstractView.extend({type:'Group',ID:'TreeFilter.Views.Group',template:{skeleton:Templates['Group-skeleton'],selection:Templates['Group-template']},events:{'change    .filter-filter:eq(0)':'onFilterChange','keyup     .filter-filter:eq(0)':'onFilterChange','click     .filter-filter-clear:eq(0)':'onFilterClear','click     .filter-group-selection':'onSelection','click     .filter-collapse-icon:eq(0)':'onToggleCollapse','mouseover .filter-group-container':'onMouseOver','mouseout  .filter-group-container':'onMouseOut'},bindToModel:function(model){this.base(model);this.onChange(model,'isSelected numberOfSelectedItems numberOfItems',this.updateSelection);return this.onChange(model,'isCollapsed',this.updateCollapse);},updateCollapse:function(){var viewModel;viewModel=this.getViewModel();return this.renderCollapse(viewModel);},renderCollapse:function(viewModel){var collapsable;this.renderSelection(viewModel);collapsable=['.filter-group-body','.filter-group-footer'].join(', ');if(viewModel.isCollapsed){return this.$(collapsable).hide();}else{return this.$(collapsable).show();}}});})(TreeFilter.Views,TreeFilter.templates);'use strict';(function(Views,Templates){'use strict';return Views.Item=Views.AbstractView.extend({type:'Item',ID:'TreeFilter.Views.Root',template:{selection:Templates['Item-template'],skeleton:Templates['Item-template']},events:{'mouseover .filter-item-body':'onMouseOver','mouseout  .filter-item-body':'onMouseOut','click     .filter-item-body':'onSelection','click     .filter-item-only-this':'onClickOnlyThis'},bindToModel:function(model){this.base(model);this.onChange(model,'isSelected',this.updateSelection);return this.onChange(model,'isVisible',this.updateVisibility);},onClickOnlyThis:function(event){event.stopPropagation();return this.trigger('control:only-this',this.model);}});})(TreeFilter.Views,TreeFilter.templates);'use strict';(function(_,TreeFilter,Controllers,Tree){'use strict';Controllers.Manager=Tree.extend({ID:'TreeFilter.Controllers.Manager',defaults:{model:null,view:null,controller:null,configuration:null},constructor:function(options){this.base.apply(this,arguments);var loglevel=this.get('configuration').loglevel;if(!_.isUndefined(loglevel)){this.loglevel=loglevel;}
this.updateChildren();return this;},initialize:function(options){if(this.get('view')==null){this.addViewAndController(this.get('model'));}
this.applyBindings();return this;},close:function(){this.empty();this.get('view').close();this.get('controller').stopListening().off();this.stopListening();this.off();this.clear();return this;},empty:function(){if(!this.children())return;this.children().each(function(child){child.close();});this.base();},applyBindings:function(){var that=this;var throttleScroll=function(f){var throttleTimeMilliseconds=that.get('configuration').pagination.throttleTimeMilliseconds;return _.throttle(f,throttleTimeMilliseconds||0,{trailing:false});};var throttleFilter=function(f){var throttleTimeMilliseconds=that.get('view').config.view.throttleTimeMilliseconds;return _.debounce(f,throttleTimeMilliseconds);};var bindings={model:{'add':this.onNewData,'change:selectedItems':this.onApply,'selection':this.sortSiblings},view:{'filter':throttleFilter(this.onFilterChange),'scroll:reached:top':throttleScroll(this.getPreviousPage),'scroll:reached:bottom':throttleScroll(this.getNextPage)}};_.each(bindings,function(bindingList,object){return _.each(bindingList,function(method,event){return that.listenTo(that.attributes[object],event,_.bind(method,that));});});this.on('post:child:selection request:child:sort',throttleFilter(this.renderSortedChildren));this.on('post:child:add',throttleFilter(this.onUpdateChildren));return this;},addViewAndController:function(newModel){var Controller,View,childConfig,configuration,controller,newController,newView,shareController,target,that;shareController=true;if(this.parent()!=null){that=this.parent();configuration=that.get('configuration');childConfig=configuration[that.get('view').type].view.childConfig;target=that.get('view').createChildNode();if(newModel.children()){View=TreeFilter.Views[childConfig.withChildrenPrototype];}else{View=TreeFilter.Views[childConfig.withoutChildrenPrototype];}
Controller=TreeFilter.Controllers.RootCtrl;controller=that.get('controller');}else{configuration=this.get('configuration');target=configuration.target;View=TreeFilter.Views.Root;Controller=TreeFilter.Controllers.RootCtrl;controller=null;}
newView=new View({model:newModel,configuration:configuration,target:target});this.set('view',newView);if(shareController===true&&controller!==null){newController=controller;newController.bindToView(newView);}else{newController=new Controller({model:newModel,view:newView,configuration:configuration});}
this.set('controller',newController);this.debug("addViewAndController is done for "+(newModel.get('id'))+" : "+(newModel.get('label')));return this;},onNewData:function(item,collection,obj){var itemParent;this.debug("New data ("+(item.get('label'))+") caught by "+(this.get('model').get('label')));itemParent=this.where({model:item.parent()});if(itemParent.length===1){return itemParent[0].trigger("post:child:add");}},onUpdateChildren:function(){this.debug("New data added to "+(this.get('model').get('label'))+" : updating children");this.updateChildren();this.restoreScroll();return this.trigger('post:update:children',this);},restoreScroll:function(){if(this.get('view')._scrollBar!=null){this.debug("This group has a scrollbar");if(this.previousPosition!=null){this.debug("Scrolling back");this.get('view').setScrollBarAt(this.previousPosition);return this.previousPosition=null;}}},getNextPage:function(model,event){var listOfChildren=this._listChildren(this.children());var sortedChildren=this.sortChildren(listOfChildren);var penultimateChild=_.last(sortedChildren,2)[0];this.previousPosition=penultimateChild!=null?penultimateChild.target:undefined;return this.getPage('next',model,event);},getPreviousPage:function(model,event){var listOfChildren=this._listChildren(this.children());var sortedChildren=this.sortChildren(listOfChildren);var secondChild=_.first(sortedChildren,2)[1];this.previousPosition=secondChild!=null?secondChild.target:undefined;return this.getPage('previous',model,event);},getPage:function(page,model,event){this.debug("Item "+(model.get('label'))+" requested page "+page);var searchPattern="";if(this.get('configuration').search.serverSide===true){searchPattern=model.root().get('searchPattern')}
return this.requestPage(page,searchPattern);},requestPage:function(page,searchPattern){var getPage=this.get('configuration').pagination.getPage;if(!_.isFunction(getPage)){return this;}
var that=this;return getPage(page,searchPattern).then(function(json){if(json.resultset!=null){that.debug("getPage: got "+json.resultset.length+" more items");}else{that.debug("getPage: no more items");}});},updateChildren:function(){var models=this.get('model').children();if(models!=null){var that=this;models.each(function(m){var hasModel=false;if(that.children()){hasModel=_.any(that.children().map(function(child){return child.get('model')===m;}));}
if(!hasModel){that.debug("adding child model "+(m.get('label')));return that.addChild(m);}});this.renderSortedChildren();this.get('view').updateScrollBar();}
return this;},addChild:function(newModel){var newManager={model:newModel,configuration:this.get('configuration')};this.add(newManager);return this;},removeChild:function(model){throw new Error("NotImplemented");},sortSiblings:function(model){this.debug("sortSiblings: "+(this.get('model').get('label'))+" was triggered from "+(model.get('label'))+":"+(model.getSelection()));if(this.get('model')!==model){return this;}
if(this.parent()){return this.parent().trigger('request:child:sort');}},getSorters:function(){var type=this.children().first().get('view').type;var customSorters=this.get('configuration')[type].sorter;if(_.isFunction(customSorters)){return[customSorters];}else if(_.isArray(customSorters)){return customSorters;}else{return[];}},sortChildren:function(children){var customSorters=this.getSorters();if(_.isEmpty(customSorters)){return children;}
var sorterIdx=customSorters.length;var configuration=this.get('configuration');var orderedChildren=_.chain(children);while(sorterIdx--){orderedChildren=orderedChildren.sortBy(function(child,idx){return customSorters[sorterIdx](null,child.item.get('model'),configuration);});}
return orderedChildren.value();},renderSortedChildren:function(){var $nursery;if(!this.children()){return this;}
$nursery=this.get('view').getChildrenContainer();$nursery.hide();this._appendChildren(this.sortChildren(this._detachChildren()));$nursery.show();return this;},_listChildren:function(){var children;if(this.children()){children=this.children().map(function(child){return{item:child,target:child.get('view').$el};});}else{children=null;}
return children;},_detachChildren:function(){var list=this._listChildren();list.forEach(function(obj){obj.target.detach();});return list;},_appendChildren:function(children){if(children!=null){_.each(children,(function(_this){return function(child){return _this.get('view').appendChildNode(child.target);};})(this));}
return this;},onFilterChange:function(text){if(this.get('configuration').search.serverSide===true){this.requestPage(0,text)}
this.get('model').filterBy(text);},onApply:function(model){return this.onFilterChange('');}});})(_,TreeFilter,TreeFilter.Controllers,TreeFilter.Models.Tree);'use strict';(function(_,BaseEvents,BaseView,LoggerMixin,Controllers){'use strict';return Controllers.RootCtrl=BaseEvents.extendWithEvents(Base).extend(LoggerMixin).extend({constructor:function(args){$.extend(this,_.pick(args,['model','view','configuration']));if(this.view){this.bindToView(this.view);}
this.loglevel=this.configuration.loglevel;return this;},bindToView:function(view){var bindings,that;bindings={'selected':this.onSelection,'toggleCollapse':this.onToggleCollapse,'control:only-this':this.onOnlyThis,'control:apply':this.onApply,'control:cancel':this.onCancel,'click:outside':this.onClickOutside};that=this;_.each(bindings,function(callback,event){return that.listenTo(view,event,callback);});return this;},onSelection:function(model){this.configuration.selectionStrategy.strategy.changeSelection(model);return this;},onApply:function(model){this.configuration.selectionStrategy.strategy.applySelection(model);return this;},onCancel:function(model){model.restoreSelectedItems();model.root().set('isCollapsed',true);return this;},onToggleCollapse:function(model){var newState,oldState;this.debug("Setting isCollapsed");if(model.get('isDisabled')===true){newState=true;}else{oldState=model.get('isCollapsed');newState=!oldState;}
var hasVisibleNode=!!model.nodes()&&_.some(model.nodes().models,function(model){return model.get('isVisible');});if(!hasVisibleNode&&oldState){this.view.onFilterClear();}
model.set('isCollapsed',newState);return this;},onClickOutside:function(model){model.set('isCollapsed',true);return this;},onOnlyThis:function(model){this.debug("Setting Only This");this.model.root().setAndUpdateSelection(TreeFilter.Enum.select.NONE);this.configuration.selectionStrategy.strategy.setSelection(TreeFilter.Enum.select.ALL,model);return this;}});})(_,BaseEvents,BaseView,TreeFilter.Logger,TreeFilter.Controllers);'use strict';(function(SelectionStrategies,Logger,_){'use strict';return SelectionStrategies.AbstractSelect=Base.extend(Logger).extend({ID:'TreeFilter.SelectionStrategies.AbstractSelect',constructor:function(options){return this.isLogicGlobal=true;},getNewState:function(oldState){switch(oldState){case TreeFilter.Enum.select.NONE:return TreeFilter.Enum.select.ALL;case TreeFilter.Enum.select.ALL:return TreeFilter.Enum.select.NONE;case TreeFilter.Enum.select.SOME:return TreeFilter.Enum.select.NONE;}},inferSelectionFromChildren:function(childrenStates){var all,none;all=_.every(childrenStates,function(el){return el===TreeFilter.Enum.select.ALL;});none=_.every(childrenStates,function(el){return el===TreeFilter.Enum.select.NONE;});if(all){return TreeFilter.Enum.select.ALL;}else if(none){return TreeFilter.Enum.select.NONE;}else{return TreeFilter.Enum.select.SOME;}},setSelection:function(newState,model){throw new Error("NotImplemented");},changeSelection:function(model){var c,d,newState,that;d=$.now();c=TreeFilter.count;newState=this.getNewState(model.getSelection());newState=this.setSelection(newState,model);that=this;_.delay(function(){return that.debug("Switching "+(model.get('label'))+" to "+newState+" took "+($.now()-d)+" ms and "+(TreeFilter.count-c)+" renders");},0);return this;},applySelection:function(model){model.updateSelectedItems();model.root().set('isCollapsed',true);return this;},getSelectedItems:function(model,field){return model.getSelectedItems(field);}});})(TreeFilter.SelectionStrategies,TreeFilter.Logger,_);'use strict';(function(SelectionStrategies){'use strict';SelectionStrategies.MultiSelect=SelectionStrategies.AbstractSelect.extend({ID:'TreeFilter.SelectionStrategies.MultiSelect',setSelection:function(newState,model){model.setAndUpdateSelection(newState);return newState;}});return SelectionStrategies.LimitedSelect=SelectionStrategies.MultiSelect.extend({ID:'TreeFilter.SelectionStrategies.LimitedSelect',constructor:function(options){return this.selectionLimit=options.limit||Infinity;},setSelection:function(newState,model){var allow,numberOfUnselectedItems,oldState,selectedItems;allow=true;oldState=model.getSelection();newState=this.getNewState(oldState);if(newState!==TreeFilter.Enum.select.NONE){selectedItems=model.root().get('numberOfSelectedItems');if(!_.isFinite(selectedItems)){model.update();selectedItems=model.root().get('numberOfSelectedItems');}
if(selectedItems>=this.selectionLimit){this.warn("Cannot allow the selection of  \""+(model.get('label'))+"\". Selection limit of "+this.selectionLimit+" has been reached.");allow=false;}else{if(model.children()){if(newState===TreeFilter.Enum.select.ALL){numberOfUnselectedItems=model.flatten().filter(function(m){return m.children()==null;}).filter(function(m){return m.getSelection()===TreeFilter.Enum.select.NONE;}).value().length;if(selectedItems+numberOfUnselectedItems>=this.selectionLimit){this.warn("Cannot allow the selection of \""+(model.get('label'))+"\". Selection limit of "+this.selectionLimit+" would be reached.");allow=false;}}}}}
if(allow){this.debug("setSelection");model.setAndUpdateSelection(newState);selectedItems=model.root().get('numberOfSelectedItems');model.root().set("reachedSelectionLimit",selectedItems>=this.selectionLimit);}else{newState=oldState;}
return newState;}});})(TreeFilter.SelectionStrategies);'use strict';(function(SelectionStrategies){'use strict';return SelectionStrategies.SingleSelect=SelectionStrategies.AbstractSelect.extend({ID:'TreeFilter.SelectionStrategies.SingleSelect',setSelection:function(newState,model){if(model.children()){return;}
if(this.isLogicGlobal===true){model.root().setSelection(TreeFilter.Enum.select.NONE);}else if(model.getSelection()!==TreeFilter.Enum.select.ALL){if(model.parent()){model.parent().setSelection(TreeFilter.Enum.select.NONE);}}
model.setAndUpdateSelection(TreeFilter.Enum.select.ALL);return newState;},changeSelection:function(model){this.base(model);return this.applySelection(model);},getSelectedItems:function(model,field){if(model&&model.isRoot()&&model.children()&&model.countSelectedItems()==1&&model.children().length==1){return _.flatten(model.children().map(function(child){return child.getSelectedItems(field)||[];}));}else{return model.getSelectedItems(field);}}});})(TreeFilter.SelectionStrategies);
(function($,Mustache,Extensions){'use strict';$.extend(true,Extensions.Renderers,{group:function($tgt,model,configuration){var footer,header,viewModel;viewModel=model.toJSON();header=Mustache.render("{{label}}",viewModel);footer=Mustache.render("<a href=\"http://www.google.com\">More about {{label}}</a>",viewModel);$tgt.find('.filter-group-title').html(header);$tgt.find('.filter-group-footer').html(footer);return $tgt.css({border:"1px solid rgb("+(_.random(255))+","+(_.random(255))+","+(_.random(255))+")"});},sumSelected:function($tgt,model,configuration){var filter,total;total=model.flatten().filter(function(m){return m.children()==null;}).filter(function(m){return m.getSelection()===true;}).reduce((function(memo,m){return memo+m.get('value');}),0).value();filter=model.isRoot()?'.filter-root-selection-value':'.filter-group-selection-value';return $tgt.find(filter+':eq(0)').html(total===0?'':total);},Item:function($tgt,model,configuration){var blocks;blocks={item:"<span>"+viewModel.label+"</span> <span style='float:right;'>comem</>"};return $tgt.find('.filter-item-body').html(blocks.item);},rootHeaderSingleSelect:function($tgt,model,configuration){var header;header=model.getSelectedItems()[0]||"None";return $tgt.find('.filter-root-header-label').html(header).attr('title',header);},rootHeaderMultiSelect:function($tgt,model,configuration){var header,viewModel;viewModel=model.toJSON();header=Mustache.render("<span class=\"filter-root-info-number-selected-items\">\n  {{numberOfSelectedItems}}\n</span>\n<span class=\"filter-root-info-number-items\">\n  of {{numberOfItems}}\n</span>",viewModel);if(typeof console!=="undefined"&&console!==null){console.log("injecting content on header");}
$tgt.find('.filter-root-header-label').html(header).attr('title',Mustache.render("{{numberOfSelectedItems}}/{{numberOfItems}}",viewModel));return $tgt.find('.filter-root-header-label').mouseover(function(event){return typeof console!=="undefined"&&console!==null?console.log("hovering "+viewModel.label):void 0;});},notificationSelectionLimit:function($tgt,model,configuration){var footer,viewModel;viewModel=$.extend(true,model.toJSON(),configuration);footer=Mustache.render("{{#reachedSelectionLimit}}\n<div class=\"filter-root-notification\">\n  <div class=\"filter-root-notification-icon\" />\n  <div class=\"filter-root-notification-text\">\n    The selection limit\n    (<span class=\"filter-notification-highlight\">{{Root.options.selectionStrategy.limit}}</span>)\n    for specific items has been reached.\n  </div>\n</div>\n{{/reachedSelectionLimit}}",viewModel);return $tgt.find('.filter-root-footer').html(footer);}});})($,Mustache,TreeFilter.Extensions);'use strict';(function($,Extensions){return $.extend(true,Extensions.Sorters,{selectedOnTop:function(model,idx){var result;result=model.getSelection()?'A':'Z';return result+=idx;},sameOrder:function(model,idx){var result;return result=idx;},sortAlphabetically:function(model,idx){var result;return result=model.get('label');},sortByValue:function(model,idx){var result;return result=-(model.get('value'))||0;}});})($,TreeFilter.Extensions);
(function(_,BaseModel,LoggerMixin,DataHandlers){'use strict';var sanitizeInput=function(input){return _.isString(input)?input.replace("<script>","&lt;script&gt;").replace("</script>","&lt;/script&gt;"):input;};var getPageData=function(queryInfo,pageSize){var pageData={};if((queryInfo!=null?queryInfo.pageStart:void 0)!=null){pageData={page:Math.floor(parseInt(queryInfo.pageStart)/pageSize)};}
return pageData;};var itemGenerator=function(idx,pageData){if(!_.isObject(pageData)){pageData={};}
var createItems=function(rows){return _.map(rows,function(row){var itemData={id:row[idx.id],label:sanitizeInput(row[idx.label])};if(_.isFinite(idx.value)&&idx.value>=0){itemData.value=sanitizeInput(row[idx.value]);}
itemData=$.extend(true,itemData,pageData);return itemData;});};return createItems;};var groupGenerator=function(idx,pageData){var createGroup=function(rows,group){var groupData={id:group!=null?rows[0][idx.parentId]:void 0,label:rows[0][idx.parentLabel],nodes:itemGenerator(idx,pageData)(rows)};return groupData;};return createGroup;};DataHandlers.Input=BaseModel.extend(LoggerMixin).extend({ID:'TreeFilter.DataHandlers.Input',getModel:function(){return this.get('model');},updateModel:function(whatever){if(_.isArray(whatever)){this._updateModelFromBidimensionalArray(whatever);}else if(this.isCdaJson(whatever)){this._updateModelFromCdaJson(whatever);}else{this._updateModelFromJson(whatever);}
var model=this.get('model');model.set('isBusy',false);model.set('isDisabled',this.get('model').children()===null);var options=this.get('options');if(options.root&&options.root.id){model.set('id',options.root.id);}
if(options.hooks&&options.hooks.postUpdate){_.each(options.hooks.postUpdate,function(hook){return hook.call(null,null,model,options);});}
this.trigger('postUpdate',model);return this;},_updateModelFromCdaJson:function(json){var options=$.extend(true,{},this.get('options'));var pageData=getPageData(json.queryInfo,options.query.getOption('pageSize'));this._addDataToModel(json.resultset,pageData);var numberOfItems;if(json.queryInfo&&json.queryInfo.pageStart){numberOfItems=parseInt(json.queryInfo.totalRows);}
var searchPattern=options.query.getOption('searchPattern');if(_.isEmpty(searchPattern)){this.get('model').set('numberOfItemsAtServer',numberOfItems);}
return this;},_updateModelFromJson:function(anyJsonObject){return this;},_updateModelFromBidimensionalArray:function(rows){this._addDataToModel(rows,undefined);return this;},_addDataToModel:function(rows,pageData){if(rows.length===0){return this;}
var options=$.extend(true,{},this.get('options'));var parentIndexes=_.chain(options.indexes).pick('parentId','parentLabel').filter(_.isFinite).max().value();var hasGroups=_.isFinite(parentIndexes)&&parentIndexes<rows[0].length;var data;if(hasGroups){data=_.chain(rows).groupBy(function(row){return row[options.indexes.parentId];}).map(groupGenerator(options.indexes,pageData)).value();}else{data=itemGenerator(options.indexes,pageData)(rows);}
this.get('model').add(data);return this;},isCdaJson:function(obj){return _.isObject(obj)&&_.isArray(obj.resultset)&&_.isArray(obj.metadata);},setValue:function(selectedItems){this.get('model').setSelectedItems(selectedItems);this.trigger('setValue',selectedItems);return this;}});})(_,BaseModel,TreeFilter.Logger,TreeFilter.DataHandlers);
(function(_,BaseModel,LoggerMixin,DataHandlers){'use strict';DataHandlers.Output=BaseModel.extend(LoggerMixin).extend({ID:'TreeFilter.DataHandlers.Output',initialize:function(){if(true||this.attributes.options.trigger==='apply'){this.listenTo(this.get('model'),'change:selectedItems',this.onApply);}else{this.listenTo(this.get('model'),'change:isSelected',this.onSelection);}
return this;},_processOutput:function(model,selection){var modifiedSelection,result;result=void 0;if(_.isFunction(this.attributes.options.outputFormat)){modifiedSelection=this.attributes.options.outputFormat.call(this,model,selection);result=!_.isUndefined(modifiedSelection)?modifiedSelection:void 0;}else{if(_.isString(this.attributes.options.outputFormat)){switch(this.attributes.options.outputFormat.toLowerCase()){case'lowestid':result=this.getLowestId(selection);break;case'highestid':result=this.getHighestId(selection);break;case'selected':result=selection;}}}
if(_.isUndefined(result)){result=this.getLowestId(selection);}
return result;},getHighestId:function(selectionState){var list;list=_.chain(selectionState.all).filter(function(m){return!_.isUndefined(m.get('id'));}).filter(function(m,idx,models){var isParent;isParent=!_.contains(models,m.parent());return isParent;}).map(function(m){return m.get('id');}).value();return list;},getLowestId:function(selectionState){var list;list=_.chain(selectionState.all).filter(function(m,idx,models){return!m.children();}).map(function(m){return m.get('id');}).value();return list;},onApply:function(model,selectionState){var treatedSelection;if(selectionState==null){return this;}
treatedSelection=this._processOutput(model,selectionState);this.debug("confirmed selection:"+treatedSelection);this.trigger('changed',treatedSelection);return this;},onSelection:function(model){this.debug("onSelection: "+model.get('label'));return this;},getValue:function(){var model,selection,treatedSelection;model=this.get('model');selection=model.root().get('selectedItems');treatedSelection=this._processOutput(selection,model);return treatedSelection;}});})(_,BaseModel,TreeFilter.Logger,TreeFilter.DataHandlers);'use strict';(function(Dashboards,AddIn,Renderers){'use strict';var myAddIn;myAddIn=new AddIn({name:'notificationSelectionLimit',label:'Notification that the selection limit has been reached',help:'Acts on the footer of the Root view',defaults:{hook:'footer'},implementation:function($tgt,st,options){return Renderers.notificationSelectionLimit.call(this,$tgt,st.model,st.configuration);}});Dashboards.registerAddIn('FilterComponent','renderRootSelection',myAddIn);})(Dashboards,AddIn,TreeFilter.Extensions.Renderers);(function(Dashboards,AddIn,Renderers){'use strict';var myAddIn;myAddIn=new AddIn({name:'sumSelected',label:'Sum the values of the selected items',implementation:function($tgt,st,options){return Renderers.sumSelected.call(this,$tgt,st.model,st.configuration);}});Dashboards.registerAddIn('FilterComponent','renderRootSelection',myAddIn);Dashboards.registerAddIn('FilterComponent','renderGroupSelection',myAddIn);})(Dashboards,AddIn,TreeFilter.Extensions.Renderers);(function(Dashboards,AddIn){'use strict';var myAddIn;myAddIn=new AddIn({name:'randomColor',label:'Programmatically sets a random color',defaults:{filter:'.filter-item-body'},implementation:function($tgt,model,options){return $tgt.find(options.filter).css({color:"rgb("+(_.random(255))+","+(_.random(255))+","+(_.random(255))+")"});}});Dashboards.registerAddIn('FilterComponent','renderItemSelection',myAddIn);})(Dashboards,AddIn);(function(Dashboards,AddIn,Sorters){'use strict';var myAddIn;myAddIn=new AddIn({name:'selectedOnTop',label:'Keep selected items on top ',implementation:function($tgt,st,options){var result;result=st.model.getSelection()?'A':'Z';result+=st.model.index();return result;}});Dashboards.registerAddIn('FilterComponent','sortItem',myAddIn);Dashboards.registerAddIn('FilterComponent','sortGroup',myAddIn);})(Dashboards,AddIn,TreeFilter.Extensions.Sorters);(function(Dashboards,AddIn,Sorters){'use strict';var myAddIn;myAddIn=new AddIn({name:'insertionOrder',label:'Keep insertion order',implementation:function($tgt,st,options){var result;result=st.model.index();return result;}});Dashboards.registerAddIn('FilterComponent','sortItem',myAddIn);Dashboards.registerAddIn('FilterComponent','sortGroup',myAddIn);})(Dashboards,AddIn,TreeFilter.Extensions.Sorters);(function(Dashboards,AddIn){'use strict';var myAddIn;myAddIn=new AddIn({name:'sortByLabel',label:'Sort items by label, alphabetically',defaults:{ascending:true},implementation:function($tgt,st,options){return st.model.get('label');}});Dashboards.registerAddIn('FilterComponent','sortItem',myAddIn);Dashboards.registerAddIn('FilterComponent','sortGroup',myAddIn);})(Dashboards,AddIn);(function(Dashboards,AddIn){'use strict';var myAddIn;myAddIn=new AddIn({name:'sortByValue',label:'Sort items by value',defaults:{ascending:false},implementation:function($tgt,st,options){var result;result=st.model.get('value');if(options.ascending){return result;}else{return-1*result;}}});Dashboards.registerAddIn('FilterComponent','sortItem',myAddIn);Dashboards.registerAddIn('FilterComponent','sortGroup',myAddIn);})(Dashboards,AddIn);(function(Dashboards,Mustache,AddIn){'use strict';var myAddIn;myAddIn=new AddIn({name:'sumValues',label:'Sums the values of the selected items',defaults:{formatValue:function(total){return Mustache.render('{{total}}',{total:total});}},implementation:function($tgt,st,options){var html,filter,total;total=st.model.flatten().filter(function(m){return m.children()==null;}).filter(function(m){return m.getSelection()===true;}).reduce((function(memo,m){return memo+m.get('value');}),0).value();filter=st.model.isRoot()?'.filter-root-selection-value':'.filter-group-selection-value';if(_.isFinite(total)){html=options.formatValue(total);}else{html='';}
return $tgt.find(filter+':eq(0)').html(html);}});Dashboards.registerAddIn('FilterComponent','renderRootSelection',myAddIn);Dashboards.registerAddIn('FilterComponent','renderGroupSelection',myAddIn);})(Dashboards,Mustache,AddIn);(function(Dashboards,Mustache,AddIn){'use strict';var myAddIn;myAddIn=new AddIn({name:'template',label:'Mustache template',defaults:{template:'{{label}}',filter:'',postRender:void 0},implementation:function($tgt,st,options){var $el,html;if(!_.isEmpty(options.template)){html=Mustache.render(options.template,st.model.toJSON());$el=$tgt;if(!_.isEmpty(options.filter)){$el=$tgt.find(options.filter+':eq(0)');}
$el.html(html);if(_.isFunction(options.postRender)){return options.postRender.call(this,$tgt,st,options);}}}});Dashboards.registerAddIn('FilterComponent','renderRootHeader',myAddIn);Dashboards.registerAddIn('FilterComponent','renderRootFooter',myAddIn);Dashboards.registerAddIn('FilterComponent','renderRootSelection',myAddIn);Dashboards.registerAddIn('FilterComponent','renderGroupSelection',myAddIn);Dashboards.registerAddIn('FilterComponent','renderItemSelection',myAddIn);})(Dashboards,Mustache,AddIn);(function(Dashboards,AddIn){'use strict';var myAddIn;myAddIn=new AddIn({name:'accordion',label:'Makes all filters behave as an accordion',defaults:{group:'filters'},implementation:function($tgt,st,options){st.model.on('change:isCollapsed',function(model,newState){if(newState===false){return Dashboards.trigger('filters:close',model,options);}});st.model.listenTo(Dashboards,'filters:close',function(model,opts){if(opts.group===options.group){if(model!==st.model){if(st.model.get('isDisabled')===false){return st.model.set('isCollapsed',true);}}}});}});Dashboards.registerAddIn('FilterComponent','postUpdate',myAddIn);})(Dashboards,AddIn);
var FilterComponent;FilterComponent=(function($,_,Backbone,Logger,UnmanagedComponent,TreeFilter){'use strict';var IConfiguration,IFilter,Filter;IFilter={getValue:function(){return this._value;},setValue:function(value){this.inputDataHandler.setValue(value);return this;},processChange:function(value){this._value=value;this.dashboard.processChange(this.name);return this;}};IConfiguration={defaults:{component:{},input:{defaultModel:{isDisabled:true,searchPattern:''},indexes:{id:0,label:1,parentId:2,parentLabel:3,value:4}},output:{}},getConfiguration:function(){var cd=this.componentDefinition;var selectionStrategy=cd.multiselect?'LimitedSelect':'SingleSelect';var configuration={input:{},output:{},component:$.extend(true,{},TreeFilter.defaults(),TreeFilter.Enum.selectionStrategy[selectionStrategy],{target:this.placeholder()})};$.extend(true,configuration,_.result(this,'defaults'));var _getPage=function(page,searchPattern){var deferred=$.Deferred();var isPaginated=!!this.query&&this.query.getOption('pageSize')>0;var searchServerSide=configuration.component.search.serverSide;if(!searchServerSide&&!isPaginated){deferred.resolve({});return deferred;}
var successCallback=_.bind(function(data){this.inputDataHandler.updateModel(data);this.model.setBusy(false);deferred.resolve(data);return data;},this);var errorCallback=_.bind(function(){this.model.setBusy(false);deferred.reject();},this);this.model.setBusy(true);try{var pattern=_.isEmpty(searchPattern)?'':searchPattern;this.query.setSearchPattern(pattern);switch(page){case'previous':if(this.query.getOption('page')!==0){this.query.previousPage(successCallback);}
break;case'next':this.query.nextPage(successCallback);break;default:this.query.setOption('page',page);this.query.doQuery(successCallback,errorCallback);}}catch(_error){deferred.reject({});this.model.setBusy(false);}
return deferred;};var styles=[];if(!cd.showIcons){styles.push('no-icons');}
var pageSize=Infinity;if(this.queryDefinition.pageSize!=null){if(_.isFinite(this.queryDefinition.pageSize)&&this.queryDefinition.pageSize>0){pageSize=this.queryDefinition.pageSize;}}
$.extend(true,configuration.component,{pagination:{pageSize:pageSize,getPage:_.bind(_getPage,this)},selectionStrategy:{limit:_.isNumber(cd.selectionLimit)?cd.selectionLimit:Infinity},Root:{options:{styles:styles,alwaysExpanded:cd.alwaysExpanded,showFilter:cd.showFilter,useOverlay:cd.useOverlay},strings:{title:cd.title}}});var i18nMap=this.dashboard.i18nSupport.map;var that=this;_.each(['Root','Group','Item'],function(level){return _.each(configuration.component[level].strings,function(value,token,list){var fullToken;fullToken="filter_"+level+"_"+token;if(_.has(i18nMap,fullToken)){return list[token]=that.dashboard.i18nSupport.prop(fullToken);}});});var selectionStrategyConfig=configuration.component.selectionStrategy;var strategy=new TreeFilter.SelectionStrategies[selectionStrategyConfig.type](selectionStrategyConfig);configuration.component.selectionStrategy.strategy=strategy;if(selectionStrategyConfig.type!=='SingleSelect'){if(cd.showButtonOnlyThis===true||cd.showButtonOnlyThis===false){configuration.component.Root.options.showButtonOnlyThis=cd.showButtonOnlyThis;configuration.component.Group.options.showButtonOnlyThis=cd.showButtonOnlyThis;configuration.component.Item.options.showButtonOnlyThis=cd.showButtonOnlyThis;}}
$.extend(true,configuration.input,this.componentInput,{query:this.query});$.extend(true,configuration.output,this.componentOutput);configuration=$.extend(true,configuration,this._mapAddInsToConfiguration(),_.result(this,'options'));return configuration;},_mapAddInsToConfiguration:function(){var addInHash,addInList,configuration,getOrCreateEntry,that;that=this;addInList=_.chain(this.addIns).map(function(list,slot){var addIns;addIns=_.chain(list).map(function(name){var addIn,addInName,addInOptions;addInName=name.trim();addIn=that.getAddIn(slot,addInName);if(addIn!=null){addInOptions=that.getAddInOptions(slot,addInName);return function($tgt,model,options){var st;st={model:model,configuration:options};return addIn.call($tgt,st,addInOptions);};}else{return null;}}).compact().value();return[slot,addIns];}).object().value();addInHash={postUpdate:'input.hooks.postUpdate',renderRootHeader:'component.Root.renderers.header',renderRootSelection:'component.Root.renderers.selection',renderRootFooter:'component.Root.renderers.footer',renderGroupSelection:'component.Group.renderers.selection',renderItemSelection:'component.Item.renderers.selection',sortItem:'component.Item.sorter',sortGroup:'component.Group.sorter',outputFormat:'output.outputFormat'};configuration={};getOrCreateEntry=function(memo,key){if(memo[key]!=null){return memo[key];}else{return memo[key]={};}};_.each(addInList,function(functionList,addInSlot){var childKey,configAddress,parent,parentAddress;if(!_.isEmpty(functionList)){configAddress=addInHash[addInSlot].split('.');parentAddress=_.initial(configAddress);childKey=_.last(configAddress);parent=_.reduce(parentAddress,getOrCreateEntry,configuration);return parent[childKey]=addInList[addInSlot];}});return configuration;}};Filter=UnmanagedComponent.extend(IFilter).extend(IConfiguration).extend({model:void 0,manager:void 0,inputDataHandler:void 0,outputDataHandler:void 0,update:function(){if(!_.isEmpty(this.dashboard.detectQueryType(this.queryDefinition))){this.triggerQuery(this.queryDefinition,_.bind(this._render,this));}else if(this.componentInput.inputParameter&&!_.isEmpty(this.componentInput.inputParameter)){var paramDataCallback=_.bind(function(){var data=this.dashboard.getParameterValue(this.componentInput.inputParameter);this._render(data);},this);this.synchronous(paramDataCallback,null);}else{var staticDataCallback=_.bind(function(){this._render(this.componentInput.valuesArray);},this);this.synchronous(staticDataCallback,null);}},_render:function(data){this.initialize();this.onDataReady(data);},close:function(){if(this.manager!=null){this.manager.empty();}
if(this.model!=null){this.model.stopListening().off();}
return this.stopListening();},initialize:function(){var configuration=this.getConfiguration();this.close();this.model=new TreeFilter.Models.SelectionTree(configuration.input.defaultModel);this.model.set('matcher',configuration.component.search.matcher);this.manager=new TreeFilter.Controllers.Manager({model:this.model,configuration:configuration.component});this.inputDataHandler=new TreeFilter.DataHandlers.Input({model:this.model,options:configuration.input});this.outputDataHandler=new TreeFilter.DataHandlers.Output({model:this.model,options:configuration.output});this.listenTo(this.outputDataHandler,'changed',this.processChange);return configuration;},onDataReady:function(data){var currentSelection;this.inputDataHandler.updateModel(data);if(this.parameter){currentSelection=this.dashboard.getParameterValue(this.parameter);this.setValue(currentSelection);}
this.trigger('getData:success');return this;}},{help:function(){return"Filter component";}});return Filter;})($,_,Backbone,Dashboards,UnmanagedComponent,TreeFilter);
require(["cdf-legacy/lib/CCC/protovis","cdf-legacy/lib/CCC/cdo","cdf-legacy/lib/CCC/pvc-d1.0","cdf-legacy/lib/CCC/def","cdf-legacy/components/core"],function(_pv,_cdo,_pvc,_def){pvc=_pvc;pv=_pv;def=_def;cdo=_cdo;ChartComponent=UnmanagedComponent.extend({exportChart:function(outputType,overrides){var me=this;var buildUrlParameters=function(overrides){overrides=overrides||{};var urlParams={};var paramDefsArray=me.parameters;if(paramDefsArray&&paramDefsArray.length){var paramDefs=$.extend({},Dashboards.propertiesArrayToObject(paramDefsArray),overrides);for(var name in paramDefs){if(paramDefs.hasOwnProperty(name)){var value=Dashboards.getParameterValue(paramDefs[name]);if($.isArray(value)&&value.length==1&&(''+value[0]).indexOf(';')>=0){value=doCsvQuoting(value[0],';');}
if(typeof value=='function'){value=value();}
urlParams['param'+name]=value;}}}
var level=me.dashboard.debug;if(level>1){urlParams.paramdebug=true;urlParams.paramdebugLevel=level;}
var scriptName=me.name.replace(/render_/,'');urlParams.script=wd.helpers.cccHelper.getCccScriptPath(scriptName);urlParams.attachmentName=scriptName;return urlParams;};var urlParams=buildUrlParameters(overrides);urlParams.outputType=outputType||'png';var url=wd.helpers.cggHelper.getCggDrawUrl()+"?"+$.param(urlParams);var $exportIFrame=$('#cccExportIFrame');if(!$exportIFrame.length){$exportIFrame=$('<iframe id="cccExportIFrame" style="display:none">');$exportIFrame[0].src=url;$exportIFrame.appendTo($('body'));}else{$exportIFrame[0].src=url;}},renderChart:function(){var cd=this.chartDefinition;if(cd.dataAccessId||cd.query||cd.endpoint){this.triggerQuery(this.chartDefinition,_.bind(this.render,this));}else if(this.valuesArray!=undefined){this.synchronous(_.bind(function(){this.render(this.valuesArray);},this));}else{this.synchronous(_.bind(this.render,this));}}});ProtovisComponent=ChartComponent.extend({update:function(){if(this.parameters==undefined){this.parameters=[];};this.renderChart();},render:function(values){$("#"+this.htmlObject).html('<div id="'+this.htmlObject+'protovis"></div>');var vis=new pv.Panel().canvas(this.htmlObject+"protovis").width(this.width).height(this.height);this.vis=vis;this.customfunction(vis,values);vis.root.render();},processdata:function(values){this.render(values);}});BaseCccComponent=ChartComponent.extend({query:null,chart:null,_preProcessChartDefinition:function(){var chartDef=this.chartDefinition;if(chartDef){var compatVersion=chartDef.compatVersion;if(compatVersion==null){compatVersion=typeof pvc.defaultCompatVersion==='function'?pvc.defaultCompatVersion():1;}
if(compatVersion<=1){if('showLegend'in chartDef){chartDef.legend=chartDef.showLegend;delete chartDef.showLegend;}
for(var p in chartDef){var m=/^barLine(.*)$/.exec(p);if(m){p2='secondAxis'+(m[1]||'');chartDef[p2]=chartDef[p];delete chartDef[p];}}}}}});CccComponent=BaseCccComponent.extend({update:function(){if(this.parameters==null){this.parameters=[];}
var ph=this.clearsBeforePreExecution?$("#"+this.htmlObject).empty():$("#"+this.htmlObject);var me=this;if(typeof(this.chartDefinition.width)==="undefined")
this.chartDefinition.width=ph.width();if(typeof(this.chartDefinition.height)==="undefined")
this.chartDefinition.height=ph.height();if(typeof Modernizr!=='undefined'&&Modernizr.svg){this.renderChart();}else{pv.listenForPageLoad(function(){me.renderChart();});}},render:function(values){$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');this._preProcessChartDefinition();var o=$.extend({},this.chartDefinition);o.canvas=this.htmlObject+'protovis';if(typeof o.extensionPoints!="undefined"){var ep={};o.extensionPoints.forEach(function(a){ep[a[0]]=a[1];});o.extensionPoints=ep;}
this.chart=new this.cccType(o);if(arguments.length>0){this.chart.setData(values,{crosstabMode:this.crosstabMode,seriesInRows:this.seriesInRows});}
this.chart.render();}});CccComponent2=BaseCccComponent.extend({query:null,sQuery:null,chart:null,update:function(){var dataQuery=null,sDataQuery=null;if(this.parameters==undefined){this.parameters=[];};$("#"+this.htmlObject).empty();var me=this;this.query=Dashboards.getQuery(this.chartDefinition);var sQueryDef=$.extend({},this.chartDefinition);sQueryDef.dataAccessId=sQueryDef.structDatasource;this.sQuery=Dashboards.getQuery(sQueryDef);var executed=false;var execComponent=function(){if((dataQuery!=null)&&(sDataQuery!=null)&&!executed){me.render(dataQuery,sDataQuery);executed=true;}};pv.listenForPageLoad(function(){me.query.fetchData(me.parameters,function(values){var changedValues=undefined;if((typeof(me.postFetch)=='function')){changedValues=me.postFetch(values);$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');}
if(changedValues!=undefined){values=changedValues;}
dataQuery=values;execComponent();});});pv.listenForPageLoad(function(){me.sQuery.fetchData(me.parameters,function(values){var changedValues=undefined;if((typeof(me.postFetch)=='function')){changedValues=me.postFetch(values);$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');}
if(changedValues!=undefined){values=changedValues;}
sDataQuery=values;execComponent();});});},render:function(values,sValues){$("#"+this.htmlObject).append('<div id="'+this.htmlObject+'protovis"></div>');this._preProcessChartDefinition();var o=$.extend({},this.chartDefinition);o.canvas=this.htmlObject+'protovis';if(typeof o.extensionPoints!="undefined"){var ep={};o.extensionPoints.forEach(function(a){ep[a[0]]=a[1];});o.extensionPoints=ep;}
this.chart=new this.cccType(o);this.chart.setData(values,{crosstabMode:this.crosstabMode,seriesInRows:this.seriesInRows});this.chart.setStructData(sValues);this.chart.render();}});CccAreaChartComponent=CccComponent.extend({cccType:pvc.AreaChart});CccStackedDotChart=CccComponent.extend({cccType:pvc.StackedDotChart});CccDotChartComponent=CccComponent.extend({cccType:pvc.DotChart});CccLineChartComponent=CccComponent.extend({cccType:pvc.LineChart});CccStackedLineChartComponent=CccComponent.extend({cccType:pvc.StackedLineChart});CccStackedAreaChartComponent=CccComponent.extend({cccType:pvc.StackedAreaChart});CccBarChartComponent=CccComponent.extend({cccType:pvc.BarChart});CccPieChartComponent=CccComponent.extend({cccType:pvc.PieChart});CccHeatGridChartComponent=CccComponent.extend({cccType:pvc.HeatGridChart});CccBulletChartComponent=CccComponent.extend({cccType:pvc.BulletChart});CccWaterfallChartComponent=CccComponent.extend({cccType:pvc.WaterfallChart});CccMetricDotChartComponent=CccComponent.extend({cccType:pvc.MetricDotChart});CccMetricLineChartComponent=CccComponent.extend({cccType:pvc.MetricLineChart});CccParCoordComponent=CccComponent.extend({cccType:pvc.ParallelCoordinates});CccDataTreeComponent=CccComponent2.extend({cccType:pvc.DataTree});CccBoxplotChartComponent=CccComponent.extend({cccType:pvc.BoxplotChart});CccTreemapChartComponent=CccComponent.extend({cccType:pvc.TreemapChart});CccNormalizedBarChartComponent=CccComponent.extend({cccType:pvc.NormalizedBarChart});CccSunburstChartComponent=CccComponent.extend({cccType:pvc.SunburstChart});});
var InputBaseComponent=UnmanagedComponent.extend({update:function(){var qd=this.queryDefinition;if(this.valuesArray&&this.valuesArray.length>0){var handler=_.bind(function(){this.draw(this.valuesArray);},this);this.synchronous(handler);}else if(qd){var handler=_.bind(function(data){var filtered;if(this.valueAsId){filtered=data.resultset.map(function(e){return[e[0],e[0]];});}else{filtered=data.resultset;}
this.draw(filtered);},this);this.triggerQuery(qd,handler);}else{var handler=_.bind(function(){var data=this.getValuesArray();this.draw(data);},this);this.synchronous(handler);}},_getParameterValue:function(){return Dashboards.normalizeValue(Dashboards.ev(Dashboards.getParameterValue(this.parameter)));}});var SelectBaseComponent=InputBaseComponent.extend({visible:false,draw:function(myArray){var ph=this.placeholder();if(ph.length===0){Dashboards.log("Placeholder not in DOM - Will not draw","warn");return false;}
var name=this.name;var selectHTML="<select";var allowMultiple=this._allowMultipleValues();if(allowMultiple){selectHTML+=" multiple";}
var placeholderText=this._getPlaceholderText();if(placeholderText){selectHTML+=" data-placeholder='"+placeholderText+"'";}
var size=this._getListSize(myArray);if(size!=null){selectHTML+=" size='"+size+"'";if(myArray.length>size){selectHTML+=" style='overflow-y: scroll;' "}}
var extPlugin=this.externalPlugin;switch(extPlugin){case"chosen":selectHTML+=" class='chzn-select'";break;case"hynds":selectHTML+=" class='hynds-select'";break;case"select2":selectHTML+=" class='select2-container'";break;}
selectHTML+=">";var currentVal=this._getParameterValue();var currentVals=Dashboards.parseMultipleValues((!_.isNaN(currentVal)&&_.isNumber(currentVal))?currentVal+"":currentVal);var valuesIndex={};var firstVal;Dashboards.eachValuesArray(myArray,{valueAsId:this.valueAsId},function(value,label,id,index){selectHTML+="<option value = '"+Dashboards.escapeHtml(value)+"' >"+
Dashboards.escapeHtml(label)+"</option>";if(!index){firstVal=value;}
valuesIndex[value]=true;},this);selectHTML+="</select>";ph.html(selectHTML);var currentIsValid=true;if(currentVals!=null){var i=currentVals.length;while(i--){if(valuesIndex[currentVals[i]]!==true){currentIsValid=false;currentVals.splice(i,1);}}
if(!currentVals.length){currentVals=null;}}
var isEmpty=currentVals==null;var hasChanged=!currentIsValid;if(isEmpty&&this.useFirstValue&&firstVal!=null){currentVals=[firstVal];hasChanged=true;}
$("select",ph).val(currentVals==null?[]:currentVals);if(allowMultiple){if(this.autoTopValue!=null){this.topValue(this.autoTopValue);delete this.autoTopValue;}else if(this.autoTopIndex!=null){this.topIndex(this.autoTopIndex);delete this.autoTopIndex;}}
this._doAutoFocus();if(hasChanged){Dashboards.setParameter(this.parameter,currentVals);Dashboards.processChange(name);}
switch(extPlugin){case"chosen":{var jqBrowser=$.browser;$.browser="";ph.find("select.chzn-select").chosen(this._readExtraOptions());$.browser=jqBrowser;break;}
case"hynds":ph.find("select.hynds-select").multiselect({multiple:allowMultiple});break;case"select2":{var extraOps=this._readExtraOptions()||{};if(typeof extraOps.dropdownAutoWidth==="undefined"){extraOps.dropdownAutoWidth=true;}
if(!extraOps.width){extraOps.width="off";}
ph.find("select.select2-container").select2(extraOps);break;}}
this._listenElement(ph);},_allowMultipleValues:function(){return false;},_getPlaceholderText:function(){var txt=this.placeholderText;return(_.isString(txt)&&!_.isEmpty(txt)&&txt)||false;},_getListSize:function(values){return this.size;},_readExtraOptions:function(){if(this.externalPlugin&&this.extraOptions){return Dashboards.propertiesArrayToObject(this.extraOptions);}},_listenElement:function(elem){var me=this;var prevValue=me.getValue();var stop;var check=function(){stop&&stop();var dash=me.dashboard;if(dash){var currValue=me.getValue();if(!dash.equalValues(prevValue,currValue)){prevValue=currValue;dash.processChange(me.name);}}};var selElem=$("select",elem);selElem.keypress(function(ev){if(ev.which===13){check();}});var changeMode=this._getChangeMode();if(changeMode!=='timeout-focus'){selElem.on(me._changeTrigger(),check);}else{var timScrollFraction=me.changeTimeoutScrollFraction;timScrollFraction=Math.max(0,timScrollFraction!=null?timScrollFraction:1);var timChangeFraction=me.changeTimeoutChangeFraction;timChangeFraction=Math.max(0,timChangeFraction!=null?timChangeFraction:5/8);var changeTimeout=Math.max(100,me.changeTimeout||2000);var changeTimeoutScroll=timScrollFraction*changeTimeout;var changeTimeoutChange=timChangeFraction*changeTimeout;var timeoutHandle;stop=function(){if(timeoutHandle!=null){clearTimeout(timeoutHandle);timeoutHandle=null;}};var renew=function(tim){stop();if(me.dashboard){timeoutHandle=setTimeout(check,tim||changeTimeout);}};selElem.change(function(){renew(changeTimeoutChange);}).scroll(function(){renew(changeTimeoutScroll);}).focusout(check);}},_getChangeMode:function(){var changeMode=this.changeMode;if(changeMode){changeMode=changeMode.toLowerCase();switch(changeMode){case'immediate':case'focus':return changeMode;case'timeout-focus':if((/android|ipad|iphone/i).test(navigator.userAgent)){return'focus';}
return changeMode;default:Dashboards.log("Invalid 'changeMode' value: '"+changeMode+"'.",'warn');}}
return'immediate';},_changeTrigger:function(){if(this._getChangeMode()==='immediate'){return'change';}
return(/android/i).test(navigator.userAgent)?'change':'focusout';}});var SelectComponent=SelectBaseComponent.extend({useFirstValue:true,getValue:function(){return this.placeholder("select").val();}});var SelectMultiComponent=SelectBaseComponent.extend({getValue:function(){var ph=this.placeholder("select");var val=ph.val();return val==null?[]:val;},_allowMultipleValues:function(){return this.isMultiple==null||!!this.isMultiple;},_getListSize:function(values){var size=this.base(values);if(size==null){if(!this._allowMultipleValues()){size=values.length;}}
return size;},topIndex:function(_){var $elem=this.placeholder("select");var elem=$elem[0];var L=elem.length;if(!L){return arguments.length?this:0;}
var h=Math.max(1,elem.scrollHeight);var hi=Math.max(1,h/L);if(arguments.length){var topIndex=+_;topIndex=isNaN(topIndex)?0:Math.max(0,Math.min(topIndex,L-1));$elem.scrollTop(Math.ceil(topIndex*hi));return this;}
return Math.round($elem.scrollTop()/hi);},indexOf:function(value){if(value!=null){var $options=this.placeholder("select option");var L=$options.length;if(L){value=String(value);for(var i=0;i<L;i++){if($options[i].value===value){return i;}}}}
return-1;},valueAt:function(index){if(index>=0){return this.placeholder("select :nth-child("+(index+1)+")").val();}},topValue:function(_){if(arguments.length){var topIndex=this.indexOf(_);if(topIndex>=0){this.topIndex(topIndex);}
return this;}
return this.valueAt(this.topIndex());}});var TextInputComponent=BaseComponent.extend({update:function(){var myself=this;myself._addHtmlToPlaceholder();var el=$("#"+myself.name);el.val(Dashboards.getParameterValue(myself.parameter));el.change(function(){if(Dashboards.getParameterValue(myself.parameter)!==el.val()){Dashboards.processChange(myself.name);}}).keyup(function(ev){if(ev.keyCode==13&&Dashboards.getParameterValue(myself.parameter)!==el.val()){Dashboards.processChange(myself.name);}});myself._doAutoFocus();},getValue:function(){return $("#"+this.name).val();},_addHtmlToPlaceholder:function(){var attrs={type:"text",id:this.name,name:this.name,size:this.size||this.charWidth||undefined,maxlength:this.maxLength||this.maxChars||undefined};var componentHTML='<input '+processAttrs(attrs)+'>';if(this.size)Dashboards.log("Attribute 'size' is deprecated","warn");if(this.maxLength)Dashboards.log("Attribute 'maxLength' is deprecated","warn");this.placeholder().html(componentHTML);function processAttrs(conf){var list=[];for(prop in conf){if(conf.hasOwnProperty(prop)&&conf[prop]!=null){list.push(prop+'="'+conf[prop]+'"');}}
return list.join(" ");}}});var TextareaInputComponent=BaseComponent.extend({update:function(){var myself=this;var name=myself.name;var selectHTML="<textarea id='"+name+"' name='"+name+
(myself.numRows?("' rows='"+myself.numRows):"")+
(myself.numColumns?("' cols='"+myself.numColumns):"")+"'>"+
Dashboards.getParameterValue(myself.parameter)+'</textarea>';myself.placeholder().html(selectHTML);var el=$("#"+name);el.change(function(){if(Dashboards.getParameterValue(myself.parameter)!==el.val()){Dashboards.processChange(name);}});},getValue:function(){return $("#"+this.name).val();}});if($.datepicker){$(function(){$.datepicker.setDefaults($.datepicker.regional[''])});}
var DateInputComponent=BaseComponent.extend({update:function(){var myself=this;var format=(myself.dateFormat==undefined||myself.dateFormat==null)?'yy-mm-dd':myself.dateFormat;var inputId=myself.name;var inputValue=Dashboards.getParameterValue(myself.parameter);var startDate,endDate;if(myself.startDate=='TODAY')startDate=new Date();else if(myself.startDate)startDate=$.datepicker.parseDate(format,myself.startDate);if(myself.endDate=='TODAY')endDate=new Date();else if(myself.endDate)endDate=$.datepicker.parseDate(format,myself.endDate);myself.on('onOpen:dateInput',myself.onOpenEvent);myself.on('onClose:dateInput',myself.onCloseEvent);var $el=$('<input class="date-input" id="'+inputId+'"/>');$el.val(inputValue);myself.placeholder().addClass('date-input-container').html($el);$(function(){myself.placeholder("input").datepicker({beforeShow:function(){myself.triggerOnOpen();},onClose:function(){myself.triggerOnClose();},dateFormat:format,changeMonth:true,changeYear:true,minDate:startDate,maxDate:endDate,onSelect:function(date,input){Dashboards.processChange(inputId);}});if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){var $input=myself.placeholder("input");$input.datepicker('option',$.datepicker.regional[Dashboards.i18nCurrentLanguageCode]);$input.parent().append($('<hidden>').attr("id",inputId+"_hidden"));$input.datepicker("option","altField","#"+inputId+"_hidden");$input.datepicker("option","altFormat",format);}
myself._doAutoFocus();});},triggerOnOpen:function(){this.placeholder("input").toggleClass("dInputComponentExpanded",true);this.trigger('onOpen:dateInput');},triggerOnClose:function(){this.placeholder("input").toggleClass("dInputComponentExpanded",false);this.trigger('onClose:dateInput');},getValue:function(){if(typeof Dashboards.i18nSupport!=="undefined"&&Dashboards.i18nSupport!=null){return $("#"+this.name+"_hidden").val();}else{return $("#"+this.name).val();}}});var DateRangeInputComponent=BaseComponent.extend({update:function(){var dr;var inputId=this.name;var startValue=this.getStartParamValue();var endValue=this.getEndParamValue();var inputSeparator=this.inputSeparator=this.inputSeparator||">";if(this.singleInput==undefined||this.singleInput==true){dr=$('<input class="date-range-single-input" id="'+inputId+'"/>');dr.val(startValue+' '+inputSeparator+' '+endValue);}else{dr=$('<input class="date-range-multiple-input" id="'+inputId+'"/>'+inputSeparator);dr.val(startValue);var dre=$('<input class="date-range-multiple-input-2" id="'+inputId+'2'+'"/>');dre.val(endValue);dr=dr.add(dre);}
this.placeholder().addClass('date-range-input-container').html(dr);this.on('onOpen:dateRangeInput',this.onOpenEvent);this.on('onClose:dateRangeInput',this.onCloseEvent);var offset=dr.offset();var myself=this;var earliestDate=this.earliestDate!=undefined?this.earliestDate:Date.parse('-1years');var latestDate=this.latestDate!=undefined?this.latestDate:Date.parse('+1years');var leftOffset=this.leftOffset!=undefined?this.leftOffset:0;var topOffset=this.topOffset!=undefined?this.topOffset:15;var changed,closed;function triggerWhenDone(){if(changed&&closed){myself.fireInputChange(myself.startValue,myself.endValue);changed=closed=false;}}
var format=(myself.dateFormat==undefined||myself.dateFormat==null)?'yy-mm-dd':myself.dateFormat;$(function(){myself.placeholder("input").daterangepicker({posX:offset.left+leftOffset,posY:offset.top+topOffset,earliestDate:earliestDate,latestDate:latestDate,dateFormat:format,rangeSplitter:inputSeparator,onOpen:function(){myself.triggerOnOpen();changed=closed=false;myself.startValue=null;myself.endValue=null;myself.addCancelButton();},onDateSelect:function(rangeA,rangeB){changed=true;myself.storeChanges(rangeA,rangeB);triggerWhenDone();},onClose:function(){myself.triggerOnClose();closed=true;triggerWhenDone();}});myself._doAutoFocus();if(myself.canClickOutsidePopup){$(document).off('click');}});},triggerOnOpen:function(){this.placeholder("input").toggleClass("driComponentExpanded",true);this.trigger('onOpen:dateRangeInput');},triggerOnClose:function(){this.placeholder("input").toggleClass("driComponentExpanded",false);this.trigger('onClose:dateRangeInput');},getStartParamValue:function(){return Dashboards.getParameterValue(this.parameter[0]);},getEndParamValue:function(){return Dashboards.getParameterValue(this.parameter[1]);},addCancelButton:function(){var start=this.getStartParamValue();var end=this.getEndParamValue();var rpPickers=$(".ui-daterangepickercontain .ranges");var myself=this;var cancelBtn=jQuery('<button class="btnCancel ui-state-default ui-corner-all">Cancel</button>').click(function(){var input=myself.placeholder("input");var rangePicker=$(".ui-daterangepickercontain .ui-daterangepicker");var rangeStart=$(".ui-daterangepickercontain .range-start");var rangeEnd=$(".ui-daterangepickercontain .range-end");if(myself.singleInput==undefined||myself.singleInput==true){input.val(start+" "+myself.inputSeparator+" "+end);}else{input.eq(0).val(start);input.eq(1).val(end)}
rangeStart.data("saveDate",new Date(start)).restoreDateFromData();rangeEnd.data("saveDate",new Date(end)).restoreDateFromData();myself.triggerOnClose();rangePicker.data('state','closed');rangePicker.fadeOut(300);}).hover(function(){jQuery(this).addClass('ui-state-hover');},function(){jQuery(this).removeClass('ui-state-hover');}).appendTo(rpPickers);var ul=$('.ui-daterangepickercontain ul');ul.find("li").click(function(){cancelBtn.hide();setTimeout(function(){cancelBtn.fadeIn();},400);});},fireInputChange:function(start,end){if(this.preChange){this.preChange(start,end);}
if(this.parameter){if(this.parameter.length==2)Dashboards.setParameter(this.parameter[1],end);if(this.parameter.length>0)Dashboards.fireChange(this.parameter[0],start);}
if(this.postChange){this.postChange(start,end);}},storeChanges:function(start,end){this.startValue=start;this.endValue=end;}},{fireDateRangeInputChange:function(name,rangeA,rangeB){var object=Dashboards.getComponentByName(name);if(!(typeof(object.preChange)=='undefined')){object.preChange(rangeA,rangeB);}
var parameters=eval(name+".parameter");Dashboards.setParameter(parameters[1],rangeB);Dashboards.fireChange(parameters[0],rangeA);if(!(typeof(object.postChange)=='undefined')){object.postChange(rangeA,rangeB);}}});var MonthPickerComponent=BaseComponent.extend({update:function(){var myself=this;var name=myself.name;var selectHTML=myself.getMonthPicker(name,myself.size,myself.initialDate,myself.minDate,myself.maxDate,myself.months);myself.placeholder().html(selectHTML);$("#"+name).change(function(){Dashboards.processChange(name);});myself._doAutoFocus();},getValue:function(){var myself=this;var name=myself.name;var value=$("#"+name).val();var year=value.substring(0,4);var month=parseInt(value.substring(5,7)-1);var d=new Date(year,month,1);var selectHTML=myself.getMonthPicker(name,myself.size,d,myself.minDate,myself.maxDate,myself.months);myself.placeholder().html(selectHTML);$("#"+name).change(function(){Dashboards.processChange(name);});return value;},parseDate:function(aDateString){var parsedDate=null;var yearIndex=0,monthIndex=1,dayindex=2;var split=aDateString.split("-");var year,month,day;if(split.length==3){year=parseInt(split[yearIndex]);month=parseInt(split[monthIndex]);day=parseInt(split[dayindex]);parsedDate=new Date(Date.UTC(year,(month-1),day));}else if(split.length==2){year=parseInt(split[yearIndex]);month=parseInt(split[monthIndex]);parsedDate=new Date(Date.UTC(year,(month-1)));}
return parsedDate;},getMonthsAppart:function(aDateOne,aDateTwo){var min,max;if(aDateOne<aDateTwo){min=aDateOne;max=aDateTwo;}else{min=aDateTwo;max=aDateOne;}
var yearsAppart=(max.getFullYear()-min.getFullYear());var monthsToAdd=yearsAppart*12;var monthCount=(max.getMonth()-min.getMonth())+monthsToAdd;return monthCount;},normalizeDateToCompare:function(dateObject){var normalizedDate=dateObject;normalizedDate.setDate(1);normalizedDate.setHours(0);normalizedDate.setMinutes(0);normalizedDate.setSeconds(0);normalizedDate.setMilliseconds(0);return normalizedDate;},getMonthPicker:function(object_name,object_size,initialDate,minDate,maxDate,monthCount){var selectHTML="<select";selectHTML+=" id='"+object_name+"'";if(initialDate==undefined||initialDate==null){initialDate=new Date();}
if(minDate==undefined||minDate==null){minDate=new Date();minDate.setYear(1980);}
if(maxDate==undefined||maxDate==null){maxDate=new Date();maxDate.setYear(2060);}
if(typeof initialDate==="string"){initialDate=this.parseDate(initialDate);}
if(typeof minDate==="string"){minDate=this.parseDate(minDate);}
if(typeof maxDate==="string"){maxDate=this.parseDate(maxDate);}
var monthCountUndefined=false;if(monthCount==undefined||monthCount==0){monthCount=this.getMonthsAppart(minDate,maxDate);monthCountUndefined=true;}
if(object_size!=undefined){selectHTML+=" size='"+object_size+"'";}
selectHTML+='>';var currentDate=new Date(+initialDate);if(monthCountUndefined==true){currentDate.setMonth(currentDate.getMonth()-(this.getMonthsAppart(minDate,currentDate))-1);}else{currentDate.setMonth(currentDate.getMonth()-(monthCount/2)-1);}
currentDate=this.normalizeDateToCompare(currentDate);var normalizedMinDate=this.normalizeDateToCompare(minDate);var normalizedMaxDate=this.normalizeDateToCompare(maxDate);for(var i=0;i<=monthCount;i++){currentDate.setMonth(currentDate.getMonth()+1);if(currentDate>=normalizedMinDate&&currentDate<=normalizedMaxDate){selectHTML+="<option value = '"+currentDate.getFullYear()+"-"+this.zeroPad((currentDate.getMonth()+1),2)+"' ";if(currentDate.getFullYear()==initialDate.getFullYear()&&currentDate.getMonth()==initialDate.getMonth()){selectHTML+="selected='selected'"}
selectHTML+=">"+Dashboards.monthNames[currentDate.getMonth()]+" "+currentDate.getFullYear()+"</option>";}}
selectHTML+="</select>";return selectHTML;},zeroPad:function(num,size){var n="00000000000000"+num;return n.substring(n.length-size,n.length);}});var ToggleButtonBaseComponent=InputBaseComponent.extend({draw:function(myArray){var selectHTML="";var currentVal=Dashboards.getParameterValue(this.parameter);currentVal=(typeof currentVal=='function')?currentVal():currentVal;var isSelected=false;var currentValArray=[];if(currentVal==null||currentVal==undefined){currentValArray=[];}else if(currentVal instanceof Array||(typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else if(typeof(currentVal)=="string"){currentValArray=currentVal.split("|");}
var vid=this.valueAsId==false?0:1;var hasCurrentVal=false;outer:for(var i=0;i<currentValArray.length;i++){for(var y=0;y<myArray.length;y++){if(currentValArray[i]==myArray[y][vid]){hasCurrentVal=true;break outer;}}}
if(!hasCurrentVal&&this.useFirstValue){currentValArray=[myArray[0][vid]];this.currentVal=currentValArray;Dashboards.setParameter(this.parameter,currentValArray);Dashboards.processChange(this.name);}
selectHTML+="<ul class='"+((this.verticalOrientation)?"toggleGroup vertical":"toggleGroup horizontal")+"'>"
for(var i=0,len=myArray.length;i<len;i++){selectHTML+="<li class='"+((this.verticalOrientation)?"toggleGroup vertical":"toggleGroup horizontal")+"'>"
+"<input onclick='ToggleButtonBaseComponent.prototype.callAjaxAfterRender(\""+this.name+"\")'";isSelected=false;for(var j=0,valLength=currentValArray.length;j<valLength;j++){isSelected=currentValArray[j]==myArray[i][vid];if(isSelected){break;}}
if(this.type=='radio'||this.type=='radioComponent'){if((i==0&&!hasCurrentVal)||(hasCurrentVal&&(myArray[i][vid]==currentVal))){selectHTML+=" CHECKED";}
selectHTML+=" type='radio'";}else{if((i==0&&!hasCurrentVal&&this.useFirstValue)||(hasCurrentVal&&isSelected)){selectHTML+=" CHECKED";}
selectHTML+=" type='checkbox'";}
selectHTML+="class='"+this.name+"' id='"+this.name+i+"' name='"+this.name+"' value='"+myArray[i][vid]
+"' /><label for='"+this.name+i+"'>"+Dashboards.sanitizeHtml(myArray[i][1])+"</label></li>"
+((this.separator==undefined||this.separator==null||this.separator=="null")?"":this.separator);}
selectHTML+="</ul>"
this.placeholder().html(selectHTML);this.currentVal=null;this._doAutoFocus();},callAjaxAfterRender:function(name){setTimeout(function(){Dashboards.processChange(name);},1);}});var RadioComponent=ToggleButtonBaseComponent.extend({getValue:function(){if(this.currentVal!='undefined'&&this.currentVal!=null){return this.currentVal;}else{return this.placeholder("."+this.name+":checked").val();}}});var CheckComponent=ToggleButtonBaseComponent.extend({getValue:function(){if(this.currentVal!='undefined'&&this.currentVal!=null){return this.currentVal;}else{var a=new Array()
this.placeholder("."+this.name+":checked").each(function(i,val){a.push($(this).val());});return a;}}});var MultiButtonComponent=ToggleButtonBaseComponent.extend({indexes:[],draw:function(myArray){this.cachedArray=myArray;var cssWrapperClass=wd.helpers.inputHelper.getCssWrapperClass(this.verticalOrientation);var selectHTML="";var firstVal;var valIdx=this.valueAsId?1:0;var lblIdx=1;if(this.isMultiple==undefined)this.isMultiple=false;var ph=$("<div>");ph.appendTo(this.placeholder().empty());for(var i=0,len=myArray.length;i<len;i++){var value=myArray[i][valIdx],label=myArray[i][lblIdx],classes=cssWrapperClass+wd.helpers.inputHelper.getExtraCss(i,len,this.verticalOrientation),selector;value=(value==null?null:value.replace('"','&quot;'));label=(label==null?null:label.replace('"','&quot;'));if(i==0){firstVal=value;}
selectHTML="<div class='"+classes+"'><button type='button' name='"+this.name+"'>"+label+"</button  >"+"</div>";selector=$(selectHTML);var myself=this;(function(index){selector.click(function(){MultiButtonComponent.prototype.clickButton(myself.htmlObject,myself.name,index,myself.isMultiple,myself.verticalOrientation);});}(i));ph.append(selector);if(!(this.separator==undefined||this.separator==null||this.separator=="null")&&i!=myArray.length-1){ph.append(this.separator);}}
var currentVal=Dashboards.ev(Dashboards.getParameterValue(this.parameter));var isSelected=false;var currentValArray;if(currentVal==null||currentVal==undefined){currentValArray=[];}else if(currentVal instanceof Array||(typeof(currentVal)=="object"&&currentVal.join)){currentValArray=currentVal;}else{currentValArray=currentVal.toString().split("|");}
var foundDefault=false;this.clearSelections(this.htmlObject,this.name,this.verticalOrientation);for(var i=0;i<myArray.length;i++){isSelected=false;for(var j=0,valLength=currentValArray.length;j<valLength;j++){isSelected=currentValArray[j]==myArray[i][valIdx];if(isSelected){break;}}
if(($.isArray(currentVal)&&isSelected||isSelected)||(myArray[i][valIdx]==currentVal||myArray[i][lblIdx]==currentVal)){MultiButtonComponent.prototype.clickButton(this.htmlObject,this.name,i,this.isMultiple,this.verticalOrientation,true);foundDefault=true;if(!this.isMultiple){break;}}}
if(((!foundDefault&&!this.isMultiple)||(!foundDefault&&this.isMultiple&&this.useFirstValue))&&myArray.length>0){if((currentVal==null||currentVal==""||((currentVal!==firstVal)&&myArray.length==1)||(typeof(currentVal)=="object"&&currentVal.length==0))&&this.parameter){Dashboards.fireChange(this.parameter,(this.isMultiple)?[firstVal]:firstVal);}
MultiButtonComponent.prototype.clickButton(this.htmlObject,this.name,0,this.isMultiple,this.verticalOrientation,true);}
$("."+wd.helpers.inputHelper.getToggleButtonClass()).hover(function(){$(this).addClass(wd.helpers.inputHelper.getToggleButtonHoveringClass());},function(){$(this).removeClass(wd.helpers.inputHelper.getToggleButtonHoveringClass());});$("."+wd.helpers.inputHelper.getToggleButtonClass()+" button").hover(function(){$(this).parent().addClass(wd.helpers.inputHelper.getToggleButtonHoveringClass());},function(){});this._doAutoFocus();},getValue:function(){if(this.isMultiple){var indexes=MultiButtonComponent.prototype.getSelectedIndex(this.name);var a=new Array();if(indexes.length==undefined){a.push(this.getValueByIdx(indexes));}else{for(var i=0;i<indexes.length;i++){a.push(this.getValueByIdx(indexes[i]));}}
return a;}
else{return this.getValueByIdx(MultiButtonComponent.prototype.getSelectedIndex(this.name));}},getValueByIdx:function(idx){return this.cachedArray[idx][this.valueAsId?1:0];},clickButton:function(htmlObject,name,index,isMultiple,verticalOrientation,updateUIOnly){var cssWrapperClass=wd.helpers.inputHelper.getUnselectedCss(verticalOrientation);var cssWrapperClassSelected=wd.helpers.inputHelper.getSelectedCss(verticalOrientation);var buttons=$("#"+htmlObject+" button");if(isMultiple){if(this.indexes[name]==undefined)this.indexes[name]=[];else if(!$.isArray(this.indexes[name]))this.indexes[name]=[this.indexes[name]];var disable=false;for(var i=0;i<this.indexes[name].length;++i){if(this.indexes[name][i]==index){disable=true;this.indexes[name].splice(i,1);break;}}
if(disable){buttons[index].parentNode.className=cssWrapperClass+wd.helpers.inputHelper.getExtraCss(index,buttons.length,verticalOrientation);}else{buttons[index].parentNode.className=cssWrapperClassSelected+wd.helpers.inputHelper.getExtraCss(index,buttons.length,verticalOrientation);this.indexes[name].push(index);}}else if(this.indexes[name]===index){return false;}else{this.clearSelections(htmlObject,name,verticalOrientation);this.indexes[name]=index;buttons[index].parentNode.className=cssWrapperClassSelected+wd.helpers.inputHelper.getExtraCss(index,buttons.length,verticalOrientation);}
if(!updateUIOnly){this.callAjaxAfterRender(name);}},clearSelections:function(htmlObject,name,verticalOrientation){var buttons=$("#"+htmlObject+" button");var cssWrapperClass=wd.helpers.inputHelper.getUnselectedCss(verticalOrientation);for(var i=0;i<buttons.length;i++){buttons[i].parentNode.className=cssWrapperClass+wd.helpers.inputHelper.getExtraCss(i,buttons.length,verticalOrientation);}
this.indexes[name]=[];},getSelectedIndex:function(name){return this.indexes[name];}});var AutocompleteBoxComponent=BaseComponent.extend({constructor:function(){this.base.apply(this,arguments)
this.selectedValues=[];},result:[],queryServer:function(searchString){if(!this.parameters){this.parameters=[];}
if(_.isString(searchString)){this.searchParam=searchString;}
if(this.searchParam){this.parameters.push([this.searchParam,this.getInnerParameterName()]);}
if(this.maxResults){this.queryDefinition.pageSize=this.maxResults;}
Dashboards.setParameter(this.getInnerParameterName(),this.getTextBoxValue());QueryComponent.makeQuery(this);},getTextBoxValue:function(){return this.textbox.val();},getInnerParameterName:function(){return this.parameter+'_textboxValue';},setInitialValue:function(){var initialValue=null;var param=this.parameter;if(param){initialValue=Dashboards.getParameterValue(param);}
if(initialValue!=null&&_.isArray(initialValue)){for(var i=0,L=initialValue.length;i<L;i++){this.selectValue(initialValue[i]);}}},update:function(){this.ph=this.placeholder().empty();if(this.ph.length===0){Dashboards.log("Placeholder not in DOM - Will not draw","warn");return false;}
this.defaultParameters=_.isArray(this.parameters)?this.parameters.slice():[];var myself=this;if(!_.isFunction(this.processChange)){this.processChange=function(){myself.value=myself.selectedValues;myself.dashboard.processChange(myself.name);}}
var isMultiple=this.selectMulti||false;if(!Dashboards.getParameterValue(this.getInnerParameterName())){Dashboards.setParameter(this.getInnerParameterName(),'');}
this.textbox=$('<input class="autocomplete-input">');var autoComplete=$('<div class="autocomplete-container">');if(isMultiple){var title=this.tooltipMessage||"Click it to Apply";var apply=$('<input type="button" class="autocomplete-input-apply" style="display: none" title="'+title+'" value="'+(this.submitLabel||"S")+'"/>').click(function(){myself.endSearch();});autoComplete.append(apply)}
autoComplete.append(this.textbox).append('<ul class="list-data-selection">').appendTo(this.placeholder());this.textbox.autocomplete(this.getOptions());this.ph.find('.autocomplete-container .ui-autocomplete').off('menuselect');this.ph.find('.autocomplete-container .ui-autocomplete').on('menuselect',function(event,ui){var checkbox=ui?ui.item.find('input'):$(event.target).find('input');if(checkbox.length>0){checkbox.prop('checked',!checkbox.is(':checked'))}
var label=ui?ui.item.find('a').text():$(event.target).text();if(!isMultiple){myself.selectValue(label);myself.endSearch();}else if(checkbox.is(':checked')){myself.selectValue(label);}else{myself.removeValue(label);}});this.textbox.data('ui-autocomplete')._renderItem=function(ul,item){var listItem=$('<li class="list-item">');var content=$('<a>'+item.label+'</a>');if(isMultiple){$('<input type="checkbox"/>').click(function(){$(this).parent().trigger('menuselect');}).prependTo(content);}
content.appendTo(listItem);return listItem.appendTo(ul);};this.ph.find('#'+this.externalApplyButtonId).click(function(){myself.endSearch();});this.setInitialValue();},getOptions:function(){var myself=this;var options={appendTo:this.ph.find('.autocomplete-container'),minLength:this.minTextLength||0,source:function(search,callback){myself.search(search,callback);},focus:function(event,ui){event.preventDefault();},open:function(event,ui){var scroll=myself.scrollHeight||0;if(scroll>0){myself.ph.find('.autocomplete-container .ui-autocomplete').css({'max-height':scroll+'px','overflow-y':'auto'});}
myself.filterData();},close:function(event,ui){myself.processChange();}};return options;},selectValue:function(label){var myself=this;var addTextElements=this.addTextElements!=null?this.addTextElements:true;var showApplyButton=this.showApplyButton!=null?this.showApplyButton:true;var list=this.ph.find('.autocomplete-container .list-data-selection');var listItem=$('<li id="'+label+'"><input type="button" class="close-button" value="x"/>'+label+'</li>');if(!this.selectMulti){list.empty();this.selectedValues=[];}else if(showApplyButton){this.ph.find('.autocomplete-container').addClass('show-apply-button');this.ph.find('.autocomplete-input-apply').show();}
listItem.find('input').click(function(){myself.removeValue(label,true);});if(addTextElements){listItem.appendTo(list);}
this.selectedValues.push(label);},removeValue:function(id,change){this.selectedValues=_.without(this.selectedValues,id);this.ph.find('.autocomplete-container .list-data-selection li[id="'+id+'"]').remove();if(change){this.processChange();}},filterData:function(){var menu=this.ph.find('.autocomplete-container .ui-autocomplete');var data=this.selectedValues||[];var addTextElements=this.addTextElements!=null?this.addTextElements:true;if(data.length>0){menu.find('li').each(function(){var $this=$(this);var label=$this.text();if(data.indexOf(label)>-1){if(addTextElements){$this.remove();}else{$this.find('input').prop('checked',true);}}});if(menu.find('li').length==0){menu.hide();}}},search:function(search,callback){var matchType=this.matchType||'fromStart';var val=search.term.toLowerCase();this.queryServer(val);var result=this.result;var list=[];this.parameters=this.defaultParameters.slice();for(var p in result)if(result.hasOwnProperty(p)){var value=result[p][0];if(value!=null&&(matchType==='fromStart'&&value.toLowerCase().indexOf(val)==0)||(matchType==='all'&&value.toLowerCase().indexOf(val)>-1)){list.push(value);}}
callback(list);},endSearch:function(){var container=this.ph.find('.autocomplete-container');container.removeClass('show-apply-button');container.find('.autocomplete-input-apply').hide();this.textbox.val('');this.textbox.autocomplete("close");},getValue:function(){return this.value;},processAutoBoxChange:function(){this.textbox.autocomplete("change");}});var ButtonComponent=ActionComponent.extend({_docstring:function(){return"Button Component that triggers a server action when clicked";},render:function(){var myself=this;if($.fn.button.noConflict){$.fn.button.noConflict();}
if(typeof this.successCallback==='function'){var orSuccessCallback=this.successCallback;this.successCallback=function(){myself.enable();orSuccessCallback.apply(myself,arguments);};}else{this.successCallback=function(){myself.enable();};}
if(typeof this.failureCallback==='function'){var orFailureCallback=this.failureCallback;this.failureCallback=function(){myself.enable();orFailureCallback.apply(myself,arguments);};}else{this.failureCallback=function(){myself.enable();};}
if(typeof this.buttonStyle==="undefined"){this.buttonStyle=typeof wcdfSettings!="undefined"&&wcdfSettings.rendererType==="bootstrap"?"bootstrap":"themeroller";}
var cssClass=this.cssClass||"";if(this.buttonStyle==="bootstrap"){cssClass="btn-default "+cssClass;}
var b=$("<button type='button'/>").addClass('buttonComponent '+cssClass).unbind("click").bind("click",function(){var proceed=true;myself.disable();if(_.isFunction(myself.expression)){proceed=myself.expression.apply(myself,arguments);if(!myself.hasAction()){myself.enable();}}
else if(!myself.expression){if(!myself.hasAction()){myself.enable();}}
if(myself.hasAction()&&!(proceed===false)){return myself.triggerAction.apply(myself);}});if(this._isJQueryUiButton()){b.button();}
b.appendTo(this.placeholder().empty());this.setLabel(this.label);this.enable();this._doAutoFocus();},disable:function(){this.placeholder('button').attr('disabled','disabled');this.placeholder('button').removeClass('enabled').addClass('disabled');},enable:function(){this.placeholder('button').removeAttr('disabled');this.placeholder('button').removeClass('disabled').addClass('enabled');},setLabel:function(label){var validatedLabel=typeof label==='function'?label.call(this):(label||"");this.label=validatedLabel.toString();if(this._isJQueryUiButton()){this.placeholder('button').button('option','label',this.label);}else{this.placeholder('button').text(this.label);}},_isJQueryUiButton:function(){return _.isUndefined(this.buttonStyle)||this.buttonStyle==="themeroller";}});
if($.fn.dataTableExt!=undefined){$.fn.dataTableExt.oApi.fnLengthChange=function(oSettings,iDisplay)
{oSettings._iDisplayLength=iDisplay;oSettings.oApi._fnCalculateEnd(oSettings);if(oSettings._iDisplayEnd==oSettings.aiDisplay.length)
{oSettings._iDisplayStart=oSettings._iDisplayEnd-oSettings._iDisplayLength;if(oSettings._iDisplayStart<0)
{oSettings._iDisplayStart=0;}}
if(oSettings._iDisplayLength==-1)
{oSettings._iDisplayStart=0;}
oSettings.oApi._fnDraw(oSettings);$('select',oSettings.oFeatures.l).val(iDisplay);};$.extend($.fn.dataTableExt.oSort,{"html-asc":function(a,b){var x=a.replace(/<.*?>/g,"").toLowerCase();var y=b.replace(/<.*?>/g,"").toLowerCase();return((x<y)?-1:((x>y)?1:0));},"html-desc":function(a,b){var x=a.replace(/<.*?>/g,"").toLowerCase();var y=b.replace(/<.*?>/g,"").toLowerCase();return((x<y)?1:((x>y)?-1:0));},"date-asc":function(a,b){var x=Date.parse(a);var y=Date.parse(b);if(isNaN(x)||x===""){x=Date.parse("01/01/1970 00:00:00");}
if(isNaN(y)||y===""){y=Date.parse("01/01/1970 00:00:00");}
return x-y;},"date-desc":function(a,b){var x=Date.parse(a);var y=Date.parse(b);if(isNaN(x)||x===""){x=Date.parse("01/01/1970 00:00:00");}
if(isNaN(y)||y===""){y=Date.parse("01/01/1970 00:00:00");}
return y-x;},"numeric-asc":function(a,b){a=(a=="-"||a=="")?0:($.isNumeric(a)?a*1:0);b=(b=="-"||b=="")?0:($.isNumeric(b)?b*1:0);return((a<b)?-1:((a>b)?1:0));},"numeric-desc":function(a,b){a=(a=="-"||a=="")?0:($.isNumeric(a)?a*1:0);b=(b=="-"||b=="")?0:($.isNumeric(b)?b*1:0);return((a<b)?1:((a>b)?-1:0));}});}
if(jQuery.fn.DataTable!=undefined&&jQuery.fn.DataTable.ext!=undefined){jQuery.extend(jQuery.fn.DataTable.ext.classes,{"sNoFooter":"","sPagePrevEnabled":"paginate_enabled_previous","sPagePrevDisabled":"paginate_disabled_previous","sPageNextEnabled":"paginate_enabled_next","sPageNextDisabled":"paginate_disabled_next"});jQuery.extend(jQuery.fn.DataTable.ext.oJUIClasses,{"sNoFooter":"","sSortable":"","sSortAsc":"","sSortDesc":"","sSortColumn":"","sPagePrevEnabled":"fg-button ui-button ui-state-default ui-corner-left","sPagePrevDisabled":"fg-button ui-button ui-state-default ui-corner-left ui-state-disabled","sPageNextEnabled":"fg-button ui-button ui-state-default ui-corner-right","sPageNextDisabled":"fg-button ui-button ui-state-default ui-corner-right ui-state-disabled","sPageJUINext":"ui-icon ui-icon-circle-arrow-e","sPageJUIPrev":"ui-icon ui-icon-circle-arrow-w"});jQuery.extend(jQuery.fn.DataTable.ext.pager,{"two_button":{"fnInit":function(oSettings,nPaging,fnCallbackDraw){var oLang=oSettings.oLanguage.oPaginate;var oClasses=oSettings.oClasses;var fnClickHandler=function(e){if(oSettings.oApi._fnPageChange(oSettings,e.data.action)){fnCallbackDraw(oSettings);}};var sAppend=(!oSettings.bJUI)?'<a class="'+oSettings.oClasses.sPagePrevDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button"></a>'+'<a class="'+oSettings.oClasses.sPageNextDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button"></a>':'<a class="'+oSettings.oClasses.sPagePrevDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button"><span class="'+oSettings.oClasses.sPageJUIPrev+'"></span></a>'+'<a class="'+oSettings.oClasses.sPageNextDisabled+'" tabindex="'+oSettings.iTabIndex+'" role="button"><span class="'+oSettings.oClasses.sPageJUINext+'"></span></a>';$(nPaging).append(sAppend);var els=$('a',nPaging);var nPrevious=els[0],nNext=els[1];oSettings.oApi._fnBindAction(nPrevious,{action:"previous"},fnClickHandler);oSettings.oApi._fnBindAction(nNext,{action:"next"},fnClickHandler);if(!oSettings.aanFeatures.p){nPaging.id=oSettings.sTableId+'_paginate';nPrevious.id=oSettings.sTableId+'_previous';nNext.id=oSettings.sTableId+'_next';nPrevious.setAttribute('aria-controls',oSettings.sTableId);nNext.setAttribute('aria-controls',oSettings.sTableId);}},"fnUpdate":function(oSettings,fnCallbackDraw){if(!oSettings.aanFeatures.p){return;}
var oClasses=oSettings.oClasses;var an=oSettings.aanFeatures.p;var nNode;for(var i=0,iLen=an.length;i<iLen;i++){nNode=an[i].firstChild;if(nNode){nNode.className=(oSettings._iDisplayStart===0)?oClasses.sPagePrevDisabled:oClasses.sPagePrevEnabled;nNode=nNode.nextSibling;nNode.className=(oSettings.fnDisplayEnd()==oSettings.fnRecordsDisplay())?oClasses.sPageNextDisabled:oClasses.sPageNextEnabled;}}}}});}
var TableComponent=UnmanagedComponent.extend({ph:undefined,update:function(){var myself=this;if(!this.preExec()){return;}
if(!this.htmlObject){return this.error("TableComponent requires an htmlObject");}
try{if(!this.isSilent()){this.block();}
this.setup();if(this.chartDefinition.paginateServerside){this.paginatingUpdate();}else{var success=_.bind(function(data){this.rawData=data;this.processTableComponentResponse(data)},this);var handler=this.getSuccessHandler(success);this.queryState.setAjaxOptions({async:true});var params=this.parameters==undefined?[]:this.parameters;this.queryState.fetchData(params,handler,function(){if(myself.failureCallback){myself.failureCallback();}
myself.isDataPush=false;if(!myself.isSilent()){myself.unblock();}
myself.trigger("cdf cdf:error",myself,"",null);});}}catch(e){Dashboards.log(e,'exception');if(!this.isSilent()){this.unblock();}}},paginatingUpdate:function(){var cd=this.chartDefinition;this.extraOptions=this.extraOptions||[];this.extraOptions.push(["bServerSide",true]);this.extraOptions.push(["bProcessing",true]);this.queryState.setPageSize(parseInt(cd.displayLength||10));var success=_.bind(function(values){var changedValues=undefined;if((typeof(this.postFetch)=='function')){changedValues=this.postFetch(values);}
if(changedValues!=undefined){values=changedValues;}
this.processTableComponentResponse(values);},this);this.queryState.setCallback(success);if(this.parameters){this.queryState.setParameters(this.parameters);}
this.queryState.setAjaxOptions({async:true});var myself=this;this.queryState.fetchData(this.parameters,success,function(){if(myself.failureCallback){myself.failureCallback();}
myself.isDataPush=false;});},setup:function(){var cd=this.chartDefinition;if(cd==undefined){Dashboards.log("Fatal - No chart definition passed","error");return;}
if(typeof cd.tableStyle==="undefined"){cd.tableStyle=typeof wcdfSettings!="undefined"&&wcdfSettings.rendererType==="bootstrap"?"bootstrap":"classic";}
cd["tableId"]=this.htmlObject+"Table";$(this.expandParameters).each(function f(i,elt){Dashboards.setParameter(elt[1],"");});this.ph=this.clearsBeforePreExecution?$("#"+this.htmlObject).empty():$("#"+this.htmlObject);var croppedCd=$.extend({},cd);croppedCd.drawCallback=undefined;this.queryState=Dashboards.getQuery(croppedCd);if(this.query){this.query.dispose();}
this.query=this.queryState;var sortBy=this.chartDefinition.sortBy||[],sortOptions=[];for(var i=0;i<sortBy.length;i++){var col=sortBy[i][0];var dir=sortBy[i][1];sortOptions.push(col+(dir=="asc"?"A":"D"));}
this.queryState.setSortBy(sortOptions);},pagingCallback:function(url,params,callback,dataTable,json,firstRun){function p(sKey){for(var i=0,iLen=params.length;i<iLen;i++){if(params[i].name==sKey){return params[i].value;}}
return null;}
var sortingCols=p("order"),sort=[];if(sortingCols&&sortingCols.length>0){for(var i=0;i<sortingCols.length;i++){var col=sortingCols[i].column;var dir=sortingCols[i].dir;sort.push(col+(dir=="asc"?"A":"D"));}}
var query=this.queryState,myself=this;query.setSortBy(sort.join(","));query.setPageSize(parseInt(p("length")));query.setPageStartingAt(p("start"));query.setSearchPattern(p("search")?p("search").value:"");var success=function(d){if(myself.postFetch){var mod=myself.postFetch(d,dataTable);if(typeof mod!=="undefined"){d=mod;}}
var response;if(d.queryInfo){response={iTotalRecords:d.queryInfo.totalRows,iTotalDisplayRecords:d.queryInfo.totalRows};}else{response={iTotalRecords:d.resultset.length,iTotalDisplayRecords:d.resultset.length};}
response.aaData=d.resultset;response.sEcho=p("sEcho");myself.rawData=d;callback(response);};if(firstRun){query.setCallback(success);success(json);}else{query.fetchData(success,function(){if(myself.failureCallback){myself.failureCallback();}
myself.isDataPush=false;});}},fnDrawCallback:function(dataTableSettings){var dataTable=dataTableSettings.oInstance,cd=this.chartDefinition,myself=this;var tableRows=this.ph.find("tbody tr");for(var k=0;k<tableRows.length;k++){if(dataTable.fnGetPosition(tableRows[k])==null){return true;}
var tableData=$(tableRows[k]).children("td");for(var i=0;i<tableData.length;i++){var td=tableData[i];var $td=$(td);var position=dataTable.fnGetPosition(td);if(position&&typeof position[0]=="number"){var rowIdx=position[0],colIdx=position[2];var foundAddIn=myself.handleAddIns(dataTable,td,$td,rowIdx,colIdx);if(!foundAddIn&&cd.colFormats){var format=cd.colFormats[colIdx],value=myself.rawData.resultset[rowIdx][colIdx];if(format&&(typeof value!="undefined"&&value!==null)){$td.text(sprintf(format,value));}}}}}
if(cd.urlTemplate!=undefined){var td=$("#"+myself.htmlObject+" td:nth-child(1)");td.addClass('cdfClickable');td.bind("click",function(e){var regex=new RegExp("{"+cd.parameterName+"}","g");var f=cd.urlTemplate.replace(regex,$(this).text());eval(f);});}
if(typeof cd.drawCallback=='function'){cd.drawCallback.apply(myself,arguments);}},fnInitComplete:function(){this.postExec();if(!this.isSilent()){this.unblock();}
this.isDataPush=false;},handleAddIns:function(dataTable,td,$td,rowIdx,colIdx){var cd=this.chartDefinition,colType=cd.colTypes[colIdx],state={},target=$td,results=this.rawData,addIn=this.getAddIn("colType",colType);if(!addIn){return false;}
try{if(!(target.parents('tbody').length)){return;}else if(target.get(0).tagName!='TD'){target=target.closest('td');}
state.rawData=results;state.tableData=dataTable.fnGetData();state.colIdx=colIdx;state.rowIdx=rowIdx;state.series=results.resultset[state.rowIdx][0];state.category=results.metadata[state.colIdx].colName;state.value=results.resultset[state.rowIdx][state.colIdx];if(cd.colFormats){state.colFormat=cd.colFormats[state.colIdx];}
state.target=target;addIn.call(td,state,this.getAddInOptions("colType",addIn.getName()));return true;}catch(e){Dashboards.log(e,'exception');return false;}},processTableComponentResponse:function(json){var myself=this,cd=this.chartDefinition,extraOptions={};this.ph.trigger('cdfTableComponentProcessResponse');if(typeof cd.colHeaders==="undefined"||cd.colHeaders.length==0)
cd.colHeaders=json.metadata.map(function(i){return i.colName});if(typeof cd.colTypes==="undefined"||cd.colTypes.length==0)
cd.colTypes=json.metadata.map(function(i){return i.colType.toLowerCase()});var dtData0=TableComponent.getDataTableOptions(cd);$.each(this.extraOptions?this.extraOptions:{},function(i,e){extraOptions[e[0]]=e[1];});var dtData=$.extend(cd.dataTableOptions,dtData0,extraOptions);dtData.fnDrawCallback=_.bind(this.fnDrawCallback,this);dtData.fnInitComplete=_.bind(this.fnInitComplete,this);if(dtData.bServerSide){var myself=this;var firstRun=true;dtData.fnServerData=function(u,p,c){myself.pagingCallback(u,p,c,this,json,firstRun);firstRun=false;};if(!json.queryInfo){dtData.iDisplayLength=json.resultset.length;dtData.bLengthChange=false;Dashboards.log("Please use CDA queries to enable server-side pagination.","warn");}}
if(json){dtData.aaData=json.resultset;}
var tableClassName=dtData.tableStyle=="bootstrap"?'table table-striped table-bordered form-inline table-responsive':'tableComponent compact';this.ph.html("<table id='"+this.htmlObject+"Table' class='"+tableClassName+"' width='100%'></table>");this.dataTable=$("#"+this.htmlObject+'Table').dataTable(dtData);this.dataTable.anOpen=[];myself.ph.find('table').bind('click',function(e){if(typeof cd.clickAction==='function'||myself.expandOnClick){var state={},target=$(e.target),results=myself.rawData;if(!(target.parents('tbody').length)){return;}else if(target.get(0).tagName!='TD'){target=target.closest('td');}
if(!myself.dataTable.api(true).cell(target.get(0)).index()){Dashboards.log("Click on invalid data detected.","warn");return;}
var position=myself.dataTable.fnGetPosition(target.get(0));state.rawData=myself.rawData;state.tableData=myself.dataTable.fnGetData();state.colIdx=position[2];state.rowIdx=position[0];state.series=results.resultset[state.rowIdx][0];state.category=results.metadata[state.colIdx].colName;state.value=results.resultset[state.rowIdx][state.colIdx];state.colFormat=cd.colFormats[state.colIdx];state.target=target;if(myself.expandOnClick){myself.handleExpandOnClick(state);}
if(cd.clickAction){cd.clickAction.call(myself,state);}}});myself.ph.trigger('cdfTableComponentFinishRendering');},handleExpandOnClick:function(event){var myself=this,detailContainerObj=myself.expandContainerObject,activeclass="expandingClass";if(typeof activeclass==='undefined'){activeclass="activeRow";}
var obj=event.target.closest("tr"),a=event.target.closest("a");if(a.hasClass('info')){return;}else{var row=obj.get(0),anOpen=myself.dataTable.anOpen,i=$.inArray(row,anOpen);if(obj.hasClass(activeclass)){myself.detachFromRow(row,i,activeclass);$(myself.expandParameters).each(function f(i,elt){Dashboards.setParameter(elt[1],"");});}else{for(var j=0;j<anOpen.length;j++){myself.detachFromRow(anOpen[j],j,activeclass);}
obj.addClass(activeclass);myself.attachToRow(row,activeclass);var results=myself.queryState.lastResults();var firstChange=null;$(myself.expandParameters).each(function f(i,elt){if(!firstChange&&Dashboards.getParameterValue(elt[1])!==results.resultset[event.rowIdx][parseInt(elt[0],10)]){firstChange=elt;}else{Dashboards.setParameter(elt[1],results.resultset[event.rowIdx][parseInt(elt[0],10)]);}});if(firstChange!==null){Dashboards.fireChange(firstChange[1],results.resultset[event.rowIdx][parseInt(firstChange[0],10)]);}}}
$("td.expandingClass").click(function(event){event.stopPropagation();return;});},attachToRow:function(row,activeClass){this.dataTable.anOpen.push(row);this.dataTable.fnOpen(row,"",activeClass);var expandPlace=$(row).next().children().empty();var expandObj;if(!this.expandClone){var containerId="#"+this.expandContainerObject;expandObj=$(containerId);this.expandClone=expandObj.clone(true);}else{expandObj=this.expandClone;}
expandObj.appendTo(expandPlace).show();},detachFromRow:function(row,index,activeClass){$(row).next().find("td."+activeClass+" > *").remove();$(row).removeClass(activeClass);this.dataTable.fnClose(row);this.dataTable.anOpen.splice(index,1);$(".dataTables_wrapper div.dataTables_paginate").off('click');}},{getDataTableOptions:function(options){var dtData={};if(options.tableStyle=="themeroller"){dtData.bJQueryUI=true;}
dtData.bInfo=options.info;dtData.iDisplayLength=options.displayLength;dtData.bLengthChange=options.lengthChange;dtData.bPaginate=options.paginate;dtData.bSort=options.sort;dtData.bFilter=options.filter;dtData.sPaginationType=options.paginationType;dtData.sDom=options.sDom;dtData.aaSorting=options.sortBy;dtData.tableStyle=options.tableStyle;if(typeof options.oLanguage=="string"){dtData.oLanguage=eval("("+options.oLanguage+")");}
else{dtData.oLanguage=options.oLanguage;}
if(typeof options.language=="string"){dtData.language=eval("("+options.language+")");}else{dtData.language=options.language;}
if(options.colHeaders!=undefined){dtData.aoColumns=new Array(options.colHeaders.length);for(var i=0;i<options.colHeaders.length;i++){dtData.aoColumns[i]={}
dtData.aoColumns[i].sClass="column"+i;};$.each(options.colHeaders,function(i,val){dtData.aoColumns[i].sTitle=Dashboards.escapeHtml(val);if(val=="")dtData.aoColumns[i].bVisible=false;});if(options.colTypes!=undefined){$.each(options.colTypes,function(i,val){var col=dtData.aoColumns[i];if(val=="hidden")col.bVisible=false;col.sClass+=" "+val;col.sType=val;})};if(options.colFormats!=undefined){};var bAutoWidth=true;if(options.colWidths!=undefined){$.each(options.colWidths,function(i,val){if(val!=null){dtData.aoColumns[i].sWidth=val;bAutoWidth=false;}})};dtData.bAutoWidth=bAutoWidth;if(options.colSortable!=undefined){$.each(options.colSortable,function(i,val){if(val!=null&&(!val||val=="false")){dtData.aoColumns[i].bSortable=false}})};if(options.colSearchable!=undefined){$.each(options.colSearchable,function(i,val){if(val!=null&&(!val||val=="false")){dtData.aoColumns[i].bSearchable=false}})};}
return dtData;}});
var XactionComponent=BaseComponent.extend({update:function(){var myself=this;try{if(typeof(myself.iframe)=='undefined'||!myself.iframe){var p=new Array(myself.parameters?myself.parameters.length:0);for(var i=0,len=p.length;i<len;i++){var key=myself.parameters[i][0];var value=myself.parameters[i][1]==""?myself.parameters[i][2]:Dashboards.getParameterValue(myself.parameters[i][1]);if(myself.value=="NIL"){myself.value=myself.parameters[i][2];}
p[i]=[key,value];}
if(typeof(myself.serviceMethod)=='undefined'||myself.serviceMethod=='ServiceAction'){var jXML=Dashboards.callPentahoAction(myself,myself.solution,myself.path,myself.action,p,null);if(jXML!=null){$('#'+myself.htmlObject).html(jXML.find("ExecuteActivityResponse:first-child").text());}}else{var html=Dashboards.pentahoServiceAction(myself.serviceMethod,'html',myself.solution,myself.path,myself.action,p,null);$('#'+myself.htmlObject).html(html);}}else{var xactionIFrameHTML="<iframe id=\"iframe_"+myself.htmlObject+"\""+" frameborder=\"0\""+" height=\"100%\""+" width=\"100%\" />";var iframe=$(xactionIFrameHTML);var actionIncluded=function(path,action){return(typeof path=="string")&&(typeof action=="string")&&(path.length>action.length)&&(path.lastIndexOf(action)==(path.length-action.length))&&("\\/".indexOf(path.substr(-action.length-1,1))>=0);};var url;if(actionIncluded(myself.path,myself.action)){url=wd.cdf.endpoints.getCdfXaction(myself.path,"",myself.solution)+"&wrapper=false";}else{url=wd.cdf.endpoints.getCdfXaction(myself.path,myself.action,myself.solution)+"&wrapper=false";}
var p=new Array(myself.parameters.length);for(var i=0,len=p.length;i<len;i++){var arg="&"+encodeURIComponent(myself.parameters[i][0])+"=";var val="";if(myself.parameters[i][1]==""){val=encodeURIComponent(myself.parameters[i][2]);}else{val=encodeURIComponent(Dashboards.getParameterValue(myself.parameters[i][1]));if(val=="NIL"){val=encodeURIComponent(myself.parameters[i][2]);}}
url+=arg+val;}
if(!myself.loading){myself.loading=true;Dashboards.incrementRunningCalls();}
iframe.on('load',function(){if(this.contentWindow.document.body.innerHTML){myself.loading=false;Dashboards.decrementRunningCalls();}});$("#"+myself.htmlObject).empty().append(iframe);iframe[0].contentWindow.location=url;}}catch(e){}}});var ExecuteXactionComponent=BaseComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+myself.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV"){o.wrap("<span/>");}
if(myself.label!=undefined){o.text(myself.label);}
o.button();}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.executeXAction();}
if(typeof(myself.postChange)!='undefined'){myself.postChange();}});},executeXAction:function(){var url=wd.cdf.endpoints.getCdfXaction(this.path,this.action,this.solution)+"&";var p=new Array(this.parameters.length);var parameters=[];for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);if($.isArray(value)){$(value).each(function(p){parameters.push(key+"="+encodeURIComponent(this));});}else{parameters.push(key+"="+encodeURIComponent(value));}}
url+=parameters.join("&");url=url.replace(/'/g,"&#39;");$.fancybox.open({src:url,type:"iframe",baseClass:"cdf-fancybox cdf-fancybox-iframe",btnTpl:{smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="close"></button>'}},{toolbar:false,smallBtn:true,iframe:{preload:false,css:{width:$(window).width(),height:$(window).height()-50,"max-width":"100%","max-height":"100%"}}});}});
var JpivotComponent=BaseComponent.extend({update:function(){if(this.iframeScrolling==undefined){this.iframeScrolling="no";}
var jpivotHTML="<iframe id=\"jpivot_"+this.htmlObject+"\" scrolling=\""+this.iframeScrolling+"\" onload=\"var dynamicHeight = this.contentWindow.document.body.offsetHeight+50; this.style.height = dynamicHeight + 'px';\" frameborder=\"0\" height=\""+this.iframeHeight+"\" width=\""+this.iframeWidth+"\" src=\"";var params={};var p=new Array(this.parameters.length);for(var i=0,len=p.length;i<len;i++){var key=this.parameters[i][0];var value=Dashboards.getParameterValue(this.parameters[i][1]);params[key]=value;}
jpivotHTML+=wd.cdf.endpoints.getCdfXaction(this.path,this.action,this.solution,params);jpivotHTML+="\"></iframe>";$("#"+this.htmlObject).html(jpivotHTML);}});var PivotLinkComponent=BaseComponent.extend({update:function(){var title=this.tooltip==undefined?"View details in a Pivot table":this.tooltip;var link=$('<a class="pivotLink"> </a>').html(this.content).attr("href","javascript:PivotLinkComponent.openPivotLink("+this.name+")").attr("title",title);$("#"+this.htmlObject).empty();$("#"+this.htmlObject).html(link);$('a.pivotLink').tooltip({showURL:false,track:true,delay:1000,opacity:0.5,content:title});}},{openPivotLink:function(object){var url=wd.cdf.endpoints.getPivot("system","pentaho-cdf/actions","jpivot.xaction")+"&";var qd=object.pivotDefinition;var parameters=[];for(p in qd){var key=p;var value=typeof qd[p]=='function'?qd[p]():qd[p];parameters.push(key+"="+encodeURIComponent(value));}
url+=parameters.join("&");url=url.replace(/'/g,"&#39;");$.fancybox.open({src:url,type:"iframe",baseClass:"cdf-fancybox cdf-fancybox-iframe",btnTpl:{smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="close"></button>'}},{toolbar:false,smallBtn:true,iframe:{preload:false,css:{width:$(window).width(),height:$(window).height(),"max-width":"100%","max-height":"100%"}}});}});
var AnalyzerComponent=BaseComponent.extend({update:function(){this.clear();var options=this.getOptions();var callVar=this.isEditMode()?"editor":"viewer";$.extend(options,{ts:new Date().getTime()});var url=wd.cdf.endpoints.getAnalyzer({solution:this.solution,path:this.path,action:this.action},callVar,options);var iframe=this.generateIframe(url);$("#"+this.htmlObject).html(iframe);},getOptions:function(){var myself=this;var options={command:myself.command==undefined?"open":myself.command,showFieldList:myself.showFieldList==undefined?false:myself.showFieldList,showRepositoryButtons:myself.showRepositoryButtons==undefined?false:myself.showRepositoryButtons,frameless:myself.frameless==undefined?false:myself.frameless};myself.dateFormats=myself.dateFormats==undefined?{}:myself.dateFormats;$.map(myself.parameters,function(k){options[k[0]]=Dashboards.getParameterValue(k[1]);if(myself.dateFormats[k[0]]){var formatedDate=moment(options[k[0]]).format(myself.dateFormats[k[0]]);if(formatedDate!=='Invalid date'){options[k[0]]=formatedDate;}}});return options;},isEditMode:function(){if(this.viewOnly!=undefined){return!this.viewOnly||this.editMode;}else{return this.editMode;}},generateIframe:function(url){return"<iframe id ='iframe_"+this.htmlObject+"' "
+"style='height:100%;width:100%;border:0' "
+"frameborder='0' src='"+url+"'/>";}});var ExecuteAnalyzerComponent=AnalyzerComponent.extend({update:function(){var $html=$("#"+this.htmlObject);if($.inArray($html[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){$html=$("<button/>").appendTo($html.empty());if($html[0].tagName==="DIV"){$html.wrap("<span/>");}
if(this.label!=null){$html.text(this.label);}
$html.button();}
$html.unbind("click");var myself=this;$html.bind("click",function(){var success=typeof myself.preChange==='function'?myself.preChange():true;if(success){myself.executeAnalyzerComponent();}
if(typeof myself.postChange==='function'){myself.postChange();}});},executeAnalyzerComponent:function(){var callVar=this.isEditMode()?"editor":"viewer";var parameters=this.getOptions();parameters.ts=new Date().getTime();var pathOptions={solution:this.solution,path:this.path,action:this.action};$.fancybox.open({src:wd.cdf.endpoints.getAnalyzer(pathOptions,callVar,parameters),type:"iframe",baseClass:"cdf-fancybox cdf-fancybox-iframe",btnTpl:{smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="close"></button>'}},{toolbar:false,smallBtn:true,iframe:{preload:false,css:{width:$(window).width(),height:$(window).height()-50,"max-width":"100%","max-height":"100%"}}});}});
var VisualizationAPIComponent=(function(){var Table=null;var visualUtil=null;return UnmanagedComponent.extend({__reset:function(){Table=null;visualUtil=null;},update:function(){if(visualUtil===null)
this.__requireFilesAndUpdate();else
this.__updateCore();},__requireFilesAndUpdate:function(){var me=this;require(["pentaho/data/Table","pentaho/visual/util","pentaho/shim/es6-promise"],function(_Table,_visualUtil){Table=_Table;visualUtil=_visualUtil;me.__updateCore();});},__updateCore:function(){this.__checkVizType();this.triggerQuery(this.queryDefinition,_.bind(this.__render,this));},__render:function(dataSpec){this.__checkVizType();var promise=!this.viz?this.__createVizAsync(dataSpec):this.__syncVizAsync(dataSpec);var me=this;promise.then(_.bind(this.__updateViz,this))
["catch"](function(reason){var domElem=me.placeholder()[0];Dashboards.error("Unable to update the visualization component: "+reason);Dashboards.errorNotification({msg:"Error processing component: render_"+me.name},domElem);});},viz:null,__vizView:null,__vizClassesPromise:null,__vizClassesId:null,__vizStyleClass:null,_onGetVizSpec:function(vizSpec){},_onDidCreateViz:function(){},_onWillDisposeViz:function(){},__updateViz:function(){return this.viz.update();},__disposeViz:function(){if(this.viz){this._onWillDisposeViz();if(this.__vizView){this.__vizView.dispose();this.__vizView=null;}
this.viz=null;}},__checkVizType:function(){this.__getVizClassesAsync()
["catch"](function(){});},__getVizClassesAsync:function(){var vizId=this.vizId;if(!vizId){return Promise.reject(new Error("Visualization ID is not specified."));}
var vizClassesId=this.__vizClassesId;if(!vizClassesId||vizClassesId!==vizId){this.__disposeViz();this.__vizClassesId=vizId;this.__vizClassesPromise=visualUtil.getModelAndDefaultViewClassesAsync(vizId);}
return this.__vizClassesPromise;},__getVizSpec:function(dataSpec){var vizSpec={width:this.width,height:this.height};if(dataSpec!==undefined){vizSpec.data=new Table(dataSpec);}
_.each(this.vizOptions,function(v){var propName=v[0];switch(propName){case"data":return;}
var paramName=v[1];var value=this.getParameterValue(paramName);vizSpec[propName]=value;},this.dashboard);this._onGetVizSpec(vizSpec);vizSpec.isAutoUpdate=true;return vizSpec;},__createVizAsync:function(dataSpec){return this.__getVizClassesAsync().then(_.bind(this.__onGotVizClasses,this,dataSpec));},__onGotVizClasses:function(dataSpec,classes){this.__disposeViz();var vizSpec=this.__getVizSpec(dataSpec);var viz=new classes.Model(vizSpec);var domContainer=this.__setupDomContainer(classes.Model.type.id,classes.viewTypeId);this.__vizView=new classes.View({model:viz,domContainer:domContainer});this.viz=viz;this._onDidCreateViz();},__setupDomContainer:function(vizTypeId,viewTypeId){var $domContainer=this.placeholder().empty();if(this.__vizStyleClass!=null){$domContainer.removeClass(this.__vizStyleClass);}
var styleClasses=this.__vizStyleClass=visualUtil.getCssClasses(vizTypeId,viewTypeId);$domContainer.addClass(styleClasses);return $domContainer[0];},__syncViz:function(dataSpec){var vizSpec=this.__getVizSpec(dataSpec);this.viz.configure(vizSpec);},__syncVizAsync:function(dataSpec){return new Promise(_.bind(function(resolve){this.__syncViz(dataSpec);resolve();},this));}});}());
define(["cdf-legacy/lib/CCC/pvc-d1.0"],function(pvc){pvc.defaultCompatVersion(1);});
var NavigatorBaseComponent=BaseComponent.extend({},{path:Dashboards.getQueryParameter("path"),solution:Dashboards.getQueryParameter("solution"),template:Dashboards.getQueryParameter("template"),navigatorResponse:-1,getSolutionJSON:function(solution){var json=NavigatorBaseComponent.navigatorResponse;var files=json.solution.folders;var locationArray;var found=0;for(i=0;i<files.length;i++){var file=files[i];if(NavigatorBaseComponent.solution==""||file.solution==NavigatorBaseComponent.solution){var solutionFiles=[];var subFolders=file.folders;if(subFolders!=undefined&&subFolders.length==undefined){solutionFiles.push(subFolders);}else if(subFolders!=undefined&&subFolders.length>0){solutionFiles=solutionFiles.concat(subFolders);}
var subFiles=file.files;if(subFiles!=undefined&&subFiles.length==undefined){solutionFiles.push(subFiles);}else if(subFiles!=undefined&&subFiles.length>0){solutionFiles=solutionFiles.concat(subFiles);}
return solutionFiles;}}
if(found==0){Dashboards.error("Fatal: Solution "+solution+" not found in navigation object");return;}},browseContent:function(files,currentPath){for(var i=0;i<files.length;i++){var file=files[i];if(file.type=="FOLDER"&&file.path==currentPath){files=file.folders;if(files==undefined){return[];}
if(files.length==undefined){files=[files];}
return files;}}
Dashboards.error("Fatal: path "+(NavigatorBaseComponent.path||Dashboards.getPathParameter())+" not found in navigation object");return;},getParentSolution:function(){if((NavigatorBaseComponent.path||Dashboards.getPathParameter()).length>0){return NavigatorBaseComponent.solution;}else{return"";}},getParentPath:function(){var path=NavigatorBaseComponent.path||Dashboards.getPathParameter();var index=path.lastIndexOf("/");if(index==-1){return"";}
var parentPath=path.substring(0,path.lastIndexOf("/"));return parentPath;},isAncestor:function(solution,path){if(solution!=NavigatorBaseComponent.solution){return false;}else{return true;}}});var NavigatorComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;if(NavigatorBaseComponent.navigatorResponse==-1){$.getJSON(wd.cdf.endpoints.getJSONSolution()+"?mode=navigator&path="+NavigatorBaseComponent.path,function(json){myself.processNavigatorResponse(json);});}else{this.processNavigatorResponse(NavigatorBaseComponent.navigatorResponse);}},processNavigatorResponse:function(json){NavigatorBaseComponent.navigatorResponse=json;var files=this.includeSolutions?json.solution.folders[0].folders:NavigatorBaseComponent.getSolutionJSON(NavigatorBaseComponent.solution);files.sort(function(a,b){return a.name>b.name;});var ret=this.generateMenuFromArray(files,0);$("#"+this.htmlObject).html(ret);$(function(){$('ul.jd_menu').jdMenu({activateDelay:50,showDelay:50,disableLinks:false})});$('ul.jd_menu a').tooltip({showURL:false,track:true,delay:1000,opacity:0.5});},generateMenuFromArray:function(files,depth){var s="";if(files==undefined){return s;}
for(var i=0;i<files.length;i++){var file=files[i];s+=this.generateMenuFromFile(file,depth+1);}
if(s.length>0){var className;if(depth==0){var cls=(this.mode=='vertical')?"jd_menu jd_menu_slate jd_menu_vertical":"jd_menu jd_menu_slate";className="class=\""+cls+"\"";}
s="<ul "+className+">"+s+"</ul>";}
return s;},generateMenuFromFile:function(file,depth){var s="";if(file.visible==true){var classString=NavigatorBaseComponent.isAncestor(file.solution,file.path)?"class=\"ancestor\"":"";var _path="";if(file.path.length>0){_path="path="+file.path;}
var _template=NavigatorBaseComponent.template!=undefined&&NavigatorBaseComponent.template.length!=undefined&&NavigatorBaseComponent.template.length>0?"&amp;template="+NavigatorBaseComponent.template:"";if(file.link!=undefined){s+="<li><a "+classString+" title=\""+file.title+"\"  href=\""+webAppPath+file.link+"\">"+file.title+"</a>";}else{s+="<li><a "+classString+" title=\""+file.title+"\" onClick=\"return false;\" href=\""+wd.cdf.endpoints.getRenderHTML()+"?solution="+file.solution+"&amp;"+_path+_template+"\">"+file.title+"</a>";}
var files=file.folders||[];files.sort(function(a,b){return a.name>b.name;});var childFiles=file.files||[];childFiles.sort(function(a,b){return a.name>b.name;});var inner=this.generateMenuFromArray(files.concat(childFiles));if(inner.length>0){inner=" &raquo;"+inner;}
s+=inner+"</li>";}
return s;}});var ContentListComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;var path=this.mode!=4?(NavigatorBaseComponent.path||Dashboards.getPathParameter()):NavigatorBaseComponent.getParentPath();myself.draw(path);},draw:function(path){var myself=this;$.getJSON(wd.cdf.endpoints.getJSONSolution()+"?mode=contentList"+(path!=""?"&path="+path:""),function(json){myself.processContentListResponse(json,path);});},processContentListResponse:function(json,path){$("#"+this.htmlObject).empty();var files=json.content||[];files.sort(function(a,b){var _a=(a.type=="FOLDER"?"000":"")+a.name;var _b=(b.type=="FOLDER"?"000":"")+b.name;return _a>_b;});var container=$("<ul></ul>").attr("id","contentList-"+this.name).appendTo("#"+this.htmlObject);if(this.mode!=1&&this.mode!=4&&(NavigatorBaseComponent.path||Dashboards.getPathParameter())){var parentDir={name:"Up",title:"Up",type:"FOLDER",description:"Go to parent directory",visible:true,solution:NavigatorBaseComponent.getParentSolution(),path:path.substring(0,path.lastIndexOf("/"))};files.reverse().push(parentDir);files.reverse();}
var myself=this;$.each(files,function(i,val){if(myself.mode==1&&this.type=="FOLDER"){return true;}
if(myself.mode==2&&this.type!="FOLDER"){return true;}
if(this.visible==true){var cls="";var target="";var href="";var template=NavigatorBaseComponent.template!=undefined&&NavigatorBaseComponent.template.length!=undefined&&NavigatorBaseComponent.template.length>0?"&template="+NavigatorBaseComponent.template:"";var anchor;if(this.type=="FOLDER"){cls="folder";anchor=$("<a></a>").attr("target",target).attr("title",this.description).attr("parentPath",val.path).text(this.title).click(function(){myself.draw($(this).attr("parentPath"));})}else{if(this.url!=undefined){cls="action greybox";href=webAppPath+this.url;}else{cls="action greybox";href=webAppPath+this.link;}
anchor=$("<a></a>").attr("target",target).attr("title",this.description).text(this.title).attr("href",href);}
$("<li></li>").attr("class",cls).appendTo(container).append(anchor);}});$('#contentList-'+this.name+' a').tooltip({showURL:false});$("li.greybox a").click(function(){var t=this.title||this.innerHTML||this.href;var _href=this.href.replace(/'/g,"&#39;");$.fancybox.open({src:_href,type:"iframe",baseClass:"cdf-fancybox cdf-fancybox-iframe",btnTpl:{smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="close"></button>'}},{toolbar:false,smallBtn:true,iframe:{preload:false,css:{width:$(window).width(),height:$(window).height(),"max-width":"100%","max-height":"100%"}}});return false;});}});var PageTitleComponent=NavigatorBaseComponent.extend({update:function(){var myself=this;if(NavigatorBaseComponent.navigatorResponse==-1){$.getJSON(wd.cdf.endpoints.getJSONSolution()+"?mode=contentlist&path="+(NavigatorBaseComponent.path||Dashboards.getPathParameter()),function(json){myself.processPageTitleResponse(json);});}
else{this.processPageTitleResponse(NavigatorBaseComponent.navigatorResponse);}},processPageTitleResponse:function(json){NavigatorBaseComponent.navigatorResponse=json;var file=this.findPageTitleObject(json.content,json.id);if(file.title!=undefined&&file.description!=undefined){$("#"+this.htmlObject).text(file.title+(file.description!=""?(" - "+file.description):""));}},findPageTitleObject:function(folders,id){for(var i=0;i<folders.length;i++){var file=folders[i];if(file.id==id){return file;}else if((id+"/").indexOf(file.id+"/")>=0){return this.findPageTitleObject(file.folders,id);}else{continue;}}}});
var PrptComponent=BaseComponent.extend({getIframeName:function(){return this.htmlObject+'_'+'prptFrame';},getIframe:function(){return'<iframe name="'+this.getIframeName()+'" style="width:100%;height:100%;border:0px" frameborder="0"/>';},setIframeUrl:function(iframe,url){if(iframe[0]){iframe[0].contentWindow.location=url;}},startLoading:function(){if(!this.loading){this.loading=true;Dashboards.incrementRunningCalls();}},stopLoading:function(){if(this.loading){this.loading=false;Dashboards.decrementRunningCalls();}},update:function(){this.clear();var options=this.getOptions(),params=this.getParams(),reportOptions=this.getReportOptions();$.each(reportOptions,function(key,value){if(params[key]!=undefined){delete key;}});var pathSegments={solution:options.solution,path:options.path,action:options.action}
delete options.solution;delete options.path;delete options.action;delete reportOptions.solution;delete reportOptions.path;delete reportOptions.action;var downloadMode=this.downloadMode;var callVar=options.showParameters?'viewer':'report';if(downloadMode==null){var outputTarget=options["output-target"];downloadMode=!((outputTarget.indexOf('html')!=-1&&outputTarget.indexOf('mime-message')==-1)||outputTarget.indexOf('text')!=-1);}
if(options["dashboard-mode"]){if(options.showParameters){Dashboards.log("showParameters not supported with IFrame = False");}
var requestType=this.usePost?"POST":"GET";var url=wd.cdf.endpoints.getReport(pathSegments,"report",{ts:new Date().getTime()});$.each(reportOptions,function(key,value){if(params[key]==undefined){params[key]=value;}});var myself=this;$.ajax({url:url,type:requestType,data:params,dataType:"html",success:function(resp){$("#"+myself.htmlObject).html(resp);}});}else{var iframe=$(this.getIframe());var htmlObj=$('#'+this.htmlObject);htmlObj.empty();iframe=iframe.appendTo(htmlObj);if(this.autoResize){if(this._sHeight==null){this._sHeight=htmlObj.height();this._sWidth=htmlObj.width();}else{htmlObj.height(this._sHeight);htmlObj.width(this._sWidth);}}
if(this.usePost){$.each(options,function(key,value){if(params[key]==undefined){params[key]=value;}});var url=wd.cdf.endpoints.getReport(pathSegments,callVar,{ts:new Date().getTime()});this._postToUrl(htmlObj,iframe,url,params,this.getIframeName());}else{$.extend(options,{ts:new Date().getTime()});var url=wd.cdf.endpoints.getReport(pathSegments,callVar,options);if(options.showParameters&&this.autoResize){Dashboards.log('PrptComponent: autoResize disabled because showParameters=true');this.autoResize=false;}
this.startLoading();var myself=this;iframe.on('load',function(){if(options.showParameters){var jqBody=$(this.contentWindow.document.body);var reportContentFrame=jqBody.find('#reportContent');reportContentFrame.on('load',function(){if(myself.autoResize){myself._resizeToReportFrame(reportContentFrame[0],htmlObj,options);}});}
myself.stopLoading();});this.setIframeUrl(iframe,url);}
if(downloadMode){this.stopLoading();}}},getOptions:function(){var options={paginate:this.paginate||false,showParameters:this.showParameters||false,autoSubmit:(this.autoSubmit||this.executeAtStart)||false,"dashboard-mode":this.iframe==undefined?false:!this.iframe,solution:this.solution,path:this.path,action:this.action,renderMode:'REPORT',htmlProportionalWidth:false};var myself=this;if(this.paginate){options["output-target"]="table/html;page-mode=page";options['accept-page']=0;}else{options["output-target"]="table/html;page-mode=stream";options['accept-page']=-1;}
_.each(this.parameters,function(param,index){var extractedParameter=myself.extractParameter(param);options[extractedParameter.name]=extractedParameter.value;});return options;},getParams:function(){var options={};var myself=this;if(this.paginate){options["output-target"]="table/html;page-mode=page";options['accept-page']=0;}else{options["output-target"]="table/html;page-mode=stream";options['accept-page']=-1;}
_.each(this.parameters,function(param,index){var extractedParameter=myself.extractParameter(param);options[extractedParameter.name]=extractedParameter.value;});return options;},extractParameter:function(param){var name=param[0];var value=param[1];var paramValue;try{paramValue=Dashboards.getParameterValue(value);}catch(e){if(!_.isObject(value)||_.isFunction(value)){printValue=value;}else{printValue=JSON.stringify(value);}
Dashboards.log("extractParameter detected static parameter "+name+"="+printValue+". "+"The parameter will be used as value instead its value obtained from getParameterValue");paramValue=value;}
if(paramValue==null&&param.length==3){paramValue=param[2];}else if(paramValue===undefined){paramValue=value;}
if(_.isFunction(paramValue)){paramValue=paramValue();}
return{name:name,value:paramValue};},getReportOptions:function(){var options={paginate:this.paginate||false,showParameters:this.showParameters||false,autoSubmit:(this.autoSubmit||this.executeAtStart)||false,"dashboard-mode":this.iframe==undefined?false:!this.iframe,solution:this.solution,path:this.path,name:this.action,renderMode:'REPORT',htmlProportionalWidth:false,'accepted-page':-1};if(this.paginate){options["output-target"]="table/html;page-mode=page";options['accept-page']=0;}else{options["output-target"]="table/html;page-mode=stream";options['accept-page']=-1;}
return options;},_postToUrl:function(htmlObj,iframe,path,params,target){this.startLoading();var form=this._getParamsAsForm(document,path,params,this.getIframeName());htmlObj[0].appendChild(form);var self=this;iframe.on('load',function(){if(self.autoResize){self._resizeToReportFrame(iframe[0],htmlObj,params);}
self.stopLoading();});form.submit();},_resizeToReportFrame:function(iframe,htmlObj,options){var outputTarget=options["output-target"];var isHtml=function(outputTarget){return outputTarget.indexOf('html')!=-1&&outputTarget.indexOf('mime')==-1;};var isText=function(outputTarget){return outputTarget.indexOf('text')!=-1;};var isXml=function(outputTarget){return outputTarget.indexOf('xml')!=-1;};try{var idoc=iframe.contentWindow.document;if(iframe.contentWindow.document){var sized=null;if(isHtml(outputTarget)||isText(outputTarget)){sized=idoc.body;}else if(isXml(outputTarget)){sized=idoc.firstChild;}
if(sized!=null){var hMargin=0,wMargin=0;if(isHtml(outputTarget)){var jsized=$(sized);hMargin=jsized.outerHeight(true)-jsized.outerHeight(false);wMargin=jsized.outerWidth(true)-jsized.outerWidth(false);}
htmlObj.height(sized.scrollHeight+hMargin);htmlObj.width(sized.scrollWidth+wMargin);}}}catch(e){Dashboards.log(e);}},_getParamsAsForm:function(doc,path,params,target){var form=doc.createElement("form");form.setAttribute("method","post");form.setAttribute("action",path);form.setAttribute("target",target);for(var key in params){if(params.hasOwnProperty(key)){var param=params[key];if($.isArray(param)){for(var i=0;i<param.length;i++){var hiddenField=doc.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",param[i]);form.appendChild(hiddenField);}}else{var hiddenField=doc.createElement("input");hiddenField.setAttribute("type","hidden");hiddenField.setAttribute("name",key);hiddenField.setAttribute("value",param);form.appendChild(hiddenField);}}}
return form;}});var SchedulePrptComponent=PrptComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+this.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV"){o.wrap("<span/>");}
if(this.label!=undefined){o.text(this.label);}
o.button();o.addClass('scheduler_button');}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.schedulePrptComponent();}
typeof(myself.postChange)=='undefined'?true:myself.postChange();});},schedulePrptComponent:function(){var parameters={};var sharedUuid;var error=false;guid=function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});};triggerError=function(msg,id){error=true;$(id).css("backgroundColor","rgb(255,159,159)");var temp=$(id).val();$(id).val(msg);setTimeout(function(){$(id).css("backgroundColor","white");$(id).val(temp);},2000);};getFileName=function(){var path=myself.path;return path.substring(path.lastIndexOf('/')+1,path.lastIndexOf('.'));};getDefaultLocation=function(){return"/home/"+Dashboards.context.user;};getHour=function(){var hour=$("#hours").val();if($("#amPm").val()=="pm"){hour=parseInt(hour,10)+12;if(hour==24){hour=12;}}else{if(hour=="12"){hour=0;}}
return hour;};getUTC=function(exp,end){var arr=exp.split("/");if(end){return new Date(arr[2],arr[0]-1,arr[1],23,59,59,0).getTime();}else{return new Date(arr[2],arr[0]-1,arr[1],0,0,0,0).getTime();}};getISO=function(exp){var arr=exp.split("/");return new Date(arr[2],arr[0]-1,arr[1],0,0,0,0).toISOString();};makeSelect=function(min,max,interval,id){var selectHtml='<select id ="'+id+'">';for(var i=min;i<=max;i+=interval){if(i<10){selectHtml+='<option value="'+i+'">0'+i+'</option>';}else{selectHtml+='<option value="'+i+'">'+i+'</option>';}}
selectHtml+='</select>';return selectHtml;};validateStartDate=function(mili,id){var now=new Date();if(isNaN(mili)||mili<now.getTime()){triggerError("Incorrect Date, pick date from calendar",id);}};validateEndDate=function(mili,id){if($("#endByRadio").is(":checked")){var now=new Date();var startDate=$("#rangeStartIn").val();var mil=getUTC(startDate);if(isNaN(mil)){}else if(mil>mili){triggerError("End Date > Start Date",id);}else if(isNaN(mili)||mili<now.getTime()){triggerError("Incorrect Date",id);}}};validateName=function(name){if(name==""){triggerError("You must choose a name","#nameIn");}
var pattern=/[^0-9a-zA-Z ]/;if(name.match(pattern)){triggerError('Invalid characters, alpha-numeric text only.',"#nameIn");}};startTimeGetter=function(selector){var hours=getHour();var minutes=$("#minutes").val();var mili=(minutes*60000)+(hours*3600000);var start;if(selector!=undefined){start=getUTC($(selector).val())+mili;validateStartDate(start,selector);}else{start=getUTC($("#rangeStartIn").val())+mili;validateStartDate(start,"#rangeStartIn");}
return new Date(start).toISOString();};endTimeGetter=function(){var end=getUTC($("#endByIn").val(),true);validateEndDate(end,"#endByIn");return new Date(end).toISOString();};getSelectedDaysOfWeek=function(){var selectedDays=new Array();var i=0;if($("#sunday").is(":checked")){selectedDays[i++]=0;}
if($("#monday").is(":checked")){selectedDays[i++]=1;}
if($("#tuesday").is(":checked")){selectedDays[i++]=2;}
if($("#wednesday").is(":checked")){selectedDays[i++]=3;}
if($("#thursday").is(":checked")){selectedDays[i++]=4;}
if($("#friday").is(":checked")){selectedDays[i++]=5;}
if($("#saturday").is(":checked")){selectedDays[i++]=6;}
return selectedDays;};getDayOfMonth=function(){dayOfMonth=$("#recurrPatternIn").val();if(dayOfMonth<1){triggerError(">0","#recurrPatternIn");}else if(dayOfMonth>31){triggerError("<=31","#recurrPatternIn");}
return dayOfMonth;};setParameters=function(){parameters={inputFile:myself.path,jobName:$('#nameIn').val(),outputFile:$('#locationIn').val()};error=false;var choice=$("#recurrId").val();var name=$("#nameIn").val();validateName(name);switch(choice){case"once":var start=startTimeGetter("#startDateIn");var simpleJobTrigger={repeatCount:0,repeatInterval:0,startTime:start,uiPassParam:"RUN_ONCE"};parameters["simpleJobTrigger"]=simpleJobTrigger;break;case"seconds":var start=startTimeGetter();var repeatSec=$("#recurrPatternInSec").val();if(repeatSec<1){triggerError(">0","#recurrPatternInSec");}
if($("#endByRadio").is(":checked")){var endDate=endTimeGetter();}
var simpleJobTrigger={endTime:endDate,repeatCount:-1,repeatInterval:repeatSec,startTime:start,uiPassParam:"SECONDS"};parameters["simpleJobTrigger"]=simpleJobTrigger;break;case"minutes":var start=startTimeGetter();var repeatMin=$("#recurrPatternInMin").val();if(repeatMin<1){triggerError(">0","#recurrPatternInMin");}
if($("#endByRadio").is(":checked")){var endDate=endTimeGetter();}
var simpleJobTrigger={endTime:endDate,repeatCount:-1,repeatInterval:repeatMin*60,startTime:start,uiPassParam:"MINUTES"};parameters["simpleJobTrigger"]=simpleJobTrigger;break;case"hours":var start=startTimeGetter();var repeatHour=$("#recurrPatternInHour").val();if(repeatHour<1){triggerError(">0","#recurrPatternInHour");}
if($("#endByRadio").is(":checked")){var endDate=endTimeGetter();}
var simpleJobTrigger={endTime:endDate,repeatCount:-1,repeatInterval:repeatHour*3600,startTime:start,uiPassParam:"HOURS"};parameters["simpleJobTrigger"]=simpleJobTrigger;break;case"daily":if($("#endByRadio").is(":checked")){var endDate=endTimeGetter();}
var start=startTimeGetter();if($("#weekDayRadio").is(":checked")){var complexJobTrigger={daysOfWeek:[1,2,3,4,5],endTime:endDate,startTime:start,uiPassParam:"DAILY"};parameters["complexJobTrigger"]=complexJobTrigger;}else if($("#dayRadio").is(":checked")){var repeatDays=$("#recurrPatternInDay").val();if(repeatDays<1){triggerError(">0","#recurrPatternInDay");}
var simpleJobTrigger={entTime:endDate,repeatCount:-1,repeatInterval:repeatDays*86400,startTime:start,uiPassParam:"DAILY"};parameters["simpleJobTrigger"]=simpleJobTrigger;}
break;case"weekly":var start=startTimeGetter();if($("#endByRadio").is(":checked")){var endDate=endTimeGetter();}
var complexJobTrigger={daysOfWeek:getSelectedDaysOfWeek(),endTime:endDate,startTime:start,uiPassParam:"WEEKLY"};parameters["complexJobTrigger"]=complexJobTrigger;break;case"monthly":var start=startTimeGetter();if($("#endByRadio").is(":checked")){var endDate=endTimeGetter();}
var complexJobTrigger={endTime:endDate,startTime:start,uiPassParam:"MONTHLY"};if($("#monthRadio").is(":checked")){complexJobTrigger["daysOfMonth"]=getDayOfMonth();}else{complexJobTrigger["daysOfWeek"]=$("#monthOpt2Select").val();complexJobTrigger["weeksOfMonth"]=$("#monthOpt1Select").val();}
parameters["complexJobTrigger"]=complexJobTrigger;break;case"yearly":var start=startTimeGetter();if($("#endByRadio").is(":checked")){var endDate=endTimeGetter();}
var complexJobTrigger={endTime:endDate,startTime:start,uiPassParam:"YEARLY"};if($("#yearRadio").is(":checked")){complexJobTrigger["daysOfMonth"]=getDayOfMonth();complexJobTrigger["monthsOfYear"]=$("#yearEveryMonth").val();}else{complexJobTrigger["daysOfWeek"]=$("#yearOpt2Select").val();complexJobTrigger["monthsOfYear"]=$("#yearMonthSelect").val();complexJobTrigger["weeksOfMonth"]=$("#yearOpt1Select").val();}
parameters["complexJobTrigger"]=complexJobTrigger;break;case"cron":var cron=$("#cronString").val();validateCron(cron);var start=getISO($("#rangeStartIn").val());if($("#endByRadio").is(":checked")){endDate=endTimeGetter();}
var cronJobTrigger={cronString:cron,endTime:endDate,startTime:start,uiPassParam:"CRON"};parameters["cronJobTrigger"]=cronJobTrigger;break;}};validateCron=function(cron){var arr=cron.split(" ");if(arr.length<7){triggerError("Cron Expression too short","#cronString");}else if(arr.length>7){triggerError("Cron Expression too long","#cronString");}else if((arr[3]!="?"&&arr[3]!="*")&&(arr[5]!="?"&&arr[5]!="*")){triggerError("M+W unsuported.(M+? or W+?)","#cronString");}};hideAll=function(){$("#rangeOfRecurrDiv").hide();$("#cronDiv").hide();$("#recurrPatternDiv").hide();$("#startTimeDiv").hide();$("#rangeOfRecurrOnceDiv").hide();$("#patternSec").hide();$("#patternMin").hide();$("#patternHour").hide();$("#patternDay").hide();$("#patternWeek").hide();$("#patternMonth").hide();$("#patternYear").hide();};changeOpts=function(){var choice=$("#recurrId").val();hideAll();switch(choice){case"once":$("#startTimeDiv").show();$("#rangeOfRecurrOnceDiv").show();break;case"seconds":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternSec").show();$("#rangeOfRecurrDiv").show();break;case"minutes":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternMin").show();$("#rangeOfRecurrDiv").show();break;case"hours":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternHour").show();$("#rangeOfRecurrDiv").show();break;case"daily":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternDay").show();$("#rangeOfRecurrDiv").show();break;case"weekly":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternWeek").show();$("#rangeOfRecurrDiv").show();break;case"monthly":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternMonth").show();$("#rangeOfRecurrDiv").show();break;case"yearly":$("#startTimeDiv").show();$("#recurrPatternDiv").show();$("#patternYear").show();$("#rangeOfRecurrDiv").show();break;case"cron":$("#cronDiv").show();$("#rangeOfRecurrDiv").show();break;}};createJobParameter=function(paramName,defaultValue,paramType,forceDefault,trueArray){if(!forceDefault&&(myself.getReportOptions()[paramName]!=undefined)){return{name:paramName,stringValue:(trueArray?myself.getReportOptions()[paramName]:new Array(""+myself.getReportOptions()[paramName])),type:paramType};}else{return{name:paramName,stringValue:(trueArray?defaultValue:new Array(""+defaultValue)),type:paramType};}};var myself=this;var monthOpts='<option value="0">January</option>'+'<option value="1">February</option>'+'<option value="2">March</option>'+'<option value="3">April</option>'+'<option value="4">May</option>'+'<option value="5">June</option>'+'<option value="6">July</option>'+'<option value="7">August</option>'+'<option value="8">September</option>'+'<option value="9">October</option>'+'<option value="10">November</option>'+'<option value="11">December</option>';var weekOpts='<option value="0">sunday</option>'+'<option value="1">monday</option>'+'<option value="2">tuesday</option>'+'<option value="3">wednesday</option>'+'<option value="4">thursday</option>'+'<option value="5">friday</option>'+'<option value="6">saturday</option>';var firstLastDropdown='<option value="0">first</option>'+'<option value="1">second</option>'+'<option value="2">third</option>'+'<option value="3">fourth</option>'+'<option value="4">last</option>';var errorMessage='<label id="err" style="display:none">Incorrect Input</label>';var nameDiv='<div id="nameDiv"><form style="display:inline-block" id="nameForm"><span class="dialog-label">Name:</span><input id="nameIn" type="text" value="'+getFileName()+'"></form></div>';var locationDiv='<div id="locationDiv"><form style="display:inline-block" id="nameForm"><span class="dialog-label">Location:</span><input id="locationIn" type="text" value="'+getDefaultLocation()+'"></form></div>';var groupDiv='<div id="groupDiv"><form style="display:inline-block" id="groupForm"><span class="dialog-label">Group:</span><input id="groupIn" type="text" value=""></form></div>';var descriptionDiv='<div><form style="display:inline-block" id="descForm"><span class="dialog-label">Description:</span><input id="descIn" type="text" value=""></form></div>';var recurrenceDiv='<div id = "recurrenceDiv">'+'<br><span class="dialog-title" style="width: 100px; display: inline-block;">Recurrence:</span>'+'<select id="recurrId" onChange="changeOpts()" style="margin-left: 0px;">'+'<option value = "once" selected>Run Once</option>'+'<option value = "seconds">Seconds</option>'+'<option value = "minutes">Minutes</option>'+'<option value = "hours">Hours</option>'+'<option value = "daily">Daily</option>'+'<option value = "weekly">Weekly</option>'+'<option value = "monthly">Monthly</option>'+'<option value = "yearly">Yearly</option>'+'<option value = "cron">Cron</option></select></br></div>';var cronString='<div id="cronDiv"  style="display:none"><form><span class="dialog-label">Cron String:</span><input id="cronString" type="text" value=""></form></div>';var hours=makeSelect(1,12,1,"hours");var minutes=makeSelect(0,59,1,"minutes");var amPm='<select id = "amPm"><option value="am">AM</option><option value="pm">PM</option></select>';var startTime='<div id="startTimeDiv"><br><span class="dialog-title" style="width: 100px; display: inline-block;">Start Time:</span>'+hours+minutes+amPm+'</div>';var recurrencePattern='<div id="recurrPatternDiv" style = "display:none">'+'<div id="patternSec" >'+'<label style="display:inline-block; margin-left: 100px; font-weight: 500;">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInSec" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> second(s)</label>'+'</div>'+'<div id="patternMin" >'+'<label style="display:inline-block; margin-left: 100px; font-weight: 500;">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInMin" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> minute(s)</label>'+'</div>'+'<div id="patternHour" >'+'<label style="display:inline-block; margin-left: 100px; font-weight: 500;">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInHour" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> hour(s)</label>'+'</div>'+'<div id="patternDay" >'+'<input type="radio" name ="day" value="day" id="dayRadio" style="margin-left: 100px; font-weight: 500;" checked> <label style="display:inline-block">Every</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternInDay" type="text" size="3" style="width:30px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> day(s)</label></br>'+'<input type="radio" name ="day" value="weekDay" id="weekDayRadio" style="margin-left: 100px;"> Every weekday'+'</div>'+'<div id="patternWeek" >'+'<form>'+'<div id="errorCheckboxes" style="display:none"><label id="errWeek">Choose at least one week</label></div>'+'<input type="checkbox" name="weekday" value="monday" id="monday" style="margin-left: 100px;"> Monday'+'<input type="checkbox" name="weekday" value="tuesday" id="tuesday"> Tuesday'+'<input type="checkbox" name="weekday" value="wednesday" id="wednesday"> Wednesday'+'<input type="checkbox" name="weekday" value="thursday" id="thursday"> Thursday'+'</br>'+'<input type="checkbox" name="weekday" value="friday" id="friday" style="margin-left: 100px;"> Friday'+'<input type="checkbox" name="weekday" value="saturday" id="saturday"> Saturday'+'<input type="checkbox" name="weekday" value="sunday" id="sunday"> Sunday'+'</form>'+'</div>'+'<div id="patternMonth" >'+'<input id="monthRadio" type="radio" name ="month" value="day" style="margin-left: 100px;" checked> <label style="display:inline-block; font-weight: 500;">Day</label>&nbsp;&nbsp;'+'<form style="display:inline-block"><input id= "recurrPatternIn" type="text" size="3" style="width:205px;"></form>'+'<label style="display:inline-block; font-weight: 500;"> of every month</label></br>'+'<input type="radio" name ="month" value="the" style="margin-left: 100px;"> <label style="display:inline-block; font-weight: 500;">The</label>&nbsp;&nbsp;'+'<select id="monthOpt1Select">'+firstLastDropdown+'</select>'+'<select id="monthOpt2Select">'+weekOpts+'</select><label style=" font-weight: 500;"> of every month</label>'+'</div>'+'<div id="patternYear" >'+'<input id ="yearRadio" type="radio" name ="year" value="month" style="margin-left: 100px;" checked> <label style="display:inline-block; font-weight: 500;">Every</label>&nbsp;'+'<select id="yearEveryMonth">'+monthOpts+'</select><input id="yearDayMonth"type="text" size="3">'+'</br>'+'<input type="radio" name ="year" value="the" style="margin-left: 100px;"> <label style="display:inline-block; font-weight: 500;">The</label>&nbsp;'+'<select id="yearOpt1Select">'+firstLastDropdown+'</select>'+'<select id="yearOpt2Select">'+weekOpts+'</select><label style=" font-weight: 500;">of&nbsp;&nbsp;</label>'+'<select id="yearMonthSelect">'+monthOpts+'</select>'+'</div>'+'</div>';var rangeOfRecurrence='<div id="rangeOfRecurrDiv" style="display:none"><br><span class="dialog-title"><strong>Range of Recurrence:</strong> </span>'+'<form><span class="dialog-label">Start:</span><input type="text" id="rangeStartIn"></form>'+'<form><span class="dialog-label">End:</span><input type="radio" name ="end" value="noEnd" checked> No end date'+'</br><input type="radio" name ="end" value ="endBy" id="endByRadio" style="margin-left:100px;"> End by:&nbsp;&nbsp;'+'<input id= "endByIn" type="text" style="width:187px;"></form>'+'</div>';var rangeOfRecurrenceOnce='<div id="rangeOfRecurrOnceDiv"><form><span class="dialog-label">Start Date:</span><input id= "startDateIn" type="text" value=""></form></div>';var mailQuestion='<div id="mailQuestionDiv">'+'<label>Would you like to email a copy when the schedule runs?</label><br>'+'<input type="radio" name="mailRadio" value="no" id="mailRadioNo" checked onClick=\'$("#mailInfoDiv").hide(350)\'>&nbsp;No&nbsp;&nbsp;</input>'+'<input type="radio" name="mailRadio" value="yes" id="mailRadioYes" onClick=\'$("#mailInfoDiv").show(350)\'>&nbsp;Yes&nbsp;&nbsp;</input>'+'</div>';var mailInfo='<div id="mailInfoDiv" style="display:none">'+'<label>To: (Use a semi-colon or comma to separate multiple email adresses.)</label>'+'<form><input id="toInput" style="width:100%" type="text"></input></form>'+'<label>Subject:</label>'+'<form><input id="subjectInput" style="width:100%" type="text" value="'+getFileName()+' schedule has successfully run.'+'"></input></form>'+'<label>Attachment Name:</label>'+'<form><input id="attachmentNameInput" style="width:100%" type="text" value="'+$('#nameIn').val()+'"></input></form>'+'<label>Message (optional)</label>'+'<textarea id="messageInput" type="text" rows="4" style="width:100%"></textarea>'+'</div>';scheduleRequest=function(sendMail){var outTarget=myself.outputTarget?myself.outputTarget:"table/html;page-mode=page";var jobParameters=new Array();var k=0;jobParameters[k++]=createJobParameter("output-target",outTarget,"string",true);jobParameters[k++]=createJobParameter("accepted-page","0","string");jobParameters[k++]=createJobParameter("showParameters","true","string");jobParameters[k++]=createJobParameter("renderMode","XML","string");jobParameters[k++]=createJobParameter("htmlProportionalWidth","false","string");if(sendMail){jobParameters[k++]=createJobParameter("_SCH_EMAIL_TO",$("#toInput").val(),"string");jobParameters[k++]=createJobParameter("_SCH_EMAIL_CC","","string");jobParameters[k++]=createJobParameter("_SCH_EMAIL_BCC","","string");jobParameters[k++]=createJobParameter("_SCH_EMAIL_SUBJECT",$("#subjectInput").val(),"string");jobParameters[k++]=createJobParameter("_SCH_EMAIL_MESSAGE",$("#messageInput").val(),"string");jobParameters[k++]=createJobParameter("_SCH_EMAIL_ATTACHMENT_NAME",$("#attachmentNameInput").val(),"string");}
for(var i=0;i<myself.parameters.length;i++){var extParam=myself.extractParameter(myself.parameters[i]);var isArray=_.isArray(extParam.value);jobParameters[k++]=createJobParameter(extParam.name,extParam.value,isArray?"string[]":"string",true,isArray);}
parameters["jobParameters"]=jobParameters;var success=false;var x=$.ajaxSettings.async;$.ajaxSetup({async:false});$.ajax({url:wd.cdf.endpoints.getScheduledJob(),type:"POST",data:JSON.stringify(parameters),contentType:"application/json",success:function(response){alert("Successfully scheduled.");success=true;},error:function(response){alert(response.responseText);success=false;}});$.ajaxSetup({async:x});return success;};var fullPage=nameDiv+locationDiv+recurrenceDiv+cronString+startTime+recurrencePattern+rangeOfRecurrence+rangeOfRecurrenceOnce;var mailPage=mailQuestion+mailInfo;var validEmailConfig=false;$.ajax({type:"GET",url:wd.cdf.endpoints.getEmailConfig()+"/isValid",success:function(data){validEmailConfig=data;}});var promp={basicState:{html:fullPage,title:"Schedule Report",buttons:{"Cancel":-1,"Ok":1},submit:function(e,v,m,f){sharedUuid=guid();if(v==-1){$.prompt.close();}else if(v==1){setParameters();if(error){parameters={};return false;}
if(validEmailConfig){$("#attachmentNameInput").val($("#nameIn").val());$.prompt.goToState('mailState');return false;}else{return scheduleRequest();}}}},mailState:{html:mailPage,title:"Schedule Report",buttons:{"Back":-1,"Ok":1},submit:function(e,v,m,f){if(v==-1){$.prompt.goToState('basicState');return false;}else if(v==1){if($("#mailRadioNo").is(':checked')){return scheduleRequest();}else if($("#mailRadioYes").is(':checked')){var pattern=/^\S+@\S+$/;if(!$("#toInput").val().match(pattern)){triggerError("Invalid email","#toInput");return false;}
return scheduleRequest(true);}else{return false;}}}}};$.prompt(promp,{classes:'scheduler'});$(".scheduler #jqi").css("width","510px");$(document).ready(function(ev){$("#startDateIn").datepicker({minDate:0});$("#rangeStartIn").datepicker({minDate:0});$("#endByIn").datepicker({minDate:0});$("#startDateIn").datepicker("setDate",new Date());$("#rangeStartIn").datepicker("setDate",new Date());});}});var ExecutePrptComponent=PrptComponent.extend({visible:false,update:function(){var myself=this;var o=$("#"+this.htmlObject);if($.inArray(o[0].tagName.toUpperCase(),["SPAN","DIV"])>-1){o=$("<button/>").appendTo(o.empty());if(o[0].tagName=="DIV"){o.wrap("<span/>");}
if(this.label!=undefined){o.text(this.label);}
o.button();}
o.unbind("click");o.bind("click",function(){var success=typeof(myself.preChange)=='undefined'?true:myself.preChange();if(success){myself.executePrptComponent();}
if(typeof(myself.postChange)!='undefined'){myself.postChange();}});},executePrptComponent:function(){var parameters=this.getOptions();var path={};if(parameters.solution){$.extend(path,{solution:parameters.solution});}
if(parameters.path){$.extend(path,{path:parameters.path});}
if(parameters.action){$.extend(path,{action:parameters.action});}
delete parameters.solution;delete parameters.path;delete parameters.action;$.extend(parameters,{ts:new Date().getTime()});$.fancybox.open({src:wd.cdf.endpoints.getReport(path,"viewer",parameters),type:"iframe",baseClass:"cdf-fancybox cdf-fancybox-iframe",btnTpl:{smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="close"></button>'}},{toolbar:false,smallBtn:true,iframe:{preload:false,css:{width:$(window).width(),height:$(window).height()-50,"max-width":"100%","max-height":"100%"}}});}});