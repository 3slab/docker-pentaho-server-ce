define("cdf/dashboard/RefreshEngine",["amd!../lib/underscore"],function(t){return function(t){var e=new Array,n=null,i=0,r=null,s=function(){return{nextRefresh:0,component:null}},o=function(e){null!=r&&(clearInterval(r),r=null),0!=(i=e>0?e:0)&&(r=setInterval(t.refreshEngine.fireGlobalRefresh,1e3*i))},a=function(t){for(var n=0;n<e.length;n++)e[n].component==t&&(e.splice(n,1),n--)},u=function(){e.length>0&&e.splice(0,e.length)},c=function(t,e){for(var n,i=t.length-1,r=0;r<=i;)if(n=parseInt((r+i)/2),t[n].nextRefresh>e.nextRefresh)i=n-1;else{if(!(t[n].nextRefresh<e.nextRefresh))return n;r=n+1}return r},l=function(t,e){var n=c(t,e);t.splice(n,0,e)},d=function(){null!=n&&(clearTimeout(n),n=null)},h=function(){d(),t.refreshEngine.fireRefresh()},f=function(){return(new Date).getTime()},p=function(t){return e.length>0&&e[0].component==t},g=function(e){t.update(e)},m=function(t){var n=f();if(t.refreshPeriod>0||(t.refreshPeriod=0),0!=t.refreshPeriod){var i=new s;i.nextRefresh=n+1e3*t.refreshPeriod,i.component=t,l(e,i)}},b=function(t){a(t),m(t)};return{registerComponent:function(t,e){if(!t)return!1;t.refreshPeriod=e>0?e:0;var n=p(t);return a(t),n&&h(),!0},unregisterComponent:function(t){t&&a(t)},getRefreshPeriod:function(t){return t&&t.refreshPeriod>0?t.refreshPeriod:0},processComponent:function(t){return b(t),p(t)&&h(),!0},processComponents:function(){u();for(var e=0;e<t.components.length;e++)m(t.components[e]);return h(),!0},fireRefresh:function(){n=null;for(var i=f(),r=null;e.length>0&&e[0].nextRefresh<=i;){r=e.shift().component,t.isComponentUpdating(r)?m(r):g(r)}e.length>0&&(n=setTimeout(t.refreshEngine.fireRefresh,e[0].nextRefresh-i))},fireGlobalRefresh:function(){for(var e=0;e<t.components.length;e++){var n=t.components[e];n.refreshPeriod>0||"select"==n.type||g(n)}},setGlobalRefresh:function(t){o(t)},getQueue:function(){return e},stopTimer:d,clearQueue:u,dispose:function(){this.stopTimer(),this.setGlobalRefresh(0),this.clearQueue()}}}}),define("cdf/dashboard/Dashboard",["../lib/Base","../Logger","./RefreshEngine","pentaho/environment","amd!../lib/underscore","amd!../lib/backbone","../lib/jquery","module","amd!../lib/jquery.impromptu","../lib/shims"],function(t,e,n,i,r,s,o,a){return t.extend({constructor:function(t){function a(t,n){"function"==typeof t?(e.info("Calling init method of module: "+n),t.apply(c)):e.warn("Not calling init method of module: "+n)}function u(){var t=this;"function"==typeof o?(o.ajaxSetup({type:"POST",async:!1,traditional:!0,scriptCharset:"utf-8",contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataFilter:function(e,n){return t.lastServerResponse=Date.now?Date.now():(new Date).getTime(),e}}),o.prompt&&"function"==typeof o.prompt.setDefaults?o.prompt.setDefaults({prefix:"jqi",show:"slideDown"}):e.log("$.prompt plugin not loaded!!"),"function"==typeof o.blockUI?(o.blockUI.defaults.fadeIn=0,o.blockUI.defaults.message='<div class="blockUIDefaultImg"></div>',o.blockUI.defaults.css.left="50%",o.blockUI.defaults.css.top="40%",o.blockUI.defaults.css.marginLeft="-16px",o.blockUI.defaults.css.width="32px",o.blockUI.defaults.css.background="none",o.blockUI.defaults.overlayCSS={backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"},o.blockUI.defaults.css.border="none"):e.log("$.blockUI plugin not loaded!!")):e.log("jQuery plugin not loaded!!")}var c=this;t&&(t.context&&(this.context=t.context),t.storage&&(this.context&&"anonymousUser"===this.context.user||(this.storage=t.storage)),t.view&&(this.view=t.view),this.isSilent=!!t.isSilent),r.extend(this,s.Events),u.call(c);var l=i.server.root;null!=l&&(this.webAppPath=l.toString()),null==this.webAppPath&&(this.webAppPath="/"+window.location.pathname.split("/")[1]),this.webAppPath.endsWith("/")&&(this.webAppPath=this.webAppPath.substr(0,this.webAppPath.length-1)),a(this._initContext,"Context"),a(this._initStorage,"Storage"),a(this._initViews,"Views"),a(this._initParameters,"Parameters"),a(this._initBookmarkables,"Bookmarkables"),a(this._initI18n,"I18n"),a(this._initComponents,"Components"),a(this._initLifecycle,"Lifecycle"),a(this._initNotifications,"Notifications"),a(this._initDataSources,"DataSources"),a(this._initQuery,"Query"),a(this._initAddIns,"AddIns"),a(this._throwIfDisposed,"Lifecycle"),this.refreshEngine=new n(this)},refreshEngine:void 0,globalContext:!1,contextObj:a.config().context||{},storageObj:a.config().storage||{},viewObj:a.config().view,legacyPriority:-1e3,logLifecycle:!0,args:[],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],isSilent:!1,registerEvent:function(t,e){void 0===this.events&&(this.events={}),this.events[t]=e},debug:1,isDisposed:!1,syncDebugLevel:function(){var t=1;try{var e=function(t){return t&&/\bdebug=true\b/.test(t)?t:null},n=e(window.location.href)||e(window.top.location.href);if(n){var i=/\bdebugLevel=(\d+)/.exec(n);t=i?+i[1]:3}}catch(t){}return this.debug=t},setGlobalContext:function(t){this.globalContext=t},getWebAppPath:function(){return this.webAppPath},getWcdfSettings:function(){return e.info("getWcdfSettings was not overridden, returning empty object"),{}},normalizeId:function(t){return t},dispose:function(){this.isDisposed||(this.isDisposed=!0,this.refreshEngine&&this.refreshEngine.dispose(),this.events&&(this.events={}),this._disposeComponents(),this._disposeStorage(),this._disposeParameters(),this._disposeViews())}})}),define("cdf/dashboard/Dashboard.context",["../lib/jquery","./Dashboard","./Dashboard.ext","./Dashboard.context.ext"],function(t,e,n,i){e.implement({context:void 0,_initContext:function(){this.context||(this.context={},t.extend(this.context,this.contextObj))}})}),define("cdf/dashboard/Container",[],function(){function t(t,e,i){var r;i||(i="instance"),this.build=function(n,s){if(r&&!s)return r;var o=e(t,n);return s||"singleton"!==i||(r=o),o},this.dispose=function(){r&&(n(r),r=null)}}function e(t,e,i){i||(i="external"),this.build=function(){return e},this.dispose=function(){e&&("singleton"===i&&n(e),e=null)}}function n(t){"function"==typeof t.dispose&&t.dispose()}function i(t){for(var e in t)if(r.call(t,e))return!1;return!0}var r=Object.prototype.hasOwnProperty;return function(){function n(t,e){if(!t)throw new Error("Argument 'type' is required.");if("string"!=typeof t)throw new Error("Argument 'type' must be a string.");var n=a[t];if(!e&&(!n||i(n)))throw new Error("There are no registrations for type '"+t+"'.");return n}function r(t,e,i){var r,s=n(t,i);if(s&&!(r=s[e||""])&&!i)throw new Error("There is no registration for type '"+t+"'"+(e?" and name '"+e+"'":"")+".");return r}function s(t,e,n,i,s){"string"!=typeof e&&(n=e,e="");var o=r(t,e,s);return n?i=!0:i||(n={}),o?o.build(n,i):null}function o(t,e){var i=n(t,e),r=[];for(var s in i)r.push(i[s].build({},!1));return r}this.register=function(n,i,r,s){if(!n)throw new Error("Argument 'type' is required.");if("string"!=typeof n)throw new Error("Argument 'type' must be a string.");if(null!=i&&("string"!=typeof i?(s=r,r=i,i=null):i||(i=null)),!r)throw new Error("Argument 'what' is required.");var o;switch(typeof r){case"function":o=new t(this,r,s);break;case"object":o=new e(this,r,s);break;default:throw new Error("Argument 'what' is of an invalid type.")}i||(i="");var u=a[n]||(a[n]={}),c=u[i];c&&c.dispose(),u[i]=o},this.has=function(t,e){return!!r(t,e,!0)},this.canNew=function(e,n){return r(e,n,!1)instanceof t},this.get=function(t,e){return s(t,e,null,!1,!1)},this.tryGet=function(t,e){return s(t,e,null,!1,!0)},this.getNew=function(t,e,n){return s(t,e,n,!0,!1)},this.tryGetNew=function(t,e,n){return s(t,e,n,!0,!0)},this.getAll=function(t){return o(t,!1)},this.tryGetAll=function(t){return o(t,!0)},this.listType=function(t){return n(t,!1)},this.tryListType=function(t){return n(t,!0)},this.dispose=function(){if(a){for(var t in a){var e=a[t];for(var n in e)e[n].dispose()}a=null}};var a={}}}),define("cdf/dashboard/Dashboard.addIns",["./Dashboard","./Container","./Utils"],function(t,e,n){function i(t,e){return-1!==t.indexOf("Component",t.length-"Component".length)&&(t=t.substring(0,t.length-"Component".length)),t=t.charAt(0).toUpperCase()+t.substring(1),e&&(t+="."+e),t}var r=new e;t.registerGlobalAddIn=function(t,e,n){var t=i(t,e),s=n.getName?n.getName():null;r.register(t,s,n)},t.implement({addIns:void 0,_initAddIns:function(){this.addIns=n.clone(r)},registerGlobalAddIn:function(e,n,i){t.registerGlobalAddIn(e,n,i)},registerAddIn:function(t,e,n){var t=i(t,e),r=n.getName?n.getName():null;this.addIns.register(t,r,n)},hasAddIn:function(t,e,n){var t=i(t,e);return Boolean(this.addIns&&this.addIns.has(t,n))},getAddIn:function(t,e,n){var t=i(t,e);try{return this.addIns.get(t,n)}catch(t){return null}},setAddInDefaults:function(t,e,n,i){var r=this.getAddIn(t,e,n);r&&r.setDefaults(i)},listAddIns:function(t,e){var t=i(t,e);try{return this.addIns.listType(t)}catch(t){return[]}}})}),define("cdf/dashboard/Dashboard.bookmarkable",["./Dashboard","../Logger","./Utils","../lib/jquery"],function(t,e,n,i){t.implement({_initBookmarkables:function(){this.bookmarkables={}},getHashValue:function(t){var e,n=window.location.hash;try{e=JSON.parse(n.slice(1))}catch(t){e={}}return 0===arguments.length?e:e[t]},setHashValue:function(t,e){var n;1==arguments.length?n=t:(n=this.getHashValue(),n[t]=e);var i=JSON.stringify(n);"{}"!=i?window.location.hash=i:window.location.hash&&(window.location.hash="")},deleteHashValue:function(t){if(0===arguments.length)window.location.hash="";else{var e=this.getHashValue();delete e[t],this.setHashValue(e)}},setBookmarkable:function(t,e){1===arguments.length?this.bookmarkables[t]=!0:this.bookmarkables[t]=e},isBookmarkable:function(t){return Boolean(this.bookmarkables[t])},generateBookmarkState:function(){var t={},e=this.bookmarkables;for(var n in e)e.hasOwnProperty(n)&&e[n]&&(t[n]=this.getParameterValue(n));return t},persistBookmarkables:function(t){this.bookmarkables[t]&&this.finishedInit&&this.setBookmarkState({impl:"client",params:this.generateBookmarkState()})},setBookmarkState:function(t){if(window.history&&window.history.replaceState){var e,r=window.location.pathname.split("/").pop(),s=window.location.search.slice(1).split("&").map(function(t){var e=t.split("=");return e[1]=decodeURIComponent(e[1]),e});s=n.propertiesArrayToObject(s),s.bookmarkState=JSON.stringify(t),e=r+"?"+i.param(s),window.history.replaceState({},"",e),this.deleteHashValue("bookmark")}else this.setHashValue("bookmark",t)},getBookmarkState:function(){if(window.location.hash.length>1)try{return this.getHashValue("bookmark")||{}}catch(t){}var t=window.location.search.slice(1).split("&").map(function(t){var e=t.split("=");return e[1]=decodeURIComponent(e[1]),e}),e=n.propertiesArrayToObject(t);return e.bookmarkState?JSON.parse(decodeURIComponent(e.bookmarkState.replace(/\+/g," ")))||{}:{}},restoreBookmarkables:function(){var t;try{t=this.getBookmarkState().params;for(var n in t)t.hasOwnProperty(n)&&this.setParameter(n,t[n])}catch(t){e.log(t,"error")}}})}),define("cdf/dashboard/Dashboard.components",["./Dashboard","amd!../lib/backbone","../lib/mustache","../Logger","../lib/jquery"],function(t,e,n,i,r){t.implement({components:[],_initComponents:function(){this.components=[]},getComponent:function(t){if(!t||"string"!=typeof t)return void i.warn("getComponent: invalid component name");for(var e in this.components)if(this.components[e].name===t)return this.components[e]},getComp:function(t){return this.getComponent(t)},getComponentByName:function(t){return this.getComponent(t)},addComponents:function(t){if(!r.isArray(t))return void i.warn("addComponents: components in a structure other than an array will not be added");t.forEach(function(t){this.addComponent(t)},this)},addComponent:function(t,e){if(!t||!t.name)throw i.error("addComponent: invalid component"),new Error("addComponent: invalid component");t._throwIfDisposed();var n=this.getComponentByName(t.name);if(n){if(n!==t)throw i.error("addComponent: duplicate component name '"+t.name+"'"),new Error("addComponent: duplicate component name '"+t.name+"'");return this}this._bindControl(t);var r=e&&e.index,s=this.components.length;return null==r||r<0||r>=s?this.components.push(t):this.components.splice(r,0,t),this},getComponentIndex:function(t){if(null!=t)switch(typeof t){case"string":for(var e=0,n=this.components,i=n.length;e<i;e++)if(n[e].name===t)return e;break;case"number":if(t>=0&&t<this.components.length)return t;break;default:return this.components.indexOf(t)}return-1},removeComponent:function(t){var e=this.getComponentIndex(t);if(-1===e)return void i.warn("removeComponent: component not found");var n=this.components[e];return this.refreshEngine&&this.refreshEngine.unregisterComponent(this),n.onWillRemove(),n.clear(),this.components.splice(e,1),n.dashboard=null,n.off("cdf:postExecution"),n.off("cdf:preExecution"),n.off("cdf:error"),n.off("all"),n},_disposeComponents:function(){this.components.forEach(function(t){t.dashboard=null,t.dispose()}),this.components=[]},_bindControl:function(t){return t.dashboard||(t.dashboard=this,this._addLogLifecycleToControl(t)),t},_bindExistingControl:function(t){return t.dashboard||(t.dashboard=this,delete t.initInstance,"function"==typeof t.off&&t.off("all"),t.on||r.extend(t,e.Events),this._addLogLifecycleToControl(t),null!=t.priority&&""!==t.priority||(t.priority=this.legacyPriority++)),t},_castControlToClass:function(t,e){if(!(t instanceof e)){var n=this._makeInstance(e);r.extend(t,n)}},_getControlClass:function(t){var e=t.type;"function"==typeof e&&(e=e.call(t));for(var n=e.substring(0,1).toUpperCase()+e.substring(1),i=[n+"Component",e,n],r=0,s=i.length;r<s;r++){var o=window[i[r]];if(o&&"function"==typeof o)return o}},_makeInstance:function(t,e){var n=Object.create(t.prototype);return e?t.apply(n,e):t.apply(n),n},_castControlToComponent:function(t,e){if(!(t instanceof BaseComponent||e&&e.prototype instanceof BaseComponent)){var n=BaseComponent.prototype;for(var i in n)if(n.hasOwnProperty(i)&&void 0===t[i]&&"function"==typeof n[i])switch(i){case"base":break;default:t[i]=n[i]}}},_addLogLifecycleToControl:function(t){t.on("all",function(t){var e=this.dashboard;if(e&&e.logLifecycle&&"cdf"!==t&&"PostInitMarker"!==this.name&&"undefined"!=typeof console){var r,s=t.substr(4);switch(s){case"preExecution":r=">Start";break;case"postExecution":r="<End  ";break;case"error":r="!Error";break;default:r="      "}var o=n.render("Timing: {{elapsedSinceStartDesc}} since start, {{elapsedSinceStartDesc}} since last event",this.splitTimer());i.log("          [Lifecycle "+r+"] "+this.name+" ["+this.type+"] (P: "+this.priority+" ): "+s+" "+o+" (Running: "+this.dashboard.runningCalls+")","log","color: "+this.getLogColor())}})}})}),define("cdf/dashboard/Dashboard.i18n",["../Logger","./Dashboard","./Dashboard.ext","pentaho/environment","../lib/moment","../lib/CCC/cdo","../lib/cdf.jquery.i18n"],function(t,e,n,i,r,s,o){e.implement({_i18nSupport:void 0,set i18nSupport(t){o.extend(this._i18nSupport,t)},get i18nSupport(){return this._i18nCurrentLanguageCode},_i18nCurrentLanguageCode:void 0,set i18nCurrentLanguageCode(t){this._i18nCurrentLanguageCode=t},get i18nCurrentLanguageCode(){return this._i18nCurrentLanguageCode},_initI18n:function(){this.setI18nSupport(void 0,{prop:function(e){return t.warn("i18n support wasn't properly initiated. Is the file messages_supported_languages.properties present?"),e}});var e=this.__normalizeLocale(),i={name:"messages",mode:"map",language:e,path:n.getStaticResource("resources/languages/"),callback:this.__initI18nCallback.bind(this,e)};o.i18n.properties(i);var a=s.format.language(e);s.format.language(a),r.locale(e)},__initI18nCallback:function(t){var e={name:"messages",mode:"map",type:"GET",language:t,path:this.getMessagesPath(),callback:this.setI18nSupport.bind(this,t,o.i18n)};o.i18n.properties(e)},__normalizeLocale:function(){var t=i.locale;return null!=t?t.split("-").join("_"):null},setI18nSupport:function(t,e){this.i18nCurrentLanguageCode=t,this.i18nSupport=e},getMessagesPath:function(){}})}),define("cdf/dashboard/Dashboard.legacy",["../queries/CdaQuery.ext","../components/XactionComponent.ext","./Dashboard.ext","./Dashboard","../Logger","../lib/jquery","css!./theme/Dashboard.legacy.css"],function(t,e,n,i,r,s){i.implement({callPentahoAction:function(t,e,n,i,r,s){var o=this;return"function"==typeof s?o.pentahoAction(e,n,i,r,function(e){s(o.parseXActionResult(t,e))}):o.parseXActionResult(t,o.pentahoAction(e,n,i,r,s))},urlAction:function(t,e,n){return this.executeAjax("xml",t,e,n)},executeAjax:function(t,e,n,i){if("function"==typeof i)return s.ajax({url:e,type:"POST",traditional:!0,dataType:t,async:!0,data:n,complete:function(t,e){i(t.responseXML)},error:function(t,e,n){r.error("Found error: "+t+" - "+e+", Error: "+n)}});var o=s.ajax({url:e,type:"POST",dataType:t,async:!1,data:n,error:function(t,e,n){r.error("Found error: "+t+" - "+e+", Error: "+n)}});return"xml"==t?o.responseXML:o.responseText},pentahoAction:function(t,e,n,i,r){return this.pentahoServiceAction("ServiceAction","xml",t,e,n,i,r)},pentahoServiceAction:function(t,e,i,r,o,a,u){var c=n.getServiceAction(t,i,r,o),l=c.url;return delete c.url,s.each(a,function(t,e){c[e[0]]=e[1]}),this.executeAjax(e,l,c,u)},CDF_ERROR_DIV:"cdfErrorDiv",createAndCleanErrorDiv:function(){0==s("#"+this.CDF_ERROR_DIV).length&&s("body").append("<div id='"+this.CDF_ERROR_DIV+"'></div>"),s("#"+this.CDF_ERROR_DIV).empty()},showErrorTooltip:function(){s(function(){s.tooltip&&s(".cdf_error").tooltip({delay:0,track:!0,fade:250,showBody:" -- "})})},parseXActionResult:function(t,e){var n=s(e),i=n.find("SOAP-ENV\\:Fault");if(0==i.length)return n;var r="Error executing component "+t.name,o=new Array;o[0]=" Error details for component execution "+t.name+" -- ",o[1]=i.find("SOAP-ENV\\:faultstring").find("SOAP-ENV\\:Text:eq(0)").text(),i.find("SOAP-ENV\\:Detail").find("message").each(function(){o.push(s(this).text())}),o.length>8&&(o=o.slice(0,7),o.push("..."));var a="<table class='errorMessageTable' border='0'><tr><td class='errorIcon'></td><td><span class='cdf_error' title=\""+o.join("<br/>").replace(/"/g,"'")+'" >'+r+" </span></td></tr></table>";return 0==t.visible?s("#"+this.CDF_ERROR_DIV).append("<br />"+a):s("#"+t.htmlObject).html(a),null},setSettingsValue:function(t,e){var i={method:"set",key:t,value:JSON.stringify(e)};s.post(n.getSettings("set",null),i,function(){})},getSettingsValue:function(t,e){s.ajax({type:"GET",dataType:"json",url:n.getSettings("get",t),data:args,async:!0,xhrFields:{withCredentials:!0}}).done("function"==typeof e?e:function(t){e=t})},fetchData:function(e,n,i){if(r.warn("Dashboard fetchData() is deprecated. Use Query objects instead"),void 0!=e&&void 0!=e.dataAccessId){for(var o in n)e["param"+n[o][0]]=this.getParameterValue(n[o][1]);s.post(t.getDoQuery(),e,function(t){i(t)},"json").error(this.handleServerError)}else i([])}})}),define("cdf/dashboard/Dashboard.lifecycle",["./Dashboard","../Logger","amd!../lib/underscore","../components/UnmanagedComponent","../lib/jquery"],function(t,e,n,i,r){t.implement({initCounter:void 0,runningCalls:void 0,lastServerResponse:void 0,serverCheckResponseTimeout:void 0,_initLifecycle:function(){this.initCounter=0,this.runningCalls=0,this.lastServerResponse=Date.now?Date.now():(new Date).getTime(),this.serverCheckResponseTimeout=1/0},_throwIfDisposed:function(){if(this.isDisposed)throw new Error("Invalid operation. The dashboard has been disposed.")},resetRunningCalls:function(){this.runningCalls=0,setTimeout(n.bind(function(){this.hideProgressIndicator()},this),10)},getRunningCalls:function(){return this.runningCalls},incrementRunningCalls:function(){this.runningCalls++,this.showProgressIndicator(),e.log("+Running calls incremented to: "+this.getRunningCalls())},decrementRunningCalls:function(){this.runningCalls--,e.log("-Running calls decremented to: "+this.getRunningCalls()),setTimeout(n.bind(function(){this.runningCalls<=0&&(this.hideProgressIndicator(),this.runningCalls=0)},this),10)},init:function(t){var i=this;i._throwIfDisposed();var s=i.initCounter++;e.log("InitInstance "+s),0==s&&(i.syncDebugLevel(),i.initialStorage?n.extend(i.storage,i.initialStorage):i.loadStorage(),null!=i.context&&null!=i.context.sessionTimeout&&(i.serverCheckResponseTimeout=900*i.context.sessionTimeout),i.restoreBookmarkables(),i.restoreView(),i.syncParametersInit()),n.isArray(t)&&i.addComponents(t),n.chain(i.components).filter(function(t){return void 0===t.initInstance}).each(function(t){t.initInstance=s}),r(function(){i._initEngine(s)})},_initEngine:function(t){var s=this;s.waitingForInit&&s.waitingForInit.length&&e.log("Overlapping initEngine!","warn");var o=null!=t?n.where(s.components,{initInstance:t}):s.components;s.waitingForInit&&0!==s.waitingForInit.length||s.finishedInit||s.incrementRunningCalls(),e.log("          [Lifecycle >Start] Init["+t+"] (Running: "+s.getRunningCalls()+")","log","color: #ddd"),s.createAndCleanErrorDiv(),"function"==typeof s.preInit&&s.preInit(),s.trigger("cdf cdf:preInit",s),r(window).trigger("cdfAboutToLoad");var a,s=s,u=[];for(a=0;a<o.length;a++)o[a].executeAtStart&&u.push(o[a]);if(!u.length)return void s._handlePostInit();if(!s.getComponent("PostInitMarker")){var c=new i({name:"PostInitMarker",type:"unmanaged",lifecycle:{silent:!0},executeAtStart:!0,priority:999999999});s.addComponent(c),u.push(c)}s.waitingForInit=u.slice();for(var l=function(e,i){2==arguments.length&&i||(s.waitingForInit=n(s.waitingForInit).without(e),e.off("cdf:postExecution",l),e.off("cdf:preExecution",l),e.off("cdf:error",l),s._handlePostInit(t))},a=0,d=u.length;a<d;a++){u[a].on("cdf:postExecution cdf:preExecution cdf:error",l,s)}s.updateAll(u),o.length>0&&s._handlePostInit(t)},_handlePostInit:function(t){var i=this;i.waitingForInit&&0!==i.waitingForInit.length||i.finishedInit||(i.trigger("cdf cdf:postInit",i),r(window).trigger("cdfLoaded"),"function"==typeof i.postInit&&i.postInit(),function(){var t=n.filter(i.components,function(t){return"duplicate"==t.type}),e={},s=i.getBookmarkState().params||{};n.map(n.filter(Object.keys(s),function(t){return/(_[0-9]+)+$/.test(t)}),function(t){var n=t.match(/(.*?)((_[0-9]+)+)$/),i=n[1],r=n[2];return e[r]||(e[r]={}),e[r][i]=s[t],t});for(var o in e)if(e.hasOwnProperty(o)){var s=e[o];r.each(t,function(t,e){var n;for(n=0;n<e.parameters.length;n++)if(!s.hasOwnProperty(e.parameters[n])&&i.isBookmarkable(e.parameters[n]))return;e.duplicate(s)})}}(),i.finishedInit=!0,i.decrementRunningCalls(),e.log("          [Lifecycle <End  ] Init["+t+"] (Running: "+i.getRunningCalls()+")","log","color: #ddd"))},updateLifecycle:function(t){var i=!!t.lifecycle&&!!t.lifecycle.silent;if(!t.disabled){i||this.incrementRunningCalls();var s=n.bind(function(){try{var n;if(void 0!==t.preExecution&&(n=t.preExecution.apply(t)),n=void 0===n||!!n,t.trigger("cdf cdf:preExecution",t,n),!n)return;void 0!=t.tooltip&&(t._tooltip="function"==typeof t.tooltip?t.tooltip():t.tooltip),void 0!=t.update&&"function"==typeof t.update&&(t.update(),this.refreshEngine.processComponent(t)),void 0!==t.postExecution&&t.postExecution.apply(t),void 0!=t._tooltip&&r("#"+t.htmlObject).attr("title",t._tooltip).tooltip({delay:0,track:!0,fade:250})}catch(n){var s=t.htmlObject?r("#"+t.htmlObject):void 0,o=this.getErrorObj("COMPONENT_ERROR").msg+" ("+t.name.replace("render_","")+")";this.errorNotification({msg:o},s),e.error("Error updating "+t.name+":"),e.exception(n)}finally{i||this.decrementRunningCalls()}t.trigger("cdf cdf:postExecution",t)},this);setTimeout(s,1)}},updateAll:function(t){if(this.updating||(this.updating={tiers:{},current:null,updatingInFlight:[]}),t&&n.isArray(t)&&!n.isArray(t[0])){var e={};n.each(t,function(t){if(t){var n=t.priority||0;e[n]||(e[n]=[]),e[n].push(t)}}),t=e}!function(t,e){if(e)for(var i in e)e.hasOwnProperty(i)&&(n.isArray(t[i])?t[i]=n.union(t[i],e[i]):t[i]=e[i])}(this.updating.tiers,t);var i=this.updating.current,r=!1;if(null===i||0==i.components.length||(r=this.othersAwaitExecution(n.clone(this.updating.tiers),this.updating.current))){var s=this.getFirstTier(this.updating.tiers);if(!s)return;if(r){var o=this.updating.tiers;o[i.priority]=n.difference(o[i.priority],i.components),s.components=n.union(o[i.priority],this.getFirstTier(o).components)}this.updating.current=s;for(var a=function(t,e){if(2!=arguments.length||"boolean"!=typeof e||!e){t.off("cdf:postExecution",a),t.off("cdf:preExecution",a),t.off("cdf:error",a);var i=this.updating.current;i.components=n.without(i.components,t);var r=this.updating.tiers;r[i.priority]=n.without(r[i.priority],t),this.updating.updatingInFlight=n.without(this.updating.updatingInFlight,t),this.updateAll()}},e=this.updating.current.components.slice(),u=0;u<e.length;u++){var c=e[u];c.startTimer(),c.on("cdf:postExecution cdf:preExecution cdf:error",a,this),this.updateComponent(c),-1==this.updating.updatingInFlight.indexOf(c)&&this.updating.updatingInFlight.push(c)}}},update:function(t){this.updateQueue||(this.updateQueue=[]),this.updateQueue.push(t),this.updateTimeout&&clearTimeout(this.updateTimeout);var e=n.bind(function(){this.updateAll(this.updateQueue),delete this.updateQueue},this);this.updateTimeout=setTimeout(e,5)},updateComponent:function(t){if((Date.now?Date.now():(new Date).getTime())-this.lastServerResponse>this.serverCheckResponseTimeout&&!this.checkServer())throw this.hideProgressIndicator(),this.loginAlert(),"not logged in";!1===t.isManaged&&t.update?(t.update(),this.refreshEngine.processComponent(t)):this.updateLifecycle(t)},getFirstTier:function(t){for(var e,i=n.keys(t).sort(function(t,e){return parseInt(t,10)-parseInt(e,10)}),r=0;r<i.length;r++)if(e=t[i[r]],e.length>0)return{priority:i[r],components:e.slice()};return null},resetAll:function(){this.createAndCleanErrorDiv();for(var t=(this.components.length,0),e=this.components.length;t<e;t++)this.components[t].clear();for(var t=(this.components.length,0),e=this.components.length;t<e;t++)this.components[t].executeAtStart&&this.update(this.components[t])},processChange:function(t){var e,n=this.getComponentByName(t),i=n.parameter;if("function"==typeof n.getValue&&(e=n.getValue()),null!=e){if(void 0!==n.preChange){var r=n.preChange(e);e=void 0!=r?r:e}i&&this.fireChange(i,e),void 0!==n.postChange&&n.postChange(e)}},fireChange:function(t,e){var i=this;i.createAndCleanErrorDiv(),i.setParameter(t,e,!0),i.trigger("cdf "+t+":fireChange",{parameter:t,value:e});for(var r=[],s=0,o=i.components.length;s<o;s++)if(n.isArray(i.components[s].listeners))for(var a=0;a<i.components[s].listeners.length;a++){var u=i.components[s];if(u.listeners[a]==t&&!u.disabled){r.push(u);break}}i.updateAll(r)},othersAwaitExecution:function(t,e){if(!t||!e||!e.components)return!1;t[e.priority]=n.difference(t[e.priority],e.components);var i=this.getFirstTier(t);return!(!i||!i.components||0==i.components.length)&&!(parseInt(i.priority)>parseInt(e.priority))},isComponentUpdating:function(t){if(this.updateQueue&&-1!=this.updateQueue.indexOf(t))return!0;if(this.updating){if(this.updating.current&&this.updating.current.components){var e=n.some(this.updating.current.components,function(e){if(e===t)return!0});if(e)return e}if(this.updating.tiers){var i=n.some(this.updating.tiers,function(e){return n.some(e,function(e){return e===t})});if(i)return i}if(this.updating.updatingInFlight)return n.some(this.updating.updatingInFlight,function(e){return e===t})}return!1}})}),define("cdf/dashboard/Popups",["../lib/mustache","amd!../lib/underscore","../lib/jquery","amd!../lib/jquery.blockUI","css!./theme/Popups.css"],function(t,e,n){return{okPopup:{_firstRender:!0,template:"<div class='cdfPopup'>  <div class='cdfPopupHeader'>{{{header}}}</div>  <div class='cdfPopupBody'>    <div class='cdfPopupDesc'>{{{desc}}}</div>    <div class='cdfPopupButton'>{{{button}}}</div>  </div></div>",defaults:{header:"Title",desc:"Description Text",button:"Button Text",callback:function(){return!0}},$el:void 0,show:function(t){(t||this._firstRender)&&this.render(t),this.$el.show()},hide:function(){this.$el.hide()},render:function(i){var r=e.extend({},this.defaults,i),s=this;this._firstRender&&(this.$el=n("<div/>").addClass("cdfPopupContainer").hide().appendTo("body"),this._firstRender=!1),this.$el.empty().html(t.render(this.template,r)),this.$el.find(".cdfPopupButton").click(function(){r.callback(),s.hide()})}},notificationsComponent:{template:"<div class='cdfNotification component {{#isSmallComponent}}small{{/isSmallComponent}}'>  <div class='cdfNotificationBody'>    <div class='cdfNotificationImg'>&nbsp;</div>    <div class='cdfNotificationTitle' title='{{title}}'>{{{title}}}</div>    <div class='cdfNotificationDesc' title='{{desc}}'>{{{desc}}}</div>  </div></div>",defaults:{title:"Component Error",desc:"Error processing component."},render:function(i,r){var s=e.extend({},this.defaults,r);s.isSmallComponent=n(i).width()<300,n(i).empty().html(t.render(this.template,s));var o=n(i).find(".cdfNotification");o.css({"line-height":o.height()+"px"})}},notificationsGrowl:{_firstRender:!0,template:"<div class='cdfNotification growl'>  <div class='cdfNotificationBody'>    <h1 class='cdfNotificationTitle' title='{{title}}'>{{{title}}}</h1>    <h2 class='cdfNotificationDesc' title='{{desc}}'>{{{desc}}}</h2>  </div></div>",defaults:{title:"Title",desc:"Default CDF notification.",timeout:4e3,onUnblock:function(){return!0},css:n.extend({},n.blockUI.defaults.growlCSS,{position:"absolute",width:"100%",top:"10px"}),showOverlay:!1,fadeIn:700,fadeOut:1e3,centerY:!1},render:function(i){var r=e.extend({},this.defaults,i),s=n(t.render(this.template,r)),o=this;r.message=s;var a=r.onUnblock;r.onUnblock=function(){o.$el.hide(),a.call(this)},this._firstRender&&(this.$el=n("<div/>").addClass("cdfNotificationContainer").hide().appendTo("body"),this._firstRender=!1),this.$el.show().block(r)}}}}),define("cdf/dashboard/Dashboard.notifications",["./Dashboard","./Dashboard.notifications.ext","./Popups","../Logger","amd!../lib/underscore","../lib/jquery","amd!../lib/jquery.blockUI","css!./theme/Dashboard.notifications.css"],function(t,e,n,i,r,s){t.implement({ERROR_CODES:{QUERY_TIMEOUT:{msg:"Query timeout reached"},COMPONENT_ERROR:{msg:"Error processing component"}},_initNotifications:function(){},blockUiOptions:void 0,_setBlockUiOptions:function(t){if("function"==typeof s.blockUI){this.blockUiOptions=s.extend({},s.blockUI.defaults);for(var e in t)this.blockUiOptions[e]=t[e]}},blockUIwithDrag:function(){if(!this.isSilent){void 0!==this.i18nSupport&&null!=this.i18nSupport&&(s.blockUI.defaults.message='<div class="img blockUIDefaultImg" style="padding: 0px;"></div>'),s.blockUI(this.blockUiOptions);var t=s('<div id="blockUIDragHandle"></div>');s("div.blockUI.blockMsg").prepend(t),s("div.blockUI.blockMsg").draggable({handle:"#blockUIDragHandle"})}},showProgressIndicator:function(){this.isSilent||s.blockUI&&this.blockUIwithDrag()},hideProgressIndicator:function(t){this.isSilent||(t&&this.resetRunningCalls(),s.unblockUI&&s.unblockUI(),this.showErrorTooltip())},getErrorObj:function(t){return this.ERROR_CODES[t]||{}},parseServerError:function(t,e,n){var i=[{match:/Query timeout/,msg:this.getErrorObj("QUERY_TIMEOUT").msg}],o={msg:this.getErrorObj("COMPONENT_ERROR").msg,error:n,errorStatus:e},a=s("<div/>").html(t.responseText).find("h1").text();return r.find(i,function(t){return!!a.match(t.match)&&(o.msg=t.msg,!0)}),o},handleServerError:function(){this.errorNotification(this.parseServerError.apply(this,arguments)),this.trigger("cdf cdf:serverError",this),this.resetRunningCalls()},errorNotification:function(t,e){this.isSilent||(e?n.notificationsComponent.render(s(e),{title:t.msg,desc:""}):n.notificationsGrowl.render({title:t.msg,desc:""}))},loginAlert:function(t){if(!this.isSilent){var e={header:"Warning",desc:"You are no longer logged in or the connection to the server timed out",button:"Click to reload this page",callback:function(){window.location.reload(!0)}};e=r.extend({},e,t),n.okPopup.show(e),this.trigger("cdf cdf:loginError",this)}},checkServer:function(){s.ajax({type:"POST",async:!1,dataType:"json",url:e.getPing(),success:function(t){
return t&&"ok"==t.ping},error:function(){return!1}})}})}),define("cdf/dashboard/Dashboard.parameters",["./Dashboard","../Logger","amd!../lib/backbone","./Utf8Encoder"],function(t,e,n,i){t.implement({parameters:void 0,parameterModel:void 0,chains:void 0,syncedParameters:void 0,escapeParameterValues:!1,flatParameters:!1,LEGACY_STORAGE:"Dashboards.storage.",STORAGE:"storage.",_initParameters:function(){this.parameters=[],this.parameterModel=new n.Model,this.chains=[],this.syncedParameters={},this.escapeParameterValues=!1},_isParameterInModel:function(t,e){return void 0!==this._getValueFromContext(t,e)},_getValueFromContext:function(t,e){if(t){if(this.flatParameters)return t[e];if(null!=e){var n,i;if(e instanceof Array)n=e;else{if(e.indexOf(".")<0)return t[e];n=e.split(".")}i=n.length;for(var r=0;r<i;r++){if(!t)return;var s=n[r],o=t[s];if(void 0===o)return;t=o}}return t}},_setValueInContext:function(t,e,n){if(t&&null!=e&&void 0!==n){if(this.flatParameters)t[e]=n;else{var i,r;if(e instanceof Array)i=e,r=i.pop();else{if(e.indexOf(".")<0)return t[e]=n,t;i=e.split("."),r=i.pop()}t=this._getValueFromContext(t,i),t&&(t[r]=n)}return t}},_getParameterStore:function(t){var n;return 0==t.indexOf(this.LEGACY_STORAGE)?(e.warn("Legacy storage access for "+t+". Please use storage instead"),t=t.substr(this.LEGACY_STORAGE.length),n=this.storage):0==t.indexOf(this.STORAGE)?(t=t.substr(this.STORAGE.length),n=this.storage):n=this.parameters,{store:n,name:t}},_disposeParameters:function(){this.parameters=[],this.parameterModel=void 0,this.chains=[],this.syncedParameters={}},addParameter:function(t,n){if(void 0==t||"undefined"==t)return void e.warn("Dashboard addParameter: trying to add undefined!!");var i=this._getParameterStore(t);return this._isParameterInModel(i.store,i.name)&&(n=this.getParameterValue(i.name)),this.setParameter(t,n),n},getParameterValue:function(t){if(void 0==t||"undefined"==t)return void e.warn("Dashboard.getParameterValue: trying to get undefined!!");var n=this._getParameterStore(t);return this._getValueFromContext(n.store,n.name)},getParam:function(t){return this.getParameterValue(t)},setParameter:function(t,n,r){if(void 0==t||"undefined"==t)return void e.warn("Dashboard.setParameter: trying to set undefined!!");var s=this._getParameterStore(t);this.escapeParameterValues?this._setValueInContext(s.store,s.name,i.encode_prepare_arr(n)):this._setValueInContext(s.store,s.name,n),void 0!==this._setValueInContext(s.store,s.name,n)&&(this.parameterModel.set(s.name,n,{notify:r}),this.persistBookmarkables(s.name))},setParam:function(t,e,n){this.setParameter(t,e,n)},syncParameters:function(t,e){this.setParameter(e,this.getParameterValue(t)),this.parameterModel.on("change:"+t,function(t,n,i){this[i.notify?"fireChange":"setParameter"](e,n)},this),this.parameterModel.on("change:"+e,function(e,n,i){this[i.notify?"fireChange":"setParameter"](t,n)},this)},syncParametersOnInit:function(t,e){var n,i,r,s,o=this.syncedParameters;o[t]||(o[t]=[]),o[t].push(e);for(var a=0;a<this.chains.length;a++)n=this.chains[a],n.indexOf(t)>-1&&(i=n),n.indexOf(e)>-1&&(r=n,s=a);if(r&&i){if(i!=r){var u=r.slice();u.unshift(0),u.unshift(i.length),[].splice.apply(i,u),this.chains.splice(s,1)}}else r?r.unshift(t):i?i.push(e):this.chains.push([t,e])},syncParametersInit:function(){var t,e,n,i,r,s=this.syncedParameters;for(n=0;n<this.chains.length;n++)for(i=0;i<this.chains[n].length;i++)if(t=this.chains[n][i],s[t])for(r=0;r<s[t].length;r++)e=s[t][r],this.syncParameters(t,e)}})}),define("cdf/dashboard/Dashboard.storage",["./Dashboard","../Logger","../lib/jquery","./Dashboard.storage.ext"],function(t,e,n,i){t.implement({storage:void 0,initialStorage:void 0,_initStorage:function(){this.storage||(this.storage={},n.extend(this.storage,this.storageObj)),this.initialStorage=this.storage},_disposeStorage:function(){this.storage={},this.initialStorage={}},loadStorage:function(){var t=this;if(!this.context||"anonymousUser"!==this.context.user){var e={user:this.context.user,action:"read",ts:Date.now?Date.now():(new Date).getTime()};n.ajax({type:"GET",dataType:"json",url:i.getStorage(e.action),data:e,async:!0,xhrFields:{withCredentials:!0},success:function(e){n.extend(t.storage,e)}})}},saveStorage:function(){if(!this.context||"anonymousUser"!==this.context.user){var t={user:this.context.user,action:"store",storageValue:JSON.stringify(this.storage),ts:Date.now?Date.now():(new Date).getTime()};n.ajax({type:"GET",dataType:"json",url:i.getStorage(t.action),data:t,async:!0,xhrFields:{withCredentials:!0}}).done(function(t){1!=t.result&&e.log("Error saving storage","error")})}},cleanStorage:function(){if(this.storage={},!this.context||"anonymousUser"!==this.context.user){var t={user:this.context.user,action:"delete"};n.ajax({type:"GET",dataType:"json",url:i.getStorage(t.action),data:t,async:!0,xhrFields:{withCredentials:!0}}).done(function(t){1!=t.result&&e.log("Error deleting storage","error")})}}})}),define("cdf/dashboard/Dashboard.dataSources",["./Dashboard","../Logger","amd!../lib/underscore"],function(t,e,n){t.implement({dataSources:void 0,_initDataSources:function(){this.dataSources={}},_getDataSourceName:function(t){var i;if(i=n.isObject(t)?t.dataSource:t,n.isString(i)&&!n.isEmpty(i))return i;e.warn("Invalid data source name")},addDataSource:function(t,i,r){if(n.isObject(t)&&(r=i,i=t,t=i.name),!n.isObject(i))return void e.error("Invalid data source object");if(!n.isString(t)||n.isEmpty(t))return void e.error("Invalid data source name");if(this.dataSources[t]){if(!this.dataSources.hasOwnProperty(t))return void e.error("Data source name '"+t+"' is invalid, overwrites an inherited property");if(!r)return void e.warn("Data source name '"+t+"' is already defined, set force flag to true to overwrite it")}var s=n.extend({},i);s.name&&delete s.name,this.dataSources[t]=s},getDataSource:function(t){var e=this._getDataSourceName(t);if(e&&this.dataSources.hasOwnProperty(e))return this.dataSources[e]},getDataSourceQuery:function(t){var i=this.getDataSource(t);if(!n.isEmpty(i))return this.getQuery(i);e.error("Invalid data source")},setDataSource:function(t,e){n.isObject(t)?this.addDataSource(t,!0):this.addDataSource(t,e,!0)},removeDataSource:function(t){var n;if(!(n=this._getDataSourceName(t)))return void e.warn("Invalid data source name");n in this.dataSources&&this.dataSources.hasOwnProperty(n)?delete this.dataSources[n]:e.warn("Data source name '"+n+"' not found")}})}),define("cdf/dashboard/Dashboard.query",["../Logger","../lib/Base","./Dashboard","./Container","amd!../lib/underscore","./Utils"],function(t,e,n,i,r,s){var o=e,a=new i;return n.implement({queryFactories:void 0,_initQuery:function(){this.queryFactories=s.clone(a)},getBaseQuery:function(){return o},registerQuery:function(t,e){var n=this.getBaseQuery();if(!r.isFunction(e)&&r.isObject(e)){var i={};r.each(n.prototype.deepProperties,function(t){i[t]=r.extend({},n.prototype[t],e[t])})}var s=r.isFunction(e)&&e||r.isObject(e)&&n.extend(r.extend({},e,i));this.queryFactories.register("Query",t,function(t,e){return new s(e)})},hasQuery:function(t){return Boolean(this.queryFactories&&this.queryFactories.has("Query",t))},detectQueryType:function(e){if(e){if(r.isString(e.dataSource)&&!r.isEmpty(e.dataSource)){var n=this.getDataSource(e.dataSource);if(r.isUndefined(n))return void t.error("Invalid data source name '"+e.dataSource+"'");e=n}var i=e.queryType?e.queryType:e.query?"legacy":e.path&&e.dataAccessId?"cda":void 0;return e.queryType=i,this.hasQuery(i)?i:void 0}},getQuery:function(e,n){if(r.isUndefined(e)?e="cda":r.isObject(e)&&(n=e,e=void 0),r.isString(n.dataSource)&&!r.isEmpty(n.dataSource)){var i=this.getDataSource(n.dataSource);if(r.isUndefined(i))return void t.error("Invalid data source name '"+n.dataSource+"'");n=r.extend({},i,n),delete n.dataSource}e=e||n.queryType||"cda";var s=this.queryFactories.getNew("Query",e,n);return s.dashboard=this,s},isValidQueryDefinition:function(t){return void 0!==this.detectQueryType(t)},listQueries:function(){return r.keys(this.queryFactories.listType("Query"))}}),{setBaseQuery:function(t){r.isFunction(t)&&t.extend&&(o=t)},registerGlobalQuery:function(t,e){var n=o;if(!r.isFunction(e)&&r.isObject(e)){var i={};r.each(n.prototype.deepProperties,function(t){i[t]=r.extend({},n.prototype[t],e[t])})}var s=r.isFunction(e)&&e||r.isObject(e)&&n.extend(r.extend({},e,i));a.register("Query",t,function(t,e){return new s(e)})}}}),define("cdf/dashboard/Dashboard.views",["./Dashboard","../lib/base64","./Dashboard.views.ext","../lib/jquery"],function(t,e,n,i){t.implement({viewParameters:void 0,view:void 0,viewFlags:{UNUSED:"unused",UNBOUND:"unbound",VIEW:"view"},_initViews:function(){this.viewParameters={},!this.view&&this.viewObj&&(this.view={},i.extend(this.view,this.viewObj))},_disposeViews:function(){this.viewParameters={},this.view={}},restoreView:function(){var t,n;if(this.view&&this.view.params&&(n=JSON.parse(e.decode(this.view.params))))if(i.isEmptyObject(n))this.view.params=n;else for(t in n)n.hasOwnProperty(t)&&this.setParameter(t,n[t])},setParameterViewMode:function(t,e){1===arguments.length?this.viewParameters[t]=this.viewFlags.VIEW:this.viewParameters[t]=e},isViewParameter:function(t){return this.viewParameters[t]},getViewParameters:function(){var t=this.viewParameters,e={};for(var n in t)t.hasOwnProperty(n)&&(t[n]!=this.viewFlags.VIEW&&t[n]!=this.viewFlags.UNBOUND||(e[n]=this.getParameterValue(n)));return e},getUnboundParameters:function(){var t=this.viewParameters,e=[];for(var n in t)if(t.hasOwnProperty(n))return t[n]==this.viewFlags.UNBOUND&&e.push(n),e}})}),define("cdf/dashboard/OptionsManager",["./Utils","amd!../lib/underscore","../lib/jquery"],function(t,e,n){function i(t,e,n,i){return t&&t[e]&&t[e].hasOwnProperty(n)?t[e][n]:i||void 0}function r(t,e,n,i){t&&e&&n&&(t[e]=t[e]||{},t[e][n]=i)}return function(s){function o(t,e){e=e||{},d(t,e.reader),h(t,e.writer),f(t,e.validator)}function a(t){return i(g._interfaces,t,"reader",g._libraries.mappers.identity)}function u(t){return i(g._interfaces,t,"writer",g._libraries.mappers.identity)}function c(t){return i(g._interfaces,t,"validator",g._libraries.predicates.tautology)}function l(t){return i(g._options,t,"value")}function d(t,n){var i=g._libraries.mappers;return n=e.isFunction(n)&&n||e.isString(n)&&i[n]||a(t)||i.identity,r(g._interfaces,t,"reader",n)}function h(t,n){var i=g._libraries.mappers;return n=e.isFunction(n)&&n||e.isString(n)&&i[n]||u(t)||i.identity,r(g._interfaces,t,"writer",n)}function f(t,n){var i=g._libraries.predicates;return n=e.isFunction(n)&&n||e.isString(n)&&i[n]||c(t)||i.tautology,r(g._interfaces,t,"validator",n)}function p(t,e){return r(g._options,t,"value",e)}var g=this;this._options={},this._interfaces={},this._libraries={predicates:{tautology:function(t){return!0},isFunction:e.isFunction,isPositive:function(t){return e.isNumber(t)&&t>0},isObjectOrPropertiesArray:function(t){return e.isArray(t)||e.isObject(t)},isObject:e.isObject,isArray:e.isArray},mappers:{identity:e.identity,propertiesObject:function(n){return e.isArray(n)?t.propertiesArrayToObject(n):n}}},this.mixin=function(t){t.getOption=this.getOption,t.setOption=this.setOption},this.init=function(t,i,r){t=n.extend(!0,{},t),i=n.extend(!0,{},i),this._libraries=n.extend(!0,{},this._libraries,r),e.each(i,function(t,e){o(e,t)}),e.each(t,function(t,e){o(e,i&&i[e]||{}),p(e,t)})},this.setOption=function(t,e,n){o(t,n);var i=a(t);if(c(t)(e))return e=i(e),p(t,e),!0;throw new Error("Invalid Option "+t.charAt(0).toUpperCase()+t.slice(1))},this.getOption=function(t){return u(t)(l(t))},this.init(s.defaults,s.interfaces,s.libraries)}}),define("cdf/queries/BaseQuery",["../lib/jquery","../lib/Base","amd!../lib/underscore","../Logger","../dashboard/Utils","../dashboard/OptionsManager","../dashboard/Dashboard.query"],function(t,e,n,i,r,s,o){var a=e.extend({_name:"baseQuery",get name(){return this._name},_label:"Base Query",get label(){return this._label},deepProperties:["defaults","interfaces"],dashboard:void 0,defaults:{successCallback:function(){i.log("Query success callback not defined. Override.")},errorCallback:function(t,e,n){if(this.dashboard&&r.isFunction(this.dashboard.handleServerError))return void this.dashboard.handleServerError(t,e,n);i.log("Query error callback not defined. Override.")},lastResultSet:null,lastProcessedResultSet:null,page:0,pageSize:0,params:{},pushEnabled:!1,ajaxOptions:{async:!1,type:"POST"},url:""},interfaces:{params:{reader:"propertiesObject",validator:"isObjectOrPropertiesArray"},successCallback:{validator:"isFunction"},errorCallback:{validator:"isFunction"},pageSize:{validator:"isPositive"}},constructor:function(t){this._optionsManager=new s(this),this._optionsManager.mixin(this),this.init(t)},getOption:function(t){return this.defaults[t]},setOption:function(t,e){this.defaults[t]=e},init:function(t){},buildQueryDefinition:function(t){},getSuccessHandler:function(e){var n=this;return function(i){n.setOption("lastResultSet",i);var r=t.extend(!0,{},n.getOption("lastResultSet"));n.setOption("lastProcessedResultSet",r),void 0!==(i=e(r))&&i!==r&&n.setOption("lastProcessedResultSet",i)}},getErrorHandler:function(t){return function(e,n,i){t&&t(e,n,i)}},doQuery:function(e,i){if(!r.isFunction(this.getOption("successCallback")))throw"QueryNotInitialized";var s=n.extend({},this.getAjaxOptions(),{data:this.buildQueryDefinition(),url:this.getOption("url"),success:this.getSuccessHandler(e||this.getOption("successCallback")),error:this.getErrorHandler(i||n.bind(this.getOption("errorCallback"),this))});t.ajax(s)},exportData:function(){},setAjaxOptions:function(t){this.setOption("ajaxOptions",n.extend({},this.getOption("ajaxOptions"),t))},getAjaxOptions:function(){var e=this.getOption("ajaxOptions");return!(null==e.async?t.ajaxSettings.async:e.async)&&e.xhrFields&&e.xhrFields.withCredentials&&(i.log("Cross-domain requests are deprecated for synchronous operations."),delete e.xhrFields.withCredentials),e},setSortBy:function(t){},sortBy:function(t,e){},fetchData:function(t,e,i){var s=arguments[0],o=arguments[1],a=arguments[2];switch(arguments.length){case 0:if(this.getOption("params")&&this.getOption("successCallback"))return this.doQuery();break;case 1:if(r.isFunction(s))return this.doQuery(s);if(!n.isEmpty(s)&&(n.isObject(s)||Array.isArray(s)))return this.setParameters(s||{}),this.doQuery();break;case 2:return r.isFunction(s)?(this.setCallback(s),r.isFunction(o)&&this.setErrorCallback(o)):(this.setParameters(s||{}),this.setCallback(o)),this.doQuery();default:return t&&this.setParameters(t),r.isFunction(o)&&this.setCallback(e),r.isFunction(a)&&this.setErrorCallback(i),this.doQuery()}throw"InvalidInput"},lastResults:function(){if(null!==this.getOption("lastResultSet"))return t.extend(!0,{},this.getOption("lastResultSet"));throw"NoCachedResults"},lastProcessedResults:function(){if(null!==this.getOption("lastProcessedResultSet"))return t.extend(!0,{},this.getOption("lastProcessedResultSet"));throw"NoCachedResults"},reprocessLastResults:function(e){if(null!==this.getOption("lastResultSet")){var n=t.extend(!0,{},this.getOption("lastResultSet")),i=e||this.getOption("successCallback");this.setOption("lastProcessedResultSet",n);var r=i(n);return void 0!==r&&r!==n&&this.setOption("lastProcessedResultSet",r),r}throw"NoCachedResults"},reprocessResults:function(t){return this.reprocessLastResults(t)},setParameters:function(t){this.setOption("params",t)},setCallback:function(t){this.setOption("successCallback",t)},setErrorCallback:function(t){this.setOption("errorCallback",t)},setSearchPattern:function(t){this.setOption("searchPattern",t)},nextPage:function(t){var e=this.getOption("page"),n=this.getOption("pageSize");if(n>0)return e+=n,this.setOption("page",e),this.doQuery(t);throw"InvalidPageSize"},previousPage:function(t){var e=this.getOption("page"),n=this.getOption("pageSize");if(e>n)return e-=n,this.setOption("page",e),this.doQuery(t);if(n>0)return this.setOption("page",0),this.doQuery(t);throw"AtBeginning"},getPage:function(t,e){var n=this.getOption("page"),i=this.getOption("pageSize");if(t*i==n)return!1;if(r.isNumber(t)&&t>=0)return this.setOption("page",t*i),this.doQuery(e);throw"InvalidPage"},setPageStartingAt:function(t){if(t==this.getOption("page"))return!1;if(!(r.isNumber(t)&&t>=0))throw"InvalidPage";this.setOption("page",t)},pageStartingAt:function(t,e){return!1!==this.setPageStartingAt(t)&&this.doQuery(e)},setPageSize:function(t){this.setOption("pageSize",t)},initPage:function(t,e){if(t==this.getOption("pageSize")&&0==this.getOption("page"))return!1;if(r.isNumber(t)&&t>0)return this.setOption("page",0),this.setOption("pageSize",t),this.doQuery(e);throw"InvalidPageSize"},dispose:function(){},__getDashboardParameterValue:function(t,e){var s;try{s=this.dashboard.getParameterValue(e)}catch(s){var o=!n.isObject(e)||r.isFunction(e)?e:JSON.stringify(e);i.log("BuildQueryDefinition detected static parameter "+t+"="+o+". The parameter will be used instead the parameter value")}return void 0!==s?s:e}});return o.setBaseQuery(a),a}),define("cdf/queries/CpkQuery",["../dashboard/Dashboard.ext","./BaseQuery","../dashboard/Dashboard.query","amd!../lib/underscore","../dashboard/Utils","../Logger","../lib/jquery"],function(t,e,n,i,r,s,o){"use strict";var a={_name:"cpk",get name(){return this._name},_label:"CPK Query",get label(){return this._label},defaults:{url:"",pluginId:"",endpoint:"",systemParams:{},ajaxOptions:{dataType:"json",type:"POST",async:!0,xhrFields:{withCredentials:!0}}},init:function(e){i.isString(e.pluginId)&&i.isString(e.endpoint)&&(this.setOption("pluginId",e.pluginId),this.setOption("endpoint",e.endpoint),this.setOption("url",t.getPluginEndpoint(e.pluginId,e.endpoint))),this.setOption("kettleOutput",e.kettleOutput),this.setOption("stepName",e.stepName),this.setOption("systemParams",e.systemParams||{}),this.setAjaxOptions(e.ajaxOptions);var n=this.getOption("ajaxOptions");"json"===n.dataType&&(n.mimeType="application/json; charset utf-8",this.setAjaxOptions(n))},buildQueryDefinition:function(t){var e={kettleOutput:this.getOption("kettleOutput"),stepName:this.getOption("stepName")};e=o.extend(!0,{},e,this.getOption("systemParams")),t=Array.isArray(t)?r.propertiesArrayToObject(t):t||{};var n=this.getOption("params"),s=o.extend({},n,t);return i.each(s,function(t,n){var s=this.__getDashboardParameterValue(n,t);r.isFunction(s)?s=s():i.isObject(s)&&(s=JSON.stringify(s)),e["param"+n]=s},this),e},getSuccessHandler:function(t){var e=this;return function(n){if(e.setOption("lastResultSet",n),n&&0==n.result){e.getErrorHandler(e.getOption("errorCallback"))(i)}else{var i=o.extend(!0,{},e.getOption("lastResultSet"));e.setOption("lastProcessedResultSet",i),n=t(i),void 0!==n&&n!==i&&e.setOption("lastProcessedResultSet",n)}}}};n.registerGlobalQuery("cpk",a)}),define("cdf/queries/CdaQuery",["./CdaQuery.ext","./BaseQuery","../dashboard/Dashboard.query","amd!../lib/underscore","../dashboard/Utils","../Logger","../lib/jquery"],function(t,e,n,i,r,s,o){"use strict";var a={_name:"cda",get name(){return this._name},_label:"CDA Query",get label(){return this._label},defaults:{url:t.getDoQuery(),websocketUrl:t.getWebsocketQuery(),file:"",id:"",outputIdx:"1",sortBy:"",pushEnabled:!1,ajaxOptions:{async:!0,xhrFields:{withCredentials:!0}},searchPattern:""},init:function(t){if(void 0===t.path||void 0===t.dataAccessId)throw"InvalidQuery";this.setOption("file",t.path),this.setOption("id",t.dataAccessId),r.isString(t.sortBy)&&t.sortBy.match("^(?:[0-9]+[adAD]?,?)*$")&&this.setSortBy(t.sortBy),null!=t.pageSize&&this.setPageSize(t.pageSize),null!=t.outputIndexId&&this.setOption("outputIdx",t.outputIndexId),null!=t.pushEnabled&&this.setOption("pushEnabled",t.pushEnabled)},buildQueryDefinition:function(t){var e={};t=Array.isArray(t)?r.propertiesArrayToObject(t):t||{};var n=this.getOption("params"),s=o.extend({},n,t);return i.each(s,function(t,n){var i=this.__getDashboardParameterValue(n,t);Array.isArray(i)&&1===i.length&&String(i[0]).indexOf(";")>=0&&(i=r.doCsvQuoting(i[0],";")),r.isFunction(i)&&(i=i()),e["param"+n]=i},this),e.path=this.getOption("file"),e.dataAccessId=this.getOption("id"),e.outputIndexId=this.getOption("outputIdx"),e.pageSize=this.getOption("pageSize"),e.pageStart=this.getOption("page"),e.sortBy=this.getOption("sortBy"),e.paramsearchBox=this.getOption("searchPattern"),e},exportData:function(e,n,i){i=null!=i?i:{};var r=this.buildQueryDefinition(n);r.outputType=e,"csv"===e&&i.separator&&(r.settingcsvSeparator=i.separator),i.filename&&(r.settingattachmentName=i.filename),"xls"===e&&i.template&&(r.settingtemplateName=i.template),i.columnHeaders&&(r.settingcolumnHeaders=i.columnHeaders),!1===i.exportPage&&(r.pageSize=0,r.pageStart=0),null!=i.dtFilter&&(r.settingdtFilter=i.dtFilter,null!=i.dtSearchableColumns&&(r.settingdtSearchableColumns=i.dtSearchableColumns)),r.wrapItUp="true",o.ajax({type:"POST",dataType:"text",async:!0,data:r,url:this.getOption("url"),xhrFields:{withCredentials:!0}}).done(function(e){var n=o('<iframe style="display:none">');n.detach(),n[0].src=t.getUnwrapQuery({path:r.path,uuid:e}),n.appendTo(o("body"))}).fail(function(t,e,n){s.log("Request failed: "+t.responseText+" :: "+e+" ::: "+n)})},setSortBy:function(t){var e,n=this;if(null===t||void 0===t||""===t)e="";else if(r.isString(t)){if(!t.match("^(?:[0-9]+[adAD]?,?)*$"))throw"InvalidSortExpression";e=t.toUpperCase().split(",").filter(function(t){return""!==t})}else if(Array.isArray(t)){e=t.map(function(t){return t.toUpperCase()});var i=e.filter(function(t){return!t.match("^[0-9]+[adAD]?,?$")});if(i.length>0)throw"InvalidSortExpression"}var s;return Array.isArray(e)?(s=e.length!=n.getOption("sortBy").length,o.each(e,function(t,e){if(!(s=s&&e==n.getOption("sortBy")[t]))return!1})):s=e===this.getOption("sortBy"),this.setOption("sortBy",e),!s},sortBy:function(t,e){return!!this.setSortBy(t)&&(null!==this.getOption("successCallback")?this.doQuery(e):void 0)},doQuery:function(t,e){if(!r.isFunction(this.getOption("successCallback")))throw"QueryNotInitialized";var n=t||this.getOption("successCallback"),s=e||i.bind(this.getOption("errorCallback"),this),a=this.buildQueryDefinition(),u=!0;if(this.getOption("pushEnabled")){var c=this;this.websocket=new WebSocket(this.getOption("websocketUrl"),"JSON-CDA-query"),this.websocket.onopen=function(t){c.websocket.send(JSON.stringify(a))},this.websocket.onmessage=function(t){var e=!u;if(u=!1,JSON)c.getSuccessHandler(function(t){return n(t,e)})(JSON.parse(t.data));else try{c.websocket.close(1001)}catch(t){}},this.websocket.onerror=function(t){var e=!u;u=!1,c.getErrorHandler(function(t,n,i){s(t,n,i,e)})(t.data)},this.websocket.onclose=function(t){if(1011===t.code){var e=!u;u=!1,c.getErrorHandler(function(t,n,i){s(t,n,i,e)})(t.reason)}}}else{var l=i.extend({},this.getAjaxOptions(),{data:a,url:this.getOption("url"),success:this.getSuccessHandler(n),error:this.getErrorHandler(s)});o.ajax(l)}},dispose:function(){this.websocket&&(this.websocket.close(1e3),this.websocket=null)}};n.registerGlobalQuery("cda",a)}),define("cdf/queries/XmlaQuery",["amd!../lib/xmla","./XmlaQuery.ext","../lib/Base","./BaseQuery","../dashboard/Dashboard.query","../Logger","../lib/jquery"],function(t,e,n,i,r,s,o){var a=n.extend({xmla:null,datasource:null,catalogs:null,getDataSources:function(){var e=[],n=this.xmla.discoverDataSources();if(!n)return void s.warn("XML/A DISCOVER_DATASOURCES request failed");if(n.hasMoreRows()){e=n.fetchAllAsObject(),this.datasource=e[0];var i=this.datasource[t.PROP_DATASOURCENAME];i&&i.length>0&&(this.datasource[t.PROP_DATASOURCEINFO]=i),n.close()}},getCatalogs:function(){var e={},n={};if(!this.datasource||!this.datasource[t.PROP_DATASOURCEINFO])return void s.warn("XML/A DBSCHEMA_CATALOGS request failed, missing "+t.PROP_DATASOURCEINFO);e[t.PROP_DATASOURCEINFO]=this.datasource[t.PROP_DATASOURCEINFO];var i=this.xmla.discoverDBCatalogs({properties:e});if(!i)return void s.warn("XML/A DISCOVER_DATASOURCES request failed");if(i.hasMoreRows()){for(this.catalogs=[];n=i.fetchAsObject();)this.catalogs[this.catalogs.length]=n;i.close()}},discover:function(e){var n={},i=e.query();return n[t.PROP_DATASOURCEINFO]=this.datasource[t.PROP_DATASOURCEINFO],e.catalog&&(n[t.PROP_CATALOG]=e.catalog),this.xmla.discover({properties:n,requestType:i})},execute:function(e){for(var n=0,i=u.catalogs.length;n<i;n++)if(u.catalogs[n].CATALOG_NAME==e.catalog){var r={};r[t.PROP_DATASOURCEINFO]=u.datasource[t.PROP_DATASOURCEINFO],r[t.PROP_CATALOG]=e.catalog,r[t.PROP_FORMAT]=u.PROP_FORMAT||t.PROP_FORMAT_TABULAR;var s=this.xmla.execute({statement:e.query(),properties:r});return s}throw new Error("Catalog: "+e.catalog+" was not found on Pentaho server.")}}),u=new a,c={name:"xmla",label:"XML/A Query",queryDefinition:{},defaults:{url:e.getXmla()},init:function(e){this.queryDefinition=o.extend({},this.getOption("params"),e),null==u.xmla&&(u.xmla=new t({async:!1,url:this.getOption("url")})),null==u.datasource&&u.getDataSources(),null==u.catalogs&&u.getCatalogs()},transformXMLAResults:function(e){var n,i,r,s={resultset:[],metadata:[]};e instanceof t.Rowset?(n=e.fetchAllAsArray(),i=e.getFields()):t.Dataset;for(var o=0,a=i.length;o<a;o++)switch(r=i[o],s.metadata[o]={colIndex:r.index,colName:r.label},r.jsType){case"string":s.metadata[o].colType="string";break;case"number":s.metadata[o].colType="numeric";break;default:s.metadata[o].colType="string"}return s.resultset=n,e.close(),s},doQuery:function(t){var e=(this.getOption("url"),t||this.getOption("successCallback"));this.getOption("errorCallback");try{var n=this.transformXMLAResults(this._executeQuery());this.setOption("lastResultSet",n);var i=o.extend(!0,{},this.getOption("lastResultSet"));this.setOption("lastProcessedResultSet",i),n=e(i),void 0!==n&&n!==i&&this.setOption("lastProcessedResultSet",n)}catch(t){s.error("unable to execute the XML/A query: "+t+" :")}},_executeQuery:function(){return u.execute(this.queryDefinition)}};r.registerGlobalQuery("xmla",c);var l={name:"xmlaDiscover",label:"XML/A Discover Query",queryDefinition:{},defaults:{url:e.getXmla()},init:function(e){this.queryDefinition=o.extend({},this.getOption("params"),e),null==u.xmla&&(u.xmla=new t({async:!1,url:this.getOption("url")})),null==u.datasource&&u.getDataSources()},transformXMLADiscoverResults:function(t){for(var e,n=t.getFields(),i={resultset:[],metadata:[]},r=0,s=n.length;r<s;r++)switch(e=n[r],i.metadata[r]={colIndex:e.index,colName:e.label},e.jsType){case"string":i.metadata[r].colType="string";break;case"number":i.metadata[r].colType="numeric";break;default:i.metadata[r].colType="string"}return i.resultset=t.fetchAllAsArray(),t.close(),i},doQuery:function(t){var e=(this.getOption("url"),t||this.getOption("successCallback"));this.getOption("errorCallback");try{var n=this.transformXMLADiscoverResults(this._executeDiscoverQuery());this.setOption("lastResultSet",n);var i=o.extend(!0,{},this.getOption("lastResultSet"));this.setOption("lastProcessedResultSet",i),n=e(i),void 0!==n&&n!==i&&this.setOption("lastProcessedResultSet",n)}catch(t){s.error("unable to execute the XML/A query: "+t+" :")}},_executeDiscoverQuery:function(){return u.discover(this.queryDefinition)}};r.registerGlobalQuery("xmlaDiscover",l)}),define("cdf/queries/SolrQuery",["./BaseQuery","../dashboard/Dashboard.query","../dashboard/Utils","../Logger","../lib/jquery"],function(t,e,n,i,r){"use strict";var s={endpoint:"",collection:"",requestHandler:"select",q:"*:*",fq:null,fl:null,df:null,start:0,rows:10,wt:"json",rawQueryParameters:"",schemaColumnNames:[],schemaColumnTypes:[],schemaColumnPaths:[],ajaxOptions:{async:!0,type:"GET",xhrFields:{withCredentials:!0}}},o=["q","fq","fl","df","wt","start","rows"],a={_name:"solr",get name(){return this._name},_label:"Apache Solr Query",get label(){return this._label},_defaults:s,get defaults(){return this._defaults},getParameterMacros:function(t){var e={},i=this.getOption("params"),s=r.extend({},i,t);for(var o in s)if(s.hasOwnProperty(o)){var a=this.__getDashboardParameterValue(o,s[o]);null!==n.normalizeValue(a)&&(n.isString(a)&&(a=a.split(/\s*,\s*/)),e[o]=a)}return e},getSolrQueryParameters:function(){var t={},e=this.getOption("rawQueryParameters");return null!==n.normalizeValue(e)&&e.split("&").forEach(function(e){var n=e.split("="),i=n[0],r=n[1];null!=i&&null!=r&&(t[i]=r)}),o.forEach(function(e){var i=this.getOption(e);if(null!==n.normalizeValue(i)){"q"===e&&(i=this.__expandQueryMacros(i)),t[e]=i}},this),t},init:function(t){if(null==t.endpoint||null==t.collection)throw"InvalidQuery";for(var e in t)t.hasOwnProperty(e)&&this.setOption(e,t[e]);this.setOption("url",this.__buildSolrUrl())},exportData:function(t,e,i){i.exportType=t,null!==n.normalizeValue(t)&&this.setOption("wt",t);var s=this.getAjaxOptions();s.url=this.getOption("url"),s.data=this.buildQueryDefinition(e),s.success=this.__exportDataSuccess.bind(this,i),s.error=this.getErrorHandler(this.getOption("errorCallback").bind(this)),r.ajax(s)},buildQueryDefinition:function(t){var e=r.extend({},this.getSolrQueryParameters());t=Array.isArray(t)?n.propertiesArrayToObject(t):t||{};var i=this.getParameterMacros(t);for(var s in i)if(i.hasOwnProperty(s)){var o=i[s],a=Array.isArray(o);if(a)for(var u=o.length,c=u>1,l=0;l<u;l++){var d=c?"_"+l:"";e[s+d]=o[l]}e[s]=a?o.join(","):o}return e},getSuccessHandler:function(t){var e=this.base(t),n=this;return function(t){var r=null;try{r=JSON.parse(t)}catch(e){i.error("Could not parse json result "+t,e)}var s=[],o=[],a={};if(r){var u=r.response,c=u?u.docs:[],l=n.__buildSchema();a.totalRows=String(c.length),s=l.columnNames.map(function(t,e){return{colName:t,colType:l.columnTypes[e],colIndex:e}}),o=c.map(function(t){return l.columnPaths.map(function(e){return n.__search(t,e)})})}e({metadata:s,resultset:o,queryInfo:a})}},__exportDataSuccess:function(t,e){var n="undefined"!=typeof Blob;"json"===t.exportType&&(e=JSON.stringify(e,null,2));var i;if(n){var r=new Blob([e],{type:"octet/stream"});i=window.URL.createObjectURL(r)}else i=this.getOption("url");this.__exportDataDownload(i,t),n&&window.URL.revokeObjectURL(i)},__exportDataDownload:function(t,e){var n=document.createElement("a");null!=n.download?(n.setAttribute("href",t),n.setAttribute("download",this.__getExportDataName(e)),n.setAttribute("type",this.__getExportMineType(e)),n.setAttribute("style","visibility: hidden;"),document.body.appendChild(n),n.click(),document.body.removeChild(n)):i.warn("Can not export the query data on this browser!")},__replaceSchemaMacros:function(t){var e=this.getOption(t);if(!n.normalizeValue(e))return e;var i=this.getParameterMacros();return e.map(function(t){return t.replace(/\${(\w+)}/g,function(t,e){return i[e]})})},__expandQueryMacros:function(t){var e=new RegExp("(\\w+):\\${(\\w+)(?::[^}]+)?}","g"),n=this.getParameterMacros();return t.replace(e,function(t,e,i){var r=n[i];if(!Array.isArray(r))return t;for(var s=r.length,o=s>1,a="",u=0;u<s;u++){""!==a&&(a+=" OR ");a+=e+":${"+i+(o?"_"+u:"")+"}"}return o&&(a="("+a+")"),a})},__search:function(t,e){var n=t[e];return Array.isArray(n)&&(n=n[0]),void 0!==n?n:null},__buildSchema:function(){var t=this.__replaceSchemaMacros("schemaColumnNames"),e=this.__replaceSchemaMacros("schemaColumnTypes"),n=this.__replaceSchemaMacros("schemaColumnPaths");return{columnNames:t,columnTypes:e,columnPaths:n.length?n:t}},__buildSolrUrl:function(){var t=this.getOption("endpoint");return t.endsWith("/")&&(t=t.slice(0,-1)),t+"/"+this.getOption("collection")+"/"+this.getOption("requestHandler")},__getExportMineType:function(t){switch(t.exportType){case"csv":return"text/csv";case"json":return"application/json";case"xml":return"application/xml";default:return"text/plain"}},__getExportDataName:function(t){var e=t.filename;return null===n.normalizeValue(e)&&(e="solr-export."+t.exportType),e}};e.registerGlobalQuery("solr",a)}),
define("cdf/Dashboard",["./dashboard/Dashboard","./dashboard/Dashboard.context","./dashboard/Dashboard.addIns","./dashboard/Dashboard.bookmarkable","./dashboard/Dashboard.components","./dashboard/Dashboard.i18n","./dashboard/Dashboard.legacy","./dashboard/Dashboard.lifecycle","./dashboard/Dashboard.notifications","./dashboard/Dashboard.parameters","./dashboard/Dashboard.storage","./dashboard/Dashboard.dataSources","./dashboard/Dashboard.query","./dashboard/Dashboard.views","./queries/BaseQuery","./queries/CpkQuery","./queries/CdaQuery","./queries/XmlaQuery","./queries/SolrQuery","./components/BaseComponent","./components/UnmanagedComponent","css!./theme/Dashboard"],function(t){return t}),define("cdf/Dashboard.Bootstrap",["./Dashboard","amd!./lib/bootstrap","css!cdf/lib/font-awesome/css/font-awesome.css","./lib/html5shiv","./lib/respond"],function(t){return t}),define("cdf/dashboard/Query",["amd!../lib/underscore","../lib/jquery"],function(t,e){return function(n,i,r){var s,o;if(t.isObject(n)?(s=e.extend(!0,{},n),o=t.isString(n.queryType)&&n.queryType||!t.isUndefined(n.query)&&"legacy"||!t.isUndefined(n.path)&&!t.isUndefined(n.dataAccessId)&&"cda"||void 0):t.isString(n)&&t.isString(i)&&(o="cda",s={path:n,dataAccessId:i}),!o)throw"InvalidQuery";return r.getQuery(o,s)}});