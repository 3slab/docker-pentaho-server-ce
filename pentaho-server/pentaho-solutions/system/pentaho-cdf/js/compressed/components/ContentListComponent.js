define(["../dashboard/Dashboard.ext","../dashboard/Utils","./NavigatorBaseComponent","pentaho/environment","../lib/jquery","amd!../lib/jquery.fancybox"],function(t,e,i,a,n){return i.extend({update:function(){var t=this,a=4!=this.mode?i.path||e.getPathParameter(i.path):i.getParentPath();t.draw(a)},draw:function(e){var i=this;n.getJSON(t.getJSONSolution()+"?mode=contentList"+(""!=e?"&path="+e:""),function(t){i.processContentListResponse(t,e)})},processContentListResponse:function(t,r){n("#"+this.htmlObject).empty();var s=t.content||[];s.sort(function(t,e){return("FOLDER"===t.type?"000":"")+t.name>("FOLDER"===e.type?"000":"")+e.name});var o=n("<ul></ul>").attr("id","contentList-"+this.name).appendTo("#"+this.htmlObject);if(1!==this.mode&&4!==this.mode&&(i.path||e.getPathParameter(i.path))){var h={name:"Up",title:"Up",type:"FOLDER",description:"Go to parent directory",visible:!0,solution:i.getParentSolution(),path:r.substring(0,r.lastIndexOf("/"))};s.reverse().push(h),s.reverse()}var l=this;n.each(s,function(t,e){if(1==l.mode&&"FOLDER"==this.type)return!0;if(2==l.mode&&"FOLDER"!=this.type)return!0;if(1==this.visible){var i,r="",s="";if("FOLDER"==this.type)r="folder",i=n("<a></a>").attr("target","").attr("title",this.description).attr("parentPath",e.path).text(this.title).click(function(){l.draw(n(this).attr("parentPath"))});else{var h=a.server.root.toString();void 0!=this.url?(r="action greybox",s="/"==h.substring(h.length-1)?h.substring(0,h.length-1)+this.url:h+this.url):(r="action greybox",s="/"==h.substring(h.length-1)?h.substring(0,h.length-1)+this.link:h+this.link),i=n("<a></a>").attr("target","").attr("title",this.description).text(this.title).attr("href",s)}n("<li></li>").attr("class",r).appendTo(o).append(i)}}),n("#contentList-"+this.name+" a").tooltip({showURL:!1}),n("li.greybox a").click(function(){var t=this.href.replace(/'/g,"&#39;");return n.fancybox.open({src:t,type:"iframe",baseClass:"cdf-fancybox cdf-fancybox-iframe",btnTpl:{smallBtn:'<button type="button" data-fancybox-close class="fancybox-button fancybox-close-small" title="close"></button>'}},{toolbar:!1,smallBtn:!0,iframe:{preload:!1,css:{width:n(window).width(),height:n(window).height(),"max-width":"100%","max-height":"100%"}}}),!1})}})});