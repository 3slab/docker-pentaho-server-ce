define(["./InputBaseComponent","../Logger","../lib/jquery","amd!../lib/underscore","../dashboard/Utils","amd!../lib/jquery.chosen","amd!../lib/jquery.multiselect","amd!../lib/jquery.select2"],function(e,t,a,n,s){return e.extend({visible:!1,draw:function(e){var i=this.placeholder();if(0===i.length)return t.warn("Placeholder not in DOM - Will not draw"),!1;var l=this.name,r="<select",o=this._allowMultipleValues();o&&(r+=" multiple");var u=this._getPlaceholderText();u&&(r+=" data-placeholder='"+u+"'");var c=this._getListSize(e);null!=c&&(r+=" size='"+c+"'",e.length>c&&(r+=" style='overflow-y: scroll;' "));var h=this.externalPlugin;switch(h){case"chosen":r+=" class='chzn-select'";break;case"hynds":r+=" class='hynds-select'";break;case"select2":r+=" class='select2-container'"}r+=">";var d,g=this._getParameterValue(),p=s.parseMultipleValues(!n.isNaN(g)&&n.isNumber(g)?g+"":g),f={};s.eachValuesArray(e,{valueAsId:this.valueAsId},function(e,t,a,n){r+="<option value = '"+s.escapeHtml(e)+"' >"+s.escapeHtml(t)+"</option>",n||(d=e),f[e]=!0},this),r+="</select>",i.html(r);var m=!0;if(null!=p){for(var v=p.length;v--;)!0!==f[p[v]]&&(m=!1,p.splice(v,1));p.length||(p=null)}var w=null==p,b=!m;switch(w&&this.useFirstValue&&null!=d&&(p=[d],b=!0),a("select",i).val(null==p?[]:p),o&&(null!=this.autoTopValue?(this.topValue(this.autoTopValue),delete this.autoTopValue):null!=this.autoTopIndex&&(this.topIndex(this.autoTopIndex),delete this.autoTopIndex)),this._doAutoFocus(),b&&(this.dashboard.setParameter(this.parameter,p),this.dashboard.processChange(l)),h){case"chosen":var x=a.browser;a.browser="",i.find("select.chzn-select").chosen(this._readExtraOptions()),a.browser=x;break;case"hynds":i.find("select.hynds-select").multiselect({multiple:o});break;case"select2":var _=this._readExtraOptions()||{};void 0===_.dropdownAutoWidth&&(_.dropdownAutoWidth=!0),_.width||(_.width="off");var T=s.clone(_);T.dropdownParentId&&(T.dropdownParent=a("#"+T.dropdownParentId)),i.find("select.select2-container").select2(T)}this._listenElement(i)},_allowMultipleValues:function(){return!1},_getPlaceholderText:function(){var e=this.placeholderText;return n.isString(e)&&!n.isEmpty(e)&&e||!1},_getListSize:function(e){return this.size},_readExtraOptions:function(){if(this.externalPlugin&&this.extraOptions)return s.propertiesArrayToObject(this.extraOptions)},_listenElement:function(e){var t,n=this,i=n.getValue(),l=function(){t&&t();var e=n.dashboard;if(e){var a=n.getValue();s.equalValues(i,a)||(i=a,e.processChange(n.name))}},r=a("select",e);if(r.keypress(function(e){13===e.which&&l()}),"timeout-focus"!==this._getChangeMode())r.on(n._changeTrigger(),l);else{var o=n.changeTimeoutScrollFraction;o=Math.max(0,null!=o?o:1);var u=n.changeTimeoutChangeFraction;u=Math.max(0,null!=u?u:5/8);var c,h=Math.max(100,n.changeTimeout||2e3),d=o*h,g=u*h;t=function(){null!=c&&(clearTimeout(c),c=null)};var p=function(e){t(),n.dashboard&&(c=setTimeout(l,e||h))};r.change(function(){p(g)}).scroll(function(){p(d)}).focusout(l)}},_getChangeMode:function(){var e=this.changeMode;if(e)switch(e=e.toLowerCase()){case"immediate":case"focus":return e;case"timeout-focus":return/android|ipad|iphone/i.test(navigator.userAgent)?"focus":e;default:t.log("Invalid 'changeMode' value: '"+e+"'.","warn")}return"immediate"},_changeTrigger:function(){return"immediate"===this._getChangeMode()?"change":/android/i.test(navigator.userAgent)?"change":"focusout"}})});