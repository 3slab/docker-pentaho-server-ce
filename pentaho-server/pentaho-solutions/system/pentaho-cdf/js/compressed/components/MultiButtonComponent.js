define(["../lib/jquery","./ToggleButtonBaseComponent","../dashboard/Utils","css!./theme/MultiButtonComponent.css"],function(t,e,n){function o(t){return"pentaho-toggle-button pentaho-toggle-button-up "+(t?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal")}function i(t){return"pentaho-toggle-button pentaho-toggle-button-down "+(t?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal")}function l(t){return"pentaho-toggle-button pentaho-toggle-button-up "+(t?"pentaho-toggle-button-vertical":"pentaho-toggle-button-horizontal")}function a(t,e,n){return 0==t&&1==e?" pentaho-toggle-button-single":0==t?n?" pentaho-toggle-button-vertical-first":" pentaho-toggle-button-horizontal-first":t==e-1?n?" pentaho-toggle-button-vertical-last":" pentaho-toggle-button-horizontal-last":""}return e.extend({indexes:[],draw:function(e){this.cachedArray=e;var i,l=this,r=o(l.verticalOrientation),u="",s=l.valueAsId?1:0;void 0==l.isMultiple&&(l.isMultiple=!1);var h=t("<div>");h.appendTo(l.placeholder().empty());for(var g=0,c=e.length;g<c;g++){var p,d=e[g][s],v=e[g][1],b=r+a(g,c,l.verticalOrientation);d=null==d?null:d.replace('"',"&quot;"),v=null==v?null:v.replace('"',"&quot;"),0==g&&(i=d),u="<div class='"+b+"'><button type='button' name='"+l.name+"'>"+v+"</button  ></div>",p=t(u),function(t){p.click(function(){l.clickButton(l.htmlObject,l.name,t,l.isMultiple,l.verticalOrientation)})}(g),h.append(p);var f=l.separator;void 0!=f&&null!=f&&"null"!=f&&g!=e.length-1&&h.append(f)}var m,x=n.ev(l.dashboard.getParameterValue(l.parameter)),y=!1;m=null==x||void 0==x?[]:x instanceof Array||"object"==typeof x&&x.join?x:x.toString().split("|");var A=!1;l.clearSelections(l.htmlObject,l.name,l.verticalOrientation);for(var g=0;g<e.length;g++){y=!1;for(var B=0,M=m.length;B<M&&!(y=m[B]==e[g][s]);B++);if((t.isArray(x)&&y||y||e[g][s]==x||e[g][1]==x)&&(l.clickButton(l.htmlObject,l.name,g,l.isMultiple,l.verticalOrientation,!0),A=!0,!l.isMultiple))break}(!A&&!l.isMultiple||!A&&l.isMultiple&&l.useFirstValue)&&e.length>0&&((null==x||""==x||x!==i&&1==e.length||"object"==typeof x&&0==x.length)&&l.parameter&&l.dashboard.fireChange(l.parameter,l.isMultiple?[i]:i),l.clickButton(l.htmlObject,l.name,0,l.isMultiple,l.verticalOrientation,!0)),t(".pentaho-toggle-button").hover(function(){t(l).addClass("pentaho-toggle-button-up-hovering")},function(){t(l).removeClass("pentaho-toggle-button-up-hovering")}),t(".pentaho-toggle-button button").hover(function(){t(l).parent().addClass("pentaho-toggle-button-up-hovering")},function(){}),l._doAutoFocus()},getValue:function(){var t=this;if(t.isMultiple){var e=t.getSelectedIndex(t.name),n=new Array;if(void 0==e.length)n.push(t.getValueByIdx(e));else for(var o=0;o<e.length;o++)n.push(t.getValueByIdx(e[o]));return n}return t.getValueByIdx(t.getSelectedIndex(t.name))},getValueByIdx:function(t){return this.cachedArray[t][this.valueAsId?1:0]},clickButton:function(e,n,o,r,u,s){var h=l(u),g=i(u),c=t("#"+e+" button");if(r){void 0==this.indexes[n]?this.indexes[n]=[]:t.isArray(this.indexes[n])||(this.indexes[n]=[this.indexes[n]]);for(var p=!1,d=0;d<this.indexes[n].length;++d)if(this.indexes[n][d]==o){p=!0,this.indexes[n].splice(d,1);break}p?c[o].parentNode.className=h+a(o,c.length,u):(c[o].parentNode.className=g+a(o,c.length,u),this.indexes[n].push(o))}else{if(this.indexes[n]===o)return!1;this.clearSelections(e,n,u),this.indexes[n]=o,c[o].parentNode.className=g+a(o,c.length,u)}s||this.callAjaxAfterRender(this,n)},clearSelections:function(e,n,o){for(var i=t("#"+e+" button"),r=l(o),u=0;u<i.length;u++)i[u].parentNode.className=r+a(u,i.length,o);this.indexes[n]=[]},getSelectedIndex:function(t){return this.indexes[t]}})});