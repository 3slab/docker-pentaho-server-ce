define(["../Logger","amd!../lib/underscore","../lib/moment","../lib/CCC/cdo","../lib/jquery","amd!../lib/queryParser","../lib/sanitizer"],function(e,r,n,t,a){function i(e){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[e[n][0]]=e[n][1]);return r}function o(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push([n,e[n]]);return r}var u={},l=void 0,s=void 0;return u.escapeHtml=function(r){return"string"!=typeof r?(e.warn("escapeHtml expects string values, returning an empty string"),""):r.replace(/&(?!#([0-9][0-9]?[0-9]?[0-9]?[0-9]?);)(?!([a-zA-Z]{2,8});)(?!#x[A-F0-9][A-F0-9][A-F0-9]?[A-F0-9]?;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&#34;")},u.sanitizeHtml=function(e){return e=e.replace(/<iframe\b[^>]*>/gi,"<script>").replace(/<\/iframe>/gi,"<\/script>"),e=Sanitizer.sanitize(e)},u.getPathParameter=function(e){e=e||window.location.pathname,e=decodeURIComponent(e);var r=e.match("/:(.[^/]+)(.*)/");if(r&&r.length>1)return(":"+r[1]).replace(/:/g,"/")},u.getLocationSearchString=function(){return window.location.search},u.getQueryParameter=function(e){return void 0===s&&(s=a.parseQuery(this.getLocationSearchString())),s[e]||""},u.numberFormat=function(e,r,n){if(void 0===l&&(l=t.format.language().createChild()),null!=n){var a=t.format.language(n).createChild();return a.number({mask:r}),a.number()(e)}return l.number({mask:r}),l.number()(e)},u.configLanguage=function(e,r){var a=r.dateLocale||{},i=n.locale();delete r.dateLocale,t.format.language(e,r),n.locale(e,a),n.locale(i)},u.dateFormat=function(e,r,t){var a=n(e);return a.isValid()?(null!=t&&(null===n.localeData(t)&&(t="en-US"),a.locale(t)),a.format(r)):a.toDate()},u.dateParse=function(e,r){return n(e,r).toDate()},u.propertiesArrayToObject=function(e){return r.isArray(e)&&i(e)||r.isObject(e)&&e||void 0},u.objectToPropertiesArray=function(e){return r.isArray(e)&&e||r.isObject(e)&&o(e)||void 0},u.getURLParameters=function(e){if(e.indexOf("?")>0)for(var r=e.split("?"),n=r[1].split("&"),t=[],a=0;a<n.length;a++){var i=n[a].split("=");if(0==i[0].indexOf("param",0)){var o=[i[0].substring(5,i[0].length),unescape(i[1])];t.push(o)}}return t},u.toFormatedString=function(e){e+="";for(var r=e.split("."),n=r[0],t=r.length>1?"."+r[1]:"",a=/(\d+)(\d{3})/;a.test(n);)n=n.replace(a,"$1,$2");return n+t},u.doCsvQuoting=function(e,r,n){var t='"';return null==r?e:null==e?null:(e.indexOf(t)>=0&&(e=e.replace(t,t.concat(t))),(n||e.indexOf(r)>=0)&&(e=t.concat(e,t)),e)},u.ev=function(e){return"function"==typeof e?e():e},u.post=function(e,r){var n='<form action="'+e+'" method="post">';for(var t in r){var i=u.ev(r[t]);"string"==typeof i&&(i=i.replace(/"/g,"'")),n+='"<input type="hidden" name="'+t+'" value="'+i+'"/>'}n+="</form>",a(n).appendTo("body").submit().remove()},u.clone=function(e){var r=e instanceof Array?[]:{};for(var n in e){var t=e[n];if("object"==typeof t)if(t instanceof Array){r[n]=[];for(var a=0;a<t.length;a++)"object"!=typeof t[a]?r[n].push(t[a]):r[n].push(this.clone(t[a]))}else r[n]=this.clone(t);else r[n]=t}return r},u.addArgs=function(e){void 0!=e&&(this.args=getURLParameters(e))},u.getArgValue=function(e){for(var r=0;r<this.args.length;r++)if(this.args[r][0]==e)return this.args[r][1]},u.eachValuesArray=function(e,r,n,t){"function"==typeof r&&(t=n,n=r,r=null);for(var a=!(!r||!r.valueAsId),i=0,o=0,u=e.length;i<u;i++){var l=e[i];if(l&&l.length){var s,c,f=l[0],g=void 0;if(l.length>1?(a&&(g=f),c=""+l[1],s=a||null==f?c:""+f):s=c=""+f,!1===n.call(t,s,c,g,o,i))return!1;o++}}return!0},u.parseMultipleValues=function(e){if(null!=e&&""!==e){if(this.isArray(e))return e;if("string"==typeof e)return e.split("|")}return null},u.normalizeValue=function(e){return""===e||null==e?null:this.isArray(e)&&!e.length?null:e},u.isArray=function(e){return!!e&&(e instanceof Array||"object"==typeof e&&e.join&&null!=e.length)},u.isFunction=function(e){return"function"==typeof e},u.isString=function(e){return"string"==typeof e||e instanceof String},u.isNumber=function(e){return"number"==typeof e&&isFinite(e)},u.equalValues=function(e,r){if(e=this.normalizeValue(e),r=this.normalizeValue(r),e===r)return!0;if(this.isArray(e)&&this.isArray(r)){var n=e.length;if(n!==r.length)return!1;for(;n--;)if(!this.equalValues(e[n],r[n]))return!1;return!0}return e==r},u.hsvToRgb=function(e,r,n){n/=100,r/=100;var t,a=e%360/60,i=n*r,o=n-i,u=Math.abs(a%2-1),l=n*(1-r*u),s=n;switch(~~a){case 0:t=[s,l,o];break;case 1:t=[l,s,o];break;case 2:t=[o,s,l];break;case 3:t=[o,l,s];break;case 4:t=[l,o,s];break;case 5:t=[s,o,l]}return t.forEach(function(e,r){t[r]=Math.min(255,Math.round(256*e))}),"rgb("+t.join(",")+")"},u.pathIncludesAction=function(e,r){return"string"==typeof e&&"string"==typeof r&&(!("\\/".indexOf(e.substr(-1,1))>=0)&&(!!u.endsWith(e,r)&&"\\/".indexOf(e.substr(-(r.length+1),1))>=0))},u.endsWith=function(e,r){return e===r||e.slice(-r.length)===r},u});