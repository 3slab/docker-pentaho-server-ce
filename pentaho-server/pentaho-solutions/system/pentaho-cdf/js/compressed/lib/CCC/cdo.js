define(["./def","./protovis-compat!"],function(e,t){function i(e,t){var i=e&&e.length;if(i){for(var n=0;n<i;n++){var s=e[n];t&&(s[t]=null),s.dispose()}e.length=0}}function n(e,t,i,n,s){i[n]=e;var r=e[t]||(e[t]=[]);null==s||s>=r.length?r.push(i):r.splice(s,0,i)}function s(t,i,n,s){var r,a=t[i];a&&(r=a.indexOf(n))>=0&&e.array.removeAt(a,r),n[s]=null}function r(e){return e.toISOString()}function a(e,t){return e.id-t.id}function o(e,t){return t.id-e.id}function l(){delete this.isSelected}function u(e){return e.isNull||e.isSelected}function h(e){return!0===e.isSelected}function c(e){return!1===e.isSelected}function m(e){return!0===e.isVisible}function d(e){return!1===e.isVisible}function f(e){return!0===e.isNull}function p(e){return!1===e.isNull}function g(t,i,n,s,r){var a;if(this.owner===this)a=new Ie.Atom(this,n,s,t,i),r&&(a.isVirtual=!0);else{var o=this.parent||this.linkParent;a=o._atomsByKey[i]||g.call(o,t,i,n,s,r)}return e.array.insert(this._atoms,a,this._atomComparer),w.call(this),this._atomsByKey[i]=a,a}function v(t){var i=t.key,n=this,s=!n._lazyInit;if(t.dimension===n)return n.owner===n||e.assert("Should be an owner dimension"),i||t!==n._virtualNullAtom?s?w.call(this):this._sumCache=null:t=n.intern(null),t;if(s){var r=n._atomsByKey[i];if(r){if(r!==t)throw e.error.operationInvalid("Atom is from a different root data.");return w.call(n),t}if(n.owner===n)throw e.error.operationInvalid("Atom is from a different root data.")}return v.call(n.parent||n.linkParent,t),s?(n._atomsByKey[i]=t,i?e.array.insert(n._atoms,t,n._atomComparer):(n._nullAtom=t,n._atoms.unshift(t)),w.call(n)):this._sumCache=null,t}function _(t){var i=e.get(t,"visible"),n=e.get(t,"selected");return(null==i?null:!!i)+":"+(null==n?null:!!n)}function y(e){var t=this._nullAtom;return t||(this.owner===this?this.data._atomsBase[this.name]=t=new Ie.Atom(this,null,e,null,""):t=y.call(this.parent||this.linkParent,e),this._atomsByKey[""]=this._nullAtom=t,this._atoms.unshift(t)),t}function b(){return this.owner===this||e.assert("Can only create atoms on an owner dimension."),this._virtualNullAtom||(this._virtualNullAtom=new Ie.Atom(this,null,"",null,""),this.data._atomsBase[this.name]=this._virtualNullAtom),this._virtualNullAtom}function D(){this.owner===this||e.assert("Can only unintern atoms of an owner dimension.");var t=this._atoms;if(t){for(var i=this._atomsByKey,n=0,s=t.length;n<s;){var r=t[n];if(r.visited)delete r.visited,n++;else if(r!==this._virtualNullAtom){t.splice(n,1),s--;var a=r.key;delete i[a],a||(delete this._nullAtom,this.data._atomsBase[this.name]=this._virtualNullAtom)}}w.call(this)}}function N(){var t=this._atoms;if(t){for(var i,n=this._atomsByKey,s=0,r=t.length;s<r;){var a=t[s];a.isVirtual?(t.splice(s,1),r--,i=!0,delete n[a.key||e.assert("Cannot be the null or virtual null atom.")]):s++}i&&w.call(this)}}function w(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null}function x(e){n(this,"childNodes",e,"parent"),e.owner=this.owner}function S(e){n(this,"_linkChildren",e,"linkParent"),e.owner=this.owner}function C(e,t){var i;if(!this._disposed&&(i=this._atomVisibleDatumsCount)){var n=e.atoms[this.name],s=n.key,r=i[s];i[s]=(r||0)+(t?1:-1),this._visibleAtoms=this._sumCache=this._visibleIndexes=null}}function I(){var e=this._atomVisibleDatumsCount;return e||(e={},this.data.datums(null,{visible:!0}).each(function(t){var i=t.atoms[this.name],n=i.key;e[n]=(e[n]||0)+1},this),this._atomVisibleDatumsCount=e),e}function A(e){var t=[];return this._atoms.forEach(function(i,n){this.isVisible(i)===e&&t.push(n)},this),t}function T(t){return e.query(this._atoms).where(function(e){return this.isVisible(e)===t},this).array()}function k(t,i){this.insertAt(t,i),e.lazy(this,"_childrenByKey")[t.key]=t}function O(e,t){n(this,"_linkChildren",e,"linkParent",t)}function R(e){s(this,"_linkChildren",e,"linkParent")}function L(){i(this.childNodes,"parent"),this._childrenByKey=null,i(this._linkChildren,"linkParent"),this._groupByCache=null,this._sumAbsCache=null}function M(){this.isOwner()||e.fail("Can only be called on the owner data.")}function G(t,i){!t.isNull||e.assert("Null datums do not notify selected changes"),i?this._selectedNotNullDatums.set(t.id,t):this._selectedNotNullDatums.rem(t.id),this._sumAbsCache=null}function P(t,i){var n=t.id,s=this;if(e.hasOwnProp.call(s._datumsById,n)){!t.isNull||e.assert("Null datums do not notify visible changes"),i?s._visibleNotNullDatums.set(n,t):s._visibleNotNullDatums.rem(n),s._sumAbsCache=null;for(var r=s._dimensionsList,a=0,o=r.length;a<o;)C.call(r[a++],t,i);for(r=s.childNodes,a=0,o=r.length;a<o;)P.call(r[a++],t,i);if((r=s._linkChildren)&&(o=r.length))for(a=0;a<o;)P.call(r[a++],t,i)}}function B(e){for(var t,i=[e];t=e.parent||e.linkParent;)i.unshift(e=t);return i}function V(e,t){for(var i,n=0,s=Math.min(e.length,t.length),r=null;n<s&&(i=e[n])===t[n];)r=i,n++;return r}function j(t,i){function n(t){if(t){var i=t.key;if(!e.hasOwnProp.call(r,i)){null!==u&&e.hasOwnProp.call(u,i)&&(t=u[i]);var n=t.id;s.push(t),r[i]=t,a[n]=t,null!==m&&m.push(t),t.isNull||(t.isSelected&&c.set(n,t),t.isVisible&&h.set(n,t))}}}if(!t)throw e.error.argumentRequired("setDatums");var s,r,a,o=this._datums.length>0,l=!!e.get(i,"isAdditive"),u=null,h=this._visibleNotNullDatums,c=this._selectedNotNullDatums;o&&!l?(L.call(this),u=this._datumsByKey,this._datums=s=[],this._datumsById=a={},this._datumsByKey=r={},h.clear(),c&&c.clear()):(s=this._datums,r=this._datumsByKey,a=this._datumsById,o&&(this._sumAbsCache=null));var m=null,d=!!this._linkChildren&&this._linkChildren.length>0;if(d&&o&&l&&(m=[]),e.array.is(t))for(var f=0,p=t.length;f<p;)n.call(this,t[f++]);else{if(!(t instanceof e.Query))throw e.error.argumentInvalid("setDatums","Argument is of invalid type.");t.each(n,this)}this.select&&this.select(s).forEach(function(e){K.call(this,e),null!==m&&m.splice(m.indexOf(e),1)},this),q.call(this),d&&this._onDatumsAdded(m||s)}function q(){for(var e=-1,t=this._datums,i=t.length;++e<i;)E.call(this,t[e],!1,!0);var n=this._dimensionsList;for(e=-1,i=n.length;++e<i;)D.call(n[e])}function E(e,t,i){var n=this._dimensionsList;if(n||(t=!1),t||i){var s,r,a,o=e.atoms,l=0;if(n)for(s=n.length;l<s;)a=n[l++],(r=o[a.name])&&(t&&v.call(a,r),i&&(r.visited=!0));else{var u=this.type.dimensionsNames();for(s=u.length;l<s;)(r=o[u[l++]])&&(r.visited=!0)}}}function K(e){var t=this._datums,i=this._selectedNotNullDatums,n=e.id;t.splice(t.indexOf(e),1),delete this._datumsById[n],delete this._datumsByKey[e.key],i&&e.isSelected&&i.rem(n),e.isVisible&&this._visibleNotNullDatums.rem(n)}function F(t){function i(t){if(null!=t){"object"==typeof t||e.fail.invalidArgument("datumFilter");var i={},s=!1;for(var r in t){var a=t[r],o=this.dimensions(r).getDistinctAtoms(null!==a?e.array.as(a):[null]);o.length&&(s=!0,i[r]=o)}s&&n.push(i)}}var n=[];return t=e.array.as(t),t&&t.forEach(i,this),n}function z(t,i){var n=e.get(i,"visible"),s=e.get(i,"isNull"),r=e.get(i,"selected"),a=e.get(i,"where");return null!=n&&(t=t.where(n?m:d)),null!=s&&(t=t.where(s?f:p)),null!=r&&(t=t.where(r?h:c)),a&&(t=t.where(a)),t}function U(t,i){var n=e.get(i,"visible"),s=e.get(i,"isNull"),r=e.get(i,"selected"),a=e.get(i,"where"),o=[];null!=n&&o.unshift(n?m:d),null!=s&&o.unshift(s?f:p),null!=r&&o.unshift(r?h:c),a&&o.unshift(a),t&&o.unshift(Q(t));var l=o.length;return l?1===l?o[0]:function(e){for(var t=l;t;)if(!o[--t](e))return!1;return!0}:null}function Q(e){function t(t){for(var s=t.atoms,r=0;r<n;r++)if(i(s,e[r]))return!0;return!1}function i(e,t){for(var i in t)if(t[i].indexOf(e[i])<0)return!1;return!0}var n=e.length;return t}function H(t,i){var n=e.array.as(e.get(i,"orderBy")),s=e.create(i||{},{orderBy:null});return e.query(t).selectMany(function(e,t){return n&&(s.orderBy=n[t]),$.call(this,e,s)},this).distinct(e.propGet("id"))}function $(t,i){var n=i.orderBy;if(n){if(n.indexOf("|")>=0)throw e.error.argumentInvalid("keyArgs.orderBy","Multi-dimension order by is not supported.")}else n=Object.keys(t).sort().join(",");var s=this.groupBy(n,i),r=s.treeHeight,a=[];return e.query(function(){var i;if(this._data){if(this._datumsQuery){if(this._data||e.assert("Must have a current data"),a.length||e.assert("Must have a parent data"),!this._dimAtomsOrQuery||e.assert(),this._datumsQuery.next())return this.item=this._datumsQuery.item,1;this._datumsQuery=null,i=a.pop(),this._data=i.data,this._dimAtomsOrQuery=i.dimAtomsOrQuery}}else this._data=s,this._dimAtomsOrQuery=e.query(t[s.groupingLevelSpec.dimensions[0].name]);this._dimAtomsOrQuery||e.assert("Invalid programmer"),this._data||e.assert("Must have a current data");for(var n=a.length;;){for(;this._dimAtomsOrQuery.next();){var o=this._dimAtomsOrQuery.item,l=this._data.child(o.key);if(l&&(n<r-1||l._datums.length)){if(a.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery}),this._data=l,!(n<r-1))return this._dimAtomsOrQuery=null,this._datumsQuery=e.query(l._datums),this._datumsQuery.next(),this.item=this._datumsQuery.item,1;this._dimAtomsOrQuery=e.query(t[l.groupingLevelSpec.dimensions[0].name]),n++}}if(!n)return 0;i=a.pop(),this._data=i.data,this._dimAtomsOrQuery=i.dimAtomsOrQuery,n--}return 0})}function W(t,i,n){return e.string.is(t)||e.fail.argumentInvalid("groupLevelText","Invalid grouping specification."),e.query(t.split(/\s*\|\s*/)).where(e.truthy).select(function(t){var s=Re.exec(t)||e.fail.argumentInvalid("groupLevelText","Invalid grouping level syntax '{0}'.",[t]),r=s[1],a=(s[2]||"").toLowerCase(),o="desc"===a,l=new Ie.GroupingDimensionSpec(r,o);return i&&l.bindComplexType(i,n),l})}function Y(t,i){function n(){var n={},r=e.query(s.source).select(function(e){i(e,n);var t=n.series;return null!=t&&null!=t.v&&(t=t.v),t||null}).distinct().array();return s._createPlot2SeriesKeySet(t,r)}var s=this;this._dataPartGet(n)}function J(t){return e.string.is(t)?!!this.mask(t):e.is(t,Pe)?!!this.mask(t.mask()).style(t.style()):void 0}function Z(e){e||(e="");var t="_"+e,i=Be[t];return i||(Ve===Pe.cacheLimit&&(Be={},Ve=0),Be[t]=i=X(e),Ve++),i}function X(e){function t(e,t){return null==e?r?r(t):"":(e=+e,isNaN(e)||!isFinite(e)?"":i?0===e?s?s(t):i(t,e,null,!1):e>0?i(t,e,s,!1):n?n(t,-e,s||i):i(t,-e,s,!0):String(e))}var i,n,s,r;return function(){var t,a,o,l=ee(e);if(l.forEach(te),t=l.length,i=r=n=s=null,t&&(i=ae(o=l[0]),t>1&&(a=l[1],n=ae(a.empty?o:a),t>2&&(a=l[2],s=se(a.empty?o:a),t>3&&(a=l[3],r=re(a.empty?o:a),t>4)))))throw new Error("Invalid mask. More than 4 sections.")}(),t}function ee(e){var t=[];if(e){var i,n,s,r,a=-1,o=e.length,l="",u=1,h=1,c=0,m=0,d=function(e){u=0,s.list.push(e)},f=function(e){u=0,l+=e},p=function(){l&&(y(),d({type:0,text:l}),l="")},g=function(e){p(),d(e)},v=function(){p(),!c&&m&&d({type:2}),s.digits=r,r=0,h=0,s=n.fractional},_=function(){!n||u&&t.length||(h?v():p(),s.digits=r,t.push(n)),u=h=1,m=r=c=0,n={empty:0,scale:0,groupOn:0,scientific:0,abbreviationOn:0,integer:{list:[],digits:0},fractional:{list:[],digits:0}},s=n.integer},y=function(){"A"===l?(l="",g({type:6})):"C"===l?(l="",g({type:4})):"AC"===l?(l="",g({type:6}),g({type:4})):"CA"===l&&(l="",g({type:4}),g({type:6}))};for(_();++a<o;)if("0"===(i=e.charAt(a)))g({type:1}),c=1,r++;else if("#"===i)g({type:2}),c=1,r++;else if(","===i)h&&g({type:3});else if("."===i)h&&(m=1,v());else if("¤"===i)g({type:4});else if("C"===i&&"Currency"===e.substring(a,a+8))g({type:4}),a+=7;else if("A"===i&&"Abbreviation"===e.substring(a,a+12))g({type:6}),a+=11;else if(";"===i)_(),(a+1>=o||";"===e.charAt(a+1))&&(a++,t.push({empty:1}));else if("\\"===i)++a<o&&f(e.charAt(a));else if('"'===i){a++;var b=e.indexOf(i,a);b<0&&(b=o),f(e.substring(a,b)),a=b}else" "===i?g({type:7}):("e"!==i&&"E"!==i||!function(){var t,s=a+1,r=!1,l=0;if(s<o){if("-"===(t=e.charAt(s))||"+"===t){if(r="+"===t,!(++s<o))return 0;t=e.charAt(s)}for(;"0"===t&&++l&&++s<o&&(t=e.charAt(s)););if(l)return a=s-1,g({type:5,text:i,digits:l,positive:r}),n.scientific=1,1}return 0}())&&("%"===i?n.scale+=2:"‰"===i?n.scale+=3:"‱"===i&&(n.scale+=4),f(i));_()}return t}function te(e){e.empty||(ie(e,!0),ie(e,!1))}function ie(e,t){function i(e){l[r](e)}for(var n,s,r=t?"push":"unshift",a=e[t?"integer":"fractional"],o=a.list,l=a.list=[],u=a.digits-1,h=0,c=0,m=o.length,d=t?0:m,f=t?function(){return d<m?o[d++]:null}:function(){return d>0?o[--d]:null};n=f();)switch(s=n.type){case 0:i(ue(n.text));break;case 1:case 2:c&&2===s&&(s=1),i(he(t,u,1===s,!h)),u--,h=1,c||1!==s||(c=1);break;case 3:ne(o,d,m)?h&&(e.groupOn=1):e.scale-=3;break;case 4:i(pe);break;case 5:i(me(e,n));break;case 6:e.abbreviationOn=1,i(ge);break;case 7:i(ue(" "))}!t&&a.digits&&l.unshift(ce(c))}function ne(e,t,i){for(;t<i;){var n=e[t++].type;if(1===n||2===n)return 1}return 0}function se(e){function t(t){return oe(e,t,0,!1)}return t}function re(e){function t(t){return oe(e,t,"",!1)}return t}function ae(t){function i(i,n,s,r){var a,o,l=n,u=0,h=t.scale;if(t.abbreviationOn)for(var c=i.abbreviations.length,m=c;m>0;m--){var d=3*m;if(Math.pow(10,d)<=n){h-=d,o=m-1;break}}return t.scientific&&(a=Math.floor(Math.log(n)/Math.LN10),u=h+a-t.integer.digits+1,h-=u),h&&(n=e.mult10(n,h)),n=e.round10(n,t.fractional.digits),!n&&s?s(i,l):oe(t,i,n,r,u,o)}return i}function oe(e,t,i,n,s,r){var a=""+i,o=a.indexOf("."),l=o<0?a:a.substr(0,o),u=o<0?"":a.substr(o+1);"0"===l&&(l=""),s||(s=0);var h=[];return n&&h.push(t.negativeSign),l=l.split(""),u=u.split(""),t.group&&e.groupOn&&le(t,l),e.integer.list.forEach(function(e){h.push(e(t,l,s,r))}),e.fractional.list.forEach(function(e){h.push(e(t,u,s,r))}),h.join("")}function le(e,t){for(var i,n=e.group,s=function(){t[r-l-1]+=n},r=t.length,a=e.groupSizes,o=a.length,l=0,u=-1;++u<o;){if(!((l+=i=a[u])<r))return;s()}for(;(l+=i)<r;)s()}function ue(e){function t(){return e}return t}function he(e,t,i,n){function s(t){return t[e?"integerPad":"fractionPad"]}function r(e,i){var s=i.length;if(t<s){var r=s-1-t;return n?i.slice(0,r+1).join(""):i[r]}return o?o(e):""}function a(e,i){return t<i.length?i[t]:o?o(e):""}var o=i?s:null;return e?r:a}function ce(e){return e?de:fe}function me(e,t){function i(e,i,n){var s=n<0?e.negativeSign:t.positive?"+":"",r=""+Math.abs(n),a=t.digits-r.length;return a>0&&(r=new Array(a+1).join("0")+r),t.text+s+r}return i}function de(e){return e.decimal}function fe(e,t){return t.length?e.decimal:""}function pe(e){return e.currency}function ge(e,t,i,n){if(null!=n)return e.abbreviations[n]}function ve(t){return e.string.is(t)?!!this.mask(t):e.is(t,je)?!!this.mask(t.mask()):void 0}function _e(i){return i?t.Format.createFormatter(t.Format.date(i)):e.string.to}function ye(t){return e.is(t,qe)?!!this.formatter(t.formatter()):e.fun.is(t)?!!this.formatter(t):void 0}function be(e){return null!=e?String(e):""}function De(t){function i(i){return e.is(i,t)||e.is(i,qe)?i:null}function n(i,n){return(e.fun.is(i)?qe:t)(i,n)}return{cast:i,factory:n}}function Ne(t){switch(e.classOf(t)){case Ke:return!!this.number(t.number()).percent(t.percent()).date(t.date()).any(t.any());case Pe:return!!this.number(t);case je:return!!this.date(t);case qe:return!!this.any(t)}if(e.string.is(t)){var i=Ue(t);if(i)return!!e.configure(this,i)}}function we(t,i){t=Se(t);var n=e.getOwn(Fe,t);return n?e.configure(n,i):(n=Fe[t]=Ke(i),n.languageCode=t),n}function xe(e){var t=/^([a-z]{2,8})(?:[-_]([a-z]{2}|\d{3}))?$/i,i=t.exec(e);if(!i)return null;var n=i[1]?i[1].toLowerCase():"",s=i[2]?i[2].toLowerCase():"";return{code:n+(s?"-"+s:""),primary:n,region:s}}function Se(e){return e?e.toLowerCase():""}function Ce(t,i){t=Se(t);var n=e.getOwn(Fe,t);if(n)return n;if(!i)return null;var s=xe(t);if(s){if(s.code!==t&&(n=e.getOwn(Fe,s.code)))return n;if(s.region&&(n=e.getOwn(Fe,s.primary)))return n}return e.getOwn(Fe,Ee,null)}var Ie=e.globalSpace("cdo",{});e.type("cdo.DimensionType").init(function(i,n,s){this.complexType=i,this.name=n,this.label=e.get(s,"label")||e.titleFromName(n);var a=e.splitIndexedId(n);this.group=a[0],this.groupLevel=e.nullyTo(a[1],0),this.label.indexOf("{")>=0&&(this.label=e.format(this.label,[this.groupLevel+1])),this.isHidden=!!e.get(s,"isHidden");var o=e.get(s,"valueType")||null,l=Ie.DimensionType.valueTypeName(o),u=e.getOwn(Ie.DimensionType.cast,l,null);this.valueType=o,this.valueTypeName=l,this.cast=u;var h=this.valueType===Number,c=!h&&this.valueType===Date;if(this.isDiscreteValueType=!h&&!c,this.isDiscrete=e.get(s,"isDiscrete"),null==this.isDiscrete)this.isDiscrete=this.isDiscreteValueType;else if(this.isDiscrete=!!this.isDiscrete,!this.isDiscrete&&this.isDiscreteValueType)throw e.error.argumentInvalid("isDiscrete","The only supported continuous value types are Number and Date.");if(this._converter=e.get(s,"converter")||null,!this._converter){var m=e.get(s,"rawFormat");if(m)switch(this.valueType){case Date:this._converter=t.Format.createParser(t.Format.date(m))}}this._key=e.get(s,"key")||null,null===this._key&&c&&(this._key=r),this.setComparer(s&&s.comparer);var d,f=e.get(s,"formatter"),p=e.get(s,"formatProto"),g=h?"number":c?"date":"any";f?d=Ie.format(e.set({},g,f),p):this.isDiscreteValueType?d=Ke(null,p):(d=e.get(s,"format"),d||h||(d=e.get(s,"rawFormat"))&&(d=d.replace(/-/g,"/")),d?e.is(d,Ke)||((e.string.is(d)||e.fun.is(d)&&!e.classOf(d))&&(d=e.set({},g,d)),d=Ke(d,p)):d=Ke(null,p),f=d[g]()),this._formatter=f||null,this._format=d||null,this.isKey=Boolean(e.get(s,"isKey"))}).add({isCalculated:!1,compare:function(e,t){return null==e?null==t?0:-1:null==t?1:this._comparer.call(null,e,t)},comparer:function(e){var t=this;return t.isComparable?e?t._rc||(t._rc=function(e,i){return t.compare(i,e)}):t._dc||(t._dc=function(e,i){return t.compare(e,i)}):null},setComparer:function(t){if(void 0===t||!t&&!this.isDiscrete)switch(this.valueType){case Number:case Date:t=e.compare}this._comparer=t||null,this.isComparable=null!=this._comparer,this._rc=this._dc=this._rac=this._dac=null},atomComparer:function(e){return e?this._rac||(this._rac=this._createReverseAtomComparer()):this._dac||(this._dac=this._createDirectAtomComparer())},_toDiscrete:function(){this.isDiscrete=!0},_toCalculated:function(){this.isCalculated=!0},_createReverseAtomComparer:function(){function e(e,i){return e===i?0:t.compare(i.value,e.value)}if(!this.isComparable)return o;var t=this;return e},_createDirectAtomComparer:function(){function e(e,i){return e===i?0:t.compare(e.value,i.value)}if(!this.isComparable)return a;var t=this;return e},format:function(){return this._format},formatter:function(){return this._formatter},converter:function(){return this._converter}}),Ie.DimensionType.cast={Date:function(e){return e instanceof Date?e:new Date(e)},Number:function(e){return e=Number(e),isNaN(e)?null:e},String:String,Boolean:Boolean,Object:Object,Any:null},Ie.DimensionType.dimensionGroupName=function(e){return e.replace(/^(.*?)(\d*)$/,"$1")},Ie.DimensionType.valueTypeName=function(t){if(null==t)return"Any";switch(t){case Boolean:return"Boolean";case Number:return"Number";case String:return"String";case Object:return"Object";case Date:return"Date";default:throw e.error.argumentInvalid("valueType","Invalid valueType function: '{0}'.",[t])}},e.type("cdo.ComplexType").init(function(t,i){if(this._dims={},this._dimsList=[],this._dimsNames=[],this._calculations=[],this._calculatedDimNames={},this._dimsIndexByName=null,this._dimsByGroup={},this._dimsNamesByGroup={},this.format=Ke(null,e.get(i,"formatProto")),this.nullNumberAtom=new Ie.NumberAtom(this,null),t)for(var n in t)this.addDimension(n,t[n])}).add({describe:function(){var t=e.textTable(2).rowSep().row("Dimension","Properties").rowSep();return this._dimsList.forEach(function(e){var i=[];i.push('"'+e.label+'"'),i.push(e.valueTypeName),e.isComparable&&i.push("comparable"),e.isDiscrete||i.push("continuous"),e.isHidden&&i.push("hidden"),t.row(e.name,i.join(", "))}),t.rowSep(!0),"COMPLEX TYPE INFORMATION\n"+t()+"\n"},dimensions:function(t,i){if(null==t)return this._dims;var n=e.getOwn(this._dims,t,null);if(!n&&e.get(i,"assertExists",!0))throw e.error.argumentInvalid("name","Undefined dimension '{0}'",[t]);return n},filterExtensionDimensionNames:function(t){return t.filter(function(t){return!!e.hasOwn(this,t)},this._dims)},dimensionsList:function(){return this._dimsList},calculatedDimensionsList:function(){return this._calcDimsList},dimensionsNames:function(){return this._dimsNames},groupDimensions:function(t,i){var n=e.getOwn(this._dimsByGroup,t);if(!n&&e.get(i,"assertExists",!0))throw e.error.operationInvalid("There is no dimension type group with name '{0}'.",[t]);return n},groupDimensionsNames:function(t,i){var n=e.getOwn(this._dimsNamesByGroup,t);if(!n&&e.get(i,"assertExists",!0))throw e.error.operationInvalid("There is no dimension type group with name '{0}'.",[t]);return n},addDimension:function(t,i){t||e.fail.argumentRequired("name"),!e.hasOwn(this._dims,t)||e.fail.operationInvalid("A dimension type with name '{0}' is already defined.",[t]);var n=new Ie.DimensionType(this,t,i);this._dims[t]=n,this._dimsIndexByName=null;var s,r=n.group;if(r){var a,o=e.getOwn(this._dimsByGroup,r);o?a=this._dimsNamesByGroup[r]:(o=this._dimsByGroup[r]=[],a=this._dimsNamesByGroup[r]=[]),s=e.array.insert(a,t,e.compare),s=~s,e.array.insertAt(o,s,n)}var l,u=this._dimsList.length;if(r){s=n.groupLevel;for(var h=0;h<u;h++){var c=this._dimsList[h];if(c.group===r){if(c.groupLevel>s){l=h;break}l=h+1}}null==l&&(l=u)}else l=u;return e.array.insertAt(this._dimsList,l,n),e.array.insertAt(this._dimsNames,l,t),n._calculate&&(l=e.array.binarySearch(this._calcDimsList,n._calculationOrder,e.compare,function(e){return e._calculationOrder}),l>=0?l++:l=~l,e.array.insertAt(this._calcDimsList,l,n)),n},addCalculation:function(t){t||e.fail.argumentRequired("calcSpec");var i=t.calculation||e.fail.argumentRequired("calculations[i].calculation"),n=t.names;if((n=e.string.is(n)?n.split(/\s*\,\s*/):e.array.as(n))&&n.length){var s=this._calculatedDimNames;n.forEach(function(t){if(t){t=t.replace(/^\s*(.+?)\s*$/,"$1"),!e.hasOwn(s,t)||e.fail.argumentInvalid("calculations[i].names","Dimension name '{0}' is already being calculated.",[t]);var i=this._dims[t]||e.fail.argumentInvalid("calculations[i].names","Undefined dimension with name '{0}'' ",[t]);s[t]=!0,i._toCalculated()}},this)}this._calculations.push(i)},isCalculated:function(t){return e.hasOwn(this._calculatedDimNames,t)},_calculate:function(e){var t=this._calculations,i=t.length;if(i){for(var n={},s=0;s<i;s++)(0,t[s])(e,n);return n}},sortDimensionNames:function(t,i){var n=this._dimsIndexByName;return n||(n=e.query(this._dimsList).object({name:function(e){return e.name},value:function(e,t){return t}}),this._dimsIndexByName=n),t.sort(function(t,s){return e.compare(n[i?i(t):t],n[i?i(s):s])}),t}}),e.type("cdo.ComplexTypeProject").init(function(e){this._dims={},this._dimList=[],this._dimGroupsDims={},this._dimGroupSpecs=e||{},this._calcList=[]}).add({_ensureDim:function(t,i){t||e.fail.argumentInvalid("name","Invalid dimension name '{0}'.",[t]);var n=e.getOwn(this._dims,t);if(n)i&&e.setUDefaults(n.spec,i);else{n=this._dims[t]=this._createDim(t,i),this._dimList.push(n);var s=e.array.lazy(this._dimGroupsDims,n.groupName);e.array.insert(s,t,e.compare)}return n},hasDim:function(t){return e.hasOwn(this._dims,t)},setDim:function(t,i){var n=this._ensureDim(t).spec;return i&&e.copy(n,i),this},setDimDefaults:function(t,i){return e.setUDefaults(this._ensureDim(t).spec,i),this},_createDim:function(t,i){var n=Ie.DimensionType.dimensionGroupName(t),s=this._dimGroupSpecs[n];return s&&(i=e.create(s,i)),{name:t,groupName:n,spec:i||{}}},readDim:function(t,i){var n=this._ensureDim(t,i);if(n.isRead)throw e.error.operationInvalid("Dimension '{0}' already is the target of a reader.",[t]);if(n.isCalc)throw e.error.operationInvalid("Dimension '{0}' is being calculated, so it cannot be the target of a reader.",[t]);n.isRead=!0},calcDim:function(t,i){var n=this._ensureDim(t,i);if(n.isCalc)throw e.error.operationInvalid("Dimension '{0}' already is being calculated.",[t]);if(n.isRead)throw e.error.operationInvalid("Dimension '{0}' is the target of a reader, so it cannot be calculated.",[t]);n.isCalc=!0},isReadOrCalc:function(t){if(t){var i=e.getOwn(this._dims,t);if(i)return i.isRead||i.isCalc}return!1},groupDimensionsNames:function(e){return this._dimGroupsDims[e]},setCalc:function(t){t||e.fail.argumentRequired("calculations[i]"),t.calculation||e.fail.argumentRequired("calculations[i].calculation");var i=t.names;i=e.string.is(i)?i.split(/\s*\,\s*/):e.array.as(i),i&&i.length&&i.forEach(this.calcDim,this),this._calcList.push(t)},configureComplexType:function(e,t){this._dimList.forEach(function(i){var n=i.name,s=i.spec;s=this._extendSpec(n,s,t),e.addDimension(n,s)},this),this._calcList.forEach(function(t){e.addCalculation(t)})},_extendSpec:function(t,i,n){var s=Ie.DimensionType.dimensionGroupName(t);switch(i||(i={}),s){case"category":e.get(n,"isCategoryTimeSeries",!1)&&void 0===i.valueType&&(i.valueType=Date);break;case"value":void 0===i.valueType&&(i.valueType=Number)}return void 0!==i.converter||i.valueType!==Date||i.rawFormat||(i.rawFormat=e.get(n,"timeSeriesFormat")),i.formatProto=e.get(n,"formatProto"),i}}),e.type("cdo.Atom").init(function(t,i,n,s,r){this.dimension=t,this.id=null==i?-e.nextId():e.nextId(),this.value=i,this._label=null==n?null:n,void 0!==s&&(this.rawValue=s),this.key=r}).add({isVirtual:!1,rawValue:void 0,get label(){var e=this._label;return null===e&&(this._label=e=this.dimension.format(this.value,this.rawValue)),e},set label(t){this._label=e.string.to(t)},get labelPercent(){return this.dimension.type.format().percent()(this.value)},toString:function(){var e=this.label;return null!=e?e:(e=this.value,null!=e?""+e:"")}}),e.type("cdo.NumberAtom").init(function(t,i,n){this.complexType=t,this.id=e.nextId(),this.value=null==i?null:i,this._label=null==n?null:n,this.key=null==i?"":i.toString()}).add({dimension:null,get key(){return""+this.value},get rawValue(){return this.value},get label(){var e=this._label;return null===e&&(this._label=e=this.complexType.format.number()(this.value,this.rawValue)),e},set label(t){this._label=e.string.to(t)},get labelPercent(){return this.complexType.format.percent()(this.value)}});var Ae=1;e.type("cdo.Complex").init(function(t,i,n,s,r,a){this.id=Ae++,s||(s=null);var o;t?(o=t.owner,null===s&&(s=t.atoms)):o=this,this.owner=o,this.atoms=s?Object.create(s):{};var l=!!n;if(n||(n=o.type._dimsNames),i){var u,h=this.atoms,c=o._dimensions,m=function(t){var n=i[t],r=c[t];if(void 0===r){if(!l)throw e.error.operationInvalid("Extension atom values require dimension names to be specified.");if(!(n instanceof Ie.Atom))throw e.error.operationInvalid("Extension atom values must be cdo.Atom instances.");h[t]=n}else n=r.intern(n),null==n.value||null!==s&&n===s[t]||(h[t]=n)};if(l)for(var d=-1,f=n.length;++d<f;)m(n[d]);else for(u in i)m(u);if(a){i=o.type._calculate(this);for(u in i)e.hasOwnProp.call(h,u)||m(u)}}this._initValueKeyLabel(n,r)}).add({labelSep:" ~ ",keySep:"~",value:null,label:null,rawValue:void 0,_initValueKeyLabel:function(e,t){var i,n=e.length;if(0===n)this.key="",this.value=null,t&&(this.label="");else if(1===n)i=this.atoms[e[0]],this.key=this._getAtomKey(i),this.value=i.value,this.rawValue=i.rawValue,t&&(this.label=i.label);else{for(var s,r,a,o="",l=this.owner.keySep,u=this.owner.labelSep,h=this.atoms,c="",m=-1;++m<n;)i=h[e[m]],0===m?s=i.key:s+=l+i.key,r=this._getAtomKey(i),null!==r&&(0===m?o=r:o+=l+r),t&&""!==(a=i.label)&&(""===c?c=a:c+=u+a);this.value=this.rawValue=s,this.key=o,t&&(this.label=c)}},_getAtomKey:function(e){return e.key},getSpecifiedAtom:function(e){return this.atoms[e]},ensureLabel:function(){var t=this.label;if(null==t){t="";var i=this.owner.labelSep;e.eachOwn(this.atoms,function(e){var n=e.label;n&&(t?t+=i+n:t=n)}),this.label=t}return t},view:function(e){return new Ie.ComplexView(this,e)},toString:function(){var t=[""+e.qualNameOf(this.constructor)];return null!=this.index&&t.push("#"+this.index),this.owner.type.dimensionsNames().forEach(function(i){t.push(i+": "+e.describe(this.atoms[i].value))},this),t.join(" ")},rightTrimKeySep:function(e){return e&&Ie.Complex.rightTrimKeySep(e,this.owner.keySep)},absKeyTrimmed:function(){return this.rightTrimKeySep(this.absKey)},keyTrimmed:function(){return this.rightTrimKeySep(this.key)}}),Ie.Complex.rightTrimKeySep=function(e,t){if(e&&t)for(var i,n=t.length;e.lastIndexOf(t)===(i=e.length-n)&&i>=0;)e=e.substr(0,i);return e},Ie.Complex.values=function(e,t){var i=e.atoms;return t.map(function(e){return i[e].value})},Ie.Complex.compositeKey=function(e,t){for(var i="",n=t.length,s=e.owner.keySep,r=e.atoms,a=0;a<n;a++){var o=r[t[a]].key;a?i+=s+o:i=o}return i},Ie.Complex.labels=function(e,t){var i=e.atoms;return t.map(function(e){return i[e].label})};var Te=e.propGet("id");e.type("cdo.ComplexView",Ie.Complex).init(function(e,t){this.source=e,this.viewDimNames=t,this.base(e,e.atoms,t,e.owner.atoms,!0)}).add({values:function(){return Ie.Complex.values(this,this.viewDimNames)},labels:function(){return Ie.Complex.labels(this,this.viewDimNames)}}),e.type("cdo.Datum",Ie.Complex).init(function(e,t,i){this.base(e,t,i,null,!1,!0),this.key||(this.key=this.id)}).add({isSelected:!1,isVisible:!0,isNull:!1,isVirtual:!1,isTrend:!1,trend:null,isInterpolated:!1,interpolation:null,_getAtomKey:function(e){return e.dimension.isKey?e.key:null},setSelected:function(e){if(this.isNull)return!1;e=null==e||!!e;var t=this.isSelected!==e;return t&&(e?this.isSelected=!0:delete this.isSelected,G.call(this.owner,this,e)),t},toggleSelected:function(){return this.setSelected(!this.isSelected)},setVisible:function(e){if(this.isNull)return!1;e=null==e||!!e;var t=this.isVisible!==e;return t&&(this.isVisible=e,P.call(this.owner,this,e)),t},toggleVisible:function(){return this.setVisible(!this.isVisible)}});var ke=Ie.Datum.isSelected=e.propGet("isSelected");Ie.Datum.isSelectedT=h,Ie.Datum.isSelectedF=c,Ie.Datum.isVisibleT=m,Ie.Datum.isVisibleF=d,Ie.Datum.isNullT=f,Ie.Datum.isNullF=p,e.type("cdo.TrendDatum",Ie.Datum).init(function(e,t,i,n){this.base(e,t,i),this.trend=n}).add({isVirtual:!0,isTrend:!0}),e.type("cdo.InterpolationDatum",Ie.Datum).init(function(e,t,i,n,s){this.base(e,t,i),this.interpolation=n,this.interpDimName=s}).add({isVirtual:!0,isInterpolated:!0});var Oe={abs:!0};e.type("cdo.Dimension").init(function(t,i){this.data=t,this.type=i,this.root=this,this.owner=this;var n=i.name;if(this.name=n,this._atomComparer=i.atomComparer(),this._atomsByKey={},this.isKey=i.isKey,t.isOwner())this._atoms=[],this._lazyInit=null,b.call(this);else{var s,r=t.parent;r?(s=r._dimensions[n],x.call(s,this),this.root=t.parent.root):(r=t.linkParent,r||e.assert("Data must have a linkParent"),s=r._dimensions[n],S.call(s,this)),this._nullAtom=this.owner._nullAtom,this._lazyInit=function(){this._lazyInit=null;for(var t=this.data._datums,r=t.length,a=this._atomsByKey,o=i.isDiscrete,l=0;l<r;l++){var u=t[l];if(o||!u.isNull){var h=u.atoms[n];a[h.key]=h}}this._atoms=s.atoms().filter(function(t){return e.hasOwnProp.call(a,t.key)})}}}).add({parent:null,linkParent:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:!1,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){return null!==this._lazyInit&&this._lazyInit(),this._atoms.length},isVisible:function(t){return null!==this._lazyInit&&this._lazyInit(),e.hasOwn(this._atomsByKey,t.key)||e.assert("Atom must exist in this dimension."),I.call(this)[t.key]>0},atoms:function(t){null!==this._lazyInit&&this._lazyInit();var i=e.get(t,"visible");return null==i?this._atoms:(i=!!i,this._visibleAtoms||(this._visibleAtoms={}),this._visibleAtoms[i]||(this._visibleAtoms[i]=T.call(this,i)))},indexes:function(i){null!==this._lazyInit&&this._lazyInit();var n=e.get(i,"visible");return null==n?t.range(0,this._atoms.length):(n=!!n,this._visibleIndexes||(this._visibleIndexes={}),this._visibleIndexes[n]||(this._visibleIndexes[n]=A.call(this,n)))},atom:function(e){if(null==e||""===e)return this._nullAtom;if(e instanceof Ie.Atom)return e;null!==this._lazyInit&&this._lazyInit();var t=this.type._key,i=t?t.call(null,e):e;return this._atomsByKey[i]||null},
getDistinctAtoms:function(e){var t,i,n,s=[],r=e?e.length:0;if(r){n={};for(var a=0;a<r;a++)(t=this.atom(e[a]))&&!n[i="\0"+t.key]&&(n[i]=t,s.push(t))}return s},extent:function(t){var i,n=this.atoms(t),s=n.length;if(s){var r=this._nullAtom&&null==n[0].value?1:0,a=s-r;if(a>0){var o=n[r],l=n[s-1];if(o!==l&&e.get(t,"abs",!1)){var u=o.value<0?-1:1,h=l.value<0?-1:1;if(u===h)h<0&&(i=l,l=o,o=i);else if(a>2){l.value<-o.value&&(l=o);var c=e.array.binarySearch(n,0,this.type.comparer(),function(e){return e.value});if(c<0){c=~c;var m=n[c-1],d=n[c];o=-m.value<d.value?m:d}else o=n[c]}else l.value<-o.value&&(i=l,l=o,o=i)}return{min:o,max:l}}}},min:function(e){var t=this.atoms(e),i=t.length;if(i){var n=this._nullAtom&&null==t[0].value?1:0;return i>n?t[n]:void 0}},max:function(e){var t=this.atoms(e),i=t.length;return i&&null!=t[i-1].value?t[i-1]:void 0},sumAbs:function(e){return this.sumAbsAtom(e).value},value:function(e){return this.valueAtom(e).value},valueAbs:function(e){return this.valueAbsAtom(e).value},sum:function(e){return this.sumAtom(e).value},sumAtom:function(t){var i=!!e.get(t,"abs",!1),n=e.get(t,"zeroIfNone",!0),s=_(t)+":"+i,r=e.getOwn(this._sumCache,s);if(void 0===r){var a=this.name,o=this.data.datums(null,t).reduce(function(e,t){if(t.isNull)return e;var n=t.atoms[a].value;return null===n?e:(i&&n<0&&(n=-n),null!=e?e+n:n)},null);(this._sumCache||(this._sumCache={}))[s]=r=this.read(o)}return n&&null===r.value?this.read(0):r},sumAbsAtom:function(t){return t=t?e.create(t,Oe):Oe,this.sumAtom(t)},valueAtom:function(e){return this.sumAtom(e)},valueAbsAtom:function(e){var t=this.valueAtom(e);return t.value<0?this.read(-t.value):t},percent:function(e,t){var i=e instanceof Ie.Atom?e.value:e;if(!i)return 0;var n=this.sumAbs(t);return n?Math.abs(i)/n:0},valuePercent:function(e){var t=this.valueAbs(e);if(!t)return 0;var i=this.data.parent;return i?t/i.dimensionsSumAbs(this.name,e):1},percentOverParent:function(e){return this.valuePercent(e)},format:function(t,i){return e.string.to(this.type._formatter?this.type._formatter.call(null,t,i):t)},intern:function(e,t){return this._read(e,!0,t)},read:function(e){return this._read(e,!1)},_read:function(t,i,n){var s,r;if(null==t||""===t)return this._nullAtom||(i?y.call(this):this.owner._virtualNullAtom);if("object"==typeof t){if(t instanceof Ie.Atom){if(t.dimension!==this)throw e.error.operationInvalid("Atom is of a different dimension.");return t}if("v"in t&&(r=t.f,null==(t=t.v)||""===t))return this._nullAtom||(i?y.call(this,r):this.owner._virtualNullAtom)}var a,o=this.type;if(n||null===(a=o._converter))s=t;else if(null==(s=a(t))||""===s)return this._nullAtom||(i?y.call(this):this.owner._virtualNullAtom);if(null!==(a=o.cast)&&(null==(s=a(s))||""===s))return this._nullAtom||(i?y.call(this):this.owner._virtualNullAtom);var l=""+(null!==(a=o._key)?a(s):s);if(0===l.length)throw e.error.operationInvalid("Only a null value can have an empty key.");var u;return i?(null!==this._lazyInit&&this._lazyInit(),void 0!==(u=this._atomsByKey[l])?(i&&!n&&u.isVirtual&&delete u.isVirtual,u):g.call(this,t,l,s,r,n)):void 0!==(u=this.owner._atomsByKey[l])?u:new Ie.Atom(this,s,r,t,l)},dispose:function(){var e,t=this;t._disposed||(i(t.childNodes,"parent"),i(t._linkChildren,"linkParent"),(e=t.parent)&&s(e,"childNodes",t,"parent"),(e=t.linkParent)&&s(e,"_linkChildren",t,"linkParent"),w.call(t),t._lazyInit=t._atoms=t._nullAtom=t._virtualNullAtom=null,t._disposed=!0)}}),e.type("cdo.Data",Ie.Complex).init(function(i){if(null==i)throw e.error.argumentRequired("keyArgs");this._visibleNotNullDatums=new e.Map;var n,s,r,a,o,l,u=null,h=null,c=this.parent=i.parent||null;if(c)this.root=c.root,this.depth=c.depth+1,this.type=c.type,n=c.owner,u=i.datums||e.fail.argumentRequired("datums"),h=i.atoms||e.fail.argumentRequired("atoms"),a=i.atomsDimNames||e.fail.argumentRequired("atomsDimNames"),r=c.atoms,l=i.extensionDatums||c.extensionDatums,s=Object.create(c.atomsIsSet),a.forEach(function(e){s[e]=!0});else{this.root=this,a=[];var m=i.linkParent||null;m?(n=m.owner,this.type=n.type,u=i.datums||e.fail.argumentRequired("datums"),this._leafs=[],r=i.atomsBase||m.atoms,s=i.atomsBaseIsSet||Object.create(m.atomsIsSet),l=i.extensionDatums||m.extensionDatums,o=e.get(i,"index",null),O.call(m,this,o)):(n=this,this.type=i.type||e.fail.argumentRequired("type"),r={},s={},i.labelSep&&(this.labelSep=i.labelSep),i.keySep&&(this.keySep=i.keySep),this._selectedNotNullDatums=new e.Map)}this.owner=n,this._datums=[],this._datumsById={},this._datumsByKey={},null!==u&&this._addDatumsLocal(u),this._atomsBase=r,this.atomsIsSet=s,this.extensionDatums=l||null,this._dimensions={},this._dimensionsList=[],this.type.dimensionsList().forEach(this._initDimension,this),this.base(n,h,a,r,!0),t.Dom.Node.call(this),c?(o=e.get(i,"index",null),k.call(c,this,o),this.absKey=c.absKey?e.string.join(n.keySep,c.absKey,this.key):this.key,this.absLabel=c.absLabel?e.string.join(n.labelSep,c.absLabel,this.label):this.label):(this.absKey=this.key,this.absLabel=this.label)}).add(t.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_dimensionsList:null,_freeDimensionNames:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_visibleNotNullDatums:null,_selectedNotNullDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_datums:null,_datumsById:null,_datumsByKey:null,depth:0,label:"",absLabel:"",_disposed:!1,_isFlattenGroup:!1,_isDegenerateFlattenGroup:!1,_initDimension:function(e){var t=new Ie.Dimension(this,e);this._dimensions[e.name]=t,this._dimensionsList.push(t)},dimensions:function(t,i){if(null==t)return this._dimensions;var n=e.getOwn(this._dimensions,t);if(!n&&e.get(i,"assertExists",!0))throw e.error.argumentInvalid("name","Undefined dimension '{0}'.",[t]);return n},dimensionsList:function(){return this._dimensionsList},getSpecifiedAtom:function(e){return!0===this.atomsIsSet[e]?this.atoms[e]:null},freeDimensionsNames:function(){var e=this._freeDimensionNames;return e||(this._freeDimensionNames=e=this.type.dimensionsNames().filter(function(e){var t=this.atoms[e];return!(t instanceof Ie.Atom)||null==t.value},this)),e},isOwner:function(){return this.owner===this},children:function(){var t=this.childNodes;return t.length>0?e.query(t):e.query()},child:function(t){return e.getOwn(this._childrenByKey,t,null)},childCount:function(){return this.childNodes.length},contains:function(t){return e.hasOwn(this._datumsById,t.id)},datumByKey:function(t){return e.getOwn(this._datumsByKey,t,null)},leafs:function(){return e.query(this._leafs)},count:function(){return this._datums.length},firstDatum:function(){return this._datums.length>0?this._datums[0]:null},firstAtoms:function(){return(this.firstDatum()||this).atoms},singleDatum:function(){var e=this._datums;return 1===e.length?e[0]:null},dispose:function(){var e=this;if(!e._disposed){L.call(e);var t;(t=e._selectedNotNullDatums)&&t.clear(),e._visibleNotNullDatums.clear(),t=e._dimensionsList;for(var i=0,n=t.length;i<n;i++)t[i].dispose();e._dimensions=null,e._dimensionsList=null,(t=e.parent)&&(t.removeChild(e),e.parent=null),(t=e.linkParent)&&R.call(t,e),e._disposed=!0}},disposeChildren:function(){L.call(this)}}),Ie.Data.add({selectedCount:function(){return this.isOwner()?this._selectedNotNullDatums.count:this.datums(null,{selected:!0}).count()},selectedDatums:function(){return this.isOwner()?this._selectedNotNullDatums.values():this.datums(null,{selected:!0}).array()},selectedDatumMap:function(){if(this.isOwner())return this._selectedNotNullDatums.clone();var t=this.datums(null,{selected:!0}).object({name:e.propGet("id")});return new e.Set(t)},visibleCount:function(){return this._visibleNotNullDatums.count},replaceSelected:function(t){e.array.is(t)||(t=t.array());var i=e.query(t).where(ke).object({name:Te}),n=this.owner.clearSelected(function(t){return!e.hasOwn(i,t.id)});return n|=Ie.Data.setSelected(t,!0)},clearSelected:function(e){if(this.owner!==this)return this.owner.clearSelected(e);if(!this._selectedNotNullDatums.count)return!1;var t;return e?(t=!1,this._selectedNotNullDatums.values().filter(e).forEach(function(e){t=!0,l.call(e),this._selectedNotNullDatums.rem(e.id)},this)):(t=!0,this._selectedNotNullDatums.values().forEach(function(e){l.call(e)}),this._selectedNotNullDatums.clear()),t}}),Ie.Data.setSelected=function(t,i){var n=0;return t&&e.query(t).each(function(e){n|=e.setSelected(i)}),!!n},Ie.Data.toggleSelected=function(t,i){e.array.isLike(t)||(t=e.query(t).array());var n=e.query(t),s=i?n.any(ke):n.all(u);return this.setSelected(t,!s)},Ie.Data.setVisible=function(t,i){var n=0;return t&&e.query(t).each(function(e){n|=e.setVisible(i)}),!!n},Ie.Data.toggleVisible=function(t){e.array.isLike(t)||(t=e.query(t).array());var i=e.query(t).all(e.propGet("isVisible"));return Ie.Data.setVisible(t,!i)},Ie.Data.add({select:null,load:function(t,i){M.call(this);var n=e.get(i,"where"),s=e.get(i,"isNull"),r=e.get(i,"isAdditive",!1),a=e.query(t).select(function(e){var t=new Ie.Datum(this,e);return s&&s(t)&&(t.isNull=!0),n&&!n(t)?null:t},this);j.call(this,a,{isAdditive:r,doAtomGC:!0})},clearVirtuals:function(){var t=this._datums,i=t.length;if(i>0){this._sumAbsCache=null;for(var n,s=0;s<i;){var r=t[s];r.isVirtual?(K.call(this,r),i--,n=!0):s++}if(n){if(!t.length&&this.parent)return void this.dispose();var a=this.childNodes;if(a)for(s=0,i=a.length;s<i;){var o=a[s];o.clearVirtuals(),o.parent?s++:i--}this._linkChildren&&this._linkChildren.forEach(function(e){e.clearVirtuals()})}}e.eachOwn(this._dimensions,function(e){N.call(e)})},add:function(e){M.call(this),j.call(this,e,{isAdditive:!0,doAtomGC:!0})},_addDatumsSimple:function(e){this._addDatumsLocal(e),this._onDatumsAdded(e)},_onDatumsAdded:function(e){var t=this._linkChildren;if(t)for(var i=-1,n=t.length;++i<n;)t[i]._addDatumsSimple(e)},_addDatumsLocal:function(e){var t=this._datums,i=this._visibleNotNullDatums,n=this._selectedNotNullDatums,s=this._datumsById,r=this._datumsByKey,a=!!this._dimensions;this._sumAbsCache=null;for(var o=-1,l=e.length;++o<l;){var u=e[o],h=u.id;void 0===s[h]&&(t.push(u),s[h]=u,r[u.key]=u,a&&E.call(this,u,!0,!1),u.isNull||(n&&u.isSelected&&n.set(h,u),u.isVisible&&i.set(h,u)))}},groupBy:function(t,i){var n,s,r=new Ie.GroupingOper(this,t,i),a=r.key;return a&&(n=this._groupByCache,s=n&&n[a]),s?e.debug>=7&&e.log("[GroupBy] Cache key hit '"+a+"'"):(e.debug>=7&&e.log("[GroupBy] "+(a?"Cache key not found : '"+a+"' on '"+this.id+"'":"No Cache key")),s=r.execute(),a&&((n||(this._groupByCache={}))[a]=s)),s},where:function(t,i){var n=t&&F.call(this,t),s=this._datums;s.length>0&&(n?s=H.call(this,n,i).array():i&&(s=z(e.query(s),i).array()));var r=(n||i)&&U(n,i);return new Ie.FilteredData({linkParent:this,datums:s,where:r})},datums:function(t,i){if(0===this._datums.length)return e.query();if(!t)return i?z(e.query(this._datums),i):e.query(this._datums);var n=F.call(this,t);return H.call(this,n,i)},datum:function(e,t){return this.datums(e,t).first()||null},dimensionsSumAbs:function(e,t){var i=this.dimensionNumberValue(e,t).value;return null!==i&&i<0?-i:i},dimensionNumberValue:function(e,t){var i=this._createDimensionOperArgs(e,t);return this._dimensionNumberValue(i)},_createDimensionOperArgs:function(t,i){var n,s,r=null;"function"==typeof t?(n=t,s=e.get(i,"discrimPossibleDims")||null,null!==(r=e.get(i,"discrimKey")||null)&&(r="discrim:"+r)):(n=e.fun.constant(t),s=[t],r=t);var a=null;return null!==r&&(a=r+":"+_(i)+":"+(s||[]).join("|")),{discrimFun:n,discrimPossibleDimNames:s,cacheKey:a,keyArgs:i}},_dimensionNumberValue:function(t){var i,n=t.cacheKey;return null!==n&&void 0!==(i=e.getOwn(this._sumAbsCache,n))||(i=this._dimensionNumberValueCore(t),null!==n&&((this._sumAbsCache||(this._sumAbsCache={}))[n]=i)),i},_dimensionNumberValueCore:function(t){var i,n=t.discrimFun(this,null!==t.discrimPossibleDimNames);if(0===this.childCount()){if(null!==n)return this.dimensions(n).valueAtom(t.keyArgs);i=e.query(t.discrimPossibleDimNames).select(function(e){return this.dimensions(e).valueAbsAtom(t.keyArgs).value},this).reduce(e.addPreservingNull,null)}else i=this.children().where(function(e){return!e._isFlattenGroup||e._isDegenerateFlattenGroup}).select(function(e){var i=e._dimensionNumberValue(t).value;return null!==i&&i<0?-i:i}).reduce(e.addPreservingNull,null);return null!==n?this.dimensions(n).read(i):null===i?this.type.nullNumberAtom:new Ie.NumberAtom(this.type,i)},dimensionPercentValue:function(e,t){function i(e){return null===a?new Ie.NumberAtom(this.type,e):a.read(e)}var n=this._createDimensionOperArgs(e,t),s=this._dimensionNumberValue(n),r=s.value;if(null===r)return s;var a=s.dimension;if(0===r)return i.call(this,0);var o=this.parent;if(null===o)return i.call(this,1);var l=o._dimensionNumberValue(n);return i.call(this,Math.abs(r)/l.value)}}).type().add({lca:function(e){var t,i,n,s=e.length,r=null;if(s){if(1===s)return e[0];var a=1;i=B(e[0]);do{if(t=e[a],n=B(t),!(r=V(i,n)))return null;i=n}while(++a<s)}return r}}),Ie.querySpecPredicate=Q,e.type("cdo.FilteredData",Ie.Data).init(function(t){if(null==t||null!=t.parent||null==t.linkParent)throw e.error.argumentRequired("keyArgs.linkParent");this.base(t),this._wherePred=t.where||e.fail.argumentRequired("keyArgs.where")}).add({_addDatumsSimple:function(e){e=e.filter(this._wherePred),this.base(e)}}),e.type("cdo.GroupingData",Ie.Data).init(function(t){if(null==t)throw e.error.argumentRequired("keyArgs");this.base(t),this.groupingOper=t.groupingOper||e.fail.argumentRequired("keyArgs.groupingOper"),this.groupingSpec=t.groupingSpec||null,this.groupingLevelSpec=t.groupingLevelSpec||null}),e.type("cdo.GroupingRootData",Ie.GroupingData).init(function(t){if(null==t||null!=t.parent||null==t.linkParent)throw e.error.argumentRequired("keyArgs.linkParent");var i=t.groupingSpec;if(null==i)throw e.error.argumentRequired("keyArgs.groupingSpec");var n=t.groupingOper;if(n&&i.hasExtensionComplexTypes){t=Object.create(t);var s=t.atomsBase=Object.create(t.linkParent.atoms),r=n._extensionDataSetsMap;i.extensionDimensions().each(function(e){void 0===s[e.fullName]&&(s[e.fullName]=r[e.dataSetName].owner.atoms[e.name])})}this.base(t)}).add({_addDatumsSimple:function(e){e=this.groupingOper.executeAdd(this,e),this._onDatumsAdded(e)}}),e.type("cdo.GroupData",Ie.GroupingData).init(function(t){if(null==t||null==t.parent)throw e.error.argumentRequired("keyArgs.parent");this.base(t)}),Ie.Data.add({getInfo:function(){var t=["DATA SUMMARY",e.logSeparator,"  Dimension",e.logSeparator];return e.eachOwn(this.dimensions(),function(e,i){var n=e.count(),s=e.type,r=[];r.push(),r.push(s.valueTypeName),s.isComparable&&r.push("comparable"),s.isDiscrete||r.push("continuous"),s.isHidden&&r.push("hidden"),t.push("  "+i+' ("'+s.label+'", #'+n+")\n\t"+e.atoms().slice(0,10).map(function(e){return e.label}).join(", ")+(n>10?"...":""))}),t.join("\n")},getValues:function(){return t.range(0,this.getCategoriesSize()).map(function(e){return this._getValuesForCategoryIndex(e)},this)},_getDimensionValues:function(e){return this.dimensions(e).atoms().map(function(e){return e.value})},_getDimensionVisibleValues:function(e){return this.dimensions(e).atoms({visible:!0}).map(function(e){return e.value})},getSeries:function(){return this._getDimensionValues("series")},getVisibleSeriesIndexes:function(){return this.dimensions("series").indexes({visible:!0})},getVisibleCategoriesIndexes:function(){return this.dimensions("category").indexes({visible:!0})},getVisibleSeries:function(){return this._getDimensionVisibleValues("series")},getCategories:function(){return this._getDimensionValues("category")},getVisibleCategories:function(){return this._getDimensionVisibleValues("category")},_getValuesForCategoryIndex:function(t){var i=this.dimensions("category").atoms()[t],n=this.datums({category:i}).uniqueIndex(function(e){return e.atoms.series.key});return this.dimensions("series").atoms().map(function(t){var i=e.getOwn(n,t.key);return i?i.atoms.value.value:null})},getSeriesSize:function(){var e=this.dimensions("series",{assertExists:!1});return e?e.count():0},getCategoriesSize:function(){var e=this.dimensions("category",{assertExists:!1});return e?e.count():0}}),e.type("cdo.DataOper").init(function(t,i){t||e.fail.argumentRequired("linkParent"),this._linkParent=t}).add({key:null,execute:e.abstractMethod}),e.type("cdo.GroupingOper",Ie.DataOper).init(function(t,i,n){if(i||e.fail.argumentRequired("groupingSpecs"),i=e.array.as(i),0===i.length)throw e.error.argumentRequired("groupingSpecText");e.get(n,"inverted",!1)&&(i=i.slice().reverse()),this.base(t,n);var s=e.get(n,"where"),r=s&&e.get(n,"whereKey")||"",a=e.get(n,"visible",null),o=e.get(n,"selected",null);this._preFilter=U(null,{visible:a,selected:o,where:s});var l=e.get(n,"isNull",null);this._postFilter=U(null,{isNull:l});var u=null==o&&!(s&&!r),h=u?[]:null,c="",m=null,d=e.get(n,"extensionDataSetsMap",null),f=e.get(n,"reverse",!1);this._groupSpecs=i.map(function(i){if(i instanceof Ie.GroupingSpec){if(i.complexType!==t.type)throw e.error.argumentInvalid("groupingSpecText","Invalid associated complex type.")}else i=Ie.GroupingSpec.parse(i,t.type);if(i.isNull)throw e.error.argumentInvalid("groupingSpecText","Null grouping specification.");return i.flatteningMode===Ie.FlatteningMode.SingleLevel&&(i=i.toSingleLevel()),f&&(i=i.reverse()),u&&h.push(i.key),null!==i.extensionComplexTypeNames&&i.extensionComplexTypeNames.forEach(function(t){var i;if(null===d||!(i=d[t]))throw e.error.operationInvalid("Grouping specification requires extension data set '{0}'.",[t]);null===m&&(m=Object.create(null)),m[t]=i,u&&(c+=t+":"+i.id+";")}),i}),this._extensionDataSetsMap=m,u&&(this.key=h.join("!!")+":"+[a,l,r,c].join(":"))}).add({_getExtensionDatumsMap:function(){var t=null,i=this._extensionDataSetsMap;if(i){t=Object.create(null);var n=this._linkParent.extensionDatums;if(e.query(Object.keys(i)).each(function(e){var s=i[e],r=s._datums;if(0===r.length)return!1;if(null!==n){var a=n[e];a&&(r=a.filter(function(e){return r.indexOf(e)>=0}))}if(0===r.length)return!1;t[e]=r}))return!1}return t},execute:function(){var t=this._linkParent._datums,i=e.query(t).where(this._preFilter),n=this._group(i);return this._generateData(n,null,this._linkParent,null)},executeAdd:function(t,i){var n=e.query(i).where(this._preFilter),s=this._group(n);return this._generateData(s,null,this._linkParent,t),s.datums},_group:function(t){var i={isRoot:!0,treeHeight:e.query(this._groupSpecs).select(function(e){return e.flatteningMode&Ie.FlatteningMode.Dfs?1:e.depth}).reduce(e.add,0),datums:[],datumsById:{},groupSpec:this._groupSpecs[0],groupLevelSpec:this._groupSpecs[0].levels[0]},n=this._getExtensionDatumsMap();return!1!==n&&this._groupSpecRecursive(i,e.query(t).array(),n,0),i},_groupSpecRecursive:function(e,t,i,n){var s=this._groupSpecs[n];0!=(s.flatteningMode&Ie.FlatteningMode.Dfs)?this._groupSpecRecursiveFlattened(e,t,i,s,n):this._groupSpecRecursiveNormal(e,t,i,s,n)},_groupSpecRecursiveNormal:function(e,t,i,n,s){function r(e,t,u,h){var c=a[h],m=h===o-1,d=l&&m;e.groupSpec=n,e.groupLevelSpec=c;for(var f=e.children=this._groupLevelDatums(c,e,t,u,!1),p=0,g=f.length;p<g;p++){var v=f[p];if(!d){var _=v.datums;v.datums=[],v.datumsById={},m?this._groupSpecRecursive(v,_,v.extensionDatumsMap,s+1):r.call(this,v,_,v.extensionDatumsMap,h+1)}this._addChildDatums(e.datums,e.datumsById,v.datums,i)}}var a=n.levels,o=a.length,l=s===this._groupSpecs.length-1;e.isRoot&&(e.label=n.rootLabel),r.call(this,e,t,i,0)},_addChildDatums:function(t,i,n,s){if(null===s)e.array.append(t,n);else for(var r=-1,a=n.length;++r<a;){var o=n[r];void 0===i[o.id]&&(i[o.id]=o,t.push(o))}},_groupSpecRecursiveFlattened:function(t,i,n,s,r){function a(t,i,s,d){for(var p=l[d],g=d===u-1,v=h&&g,_=this._groupLevelDatums(p,t,i,s,!0),y=h?t.datums:[],b=h?t.datumsById:{},D=0,N=_.length;D<N;D++){var w=_[D],x=w.datums;if(e.array.lazy(t,"_children").push(w),e.hasOwn(m,w.key))this._addChildDatums(y,b,x,n);else{var S=c.length;o||(f(w),t.isFlattenGroup=!0),v||(w.datums=[],w.datumsById={},g?this._groupSpecRecursive(w,x,s,r+1):a.call(this,w,x,s,d+1)),this._addChildDatums(y,b,w.datums,n),o&&(e.hasOwn(m,w.key)&&(w.isFlattenGroup||e.assert("Must be a parent for duplicate keys to exist."),1===w._children.length&&(c.splice(S,c.length-S),w.isDegenerateFlattenGroup=!0)),f(w),t.isFlattenGroup=!0)}}h||this._groupSpecRecursive(t,y,s,r+1)}var o=s.flatteningMode===Ie.FlatteningMode.DfsPost,l=s.levels,u=l.length,h=r===this._groupSpecs.length-1,c=[],m={},d={key:"",absKey:"",atoms:{},datums:[],datumsById:{},label:s.rootLabel,dimNames:[]},f=function(e){c.push(e),m[e.key]=e};t.children=c,t.childrenByKey=m,o||f(d),a.call(this,d,i,n,0),o&&f(d),t.datums=d.datums},_groupLevelDatums:function(t,i,n,s,r){function a(n,s){var a=u.call(t,n,s),o=e.hasOwnProp.call(d,a)&&d[a];o?f&&!f(n)||o.datums.push(n):(o=h.call(t,n,s),o.key=a,o.firstDatum=n,o.datums=!f||f(n)?[n]:[],o.extensionDatumsMap=s,r&&(null===p&&(p=n.owner.keySep),this._onNewChildNodeFlattened(a,p,o,t,i)),e.array.insert(m,o,c),d[a]=o)}function o(e,t){for(var i=-1,n=t.length;++i<n;)a.call(this,e,t[i])}function l(e,t,i){for(var n=_[t],r=n.dataSetName,a=s[r],o=-1,u=a.length,h=t+1,c=h>=_.length;++o<u;){var m=Object.create(i);m[r]=[a[o]],c?e.push(m):l(e,h,m)}}var u,h,c,m=[],d=Object.create(null),f=this._postFilter,p=null,g=-1,v=n.length,_=t.extensionDimensions;if(null!==_){u=t.buildKeyWithExtension,h=t.buildGroupNodeWithExtension,c=t.compareNodesWithExtension.bind(t);var y=[];for(l(y,0,s);++g<v;)o.call(this,n[g],y)}else for(u=t.buildKeyMain,h=t.buildGroupNodeMain,c=t.compareNodesMain.bind(t);++g<v;)a.call(this,n[g],s);if(f)for(g=m.length;g--;)0===m[g].datums.length&&m.splice(g,1);return m},_onNewChildNodeFlattened:function(t,i,n,s,r){if(e.copy(n.atoms,r.atoms),n.dimNames=s.accAllDimensionNames(),r.dimNames.length){var a=r.absKey+i+t;n.absKey=a,n.key=Ie.Complex.rightTrimKeySep(a,i)}else n.absKey=t},_generateData:function(t,i,n,s){var r=null,a=!1;if(t.isRoot)null!==s?(r=s,r._addDatumsLocal(t.datums)):(a=!0,r=new Ie.GroupingRootData({groupingOper:this,groupingSpec:t.groupSpec,groupingLevelSpec:t.groupLevelSpec,linkParent:n,datums:t.datums,extensionDatums:t.extensionDatumsMap}),r.treeHeight=t.treeHeight);else if(null!==s&&null!==(r=n.child(t.key))&&r._addDatumsSimple(t.datums),null===r){a=!0;var o,l=null;null!==s&&(o=n.childNodes).length>0&&(l=~e.array.binarySearch(o,t.datums[0],i.groupLevelSpec.mainDatumComparer)),r=new Ie.GroupData({groupingOper:this,groupingSpec:t.groupSpec,groupingLevelSpec:t.groupLevelSpec,parent:n,atoms:t.atoms,datums:t.datums,index:l,atomsDimNames:t.dimNames,extensionDatums:t.extensionDatumsMap})}if(a){t.isFlattenGroup&&(r._isFlattenGroup=!0,r._isDegenerateFlattenGroup=!!t.isDegenerateFlattenGroup);var u=t.label;u&&(r.label+=u,r.absLabel+=u)}var h=t.children,c=h?h.length:0;if(c>0)for(var m=-1;++m<c;)this._generateData(h[m],t,r,s);else if(a&&!t.isRoot){var d=r.root._leafs;r.leafIndex=d.length,d.push(r)}return r}}),e.space("cdo").FlatteningMode=e.makeEnum(["SingleLevel","DfsPre","DfsPost"],{zero:"None",all:"AllMask"}),Ie.FlatteningMode.Dfs=Ie.FlatteningMode.DfsPre|Ie.FlatteningMode.DfsPost,e.type("cdo.GroupingSpec").init(function(t,i,n,s){this.complexType=i||null,i=this.complexType;var r=null,a=[],o=[],l=[],u=!1,h=null;this.levels=e.query(t||void 0).where(function(e){return e.allDimensions.length>0}).select(function(e){return a.push(e.key),o.push.apply(o,e.dimensionNames()),e.allDimensions.forEach(function(e){if(e.dataSetName?(null===r&&(r=Object.create(null)),r[e.dataSetName]=!0,l.push(e.fullName)):l.push(e.name),null!==i&&!u){var t=e.dimensionType;t.isDiscrete?u=!0:null===h?h=t.valueType:h!==t.valueType&&(u=!0)}}),e._setAccAllDimNames(l.slice(0)),e}).array(),this.extensionComplexTypesMap=null,this.extensionComplexTypeNames=r&&Object.keys(r),null!==i&&r&&this._setExtensionComplexTypesMap(n),this._dimNames=o,this._allDimNames=l,this.depth=this.levels.length,this._isDiscrete=null!==i?u:void 0,this._singleContinuousValueType=null!==i?u?null:h:void 0,this.isSingleDimension=1===l.length,this.firstDimension=this.depth>0?this.levels[0].allDimensions[0]:null,this.lastDimension=this.depth>0?this.levels[this.depth-1].lastDimension():null,this.rootLabel=e.get(s,"rootLabel")||"",this.flatteningMode=e.get(s,"flatteningMode")||Ie.FlatteningMode.None,this._cacheKey=this._calcCacheKey(),this.key=this._cacheKey+"##"+a.join("||")}).add({_calcCacheKey:function(t){return[e.get(t,"flatteningMode")||this.flatteningMode,e.get(t,"rootLabel")||this.rootLabel].join("#")},bind:function(t,i){this.complexType=t||e.fail.argumentRequired("complexType"),this._setExtensionComplexTypesMap(i),i=this.extensionComplexTypesMap;var n=!1,s=null;this.levels.forEach(function(e){if(e.bind(t,i),!n)for(var r=e.allDimensions,a=-1,o=r.length;++a<o;){var l=r[a].dimensionType;if(l.isDiscrete){n=!0;break}if(null===s)s=l.valueType;else if(s!==l.valueType){n=!0;break}}}),this._isDiscrete=n,this._singleContinuousValueType=n?null:s},get isBound(){return!!this.complexType},_setExtensionComplexTypesMap:function(t){if(this.hasExtensionComplexTypes){if(!t){var i=e.error.operationInvalid("Expects a map of extension types.");throw i.code="need-extension-map",i}this.extensionComplexTypesMap=e.copyProps(t,this.extensionComplexTypeNames)}else this.extensionComplexTypesMap=null},get isNull(){return 0===this.depth},get isSingleLevel(){return 1===this.depth},get hasExtensionComplexTypes(){return!!this.extensionComplexTypeNames},isDiscrete:function(){return this._isDiscrete},get singleContinuousValueType(){return this._singleContinuousValueType},get singleDimensionName(){if(this.isSingleDimension)return this.firstDimension.name;throw e.error.operationInvalid("Expected grouping to contain exactly one dimension.")},get singleDimensionType(){if(this.isSingleDimension)return this.firstDimension.dimensionType;throw e.error.operationInvalid("Grouping contains more than one dimension.")},dimensions:function(){return e.query(this.levels).prop("dimensions").selectMany()},allDimensions:function(){return e.query(this.levels).prop("allDimensions").selectMany()},extensionDimensions:function(){return e.query(this.levels).prop("extensionDimensions").selectMany()},dimensionNames:function(){return this._dimNames},get allDimensionNames(){return this._allDimNames},firstDimensionType:function(){var e=this.firstDimension;return e&&e.dimensionType},firstDimensionName:function(){var e=this.firstDimensionType();return e&&e.name},firstDimensionValueType:function(){var e=this.firstDimensionType();return e&&e.valueType},lastDimensionType:function(){var e=this.lastDimension;return e&&e.dimensionType},lastDimensionName:function(){var e=this.lastDimensionType();return e&&e.name},lastDimensionValueType:function(){var e=this.lastDimensionType();return e&&e.valueType},ensure:function(t){var i;if(t){var n=this._calcCacheKey(t);if(n!==this._cacheKey){var s=e.lazy(this,"_groupingCache");i=e.getOwn(s,n),i||(i=s[n]=this._ensure(t))}}return i||this},_ensure:function(t){return new Ie.GroupingSpec(this.levels,this.complexType,this.extensionComplexTypesMap,{flatteningMode:e.get(t,"flatteningMode")||this.flatteningMode,rootLabel:e.get(t,"rootLabel")||this.rootLabel})},toSingleLevel:function(){if(this.isSingleLevel)return this;var e=this.allDimensions().array(),t=new Ie.GroupingLevelSpec(e,this.complexType,this.extensionComplexTypesMap);return new Ie.GroupingSpec([t],this.complexType,this.extensionComplexTypesMap,{flatteningMode:Ie.FlatteningMode.SingleLevel,rootLabel:this.rootLabel})},reverse:function(){var e=this.levels.map(function(e){return e.reverse()});return new Ie.GroupingSpec(e,this.complexType,this.extensionComplexTypesMap,{flatteningMode:this.flatteningMode,rootLabel:this.rootLabel})},view:function(e){var t=e instanceof Ie.Datum?this.dimensionNames():this.allDimensionNames;return e.view(t)},toString:function(){return this.levels.map(String).join(", ")}}),e.type("cdo.GroupingLevelSpec").init(function(t){var i=[],n=[],s=[],r=[],a=null;this.dimensions=r,this.allDimensions=e.query(t).select(function(e){return i.push(e.key),e.dataSetName?(n.push(e.fullName),null===a&&(a=[]),a.push(e)):(n.push(e.name),s.push(e.name),r.push(e)),e}).array(),this.extensionDimensions=a,this._dimNames=s,this._allDimNames=n,this._accDimNames=null,this.depth=this.allDimensions.length,this.key=i.join(",")}).add({_setAccAllDimNames:function(e){this._accDimNames=e},accAllDimensionNames:function(){return this._accDimNames},dimensionNames:function(){return this._dimNames},get allDimensionNames(){return this._allDimNames},lastDimension:function(){return this.allDimensions[this.depth-1]},bind:function(e,t){this.allDimensions.forEach(function(i){i.bindComplexType(e,t)})},compareNodesMain:function(e,t){for(var i,n=this.dimensions,s=n.length,r=-1;++r<s;)if(0!==(i=n[r].compareDatums(e.firstDatum,t.firstDatum)))return i;return 0},compareNodesWithExtension:function(e,t){for(var i,n,s,r,a,o=this.allDimensions,l=o.length,u=-1;++u<l;)if(null!==(s=(n=o[u]).dataSetName)?(r=e.extensionDatumsMap[s][0],a=t.extensionDatumsMap[s][0]):(r=e.firstDatum,a=t.firstDatum),0!==(i=n.compareDatums(r,a)))return i;return 0},buildKeyMain:function(e){return Ie.Complex.compositeKey(e,this._dimNames)},buildKeyWithExtension:function(e,t){for(var i,n="",s=this.allDimensions,r=s.length,a=-1,o=e.owner.keySep,l=e.atoms;++a<r;){var u=null!==(i=s[a]).dataSetName?t[i.dataSetName][0].atoms[i.name].key:l[i.name].key;a?n+=o+u:n=u}return n},buildGroupNodeMain:function(t){var i=this._dimNames;return{atoms:e.copyProps(t.atoms,i),dimNames:i}},buildGroupNodeWithExtension:function(e,t){for(var i,n={},s=this.allDimensions,r=s.length,a=e.atoms,o=-1;++o<r;)null!==(i=s[o]).dataSetName?n[i.fullName]=t[i.dataSetName][0].atoms[i.name]:n[i.name]=a[i.name];return{atoms:n,dimNames:this._allDimNames}},reverse:function(){var e=this.allDimensions.map(function(e){return e.reverse()});return new Ie.GroupingLevelSpec(e,this.complexType,this.extensionComplexTypesMap)},toString:function(){return e.query(this.allDimensions).select(String).array().join("|")}}),e.type("cdo.GroupingDimensionSpec").init(function(e,t,i){this.fullName=e;var n=/^(?:(.+?)\.)?(.+)$/.exec(e);this.dataSetName=n&&n[1]||null,this.name=n?n[2]:e,this.isReversed=!!t,this.key=e+":"+(t?"0":"1"),this.dimensionType=null,i&&this.bind(i)}).add({bindComplexType:function(t,i){t||e.fail.argumentRequired("complexType");var n;if(null!==this.dataSetName){var s=e.get(i,this.dataSetName);if(!s)throw e.error.operationInvalid("The data set name '{0}' of dimension '{1}' is not defined.",[this.dataSetName,this.fullName]);n=s}else n=t;return this.bind(n.dimensions(this.name)),this},bind:function(t){if(this.dimensionType=t||e.fail.argumentRequired("dimensionType"),t.isComparable){var i=t.atomComparer(this.isReversed),n=this.name;this.compareDatums=function(e,t){return i(e.atoms[n],t.atoms[n])}}else this.isReversed?this.compareDatums=function(e,t){return t.id-e.id}:this.compareDatums=function(e,t){return e.id-t.id};return this},compareDatums:function(t,i){throw e.error.operationInvalid("Not Bound.")},reverse:function(){return new Ie.GroupingDimensionSpec(this.fullName,!this.isReversed,this.dimensionType)},toString:function(){return this.fullName+(this.dimensionType?' ("'+this.dimensionType.label+'")':"")+(this.isReversed?" desc":"")}}),Ie.GroupingSpec.parse=function(t,i,n){var s=null;if(t){var r=e.string.is(t)?t.split(/\s*,\s*/):e.array.as(t);s=e.query(r).select(function(e){var t=W(e,i,n);return new Ie.GroupingLevelSpec(t,i,n)})}return new Ie.GroupingSpec(s,i,n)};var Re=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;e.type("cdo.LinearInterpolationOper").init(function(t,i,n,s,r,a,o,l){this._newDatums=[],this._data=n;var u=s.flatten(t).children();this._isCatDiscrete=s.grouping.isDiscrete(),this._isCatDiscrete||(u=u.where(function(e){return null!==e.value}));var h=r.isBound()?r.flatten(i,{visible:!0,isNull:!1}).children().array():[null],c=this._valDim=t.owner.dimensions(o),m={visible:!0,zeroIfNone:!1};this._stretchEnds=l,this._catInfos=u.select(function(e,t){var i=n.child(e.key),s={data:i||e,value:e.value,isInterpolated:!1,serInfos:null,index:t};return s.serInfos=[],
h.forEach(function(e){var t=i;t&&e&&(t=t.child(e.key));var n=a.getBoundDimensionName(t||e,!0);if(null===n||n===o){var r=t?t.dimensions(c.name).value(m):null;s.serInfos.push({data:e,group:t,value:r,isNull:null==r,catInfo:s})}}),s}).array(),this._serCount=h.length,this._serStates=e.range(0,this._serCount).select(function(e){return new Ie.LinearInterpolationOperSeriesState(this,e)},this).array()}).add({interpolate:function(){for(var e;e=this._catInfos.shift();)e.serInfos.forEach(this._visitSeries,this);var t=this._newDatums;t.length&&this._data.owner.add(t)},_visitSeries:function(e,t){this._serStates[t].visit(e)},nextUnprocessedNonNullCategOfSeries:function(e){for(var t=0,i=this._catInfos.length;t<i;){var n=this._catInfos[t++],s=n.serInfos[e];if(!s.isNull)return s}}}),e.type("cdo.LinearInterpolationOperSeriesState").init(function(e,t){this.interpolation=e,this.index=t,this._lastNonNull(null)}).add({visit:function(e){e.isNull?this._interpolate(e):this._lastNonNull(e)},_lastNonNull:function(e){return arguments.length&&(this.__lastNonNull=e,this.__nextNonNull=void 0),this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(void 0===this.__nextNonNull){var t=this.__lastNonNull,i=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(i&&t){var n=t.value,s=i.value,r=s-n;if(this.interpolation._isCatDiscrete){var a=i.catInfo.index-t.catInfo.index;a>=2||e.assert("Must have at least one interpolation point."),this._stepValue=r/a,this._middleIndex=~~(a/2);var o=a-1;this._isOdd=o%2>0}else{var l=+t.catInfo.value,u=+i.catInfo.value,h=u-l;this._steep=r/h,this._middleCat=(u+l)/2}}}},_interpolate:function(t){this._initInterpData();var i=this.__nextNonNull,n=this.__lastNonNull,s=i||n;if(s){var r,a,o=this.interpolation,l=t.catInfo;if(i&&n)if(o._isCatDiscrete){var u=l.index-n.catInfo.index;r=n.value+this._stepValue*u,a=(this._isOdd?u<this._middleIndex:u<=this._middleIndex)?n.group:i.group}else{var h=+l.value,c=+n.catInfo.value;r=n.value+this._steep*(h-c),a=h<this._middleCat?n.group:i.group}else{if(!o._stretchEnds)return;r=s.value,a=s.group}var m=Object.create(a.atoms);e.copyOwn(m,l.data.atoms);var d=o._valDim,f=d.intern(r,!0);m[d.name]=f;var p=o._datumDimNames;p||(o._datumDimNames=p=a.type.filterExtensionDimensionNames(e.keys(m))),o._newDatums.push(new Ie.InterpolationDatum(a.owner,m,p,"linear",d.name))}}}),e.type("cdo.ZeroInterpolationOper").init(function(t,i,n,s,r,a,o,l){this._newDatums=[],this._data=n;var u=s.flatten(t).children();this._isCatDiscrete=s.grouping.isDiscrete(),this._isCatDiscrete||(u=u.where(function(e){return null!==e.value}));var h=r.isBound()?r.flatten(i,{visible:!0,isNull:!1}).children().array():[null],c=this._valDim=t.owner.dimensions(o),m={visible:!0,zeroIfNone:!1};this._stretchEnds=l,this._catInfos=u.select(function(e,t){var i=n.child(e.key),s={data:i||e,value:e.value,isInterpolated:!1,serInfos:null,index:t};return s.serInfos=[],h.forEach(function(e){var t=i;t&&e&&(t=t.child(e.key));var n=a.getBoundDimensionName(t||e,!0);if(null===n||n===o){var r=t?t.dimensions(c.name).value(m):null;s.serInfos.push({data:e,group:t,value:r,isNull:null==r,catInfo:s})}}),s}).array(),this._serCount=h.length,this._serStates=e.range(0,this._serCount).select(function(e){return new Ie.ZeroInterpolationOperSeriesState(this,e)},this).array()}).add({interpolate:function(){for(var e;e=this._catInfos.shift();)e.serInfos.forEach(this._visitSeries,this);var t=this._newDatums;t.length&&this._data.owner.add(t)},_visitSeries:function(e,t){this._serStates[t].visit(e)},nextUnprocessedNonNullCategOfSeries:function(e){for(var t=0,i=this._catInfos.length;t<i;){var n=this._catInfos[t++],s=n.serInfos[e];if(!s.isNull)return s}}}),e.type("cdo.ZeroInterpolationOperSeriesState").init(function(e,t){this.interpolation=e,this.index=t,this._lastNonNull(null)}).add({visit:function(e){e.isNull?this._interpolate(e):this._lastNonNull(e)},_lastNonNull:function(e){return arguments.length&&(this.__lastNonNull=e,this.__nextNonNull=void 0),this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(void 0===this.__nextNonNull){var t=this.__lastNonNull,i=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(i&&t)if(this.interpolation._isCatDiscrete){var n=i.catInfo.index-t.catInfo.index;n>=2||e.assert("Must have at least one interpolation point."),this._middleIndex=~~(n/2);var s=n-1;this._isOdd=s%2>0}else{var r=+t.catInfo.value,a=+i.catInfo.value;this._middleCat=(a+r)/2}}},_interpolate:function(t){this._initInterpData();var i=this.__nextNonNull,n=this.__lastNonNull,s=i||n;if(s){var r,a=this.interpolation,o=t.catInfo;if(i&&n)if(a._isCatDiscrete){var l=o.index-n.catInfo.index;r=this._isOdd?l<this._middleIndex?n.group:i.group:l<=this._middleIndex?n.group:i.group}else{var u=+o.value;r=u<this._middleCat?n.group:i.group}else{if(!a._stretchEnds)return;r=s.group}var h=Object.create(r.atoms);e.copyOwn(h,o.data.atoms);var c=a._valDim,m=a._zeroAtom||(a._zeroAtom=c.intern(0,!0));h[c.name]=m;var d=a._datumDimNames;d||(a._datumDimNames=d=r.type.filterExtensionDimensionNames(e.keys(h))),a._newDatums.push(new Ie.InterpolationDatum(r.owner,h,d,"zero",c.name))}}}),e.type("cdo.TranslationOper").init(function(t,i,n,s){this.complexTypeProj=t||e.fail.argumentRequired("complexTypeProj"),this.source=i||e.fail.argumentRequired("source"),this.metadata=n||e.fail.argumentRequired("metadata"),this.options=s||{},this._initType(),e.debug>=4&&(this._logLogicalRows=!0,this._logLogicalRowCount=0)}).add({_logLogicalRows:!1,logSource:e.abstractMethod,logLogicalRow:e.abstractMethod,_translType:"Unknown",logTranslatorType:function(){return this._translType+" data source translator"},logicalColumnCount:function(){return this.metadata.length},setSource:function(t){if(!t)throw e.error.argumentRequired("source");this.source=t},defReader:function(t){t||e.fail.argumentRequired("readerSpec");var i=e.string.is(t)?t:t.names;i=e.string.is(i)?i.split(/\s*\,\s*/):e.array.as(i);var n=e.array.as(t.indexes);n&&n.forEach(this._userUseIndex,this);var s=!(!i||!i.length),r=t.reader;if(r)s||e.fail.argumentRequired("reader.names","Required argument when a reader function is specified."),this._userRead(r,i);else{if(s)return this._userCreateReaders(i,n);n&&n.forEach(function(e){this._userIndexesToSingleDim[e]=null},this)}return n},configureType:function(){this._configureTypeCore()},_configureTypeCore:e.abstractMethod,_initType:function(){this._userDimsReaders=[],this._userDimsReadersByDim={},this._userUsedIndexes={},this._userIndexesToSingleDim=[];var t=this.options.readers;t&&e.array.each(t,this.defReader,this);var i=e.parseDistinctIndexArray(this.options.multiChartIndexes);i&&(this._multiChartIndexes=this.defReader({names:"multiChart",indexes:i}))},_userUseIndex:function(t){if((t=+t)<0)throw e.error.argumentInvalid("index","Invalid reader index: '{0}'.",[t]);if(e.hasOwn(this._userUsedIndexes,t))throw e.error.argumentInvalid("index","Column '{0}' of the logical table is already assigned.",[t]);return this._userUsedIndexes[t]=!0,t},_userCreateReaders:function(t,i){i?i.forEach(function(e,t){i[t]=+e}):i=[];var n,s=i.length,r=t.length;if(r>s){var a=s>0?i[s-1]+1:0;do{a=this._getNextFreeLogicalColumnIndex(a),i[s]=a,this._userUseIndex(a),s++}while(r>s)}for(var o,l=s===r?r:r-1,u=0;u<l;u++)n=t[u],o=i[u],this._userIndexesToSingleDim[o]=n,this._userRead(this._propGet(n,o),n);if(l<r)for(var h=e.splitIndexedId(t[r-1]),c=h[0],m=e.nullyTo(h[1],0),d=l;d<s;d++,m++)n=e.indexedId(c,m),o=i[d],this._userIndexesToSingleDim[o]=n,this._userRead(this._propGet(n,o),n);return i},_userRead:function(t,i){e.fun.is(t)||e.fail.argumentInvalid("reader","Reader must be a function."),e.array.is(i)?i.forEach(function(e){this._readDim(e,t)},this):this._readDim(i,t),this._userDimsReaders.push(t)},_readDim:function(t,i){var n,s,r=this._userIndexesToSingleDim.indexOf(t);if(r>=0&&(n=this._logicalRowInfos[r])&&!this.options.ignoreMetadataLabels){var a=n.label||n.name&&e.titleFromName(n.name);a&&(s={label:a})}this.complexTypeProj.readDim(t,s),this._userDimsReadersByDim[t]=i},execute:function(e){return this.data=e,this._executeCore()},_executeCore:function(){var t=this._getDimensionsReaders();return e.query(this._getLogicalRows()).select(function(e){return this._readLogicalRow(e,t)},this)},_getLogicalRows:function(){return this.source},_getDimensionsReaders:function(){return this._userDimsReaders.slice().reverse()},_readLogicalRow:function(e,t){for(var i=this._logLogicalRows&&this._logLogicalRowBefore(e),n=t.length,s=this.data,r={};n--;)t[n].call(s,e,r);return i&&this._logLogicalRowAfter(r),r},_logLogicalRowBefore:function(t){return this._logLogicalRowCount<10?(e.log("logical row ["+this._logLogicalRowCount+++"]: "+e.describe(t)),!0):(e.log("..."),this._logLogicalRows=!1)},_logLogicalRowAfter:function(t){var i={};for(var n in t){var s=t[n];e.object.is(s)&&(s="v"in s?s.v:"value"in s?s.value:"..."),i[n]=s}e.log("-> read: "+e.describe(i))},_propGet:function(e,t){function i(i,n){n[e]=i[t]}return i},_getNextFreeLogicalColumnIndex:function(t,i){for(null==t&&(t=0),null==i&&(i=1/0);t<i&&e.hasOwn(this._userUsedIndexes,t);)t++;return t<i?t:-1},_getPhysicalGroupStartIndex:function(t){return e.getOwn(this._logicalRowPhysicalGroupIndex,t)},_getPhysicalGroupLength:function(t){return e.getOwn(this._logicalRowPhysicalGroupsLength,t)},_configureTypeByPhysicalGroup:function(t,i,n,s){var r=this._logicalRowPhysicalGroupIndex[t],a=this._logicalRowPhysicalGroupsLength[t],o=r+a-1,l=r;if((n=null==n?a:Math.min(a,n))&&l<=o){i||(i=t),s||(s=1/0);for(var u,h=0;n&&h<s;)if(u=e.indexedId(i,h++),!this.complexTypeProj.isReadOrCalc(u)){if((l=this._getNextFreeLogicalColumnIndex(l))>o)return l;this.defReader({names:u,indexes:l}),l++,n--}}return l},_configureTypeByOrgLevel:function(e,t){var i=[],n=[];this._logicalRowInfos.forEach(function(e,t){if(!this[t]){var s=1===e.type?i:n;s&&s.push(t)}},this._userUsedIndexes),this._configureTypeByDimGroups(n,this._processDimGroupSpecs(e,!0,1/0)),this._configureTypeByDimGroups(i,this._processDimGroupSpecs(t,!1,1))},_processDimGroupSpecs:function(t,i,n){return t.map(function(t){return e.string.is(t)?{name:t,greedy:i,maxCount:n}:e.setDefaults(t,{greedy:i,maxCount:n})})},_configureTypeByDimGroups:function(e,t){if(t)for(var i,n=-1,s=t.length;++n<s&&(i=e.length);){var r=t[n],a=Math.min(r.maxCount,i),o=this._getFreeDimGroupNames(r.name,a,r.greedy);o&&(o.length,this.defReader({names:o,indexes:e.splice(0,o.length)}))}},_getFreeDimGroupNames:function(t,i,n){if(!t)return null;var s=[],r=0;for(null==i&&(i=1);i;){var a=e.indexedId(t,r++);this.complexTypeProj.isReadOrCalc(a)?n||i--:(s.push(a),i--)}return s.length?s:null}}),e.type("cdo.MatrixTranslationOper",Ie.TranslationOper).add({_initType:function(){this.J=this.metadata.length,this.I=this.source.length,this._processMetadata(),this.base()},setSource:function(e){this.base(e),this.I=this.source.length},_knownContinuousColTypes:{numeric:1,number:1,integer:1},_processMetadata:function(){var t,i=this.options.typeCheckingMode,n=this._knownContinuousColTypes;if("none"===i)t=e.query(this.metadata).select(function(e,t){e.colIndex=t;var i=e.colType;return i&&1===n[i.toLowerCase()]?1:0}).array();else{var s="extended"===i,r=e.query(this.metadata).select(function(e,t){return e.colIndex=t,e}).where(function(e){var t=e.colType;return!t||1!==n[t.toLowerCase()]}).select(function(e){return e.colIndex}).array(),a=this.I,o=this.source,l=r.length;t=e.array.create(this.J,1);for(var u=0;u<a&&l>0;u++)for(var h=o[u],c=0;c<l;){var m=r[c],d=h[m];null!=d?(t[m]=this._getSourceValueType(d,s),r.splice(c,1),l--):c++}}this._columnTypes=t},_buildLogicalColumnInfoFromMetadata:function(e){var t=this.metadata[e];return{type:this._columnTypes[e],name:t.colName,label:t.colLabel}},_getSourceValueType:function(e,t){switch(typeof e){case"number":return 1;case"string":return t&&""!==e&&!isNaN(+e)?1:0;case"object":return e instanceof Date?1:0}return 0},logSource:function(){var t=Ie.previewRowsMax,i=Ie.previewColsMax,n=this.metadata,s=n.length,r=e.array.prepend;s>i&&(n=n.slice(0,i),n.push({colName:"("+i+"/"+s+")",colType:"..."}));var a=e.textTable(n.length+1).rowSep().row.apply(a,r(n.map(function(e){return e.colName}),["Name"])).rowSep().row.apply(a,r(n.map(function(e){return e.colLabel?'"'+e.colLabel+'"':""}),["Label"])).rowSep().row.apply(a,r(n.map(function(e){return e.colType}),["Type"])).rowSep();return e.query(this.source).take(t).each(function(t,n){s>i&&(t=t.slice(0,i)),a.row.apply(a,r(t.map(function(t){return e.describe(t)}),[n+1]))}),a.rowSep().row("("+Math.min(t,this.I)+"/"+this.I+")").rowSep(!0),"DATA SOURCE SUMMARY\n"+a()+"\n"},_logLogicalRow:function(t,i){var n=e.textTable(6).rowSep().row("Index","Kind","Type","Name","Label","Dimension").rowSep(),s=0;return t.forEach(function(e){for(var t=0,r=i[e];t<r;t++){var a=this._logicalRowInfos[s];n.row(s,e,a.type?"number":"string",a.name||"",a.label||"",this._userIndexesToSingleDim[s]||""),s++}},this),n.rowSep(!0),"LOGICAL TABLE\n"+n()+"\n"},_createPlot2SeriesKeySet:function(t,i){var n=null,s=i.length;return e.query(t).each(function(t){var r=+t;if(isNaN(r))throw e.error.argumentInvalid("plot2SeriesIndexes","Element is not a number '{0}'.",[t]);if(r<0){if(r<=-s)throw e.error.argumentInvalid("plot2SeriesIndexes","Index is out of range '{0}'.",[r]);r=s+r}else if(r>=s)throw e.error.argumentInvalid("plot2SeriesIndexes","Index is out of range '{0}'.",[r]);n||(n={}),n[i[r]]=!0}),n},_dataPartGet:function(t){function i(t,i){i[l]=e.hasOwn(s,t)?a||(a=n.intern("1")):r||(r=n.intern("0"))}var n,s,r,a,o=this,l=this.options.dataPartDimName,u=function(){s=t(),n=o.data.dimensions(l),e.debug>=3&&s&&e.log("Second axis series values: "+e.describe(e.keys(s))),u=null};this.complexTypeProj.setCalc({names:l,calculation:function(e,t){u&&u(),i(e.atoms.series.value,t)}})},_configureTypeCore:function(){["series","category","value"].forEach(function(e){this._configureTypeByPhysicalGroup(e)},this)}}),Ie.previewRowsMax=15,Ie.previewColsMax=6,e.type("cdo.CrosstabTranslationOper",Ie.MatrixTranslationOper).add({_translType:"Crosstab",logicalColumnCount:function(){return this.R+this.C+this.M},_executeCore:function(){function t(e,t){for(var i=r[e],n=0,o=a[e];o-- >0;)s[i++]=t[n++]}function i(e,t){for(var i=r.M,n=a._colGroupsIndexes[t],o=a.M,l=0;l<o;l++){var u=n[l];s[i++]=null!=u?e[u]:null}}if(!this.metadata.length)return e.query();var n=this._getDimensionsReaders(),s=new Array(this.logicalColumnCount()),r=this._logicalRowCrossGroupIndex,a=this,o=e.query(this.source);if(this._colGroups&&this._colGroups.length){var l=function(r){return t("R",r),e.query(this._colGroups).select(function(e,a){return t("C",e),i(r,a),this._readLogicalRow(s,n)},this)};return o.selectMany(l,this)}return o.select(function(e){return t("R",e),this._readLogicalRow(s,n)},this)},_processMetadata:function(){this.base(),this._separator=this.options.separator||"~";var t=this.R=1;this.C=1,this.M=1,this.measuresDirection=null;var i=this.options.seriesInRows,n=this.metadata,s=this.options.compatVersion<=1,r=function(){var e=i?function(e){return e.colName}:s?function(e){return{v:e.colName}}:function(e){return{v:e.colName,f:e.colLabel}};return n.map(e)}(),a=this._logicalRowCrossGroupInfos={};if(this.options.isMultiValued){var o=e.get(this.options,"measuresInColumns",!0);if(o||null==this.options.measuresIndex){t=this.R=this._getCategoriesCount();var l=r.slice(t);l.length>0?(o?(this.measuresDirection="columns",this._processEncodedColGroups(l)):(this._colGroups=l,this._colGroupsIndexes=[],this._colGroups.forEach(function(e,t){this._colGroups[t]=this._splitEncodedColGroupCell(e),this._colGroupsIndexes[t]=[this.R+t]},this),a.M=[this._buildLogicalColumnInfoFromMetadata(t)]),this.C=this._colGroups[0].length,a.C=e.range(0,this.C).select(function(){return{type:0}}).array()):(this.C=this.M=0,a.M=[],a.C=[])}else{this.measuresDirection="rows",this.R=+this.options.measuresIndex;var u=this.options.measuresCount;null==u&&(u=1),this.M=u,this._colGroups=r.slice(this.R+1),this._colGroups.forEach(function(e,t){this._colGroups[t]=[e]},this)}}else t=this.R=this._getCategoriesCount(),this._colGroups=r.slice(t),this._colGroupsIndexes=new Array(this._colGroups.length),this._colGroups.forEach(function(e,i){this._colGroups[i]=[e],this._colGroupsIndexes[i]=[t+i]},this),a.C=[{type:0}],a.M=[{type:this._columnTypes[t]}];a.R=e.range(0,this.R).select(this._buildLogicalColumnInfoFromMetadata,this).array();var h=this._logicalRowCrossGroupIndex={C:i?this.R:0,R:i?0:this.C,M:this.C+this.R},c=this._logicalRowInfos=new Array(this.logicalColumnCount());e.eachOwn(h,function(e,t){a[t].forEach(function(t,i){c[e+i]=t})}),this._logicalRowPhysicalGroupsLength={series:i?this.R:this.C,category:i?this.C:this.R,value:this.M},this._logicalRowPhysicalGroupIndex={series:0,category:this._logicalRowPhysicalGroupsLength.series,value:this.C+this.R}},logLogicalRow:function(){return this._logLogicalRow(["C","R","M"],{C:this.C,R:this.R,M:this.M})},_getCategoriesCount:function(){var t=this.options.categoriesCount;return null!=t&&(!isFinite(t)||t<0)&&(t=null),null==t&&((t=e.query(this._columnTypes).whayl(function(e){return 0===e}).count())||(t=1)),t},_splitEncodedColGroupCell:function(e){var t,i=e.v;return null==i?i=[]:(i=i.split(this._separator),(t=e.f)&&(t=t.split(this._separator))),i.map(function(e,i){return{v:e,f:t&&t[i]}})},_processEncodedColGroups:function(t){for(var i,n=t.length||e.assert("Must have columns"),s=this.R,r=[],a={},o=[],l=0;l<n;l++){var u,h,c,m,d=t[l],f=d.v,p=d.f,g=f.lastIndexOf(this._separator);g<0?(u=f,h=p,f="",c=[]):(u=f.substring(g+1),f=f.substring(0,g),c=f.split(this._separator),null!=p&&(m=p.split(this._separator),h=m.pop()),c.forEach(function(e,t){var i=m&&m[t];c[t]={v:e,f:i}})),i&&i.encValues===f?i.measureNames.push(u):(i={startIndex:l,encValues:f,values:c,measureNames:[u]},r.push(i));var v=l-i.startIndex,_=e.getOwn(a,u);_?v>_.groupIndex&&(_.groupIndex=v):(a[u]=_={name:u,label:h,type:this._columnTypes[s+l],groupIndex:v,index:l},o.push(_))}o.sort(function(t,i){return e.compare(t.groupIndex,i.groupIndex)||e.compare(t.index,i.index)}),o.forEach(function(e,t){e.groupIndex=t});var y=r.length,b=new Array(y),D=new Array(y),N=o.length;r.map(function(e,t){b[t]=e.values;var i=e.startIndex,n=D[t]=new Array(N);e.measureNames.forEach(function(e,t){var r=a[e].groupIndex;n[r]=s+i+t})}),this._colGroups=b,this._colGroupsIndexes=D,this._logicalRowCrossGroupInfos.M=o,this.M=N},configureType:function(){if("rows"===this.measuresDirection)throw e.error.notImplemented();var t=this.options.dataPartDimName;if(t&&1===this.C&&!this.complexTypeProj.isReadOrCalc(t)){var i=this.options.plot2DataSeriesIndexes;if(null!=i){var n=this._colGroups.map(function(e){return""+e[0].v});this._plot2SeriesKeySet=this._createPlot2SeriesKeySet(i,n)}}if(this.base(),this._plot2SeriesKeySet&&this._userDimsReadersByDim.series){var s=e.fun.constant(this._plot2SeriesKeySet);this._dataPartGet(s)}}}),e.type("cdo.RelationalTranslationOper",Ie.MatrixTranslationOper).add({M:0,C:0,S:0,_translType:"Relational",_processMetadata:function(){this.base();var t,i,n,s,r=this.metadata,a=this.J,o=this.options.categoriesCount;if(null!=o&&(!isFinite(o)||o<0)&&(o=0),this.options.isMultiValued&&(i=e.parseDistinctIndexArray(this.options.measuresIndexes,0,a-1),n=i?i.length:0),null==n)if(a>0&&a<=3&&(null==o||1===o))n=1,i=[a-1],o=a>=2?1:0,t=a>=3?1:0,s=o+t;else if(null!=o&&o>=a)s=o=a,t=n=0;else{var l=null!=o?a-o:1/0;i=e.query(r).where(function(e,t){return 0!==this._columnTypes[t]},this).select(function(e){return e.colIndex}).take(l).array(),n=i.length}null==s&&(s=a-n,0===s?t=o=0:null!=o?o>s?(o=s,t=0):t=s-o:(t=s>1?1:0,o=s-t));var u=this.options.seriesInRows,h=[];s&&(t&&!u&&h.push({name:"S",count:t}),o&&h.push({name:"C",count:o}),t&&u&&h.push({name:"S",count:t})),n&&h.push({name:"M",count:n});var c=e.range(0,a).array();i&&i.slice().sort(e.descending).forEach(function(e){c.splice(e,1)});var m={};h.forEach(function(e){var t=e.count,n=e.name;m[n]=e,e.indexes=i&&"M"===n?i:c.splice(0,t)}),this.M=n,this.S=t,this.C=o;var d=[];["S","C","M"].forEach(function(t){var i=m[t];i&&e.array.append(d,i.indexes)}),this._logicalRowInfos=d.map(this._buildLogicalColumnInfoFromMetadata,this),this._logicalRowPerm=d,this._logicalRowPhysicalGroupsLength={series:this.S,category:this.C,value:this.M},this._logicalRowPhysicalGroupIndex={series:0,category:this._logicalRowPhysicalGroupsLength.series,value:this.S+this.C}},logLogicalRow:function(){return this._logLogicalRow(["S","C","M"],{S:this.S,C:this.C,M:this.M})},configureType:function(){this.base();var e=this.options.dataPartDimName;if(e&&!this.complexTypeProj.isReadOrCalc(e)){var t=this.options.plot2DataSeriesIndexes;if(null!=t){var i=this._userDimsReadersByDim.series;i&&Y.call(this,t,i)}}},_executeCore:function(){var i=this._getDimensionsReaders(),n=this._logicalRowPerm;return e.query(this._getLogicalRows()).select(function(e){return e=t.permute(e,n),this._readLogicalRow(e,i)},this)}});var Le=Ie.numberFormatStyle=function(e,t){return new Ge(e,t)},Me=e.priv.key().property(),Ge=Le.of=e("cdo.NumberFormatStyle",e.FieldsBase.extend({init:function(){e.classify(this,Le)},fields:{decimal:{cast:String,fail:e.falsy},group:{cast:String},groupSizes:{fail:e.array.empty},negativeSign:{cast:String,fail:e.falsy},currency:{cast:String,fail:e.falsy},integerPad:{cast:String,fail:e.falsy},fractionPad:{cast:String,fail:e.falsy},abbreviations:{fail:e.array.empty}},methods:{tryConfigure:function(t){if(e.is(t,Le))return!!this.integerPad(t.integerPad()).fractionPad(t.fractionPad()).decimal(t.decimal()).group(t.group()).groupSizes(t.groupSizes()).negativeSign(t.negativeSign()).currency(t.currency()).abbreviations(t.abbreviations());if(e.string.is(t)){var i=Ue(t);if(i)return!!e.configure(this,i.number().style())}}}},{fieldsPrivProp:Me}));e.classify(Ge.prototype,Le),Le.defaults=Le({integerPad:"0",fractionPad:"0",decimal:".",group:",",groupSizes:[3],abbreviations:["k","m","b","t"],negativeSign:"-",currency:"$"});var Pe=Ie.numberFormat=function(t,i){function n(e){return r||(r=Z(s.mask)),r(e,Me(s.style))}var s,r;return n.format=n,n.tryConfigure=J,e.classify(n,Pe),s=e.instance(n,t,i,{mask:{cast:String,change:function(){r=null}},style:{cast:e.createAs(Ge),factory:Le}}),n};Pe.defaults=Pe().style(Le()),Pe.cacheLimit=20;var Be={},Ve=0,je=Ie.dateFormat=function(t,i){function n(e){return r||(r=_e(s.mask)),r(e)}var s,r;return n.format=n,n.tryConfigure=ve,e.classify(n,je),s=e.instance(n,t,i,{mask:{cast:String,change:function(){r=null}}}),arguments.length&&e.configure(n,arguments[0]),n};je.defaults=je();var qe=Ie.customFormat=function(t,i){function n(e){var t=s.formatter;return String(t&&t.apply(null,arguments))}var s;return n.format=n,n.tryConfigure=ye,e.classify(n,qe),s=e.instance(n,t,i,{formatter:{cast:e.fun.as}}),n};qe.defaults=qe().formatter(be);var Ee="en-us",Ke=Ie.format=function(t,i){function n(){}n.tryConfigure=Ne;var s;if(!i&&e.string.is(t)){var r=Ue(t);s=r.languageCode,r&&(i=r,t=null)}return n.languageCode=s||Ee,e.classify(n,Ke),e.instance(n,t,i,{number:De(Pe),percent:De(Pe),date:De(je),any:{cast:e.createAs(qe),factory:qe}}),n};Ke.defaults=Ke({number:"#,0.##",percent:"#,0.#%",date:"%Y/%m/%d",any:qe()});var Fe={},ze=Fe[Ee]=Ke.defaults,Ue=Ie.format.language=function(t,i){var n=arguments.length;if(!n)return ze;if(1==n){if(void 0===t)throw e.error.operationInvalid("Undefined 'style' value.");if(null===t||""===t)t=Ee;else{if(e.is(t,Ke))return ze=t;if("object"==typeof t){for(var s in t)we(s,e.getOwn(t,s));return Ie.format}}return Ce(t,!0)}if(2==n)return we(t,i);throw e.error.operationInvalid("Wrong number of arguments")};return Ue({"en-gb":{number:{mask:"#,0.##",style:{integerPad:"0",fractionPad:"0",decimal:".",group:",",groupSizes:[3],abbreviations:["k","m","b","t"],negativeSign:"-",currency:"£"}},date:{mask:"%d/%m/%Y"}},"pt-pt":{number:{mask:"#,0.##",style:{integerPad:"0",fractionPad:"0",decimal:",",group:" ",groupSizes:[3],abbreviations:["k","m","b","t"],negativeSign:"-",currency:"€"}},date:{mask:"%d/%m/%Y"}}}),Ie});